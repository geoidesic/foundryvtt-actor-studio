{"version":3,"file":"Roll-IRBJrFST.js","sources":["../src/components/molecules/dnd5e/AbilityEntry/Roll.svelte"],"sourcesContent":["<script>\n  import { Timing } from \"@typhonjs-fvtt/runtime/util\";\n  import {\n    createEventDispatcher,\n    getContext,\n    onDestroy,\n    onMount,\n    tick,\n  } from \"svelte\";\n  import { abilities, race, abilityRolls } from \"~/src/stores/index\";\n  import { MODULE_ID } from \"~/src/helpers/constants\";\n  import { dnd5eModCalc, localize as t } from \"~/src/helpers/Utility\";\n\n  export let document = false;\n\n  const dispatch = createEventDispatcher();\n  const doc = document || getContext(\"#doc\");\n  const updateDebounce = Timing.debounce(updateValue, 100);\n  let formula, allowMove;\n\n  async function updateValue(attr, event) {\n    if (event.target.value < 8) return false;\n    if (event.target.value > 15) return false;\n    const options = {\n      system: { abilities: { [attr]: { value: Number(event.target.value) } } },\n    };\n    await $doc.updateSource(options);\n\n    if ($doc.render) {\n      $doc.render();\n    }\n  }\n\n  async function swapAbilities(attr, direction) {\n    const abilities = Object.keys($doc.system.abilities);\n    const index = abilities.indexOf(attr);\n\n    if (direction === 1 && index > 0) {\n      // Move up\n      const prevAbility = abilities[index - 1];\n      const options = {\n        system: {\n          abilities: {\n            [attr]: { value: $doc.system.abilities[prevAbility].value },\n            [prevAbility]: { value: $doc.system.abilities[attr].value },\n          },\n        },\n      };\n      await $doc.updateSource(options);\n\n      if ($doc.render) {\n        $doc.render();\n      }\n    } else if (direction === -1 && index < abilities.length - 1) {\n      // Move down\n      const nextAbility = abilities[index + 1];\n      const options = {\n        system: {\n          abilities: {\n            [attr]: { value: $doc.system.abilities[nextAbility].value },\n            [nextAbility]: { value: $doc.system.abilities[attr].value },\n          },\n        },\n      };\n      await $doc.updateSource(options);\n\n      if ($doc.render) {\n        $doc.render();\n      }\n    }\n  }\n\n  async function roll(attr) {\n    const roll = await new Roll(formula).evaluate();\n    await roll.toMessage();\n\n    $abilityRolls = !$abilityRolls ? {} : $abilityRolls;\n    $abilityRolls[attr] = roll.total;\n\n    // set the value of the ability to the result of the roll\n    const options = {\n      system: { abilities: { [attr]: { value: Number(roll.total) } } },\n    };\n    await $doc.updateSource(options);\n\n    if ($doc.render) {\n      $doc.render();\n    }\n  }\n\n  $: systemAbilities = game.system.config.abilities;\n  $: systemAbilitiesArray = Object.entries(systemAbilities);\n  $: raceFeatScore = 0;\n  $: abilityAdvancements =\n    $race?.advancement?.byType?.AbilityScoreImprovement?.[0].configuration\n      ?.fixed;\n  $: allRolled = systemAbilitiesArray.every(\n    (ability) => $abilityRolls[ability[0]] !== undefined,\n  );\n  $: scoreClass = allowMove && allRolled ? \"left\" : \"center\";\n\n  onMount(async () => {\n    formula = game.settings.get(MODULE_ID, \"abiiltyRollFormula\");\n    allowMove = game.settings.get(MODULE_ID, \"allowAbilityRollScoresToBeMoved\");\n  });\n</script>\n\n<template lang=\"pug\">\n.attribute-entry.mt-sm\n  table\n    thead\n      tr\n        th.ability Ability\n        th.center Base\n        +if(\"window.GAS.dnd5eRules == '2014'\")\n          th.center Origin\n        th.center Score\n        th.center Mod\n        th.center.roll-col\n    tbody\n      +each(\"systemAbilitiesArray as ability, index\")\n        tr\n          td.ability {ability[1].label}\n          td.center.relative\n            input.small.mainscore(class=\"{scoreClass}\" disabled type=\"number\" value=\"{$doc.system.abilities[ability[0]]?.value}\"  name=\"{ability[0]}\" id=\"{ability[0]}\")\n            +if(\"allowMove && allRolled\")\n              .controls\n                .up.chevron\n                  +if(\"index != 0\")\n                    i.fas.fa-chevron-up(alt=\"{t('AltText.MoveUp')}\" on:click!=\"{swapAbilities(ability[0], 1)}\")\n                .down.chevron\n                  +if(\"index != systemAbilitiesArray.length - 1\")\n                    i.fas.fa-chevron-down(alt=\"{t('AltText.MoveDown')}\" on:click!=\"{swapAbilities(ability[0], -1)}\")\n          +if(\"window.GAS.dnd5eRules == '2014'\")\n            td.center\n              +if(\"abilityAdvancements?.[ability[0]] > 0\")\n                span +\n              span {abilityAdvancements?.[ability[0]] || 0}\n          td.center\n            span {(Number(abilityAdvancements?.[ability[0]]) || 0) + Number($doc.system.abilities[ability[0]]?.value || 0)}\n          td.center\n            +if(\"dnd5eModCalc(Number($doc.system.abilities[ability[0]]?.value) + (Number(abilityAdvancements?.[ability[0]]) || 0)) > 0\")\n              span +\n            span {dnd5eModCalc(Number($doc.system.abilities[ability[0]]?.value) + (Number(abilityAdvancements?.[ability[0]]) || 0))}\n          td.center\n            .buttons(class=\"{$abilityRolls[ability[0]] ? '' : 'active'}\" alt=\"{t('AltText.Roll')}\" on:click!=\"{roll(ability[0])}\")\n              i.fas.fa-dice\n\n</template>\n\n<style lang=\"sass\">\n  table\n    width: 100%\n    border-collapse: separate\n   \n  th\n    padding: 0.1rem 0.5rem\n    text-align: left\n    font-family: var(--dnd5e-font-modesto)\n    &.center\n      text-align: center\n    &.roll-col\n      width: 2rem\n   \n  td\n    text-align: left\n    &.center\n      text-align: center\n    &.ability\n      width: 25%\n\n \n  .green\n    color: green\n  .red\n    color: red\n  .relative\n    position: relative\n    background-color: rgba(0, 0, 0, 0.05)\n    border-radius: 3px\n  .mainscore\n    min-width: 33px\n    max-width: 33px\n  .controls\n    .chevron\n      position: absolute\n      font-size: 0.75rem\n      right: 0\n      cursor: pointer\n      background-color: rgba(0, 0, 0, 0.1)\n      &.up\n        padding: 1px 3px 0px 3px\n        top: 8px\n        &:hover\n          background-color: rgba(140, 90, 0, 0.2)\n      &.down\n        padding: 1px 3px 0px 3px\n        bottom: 8px\n        &:hover\n          background-color: rgba(140, 90, 0, 0.2)\n  .buttons\n    cursor: pointer\n    min-width: 24px\n    font-size: 1rem\n    background-color: rgba(0, 0, 0, 0.1)\n    padding: 2px 1px 0px 0px\n    top: 8px\n    border: 1px solid var(--color-positive)\n    border-radius: 4px\n    color: var(--color-positive)\n    &:hover\n      background-color: rgba(140, 90, 0, 0.2)\n    &.active\n      border: 1px solid var(--color-negative)\n      color: var(--color-negative)\n      animation: pulse 1s infinite\n</style>\n"],"names":["ctx","t","attr","roll"],"mappings":";;;;;;;;;;;;;;;;;AA2GsJ,aAA8B,QAAA,IAAA,MAAA;AAAA;;;;;;;;;;;;AAAsd,MAAA;AAAA;AAAA,IAAA,WAAS,KAAC,kBAAA,GAAA;AAAA;AAAkJ,MAAA;AAAA;AAAA,IAAA,IAAK,EAAA;AAAA,IAAI,IAAoB,CAAA,EAAC,SAAS,KAAC,kBAAA,GAAA;AAAA;;;;;;;;;;;;;AAAvP,aAAqX,QAAA,MAAA,MAAA;AAA/V,aAA0J,MAAA,IAAA;;AAAA,aAA+L,MAAA,IAAA;;;;AAA5T;AAAA;AAAA,QAAAA,YAAS;AAAA,OAAC,WAAA,EAAAA,MAAA,KAAA;AAAkJ;AAAA;AAAA,QAAAA,KAAK,EAAA;AAAA,QAAIA,KAAoB,CAAA,EAAC,SAAS;AAAA,QAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAtJ,WAAA,GAAA,OAAAC,SAAE,gBAAgB,CAAA;AAAA;;AAArD,aAAuG,QAAA,GAAA,MAAA;;;AAAnC,cAAA;AAAA;AAAA,YAAA,IAAa,CAAA;AAAA;AAAA,cAAC,IAAO,EAAA,EAAC,CAAC;AAAA,cAAG;AAAA,YAAC;AAAA,UAAA,EAA3B,KAAa,CAAA;AAAA;AAAA,YAAC,IAAO,EAAA,EAAC,CAAC;AAAA,YAAG;AAAA,UAAC,EAAA,MAAA,MAAA,SAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;AAAgI,WAAA,GAAA,OAAAA,SAAE,kBAAkB,CAAA;AAAA;;AAAzD,aAA4G,QAAA,GAAA,MAAA;;;AAApC,cAAA;AAAA;AAAA,YAAA,IAAa,CAAA;AAAA;AAAA,cAAC,IAAO,EAAA,EAAC,CAAC;AAAA,cAAA;AAAA,YAAK;AAAA,UAAA,EAA5B,KAAa,CAAA;AAAA;AAAA,YAAC,IAAO,EAAA,EAAC,CAAC;AAAA;UAAK,EAAA,MAAA,MAAA,SAAA;AAAA;;;;;;;;;;;;;;;;;;;AAAgK,MAAA;AAAA;AAAA,KAAA,IAAmB,CAAA;AAAA;AAAA,MAAG,IAAO,EAAA,EAAC,CAAC;AAAA,SAAM,KAAC;AAAA;;AAAtG,MAAA;AAAA;AAAA,IAAA,IAAmB,CAAA;AAAA;AAAA,MAAG,IAAO,EAAA,EAAC,CAAC;AAAA,QAAK,KAAC,kBAAA;AAAA;;;;;;;;;;AAA7D,aAA2I,QAAA,IAAA,MAAA;;AAA1D,aAAqD,IAAA,IAAA;;;;AAA9G;AAAA;AAAA,QAAAD,KAAmB,CAAA;AAAA;AAAA,UAAGA,KAAO,EAAA,EAAC,CAAC;AAAA,YAAK;AAAA,QAAC;;;;;;;;;;;AAA2B,UAAA;AAAA,MAAA,MAAA,eAAA;AAAA,OAAAA,KAAmB,CAAA;AAAA;AAAA,QAAGA,KAAO,EAAA,EAAC,CAAC;AAAA,WAAM,KAAC,IAAA,UAAA,KAAA,SAAA;AAAA;;;;;;;;;;;;;;;;;AAAhE,aAAc,QAAA,MAAA,MAAA;AAAA;;;;;;;;;;;;;;;;AAAiW,aAAc,QAAA,MAAA,MAAA;AAAA;;;;;;;;;;;;;IAAzkC,IAAO,EAAA,EAAC,CAAC,EAAE,QAAK;AAAA;;;;;;;;;;kBAAyyB;AAAA;AAAA,IAAO,IAAmB,CAAA;AAAA;AAAA,MAAG,QAAQ,CAAC;AAAA,IAAA;AAAA,EAAA,KAAO,KAAK;AAAA;AAAA,IAAO,IAAI,CAAA,EAAC,OAAO;AAAA;AAAA,MAAU,QAAQ,CAAC;AAAA,IAAA,GAAI,SAAS;AAAA,EAAC,IAAA;;;gBAAsC,aAAa;AAAA;AAAA,IAAO,IAAI,CAAA,EAAC,OAAO;AAAA;AAAA,MAAU,IAAO,EAAA,EAAC,CAAC;AAAA,OAAI;AAAA,EAAK,KAAK;AAAA;AAAA,IAAO,IAAmB,CAAA;AAAA;AAAA,MAAG,IAAO,EAAA,EAAC,CAAC;AAAA,IAAA;AAAA,EAAA,KAAO,EAAC,IAAK;;iBAA4B,aAAa;AAAA;AAAA,IAAO,OAAK,OAAO;AAAA;AAAA,MAAU,IAAO,EAAA,EAAC,CAAC;AAAA,IAAA,GAAI;AAAA,EAAK,KAAK;AAAA;AAAA,IAAO;;MAAsB,IAAO,EAAA,EAAC,CAAC;AAAA,IAAA;AAAA,EAAA,KAAO,EAAC,IAAA;;;;;;;;AAAj/B,MAAA;AAAA;AAAA,IAAA;IAAa,IAAS,CAAA,KAAA,kBAAA,GAAA;AAAA;AAAqY,MAAA,YAAA,OAAO,IAAI,cAAc,UAAM,kBAAA,GAAA;;;;;;;;;;;;;;;;;;;;;;;MAA5jB,IAAU,CAAA,IAAA,oBAAA;;;;MAAkC,IAAI,CAAA,EAAC,OAAO;AAAA;AAAA,QAAU,IAAO,EAAA,EAAC,CAAC;AAAA,MAAA,GAAI;AAAe,WAAA,OAAA,QAAA;AAAA,MAAA,QAAQ,CAAC,CAAA;AAAS,WAAA,OAAA,MAAA;AAAA,MAAA,QAAQ,CAAC,CAAA;;;;;;OAAijC,IAAa,CAAA;AAAA;AAAA,QAAC,IAAO,EAAA,EAAC,CAAC;AAAA,MAAA,IAAK,KAAK,YAAQ,oBAAA;AAAS,WAAA,KAAA,OAAAC,SAAE,cAAc,CAAA;;;;AAAt1C,aAAm6C,QAAA,IAAA,MAAA;AAA/5C,aAA2C,IAAA,GAAA;;AAAA,aAAmlB,IAAA,GAAA;AAAvjB,aAA4J,KAAA,KAAA;;;AAAglB,aAA+I,IAAA,GAAA;AAA5H,aAAuH,KAAA,KAAA;;AAAK,aAAsS,IAAA,GAAA;;AAArI,aAAgI,KAAA,KAAA;;AAAK,aAAkL,IAAA,GAAA;AAA/J,aAA0J,KAAA,GAAA;AAAjC,aAA2B,KAAA,CAAA;;;;;YAA9C,IAAI,CAAA;AAAA;AAAA,cAAC,IAAO,EAAA,EAAC,CAAC;AAAA;YAAd,KAAI,CAAA;AAAA;AAAA,YAAC,IAAO,EAAA,EAAC,CAAC;AAAA,UAAA,EAAA,MAAA,MAAA,SAAA;AAAA;;;;;;;;MAA11C,IAAO,EAAA,EAAC,CAAC,EAAE,QAAK,IAAA,UAAA,IAAA,QAAA;;;MAAiE,IAAU,CAAA,IAAA,uBAAA;;;;;MAAkC,IAAI,CAAA,EAAC,OAAO;AAAA;AAAA,QAAU,IAAO,EAAA,EAAC,CAAC;AAAA,MAAA,GAAI,UAAK,MAAA,UAAA,mBAAA;;;AAAU,UAAA;AAAA,MAAA,KAAA,sBAAA;AAAA,MAAA,QAAQ,CAAC,IAAA;;;AAAS,UAAA;AAAA,MAAA,KAAA,oBAAA;AAAA,MAAA,QAAQ,CAAC,IAAA;;;AAAS;AAAA;AAAA,QAAA;QAAa,IAAS,CAAA;AAAA,QAAA;;;;;;;;;;;;AAAqY,UAAA,OAAO,IAAI,cAAc,OAAM,WAAA,EAAA,KAAA,KAAA;;uCAA4K;AAAA;AAAA,QAAO,IAAmB,CAAA;AAAA;AAAA,UAAG,QAAQ,CAAC;AAAA,QAAA;AAAA,MAAA,KAAO,KAAK;AAAA;AAAA,QAAO,IAAI,CAAA,EAAC,OAAO;AAAA;AAAA,UAAU,QAAQ,CAAC;AAAA,QAAA,GAAI,SAAS;AAAA,MAAC,IAAA,IAAA,UAAA,IAAA,QAAA;;qBAAsC,aAAa;AAAA;AAAA,QAAO,IAAI,CAAA,EAAC,OAAO;AAAA;AAAA,UAAU,IAAO,EAAA,EAAC,CAAC;AAAA,WAAI;AAAA,MAAK,KAAK;AAAA;AAAA,QAAO,IAAmB,CAAA;AAAA;AAAA,UAAG,IAAO,EAAA,EAAC,CAAC;AAAA,QAAA;AAAA,MAAA,KAAO,EAAC,IAAK;;;;;;;;;;;;;sCAA4B,aAAa;AAAA;AAAA,QAAO,OAAK,OAAO;AAAA;AAAA,UAAU,IAAO,EAAA,EAAC,CAAC;AAAA,QAAA,GAAI;AAAA,MAAK,KAAK;AAAA;AAAA,QAAO;;UAAsB,IAAO,EAAA,EAAC,CAAC;AAAA,QAAA;AAAA,MAAA,KAAO,EAAC,IAAA,IAAA,UAAA,IAAA,QAAA;;;OAAuD,IAAa,CAAA;AAAA;AAAA,QAAC,IAAO,EAAA,EAAC,CAAC;AAAA,MAAA,IAAK,KAAK,YAAQ,uBAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;AAA3hD,MAAA,WAAA,OAAO,IAAI,cAAc,UAAM,kBAAA;;;IAAwJ,IAAoB,CAAA;AAAA,EAAA;;iCAAzB,QAAI,KAAA,GAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAA5S,aAAmxD,QAAA,KAAA,MAAA;AAAhvD,aAA2uD,KAAA,KAAA;AAApuD,aAAqP,OAAA,KAAA;AAA9O,aAAsO,OAAA,EAAA;AAAlO,aAAgC,IAAA,GAAA;AAAA,aAA4B,IAAA,GAAA;;AAAwE,aAA6B,IAAA,GAAA;AAAA,aAA2B,IAAA,GAAA;AAAA,aAAiC,IAAA,GAAA;AAAa,aAAu+C,OAAA,KAAA;;;;;;;;;;;;UAAz9CD,KAAoB,CAAA;AAAA,QAAA;;mCAAzB,QAAI,KAAA,GAAA;;;;;;;;;;;;;wCAAJ;AAAA;;;;;;;;;;;;;;;;;;;;;;;;AA9F3R,MAAA,EAAA,WAAW,MAAK,IAAA;AAEV,wBAAqB;AAChC,QAAA,MAAM,YAAY,WAAW,MAAM;;AAClB,SAAO,SAAS,aAAa,GAAG;AACnD,MAAA,SAAS;iBAEE,YAAYE,OAAM,OAAK;AAChC,QAAA,MAAM,OAAO,QAAQ,UAAU;AAC/B,QAAA,MAAM,OAAO,QAAQ,WAAW;UAC9B,UAAO;AAAA,MACX,QAAM;AAAA,QAAI,WAAS;AAAA,WAAKA,KAAI,GAAA,EAAK,OAAO,OAAO,MAAM,OAAO,KAAK,EAAA;AAAA;;;UAE7D,KAAK,aAAa,OAAO;AAE3B,QAAA,KAAK,QAAM;AACb,WAAK,OAAM;AAAA;;iBAIA,cAAcA,OAAM,WAAS;UACpC,YAAY,OAAO,KAAK,KAAK,OAAO,SAAS;AAC7C,UAAA,QAAQ,UAAU,QAAQA,KAAI;AAEhC,QAAA,cAAc,KAAK,QAAQ,GAAC;AAExB,YAAA,cAAc,UAAU,QAAQ,CAAC;YACjC,UAAO;AAAA,QACX,QAAM;AAAA,UACJ,WAAS;AAAA,aACNA,KAAI,GAAA;AAAA,cAAK,OAAO,KAAK,OAAO,UAAU,WAAW,EAAE;AAAA;aACnD,WAAW,GAAA,EAAK,OAAO,KAAK,OAAO,UAAUA,KAAI,EAAE,MAAK;AAAA;;;YAIzD,KAAK,aAAa,OAAO;AAE3B,UAAA,KAAK,QAAM;AACb,aAAK,OAAM;AAAA;eAEJ,cAAS,MAAW,QAAQ,UAAU,SAAS,GAAC;AAEnD,YAAA,cAAc,UAAU,QAAQ,CAAC;YACjC,UAAO;AAAA,QACX,QAAM;AAAA,UACJ,WAAS;AAAA,aACNA,KAAI,GAAA;AAAA,cAAK,OAAO,KAAK,OAAO,UAAU,WAAW,EAAE;AAAA;aACnD,WAAW,GAAA,EAAK,OAAO,KAAK,OAAO,UAAUA,KAAI,EAAE,MAAK;AAAA;;;YAIzD,KAAK,aAAa,OAAO;AAE3B,UAAA,KAAK,QAAM;AACb,aAAK,OAAM;AAAA;;;AAKF,iBAAA,KAAKA,OAAI;AAChB,UAAAC,QAAI,MAAA,IAAa,KAAK,OAAO,EAAE,SAAQ;AACvC,UAAAA,MAAK,UAAS;kCAEpB,gBAAa,CAAI,gBAAa,CAAA,IAAQ,eAAa,aAAA;AACnD,oBAAA,cAAA,cAAcD,KAAI,IAAIC,MAAK,OAAK,aAAA;UAG1B,UAAO;AAAA,MACX,QAAM;AAAA,QAAI,WAAS,EAAA,CAAKD,KAAI,GAAA,EAAK,OAAO,OAAOC,MAAK,KAAK,EAAA,EAAA;AAAA;;UAErD,KAAK,aAAa,OAAO;AAE3B,QAAA,KAAK,QAAM;AACb,WAAK,OAAM;AAAA;;AAef,UAAO,YAAA;AACL,cAAU,KAAK,SAAS,IAAI,WAAW,oBAAoB;oBAC3D,YAAY,KAAK,SAAS,IAAI,WAAW,iCAAiC,CAAA;AAAA;;;;;;;sBAZzE,uBAAuB,OAAO,QAAQ,eAAe,CAAA;AAAA;;;AAEvD,mBAAA,GAAE,sBACD,OAAO,aAAa,QAAQ,0BAA0B,CAAC,EAAE,eACrD,KAAK;AAAA;;;AACV,mBAAA,GAAE,YAAY,qBAAqB,MACjC,aAAY,cAAc,QAAQ,CAAC,OAAO,MAAS,CAAA;AAAA;;;AAErD,mBAAA,GAAE,aAAa,aAAa,YAAY,SAAS,QAAQ;AAAA;;AATzD,eAAA,IAAE,kBAAkB,KAAK,OAAO,OAAO,SAAS;;;;;;;;;;;;;;;;;;;;;;;"}