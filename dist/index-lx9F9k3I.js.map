{"version":3,"file":"index-lx9F9k3I.js","sources":["../src/helpers/constants.ts","../node_modules/svelte/src/runtime/internal/utils.js","../node_modules/svelte/src/runtime/internal/environment.js","../node_modules/svelte/src/runtime/internal/loop.js","../node_modules/svelte/src/runtime/internal/dom.js","../node_modules/svelte/src/runtime/internal/style_manager.js","../node_modules/svelte/src/runtime/internal/lifecycle.js","../node_modules/svelte/src/runtime/internal/scheduler.js","../node_modules/svelte/src/runtime/internal/transitions.js","../node_modules/svelte/src/runtime/internal/each.js","../node_modules/svelte/src/runtime/internal/spread.js","../node_modules/svelte/src/runtime/internal/Component.js","../node_modules/svelte/src/shared/version.js","../node_modules/svelte/src/runtime/store/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/store/util/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/util/object/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/util/browser/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/store/fvtt/settings/index.js","../src/plugins/donation-tracker/index.js","../src/stores/storeDefinitions.js","../src/stores/equipmentGold.js","../src/stores/goldChoices.js","../src/stores/startingEquipment.js","../node_modules/finity/lib/utils/mapValues.js","../node_modules/finity/lib/configuration/BaseConfigurator.js","../node_modules/finity/lib/configuration/GlobalConfigurator.js","../node_modules/finity/lib/configuration/TransitionConfigurator.js","../node_modules/finity/lib/configuration/TriggerConfigurator.js","../node_modules/finity/lib/configuration/TimerConfigurator.js","../node_modules/finity/lib/configuration/AsyncActionConfigurator.js","../node_modules/finity/lib/configuration/StateConfigurator.js","../node_modules/finity/lib/utils/invokeEach.js","../node_modules/finity/lib/utils/merge.js","../node_modules/finity/lib/core/StateMachine.js","../node_modules/finity/lib/core/TaskScheduler.js","../node_modules/finity/lib/core/HierarchicalStateMachine.js","../node_modules/finity/lib/configuration/StateMachineConfigurator.js","../node_modules/finity/lib/configuration/delegateToAncestor.js","../node_modules/finity/lib/configuration/index.js","../node_modules/finity/lib/Finity.js","../node_modules/finity/lib/index.js","../src/helpers/LevelUpStateMachine.js","../src/stores/spellSelection.js","../src/lib/workflow.js","../src/helpers/WorkflowStateMachine.js","../src/helpers/AdvancementManager.js","../src/stores/advancements.js","../src/stores/equipmentSelections.js","../src/stores/index.js","../src/helpers/Utility.js","../src/settings/DonationTrackerGameSettings.js","../src/usage-tracking.js","../node_modules/svelte/src/runtime/internal/disclose-version/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/util/dom/style/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/component/application/cssVariables.js","../node_modules/@typhonjs-fvtt/runtime/_dist/util/dom/observer/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/action/dom/observer/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/action/dom/style/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/action/util/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/store/web-storage/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/store/writable-derived/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/util/index.js","../node_modules/svelte/src/runtime/easing/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/easing/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/util/a11y/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/math/util/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/math/interpolate/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/math/gl-matrix/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/util/animate/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/store/position/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/util/i18n/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/application/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/transition/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/component/application/AppShellContextInternal.js","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/component/application/TJSHeaderButton.svelte","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/component/application/TJSApplicationHeader.svelte","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/component/application/ResizeHandleTransform.js","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/component/application/ResizableHandle.svelte","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/component/internal/dom/TJSFocusWrap.svelte","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/component/application/ApplicationShell.svelte","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/component/application/TJSApplicationShell.svelte","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/component/application/index.js","../src/helpers/svelte-actions/PreventDefault.js","../node_modules/@typhonjs-fvtt/runtime/_dist/util/index.js","../node_modules/@typhonjs-fvtt/standard/_dist/action/animate/composable/index.js","../src/components/molecules/Tabs.svelte","../src/stores/progress.js","../src/stores/equipmentShop.js","../src/components/molecules/ProgressBar.svelte","../node_modules/@typhonjs-fvtt/standard/_dist/fvtt/index.js","../node_modules/@typhonjs-fvtt/standard/_dist/component/internal/FVTTConfigure.js","../src/components/molecules/Footer.svelte","../src/app/PCAppShell.svelte","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/store/reducer/index.js","../node_modules/@typhonjs-fvtt/runtime/_dist/svelte/store/fvtt/document/index.js","../src/app/PCApplication.js","../src/plugins/level-up/index.js","../src/settings/compendiumSourcesSubmenu.js","../src/settings/DonationTrackerSettingsAppShell.svelte","../src/settings/DonationTrackerSettingsApp.js","../src/settings/DonationTrackerSettingsButton.js","../src/settings/index.ts","../src/plugins/equipment-purchase/index.js","../src/plugins/subclass-level/index.js","../src/plugins/spell-lists/index.js","../src/app/WelcomeAppShell.svelte","../src/app/WelcomeApplication.js","../src/hooks/init.js","../src/components/molecules/dnd5e/Feats/FeatSelector.svelte","../src/hooks/captureAdvancement.js","../src/hooks/advancementManager.js","../src/hooks/renderCompendium.js","../src/hooks/actorStudioStartButtons.js","../src/index.js"],"sourcesContent":["// Class for general global variables.\n\nexport const MODULE_ID = 'foundryvtt-actor-studio';\nexport const MODULE_CODE = 'GAS';\nexport const MODULE_TITLE = 'Actor Studio';\nexport const MYSTERY_MAN = 'icons/svg/mystery-man.svg';\nexport const NONE_ICON = 'icons/svg/cancel.svg';\nexport const LOG_PREFIX = 'ACTOR STUDIO |';\nexport const LOG_PREFIX_COLOR = `%c[${MODULE_CODE}] |`;\n\nexport const LOG_STYLES = {\n  go: 'color: goldenrod;',\n  q: 'color: aqua;',\n  p: 'color: purple;',\n  s: 'color: steelblue;',\n  g: 'color: green;',\n  r: 'color: red;',\n  o: 'color: orange;',\n  b: 'color: blue;',\n  y: 'color: yellow;',\n  c: 'color: cyan;',\n  m: 'color: magenta;',\n  gr: 'color: gray;',\n  br: 'color: brown;',\n  pi: 'color: pink;',\n  t: 'color: teal;'\n};\n\nexport const enum DEFAULT_PACKS {\n  RACES = 'dnd5e.races',\n  RACE_FEATURES = 'dnd5e.races',\n  CLASSES = 'dnd5e.classes',\n  CLASS_FEATURES = 'dnd5e.classfeatures',\n  SUBCLASSES = 'dnd5e.subclasses',\n  ITEMS = 'dnd5e.items',\n  SPELLS = 'dnd5e.spells',\n  RULES = 'dnd5e.rules',\n  BACKGROUNDS = 'dnd5e.backgrounds',\n  FEATS = 'dnd5e.feats24',\n}\n\nexport const sessionConstants = {\n  appState: `${MODULE_ID}.settings.appState`\n};\n\nexport const DEFAULT_SOURCES = {\n  races: [DEFAULT_PACKS.RACES],\n  racialFeatures: [DEFAULT_PACKS.RACE_FEATURES],\n  classes: [DEFAULT_PACKS.CLASSES],\n  subclasses: [DEFAULT_PACKS.SUBCLASSES],\n  backgrounds: [DEFAULT_PACKS.BACKGROUNDS],\n  spells: [DEFAULT_PACKS.SPELLS],\n  feats: [DEFAULT_PACKS.FEATS],\n  items: [DEFAULT_PACKS.ITEMS],\n};\n\nexport const INTEGRATION = {\n  TOKENIZER: {\n    VERSION: '3.3.0',\n  },\n};\n\nexport const MERGE_OPTIONS = {\n  insertKeys: true,\n  insertValues: true,\n  overwrite: true,\n  recursive: true,\n  inplace: false,\n};\n\nexport const POINT_BUY_COSTS = {\n  8: 0,\n  9: 1,\n  10: 2,\n  11: 3,\n  12: 4,\n  13: 5,\n  14: 7,\n  15: 9\n}\n\nexport const STANDARD_ARRAY = {\n  str: 15, \n  dex: 14, \n  con: 13, \n  int: 12, \n  wis: 10, \n  cha: 8\n};\n\nexport type CLASS_LEVEL = 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20;\n\n","/** @returns {void} */\nexport function noop() {}\n\nexport const identity = (x) => x;\n\n/**\n * @template T\n * @template S\n * @param {T} tar\n * @param {S} src\n * @returns {T & S}\n */\nexport function assign(tar, src) {\n\t// @ts-ignore\n\tfor (const k in src) tar[k] = src[k];\n\treturn /** @type {T & S} */ (tar);\n}\n\n// Adapted from https://github.com/then/is-promise/blob/master/index.js\n// Distributed under MIT License https://github.com/then/is-promise/blob/master/LICENSE\n/**\n * @param {any} value\n * @returns {value is PromiseLike<any>}\n */\nexport function is_promise(value) {\n\treturn (\n\t\t!!value &&\n\t\t(typeof value === 'object' || typeof value === 'function') &&\n\t\ttypeof (/** @type {any} */ (value).then) === 'function'\n\t);\n}\n\n/** @returns {void} */\nexport function add_location(element, file, line, column, char) {\n\telement.__svelte_meta = {\n\t\tloc: { file, line, column, char }\n\t};\n}\n\nexport function run(fn) {\n\treturn fn();\n}\n\nexport function blank_object() {\n\treturn Object.create(null);\n}\n\n/**\n * @param {Function[]} fns\n * @returns {void}\n */\nexport function run_all(fns) {\n\tfns.forEach(run);\n}\n\n/**\n * @param {any} thing\n * @returns {thing is Function}\n */\nexport function is_function(thing) {\n\treturn typeof thing === 'function';\n}\n\n/** @returns {boolean} */\nexport function safe_not_equal(a, b) {\n\treturn a != a ? b == b : a !== b || (a && typeof a === 'object') || typeof a === 'function';\n}\n\nlet src_url_equal_anchor;\n\n/**\n * @param {string} element_src\n * @param {string} url\n * @returns {boolean}\n */\nexport function src_url_equal(element_src, url) {\n\tif (element_src === url) return true;\n\tif (!src_url_equal_anchor) {\n\t\tsrc_url_equal_anchor = document.createElement('a');\n\t}\n\t// This is actually faster than doing URL(..).href\n\tsrc_url_equal_anchor.href = url;\n\treturn element_src === src_url_equal_anchor.href;\n}\n\n/** @param {string} srcset */\nfunction split_srcset(srcset) {\n\treturn srcset.split(',').map((src) => src.trim().split(' ').filter(Boolean));\n}\n\n/**\n * @param {HTMLSourceElement | HTMLImageElement} element_srcset\n * @param {string | undefined | null} srcset\n * @returns {boolean}\n */\nexport function srcset_url_equal(element_srcset, srcset) {\n\tconst element_urls = split_srcset(element_srcset.srcset);\n\tconst urls = split_srcset(srcset || '');\n\n\treturn (\n\t\turls.length === element_urls.length &&\n\t\turls.every(\n\t\t\t([url, width], i) =>\n\t\t\t\twidth === element_urls[i][1] &&\n\t\t\t\t// We need to test both ways because Vite will create an a full URL with\n\t\t\t\t// `new URL(asset, import.meta.url).href` for the client when `base: './'`, and the\n\t\t\t\t// relative URLs inside srcset are not automatically resolved to absolute URLs by\n\t\t\t\t// browsers (in contrast to img.src). This means both SSR and DOM code could\n\t\t\t\t// contain relative or absolute URLs.\n\t\t\t\t(src_url_equal(element_urls[i][0], url) || src_url_equal(url, element_urls[i][0]))\n\t\t)\n\t);\n}\n\n/** @returns {boolean} */\nexport function not_equal(a, b) {\n\treturn a != a ? b == b : a !== b;\n}\n\n/** @returns {boolean} */\nexport function is_empty(obj) {\n\treturn Object.keys(obj).length === 0;\n}\n\n/** @returns {void} */\nexport function validate_store(store, name) {\n\tif (store != null && typeof store.subscribe !== 'function') {\n\t\tthrow new Error(`'${name}' is not a store with a 'subscribe' method`);\n\t}\n}\n\nexport function subscribe(store, ...callbacks) {\n\tif (store == null) {\n\t\tfor (const callback of callbacks) {\n\t\t\tcallback(undefined);\n\t\t}\n\t\treturn noop;\n\t}\n\tconst unsub = store.subscribe(...callbacks);\n\treturn unsub.unsubscribe ? () => unsub.unsubscribe() : unsub;\n}\n\n/**\n * Get the current value from a store by subscribing and immediately unsubscribing.\n *\n * https://svelte.dev/docs/svelte-store#get\n * @template T\n * @param {import('../store/public.js').Readable<T>} store\n * @returns {T}\n */\nexport function get_store_value(store) {\n\tlet value;\n\tsubscribe(store, (_) => (value = _))();\n\treturn value;\n}\n\n/** @returns {void} */\nexport function component_subscribe(component, store, callback) {\n\tcomponent.$$.on_destroy.push(subscribe(store, callback));\n}\n\nexport function create_slot(definition, ctx, $$scope, fn) {\n\tif (definition) {\n\t\tconst slot_ctx = get_slot_context(definition, ctx, $$scope, fn);\n\t\treturn definition[0](slot_ctx);\n\t}\n}\n\nfunction get_slot_context(definition, ctx, $$scope, fn) {\n\treturn definition[1] && fn ? assign($$scope.ctx.slice(), definition[1](fn(ctx))) : $$scope.ctx;\n}\n\nexport function get_slot_changes(definition, $$scope, dirty, fn) {\n\tif (definition[2] && fn) {\n\t\tconst lets = definition[2](fn(dirty));\n\t\tif ($$scope.dirty === undefined) {\n\t\t\treturn lets;\n\t\t}\n\t\tif (typeof lets === 'object') {\n\t\t\tconst merged = [];\n\t\t\tconst len = Math.max($$scope.dirty.length, lets.length);\n\t\t\tfor (let i = 0; i < len; i += 1) {\n\t\t\t\tmerged[i] = $$scope.dirty[i] | lets[i];\n\t\t\t}\n\t\t\treturn merged;\n\t\t}\n\t\treturn $$scope.dirty | lets;\n\t}\n\treturn $$scope.dirty;\n}\n\n/** @returns {void} */\nexport function update_slot_base(\n\tslot,\n\tslot_definition,\n\tctx,\n\t$$scope,\n\tslot_changes,\n\tget_slot_context_fn\n) {\n\tif (slot_changes) {\n\t\tconst slot_context = get_slot_context(slot_definition, ctx, $$scope, get_slot_context_fn);\n\t\tslot.p(slot_context, slot_changes);\n\t}\n}\n\n/** @returns {void} */\nexport function update_slot(\n\tslot,\n\tslot_definition,\n\tctx,\n\t$$scope,\n\tdirty,\n\tget_slot_changes_fn,\n\tget_slot_context_fn\n) {\n\tconst slot_changes = get_slot_changes(slot_definition, $$scope, dirty, get_slot_changes_fn);\n\tupdate_slot_base(slot, slot_definition, ctx, $$scope, slot_changes, get_slot_context_fn);\n}\n\n/** @returns {any[] | -1} */\nexport function get_all_dirty_from_scope($$scope) {\n\tif ($$scope.ctx.length > 32) {\n\t\tconst dirty = [];\n\t\tconst length = $$scope.ctx.length / 32;\n\t\tfor (let i = 0; i < length; i++) {\n\t\t\tdirty[i] = -1;\n\t\t}\n\t\treturn dirty;\n\t}\n\treturn -1;\n}\n\n/** @returns {{}} */\nexport function exclude_internal_props(props) {\n\tconst result = {};\n\tfor (const k in props) if (k[0] !== '$') result[k] = props[k];\n\treturn result;\n}\n\n/** @returns {{}} */\nexport function compute_rest_props(props, keys) {\n\tconst rest = {};\n\tkeys = new Set(keys);\n\tfor (const k in props) if (!keys.has(k) && k[0] !== '$') rest[k] = props[k];\n\treturn rest;\n}\n\n/** @returns {{}} */\nexport function compute_slots(slots) {\n\tconst result = {};\n\tfor (const key in slots) {\n\t\tresult[key] = true;\n\t}\n\treturn result;\n}\n\n/** @returns {(this: any, ...args: any[]) => void} */\nexport function once(fn) {\n\tlet ran = false;\n\treturn function (...args) {\n\t\tif (ran) return;\n\t\tran = true;\n\t\tfn.call(this, ...args);\n\t};\n}\n\nexport function null_to_empty(value) {\n\treturn value == null ? '' : value;\n}\n\nexport function set_store_value(store, ret, value) {\n\tstore.set(value);\n\treturn ret;\n}\n\nexport const has_prop = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop);\n\nexport function action_destroyer(action_result) {\n\treturn action_result && is_function(action_result.destroy) ? action_result.destroy : noop;\n}\n\n/** @param {number | string} value\n * @returns {[number, string]}\n */\nexport function split_css_unit(value) {\n\tconst split = typeof value === 'string' && value.match(/^\\s*(-?[\\d.]+)([^\\s]*)\\s*$/);\n\treturn split ? [parseFloat(split[1]), split[2] || 'px'] : [/** @type {number} */ (value), 'px'];\n}\n\nexport const contenteditable_truthy_values = ['', true, 1, 'true', 'contenteditable'];\n","import { noop } from './utils.js';\n\nexport const is_client = typeof window !== 'undefined';\n\n/** @type {() => number} */\nexport let now = is_client ? () => window.performance.now() : () => Date.now();\n\nexport let raf = is_client ? (cb) => requestAnimationFrame(cb) : noop;\n\n// used internally for testing\n/** @returns {void} */\nexport function set_now(fn) {\n\tnow = fn;\n}\n\n/** @returns {void} */\nexport function set_raf(fn) {\n\traf = fn;\n}\n","import { raf } from './environment.js';\n\nconst tasks = new Set();\n\n/**\n * @param {number} now\n * @returns {void}\n */\nfunction run_tasks(now) {\n\ttasks.forEach((task) => {\n\t\tif (!task.c(now)) {\n\t\t\ttasks.delete(task);\n\t\t\ttask.f();\n\t\t}\n\t});\n\tif (tasks.size !== 0) raf(run_tasks);\n}\n\n/**\n * For testing purposes only!\n * @returns {void}\n */\nexport function clear_loops() {\n\ttasks.clear();\n}\n\n/**\n * Creates a new task that runs on each raf frame\n * until it returns a falsy value or is aborted\n * @param {import('./private.js').TaskCallback} callback\n * @returns {import('./private.js').Task}\n */\nexport function loop(callback) {\n\t/** @type {import('./private.js').TaskEntry} */\n\tlet task;\n\tif (tasks.size === 0) raf(run_tasks);\n\treturn {\n\t\tpromise: new Promise((fulfill) => {\n\t\t\ttasks.add((task = { c: callback, f: fulfill }));\n\t\t}),\n\t\tabort() {\n\t\t\ttasks.delete(task);\n\t\t}\n\t};\n}\n","import { contenteditable_truthy_values, has_prop } from './utils.js';\n\nimport { ResizeObserverSingleton } from './ResizeObserverSingleton.js';\n\n// Track which nodes are claimed during hydration. Unclaimed nodes can then be removed from the DOM\n// at the end of hydration without touching the remaining nodes.\nlet is_hydrating = false;\n\n/**\n * @returns {void}\n */\nexport function start_hydrating() {\n\tis_hydrating = true;\n}\n\n/**\n * @returns {void}\n */\nexport function end_hydrating() {\n\tis_hydrating = false;\n}\n\n/**\n * @param {number} low\n * @param {number} high\n * @param {(index: number) => number} key\n * @param {number} value\n * @returns {number}\n */\nfunction upper_bound(low, high, key, value) {\n\t// Return first index of value larger than input value in the range [low, high)\n\twhile (low < high) {\n\t\tconst mid = low + ((high - low) >> 1);\n\t\tif (key(mid) <= value) {\n\t\t\tlow = mid + 1;\n\t\t} else {\n\t\t\thigh = mid;\n\t\t}\n\t}\n\treturn low;\n}\n\n/**\n * @param {NodeEx} target\n * @returns {void}\n */\nfunction init_hydrate(target) {\n\tif (target.hydrate_init) return;\n\ttarget.hydrate_init = true;\n\t// We know that all children have claim_order values since the unclaimed have been detached if target is not <head>\n\n\tlet children = /** @type {ArrayLike<NodeEx2>} */ (target.childNodes);\n\t// If target is <head>, there may be children without claim_order\n\tif (target.nodeName === 'HEAD') {\n\t\tconst my_children = [];\n\t\tfor (let i = 0; i < children.length; i++) {\n\t\t\tconst node = children[i];\n\t\t\tif (node.claim_order !== undefined) {\n\t\t\t\tmy_children.push(node);\n\t\t\t}\n\t\t}\n\t\tchildren = my_children;\n\t}\n\t/*\n\t * Reorder claimed children optimally.\n\t * We can reorder claimed children optimally by finding the longest subsequence of\n\t * nodes that are already claimed in order and only moving the rest. The longest\n\t * subsequence of nodes that are claimed in order can be found by\n\t * computing the longest increasing subsequence of .claim_order values.\n\t *\n\t * This algorithm is optimal in generating the least amount of reorder operations\n\t * possible.\n\t *\n\t * Proof:\n\t * We know that, given a set of reordering operations, the nodes that do not move\n\t * always form an increasing subsequence, since they do not move among each other\n\t * meaning that they must be already ordered among each other. Thus, the maximal\n\t * set of nodes that do not move form a longest increasing subsequence.\n\t */\n\t// Compute longest increasing subsequence\n\t// m: subsequence length j => index k of smallest value that ends an increasing subsequence of length j\n\tconst m = new Int32Array(children.length + 1);\n\t// Predecessor indices + 1\n\tconst p = new Int32Array(children.length);\n\tm[0] = -1;\n\tlet longest = 0;\n\tfor (let i = 0; i < children.length; i++) {\n\t\tconst current = children[i].claim_order;\n\t\t// Find the largest subsequence length such that it ends in a value less than our current value\n\t\t// upper_bound returns first greater value, so we subtract one\n\t\t// with fast path for when we are on the current longest subsequence\n\t\tconst seq_len =\n\t\t\t(longest > 0 && children[m[longest]].claim_order <= current\n\t\t\t\t? longest + 1\n\t\t\t\t: upper_bound(1, longest, (idx) => children[m[idx]].claim_order, current)) - 1;\n\t\tp[i] = m[seq_len] + 1;\n\t\tconst new_len = seq_len + 1;\n\t\t// We can guarantee that current is the smallest value. Otherwise, we would have generated a longer sequence.\n\t\tm[new_len] = i;\n\t\tlongest = Math.max(new_len, longest);\n\t}\n\t// The longest increasing subsequence of nodes (initially reversed)\n\n\t/**\n\t * @type {NodeEx2[]}\n\t */\n\tconst lis = [];\n\t// The rest of the nodes, nodes that will be moved\n\n\t/**\n\t * @type {NodeEx2[]}\n\t */\n\tconst to_move = [];\n\tlet last = children.length - 1;\n\tfor (let cur = m[longest] + 1; cur != 0; cur = p[cur - 1]) {\n\t\tlis.push(children[cur - 1]);\n\t\tfor (; last >= cur; last--) {\n\t\t\tto_move.push(children[last]);\n\t\t}\n\t\tlast--;\n\t}\n\tfor (; last >= 0; last--) {\n\t\tto_move.push(children[last]);\n\t}\n\tlis.reverse();\n\t// We sort the nodes being moved to guarantee that their insertion order matches the claim order\n\tto_move.sort((a, b) => a.claim_order - b.claim_order);\n\t// Finally, we move the nodes\n\tfor (let i = 0, j = 0; i < to_move.length; i++) {\n\t\twhile (j < lis.length && to_move[i].claim_order >= lis[j].claim_order) {\n\t\t\tj++;\n\t\t}\n\t\tconst anchor = j < lis.length ? lis[j] : null;\n\t\ttarget.insertBefore(to_move[i], anchor);\n\t}\n}\n\n/**\n * @param {Node} target\n * @param {Node} node\n * @returns {void}\n */\nexport function append(target, node) {\n\ttarget.appendChild(node);\n}\n\n/**\n * @param {Node} target\n * @param {string} style_sheet_id\n * @param {string} styles\n * @returns {void}\n */\nexport function append_styles(target, style_sheet_id, styles) {\n\tconst append_styles_to = get_root_for_style(target);\n\tif (!append_styles_to.getElementById(style_sheet_id)) {\n\t\tconst style = element('style');\n\t\tstyle.id = style_sheet_id;\n\t\tstyle.textContent = styles;\n\t\tappend_stylesheet(append_styles_to, style);\n\t}\n}\n\n/**\n * @param {Node} node\n * @returns {ShadowRoot | Document}\n */\nexport function get_root_for_style(node) {\n\tif (!node) return document;\n\tconst root = node.getRootNode ? node.getRootNode() : node.ownerDocument;\n\tif (root && /** @type {ShadowRoot} */ (root).host) {\n\t\treturn /** @type {ShadowRoot} */ (root);\n\t}\n\treturn node.ownerDocument;\n}\n\n/**\n * @param {Node} node\n * @returns {CSSStyleSheet}\n */\nexport function append_empty_stylesheet(node) {\n\tconst style_element = element('style');\n\t// For transitions to work without 'style-src: unsafe-inline' Content Security Policy,\n\t// these empty tags need to be allowed with a hash as a workaround until we move to the Web Animations API.\n\t// Using the hash for the empty string (for an empty tag) works in all browsers except Safari.\n\t// So as a workaround for the workaround, when we append empty style tags we set their content to /* empty */.\n\t// The hash 'sha256-9OlNO0DNEeaVzHL4RZwCLsBHA8WBQ8toBp/4F5XV2nc=' will then work even in Safari.\n\tstyle_element.textContent = '/* empty */';\n\tappend_stylesheet(get_root_for_style(node), style_element);\n\treturn style_element.sheet;\n}\n\n/**\n * @param {ShadowRoot | Document} node\n * @param {HTMLStyleElement} style\n * @returns {CSSStyleSheet}\n */\nfunction append_stylesheet(node, style) {\n\tappend(/** @type {Document} */ (node).head || node, style);\n\treturn style.sheet;\n}\n\n/**\n * @param {NodeEx} target\n * @param {NodeEx} node\n * @returns {void}\n */\nexport function append_hydration(target, node) {\n\tif (is_hydrating) {\n\t\tinit_hydrate(target);\n\t\tif (\n\t\t\ttarget.actual_end_child === undefined ||\n\t\t\t(target.actual_end_child !== null && target.actual_end_child.parentNode !== target)\n\t\t) {\n\t\t\ttarget.actual_end_child = target.firstChild;\n\t\t}\n\t\t// Skip nodes of undefined ordering\n\t\twhile (target.actual_end_child !== null && target.actual_end_child.claim_order === undefined) {\n\t\t\ttarget.actual_end_child = target.actual_end_child.nextSibling;\n\t\t}\n\t\tif (node !== target.actual_end_child) {\n\t\t\t// We only insert if the ordering of this node should be modified or the parent node is not target\n\t\t\tif (node.claim_order !== undefined || node.parentNode !== target) {\n\t\t\t\ttarget.insertBefore(node, target.actual_end_child);\n\t\t\t}\n\t\t} else {\n\t\t\ttarget.actual_end_child = node.nextSibling;\n\t\t}\n\t} else if (node.parentNode !== target || node.nextSibling !== null) {\n\t\ttarget.appendChild(node);\n\t}\n}\n\n/**\n * @param {Node} target\n * @param {Node} node\n * @param {Node} [anchor]\n * @returns {void}\n */\nexport function insert(target, node, anchor) {\n\ttarget.insertBefore(node, anchor || null);\n}\n\n/**\n * @param {NodeEx} target\n * @param {NodeEx} node\n * @param {NodeEx} [anchor]\n * @returns {void}\n */\nexport function insert_hydration(target, node, anchor) {\n\tif (is_hydrating && !anchor) {\n\t\tappend_hydration(target, node);\n\t} else if (node.parentNode !== target || node.nextSibling != anchor) {\n\t\ttarget.insertBefore(node, anchor || null);\n\t}\n}\n\n/**\n * @param {Node} node\n * @returns {void}\n */\nexport function detach(node) {\n\tif (node.parentNode) {\n\t\tnode.parentNode.removeChild(node);\n\t}\n}\n\n/**\n * @returns {void} */\nexport function destroy_each(iterations, detaching) {\n\tfor (let i = 0; i < iterations.length; i += 1) {\n\t\tif (iterations[i]) iterations[i].d(detaching);\n\t}\n}\n\n/**\n * @template {keyof HTMLElementTagNameMap} K\n * @param {K} name\n * @returns {HTMLElementTagNameMap[K]}\n */\nexport function element(name) {\n\treturn document.createElement(name);\n}\n\n/**\n * @template {keyof HTMLElementTagNameMap} K\n * @param {K} name\n * @param {string} is\n * @returns {HTMLElementTagNameMap[K]}\n */\nexport function element_is(name, is) {\n\treturn document.createElement(name, { is });\n}\n\n/**\n * @template T\n * @template {keyof T} K\n * @param {T} obj\n * @param {K[]} exclude\n * @returns {Pick<T, Exclude<keyof T, K>>}\n */\nexport function object_without_properties(obj, exclude) {\n\tconst target = /** @type {Pick<T, Exclude<keyof T, K>>} */ ({});\n\tfor (const k in obj) {\n\t\tif (\n\t\t\thas_prop(obj, k) &&\n\t\t\t// @ts-ignore\n\t\t\texclude.indexOf(k) === -1\n\t\t) {\n\t\t\t// @ts-ignore\n\t\t\ttarget[k] = obj[k];\n\t\t}\n\t}\n\treturn target;\n}\n\n/**\n * @template {keyof SVGElementTagNameMap} K\n * @param {K} name\n * @returns {SVGElement}\n */\nexport function svg_element(name) {\n\treturn document.createElementNS('http://www.w3.org/2000/svg', name);\n}\n\n/**\n * @param {string} data\n * @returns {Text}\n */\nexport function text(data) {\n\treturn document.createTextNode(data);\n}\n\n/**\n * @returns {Text} */\nexport function space() {\n\treturn text(' ');\n}\n\n/**\n * @returns {Text} */\nexport function empty() {\n\treturn text('');\n}\n\n/**\n * @param {string} content\n * @returns {Comment}\n */\nexport function comment(content) {\n\treturn document.createComment(content);\n}\n\n/**\n * @param {EventTarget} node\n * @param {string} event\n * @param {EventListenerOrEventListenerObject} handler\n * @param {boolean | AddEventListenerOptions | EventListenerOptions} [options]\n * @returns {() => void}\n */\nexport function listen(node, event, handler, options) {\n\tnode.addEventListener(event, handler, options);\n\treturn () => node.removeEventListener(event, handler, options);\n}\n\n/**\n * @returns {(event: any) => any} */\nexport function prevent_default(fn) {\n\treturn function (event) {\n\t\tevent.preventDefault();\n\t\t// @ts-ignore\n\t\treturn fn.call(this, event);\n\t};\n}\n\n/**\n * @returns {(event: any) => any} */\nexport function stop_propagation(fn) {\n\treturn function (event) {\n\t\tevent.stopPropagation();\n\t\t// @ts-ignore\n\t\treturn fn.call(this, event);\n\t};\n}\n\n/**\n * @returns {(event: any) => any} */\nexport function stop_immediate_propagation(fn) {\n\treturn function (event) {\n\t\tevent.stopImmediatePropagation();\n\t\t// @ts-ignore\n\t\treturn fn.call(this, event);\n\t};\n}\n\n/**\n * @returns {(event: any) => void} */\nexport function self(fn) {\n\treturn function (event) {\n\t\t// @ts-ignore\n\t\tif (event.target === this) fn.call(this, event);\n\t};\n}\n\n/**\n * @returns {(event: any) => void} */\nexport function trusted(fn) {\n\treturn function (event) {\n\t\t// @ts-ignore\n\t\tif (event.isTrusted) fn.call(this, event);\n\t};\n}\n\n/**\n * @param {Element} node\n * @param {string} attribute\n * @param {string} [value]\n * @returns {void}\n */\nexport function attr(node, attribute, value) {\n\tif (value == null) node.removeAttribute(attribute);\n\telse if (node.getAttribute(attribute) !== value) node.setAttribute(attribute, value);\n}\n/**\n * List of attributes that should always be set through the attr method,\n * because updating them through the property setter doesn't work reliably.\n * In the example of `width`/`height`, the problem is that the setter only\n * accepts numeric values, but the attribute can also be set to a string like `50%`.\n * If this list becomes too big, rethink this approach.\n */\nconst always_set_through_set_attribute = ['width', 'height'];\n\n/**\n * @param {Element & ElementCSSInlineStyle} node\n * @param {{ [x: string]: string }} attributes\n * @returns {void}\n */\nexport function set_attributes(node, attributes) {\n\t// @ts-ignore\n\tconst descriptors = Object.getOwnPropertyDescriptors(node.__proto__);\n\tfor (const key in attributes) {\n\t\tif (attributes[key] == null) {\n\t\t\tnode.removeAttribute(key);\n\t\t} else if (key === 'style') {\n\t\t\tnode.style.cssText = attributes[key];\n\t\t} else if (key === '__value') {\n\t\t\t/** @type {any} */ (node).value = node[key] = attributes[key];\n\t\t} else if (\n\t\t\tdescriptors[key] &&\n\t\t\tdescriptors[key].set &&\n\t\t\talways_set_through_set_attribute.indexOf(key) === -1\n\t\t) {\n\t\t\tnode[key] = attributes[key];\n\t\t} else {\n\t\t\tattr(node, key, attributes[key]);\n\t\t}\n\t}\n}\n\n/**\n * @param {Element & ElementCSSInlineStyle} node\n * @param {{ [x: string]: string }} attributes\n * @returns {void}\n */\nexport function set_svg_attributes(node, attributes) {\n\tfor (const key in attributes) {\n\t\tattr(node, key, attributes[key]);\n\t}\n}\n\n/**\n * @param {Record<string, unknown>} data_map\n * @returns {void}\n */\nexport function set_custom_element_data_map(node, data_map) {\n\tObject.keys(data_map).forEach((key) => {\n\t\tset_custom_element_data(node, key, data_map[key]);\n\t});\n}\n\n/**\n * @returns {void} */\nexport function set_custom_element_data(node, prop, value) {\n\tconst lower = prop.toLowerCase(); // for backwards compatibility with existing behavior we do lowercase first\n\tif (lower in node) {\n\t\tnode[lower] = typeof node[lower] === 'boolean' && value === '' ? true : value;\n\t} else if (prop in node) {\n\t\tnode[prop] = typeof node[prop] === 'boolean' && value === '' ? true : value;\n\t} else {\n\t\tattr(node, prop, value);\n\t}\n}\n\n/**\n * @param {string} tag\n */\nexport function set_dynamic_element_data(tag) {\n\treturn /-/.test(tag) ? set_custom_element_data_map : set_attributes;\n}\n\n/**\n * @returns {void}\n */\nexport function xlink_attr(node, attribute, value) {\n\tnode.setAttributeNS('http://www.w3.org/1999/xlink', attribute, value);\n}\n\n/**\n * @param {HTMLElement} node\n * @returns {string}\n */\nexport function get_svelte_dataset(node) {\n\treturn node.dataset.svelteH;\n}\n\n/**\n * @returns {unknown[]} */\nexport function get_binding_group_value(group, __value, checked) {\n\tconst value = new Set();\n\tfor (let i = 0; i < group.length; i += 1) {\n\t\tif (group[i].checked) value.add(group[i].__value);\n\t}\n\tif (!checked) {\n\t\tvalue.delete(__value);\n\t}\n\treturn Array.from(value);\n}\n\n/**\n * @param {HTMLInputElement[]} group\n * @returns {{ p(...inputs: HTMLInputElement[]): void; r(): void; }}\n */\nexport function init_binding_group(group) {\n\t/**\n\t * @type {HTMLInputElement[]} */\n\tlet _inputs;\n\treturn {\n\t\t/* push */ p(...inputs) {\n\t\t\t_inputs = inputs;\n\t\t\t_inputs.forEach((input) => group.push(input));\n\t\t},\n\t\t/* remove */ r() {\n\t\t\t_inputs.forEach((input) => group.splice(group.indexOf(input), 1));\n\t\t}\n\t};\n}\n\n/**\n * @param {number[]} indexes\n * @returns {{ u(new_indexes: number[]): void; p(...inputs: HTMLInputElement[]): void; r: () => void; }}\n */\nexport function init_binding_group_dynamic(group, indexes) {\n\t/**\n\t * @type {HTMLInputElement[]} */\n\tlet _group = get_binding_group(group);\n\n\t/**\n\t * @type {HTMLInputElement[]} */\n\tlet _inputs;\n\n\tfunction get_binding_group(group) {\n\t\tfor (let i = 0; i < indexes.length; i++) {\n\t\t\tgroup = group[indexes[i]] = group[indexes[i]] || [];\n\t\t}\n\t\treturn group;\n\t}\n\n\t/**\n\t * @returns {void} */\n\tfunction push() {\n\t\t_inputs.forEach((input) => _group.push(input));\n\t}\n\n\t/**\n\t * @returns {void} */\n\tfunction remove() {\n\t\t_inputs.forEach((input) => _group.splice(_group.indexOf(input), 1));\n\t}\n\treturn {\n\t\t/* update */ u(new_indexes) {\n\t\t\tindexes = new_indexes;\n\t\t\tconst new_group = get_binding_group(group);\n\t\t\tif (new_group !== _group) {\n\t\t\t\tremove();\n\t\t\t\t_group = new_group;\n\t\t\t\tpush();\n\t\t\t}\n\t\t},\n\t\t/* push */ p(...inputs) {\n\t\t\t_inputs = inputs;\n\t\t\tpush();\n\t\t},\n\t\t/* remove */ r: remove\n\t};\n}\n\n/** @returns {number} */\nexport function to_number(value) {\n\treturn value === '' ? null : +value;\n}\n\n/** @returns {any[]} */\nexport function time_ranges_to_array(ranges) {\n\tconst array = [];\n\tfor (let i = 0; i < ranges.length; i += 1) {\n\t\tarray.push({ start: ranges.start(i), end: ranges.end(i) });\n\t}\n\treturn array;\n}\n\n/**\n * @param {Element} element\n * @returns {ChildNode[]}\n */\nexport function children(element) {\n\treturn Array.from(element.childNodes);\n}\n\n/**\n * @param {ChildNodeArray} nodes\n * @returns {void}\n */\nfunction init_claim_info(nodes) {\n\tif (nodes.claim_info === undefined) {\n\t\tnodes.claim_info = { last_index: 0, total_claimed: 0 };\n\t}\n}\n\n/**\n * @template {ChildNodeEx} R\n * @param {ChildNodeArray} nodes\n * @param {(node: ChildNodeEx) => node is R} predicate\n * @param {(node: ChildNodeEx) => ChildNodeEx | undefined} process_node\n * @param {() => R} create_node\n * @param {boolean} dont_update_last_index\n * @returns {R}\n */\nfunction claim_node(nodes, predicate, process_node, create_node, dont_update_last_index = false) {\n\t// Try to find nodes in an order such that we lengthen the longest increasing subsequence\n\tinit_claim_info(nodes);\n\tconst result_node = (() => {\n\t\t// We first try to find an element after the previous one\n\t\tfor (let i = nodes.claim_info.last_index; i < nodes.length; i++) {\n\t\t\tconst node = nodes[i];\n\t\t\tif (predicate(node)) {\n\t\t\t\tconst replacement = process_node(node);\n\t\t\t\tif (replacement === undefined) {\n\t\t\t\t\tnodes.splice(i, 1);\n\t\t\t\t} else {\n\t\t\t\t\tnodes[i] = replacement;\n\t\t\t\t}\n\t\t\t\tif (!dont_update_last_index) {\n\t\t\t\t\tnodes.claim_info.last_index = i;\n\t\t\t\t}\n\t\t\t\treturn node;\n\t\t\t}\n\t\t}\n\t\t// Otherwise, we try to find one before\n\t\t// We iterate in reverse so that we don't go too far back\n\t\tfor (let i = nodes.claim_info.last_index - 1; i >= 0; i--) {\n\t\t\tconst node = nodes[i];\n\t\t\tif (predicate(node)) {\n\t\t\t\tconst replacement = process_node(node);\n\t\t\t\tif (replacement === undefined) {\n\t\t\t\t\tnodes.splice(i, 1);\n\t\t\t\t} else {\n\t\t\t\t\tnodes[i] = replacement;\n\t\t\t\t}\n\t\t\t\tif (!dont_update_last_index) {\n\t\t\t\t\tnodes.claim_info.last_index = i;\n\t\t\t\t} else if (replacement === undefined) {\n\t\t\t\t\t// Since we spliced before the last_index, we decrease it\n\t\t\t\t\tnodes.claim_info.last_index--;\n\t\t\t\t}\n\t\t\t\treturn node;\n\t\t\t}\n\t\t}\n\t\t// If we can't find any matching node, we create a new one\n\t\treturn create_node();\n\t})();\n\tresult_node.claim_order = nodes.claim_info.total_claimed;\n\tnodes.claim_info.total_claimed += 1;\n\treturn result_node;\n}\n\n/**\n * @param {ChildNodeArray} nodes\n * @param {string} name\n * @param {{ [key: string]: boolean }} attributes\n * @param {(name: string) => Element | SVGElement} create_element\n * @returns {Element | SVGElement}\n */\nfunction claim_element_base(nodes, name, attributes, create_element) {\n\treturn claim_node(\n\t\tnodes,\n\t\t/** @returns {node is Element | SVGElement} */\n\t\t(node) => node.nodeName === name,\n\t\t/** @param {Element} node */\n\t\t(node) => {\n\t\t\tconst remove = [];\n\t\t\tfor (let j = 0; j < node.attributes.length; j++) {\n\t\t\t\tconst attribute = node.attributes[j];\n\t\t\t\tif (!attributes[attribute.name]) {\n\t\t\t\t\tremove.push(attribute.name);\n\t\t\t\t}\n\t\t\t}\n\t\t\tremove.forEach((v) => node.removeAttribute(v));\n\t\t\treturn undefined;\n\t\t},\n\t\t() => create_element(name)\n\t);\n}\n\n/**\n * @param {ChildNodeArray} nodes\n * @param {string} name\n * @param {{ [key: string]: boolean }} attributes\n * @returns {Element | SVGElement}\n */\nexport function claim_element(nodes, name, attributes) {\n\treturn claim_element_base(nodes, name, attributes, element);\n}\n\n/**\n * @param {ChildNodeArray} nodes\n * @param {string} name\n * @param {{ [key: string]: boolean }} attributes\n * @returns {Element | SVGElement}\n */\nexport function claim_svg_element(nodes, name, attributes) {\n\treturn claim_element_base(nodes, name, attributes, svg_element);\n}\n\n/**\n * @param {ChildNodeArray} nodes\n * @returns {Text}\n */\nexport function claim_text(nodes, data) {\n\treturn claim_node(\n\t\tnodes,\n\t\t/** @returns {node is Text} */\n\t\t(node) => node.nodeType === 3,\n\t\t/** @param {Text} node */\n\t\t(node) => {\n\t\t\tconst data_str = '' + data;\n\t\t\tif (node.data.startsWith(data_str)) {\n\t\t\t\tif (node.data.length !== data_str.length) {\n\t\t\t\t\treturn node.splitText(data_str.length);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tnode.data = data_str;\n\t\t\t}\n\t\t},\n\t\t() => text(data),\n\t\ttrue // Text nodes should not update last index since it is likely not worth it to eliminate an increasing subsequence of actual elements\n\t);\n}\n\n/**\n * @returns {Text} */\nexport function claim_space(nodes) {\n\treturn claim_text(nodes, ' ');\n}\n\n/**\n * @param {ChildNodeArray} nodes\n * @returns {Comment}\n */\nexport function claim_comment(nodes, data) {\n\treturn claim_node(\n\t\tnodes,\n\t\t/** @returns {node is Comment} */\n\t\t(node) => node.nodeType === 8,\n\t\t/** @param {Comment} node */\n\t\t(node) => {\n\t\t\tnode.data = '' + data;\n\t\t\treturn undefined;\n\t\t},\n\t\t() => comment(data),\n\t\ttrue\n\t);\n}\n\nfunction get_comment_idx(nodes, text, start) {\n\tfor (let i = start; i < nodes.length; i += 1) {\n\t\tconst node = nodes[i];\n\t\tif (node.nodeType === 8 /* comment node */ && node.textContent.trim() === text) {\n\t\t\treturn i;\n\t\t}\n\t}\n\treturn -1;\n}\n\n/**\n * @param {boolean} is_svg\n * @returns {HtmlTagHydration}\n */\nexport function claim_html_tag(nodes, is_svg) {\n\t// find html opening tag\n\tconst start_index = get_comment_idx(nodes, 'HTML_TAG_START', 0);\n\tconst end_index = get_comment_idx(nodes, 'HTML_TAG_END', start_index + 1);\n\tif (start_index === -1 || end_index === -1) {\n\t\treturn new HtmlTagHydration(is_svg);\n\t}\n\n\tinit_claim_info(nodes);\n\tconst html_tag_nodes = nodes.splice(start_index, end_index - start_index + 1);\n\tdetach(html_tag_nodes[0]);\n\tdetach(html_tag_nodes[html_tag_nodes.length - 1]);\n\tconst claimed_nodes = html_tag_nodes.slice(1, html_tag_nodes.length - 1);\n\tif (claimed_nodes.length === 0) {\n\t\treturn new HtmlTagHydration(is_svg);\n\t}\n\tfor (const n of claimed_nodes) {\n\t\tn.claim_order = nodes.claim_info.total_claimed;\n\t\tnodes.claim_info.total_claimed += 1;\n\t}\n\treturn new HtmlTagHydration(is_svg, claimed_nodes);\n}\n\n/**\n * @param {Text} text\n * @param {unknown} data\n * @returns {void}\n */\nexport function set_data(text, data) {\n\tdata = '' + data;\n\tif (text.data === data) return;\n\ttext.data = /** @type {string} */ (data);\n}\n\n/**\n * @param {Text} text\n * @param {unknown} data\n * @returns {void}\n */\nexport function set_data_contenteditable(text, data) {\n\tdata = '' + data;\n\tif (text.wholeText === data) return;\n\ttext.data = /** @type {string} */ (data);\n}\n\n/**\n * @param {Text} text\n * @param {unknown} data\n * @param {string} attr_value\n * @returns {void}\n */\nexport function set_data_maybe_contenteditable(text, data, attr_value) {\n\tif (~contenteditable_truthy_values.indexOf(attr_value)) {\n\t\tset_data_contenteditable(text, data);\n\t} else {\n\t\tset_data(text, data);\n\t}\n}\n\n/**\n * @returns {void} */\nexport function set_input_value(input, value) {\n\tinput.value = value == null ? '' : value;\n}\n\n/**\n * @returns {void} */\nexport function set_input_type(input, type) {\n\ttry {\n\t\tinput.type = type;\n\t} catch (e) {\n\t\t// do nothing\n\t}\n}\n\n/**\n * @returns {void} */\nexport function set_style(node, key, value, important) {\n\tif (value == null) {\n\t\tnode.style.removeProperty(key);\n\t} else {\n\t\tnode.style.setProperty(key, value, important ? 'important' : '');\n\t}\n}\n\n/**\n * @returns {void} */\nexport function select_option(select, value, mounting) {\n\tfor (let i = 0; i < select.options.length; i += 1) {\n\t\tconst option = select.options[i];\n\t\tif (option.__value === value) {\n\t\t\toption.selected = true;\n\t\t\treturn;\n\t\t}\n\t}\n\tif (!mounting || value !== undefined) {\n\t\tselect.selectedIndex = -1; // no option should be selected\n\t}\n}\n\n/**\n * @returns {void} */\nexport function select_options(select, value) {\n\tfor (let i = 0; i < select.options.length; i += 1) {\n\t\tconst option = select.options[i];\n\t\toption.selected = ~value.indexOf(option.__value);\n\t}\n}\n\nexport function select_value(select) {\n\tconst selected_option = select.querySelector(':checked');\n\treturn selected_option && selected_option.__value;\n}\n\nexport function select_multiple_value(select) {\n\treturn [].map.call(select.querySelectorAll(':checked'), (option) => option.__value);\n}\n// unfortunately this can't be a constant as that wouldn't be tree-shakeable\n// so we cache the result instead\n\n/**\n * @type {boolean} */\nlet crossorigin;\n\n/**\n * @returns {boolean} */\nexport function is_crossorigin() {\n\tif (crossorigin === undefined) {\n\t\tcrossorigin = false;\n\t\ttry {\n\t\t\tif (typeof window !== 'undefined' && window.parent) {\n\t\t\t\tvoid window.parent.document;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tcrossorigin = true;\n\t\t}\n\t}\n\treturn crossorigin;\n}\n\n/**\n * @param {HTMLElement} node\n * @param {() => void} fn\n * @returns {() => void}\n */\nexport function add_iframe_resize_listener(node, fn) {\n\tconst computed_style = getComputedStyle(node);\n\tif (computed_style.position === 'static') {\n\t\tnode.style.position = 'relative';\n\t}\n\tconst iframe = element('iframe');\n\tiframe.setAttribute(\n\t\t'style',\n\t\t'display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; ' +\n\t\t\t'overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;'\n\t);\n\tiframe.setAttribute('aria-hidden', 'true');\n\tiframe.tabIndex = -1;\n\tconst crossorigin = is_crossorigin();\n\n\t/**\n\t * @type {() => void}\n\t */\n\tlet unsubscribe;\n\tif (crossorigin) {\n\t\tiframe.src = \"data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}</script>\";\n\t\tunsubscribe = listen(\n\t\t\twindow,\n\t\t\t'message',\n\t\t\t/** @param {MessageEvent} event */ (event) => {\n\t\t\t\tif (event.source === iframe.contentWindow) fn();\n\t\t\t}\n\t\t);\n\t} else {\n\t\tiframe.src = 'about:blank';\n\t\tiframe.onload = () => {\n\t\t\tunsubscribe = listen(iframe.contentWindow, 'resize', fn);\n\t\t\t// make sure an initial resize event is fired _after_ the iframe is loaded (which is asynchronous)\n\t\t\t// see https://github.com/sveltejs/svelte/issues/4233\n\t\t\tfn();\n\t\t};\n\t}\n\tappend(node, iframe);\n\treturn () => {\n\t\tif (crossorigin) {\n\t\t\tunsubscribe();\n\t\t} else if (unsubscribe && iframe.contentWindow) {\n\t\t\tunsubscribe();\n\t\t}\n\t\tdetach(iframe);\n\t};\n}\nexport const resize_observer_content_box = /* @__PURE__ */ new ResizeObserverSingleton({\n\tbox: 'content-box'\n});\nexport const resize_observer_border_box = /* @__PURE__ */ new ResizeObserverSingleton({\n\tbox: 'border-box'\n});\nexport const resize_observer_device_pixel_content_box = /* @__PURE__ */ new ResizeObserverSingleton(\n\t{ box: 'device-pixel-content-box' }\n);\nexport { ResizeObserverSingleton };\n\n/**\n * @returns {void} */\nexport function toggle_class(element, name, toggle) {\n\t// The `!!` is required because an `undefined` flag means flipping the current state.\n\telement.classList.toggle(name, !!toggle);\n}\n\n/**\n * @template T\n * @param {string} type\n * @param {T} [detail]\n * @param {{ bubbles?: boolean, cancelable?: boolean }} [options]\n * @returns {CustomEvent<T>}\n */\nexport function custom_event(type, detail, { bubbles = false, cancelable = false } = {}) {\n\treturn new CustomEvent(type, { detail, bubbles, cancelable });\n}\n\n/**\n * @param {string} selector\n * @param {HTMLElement} parent\n * @returns {ChildNodeArray}\n */\nexport function query_selector_all(selector, parent = document.body) {\n\treturn Array.from(parent.querySelectorAll(selector));\n}\n\n/**\n * @param {string} nodeId\n * @param {HTMLElement} head\n * @returns {any[]}\n */\nexport function head_selector(nodeId, head) {\n\tconst result = [];\n\tlet started = 0;\n\tfor (const node of head.childNodes) {\n\t\tif (node.nodeType === 8 /* comment node */) {\n\t\t\tconst comment = node.textContent.trim();\n\t\t\tif (comment === `HEAD_${nodeId}_END`) {\n\t\t\t\tstarted -= 1;\n\t\t\t\tresult.push(node);\n\t\t\t} else if (comment === `HEAD_${nodeId}_START`) {\n\t\t\t\tstarted += 1;\n\t\t\t\tresult.push(node);\n\t\t\t}\n\t\t} else if (started > 0) {\n\t\t\tresult.push(node);\n\t\t}\n\t}\n\treturn result;\n}\n/** */\nexport class HtmlTag {\n\t/**\n\t * @private\n\t * @default false\n\t */\n\tis_svg = false;\n\t/** parent for creating node */\n\te = undefined;\n\t/** html tag nodes */\n\tn = undefined;\n\t/** target */\n\tt = undefined;\n\t/** anchor */\n\ta = undefined;\n\tconstructor(is_svg = false) {\n\t\tthis.is_svg = is_svg;\n\t\tthis.e = this.n = null;\n\t}\n\n\t/**\n\t * @param {string} html\n\t * @returns {void}\n\t */\n\tc(html) {\n\t\tthis.h(html);\n\t}\n\n\t/**\n\t * @param {string} html\n\t * @param {HTMLElement | SVGElement} target\n\t * @param {HTMLElement | SVGElement} anchor\n\t * @returns {void}\n\t */\n\tm(html, target, anchor = null) {\n\t\tif (!this.e) {\n\t\t\tif (this.is_svg)\n\t\t\t\tthis.e = svg_element(/** @type {keyof SVGElementTagNameMap} */ (target.nodeName));\n\t\t\t/** #7364  target for <template> may be provided as #document-fragment(11) */ else\n\t\t\t\tthis.e = element(\n\t\t\t\t\t/** @type {keyof HTMLElementTagNameMap} */ (\n\t\t\t\t\t\ttarget.nodeType === 11 ? 'TEMPLATE' : target.nodeName\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\tthis.t =\n\t\t\t\ttarget.tagName !== 'TEMPLATE'\n\t\t\t\t\t? target\n\t\t\t\t\t: /** @type {HTMLTemplateElement} */ (target).content;\n\t\t\tthis.c(html);\n\t\t}\n\t\tthis.i(anchor);\n\t}\n\n\t/**\n\t * @param {string} html\n\t * @returns {void}\n\t */\n\th(html) {\n\t\tthis.e.innerHTML = html;\n\t\tthis.n = Array.from(\n\t\t\tthis.e.nodeName === 'TEMPLATE' ? this.e.content.childNodes : this.e.childNodes\n\t\t);\n\t}\n\n\t/**\n\t * @returns {void} */\n\ti(anchor) {\n\t\tfor (let i = 0; i < this.n.length; i += 1) {\n\t\t\tinsert(this.t, this.n[i], anchor);\n\t\t}\n\t}\n\n\t/**\n\t * @param {string} html\n\t * @returns {void}\n\t */\n\tp(html) {\n\t\tthis.d();\n\t\tthis.h(html);\n\t\tthis.i(this.a);\n\t}\n\n\t/**\n\t * @returns {void} */\n\td() {\n\t\tthis.n.forEach(detach);\n\t}\n}\n\nexport class HtmlTagHydration extends HtmlTag {\n\t/** @type {Element[]} hydration claimed nodes */\n\tl = undefined;\n\n\tconstructor(is_svg = false, claimed_nodes) {\n\t\tsuper(is_svg);\n\t\tthis.e = this.n = null;\n\t\tthis.l = claimed_nodes;\n\t}\n\n\t/**\n\t * @param {string} html\n\t * @returns {void}\n\t */\n\tc(html) {\n\t\tif (this.l) {\n\t\t\tthis.n = this.l;\n\t\t} else {\n\t\t\tsuper.c(html);\n\t\t}\n\t}\n\n\t/**\n\t * @returns {void} */\n\ti(anchor) {\n\t\tfor (let i = 0; i < this.n.length; i += 1) {\n\t\t\tinsert_hydration(this.t, this.n[i], anchor);\n\t\t}\n\t}\n}\n\n/**\n * @param {NamedNodeMap} attributes\n * @returns {{}}\n */\nexport function attribute_to_object(attributes) {\n\tconst result = {};\n\tfor (const attribute of attributes) {\n\t\tresult[attribute.name] = attribute.value;\n\t}\n\treturn result;\n}\n\nconst escaped = {\n\t'\"': '&quot;',\n\t'&': '&amp;',\n\t'<': '&lt;'\n};\n\nconst regex_attribute_characters_to_escape = /[\"&<]/g;\n\n/**\n * Note that the attribute itself should be surrounded in double quotes\n * @param {any} attribute\n */\nfunction escape_attribute(attribute) {\n\treturn String(attribute).replace(regex_attribute_characters_to_escape, (match) => escaped[match]);\n}\n\n/**\n * @param {Record<string, string>} attributes\n */\nexport function stringify_spread(attributes) {\n\tlet str = ' ';\n\tfor (const key in attributes) {\n\t\tif (attributes[key] != null) {\n\t\t\tstr += `${key}=\"${escape_attribute(attributes[key])}\" `;\n\t\t}\n\t}\n\n\treturn str;\n}\n\n/**\n * @param {HTMLElement} element\n * @returns {{}}\n */\nexport function get_custom_elements_slots(element) {\n\tconst result = {};\n\telement.childNodes.forEach(\n\t\t/** @param {Element} node */ (node) => {\n\t\t\tresult[node.slot || 'default'] = true;\n\t\t}\n\t);\n\treturn result;\n}\n\nexport function construct_svelte_component(component, props) {\n\treturn new component(props);\n}\n\n/**\n * @typedef {Node & {\n * \tclaim_order?: number;\n * \thydrate_init?: true;\n * \tactual_end_child?: NodeEx;\n * \tchildNodes: NodeListOf<NodeEx>;\n * }} NodeEx\n */\n\n/** @typedef {ChildNode & NodeEx} ChildNodeEx */\n\n/** @typedef {NodeEx & { claim_order: number }} NodeEx2 */\n\n/**\n * @typedef {ChildNodeEx[] & {\n * \tclaim_info?: {\n * \t\tlast_index: number;\n * \t\ttotal_claimed: number;\n * \t};\n * }} ChildNodeArray\n */\n","import { append_empty_stylesheet, detach, get_root_for_style } from './dom.js';\nimport { raf } from './environment.js';\n\n// we need to store the information for multiple documents because a Svelte application could also contain iframes\n// https://github.com/sveltejs/svelte/issues/3624\n/** @type {Map<Document | ShadowRoot, import('./private.d.ts').StyleInformation>} */\nconst managed_styles = new Map();\n\nlet active = 0;\n\n// https://github.com/darkskyapp/string-hash/blob/master/index.js\n/**\n * @param {string} str\n * @returns {number}\n */\nfunction hash(str) {\n\tlet hash = 5381;\n\tlet i = str.length;\n\twhile (i--) hash = ((hash << 5) - hash) ^ str.charCodeAt(i);\n\treturn hash >>> 0;\n}\n\n/**\n * @param {Document | ShadowRoot} doc\n * @param {Element & ElementCSSInlineStyle} node\n * @returns {{ stylesheet: any; rules: {}; }}\n */\nfunction create_style_information(doc, node) {\n\tconst info = { stylesheet: append_empty_stylesheet(node), rules: {} };\n\tmanaged_styles.set(doc, info);\n\treturn info;\n}\n\n/**\n * @param {Element & ElementCSSInlineStyle} node\n * @param {number} a\n * @param {number} b\n * @param {number} duration\n * @param {number} delay\n * @param {(t: number) => number} ease\n * @param {(t: number, u: number) => string} fn\n * @param {number} uid\n * @returns {string}\n */\nexport function create_rule(node, a, b, duration, delay, ease, fn, uid = 0) {\n\tconst step = 16.666 / duration;\n\tlet keyframes = '{\\n';\n\tfor (let p = 0; p <= 1; p += step) {\n\t\tconst t = a + (b - a) * ease(p);\n\t\tkeyframes += p * 100 + `%{${fn(t, 1 - t)}}\\n`;\n\t}\n\tconst rule = keyframes + `100% {${fn(b, 1 - b)}}\\n}`;\n\tconst name = `__svelte_${hash(rule)}_${uid}`;\n\tconst doc = get_root_for_style(node);\n\tconst { stylesheet, rules } = managed_styles.get(doc) || create_style_information(doc, node);\n\tif (!rules[name]) {\n\t\trules[name] = true;\n\t\tstylesheet.insertRule(`@keyframes ${name} ${rule}`, stylesheet.cssRules.length);\n\t}\n\tconst animation = node.style.animation || '';\n\tnode.style.animation = `${\n\t\tanimation ? `${animation}, ` : ''\n\t}${name} ${duration}ms linear ${delay}ms 1 both`;\n\tactive += 1;\n\treturn name;\n}\n\n/**\n * @param {Element & ElementCSSInlineStyle} node\n * @param {string} [name]\n * @returns {void}\n */\nexport function delete_rule(node, name) {\n\tconst previous = (node.style.animation || '').split(', ');\n\tconst next = previous.filter(\n\t\tname\n\t\t\t? (anim) => anim.indexOf(name) < 0 // remove specific animation\n\t\t\t: (anim) => anim.indexOf('__svelte') === -1 // remove all Svelte animations\n\t);\n\tconst deleted = previous.length - next.length;\n\tif (deleted) {\n\t\tnode.style.animation = next.join(', ');\n\t\tactive -= deleted;\n\t\tif (!active) clear_rules();\n\t}\n}\n\n/** @returns {void} */\nexport function clear_rules() {\n\traf(() => {\n\t\tif (active) return;\n\t\tmanaged_styles.forEach((info) => {\n\t\t\tconst { ownerNode } = info.stylesheet;\n\t\t\t// there is no ownerNode if it runs on jsdom.\n\t\t\tif (ownerNode) detach(ownerNode);\n\t\t});\n\t\tmanaged_styles.clear();\n\t});\n}\n","import { custom_event } from './dom.js';\n\nexport let current_component;\n\n/** @returns {void} */\nexport function set_current_component(component) {\n\tcurrent_component = component;\n}\n\nexport function get_current_component() {\n\tif (!current_component) throw new Error('Function called outside component initialization');\n\treturn current_component;\n}\n\n/**\n * Schedules a callback to run immediately before the component is updated after any state change.\n *\n * The first time the callback runs will be before the initial `onMount`\n *\n * https://svelte.dev/docs/svelte#beforeupdate\n * @param {() => any} fn\n * @returns {void}\n */\nexport function beforeUpdate(fn) {\n\tget_current_component().$$.before_update.push(fn);\n}\n\n/**\n * The `onMount` function schedules a callback to run as soon as the component has been mounted to the DOM.\n * It must be called during the component's initialisation (but doesn't need to live *inside* the component;\n * it can be called from an external module).\n *\n * If a function is returned _synchronously_ from `onMount`, it will be called when the component is unmounted.\n *\n * `onMount` does not run inside a [server-side component](https://svelte.dev/docs#run-time-server-side-component-api).\n *\n * https://svelte.dev/docs/svelte#onmount\n * @template T\n * @param {() => import('./private.js').NotFunction<T> | Promise<import('./private.js').NotFunction<T>> | (() => any)} fn\n * @returns {void}\n */\nexport function onMount(fn) {\n\tget_current_component().$$.on_mount.push(fn);\n}\n\n/**\n * Schedules a callback to run immediately after the component has been updated.\n *\n * The first time the callback runs will be after the initial `onMount`\n *\n * https://svelte.dev/docs/svelte#afterupdate\n * @param {() => any} fn\n * @returns {void}\n */\nexport function afterUpdate(fn) {\n\tget_current_component().$$.after_update.push(fn);\n}\n\n/**\n * Schedules a callback to run immediately before the component is unmounted.\n *\n * Out of `onMount`, `beforeUpdate`, `afterUpdate` and `onDestroy`, this is the\n * only one that runs inside a server-side component.\n *\n * https://svelte.dev/docs/svelte#ondestroy\n * @param {() => any} fn\n * @returns {void}\n */\nexport function onDestroy(fn) {\n\tget_current_component().$$.on_destroy.push(fn);\n}\n\n/**\n * Creates an event dispatcher that can be used to dispatch [component events](https://svelte.dev/docs#template-syntax-component-directives-on-eventname).\n * Event dispatchers are functions that can take two arguments: `name` and `detail`.\n *\n * Component events created with `createEventDispatcher` create a\n * [CustomEvent](https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent).\n * These events do not [bubble](https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Building_blocks/Events#Event_bubbling_and_capture).\n * The `detail` argument corresponds to the [CustomEvent.detail](https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/detail)\n * property and can contain any type of data.\n *\n * The event dispatcher can be typed to narrow the allowed event names and the type of the `detail` argument:\n * ```ts\n * const dispatch = createEventDispatcher<{\n *  loaded: never; // does not take a detail argument\n *  change: string; // takes a detail argument of type string, which is required\n *  optional: number | null; // takes an optional detail argument of type number\n * }>();\n * ```\n *\n * https://svelte.dev/docs/svelte#createeventdispatcher\n * @template {Record<string, any>} [EventMap=any]\n * @returns {import('./public.js').EventDispatcher<EventMap>}\n */\nexport function createEventDispatcher() {\n\tconst component = get_current_component();\n\treturn (type, detail, { cancelable = false } = {}) => {\n\t\tconst callbacks = component.$$.callbacks[type];\n\t\tif (callbacks) {\n\t\t\t// TODO are there situations where events could be dispatched\n\t\t\t// in a server (non-DOM) environment?\n\t\t\tconst event = custom_event(/** @type {string} */ (type), detail, { cancelable });\n\t\t\tcallbacks.slice().forEach((fn) => {\n\t\t\t\tfn.call(component, event);\n\t\t\t});\n\t\t\treturn !event.defaultPrevented;\n\t\t}\n\t\treturn true;\n\t};\n}\n\n/**\n * Associates an arbitrary `context` object with the current component and the specified `key`\n * and returns that object. The context is then available to children of the component\n * (including slotted content) with `getContext`.\n *\n * Like lifecycle functions, this must be called during component initialisation.\n *\n * https://svelte.dev/docs/svelte#setcontext\n * @template T\n * @param {any} key\n * @param {T} context\n * @returns {T}\n */\nexport function setContext(key, context) {\n\tget_current_component().$$.context.set(key, context);\n\treturn context;\n}\n\n/**\n * Retrieves the context that belongs to the closest parent component with the specified `key`.\n * Must be called during component initialisation.\n *\n * https://svelte.dev/docs/svelte#getcontext\n * @template T\n * @param {any} key\n * @returns {T}\n */\nexport function getContext(key) {\n\treturn get_current_component().$$.context.get(key);\n}\n\n/**\n * Retrieves the whole context map that belongs to the closest parent component.\n * Must be called during component initialisation. Useful, for example, if you\n * programmatically create a component and want to pass the existing context to it.\n *\n * https://svelte.dev/docs/svelte#getallcontexts\n * @template {Map<any, any>} [T=Map<any, any>]\n * @returns {T}\n */\nexport function getAllContexts() {\n\treturn get_current_component().$$.context;\n}\n\n/**\n * Checks whether a given `key` has been set in the context of a parent component.\n * Must be called during component initialisation.\n *\n * https://svelte.dev/docs/svelte#hascontext\n * @param {any} key\n * @returns {boolean}\n */\nexport function hasContext(key) {\n\treturn get_current_component().$$.context.has(key);\n}\n\n// TODO figure out if we still want to support\n// shorthand events, or if we want to implement\n// a real bubbling mechanism\n/**\n * @param component\n * @param event\n * @returns {void}\n */\nexport function bubble(component, event) {\n\tconst callbacks = component.$$.callbacks[event.type];\n\tif (callbacks) {\n\t\t// @ts-ignore\n\t\tcallbacks.slice().forEach((fn) => fn.call(this, event));\n\t}\n}\n","import { run_all } from './utils.js';\nimport { current_component, set_current_component } from './lifecycle.js';\n\nexport const dirty_components = [];\nexport const intros = { enabled: false };\nexport const binding_callbacks = [];\n\nlet render_callbacks = [];\n\nconst flush_callbacks = [];\n\nconst resolved_promise = /* @__PURE__ */ Promise.resolve();\n\nlet update_scheduled = false;\n\n/** @returns {void} */\nexport function schedule_update() {\n\tif (!update_scheduled) {\n\t\tupdate_scheduled = true;\n\t\tresolved_promise.then(flush);\n\t}\n}\n\n/** @returns {Promise<void>} */\nexport function tick() {\n\tschedule_update();\n\treturn resolved_promise;\n}\n\n/** @returns {void} */\nexport function add_render_callback(fn) {\n\trender_callbacks.push(fn);\n}\n\n/** @returns {void} */\nexport function add_flush_callback(fn) {\n\tflush_callbacks.push(fn);\n}\n\n// flush() calls callbacks in this order:\n// 1. All beforeUpdate callbacks, in order: parents before children\n// 2. All bind:this callbacks, in reverse order: children before parents.\n// 3. All afterUpdate callbacks, in order: parents before children. EXCEPT\n//    for afterUpdates called during the initial onMount, which are called in\n//    reverse order: children before parents.\n// Since callbacks might update component values, which could trigger another\n// call to flush(), the following steps guard against this:\n// 1. During beforeUpdate, any updated components will be added to the\n//    dirty_components array and will cause a reentrant call to flush(). Because\n//    the flush index is kept outside the function, the reentrant call will pick\n//    up where the earlier call left off and go through all dirty components. The\n//    current_component value is saved and restored so that the reentrant call will\n//    not interfere with the \"parent\" flush() call.\n// 2. bind:this callbacks cannot trigger new flush() calls.\n// 3. During afterUpdate, any updated components will NOT have their afterUpdate\n//    callback called a second time; the seen_callbacks set, outside the flush()\n//    function, guarantees this behavior.\nconst seen_callbacks = new Set();\n\nlet flushidx = 0; // Do *not* move this inside the flush() function\n\n/** @returns {void} */\nexport function flush() {\n\t// Do not reenter flush while dirty components are updated, as this can\n\t// result in an infinite loop. Instead, let the inner flush handle it.\n\t// Reentrancy is ok afterwards for bindings etc.\n\tif (flushidx !== 0) {\n\t\treturn;\n\t}\n\tconst saved_component = current_component;\n\tdo {\n\t\t// first, call beforeUpdate functions\n\t\t// and update components\n\t\ttry {\n\t\t\twhile (flushidx < dirty_components.length) {\n\t\t\t\tconst component = dirty_components[flushidx];\n\t\t\t\tflushidx++;\n\t\t\t\tset_current_component(component);\n\t\t\t\tupdate(component.$$);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// reset dirty state to not end up in a deadlocked state and then rethrow\n\t\t\tdirty_components.length = 0;\n\t\t\tflushidx = 0;\n\t\t\tthrow e;\n\t\t}\n\t\tset_current_component(null);\n\t\tdirty_components.length = 0;\n\t\tflushidx = 0;\n\t\twhile (binding_callbacks.length) binding_callbacks.pop()();\n\t\t// then, once components are updated, call\n\t\t// afterUpdate functions. This may cause\n\t\t// subsequent updates...\n\t\tfor (let i = 0; i < render_callbacks.length; i += 1) {\n\t\t\tconst callback = render_callbacks[i];\n\t\t\tif (!seen_callbacks.has(callback)) {\n\t\t\t\t// ...so guard against infinite loops\n\t\t\t\tseen_callbacks.add(callback);\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}\n\t\trender_callbacks.length = 0;\n\t} while (dirty_components.length);\n\twhile (flush_callbacks.length) {\n\t\tflush_callbacks.pop()();\n\t}\n\tupdate_scheduled = false;\n\tseen_callbacks.clear();\n\tset_current_component(saved_component);\n}\n\n/** @returns {void} */\nfunction update($$) {\n\tif ($$.fragment !== null) {\n\t\t$$.update();\n\t\trun_all($$.before_update);\n\t\tconst dirty = $$.dirty;\n\t\t$$.dirty = [-1];\n\t\t$$.fragment && $$.fragment.p($$.ctx, dirty);\n\t\t$$.after_update.forEach(add_render_callback);\n\t}\n}\n\n/**\n * Useful for example to execute remaining `afterUpdate` callbacks before executing `destroy`.\n * @param {Function[]} fns\n * @returns {void}\n */\nexport function flush_render_callbacks(fns) {\n\tconst filtered = [];\n\tconst targets = [];\n\trender_callbacks.forEach((c) => (fns.indexOf(c) === -1 ? filtered.push(c) : targets.push(c)));\n\ttargets.forEach((c) => c());\n\trender_callbacks = filtered;\n}\n","import { identity as linear, is_function, noop, run_all } from './utils.js';\nimport { now } from './environment.js';\nimport { loop } from './loop.js';\nimport { create_rule, delete_rule } from './style_manager.js';\nimport { custom_event } from './dom.js';\nimport { add_render_callback } from './scheduler.js';\n\n/**\n * @type {Promise<void> | null}\n */\nlet promise;\n\n/**\n * @returns {Promise<void>}\n */\nfunction wait() {\n\tif (!promise) {\n\t\tpromise = Promise.resolve();\n\t\tpromise.then(() => {\n\t\t\tpromise = null;\n\t\t});\n\t}\n\treturn promise;\n}\n\n/**\n * @param {Element} node\n * @param {INTRO | OUTRO | boolean} direction\n * @param {'start' | 'end'} kind\n * @returns {void}\n */\nfunction dispatch(node, direction, kind) {\n\tnode.dispatchEvent(custom_event(`${direction ? 'intro' : 'outro'}${kind}`));\n}\n\nconst outroing = new Set();\n\n/**\n * @type {Outro}\n */\nlet outros;\n\n/**\n * @returns {void} */\nexport function group_outros() {\n\toutros = {\n\t\tr: 0,\n\t\tc: [],\n\t\tp: outros // parent group\n\t};\n}\n\n/**\n * @returns {void} */\nexport function check_outros() {\n\tif (!outros.r) {\n\t\trun_all(outros.c);\n\t}\n\toutros = outros.p;\n}\n\n/**\n * @param {import('./private.js').Fragment} block\n * @param {0 | 1} [local]\n * @returns {void}\n */\nexport function transition_in(block, local) {\n\tif (block && block.i) {\n\t\toutroing.delete(block);\n\t\tblock.i(local);\n\t}\n}\n\n/**\n * @param {import('./private.js').Fragment} block\n * @param {0 | 1} local\n * @param {0 | 1} [detach]\n * @param {() => void} [callback]\n * @returns {void}\n */\nexport function transition_out(block, local, detach, callback) {\n\tif (block && block.o) {\n\t\tif (outroing.has(block)) return;\n\t\toutroing.add(block);\n\t\toutros.c.push(() => {\n\t\t\toutroing.delete(block);\n\t\t\tif (callback) {\n\t\t\t\tif (detach) block.d(1);\n\t\t\t\tcallback();\n\t\t\t}\n\t\t});\n\t\tblock.o(local);\n\t} else if (callback) {\n\t\tcallback();\n\t}\n}\n\n/**\n * @type {import('../transition/public.js').TransitionConfig}\n */\nconst null_transition = { duration: 0 };\n\n/**\n * @param {Element & ElementCSSInlineStyle} node\n * @param {TransitionFn} fn\n * @param {any} params\n * @returns {{ start(): void; invalidate(): void; end(): void; }}\n */\nexport function create_in_transition(node, fn, params) {\n\t/**\n\t * @type {TransitionOptions} */\n\tconst options = { direction: 'in' };\n\tlet config = fn(node, params, options);\n\tlet running = false;\n\tlet animation_name;\n\tlet task;\n\tlet uid = 0;\n\n\t/**\n\t * @returns {void} */\n\tfunction cleanup() {\n\t\tif (animation_name) delete_rule(node, animation_name);\n\t}\n\n\t/**\n\t * @returns {void} */\n\tfunction go() {\n\t\tconst {\n\t\t\tdelay = 0,\n\t\t\tduration = 300,\n\t\t\teasing = linear,\n\t\t\ttick = noop,\n\t\t\tcss\n\t\t} = config || null_transition;\n\t\tif (css) animation_name = create_rule(node, 0, 1, duration, delay, easing, css, uid++);\n\t\ttick(0, 1);\n\t\tconst start_time = now() + delay;\n\t\tconst end_time = start_time + duration;\n\t\tif (task) task.abort();\n\t\trunning = true;\n\t\tadd_render_callback(() => dispatch(node, true, 'start'));\n\t\ttask = loop((now) => {\n\t\t\tif (running) {\n\t\t\t\tif (now >= end_time) {\n\t\t\t\t\ttick(1, 0);\n\t\t\t\t\tdispatch(node, true, 'end');\n\t\t\t\t\tcleanup();\n\t\t\t\t\treturn (running = false);\n\t\t\t\t}\n\t\t\t\tif (now >= start_time) {\n\t\t\t\t\tconst t = easing((now - start_time) / duration);\n\t\t\t\t\ttick(t, 1 - t);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn running;\n\t\t});\n\t}\n\tlet started = false;\n\treturn {\n\t\tstart() {\n\t\t\tif (started) return;\n\t\t\tstarted = true;\n\t\t\tdelete_rule(node);\n\t\t\tif (is_function(config)) {\n\t\t\t\tconfig = config(options);\n\t\t\t\twait().then(go);\n\t\t\t} else {\n\t\t\t\tgo();\n\t\t\t}\n\t\t},\n\t\tinvalidate() {\n\t\t\tstarted = false;\n\t\t},\n\t\tend() {\n\t\t\tif (running) {\n\t\t\t\tcleanup();\n\t\t\t\trunning = false;\n\t\t\t}\n\t\t}\n\t};\n}\n\n/**\n * @param {Element & ElementCSSInlineStyle} node\n * @param {TransitionFn} fn\n * @param {any} params\n * @returns {{ end(reset: any): void; }}\n */\nexport function create_out_transition(node, fn, params) {\n\t/** @type {TransitionOptions} */\n\tconst options = { direction: 'out' };\n\tlet config = fn(node, params, options);\n\tlet running = true;\n\tlet animation_name;\n\tconst group = outros;\n\tgroup.r += 1;\n\t/** @type {boolean} */\n\tlet original_inert_value;\n\n\t/**\n\t * @returns {void} */\n\tfunction go() {\n\t\tconst {\n\t\t\tdelay = 0,\n\t\t\tduration = 300,\n\t\t\teasing = linear,\n\t\t\ttick = noop,\n\t\t\tcss\n\t\t} = config || null_transition;\n\n\t\tif (css) animation_name = create_rule(node, 1, 0, duration, delay, easing, css);\n\n\t\tconst start_time = now() + delay;\n\t\tconst end_time = start_time + duration;\n\t\tadd_render_callback(() => dispatch(node, false, 'start'));\n\n\t\tif ('inert' in node) {\n\t\t\toriginal_inert_value = /** @type {HTMLElement} */ (node).inert;\n\t\t\tnode.inert = true;\n\t\t}\n\n\t\tloop((now) => {\n\t\t\tif (running) {\n\t\t\t\tif (now >= end_time) {\n\t\t\t\t\ttick(0, 1);\n\t\t\t\t\tdispatch(node, false, 'end');\n\t\t\t\t\tif (!--group.r) {\n\t\t\t\t\t\t// this will result in `end()` being called,\n\t\t\t\t\t\t// so we don't need to clean up here\n\t\t\t\t\t\trun_all(group.c);\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (now >= start_time) {\n\t\t\t\t\tconst t = easing((now - start_time) / duration);\n\t\t\t\t\ttick(1 - t, t);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn running;\n\t\t});\n\t}\n\n\tif (is_function(config)) {\n\t\twait().then(() => {\n\t\t\t// @ts-ignore\n\t\t\tconfig = config(options);\n\t\t\tgo();\n\t\t});\n\t} else {\n\t\tgo();\n\t}\n\n\treturn {\n\t\tend(reset) {\n\t\t\tif (reset && 'inert' in node) {\n\t\t\t\tnode.inert = original_inert_value;\n\t\t\t}\n\t\t\tif (reset && config.tick) {\n\t\t\t\tconfig.tick(1, 0);\n\t\t\t}\n\t\t\tif (running) {\n\t\t\t\tif (animation_name) delete_rule(node, animation_name);\n\t\t\t\trunning = false;\n\t\t\t}\n\t\t}\n\t};\n}\n\n/**\n * @param {Element & ElementCSSInlineStyle} node\n * @param {TransitionFn} fn\n * @param {any} params\n * @param {boolean} intro\n * @returns {{ run(b: 0 | 1): void; end(): void; }}\n */\nexport function create_bidirectional_transition(node, fn, params, intro) {\n\t/**\n\t * @type {TransitionOptions} */\n\tconst options = { direction: 'both' };\n\tlet config = fn(node, params, options);\n\tlet t = intro ? 0 : 1;\n\n\t/**\n\t * @type {Program | null} */\n\tlet running_program = null;\n\n\t/**\n\t * @type {PendingProgram | null} */\n\tlet pending_program = null;\n\tlet animation_name = null;\n\n\t/** @type {boolean} */\n\tlet original_inert_value;\n\n\t/**\n\t * @returns {void} */\n\tfunction clear_animation() {\n\t\tif (animation_name) delete_rule(node, animation_name);\n\t}\n\n\t/**\n\t * @param {PendingProgram} program\n\t * @param {number} duration\n\t * @returns {Program}\n\t */\n\tfunction init(program, duration) {\n\t\tconst d = /** @type {Program['d']} */ (program.b - t);\n\t\tduration *= Math.abs(d);\n\t\treturn {\n\t\t\ta: t,\n\t\t\tb: program.b,\n\t\t\td,\n\t\t\tduration,\n\t\t\tstart: program.start,\n\t\t\tend: program.start + duration,\n\t\t\tgroup: program.group\n\t\t};\n\t}\n\n\t/**\n\t * @param {INTRO | OUTRO} b\n\t * @returns {void}\n\t */\n\tfunction go(b) {\n\t\tconst {\n\t\t\tdelay = 0,\n\t\t\tduration = 300,\n\t\t\teasing = linear,\n\t\t\ttick = noop,\n\t\t\tcss\n\t\t} = config || null_transition;\n\n\t\t/**\n\t\t * @type {PendingProgram} */\n\t\tconst program = {\n\t\t\tstart: now() + delay,\n\t\t\tb\n\t\t};\n\n\t\tif (!b) {\n\t\t\t// @ts-ignore todo: improve typings\n\t\t\tprogram.group = outros;\n\t\t\toutros.r += 1;\n\t\t}\n\n\t\tif ('inert' in node) {\n\t\t\tif (b) {\n\t\t\t\tif (original_inert_value !== undefined) {\n\t\t\t\t\t// aborted/reversed outro  restore previous inert value\n\t\t\t\t\tnode.inert = original_inert_value;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toriginal_inert_value = /** @type {HTMLElement} */ (node).inert;\n\t\t\t\tnode.inert = true;\n\t\t\t}\n\t\t}\n\n\t\tif (running_program || pending_program) {\n\t\t\tpending_program = program;\n\t\t} else {\n\t\t\t// if this is an intro, and there's a delay, we need to do\n\t\t\t// an initial tick and/or apply CSS animation immediately\n\t\t\tif (css) {\n\t\t\t\tclear_animation();\n\t\t\t\tanimation_name = create_rule(node, t, b, duration, delay, easing, css);\n\t\t\t}\n\t\t\tif (b) tick(0, 1);\n\t\t\trunning_program = init(program, duration);\n\t\t\tadd_render_callback(() => dispatch(node, b, 'start'));\n\t\t\tloop((now) => {\n\t\t\t\tif (pending_program && now > pending_program.start) {\n\t\t\t\t\trunning_program = init(pending_program, duration);\n\t\t\t\t\tpending_program = null;\n\t\t\t\t\tdispatch(node, running_program.b, 'start');\n\t\t\t\t\tif (css) {\n\t\t\t\t\t\tclear_animation();\n\t\t\t\t\t\tanimation_name = create_rule(\n\t\t\t\t\t\t\tnode,\n\t\t\t\t\t\t\tt,\n\t\t\t\t\t\t\trunning_program.b,\n\t\t\t\t\t\t\trunning_program.duration,\n\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\teasing,\n\t\t\t\t\t\t\tconfig.css\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (running_program) {\n\t\t\t\t\tif (now >= running_program.end) {\n\t\t\t\t\t\ttick((t = running_program.b), 1 - t);\n\t\t\t\t\t\tdispatch(node, running_program.b, 'end');\n\t\t\t\t\t\tif (!pending_program) {\n\t\t\t\t\t\t\t// we're done\n\t\t\t\t\t\t\tif (running_program.b) {\n\t\t\t\t\t\t\t\t// intro  we can tidy up immediately\n\t\t\t\t\t\t\t\tclear_animation();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// outro  needs to be coordinated\n\t\t\t\t\t\t\t\tif (!--running_program.group.r) run_all(running_program.group.c);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\trunning_program = null;\n\t\t\t\t\t} else if (now >= running_program.start) {\n\t\t\t\t\t\tconst p = now - running_program.start;\n\t\t\t\t\t\tt = running_program.a + running_program.d * easing(p / running_program.duration);\n\t\t\t\t\t\ttick(t, 1 - t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn !!(running_program || pending_program);\n\t\t\t});\n\t\t}\n\t}\n\treturn {\n\t\trun(b) {\n\t\t\tif (is_function(config)) {\n\t\t\t\twait().then(() => {\n\t\t\t\t\tconst opts = { direction: b ? 'in' : 'out' };\n\t\t\t\t\t// @ts-ignore\n\t\t\t\t\tconfig = config(opts);\n\t\t\t\t\tgo(b);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tgo(b);\n\t\t\t}\n\t\t},\n\t\tend() {\n\t\t\tclear_animation();\n\t\t\trunning_program = pending_program = null;\n\t\t}\n\t};\n}\n\n/** @typedef {1} INTRO */\n/** @typedef {0} OUTRO */\n/** @typedef {{ direction: 'in' | 'out' | 'both' }} TransitionOptions */\n/** @typedef {(node: Element, params: any, options: TransitionOptions) => import('../transition/public.js').TransitionConfig} TransitionFn */\n\n/**\n * @typedef {Object} Outro\n * @property {number} r\n * @property {Function[]} c\n * @property {Object} p\n */\n\n/**\n * @typedef {Object} PendingProgram\n * @property {number} start\n * @property {INTRO|OUTRO} b\n * @property {Outro} [group]\n */\n\n/**\n * @typedef {Object} Program\n * @property {number} a\n * @property {INTRO|OUTRO} b\n * @property {1|-1} d\n * @property {number} duration\n * @property {number} start\n * @property {number} end\n * @property {Outro} [group]\n */\n","import { transition_in, transition_out } from './transitions.js';\nimport { run_all } from './utils.js';\n\n// general each functions:\n\nexport function ensure_array_like(array_like_or_iterator) {\n\treturn array_like_or_iterator?.length !== undefined\n\t\t? array_like_or_iterator\n\t\t: Array.from(array_like_or_iterator);\n}\n\n// keyed each functions:\n\n/** @returns {void} */\nexport function destroy_block(block, lookup) {\n\tblock.d(1);\n\tlookup.delete(block.key);\n}\n\n/** @returns {void} */\nexport function outro_and_destroy_block(block, lookup) {\n\ttransition_out(block, 1, 1, () => {\n\t\tlookup.delete(block.key);\n\t});\n}\n\n/** @returns {void} */\nexport function fix_and_destroy_block(block, lookup) {\n\tblock.f();\n\tdestroy_block(block, lookup);\n}\n\n/** @returns {void} */\nexport function fix_and_outro_and_destroy_block(block, lookup) {\n\tblock.f();\n\toutro_and_destroy_block(block, lookup);\n}\n\n/** @returns {any[]} */\nexport function update_keyed_each(\n\told_blocks,\n\tdirty,\n\tget_key,\n\tdynamic,\n\tctx,\n\tlist,\n\tlookup,\n\tnode,\n\tdestroy,\n\tcreate_each_block,\n\tnext,\n\tget_context\n) {\n\tlet o = old_blocks.length;\n\tlet n = list.length;\n\tlet i = o;\n\tconst old_indexes = {};\n\twhile (i--) old_indexes[old_blocks[i].key] = i;\n\tconst new_blocks = [];\n\tconst new_lookup = new Map();\n\tconst deltas = new Map();\n\tconst updates = [];\n\ti = n;\n\twhile (i--) {\n\t\tconst child_ctx = get_context(ctx, list, i);\n\t\tconst key = get_key(child_ctx);\n\t\tlet block = lookup.get(key);\n\t\tif (!block) {\n\t\t\tblock = create_each_block(key, child_ctx);\n\t\t\tblock.c();\n\t\t} else if (dynamic) {\n\t\t\t// defer updates until all the DOM shuffling is done\n\t\t\tupdates.push(() => block.p(child_ctx, dirty));\n\t\t}\n\t\tnew_lookup.set(key, (new_blocks[i] = block));\n\t\tif (key in old_indexes) deltas.set(key, Math.abs(i - old_indexes[key]));\n\t}\n\tconst will_move = new Set();\n\tconst did_move = new Set();\n\t/** @returns {void} */\n\tfunction insert(block) {\n\t\ttransition_in(block, 1);\n\t\tblock.m(node, next);\n\t\tlookup.set(block.key, block);\n\t\tnext = block.first;\n\t\tn--;\n\t}\n\twhile (o && n) {\n\t\tconst new_block = new_blocks[n - 1];\n\t\tconst old_block = old_blocks[o - 1];\n\t\tconst new_key = new_block.key;\n\t\tconst old_key = old_block.key;\n\t\tif (new_block === old_block) {\n\t\t\t// do nothing\n\t\t\tnext = new_block.first;\n\t\t\to--;\n\t\t\tn--;\n\t\t} else if (!new_lookup.has(old_key)) {\n\t\t\t// remove old block\n\t\t\tdestroy(old_block, lookup);\n\t\t\to--;\n\t\t} else if (!lookup.has(new_key) || will_move.has(new_key)) {\n\t\t\tinsert(new_block);\n\t\t} else if (did_move.has(old_key)) {\n\t\t\to--;\n\t\t} else if (deltas.get(new_key) > deltas.get(old_key)) {\n\t\t\tdid_move.add(new_key);\n\t\t\tinsert(new_block);\n\t\t} else {\n\t\t\twill_move.add(old_key);\n\t\t\to--;\n\t\t}\n\t}\n\twhile (o--) {\n\t\tconst old_block = old_blocks[o];\n\t\tif (!new_lookup.has(old_block.key)) destroy(old_block, lookup);\n\t}\n\twhile (n) insert(new_blocks[n - 1]);\n\trun_all(updates);\n\treturn new_blocks;\n}\n\n/** @returns {void} */\nexport function validate_each_keys(ctx, list, get_context, get_key) {\n\tconst keys = new Map();\n\tfor (let i = 0; i < list.length; i++) {\n\t\tconst key = get_key(get_context(ctx, list, i));\n\t\tif (keys.has(key)) {\n\t\t\tlet value = '';\n\t\t\ttry {\n\t\t\t\tvalue = `with value '${String(key)}' `;\n\t\t\t} catch (e) {\n\t\t\t\t// can't stringify\n\t\t\t}\n\t\t\tthrow new Error(\n\t\t\t\t`Cannot have duplicate keys in a keyed each: Keys at index ${keys.get(\n\t\t\t\t\tkey\n\t\t\t\t)} and ${i} ${value}are duplicates`\n\t\t\t);\n\t\t}\n\t\tkeys.set(key, i);\n\t}\n}\n","/** @returns {{}} */\nexport function get_spread_update(levels, updates) {\n\tconst update = {};\n\tconst to_null_out = {};\n\tconst accounted_for = { $$scope: 1 };\n\tlet i = levels.length;\n\twhile (i--) {\n\t\tconst o = levels[i];\n\t\tconst n = updates[i];\n\t\tif (n) {\n\t\t\tfor (const key in o) {\n\t\t\t\tif (!(key in n)) to_null_out[key] = 1;\n\t\t\t}\n\t\t\tfor (const key in n) {\n\t\t\t\tif (!accounted_for[key]) {\n\t\t\t\t\tupdate[key] = n[key];\n\t\t\t\t\taccounted_for[key] = 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlevels[i] = n;\n\t\t} else {\n\t\t\tfor (const key in o) {\n\t\t\t\taccounted_for[key] = 1;\n\t\t\t}\n\t\t}\n\t}\n\tfor (const key in to_null_out) {\n\t\tif (!(key in update)) update[key] = undefined;\n\t}\n\treturn update;\n}\n\nexport function get_spread_object(spread_props) {\n\treturn typeof spread_props === 'object' && spread_props !== null ? spread_props : {};\n}\n","import {\n\tadd_render_callback,\n\tflush,\n\tflush_render_callbacks,\n\tschedule_update,\n\tdirty_components\n} from './scheduler.js';\nimport { current_component, set_current_component } from './lifecycle.js';\nimport { blank_object, is_empty, is_function, run, run_all, noop } from './utils.js';\nimport {\n\tchildren,\n\tdetach,\n\tstart_hydrating,\n\tend_hydrating,\n\tget_custom_elements_slots,\n\tinsert,\n\telement,\n\tattr\n} from './dom.js';\nimport { transition_in } from './transitions.js';\n\n/** @returns {void} */\nexport function bind(component, name, callback) {\n\tconst index = component.$$.props[name];\n\tif (index !== undefined) {\n\t\tcomponent.$$.bound[index] = callback;\n\t\tcallback(component.$$.ctx[index]);\n\t}\n}\n\n/** @returns {void} */\nexport function create_component(block) {\n\tblock && block.c();\n}\n\n/** @returns {void} */\nexport function claim_component(block, parent_nodes) {\n\tblock && block.l(parent_nodes);\n}\n\n/** @returns {void} */\nexport function mount_component(component, target, anchor) {\n\tconst { fragment, after_update } = component.$$;\n\tfragment && fragment.m(target, anchor);\n\t// onMount happens before the initial afterUpdate\n\tadd_render_callback(() => {\n\t\tconst new_on_destroy = component.$$.on_mount.map(run).filter(is_function);\n\t\t// if the component was destroyed immediately\n\t\t// it will update the `$$.on_destroy` reference to `null`.\n\t\t// the destructured on_destroy may still reference to the old array\n\t\tif (component.$$.on_destroy) {\n\t\t\tcomponent.$$.on_destroy.push(...new_on_destroy);\n\t\t} else {\n\t\t\t// Edge case - component was destroyed immediately,\n\t\t\t// most likely as a result of a binding initialising\n\t\t\trun_all(new_on_destroy);\n\t\t}\n\t\tcomponent.$$.on_mount = [];\n\t});\n\tafter_update.forEach(add_render_callback);\n}\n\n/** @returns {void} */\nexport function destroy_component(component, detaching) {\n\tconst $$ = component.$$;\n\tif ($$.fragment !== null) {\n\t\tflush_render_callbacks($$.after_update);\n\t\trun_all($$.on_destroy);\n\t\t$$.fragment && $$.fragment.d(detaching);\n\t\t// TODO null out other refs, including component.$$ (but need to\n\t\t// preserve final state?)\n\t\t$$.on_destroy = $$.fragment = null;\n\t\t$$.ctx = [];\n\t}\n}\n\n/** @returns {void} */\nfunction make_dirty(component, i) {\n\tif (component.$$.dirty[0] === -1) {\n\t\tdirty_components.push(component);\n\t\tschedule_update();\n\t\tcomponent.$$.dirty.fill(0);\n\t}\n\tcomponent.$$.dirty[(i / 31) | 0] |= 1 << i % 31;\n}\n\n// TODO: Document the other params\n/**\n * @param {SvelteComponent} component\n * @param {import('./public.js').ComponentConstructorOptions} options\n *\n * @param {import('./utils.js')['not_equal']} not_equal Used to compare props and state values.\n * @param {(target: Element | ShadowRoot) => void} [append_styles] Function that appends styles to the DOM when the component is first initialised.\n * This will be the `add_css` function from the compiled component.\n *\n * @returns {void}\n */\nexport function init(\n\tcomponent,\n\toptions,\n\tinstance,\n\tcreate_fragment,\n\tnot_equal,\n\tprops,\n\tappend_styles = null,\n\tdirty = [-1]\n) {\n\tconst parent_component = current_component;\n\tset_current_component(component);\n\t/** @type {import('./private.js').T$$} */\n\tconst $$ = (component.$$ = {\n\t\tfragment: null,\n\t\tctx: [],\n\t\t// state\n\t\tprops,\n\t\tupdate: noop,\n\t\tnot_equal,\n\t\tbound: blank_object(),\n\t\t// lifecycle\n\t\ton_mount: [],\n\t\ton_destroy: [],\n\t\ton_disconnect: [],\n\t\tbefore_update: [],\n\t\tafter_update: [],\n\t\tcontext: new Map(options.context || (parent_component ? parent_component.$$.context : [])),\n\t\t// everything else\n\t\tcallbacks: blank_object(),\n\t\tdirty,\n\t\tskip_bound: false,\n\t\troot: options.target || parent_component.$$.root\n\t});\n\tappend_styles && append_styles($$.root);\n\tlet ready = false;\n\t$$.ctx = instance\n\t\t? instance(component, options.props || {}, (i, ret, ...rest) => {\n\t\t\t\tconst value = rest.length ? rest[0] : ret;\n\t\t\t\tif ($$.ctx && not_equal($$.ctx[i], ($$.ctx[i] = value))) {\n\t\t\t\t\tif (!$$.skip_bound && $$.bound[i]) $$.bound[i](value);\n\t\t\t\t\tif (ready) make_dirty(component, i);\n\t\t\t\t}\n\t\t\t\treturn ret;\n\t\t  })\n\t\t: [];\n\t$$.update();\n\tready = true;\n\trun_all($$.before_update);\n\t// `false` as a special case of no DOM component\n\t$$.fragment = create_fragment ? create_fragment($$.ctx) : false;\n\tif (options.target) {\n\t\tif (options.hydrate) {\n\t\t\tstart_hydrating();\n\t\t\t// TODO: what is the correct type here?\n\t\t\t// @ts-expect-error\n\t\t\tconst nodes = children(options.target);\n\t\t\t$$.fragment && $$.fragment.l(nodes);\n\t\t\tnodes.forEach(detach);\n\t\t} else {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n\t\t\t$$.fragment && $$.fragment.c();\n\t\t}\n\t\tif (options.intro) transition_in(component.$$.fragment);\n\t\tmount_component(component, options.target, options.anchor);\n\t\tend_hydrating();\n\t\tflush();\n\t}\n\tset_current_component(parent_component);\n}\n\nexport let SvelteElement;\n\nif (typeof HTMLElement === 'function') {\n\tSvelteElement = class extends HTMLElement {\n\t\t/** The Svelte component constructor */\n\t\t$$ctor;\n\t\t/** Slots */\n\t\t$$s;\n\t\t/** The Svelte component instance */\n\t\t$$c;\n\t\t/** Whether or not the custom element is connected */\n\t\t$$cn = false;\n\t\t/** Component props data */\n\t\t$$d = {};\n\t\t/** `true` if currently in the process of reflecting component props back to attributes */\n\t\t$$r = false;\n\t\t/** @type {Record<string, CustomElementPropDefinition>} Props definition (name, reflected, type etc) */\n\t\t$$p_d = {};\n\t\t/** @type {Record<string, Function[]>} Event listeners */\n\t\t$$l = {};\n\t\t/** @type {Map<Function, Function>} Event listener unsubscribe functions */\n\t\t$$l_u = new Map();\n\n\t\tconstructor($$componentCtor, $$slots, use_shadow_dom) {\n\t\t\tsuper();\n\t\t\tthis.$$ctor = $$componentCtor;\n\t\t\tthis.$$s = $$slots;\n\t\t\tif (use_shadow_dom) {\n\t\t\t\tthis.attachShadow({ mode: 'open' });\n\t\t\t}\n\t\t}\n\n\t\taddEventListener(type, listener, options) {\n\t\t\t// We can't determine upfront if the event is a custom event or not, so we have to\n\t\t\t// listen to both. If someone uses a custom event with the same name as a regular\n\t\t\t// browser event, this fires twice - we can't avoid that.\n\t\t\tthis.$$l[type] = this.$$l[type] || [];\n\t\t\tthis.$$l[type].push(listener);\n\t\t\tif (this.$$c) {\n\t\t\t\tconst unsub = this.$$c.$on(type, listener);\n\t\t\t\tthis.$$l_u.set(listener, unsub);\n\t\t\t}\n\t\t\tsuper.addEventListener(type, listener, options);\n\t\t}\n\n\t\tremoveEventListener(type, listener, options) {\n\t\t\tsuper.removeEventListener(type, listener, options);\n\t\t\tif (this.$$c) {\n\t\t\t\tconst unsub = this.$$l_u.get(listener);\n\t\t\t\tif (unsub) {\n\t\t\t\t\tunsub();\n\t\t\t\t\tthis.$$l_u.delete(listener);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.$$l[type]) {\n\t\t\t\tconst idx = this.$$l[type].indexOf(listener);\n\t\t\t\tif (idx >= 0) {\n\t\t\t\t\tthis.$$l[type].splice(idx, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tasync connectedCallback() {\n\t\t\tthis.$$cn = true;\n\t\t\tif (!this.$$c) {\n\t\t\t\t// We wait one tick to let possible child slot elements be created/mounted\n\t\t\t\tawait Promise.resolve();\n\t\t\t\tif (!this.$$cn || this.$$c) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tfunction create_slot(name) {\n\t\t\t\t\treturn () => {\n\t\t\t\t\t\tlet node;\n\t\t\t\t\t\tconst obj = {\n\t\t\t\t\t\t\tc: function create() {\n\t\t\t\t\t\t\t\tnode = element('slot');\n\t\t\t\t\t\t\t\tif (name !== 'default') {\n\t\t\t\t\t\t\t\t\tattr(node, 'name', name);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t * @param {HTMLElement} target\n\t\t\t\t\t\t\t * @param {HTMLElement} [anchor]\n\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\tm: function mount(target, anchor) {\n\t\t\t\t\t\t\t\tinsert(target, node, anchor);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\td: function destroy(detaching) {\n\t\t\t\t\t\t\t\tif (detaching) {\n\t\t\t\t\t\t\t\t\tdetach(node);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn obj;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tconst $$slots = {};\n\t\t\t\tconst existing_slots = get_custom_elements_slots(this);\n\t\t\t\tfor (const name of this.$$s) {\n\t\t\t\t\tif (name in existing_slots) {\n\t\t\t\t\t\t$$slots[name] = [create_slot(name)];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (const attribute of this.attributes) {\n\t\t\t\t\t// this.$$data takes precedence over this.attributes\n\t\t\t\t\tconst name = this.$$g_p(attribute.name);\n\t\t\t\t\tif (!(name in this.$$d)) {\n\t\t\t\t\t\tthis.$$d[name] = get_custom_element_value(name, attribute.value, this.$$p_d, 'toProp');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Port over props that were set programmatically before ce was initialized\n\t\t\t\tfor (const key in this.$$p_d) {\n\t\t\t\t\tif (!(key in this.$$d) && this[key] !== undefined) {\n\t\t\t\t\t\tthis.$$d[key] = this[key]; // don't transform, these were set through JavaScript\n\t\t\t\t\t\tdelete this[key]; // remove the property that shadows the getter/setter\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.$$c = new this.$$ctor({\n\t\t\t\t\ttarget: this.shadowRoot || this,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\t...this.$$d,\n\t\t\t\t\t\t$$slots,\n\t\t\t\t\t\t$$scope: {\n\t\t\t\t\t\t\tctx: []\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Reflect component props as attributes\n\t\t\t\tconst reflect_attributes = () => {\n\t\t\t\t\tthis.$$r = true;\n\t\t\t\t\tfor (const key in this.$$p_d) {\n\t\t\t\t\t\tthis.$$d[key] = this.$$c.$$.ctx[this.$$c.$$.props[key]];\n\t\t\t\t\t\tif (this.$$p_d[key].reflect) {\n\t\t\t\t\t\t\tconst attribute_value = get_custom_element_value(\n\t\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\t\tthis.$$d[key],\n\t\t\t\t\t\t\t\tthis.$$p_d,\n\t\t\t\t\t\t\t\t'toAttribute'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (attribute_value == null) {\n\t\t\t\t\t\t\t\tthis.removeAttribute(this.$$p_d[key].attribute || key);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis.setAttribute(this.$$p_d[key].attribute || key, attribute_value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.$$r = false;\n\t\t\t\t};\n\t\t\t\tthis.$$c.$$.after_update.push(reflect_attributes);\n\t\t\t\treflect_attributes(); // once initially because after_update is added too late for first render\n\n\t\t\t\tfor (const type in this.$$l) {\n\t\t\t\t\tfor (const listener of this.$$l[type]) {\n\t\t\t\t\t\tconst unsub = this.$$c.$on(type, listener);\n\t\t\t\t\t\tthis.$$l_u.set(listener, unsub);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.$$l = {};\n\t\t\t}\n\t\t}\n\n\t\t// We don't need this when working within Svelte code, but for compatibility of people using this outside of Svelte\n\t\t// and setting attributes through setAttribute etc, this is helpful\n\t\tattributeChangedCallback(attr, _oldValue, newValue) {\n\t\t\tif (this.$$r) return;\n\t\t\tattr = this.$$g_p(attr);\n\t\t\tthis.$$d[attr] = get_custom_element_value(attr, newValue, this.$$p_d, 'toProp');\n\t\t\tthis.$$c?.$set({ [attr]: this.$$d[attr] });\n\t\t}\n\n\t\tdisconnectedCallback() {\n\t\t\tthis.$$cn = false;\n\t\t\t// In a microtask, because this could be a move within the DOM\n\t\t\tPromise.resolve().then(() => {\n\t\t\t\tif (!this.$$cn && this.$$c) {\n\t\t\t\t\tthis.$$c.$destroy();\n\t\t\t\t\tthis.$$c = undefined;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t$$g_p(attribute_name) {\n\t\t\treturn (\n\t\t\t\tObject.keys(this.$$p_d).find(\n\t\t\t\t\t(key) =>\n\t\t\t\t\t\tthis.$$p_d[key].attribute === attribute_name ||\n\t\t\t\t\t\t(!this.$$p_d[key].attribute && key.toLowerCase() === attribute_name)\n\t\t\t\t) || attribute_name\n\t\t\t);\n\t\t}\n\t};\n}\n\n/**\n * @param {string} prop\n * @param {any} value\n * @param {Record<string, CustomElementPropDefinition>} props_definition\n * @param {'toAttribute' | 'toProp'} [transform]\n */\nfunction get_custom_element_value(prop, value, props_definition, transform) {\n\tconst type = props_definition[prop]?.type;\n\tvalue = type === 'Boolean' && typeof value !== 'boolean' ? value != null : value;\n\tif (!transform || !props_definition[prop]) {\n\t\treturn value;\n\t} else if (transform === 'toAttribute') {\n\t\tswitch (type) {\n\t\t\tcase 'Object':\n\t\t\tcase 'Array':\n\t\t\t\treturn value == null ? null : JSON.stringify(value);\n\t\t\tcase 'Boolean':\n\t\t\t\treturn value ? '' : null;\n\t\t\tcase 'Number':\n\t\t\t\treturn value == null ? null : value;\n\t\t\tdefault:\n\t\t\t\treturn value;\n\t\t}\n\t} else {\n\t\tswitch (type) {\n\t\t\tcase 'Object':\n\t\t\tcase 'Array':\n\t\t\t\treturn value && JSON.parse(value);\n\t\t\tcase 'Boolean':\n\t\t\t\treturn value; // conversion already handled above\n\t\t\tcase 'Number':\n\t\t\t\treturn value != null ? +value : value;\n\t\t\tdefault:\n\t\t\t\treturn value;\n\t\t}\n\t}\n}\n\n/**\n * @internal\n *\n * Turn a Svelte component into a custom element.\n * @param {import('./public.js').ComponentType} Component  A Svelte component constructor\n * @param {Record<string, CustomElementPropDefinition>} props_definition  The props to observe\n * @param {string[]} slots  The slots to create\n * @param {string[]} accessors  Other accessors besides the ones for props the component has\n * @param {boolean} use_shadow_dom  Whether to use shadow DOM\n * @param {(ce: new () => HTMLElement) => new () => HTMLElement} [extend]\n */\nexport function create_custom_element(\n\tComponent,\n\tprops_definition,\n\tslots,\n\taccessors,\n\tuse_shadow_dom,\n\textend\n) {\n\tlet Class = class extends SvelteElement {\n\t\tconstructor() {\n\t\t\tsuper(Component, slots, use_shadow_dom);\n\t\t\tthis.$$p_d = props_definition;\n\t\t}\n\t\tstatic get observedAttributes() {\n\t\t\treturn Object.keys(props_definition).map((key) =>\n\t\t\t\t(props_definition[key].attribute || key).toLowerCase()\n\t\t\t);\n\t\t}\n\t};\n\tObject.keys(props_definition).forEach((prop) => {\n\t\tObject.defineProperty(Class.prototype, prop, {\n\t\t\tget() {\n\t\t\t\treturn this.$$c && prop in this.$$c ? this.$$c[prop] : this.$$d[prop];\n\t\t\t},\n\t\t\tset(value) {\n\t\t\t\tvalue = get_custom_element_value(prop, value, props_definition);\n\t\t\t\tthis.$$d[prop] = value;\n\t\t\t\tthis.$$c?.$set({ [prop]: value });\n\t\t\t}\n\t\t});\n\t});\n\taccessors.forEach((accessor) => {\n\t\tObject.defineProperty(Class.prototype, accessor, {\n\t\t\tget() {\n\t\t\t\treturn this.$$c?.[accessor];\n\t\t\t}\n\t\t});\n\t});\n\tif (extend) {\n\t\t// @ts-expect-error - assigning here is fine\n\t\tClass = extend(Class);\n\t}\n\tComponent.element = /** @type {any} */ (Class);\n\treturn Class;\n}\n\n/**\n * Base class for Svelte components. Used when dev=false.\n *\n * @template {Record<string, any>} [Props=any]\n * @template {Record<string, any>} [Events=any]\n */\nexport class SvelteComponent {\n\t/**\n\t * ### PRIVATE API\n\t *\n\t * Do not use, may change at any time\n\t *\n\t * @type {any}\n\t */\n\t$$ = undefined;\n\t/**\n\t * ### PRIVATE API\n\t *\n\t * Do not use, may change at any time\n\t *\n\t * @type {any}\n\t */\n\t$$set = undefined;\n\n\t/** @returns {void} */\n\t$destroy() {\n\t\tdestroy_component(this, 1);\n\t\tthis.$destroy = noop;\n\t}\n\n\t/**\n\t * @template {Extract<keyof Events, string>} K\n\t * @param {K} type\n\t * @param {((e: Events[K]) => void) | null | undefined} callback\n\t * @returns {() => void}\n\t */\n\t$on(type, callback) {\n\t\tif (!is_function(callback)) {\n\t\t\treturn noop;\n\t\t}\n\t\tconst callbacks = this.$$.callbacks[type] || (this.$$.callbacks[type] = []);\n\t\tcallbacks.push(callback);\n\t\treturn () => {\n\t\t\tconst index = callbacks.indexOf(callback);\n\t\t\tif (index !== -1) callbacks.splice(index, 1);\n\t\t};\n\t}\n\n\t/**\n\t * @param {Partial<Props>} props\n\t * @returns {void}\n\t */\n\t$set(props) {\n\t\tif (this.$$set && !is_empty(props)) {\n\t\t\tthis.$$.skip_bound = true;\n\t\t\tthis.$$set(props);\n\t\t\tthis.$$.skip_bound = false;\n\t\t}\n\t}\n}\n\n/**\n * @typedef {Object} CustomElementPropDefinition\n * @property {string} [attribute]\n * @property {boolean} [reflect]\n * @property {'String'|'Boolean'|'Number'|'Array'|'Object'} [type]\n */\n","// generated during release, do not modify\n\n/**\n * The current version, as set in package.json.\n *\n * https://svelte.dev/docs/svelte-compiler#svelte-version\n * @type {string}\n */\nexport const VERSION = '4.2.20';\nexport const PUBLIC_VERSION = '4';\n","import {\n\trun_all,\n\tsubscribe,\n\tnoop,\n\tsafe_not_equal,\n\tis_function,\n\tget_store_value\n} from '../internal/index.js';\n\nconst subscriber_queue = [];\n\n/**\n * Creates a `Readable` store that allows reading by subscription.\n *\n * https://svelte.dev/docs/svelte-store#readable\n * @template T\n * @param {T} [value] initial value\n * @param {import('./public.js').StartStopNotifier<T>} [start]\n * @returns {import('./public.js').Readable<T>}\n */\nexport function readable(value, start) {\n\treturn {\n\t\tsubscribe: writable(value, start).subscribe\n\t};\n}\n\n/**\n * Create a `Writable` store that allows both updating and reading by subscription.\n *\n * https://svelte.dev/docs/svelte-store#writable\n * @template T\n * @param {T} [value] initial value\n * @param {import('./public.js').StartStopNotifier<T>} [start]\n * @returns {import('./public.js').Writable<T>}\n */\nexport function writable(value, start = noop) {\n\t/** @type {import('./public.js').Unsubscriber} */\n\tlet stop;\n\t/** @type {Set<import('./private.js').SubscribeInvalidateTuple<T>>} */\n\tconst subscribers = new Set();\n\t/** @param {T} new_value\n\t * @returns {void}\n\t */\n\tfunction set(new_value) {\n\t\tif (safe_not_equal(value, new_value)) {\n\t\t\tvalue = new_value;\n\t\t\tif (stop) {\n\t\t\t\t// store is ready\n\t\t\t\tconst run_queue = !subscriber_queue.length;\n\t\t\t\tfor (const subscriber of subscribers) {\n\t\t\t\t\tsubscriber[1]();\n\t\t\t\t\tsubscriber_queue.push(subscriber, value);\n\t\t\t\t}\n\t\t\t\tif (run_queue) {\n\t\t\t\t\tfor (let i = 0; i < subscriber_queue.length; i += 2) {\n\t\t\t\t\t\tsubscriber_queue[i][0](subscriber_queue[i + 1]);\n\t\t\t\t\t}\n\t\t\t\t\tsubscriber_queue.length = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @param {import('./public.js').Updater<T>} fn\n\t * @returns {void}\n\t */\n\tfunction update(fn) {\n\t\tset(fn(value));\n\t}\n\n\t/**\n\t * @param {import('./public.js').Subscriber<T>} run\n\t * @param {import('./private.js').Invalidator<T>} [invalidate]\n\t * @returns {import('./public.js').Unsubscriber}\n\t */\n\tfunction subscribe(run, invalidate = noop) {\n\t\t/** @type {import('./private.js').SubscribeInvalidateTuple<T>} */\n\t\tconst subscriber = [run, invalidate];\n\t\tsubscribers.add(subscriber);\n\t\tif (subscribers.size === 1) {\n\t\t\tstop = start(set, update) || noop;\n\t\t}\n\t\trun(value);\n\t\treturn () => {\n\t\t\tsubscribers.delete(subscriber);\n\t\t\tif (subscribers.size === 0 && stop) {\n\t\t\t\tstop();\n\t\t\t\tstop = null;\n\t\t\t}\n\t\t};\n\t}\n\treturn { set, update, subscribe };\n}\n\n/**\n * Derived value store by synchronizing one or more readable stores and\n * applying an aggregation function over its input values.\n *\n * https://svelte.dev/docs/svelte-store#derived\n * @template {import('./private.js').Stores} S\n * @template T\n * @overload\n * @param {S} stores - input stores\n * @param {(values: import('./private.js').StoresValues<S>, set: (value: T) => void, update: (fn: import('./public.js').Updater<T>) => void) => import('./public.js').Unsubscriber | void} fn - function callback that aggregates the values\n * @param {T} [initial_value] - initial value\n * @returns {import('./public.js').Readable<T>}\n */\n\n/**\n * Derived value store by synchronizing one or more readable stores and\n * applying an aggregation function over its input values.\n *\n * https://svelte.dev/docs/svelte-store#derived\n * @template {import('./private.js').Stores} S\n * @template T\n * @overload\n * @param {S} stores - input stores\n * @param {(values: import('./private.js').StoresValues<S>) => T} fn - function callback that aggregates the values\n * @param {T} [initial_value] - initial value\n * @returns {import('./public.js').Readable<T>}\n */\n\n/**\n * @template {import('./private.js').Stores} S\n * @template T\n * @param {S} stores\n * @param {Function} fn\n * @param {T} [initial_value]\n * @returns {import('./public.js').Readable<T>}\n */\nexport function derived(stores, fn, initial_value) {\n\tconst single = !Array.isArray(stores);\n\t/** @type {Array<import('./public.js').Readable<any>>} */\n\tconst stores_array = single ? [stores] : stores;\n\tif (!stores_array.every(Boolean)) {\n\t\tthrow new Error('derived() expects stores as input, got a falsy value');\n\t}\n\tconst auto = fn.length < 2;\n\treturn readable(initial_value, (set, update) => {\n\t\tlet started = false;\n\t\tconst values = [];\n\t\tlet pending = 0;\n\t\tlet cleanup = noop;\n\t\tconst sync = () => {\n\t\t\tif (pending) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcleanup();\n\t\t\tconst result = fn(single ? values[0] : values, set, update);\n\t\t\tif (auto) {\n\t\t\t\tset(result);\n\t\t\t} else {\n\t\t\t\tcleanup = is_function(result) ? result : noop;\n\t\t\t}\n\t\t};\n\t\tconst unsubscribers = stores_array.map((store, i) =>\n\t\t\tsubscribe(\n\t\t\t\tstore,\n\t\t\t\t(value) => {\n\t\t\t\t\tvalues[i] = value;\n\t\t\t\t\tpending &= ~(1 << i);\n\t\t\t\t\tif (started) {\n\t\t\t\t\t\tsync();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t() => {\n\t\t\t\t\tpending |= 1 << i;\n\t\t\t\t}\n\t\t\t)\n\t\t);\n\t\tstarted = true;\n\t\tsync();\n\t\treturn function stop() {\n\t\t\trun_all(unsubscribers);\n\t\t\tcleanup();\n\t\t\t// We need to set this to false because callbacks can still happen despite having unsubscribed:\n\t\t\t// Callbacks might already be placed in the queue which doesn't know it should no longer\n\t\t\t// invoke this derived store.\n\t\t\tstarted = false;\n\t\t};\n\t});\n}\n\n/**\n * Takes a store and returns a new one derived from the old one that is readable.\n *\n * https://svelte.dev/docs/svelte-store#readonly\n * @template T\n * @param {import('./public.js').Readable<T>} store  - store to make readonly\n * @returns {import('./public.js').Readable<T>}\n */\nexport function readonly(store) {\n\treturn {\n\t\tsubscribe: store.subscribe.bind(store)\n\t};\n}\n\nexport { get_store_value as get };\n","/**\n * Provides a basic test for a given variable to test if it has the shape of a readable store by having a `subscribe`\n * function.\n *\n * Note: functions are also objects, so test that the variable might be a function w/ a `subscribe` function.\n *\n * @param {*}  store - variable to test that might be a store.\n *\n * @returns {boolean} Whether the variable tested has the shape of a store.\n */\nfunction isReadableStore(store)\n{\n   if (store === null || store === void 0) { return false; }\n\n   switch (typeof store)\n   {\n      case 'function':\n      case 'object':\n         return typeof store.subscribe === 'function';\n   }\n\n   return false;\n}\n\n/**\n * Provides a basic test for a given variable to test if it has the shape of a minimal writable store by having a\n * `subscribe` and `set` functions.\n *\n * Note: functions are also objects, so test that the variable might be a function w/ `subscribe` & `set` functions.\n *\n * @param {*}  store - variable to test that might be a store.\n *\n * @returns {boolean} Whether the variable tested has the shape of a {@link MinimalWritable} store.\n */\nfunction isMinimalWritableStore(store)\n{\n   if (store === null || store === void 0) { return false; }\n\n   switch (typeof store)\n   {\n      case 'function':\n      case 'object':\n         return typeof store.subscribe === 'function' && typeof store.set === 'function';\n   }\n\n   return false;\n}\n\n/**\n * Provides a basic test for a given variable to test if it has the shape of a writable store by having a `subscribe`\n * `set`, and `update` functions.\n *\n * Note: functions are also objects, so test that the variable might be a function w/ `subscribe`, `set, and `update`\n * functions.\n *\n * @param {*}  store - variable to test that might be a store.\n *\n * @returns {boolean} Whether the variable tested has the shape of a store.\n */\nfunction isWritableStore(store)\n{\n   if (store === null || store === void 0) { return false; }\n\n   switch (typeof store)\n   {\n      case 'function':\n      case 'object':\n         return typeof store.subscribe === 'function' && typeof store.set === 'function' &&\n          typeof store.update === 'function';\n   }\n\n   return false;\n}\n\n/**\n * Subscribes to the given store with the update function provided and ignores the first automatic\n * update. All future updates are dispatched to the update function.\n *\n * @param {import('svelte/store').Readable | import('svelte/store').Writable} store -\n *  Store to subscribe to...\n *\n * @param {import('svelte/store').Updater} update - function to receive future updates.\n *\n * @returns {import('svelte/store').Unsubscriber} Store unsubscribe function.\n */\nfunction subscribeIgnoreFirst(store, update)\n{\n   let firedFirst = false;\n\n   return store.subscribe((value) =>\n   {\n      if (!firedFirst)\n      {\n         firedFirst = true;\n      }\n      else\n      {\n         update(value);\n      }\n   });\n}\n\n/**\n * Subscribes to the given store with two update functions provided. The first function is invoked on the initial\n * subscription. All future updates are dispatched to the update function.\n *\n * @param {import('svelte/store').Readable | import('svelte/store').Writable} store -\n *  Store to subscribe to...\n *\n * @param {import('svelte/store').Updater} first - Function to receive first update.\n *\n * @param {import('svelte/store').Updater} update - Function to receive future updates.\n *\n * @returns {import('svelte/store').Unsubscriber} Store unsubscribe function.\n */\nfunction subscribeFirstRest(store, first, update)\n{\n   let firedFirst = false;\n\n   return store.subscribe((value) =>\n   {\n      if (!firedFirst)\n      {\n         firedFirst = true;\n         first(value);\n      }\n      else\n      {\n         update(value);\n      }\n   });\n}\n\nexport { isMinimalWritableStore, isReadableStore, isWritableStore, subscribeFirstRest, subscribeIgnoreFirst };\n//# sourceMappingURL=index.js.map\n","function set(obj, key, val) {\n\tif (typeof val.value === 'object') val.value = klona(val.value);\n\tif (!val.enumerable || val.get || val.set || !val.configurable || !val.writable || key === '__proto__') {\n\t\tObject.defineProperty(obj, key, val);\n\t} else obj[key] = val.value;\n}\n\nfunction klona(x) {\n\tif (typeof x !== 'object') return x;\n\n\tvar i=0, k, list, tmp, str=Object.prototype.toString.call(x);\n\n\tif (str === '[object Object]') {\n\t\ttmp = Object.create(x.__proto__ || null);\n\t} else if (str === '[object Array]') {\n\t\ttmp = Array(x.length);\n\t} else if (str === '[object Set]') {\n\t\ttmp = new Set;\n\t\tx.forEach(function (val) {\n\t\t\ttmp.add(klona(val));\n\t\t});\n\t} else if (str === '[object Map]') {\n\t\ttmp = new Map;\n\t\tx.forEach(function (val, key) {\n\t\t\ttmp.set(klona(key), klona(val));\n\t\t});\n\t} else if (str === '[object Date]') {\n\t\ttmp = new Date(+x);\n\t} else if (str === '[object RegExp]') {\n\t\ttmp = new RegExp(x.source, x.flags);\n\t} else if (str === '[object DataView]') {\n\t\ttmp = new x.constructor( klona(x.buffer) );\n\t} else if (str === '[object ArrayBuffer]') {\n\t\ttmp = x.slice(0);\n\t} else if (str.slice(-6) === 'Array]') {\n\t\t// ArrayBuffer.isView(x)\n\t\t// ~> `new` bcuz `Buffer.slice` => ref\n\t\ttmp = new x.constructor(x);\n\t}\n\n\tif (tmp) {\n\t\tfor (list=Object.getOwnPropertySymbols(x); i < list.length; i++) {\n\t\t\tset(tmp, list[i], Object.getOwnPropertyDescriptor(x, list[i]));\n\t\t}\n\n\t\tfor (i=0, list=Object.getOwnPropertyNames(x); i < list.length; i++) {\n\t\t\tif (Object.hasOwnProperty.call(tmp, k=list[i]) && tmp[k] === x[k]) continue;\n\t\t\tset(tmp, k, Object.getOwnPropertyDescriptor(x, k));\n\t\t}\n\t}\n\n\treturn tmp || x;\n}\n\n/**\n * Provides common object manipulation utility functions and TypeScript type guards.\n *\n * @packageDocumentation\n */\n/**\n * Freezes all entries traversed that are objects including entries in arrays.\n *\n * @param data - An object or array.\n *\n * @param [options] - Options\n *\n * @param [options.skipKeys] - A Set of strings indicating keys of objects to not freeze.\n *\n * @returns The frozen object.\n *\n * @typeParam T - Type of data.\n */\nfunction deepFreeze(data, { skipKeys } = {}) {\n    if (typeof data !== 'object' || data === null) {\n        throw new TypeError(`deepFreeze error: 'data' is not an object or array.`);\n    }\n    if (skipKeys !== void 0 && Object.prototype.toString.call(skipKeys) !== '[object Set]') {\n        throw new TypeError(`deepFreeze error: 'options.skipKeys' is not a Set.`);\n    }\n    const stack = [data];\n    while (stack.length > 0) {\n        const obj = stack.pop();\n        if (typeof obj !== 'object' || obj === null || Object.isFrozen(obj)) {\n            continue;\n        }\n        // Collect nested properties before freezing.\n        const children = [];\n        if (Array.isArray(obj)) {\n            for (let cntr = 0; cntr < obj.length; cntr++) {\n                children.push(obj[cntr]);\n            }\n        }\n        else {\n            for (const key in obj) {\n                if (Object.hasOwn(obj, key) && !skipKeys?.has?.(key)) {\n                    children.push(obj[key]);\n                }\n            }\n        }\n        // Freeze after collecting children to avoid modifying a frozen object.\n        Object.freeze(obj);\n        // Push collected children onto the stack for further processing.\n        stack.push(...children);\n    }\n    return data;\n}\nfunction deepMerge(target, ...sourceObj) {\n    if (Object.prototype.toString.call(target) !== '[object Object]') {\n        throw new TypeError(`deepMerge error: 'target' is not an object.`);\n    }\n    if (sourceObj.length === 0) {\n        throw new TypeError(`deepMerge error: 'sourceObj' is not an object.`);\n    }\n    for (let cntr = 0; cntr < sourceObj.length; cntr++) {\n        if (Object.prototype.toString.call(sourceObj[cntr]) !== '[object Object]') {\n            throw new TypeError(`deepMerge error: 'sourceObj[${cntr}]' is not an object.`);\n        }\n    }\n    // When merging a single source object there is an implementation that is twice as fast as multiple source objects.\n    if (sourceObj.length === 1) {\n        const stack = [];\n        for (const obj of sourceObj) {\n            stack.push({ target, source: obj });\n        }\n        while (stack.length > 0) {\n            const { target, source } = stack.pop(); // LIFO but maintains correct merge order.\n            for (const prop in source) {\n                if (Object.hasOwn(source, prop)) {\n                    const sourceValue = source[prop];\n                    const targetValue = target[prop];\n                    // If both values are plain objects, enqueue for further merging.\n                    if (Object.hasOwn(target, prop) && targetValue?.constructor === Object &&\n                        sourceValue?.constructor === Object) {\n                        stack.push({ target: targetValue, source: sourceValue });\n                    }\n                    else {\n                        target[prop] = sourceValue;\n                    }\n                }\n            }\n        }\n    }\n    else // Stack implementation for multiple source objects.\n     {\n        const stack = [{ target, sources: sourceObj }];\n        while (stack.length > 0) {\n            const { target, sources } = stack.pop();\n            for (const source of sources) {\n                for (const prop in source) {\n                    if (Object.hasOwn(source, prop)) {\n                        const sourceValue = source[prop];\n                        const targetValue = target[prop];\n                        // If both values are plain objects, push for further merging with a new object.\n                        if (Object.hasOwn(target, prop) && targetValue?.constructor === Object &&\n                            sourceValue?.constructor === Object) {\n                            target[prop] = Object.assign({}, targetValue); // Copy existing target data.\n                            stack.push({ target: target[prop], sources: [sourceValue] });\n                        }\n                        else {\n                            target[prop] = sourceValue;\n                        }\n                    }\n                }\n            }\n        }\n    }\n    return target;\n}\n/**\n * Seals all entries traversed that are objects including entries in arrays.\n *\n * @param data - An object or array.\n *\n * @param [options] - Options\n *\n * @param [options.skipKeys] - A Set of strings indicating keys of objects to not seal.\n *\n * @returns The sealed object.\n *\n * @typeParam T - Type of data.\n */\nfunction deepSeal(data, { skipKeys } = {}) {\n    if (typeof data !== 'object' || data === null) {\n        throw new TypeError(`deepSeal error: 'data' is not an object or array.`);\n    }\n    if (skipKeys !== void 0 && Object.prototype.toString.call(skipKeys) !== '[object Set]') {\n        throw new TypeError(`deepSeal error: 'options.skipKeys' is not a Set.`);\n    }\n    const stack = [data];\n    while (stack.length > 0) {\n        const obj = stack.pop();\n        if (typeof obj !== 'object' || obj === null || Object.isSealed(obj)) {\n            continue;\n        }\n        // Collect nested properties before freezing.\n        const children = [];\n        if (Array.isArray(obj)) {\n            for (let cntr = 0; cntr < obj.length; cntr++) {\n                children.push(obj[cntr]);\n            }\n        }\n        else {\n            for (const key in obj) {\n                if (Object.hasOwn(obj, key) && !skipKeys?.has?.(key)) {\n                    children.push(obj[key]);\n                }\n            }\n        }\n        // Freeze after collecting children to avoid modifying a frozen object.\n        Object.seal(obj);\n        // Push collected children onto the stack for further processing.\n        stack.push(...children);\n    }\n    return data;\n}\n/**\n * Determine if the given object has a getter & setter accessor.\n *\n * @param object - An object.\n *\n * @param accessor - Accessor to test.\n *\n * @returns Whether the given object has the getter and setter for accessor.\n *\n * @typeParam T - Type of data.\n * @typeParam K - Accessor key.\n */\nfunction hasAccessor(object, accessor) {\n    if (typeof object !== 'object' || object === null || object === void 0) {\n        return false;\n    }\n    // Check for instance accessor.\n    const iDescriptor = Object.getOwnPropertyDescriptor(object, accessor);\n    if (iDescriptor !== void 0 && iDescriptor.get !== void 0 && iDescriptor.set !== void 0) {\n        return true;\n    }\n    // Walk parent prototype chain. Check for descriptor at each prototype level.\n    for (let o = Object.getPrototypeOf(object); o; o = Object.getPrototypeOf(o)) {\n        const descriptor = Object.getOwnPropertyDescriptor(o, accessor);\n        if (descriptor !== void 0 && descriptor.get !== void 0 && descriptor.set !== void 0) {\n            return true;\n        }\n    }\n    return false;\n}\n/**\n * Determine if the given object has a getter accessor.\n *\n * @param object - An object.\n *\n * @param accessor - Accessor to test.\n *\n * @returns Whether the given object has the getter for accessor.\n *\n * @typeParam T - Type of data.\n * @typeParam K - Accessor key.\n */\nfunction hasGetter(object, accessor) {\n    if (typeof object !== 'object' || object === null || object === void 0) {\n        return false;\n    }\n    // Check for instance accessor.\n    const iDescriptor = Object.getOwnPropertyDescriptor(object, accessor);\n    if (iDescriptor !== void 0 && iDescriptor.get !== void 0) {\n        return true;\n    }\n    // Walk parent prototype chain. Check for descriptor at each prototype level.\n    for (let o = Object.getPrototypeOf(object); o; o = Object.getPrototypeOf(o)) {\n        const descriptor = Object.getOwnPropertyDescriptor(o, accessor);\n        if (descriptor !== void 0 && descriptor.get !== void 0) {\n            return true;\n        }\n    }\n    return false;\n}\n/**\n * Returns whether the target is or has the given prototype walking up the prototype chain.\n *\n * @param target - Any target class / constructor function to test.\n *\n * @param Prototype - Class / constructor function to find.\n *\n * @returns Target matches prototype.\n *\n * @typeParam T - Prototype class / constructor.\n */\nfunction hasPrototype(target, Prototype) {\n    if (typeof target !== 'function') {\n        return false;\n    }\n    if (target === Prototype) {\n        return true;\n    }\n    // Walk parent prototype chain. Check for descriptor at each prototype level.\n    for (let proto = Object.getPrototypeOf(target); proto; proto = Object.getPrototypeOf(proto)) {\n        if (proto === Prototype) {\n            return true;\n        }\n    }\n    return false;\n}\n/**\n * Determine if the given object has a setter accessor.\n *\n * @param object - An object.\n *\n * @param accessor - Accessor to test.\n *\n * @returns Whether the given object has the setter for accessor.\n *\n * @typeParam T - Type of data.\n * @typeParam K - Accessor key.\n */\nfunction hasSetter(object, accessor) {\n    if (typeof object !== 'object' || object === null || object === void 0) {\n        return false;\n    }\n    // Check for instance accessor.\n    const iDescriptor = Object.getOwnPropertyDescriptor(object, accessor);\n    if (iDescriptor !== void 0 && iDescriptor.set !== void 0) {\n        return true;\n    }\n    // Walk parent prototype chain. Check for descriptor at each prototype level.\n    for (let o = Object.getPrototypeOf(object); o; o = Object.getPrototypeOf(o)) {\n        const descriptor = Object.getOwnPropertyDescriptor(o, accessor);\n        if (descriptor !== void 0 && descriptor.set !== void 0) {\n            return true;\n        }\n    }\n    return false;\n}\n/**\n * Tests for whether an object is async iterable.\n *\n * @param value - Any value.\n *\n * @returns Whether value is async iterable.\n */\nfunction isAsyncIterable(value) {\n    if (typeof value !== 'object' || value === null || value === void 0) {\n        return false;\n    }\n    return Symbol.asyncIterator in value;\n}\n/**\n * Tests for whether an object is iterable.\n *\n * @param value - Any value.\n *\n * @returns Whether object is iterable.\n */\nfunction isIterable(value) {\n    if (value === null || value === void 0 || typeof value !== 'object') {\n        return false;\n    }\n    return Symbol.iterator in value;\n}\n/**\n * Tests for whether object is not null, typeof object, and not an array.\n *\n * @param value - Any value.\n *\n * @returns Is it an object.\n */\nfunction isObject(value) {\n    return value !== null && typeof value === 'object' && !Array.isArray(value);\n}\n/**\n * Tests for whether the given value is a plain object.\n *\n * An object is plain if it is created by either: `{}`, `new Object()` or `Object.create(null)`.\n *\n * @param value - Any value\n *\n * @returns Is it a plain object.\n */\nfunction isPlainObject(value) {\n    if (Object.prototype.toString.call(value) !== '[object Object]') {\n        return false;\n    }\n    const prototype = Object.getPrototypeOf(value);\n    return prototype === null || prototype === Object.prototype;\n}\n/**\n * Safely returns keys on an object or an empty array if not an object.\n *\n * @param object - An object.\n *\n * @returns Object keys or empty array.\n */\nfunction objectKeys(object) {\n    return typeof object === 'object' && object !== null ? Object.keys(object) : [];\n}\n/**\n * Safely returns an objects size. Note for String objects Unicode is not taken into consideration.\n *\n * @param object - Any value, but size returned for object / Map / Set / arrays / strings.\n *\n * @returns Size of object.\n */\nfunction objectSize(object) {\n    if (object === void 0 || object === null || typeof object !== 'object') {\n        return 0;\n    }\n    const tag = Object.prototype.toString.call(object);\n    if (tag === '[object Map]' || tag === '[object Set]') {\n        return object.size;\n    }\n    if (tag === '[object String]') {\n        return object.length;\n    }\n    return Object.keys(object).length;\n}\n/**\n * Provides a way to safely access an objects data / entries given an accessor string which describes the\n * entries to walk. To access deeper entries into the object format the accessor string with `.` between entries\n * to walk.\n *\n * @param data - An object to access entry data.\n *\n * @param accessor - A string describing the entries to access with keys separated by `.`.\n *\n * @param [defaultValue] - (Optional) A default value to return if an entry for accessor is not found.\n *\n * @returns The value referenced by the accessor.\n *\n * @typeParam T - Type of data.\n * @typeParam P - Accessor type.\n * @typeParam R - Return value / Inferred deep access type or any provided default value type.\n */\nfunction safeAccess(data, accessor, defaultValue) {\n    if (typeof data !== 'object' || data === null) {\n        return defaultValue;\n    }\n    if (typeof accessor !== 'string') {\n        return defaultValue;\n    }\n    const keys = accessor.split('.');\n    let result = data;\n    // Walk through the given object by the accessor indexes.\n    for (let cntr = 0; cntr < keys.length; cntr++) {\n        // If the next level of object access is undefined or null then return the default value.\n        if (result[keys[cntr]] === void 0 || result[keys[cntr]] === null) {\n            return defaultValue;\n        }\n        result = result[keys[cntr]];\n    }\n    return result;\n}\n/**\n * Compares a source object and values of entries against a target object. If the entries in the source object match\n * the target object then `true` is returned otherwise `false`. If either object is undefined or null then false\n * is returned.\n *\n * Note: The source and target should be JSON objects.\n *\n * @param source - Source object.\n *\n * @param target - Target object.\n *\n * @param [options] - Options.\n *\n * @param [options.arrayIndex] - Set to `false` to exclude equality testing for array contents; default: `true`.\n *\n * @param [options.hasOwnOnly] - Set to `false` to include enumerable prototype properties; default: `true`.\n *\n * @returns True if equal.\n */\nfunction safeEqual(source, target, options) {\n    if (typeof source !== 'object' || source === null || typeof target !== 'object' || target === null) {\n        return false;\n    }\n    for (const accessor of safeKeyIterator(source, options)) {\n        const sourceObjectValue = safeAccess(source, accessor);\n        const targetObjectValue = safeAccess(target, accessor);\n        if (sourceObjectValue !== targetObjectValue) {\n            return false;\n        }\n    }\n    return true;\n}\n/**\n * Returns an iterator of safe keys useful with {@link safeAccess} and {@link safeSet} by traversing the given object.\n *\n * Note: Keys are only generated for JSON objects; {@link Map} and {@link Set} are not indexed.\n *\n * @param data - An object to traverse for accessor keys.\n *\n * @param [options] - Options.\n *\n * @param [options.arrayIndex] - Set to `false` to exclude safe keys for array indexing; default: `true`.\n *\n * @param [options.hasOwnOnly] - Set to `false` to include enumerable prototype properties; default: `true`.\n *\n * @returns Safe key iterator.\n */\nfunction* safeKeyIterator(data, { arrayIndex = true, hasOwnOnly = true } = {}) {\n    if (typeof data !== 'object' || data === null) {\n        throw new TypeError(`safeKeyIterator error: 'data' is not an object.`);\n    }\n    if (typeof arrayIndex !== 'boolean') {\n        throw new TypeError(`safeKeyIterator error: 'options.arrayIndex' is not a boolean.`);\n    }\n    if (typeof hasOwnOnly !== 'boolean') {\n        throw new TypeError(`safeKeyIterator error: 'options.hasOwnOnly' is not a boolean.`);\n    }\n    const stack = [{ obj: data, prefix: '' }];\n    while (stack.length > 0) {\n        const { obj, prefix } = stack.pop();\n        for (const key in obj) {\n            if (hasOwnOnly && !Object.hasOwn(obj, key)) {\n                continue;\n            }\n            const fullKey = prefix ? `${prefix}.${key}` : key;\n            const value = obj[key];\n            if (Array.isArray(value)) {\n                if (!arrayIndex) {\n                    continue;\n                }\n                for (let cntr = 0; cntr < value.length; cntr++) {\n                    yield `${fullKey}.${cntr}`;\n                }\n            }\n            else if (typeof value === 'object' && value !== null) {\n                stack.push({ obj: value, prefix: fullKey }); // Push to stack for DFS traversal.\n            }\n            else if (typeof value !== 'function') {\n                yield fullKey;\n            }\n        }\n    }\n}\n/**\n * Provides a way to safely set an objects data / entries given an accessor string which describes the\n * entries to walk. To access deeper entries into the object format the accessor string with `.` between entries\n * to walk.\n *\n * @param data - An object to access entry data.\n *\n * @param accessor - A string describing the entries to access.\n *\n * @param value - A new value to set if an entry for accessor is found.\n *\n * @param [options] - Options.\n *\n * @param [options.operation] - Operation to perform including: `add`, `div`, `mult`, `set`, `set-undefined`, `sub`;\n *        default: `set`.\n *\n * @param [options.createMissing] - If `true` missing accessor entries will be created as objects automatically;\n *        default: `false`.\n *\n * @returns True if successful.\n */\nfunction safeSet(data, accessor, value, { operation = 'set', createMissing = false } = {}) {\n    if (typeof data !== 'object' || data === null) {\n        throw new TypeError(`safeSet error: 'data' is not an object.`);\n    }\n    if (typeof accessor !== 'string') {\n        throw new TypeError(`safeSet error: 'accessor' is not a string.`);\n    }\n    if (typeof operation !== 'string') {\n        throw new TypeError(`safeSet error: 'options.operation' is not a string.`);\n    }\n    if (operation !== 'add' && operation !== 'div' && operation !== 'mult' && operation !== 'set' &&\n        operation !== 'set-undefined' && operation !== 'sub') {\n        throw new Error(`safeSet error: Unknown 'options.operation'.`);\n    }\n    if (typeof createMissing !== 'boolean') {\n        throw new TypeError(`safeSet error: 'options.createMissing' is not a boolean.`);\n    }\n    const access = accessor.split('.');\n    let result = false;\n    // Verify first level missing property.\n    if (access.length === 1 && !createMissing && !(access[0] in data)) {\n        return false;\n    }\n    // Walk through the given object by the accessor indexes.\n    for (let cntr = 0; cntr < access.length; cntr++) {\n        // If data is an array perform validation that the accessor is a positive integer otherwise quit.\n        if (Array.isArray(data)) {\n            const number = (+access[cntr]);\n            if (!Number.isInteger(number) || number < 0) {\n                return false;\n            }\n        }\n        if (cntr === access.length - 1) {\n            switch (operation) {\n                case 'add':\n                    data[access[cntr]] += value;\n                    result = true;\n                    break;\n                case 'div':\n                    data[access[cntr]] /= value;\n                    result = true;\n                    break;\n                case 'mult':\n                    data[access[cntr]] *= value;\n                    result = true;\n                    break;\n                case 'set':\n                    data[access[cntr]] = value;\n                    result = true;\n                    break;\n                case 'set-undefined':\n                    if (data[access[cntr]] === void 0) {\n                        data[access[cntr]] = value;\n                    }\n                    result = true;\n                    break;\n                case 'sub':\n                    data[access[cntr]] -= value;\n                    result = true;\n                    break;\n            }\n        }\n        else {\n            // If createMissing is true and the next level of object access is undefined then create a new object entry.\n            if (createMissing && data[access[cntr]] === void 0) {\n                data[access[cntr]] = {};\n            }\n            // Abort if the next level is null or not an object and containing a value.\n            if (data[access[cntr]] === null || typeof data[access[cntr]] !== 'object') {\n                return false;\n            }\n            data = data[access[cntr]];\n        }\n    }\n    return result;\n}\n\nexport { deepFreeze, deepMerge, deepSeal, hasAccessor, hasGetter, hasPrototype, hasSetter, isAsyncIterable, isIterable, isObject, isPlainObject, klona, objectKeys, objectSize, safeAccess, safeEqual, safeKeyIterator, safeSet };\n//# sourceMappingURL=index.js.map\n","import { isObject } from '@typhonjs-fvtt/runtime/util/object';\n\n/**\r\n * Provides utility methods for checking browser capabilities.\r\n *\r\n * @see https://kilianvalkhof.com/2021/web/detecting-media-query-support-in-css-and-javascript/\r\n *\r\n * @privateRemarks\r\n * TODO: perhaps add support for various standard media query checks for level 4 & 5.\r\n */\r\nclass BrowserSupports\r\n{\r\n   /**\r\n    * Check for container query support.\r\n    *\r\n    * @returns {boolean} True if container queries supported.\r\n    */\r\n   static get containerQueries()\r\n   {\r\n      return 'container' in document.documentElement.style;\r\n   }\r\n}\n\n/**\n * Provides cross window checks for DOM nodes / elements, events, and essential duck typing for any class based object\n * with a constructor name. The impetus is that certain browsers such as Chrome and Firefox behave differently when\n * performing `instanceof` checks when elements are moved between browser windows. With Firefox in particular the\n * entire JS runtime can not use `instanceof` checks as the instances of fundamental DOM elements differ between\n * windows.\n *\n * TRL supports moving applications from a main central browser window and popping them out into separate standalone\n * app instances in a separate browser window. In this case for essential DOM element and event checks it is necessary\n * to employ the workarounds found in `CrossWindow`.\n */\nclass CrossWindow\n{\n   /**\n    * @private\n    */\n   constructor() {} // eslint-disable-line no-useless-constructor\n\n   /**\n    * Class names for all focusable element types.\n    *\n    * @type {string[]}\n    */\n   static #FocusableElementClassNames = ['HTMLAnchorElement', 'HTMLButtonElement', 'HTMLDetailsElement',\n    'HTMLEmbedElement', 'HTMLIFrameElement', 'HTMLInputElement', 'HTMLObjectElement', 'HTMLSelectElement',\n     'HTMLTextAreaElement'];\n\n   /**\n    * DOM nodes with defined `ownerDocument` property.\n    *\n    * @type {Set<number>}\n    */\n   static #NodesWithOwnerDocument = new Set([Node.ELEMENT_NODE, Node.TEXT_NODE, Node.COMMENT_NODE,\n    Node.DOCUMENT_FRAGMENT_NODE]);\n\n   // Various UI Event sets for duck typing by constructor name.\n   /**\n    * Duck typing class names for pointer events.\n    *\n    * @type {Set<string>}\n    */\n   static #PointerEventSet = new Set(['MouseEvent', 'PointerEvent']);\n\n   /**\n    * Duck typing class names for all UIEvents.\n    *\n    * @type {Set<string>}\n    */\n   static #UIEventSet = new Set(['UIEvent', 'FocusEvent', 'MouseEvent', 'WheelEvent', 'KeyboardEvent', 'PointerEvent',\n    'TouchEvent', 'InputEvent', 'CompositionEvent', 'DragEvent']);\n\n   /**\n    * Duck typing class names for events considered as user input.\n    *\n    * @type {Set<string>}\n    */\n   static #UserInputEventSet = new Set(['KeyboardEvent', 'MouseEvent', 'PointerEvent']);\n\n   /**\n    * Internal options used by `#checkDOMInstanceType` when retrieving the Window reference from a Node that doesn't\n    * define `ownerDocument`.\n    *\n    * @type {{throws: boolean}}\n    */\n   static #optionsInternalCheckDOM = { throws: false };\n\n   // DOM Querying ---------------------------------------------------------------------------------------------------\n\n   /**\n    * Convenience method to retrieve the `document.activeElement` value in the current Window context of a DOM Node /\n    * Element, EventTarget, Document, or Window.\n    *\n    * @param {Document | EventTarget | Node | UIEvent | Window}  target - DOM Node / Element, EventTarget, Document,\n    *        UIEvent or Window to query.\n    *\n    * @param {object} [options] - Options.\n    *\n    * @param {boolean} [options.throws=true] - When `true` and target is invalid throw an exception. If `false` and the\n    *        target is invalid `undefined` is returned; default: `true`.\n    *\n    * @returns {Element | null} Active element or `undefined` when `throws` option is `false` and the target is invalid.\n    *\n    * @throws {@link TypeError} Target must be a DOM Node / Element, Document, UIEvent, or Window.\n    */\n   static getActiveElement(target, { throws = true } = {})\n   {\n      // Duck type if target has known defined `ownerDocument` property.\n      if (this.#NodesWithOwnerDocument.has(target?.nodeType)) { return target?.ownerDocument?.activeElement ?? null; }\n\n      // Duck type if target is a UIEvent.\n      if (this.isUIEvent(target) && isObject(target?.view)) { return target?.view?.document?.activeElement ?? null; }\n\n      // Duck type if target is a Document.\n      if (isObject(target?.defaultView)) { return target?.activeElement ?? null; }\n\n      // Duck type if target is a Window.\n      if (isObject(target?.document) && isObject(target?.location)) { return target?.document?.activeElement ?? null; }\n\n      if (throws) { throw new TypeError(`'target' must be a DOM Node / Element, Document, UIEvent, or Window.`); }\n\n      return void 0;\n   }\n\n   /**\n    * Convenience method to retrieve the `Document` value in the current context of a DOM Node / Element, EventTarget,\n    * Document, UIEvent, or Window.\n    *\n    * @param {Document | EventTarget | Node | UIEvent | Window}  target - DOM Node / Element, EventTarget, Document,\n    *        UIEvent or Window to query.\n    *\n    * @param {object} [options] - Options.\n    *\n    * @param {boolean} [options.throws=true] - When `true` and target is invalid throw an exception. If `false` and the\n    *        target is invalid `undefined` is returned; default: `true`.\n    *\n    * @returns {Document} Active document or `undefined` when `throws` option is `false` and the target is invalid.\n    *\n    * @throws {@link TypeError} Target must be a DOM Node / Element, Document, UIEvent, or Window.\n    */\n   static getDocument(target, { throws = true } = {})\n   {\n      // Duck type if target has known defined `ownerDocument` property.\n      if (this.#NodesWithOwnerDocument.has(target?.nodeType)) { return target?.ownerDocument; }\n\n      // Duck type if target is a UIEvent.\n      if (this.isUIEvent(target) && isObject(target?.view)) { return target?.view?.document; }\n\n      // Duck type if target is a Document.\n      if (isObject(target?.defaultView)) { return target; }\n\n      // Duck type if target is a Window.\n      if (isObject(target?.document) && isObject(target?.location)) { return target?.document; }\n\n      if (throws) { throw new TypeError(`'target' must be a DOM Node / Element, Document, UIEvent, or Window.`); }\n\n      return void 0;\n   }\n\n   /**\n    * Convenience method to retrieve the `Window` value in the current context of a DOM Node / Element, EventTarget,\n    * Document, or Window.\n    *\n    * @param {Document | EventTarget | Node | UIEvent | Window}  target - DOM Node / Element, EventTarget, Document,\n    *        UIEvent or Window to query.\n    *\n    * @param {object} [options] - Options.\n    *\n    * @param {boolean} [options.throws=true] - When `true` and target is invalid throw an exception. If `false` and the\n    *        target is invalid `undefined` is returned; default: `true`.\n    *\n    * @returns {Window} Active window or `undefined` when `throws` option is `false` and the target is invalid.\n    *\n    * @throws {@link TypeError} Target must be a DOM Node / Element, Document, UIEvent, or Window.\n    */\n   static getWindow(target, { throws = true } = {})\n   {\n      // Duck type if target has known defined `ownerDocument` property.\n      if (this.#NodesWithOwnerDocument.has(target?.nodeType))\n      {\n         return target.ownerDocument?.defaultView ?? globalThis;\n      }\n\n      // Duck type if target is a UIEvent.\n      if (this.isUIEvent(target) && isObject(target?.view)) { return target.view ?? globalThis; }\n\n      // Duck type if target is a Document.\n      if (isObject(target?.defaultView)) { return target.defaultView ?? globalThis; }\n\n      // Duck type if target is a Window.\n      if (isObject(target?.document) && isObject(target?.location)) { return target; }\n\n      if (throws) { throw new TypeError(`'target' must be a DOM Node / Element, Document, UIEvent, or Window.`); }\n\n      return void 0;\n   }\n\n   // ES / Browser API basic prototype tests -------------------------------------------------------------------------\n\n   /**\n    * Provides basic prototype string type checking if `target` is a Document.\n    *\n    * @param {unknown}  target - A potential Document to test.\n    *\n    * @returns {target is Document} Is `target` a Document.\n    */\n   static isDocument(target)\n   {\n      return isObject(target) && Object.prototype.toString.call(target) === '[object Document]';\n   }\n\n   /**\n    * Provides basic prototype string type checking if `target` is a Map.\n    *\n    * @param {unknown}  target - A potential Map to test.\n    *\n    * @returns {target is Map} Is `target` a Map.\n    */\n   static isMap(target)\n   {\n      return isObject(target) && Object.prototype.toString.call(target) === '[object Map]';\n   }\n\n   /**\n    * Provides basic prototype string type checking if `target` is a Promise.\n    *\n    * @param {unknown}  target - A potential Promise to test.\n    *\n    * @returns {target is Promise} Is `target` a Promise.\n    */\n   static isPromise(target)\n   {\n      return isObject(target) && Object.prototype.toString.call(target) === '[object Promise]';\n   }\n\n   /**\n    * Provides basic prototype string type checking if `target` is a RegExp.\n    *\n    * @param {unknown}  target - A potential RegExp to test.\n    *\n    * @returns {target is RegExp} Is `target` a RegExp.\n    */\n   static isRegExp(target)\n   {\n      return isObject(target) && Object.prototype.toString.call(target) === '[object RegExp]';\n   }\n\n   /**\n    * Provides basic prototype string type checking if `target` is a Set.\n    *\n    * @param {unknown}  target - A potential Set to test.\n    *\n    * @returns {target is Set} Is `target` a Set.\n    */\n   static isSet(target)\n   {\n      return isObject(target) && Object.prototype.toString.call(target) === '[object Set]';\n   }\n\n   /**\n    * Provides basic prototype string type checking if `target` is a URL.\n    *\n    * @param {unknown}  target - A potential URL to test.\n    *\n    * @returns {target is URL} Is `target` a URL.\n    */\n   static isURL(target)\n   {\n      return isObject(target) && Object.prototype.toString.call(target) === '[object URL]';\n   }\n\n   /**\n    * Provides basic prototype string type checking if `target` is a Window.\n    *\n    * @param {unknown}  target - A potential Window to test.\n    *\n    * @returns {target is Window} Is `target` a Window.\n    */\n   static isWindow(target)\n   {\n      return isObject(target) && Object.prototype.toString.call(target) === '[object Window]';\n   }\n\n   // DOM Element typing ---------------------------------------------------------------------------------------------\n\n   /**\n    * Ensures that the given target is an `instanceof` all known DOM elements that are focusable. Please note that\n    * additional checks are required regarding focusable state; use {@link A11yHelper.isFocusable} for a complete check.\n    *\n    * @param {unknown}  target - Target to test for `instanceof` focusable HTML element.\n    *\n    * @returns {boolean} Is target an `instanceof` a focusable DOM element.\n    */\n   static isFocusableHTMLElement(target)\n   {\n      for (let cntr = this.#FocusableElementClassNames.length; --cntr >= 0;)\n      {\n         if (this.#checkDOMInstanceType(target, Node.ELEMENT_NODE, this.#FocusableElementClassNames[cntr]))\n         {\n            return true;\n         }\n      }\n\n      return false;\n   }\n\n   /**\n    * Provides precise type checking if `target` is a DocumentFragment.\n    *\n    * @param {unknown}  target - A potential DocumentFragment to test.\n    *\n    * @returns {target is DocumentFragment} Is `target` a DocumentFragment.\n    */\n   static isDocumentFragment(target)\n   {\n      return this.#checkDOMInstanceType(target, Node.DOCUMENT_FRAGMENT_NODE, 'DocumentFragment');\n   }\n\n   /**\n    * Provides precise type checking if `target` is an Element.\n    *\n    * @param {unknown}  target - A potential Element to test.\n    *\n    * @returns {target is Element} Is `target` an Element.\n    */\n   static isElement(target)\n   {\n      return this.#checkDOMInstanceType(target, Node.ELEMENT_NODE, 'Element');\n   }\n\n   /**\n    * Provides precise type checking if `target` is a HTMLAnchorElement.\n    *\n    * @param {unknown}  target - A potential HTMLAnchorElement to test.\n    *\n    * @returns {target is HTMLAnchorElement} Is `target` a HTMLAnchorElement.\n    */\n   static isHTMLAnchorElement(target)\n   {\n      return this.#checkDOMInstanceType(target, Node.ELEMENT_NODE, 'HTMLAnchorElement');\n   }\n\n   /**\n    * Provides precise type checking if `target` is a HTMLElement.\n    *\n    * @param {unknown}  target - A potential HTMLElement to test.\n    *\n    * @returns {target is HTMLElement} Is `target` a HTMLElement.\n    */\n   static isHTMLElement(target)\n   {\n      return this.#checkDOMInstanceType(target, Node.ELEMENT_NODE, 'HTMLElement');\n   }\n\n   /**\n    * Provides precise type checking if `target` is a Node.\n    *\n    * @param {unknown}  target - A potential Node to test.\n    *\n    * @returns {target is Node} Is `target` a DOM Node.\n    */\n   static isNode(target)\n   {\n      if (typeof target?.nodeType !== 'number') { return false; }\n\n      if (target instanceof globalThis.Node) { return true; }\n\n      // Must retrieve window by a more thorough duck type via `getWindow` as not all Nodes have `ownerDocument`\n      // defined.\n      const activeWindow = this.getWindow(target, this.#optionsInternalCheckDOM);\n\n      const TargetNode = activeWindow?.Node;\n      return TargetNode && target instanceof TargetNode;\n   }\n\n   /**\n    * Provides precise type checking if `target` is a ShadowRoot.\n    *\n    * @param {unknown}  target - A potential ShadowRoot to test.\n    *\n    * @returns {target is ShadowRoot} Is `target` a ShadowRoot.\n    */\n   static isShadowRoot(target)\n   {\n      // ShadowRoot is a specialized type of DocumentFragment.\n      return this.#checkDOMInstanceType(target, Node.DOCUMENT_FRAGMENT_NODE, 'ShadowRoot');\n   }\n\n   /**\n    * Provides precise type checking if `target` is a SVGElement.\n    *\n    * @param {unknown}  target - A potential SVGElement to test.\n    *\n    * @returns {target is SVGElement} Is `target` a SVGElement.\n    */\n   static isSVGElement(target)\n   {\n      return this.#checkDOMInstanceType(target, Node.ELEMENT_NODE, 'SVGElement');\n   }\n\n   // Event typing ---------------------------------------------------------------------------------------------------\n\n   /**\n    * Provides basic duck type checking for `Event` signature and optional constructor name(s).\n    *\n    * @param {unknown}  target - A potential DOM event to test.\n    *\n    * @param {string | Set<string>} [types] Specific constructor name or Set of constructor names to match.\n    *\n    * @returns {target is Event} Is `target` an Event with optional constructor name check.\n    */\n   static isEvent(target, types)\n   {\n      if (typeof target?.type !== 'string' || typeof target?.defaultPrevented !== 'boolean' ||\n         typeof target?.stopPropagation !== 'function')\n      {\n         return false;\n      }\n\n      return types !== void 0 ? this.isCtorName(target, types) : true;\n   }\n\n   /**\n    * Provides basic duck type checking for `Event` signature for standard mouse / pointer events including\n    * `MouseEvent` and `PointerEvent`.\n    *\n    * @param {unknown}  target - A potential DOM event to test.\n    *\n    * @returns {target is PointerEvent} Is `target` a MouseEvent or PointerEvent.\n    */\n   static isPointerEvent(target)\n   {\n      return this.isEvent(target, this.#PointerEventSet);\n   }\n\n   /**\n    * Provides basic duck type checking for `Event` signature for all UI events.\n    *\n    * @param {unknown}  target - A potential DOM event to test.\n    *\n    * @returns {target is UIEvent} Is `target` a UIEvent.\n    * @see https://developer.mozilla.org/en-US/docs/Web/API/UIEvent\n    */\n   static isUIEvent(target)\n   {\n      return this.isEvent(target, this.#UIEventSet);\n   }\n\n   /**\n    * Provides basic duck type checking for `Event` signature for standard user input events including `KeyboardEvent`,\n    * `MouseEvent`, and `PointerEvent`.\n    *\n    * @param {unknown}  target - A potential DOM event to test.\n    *\n    * @returns {target is KeyboardEvent | MouseEvent | PointerEvent} Is `target` a Keyboard, MouseEvent, or\n    *          PointerEvent.\n    */\n   static isUserInputEvent(target)\n   {\n      return this.isEvent(target, this.#UserInputEventSet);\n   }\n\n   // Generic typing -------------------------------------------------------------------------------------------------\n\n   /**\n    * Provides basic type checking by constructor name(s) for objects. This can be useful when checking multiple\n    * constructor names against a provided Set.\n    *\n    * @param {unknown}  target - Object to test for constructor name.\n    *\n    * @param {string | Set<string>} types Specific constructor name or Set of constructor names to match.\n    *\n    * @returns {boolean} Does the provided object constructor name match the types provided.\n    */\n   static isCtorName(target, types)\n   {\n      if (!isObject(target)) { return false; }\n\n      if (typeof types === 'string' && target?.constructor?.name === types) { return true; }\n\n      return !!types?.has(target?.constructor?.name);\n   }\n\n   // Internal implementation ----------------------------------------------------------------------------------------\n\n   /**\n    * Internal generic DOM `instanceof` check. First will attempt to find the class name by `globalThis` falling back\n    * to the {@link Window} associated with the DOM node.\n    *\n    * @param {unknown}  target - Target to test.\n    *\n    * @param {number}   nodeType - Node type constant.\n    *\n    * @param {string}   className - DOM class name for instanceof check.\n    *\n    * @returns {boolean} Is the target the given nodeType and instance of class name.\n    */\n   static #checkDOMInstanceType(target, nodeType, className)\n   {\n      if (!isObject(target)) { return false; }\n\n      if (target.nodeType !== nodeType) { return false; }\n\n      const GlobalClass = globalThis[className];\n\n      if (GlobalClass && target instanceof GlobalClass) { return true; }\n\n      const activeWindow = this.#NodesWithOwnerDocument.has(target.nodeType) ? target?.ownerDocument?.defaultView :\n       this.getWindow(target, this.#optionsInternalCheckDOM);\n\n      const TargetClass = activeWindow?.[className];\n\n      return TargetClass && target instanceof TargetClass;\n   }\n}\n\n/**\r\n * Provides access to the Clipboard API for reading / writing text strings. This requires a secure context.\r\n *\r\n * Note: `writeText` will attempt to use the older `execCommand` if available when `navigator.clipboard` is not\r\n * available.\r\n */\r\nclass ClipboardAccess\r\n{\r\n   /**\r\n    * Uses `navigator.clipboard` if available to read text from the clipboard.\r\n    *\r\n    * Note: Always returns `undefined` when `navigator.clipboard` is not available or the clipboard contains the\r\n    * empty string.\r\n    *\r\n    * @param {Window} [activeWindow=globalThis] Optional active current window.\r\n    *\r\n    * @returns {Promise<string|undefined>} The current clipboard text or undefined.\r\n    */\r\n   static async readText(activeWindow = globalThis)\r\n   {\r\n      let result;\r\n\r\n      if (!CrossWindow.isWindow(activeWindow))\r\n      {\r\n         throw new TypeError(`ClipboardAccess.readText error: 'activeWindow' is not a Window.`);\r\n      }\r\n\r\n      if (activeWindow?.navigator?.clipboard)\r\n      {\r\n         try\r\n         {\r\n            result = await activeWindow.navigator.clipboard.readText();\r\n         }\r\n         catch (err) { /**/ }\r\n      }\r\n\r\n      return result === '' ? void 0 : result;\r\n   }\r\n\r\n   /**\r\n    * Uses `navigator.clipboard` if available then falls back to `document.execCommand('copy')` if available to copy\r\n    * the given text to the clipboard.\r\n    *\r\n    * @param {string}   text - Text to copy to the browser clipboard.\r\n    *\r\n    * @param {Window} [activeWindow=globalThis] Optional active current window.\r\n    *\r\n    * @returns {Promise<boolean>} Copy successful.\r\n    */\r\n   static async writeText(text, activeWindow = globalThis)\r\n   {\r\n      if (typeof text !== 'string')\r\n      {\r\n         throw new TypeError(`ClipboardAccess.writeText error: 'text' is not a string.`);\r\n      }\r\n\r\n      if (!CrossWindow.isWindow(activeWindow))\r\n      {\r\n         throw new TypeError(`ClipboardAccess.writeText error: 'activeWindow' is not a Window.`);\r\n      }\r\n\r\n      let success = false;\r\n\r\n      if (activeWindow?.navigator?.clipboard)\r\n      {\r\n         try\r\n         {\r\n            await activeWindow.navigator.clipboard.writeText(text);\r\n            success = true;\r\n         }\r\n         catch (err) { /**/ }\r\n      }\r\n      else if (typeof activeWindow?.document?.execCommand === 'function')\r\n      {\r\n         const textArea = activeWindow.document.createElement('textarea');\r\n\r\n         // Place in the top-left corner of screen regardless of scroll position.\r\n         textArea.style.position = 'fixed';\r\n         textArea.style.top = '0';\r\n         textArea.style.left = '0';\r\n\r\n         // Ensure it has a small width and height. Setting to 1px / 1em\r\n         // doesn't work as this gives a negative w/h on some browsers.\r\n         textArea.style.width = '2em';\r\n         textArea.style.height = '2em';\r\n\r\n         // We don't need padding, reducing the size if it does flash render.\r\n         textArea.style.padding = '0';\r\n\r\n         // Clean up any borders.\r\n         textArea.style.border = 'none';\r\n         textArea.style.outline = 'none';\r\n         textArea.style.boxShadow = 'none';\r\n\r\n         // Avoid flash of the white box if rendered for any reason.\r\n         textArea.style.background = 'transparent';\r\n\r\n         textArea.value = text;\r\n\r\n         activeWindow.document.body.appendChild(textArea);\r\n         textArea.focus();\r\n         textArea.select();\r\n\r\n         try\r\n         {\r\n            success = activeWindow.document.execCommand('copy');\r\n         }\r\n         catch (err) { /**/ }\r\n\r\n         activeWindow.document.body.removeChild(textArea);\r\n      }\r\n\r\n      return success;\r\n   }\r\n}\n\n/**\n * Provides a utility function to parse / construct fully qualified URL instances from a URL string.\n */\nclass URLParser\n{\n   /**\n    * Parses a URL string converting it to a fully qualified URL. If URL is an existing URL instance it is returned\n    * immediately. Optionally you may construct a fully qualified URL from a relative base origin / path or with a\n    * route prefix added to the current location origin.\n    *\n    * @param {object} options - Options.\n    *\n    * @param {string | URL}   options.url - URL string to convert to a URL.\n    *\n    * @param {string}   [options.base] - Optional fully qualified base path for relative URL construction.\n    *\n    * @param {string}   [options.routePrefix] - Optional route prefix to add to location origin for absolute URL strings\n    *        when `base` is not defined.\n    *\n    * @returns {URL | null} Parsed URL or null if `url` is not parsed.\n    */\n   static parse({ url, base, routePrefix })\n   {\n      if (CrossWindow.isURL(url)) { return url; }\n\n      if (typeof url !== 'string') { return null; }\n\n      if (base !== void 0 && typeof base !== 'string') { return null; }\n\n      if (routePrefix !== void 0 && typeof routePrefix !== 'string') { return null; }\n\n      const targetURL = this.#createURL(url);\n\n      // Parse and return already fully qualified `url` string.\n      if (targetURL) { return targetURL; }\n\n      let targetBase;\n\n      // Parse relative url string.\n      if (url.startsWith('./') || url.startsWith('../'))\n      {\n         // Relative from provided `base` or current path.\n         targetBase = base ? base : `${globalThis.location.origin}${globalThis.location.pathname}`;\n      }\n      else\n      {\n         let targetRoutePrefix = '';\n\n         // Relative to current origin, but include any defined route prefix.\n         if (routePrefix)\n         {\n            // Ensure route prefix starts and ends with `/` for proper URL parsing.\n            targetRoutePrefix = routePrefix.startsWith('/') ? routePrefix : `/${routePrefix}`;\n            targetRoutePrefix = targetRoutePrefix.endsWith('/') ? targetRoutePrefix : `${targetRoutePrefix}/`;\n         }\n\n         targetBase = `${globalThis.location.origin}${targetRoutePrefix}`;\n      }\n\n      return this.#createURL(url, targetBase);\n   }\n\n   // Internal implementation ----------------------------------------------------------------------------------------\n\n   /**\n    * Helper to create a URL and catch any exception. Useful until `URL.parse` and `URL.canParse` are more widespread.\n    *\n    * @param {string}   url - URL string.\n    *\n    * @param {string}   base - Base origin / path.\n    *\n    * @returns {URL | null} Valid URL or null.\n    */\n   static #createURL(url, base = '')\n   {\n      try { return new URL(url, base); }\n      catch(err) { return null; }\n   }\n}\n\nexport { BrowserSupports, ClipboardAccess, CrossWindow, URLParser };\n//# sourceMappingURL=index.js.map\n","import { writable } from 'svelte/store';\nimport { isMinimalWritableStore, subscribeIgnoreFirst } from '@typhonjs-fvtt/runtime/svelte/store/util';\nimport { CrossWindow } from '@typhonjs-fvtt/runtime/util/browser';\nimport { isObject, isIterable } from '@typhonjs-fvtt/runtime/util/object';\n\nvar _a;\n/**\n * Registers game settings and creates a backing Svelte store for each setting. The Svelte store will update the\n * Foundry game settings and vice versa when changes occur to the Foundry game settings the updated data is set to the\n * store.\n *\n * Note: It is possible to add multiple `onChange` callbacks on registration.\n *\n * @typeParam `ExtraProps` - Defines additional properties for game setting options / data that child implementations\n * may define.\n *\n * @privateRemarks\n * TODO: A possible future extension is to offer type checking against the setting type by creating a customized\n * writable store that has an overloaded `set` method to provide type checking.\n */\nclass TJSGameSettings {\n    /**\n     */\n    #namespace;\n    /**\n     */\n    #settings = [];\n    /**\n     */\n    #stores = new Map();\n    /**\n     * Creates the TJSGameSettings instance.\n     *\n     * @param namespace - The namespace for all settings.\n     */\n    constructor(namespace) {\n        if (typeof namespace !== 'string') {\n            throw new TypeError(`'namespace' is not a string.`);\n        }\n        this.#namespace = namespace;\n    }\n    /**\n     * Creates a new writable for the given key.\n     *\n     * @param initialValue - An initial value to set to new stores.\n     *\n     * @returns The new writable.\n     */\n    static #createStore(initialValue) {\n        return writable(initialValue);\n    }\n    /**\n     * @returns Returns namespace set in constructor.\n     */\n    get namespace() {\n        return this.#namespace;\n    }\n    /**\n     * Gets a store from the `stores` Map or creates a new store for the key.\n     *\n     * @param key - Key to lookup in stores map.\n     *\n     * @param [initialValue] - An initial value to set to new stores.\n     *\n     * @returns The store for the given key.\n     */\n    #getStore(key, initialValue) {\n        let store = this.#stores.get(key);\n        if (store === void 0) {\n            store = _a.#createStore(initialValue);\n            this.#stores.set(key, store);\n        }\n        return store;\n    }\n    /**\n     * Returns a readable Game Settings store for the associated key.\n     *\n     * @param key - Game setting key.\n     *\n     * @returns The associated store for the given game setting key.\n     */\n    getReadableStore(key) {\n        if (!this.#stores.has(key)) {\n            console.warn(`TJSGameSettings - getReadableStore: '${key}' is not a registered setting.`);\n            return;\n        }\n        const store = this.#getStore(key);\n        return { subscribe: store.subscribe };\n    }\n    /**\n     * Returns a writable Game Settings store for the associated key.\n     *\n     * @param key - Game setting key.\n     *\n     * @returns The associated store for the given game setting key.\n     */\n    getStore(key) {\n        return this.getWritableStore(key);\n    }\n    /**\n     * Returns a writable Game Settings store for the associated key.\n     *\n     * @param key - Game setting key.\n     *\n     * @returns The associated store for the given game setting key.\n     */\n    getWritableStore(key) {\n        if (!this.#stores.has(key)) {\n            console.warn(`TJSGameSettings - getWritableStore: '${key}' is not a registered setting.`);\n            return;\n        }\n        return this.#getStore(key);\n    }\n    /**\n     * Registers a setting with TJSGameSettings and Foundry core.\n     *\n     * @param setting - A GameSetting instance to set to Foundry game settings.\n     *\n     * @param coreConfig - When false this overrides the `setting.options.config` parameter when registering the setting\n     *        with Foundry. This allows the settings to be displayed in the app itself, but removed from the standard\n     *        Foundry configuration location.\n     */\n    register(setting, coreConfig = true) {\n        if (!isObject(setting)) {\n            throw new TypeError(`TJSGameSettings - register: setting is not an object.`);\n        }\n        if (!isObject(setting.options)) {\n            throw new TypeError(`TJSGameSettings - register: 'setting.options' attribute is not an object.`);\n        }\n        if (typeof coreConfig !== 'boolean') {\n            throw new TypeError(`TJSGameSettings - register: 'coreConfig' is not an boolean.`);\n        }\n        if (setting.store !== void 0 && !isMinimalWritableStore(setting.store)) {\n            throw new TypeError(`TJSGameSettings - register: 'setting.store' attribute is not a minimal writable store.`);\n        }\n        const namespace = setting.namespace ?? this.#namespace;\n        const key = setting.key;\n        // The `config` parameter passed to Foundry core.\n        const foundryConfig = coreConfig ? setting.options.config ?? true : false;\n        if (typeof namespace !== 'string') {\n            throw new TypeError(`TJSGameSettings - register: 'namespace' attribute is not a string.`);\n        }\n        if (typeof key !== 'string') {\n            throw new TypeError(`TJSGameSettings - register: 'key' attribute is not a string.`);\n        }\n        const store = setting.store;\n        const options = setting.options;\n        const onchangeFunctions = [];\n        // When true prevents local store subscription from a loop when values are object data.\n        let gateSet = false;\n        // Provides an `onChange` callback to update the associated store.\n        onchangeFunctions.push((value) => {\n            const callbackStore = this.#getStore(key);\n            if (callbackStore && !gateSet) {\n                gateSet = true;\n                callbackStore.set(value);\n                gateSet = false;\n            }\n        });\n        // Handle loading any existing `onChange` callbacks.\n        if (isIterable(options?.onChange)) {\n            for (const entry of options.onChange) {\n                if (typeof entry === 'function') {\n                    onchangeFunctions.push(entry);\n                }\n            }\n        }\n        else if (typeof options.onChange === 'function') {\n            onchangeFunctions.push(options.onChange);\n        }\n        // Provides the final onChange callback that iterates over all the stored onChange callbacks.\n        const onChange = (value) => {\n            for (const entry of onchangeFunctions) {\n                entry(value);\n            }\n        };\n        // @ts-expect-error PF2E types do not have partial aspects for `name`.\n        globalThis.game.settings.register(namespace, key, { ...options, config: foundryConfig, onChange });\n        // Set new store value with existing setting or default value.\n        const targetStore = store ? store : this.#getStore(key, globalThis.game.settings.get(namespace, key));\n        // If a store instance is passed into register then initialize it with game settings data.\n        if (store) {\n            this.#stores.set(key, targetStore);\n            store.set(globalThis.game.settings.get(namespace, key));\n        }\n        const storeHandler = async (value) => {\n            if (!gateSet) {\n                gateSet = true;\n                await globalThis.game.settings.set(namespace, key, value);\n            }\n            gateSet = false;\n        };\n        // Subscribe to self to set associated game setting on updates after verifying that the new value does not match\n        // existing game setting.\n        subscribeIgnoreFirst(targetStore, storeHandler);\n        // Transfer setting options to data.\n        {\n            const { store, ...rest } = setting;\n            const gameSettingData = Object.assign({}, rest, { namespace, key, options });\n            Object.freeze(gameSettingData);\n            this.#settings.push(gameSettingData);\n        }\n    }\n    /**\n     * Registers multiple settings.\n     *\n     * @param settings - An iterable list of game setting configurations to register.\n     *\n     * @param coreConfig - When false this overrides the `setting.options.config` parameter when registering the setting\n     *        with Foundry. This allows the settings to be displayed in the app itself, but removed from the standard\n     *        Foundry configuration location.\n     *\n     * @returns An object containing all TJSGameSetting store subscriber handlers for each setting `key` added.\n     */\n    registerAll(settings, coreConfig) {\n        if (!isIterable(settings)) {\n            throw new TypeError(`TJSGameSettings - registerAll: settings is not iterable.`);\n        }\n        for (const entry of settings) {\n            if (!isObject(entry)) {\n                throw new TypeError(`TJSGameSettings - registerAll: entry in settings is not an object.`);\n            }\n            if (typeof entry.namespace !== 'string') {\n                throw new TypeError(`TJSGameSettings - registerAll: entry in settings missing 'namespace' attribute.`);\n            }\n            if (typeof entry.key !== 'string') {\n                throw new TypeError(`TJSGameSettings - registerAll: entry in settings missing 'key' attribute.`);\n            }\n            if (!isObject(entry.options)) {\n                throw new TypeError(`TJSGameSettings - registerAll: entry in settings missing 'options' attribute.`);\n            }\n            this.register(entry, coreConfig);\n        }\n    }\n    // Iterators ------------------------------------------------------------------------------------------------------\n    /**\n     * Returns an iterable for the game setting data; {@link TJSGameSettings.Data.GameSetting}.\n     *\n     * @param [regex] - Optional regular expression to filter by game setting keys.\n     *\n     * @returns Iterable iterator of `TJSGameSettings.Data.GameSetting`.\n     */\n    *data(regex = void 0) {\n        if (regex !== void 0 && !CrossWindow.isRegExp(regex)) {\n            throw new TypeError(`'regex' is not a RegExp`);\n        }\n        if (!this.#settings.length) {\n            return void 0;\n        }\n        if (regex) {\n            for (const setting of this.#settings) {\n                if (regex.test(setting.key)) {\n                    yield setting;\n                }\n            }\n        }\n        else {\n            for (const setting of this.#settings) {\n                yield setting;\n            }\n        }\n    }\n    /**\n     * Returns an iterable for the game setting keys and stores.\n     *\n     * @param [regex] - Optional regular expression to filter by game setting keys.\n     *\n     * @typeParam T - Store data type.\n     *\n     * @returns Iterable iterator of keys and stores.\n     */\n    *entries(regex = void 0) {\n        if (regex !== void 0 && !CrossWindow.isRegExp(regex)) {\n            throw new TypeError(`'regex' is not a RegExp`);\n        }\n        if (!this.#stores.size) {\n            return void 0;\n        }\n        if (regex) {\n            for (const key of this.#stores.keys()) {\n                if (regex.test(key)) {\n                    yield [key, this.getStore(key)];\n                }\n            }\n        }\n        else {\n            for (const key of this.#stores.keys()) {\n                yield [key, this.getStore(key)];\n            }\n        }\n    }\n    /**\n     * Returns an iterable for the game setting keys from existing stores.\n     *\n     * @param [regex] - Optional regular expression to filter by game setting keys.\n     *\n     * @returns Iterable iterator of game setting keys.\n     */\n    *keys(regex = void 0) {\n        if (regex !== void 0 && !CrossWindow.isRegExp(regex)) {\n            throw new TypeError(`'regex' is not a RegExp`);\n        }\n        if (!this.#stores.size) {\n            return void 0;\n        }\n        if (regex) {\n            for (const key of this.#stores.keys()) {\n                if (regex.test(key)) {\n                    yield key;\n                }\n            }\n        }\n        else {\n            for (const key of this.#stores.keys()) {\n                yield key;\n            }\n        }\n    }\n    /**\n     * Returns an iterable for the game setting stores.\n     *\n     * @param [regex] - Optional regular expression to filter by game setting keys.\n     *\n     * @returns Iterable iterator of stores.\n     */\n    *stores(regex = void 0) {\n        if (regex !== void 0 && !CrossWindow.isRegExp(regex)) {\n            throw new TypeError(`'regex' is not a RegExp`);\n        }\n        if (!this.#stores.size) {\n            return void 0;\n        }\n        if (regex) {\n            for (const key of this.#stores.keys()) {\n                if (regex.test(key)) {\n                    yield this.getStore(key);\n                }\n            }\n        }\n        else {\n            for (const key of this.#stores.keys()) {\n                yield this.getStore(key);\n            }\n        }\n    }\n}\n_a = TJSGameSettings;\n\n/**\n * Provides an accessible JS object that is updated reactively from all or subset of TJSGameSettings stores.\n * Accessors are provided to directly get / set current setting data. Using a setter will update the setting and backing\n * store.\n *\n * TJSLiveGameSettings is also a readable Svelte store essentially providing a customizable derived store of all\n * settings tracked.\n *\n * Note: You can create a JSDoc / `@typedef` to apply with `@type` and achieve typing support in IDEs for the\n * customizable live settings instance. Please see the example at the end of this source file on how to accomplish this\n * task.\n *\n * Note: Presently `TJSLiveGameSettings` is openly typed, but there will be a TypeScript friendly way to strongly type\n * additional instance properties.\n *\n * Note: When using from JS a second subscriber function argument is the key that was updated.\n * From Svelte: Use 'lastKey' accessor to retrieve the last updated key.\n *\n * Note: In the future this class will be reworked w/ Svelte 5 state handling.\n *\n * @example\n * ```js\n * // Example of creating a typedef to type your specific live game settings instance. Add all relevant `@property`\n * // entries.\n *\n * /**\n *  * @typedef {TJSLiveGameSettings} MyLiveGameSettings - Extend TJSLiveGameSettings and name this anything.\n *  *\n *  * @property {boolean} myBooleanSetting - Add property / type entries for setting keys associated w/ accessors.\n *  *\\/\n *\n * /** @type {MyLiveGameSettings} *\\/\n * const liveGameSettings = new TJSLiveGameSettings(gameSettings);\n * liveGameSettings.myBooleanSetting is now typed as a boolean.\n * ```\n */\nclass TJSLiveGameSettings {\n    /**\n     * Stores the current parsed game setting data.\n     */\n    #currentData = {};\n    /**\n     * Map of all game settings stores and unsubscribe functions currently subscribed.\n     */\n    #gameSettings = new Map();\n    /**\n     * Stores readable subscribers of this instance.\n     *\n     * Note: When using from JS a second argument is the key that was updated.\n     * From Svelte: Use 'lastKey' accessor to retrieve the last updated key.\n     */\n    #subscribers = [];\n    /**\n     * Stores the last updated key.\n     */\n    #lastKey = void 0;\n    /**\n     * Creates a live binding against the setting stores. All settings are configured by default, but can also be\n     * filtered by setting key with inclusive / exclusive Sets.\n     *\n     * @param gameSettings - A game settings instance to subscribe to...\n     *\n     * @param [options] - TJSLiveGameSettings options.\n     *\n     * @param [options.include] - A Set of setting keys to include from subscribing.\n     *\n     * @param [options.exclude] - A Set of setting keys to exclude from subscribing.\n     */\n    constructor(gameSettings, { include, exclude } = {}) {\n        if (!(gameSettings instanceof TJSGameSettings)) {\n            throw new TypeError(`'gameSettings' is not a TJSGameSettings instance.`);\n        }\n        if (include !== void 0 && !CrossWindow.isSet(include)) {\n            throw new TypeError(`'options.include' is not a Set.`);\n        }\n        if (exclude !== void 0 && !CrossWindow.isSet(exclude)) {\n            throw new TypeError(`'options.exclude' is not a Set.`);\n        }\n        for (const setting of gameSettings.data()) {\n            const key = setting.key;\n            // Skip any keys that are in the include set.\n            if (include !== void 0 && !include.has(key)) {\n                continue;\n            }\n            // Skip any keys that are in the exclude set.\n            if (exclude !== void 0 && exclude.has(key)) {\n                continue;\n            }\n            if (typeof this[key] === 'function' || key === 'lastKey') {\n                console.warn(`TJSLiveGameSettings warning: key (${key}) shadows a function. Skipping key.`);\n            }\n            const store = gameSettings.getStore(key);\n            if (!store) {\n                continue;\n            }\n            // Update this instance storing setting data by key.\n            this.#gameSettings.set(key, {\n                store,\n                unsubscribe: store.subscribe((data) => {\n                    if (this.#currentData !== void 0) {\n                        this.#currentData[key] = data;\n                    }\n                    this.#lastKey = key;\n                    // Notify any child instance that a particular key has updated.\n                    this._update(key);\n                    // Notify any readable store subscribers.\n                    this.#updateSubscribers(key);\n                })\n            });\n            // Define new accessors for setting key.\n            Object.defineProperty(this, key, {\n                get: () => {\n                    if (this.#currentData === void 0) {\n                        throw new Error(`This instance of TJSLiveGameSettings has been destroyed.`);\n                    }\n                    else {\n                        return this.#currentData[key];\n                    }\n                },\n                set: (data) => {\n                    if (this.#currentData === void 0) {\n                        throw new Error(`This instance of TJSLiveGameSettings has been destroyed.`);\n                    }\n                    else {\n                        this.#gameSettings.get(key)?.store.set(data);\n                    }\n                }\n            });\n        }\n        Object.seal(this);\n    }\n    /**\n     * @returns Last updated setting key.\n     */\n    get lastKey() {\n        return this.#lastKey;\n    }\n    // ----------------------------------------------------------------------------------------------------------------\n    /**\n     * Destroys this instance of TJSLiveGameSettings and unsubscribes from all game setting stores.\n     */\n    destroy() {\n        for (const data of this.#gameSettings.values()) {\n            if (typeof data.unsubscribe === 'function') {\n                data.unsubscribe();\n            }\n        }\n        this.#gameSettings.clear();\n        this.#currentData = {};\n    }\n    /**\n     * Returns an iterator / generator of all setting entries.\n     *\n     * @returns An iterator returning setting entries.\n     */\n    *entries() {\n        if (this.#currentData === void 0) {\n            throw new Error(`This instance of TJSLiveGameSettings has been destroyed.`);\n        }\n        for (const key in this.#currentData) {\n            yield [key, this.#currentData[key]];\n        }\n    }\n    /**\n     * Returns an iterator / generator of all setting keys.\n     *\n     * @returns An iterator returning setting keys.\n     */\n    *keys() {\n        if (this.#currentData === void 0) {\n            throw new Error(`This instance of TJSLiveGameSettings has been destroyed.`);\n        }\n        for (const key in this.#currentData) {\n            yield key;\n        }\n    }\n    /**\n     * Returns a string / JSON stringify of the current setting data.\n     *\n     * @returns Tracked setting data.\n     */\n    toString() {\n        if (this.#currentData === void 0) {\n            throw new Error(`This instance of TJSLiveGameSettings has been destroyed.`);\n        }\n        return JSON.stringify(this.#currentData);\n    }\n    /**\n     * Override to respond to setting update.\n     *\n     * @param key - The setting / local key that updated.\n     */\n    _update(key) { } // eslint-disable-line no-unused-vars\n    /**\n     * Returns an iterator / generator of all values.\n     *\n     * @returns An iterator returning setting values.\n     */\n    *values() {\n        if (this.#currentData === void 0) {\n            throw new Error(`This instance of TJSLiveGameSettings has been destroyed.`);\n        }\n        for (const key in this.#currentData) {\n            yield this.#currentData[key];\n        }\n    }\n    // Readable store implementation ----------------------------------------------------------------------------------\n    /**\n     * @param handler - Callback function that is invoked on update / changes.\n     *\n     * @returns Unsubscribe function.\n     */\n    subscribe(handler) {\n        this.#subscribers.push(handler); // add handler to the array of subscribers\n        handler(this, void 0); // call handler with current value\n        // Return unsubscribe function.\n        return () => {\n            const index = this.#subscribers.findIndex((sub) => sub === handler);\n            if (index >= 0) {\n                this.#subscribers.splice(index, 1);\n            }\n        };\n    }\n    /**\n     * Updates subscribers.\n     *\n     * @param key - The key that was updated.\n     */\n    #updateSubscribers(key) {\n        for (let cntr = 0; cntr < this.#subscribers.length; cntr++) {\n            this.#subscribers[cntr](this, key);\n        }\n    }\n}\n\nexport { TJSGameSettings, TJSLiveGameSettings };\n//# sourceMappingURL=index.js.map\n","/**\n * @file donation-tracker/index.js\n * @description This file contains the plugin for the Donation Tracker.\n * @author geoidesic\n * @version 1.0.0\n * @license MIT\n * \n * by configuring those 3 attributes you can configure the way you want in devMode\n * \n * Default Membership levels for Developer Mode.\n * ```js\n * DEVELOPER_LEVELS = ['member', 'benefactor', 'benefactorOfKnowledge'];\n * ```\n * Default Membership for Developer Mode.\n * ```js\n * DEVELOPER_MEMBERSHIP = 'member';\n * ```\n * Default Admin status for Developer Mode.\n * ```js\n * DEVELOPER_IS_ADMIN = false;\n * ```\n * ```js\n * game.membership.DEVELOPER_MEMBERSHIP = 'member' ?\n * ```\n */\nimport { MODULE_ID } from '~/src/helpers/constants';\n\nclass plugin {\n\n  enabled\n  constructor() {\n    this.enabled = false\n  }\n\n  /**\n   * Initializes the plugin by checking if Donation Tracker is enabled in settings.\n   * Sets up a hook to notify when the GAS Plugin is loaded.\n   */\n  init() {\n    this.enabled = game.settings.get(MODULE_ID, 'enable-donation-tracker')\n    // @todo: https://github.com/geoidesic/foundryvtt-actor-studio/issues/32#issuecomment-2166888022\n    Hooks.on('gas-plugin', () => {\n      alert('GAS Plugin Loaded')\n    })\n  }\n\n\n  /**\n   * Retrieves the settings for each donation tracker rank, including the folder name and permission.\n   * \n   * @returns {Array<Object>} - An array of objects containing permission, rank, and folderName.\n   */\n  getDTSettings() {\n    const membershipRanks = game.membership.RANKS\n    const membershipFolderArray = Object.entries(membershipRanks).filter(([_, value]) => value !== -1);\n    const settings = membershipFolderArray\n      .map(([key, rank]) => { return { permission: key, rank, folderName: game.settings.get(MODULE_ID, `donation-tracker-rank-${key}`) } })\n    return settings\n  }\n\n  /**\n   * Checks if the current pack has DT folders or not.\n   * Ignored rank access permissions.\n   * @param {object} pack \n   * @returns boolean\n   */\n  packHasDTFolders(pack) {\n    const membershipRanks = game.membership.RANKS\n    const membershipFolderArray = Object.entries(membershipRanks).filter(([_, value]) => value !== -1);\n\n    const DTfolders = membershipFolderArray\n      .map(([key, _]) => game.settings.get(MODULE_ID, `donation-tracker-rank-${key}`))\n    \n    console.log('[GAS] DT folder names from settings:', DTfolders);\n    console.log('[GAS] Pack folder names:', pack.folders.map(f => f.name));\n    \n    // Check if any of the configured DT folder names actually exist in this pack\n    const hasDTFolders = DTfolders.some(dtFolderName => \n      pack.folders.some(packFolder => packFolder.name === dtFolderName)\n    );\n    \n    console.log('[GAS] Pack has DT folders:', hasDTFolders);\n    return hasDTFolders;\n  }\n\n  /**\n   * Retrieves all folder names associated with donation tracker ranks.\n   * @returns {Array<string>} - An array of folder names tied to donation tracker ranks.\n   */\n  getAllowedDTFolderNames() {\n    const membershipRanks = game.membership.RANKS\n    // window.GAS.log.d('membershipRanks', membershipRanks)\n    const membershipFolderArray = Object.entries(membershipRanks).filter(([_, value]) => value !== -1);\n    // window.GAS.log.d('membershipFolderArray', membershipFolderArray)\n    const allowedMembershipFolderNames = membershipFolderArray.filter(([key, _]) => {\n      // window.GAS.log.d('key', key);\n      return game.membership.hasPermission(key)\n        //-@why: #102, unregistered = \"member\"\n        || (\n          game.membership.membershipLevel == -1\n          && key == 'member'\n        )\n    }\n    )\n      .map(([key, _]) => game.settings.get(MODULE_ID, `donation-tracker-rank-${key}`))\n    // window.GAS.log.d('allowedMembershipFolderNames', allowedMembershipFolderNames)\n    return allowedMembershipFolderNames\n  }\n\n\n  /**\n   * Retrieves the root-level and subfolder DT folder IDs from a compendium pack that are allowed for the current user.\n   * \n   * @param {Object} pack - The compendium pack to search.\n   * @returns {Array<string>} - An array of allowed folder IDs including subfolders.\n   */\n  getDTFolderIdsFromPack(pack, filterByPermissions = true) {\n    let allowedFolderIds = [];\n    /**\n     * Recursively retrieves folder IDs including subfolders.\n     * \n     * @param {Array<Object>} folders - An array of folder objects to search.\n     * @returns {Array<string>} - An array of allowed folder IDs.\n    */\n    const getFolderAndSubfolderIds = (folders) => {\n      // window.GAS.log.d('folders', folders)\n      for (let i = 0; i < folders.length; i++) {\n        const folder = folders[i];\n        //  window.GAS.log.d('folder.id', folder.id)\n\n        allowedFolderIds.push(folder.id);\n\n        // If the folder has subfolders, recursively add their IDs\n        //  window.GAS.log.d(folder.id+'_folder.folders', folder.children)\n        if (folder.children && folder.children.length > 0) {\n          getFolderAndSubfolderIds(folder.children.map(f => f.folder));\n        }\n\n        // window.GAS.log.d('allowedFolderIds', allowedFolderIds)\n      }\n    };\n\n\n    // window.GAS.log.d('>>>>>>>>>>>>> pack.name', pack.metadata.name)\n\n    // window.GAS.log.d('filterByPermissions', filterByPermissions)\n    //- Filter pack root folders based on the user's membership rank and get their IDs and subfolder IDs     \n    const validRootFolderNames = this.getAllowedDTFolderNames();\n    // window.GAS.log.d('id', pack.metadata.id);\n    // window.GAS.log.d('this.getDTFolderNames()', this.getAllowedDTFolderNames());\n    // window.GAS.log.d('validRootFolderNames', validRootFolderNames)\n    // window.GAS.log.d('pack.folders', pack.folders)\n    // window.GAS.log.d('pack.folders.filtered', pack.folders.filter(f => validRootFolderNames.includes(f.name)))\n\n    if (filterByPermissions) {\n      getFolderAndSubfolderIds(pack.folders.filter(f => validRootFolderNames.includes(f.name)));\n    } else {\n      getFolderAndSubfolderIds(Array.from(pack.folders));\n    }\n    // window.GAS.log.d('allowedFolderIds', allowedFolderIds)\n    return allowedFolderIds;\n  }\n}\n\nexport default new plugin();","import { writable } from 'svelte/store';\n\n// Basic store definitions without dependencies\nexport const race = writable(false); //- tracks race selection\nexport const subRace = writable(false); //- tracks subrace selection\nexport const background = writable(false); //- tracks background selection\nexport const characterClass = writable(false); //- tracks class selection for Character level 1\nexport const characterSubClass = writable(false); //- tracks subclass selection for Character level 1\nexport const abilities = writable(false); //- tracks abilities selection\nexport const spells = writable(false); //- tracks spells selection\nexport const pointBuyScoreTotal = writable(12); //- tracks the total point buy score\nexport const pointBuyLimit = writable(27); //- tracks the point buy limit\nexport const abilityRolls = writable(false); //- tracks ability rolls\nexport const isStandardArrayValues = writable(false); //- tracks if the character is using standard array values\nexport const level = writable(1); //- tracks the current level of the character\nexport const activeTab = writable(''); //- tracks the active tab\nexport const isActorCreated = writable(false); //- tracks if the actor has been created\nexport const tabs = writable([]); //- tracks the tabs\nexport const levelUpTabs = writable([]); //- tracks the level up tabs\nexport const actorInGame = writable(null); //- tracks the actor in game\nexport const abilityGenerationMethod = writable(null); //- tracks the ability generation method\nexport const subClassesForClass = writable([]); //- tracks the subclasses for the class\nexport const goldRoll = writable(0); //- tracks the gold roll\nexport const readOnlyTabs = writable([]); //- tracks the read only tabs\n//- level-up store definitions\nexport const isLevelUp = writable(false); //- tracks if the character is in level up mode\nexport const classUuidForLevelUp = writable(null); //- tracks the class uuid for level up\nexport const subClassUuidForLevelUp = writable(null); //- tracks the subclass uuid for level up\nexport const newLevelValueForExistingClass = writable(false); //- tracks new level value for existing class\nexport const selectedMultiClassUUID = writable(false); //- tracks the selected multi class\nexport const levelUpClassObject = writable(null); //- tracks the new multi class object\nexport const levelUpSubClassObject = writable(null); //- tracks the new multi class object\nexport const activeRowClassKey = writable(null); //- tracks the active row class key\nexport const levelUpCombinedHtml = writable(''); //- tracks the level up combined html\nexport const levelUpRichHTML = writable(''); //- tracks the level up rich html\nexport const levelUpRichSubClassHTML = writable(''); //- tracks the level up rich subclass html\n","import { derived, writable } from 'svelte/store';\nimport { characterClass, background } from './storeDefinitions';\n\n// Simple store for equipment gold tracking (minimal implementation)\nconst equipmentGoldOptions = writable({\n  fromClass: {\n    hasVariableGold: false,\n    goldOptions: [],\n    selectedChoice: null,\n    currentGoldAmount: 0\n  },\n  fromBackground: {\n    hasVariableGold: false,\n    goldOptions: [],\n    selectedChoice: null,\n    currentGoldAmount: 0\n  }\n});\n\n/**\n * Function to detect variable gold and extract standard equipment gold amounts\n */\nfunction parseEquipmentGoldOptions(item) {\n  if (!item?.system?.description?.value) return { hasVariableGold: false, goldOptions: [], standardEquipmentGold: 0 };\n  \n  const description = item.system.description.value;\n  \n  // Look for data-award-command patterns (FoundryVTT's award system)\n  const awardMatches = [...description.matchAll(/data-award-command=\"([^\"]*)\"/g)];\n  \n  if (awardMatches.length > 1) {\n    // Multiple award commands - parse each and build goldOptions\n    const goldOptions = awardMatches.map((match, index) => {\n      const commandValue = match[1];\n      const goldMatch = commandValue.match(/(\\d+)/);\n      const goldAmount = goldMatch ? parseInt(goldMatch[1], 10) : 0;\n      \n      // Try to find choice letter by looking backward from the match position\n      const beforeMatch = description.substring(0, match.index);\n      const choiceMatch = beforeMatch.match(/\\(([A-Z])\\)[^(]*$/);\n      const choice = choiceMatch ? choiceMatch[1] : String.fromCharCode(65 + index); // A, B, C...\n      \n      // Extract description around the choice\n      const choiceStart = choiceMatch ? beforeMatch.lastIndexOf(`(${choice})`) : match.index - 50;\n      const choiceEnd = match.index + match[0].length + 50;\n      const rawDescription = description.substring(Math.max(0, choiceStart), Math.min(description.length, choiceEnd));\n      const cleanDescription = rawDescription.replace(/<[^>]*>/g, '').trim();\n      \n      return {\n        choice,\n        goldAmount,\n        description: `${choice}: ${cleanDescription.substring(0, 100)}...`\n      };\n    });\n    \n    return { hasVariableGold: true, goldOptions, standardEquipmentGold: 0 };\n  } else if (awardMatches.length === 1) {\n    // Single award command - this is standard equipment gold\n    const commandValue = awardMatches[0][1];\n    const goldMatch = commandValue.match(/(\\d+)/);\n    const goldAmount = goldMatch ? parseInt(goldMatch[1], 10) : 0;\n    return { \n      hasVariableGold: false, \n      goldOptions: [{ choice: 'default', goldAmount, description: `Standard equipment: ${goldAmount} GP` }], \n      standardEquipmentGold: goldAmount \n    };\n  }\n  \n  // Look for choice patterns in text like \"(A)\" with GP amounts\n  const choicePattern = /\\(([A-Z])\\).*?(\\d+)\\s*(?:GP|gp)/gi;\n  const choiceMatches = [...description.matchAll(choicePattern)];\n  \n  if (choiceMatches.length > 1) {\n    // Multiple choices found - build gold options\n    const goldOptions = choiceMatches.map(match => {\n      const choice = match[1];\n      const goldAmount = parseInt(match[2], 10);\n      const choiceStart = match.index;\n      const nextChoice = description.indexOf('(', choiceStart + 1);\n      const choiceEnd = nextChoice !== -1 ? nextChoice : description.length;\n      const rawDescription = description.substring(choiceStart, choiceEnd);\n      const cleanDescription = rawDescription.replace(/<[^>]*>/g, '').trim();\n      \n      return {\n        choice,\n        goldAmount,\n        description: `${choice}: ${cleanDescription.substring(0, 100)}...`\n      };\n    });\n    \n    // Correct logic: 3+ choices = variable gold, 2 choices = equipment vs wealth\n    const hasVariableGold = choiceMatches.length >= 3;\n    \n    if (hasVariableGold) {\n      // This is true variable gold (like Fighter: A, B, C with different equipment options)\n      return { hasVariableGold: true, goldOptions, standardEquipmentGold: 0 };\n    } else {\n      // This is standard equipment vs wealth choice (like Wizard: A = Equipment + 5gp, B = Starting wealth)\n      // Use the first option (equipment) as the standard amount for calculation purposes\n      const goldAmounts = goldOptions.map(opt => opt.goldAmount);\n      return { hasVariableGold: false, goldOptions, standardEquipmentGold: goldAmounts[0] };\n    }\n  } else if (choiceMatches.length === 1) {\n    // Single choice with gold amount\n    const match = choiceMatches[0];\n    const goldAmount = parseInt(match[2], 10);\n    const choice = match[1];\n    return { \n      hasVariableGold: false, \n      goldOptions: [{ choice, goldAmount, description: `${choice}: Single choice ${goldAmount} GP` }], \n      standardEquipmentGold: goldAmount \n    };\n  }\n  \n  // Look for any GP mentions as fallback\n  const anyGoldMatch = description.match(/(\\d+)\\s*(?:GP|gp)/i);\n  if (anyGoldMatch) {\n    const goldAmount = parseInt(anyGoldMatch[1], 10);\n    return { \n      hasVariableGold: false, \n      goldOptions: [{ choice: 'default', goldAmount, description: `Standard: ${goldAmount} GP` }], \n      standardEquipmentGold: goldAmount \n    };\n  }\n  \n  return { hasVariableGold: false, goldOptions: [], standardEquipmentGold: 0 };\n}\n\n// Derived store that parses equipment gold options when class/background changes\nconst parsedEquipmentGold = derived(\n  [characterClass, background],\n  ([$characterClass, $background]) => {\n    const classOptions = $characterClass ? parseEquipmentGoldOptions($characterClass) : { hasVariableGold: false, goldOptions: [], standardEquipmentGold: 0 };\n    const backgroundOptions = $background ? parseEquipmentGoldOptions($background) : { hasVariableGold: false, goldOptions: [], standardEquipmentGold: 0 };\n    \n    return {\n      fromClass: classOptions,\n      fromBackground: backgroundOptions\n    };\n  }\n);\n\n// Helper functions to manage equipment gold selections\nconst setEquipmentGoldChoice = (source, choice, goldAmount) => {\n  equipmentGoldOptions.update(current => ({\n    ...current,\n    [source]: {\n      ...current[source],\n      selectedChoice: choice,\n      currentGoldAmount: goldAmount || 0\n    }\n  }));\n};\n\nconst updateGoldFromEquipmentChoice = (source, choiceId, goldAmount) => {\n  equipmentGoldOptions.update(current => ({\n    ...current,\n    [source]: {\n      ...current[source],\n      selectedChoice: choiceId,\n      currentGoldAmount: goldAmount || 0\n    }\n  }));\n};\n\nconst clearEquipmentGoldChoices = () => {\n  equipmentGoldOptions.set({\n    fromClass: {\n      hasVariableGold: false,\n      goldOptions: [],\n      selectedChoice: null,\n      currentGoldAmount: 0\n    },\n    fromBackground: {\n      hasVariableGold: false,\n      goldOptions: [],\n      selectedChoice: null,\n      currentGoldAmount: 0\n    }\n  });\n};\n\n// Derived store for total gold from equipment choices\nconst totalEquipmentGold = derived(\n  equipmentGoldOptions,\n  ($equipmentGoldOptions) => {\n    return $equipmentGoldOptions.fromClass.currentGoldAmount + \n           $equipmentGoldOptions.fromBackground.currentGoldAmount;\n  }\n);\n\n// Check if equipment gold choices are complete\n// Note: This will be called from goldChoices.js with the goldChoices data to avoid circular dependency\nconst areEquipmentGoldChoicesComplete = derived(\n  [parsedEquipmentGold, equipmentGoldOptions],\n  ([$parsedEquipmentGold, $equipmentGoldOptions]) => {\n    // This function will be enhanced by goldChoices.js to include user choice context\n    // For now, return completion based on variable gold selections only\n    \n    // Check if class has variable gold and needs a choice\n    const classNeedsChoice = $parsedEquipmentGold.fromClass.hasVariableGold;\n    const classChoiceComplete = !classNeedsChoice || $equipmentGoldOptions.fromClass.selectedChoice !== null;\n    \n    // Check if background has variable gold and needs a choice  \n    const backgroundNeedsChoice = $parsedEquipmentGold.fromBackground.hasVariableGold;\n    const backgroundChoiceComplete = !backgroundNeedsChoice || $equipmentGoldOptions.fromBackground.selectedChoice !== null;\n    \n    return classChoiceComplete && backgroundChoiceComplete;\n  }\n);\n\nexport {\n  equipmentGoldOptions,\n  parsedEquipmentGold,\n  totalEquipmentGold,\n  areEquipmentGoldChoicesComplete,\n  updateGoldFromEquipmentChoice,\n  setEquipmentGoldChoice,\n  clearEquipmentGoldChoices,\n  parseEquipmentGoldOptions\n};\n","import { derived, writable } from 'svelte/store';\nimport { goldRoll } from './storeDefinitions';\nimport { totalEquipmentGold, areEquipmentGoldChoicesComplete, parsedEquipmentGold, equipmentGoldOptions } from './equipmentGold';\n\n// Base store for gold choices\nconst goldChoices = writable({\n  fromClass: {\n    choice: null, // 'equipment' or 'gold'\n    goldValue: 0\n  },\n  fromBackground: {\n    choice: null, // 'equipment' or 'gold'\n    goldValue: 0\n  }\n});\n\n// Derived store for total gold from choices (includes equipment-dependent gold)\nconst totalGoldFromChoices = derived([\n  goldChoices,\n  parsedEquipmentGold,\n  equipmentGoldOptions\n], ([$goldChoices, $parsedEquipmentGold, $equipmentGoldOptions]) => {\n  // Use the same calculation logic that was working in the Equipment tab\n  const classGoldValue = $goldChoices?.fromClass?.goldValue;\n  const backgroundGoldValue = $goldChoices?.fromBackground?.goldValue;\n  const classEquipmentGold = $equipmentGoldOptions?.fromClass?.currentGoldAmount;\n  const backgroundEquipmentGold = $equipmentGoldOptions?.fromBackground?.currentGoldAmount;\n  const classHasVariableGold = $parsedEquipmentGold?.fromClass?.hasVariableGold;\n  const backgroundHasVariableGold = $parsedEquipmentGold?.fromBackground?.hasVariableGold;\n  \n  const totalGold = (isNaN(parseInt(classGoldValue)) ? 0 : parseInt(classGoldValue)) + \n                   (isNaN(parseInt(backgroundGoldValue)) ? 0 : parseInt(backgroundGoldValue)) + \n                   // Only add equipment gold for sources with variable gold AND where user has chosen equipment AND made a selection\n                   (classHasVariableGold && $goldChoices?.fromClass?.choice === 'equipment' && $equipmentGoldOptions?.fromClass?.selectedChoice ? (classEquipmentGold || 0) : 0) + \n                   (backgroundHasVariableGold && $goldChoices?.fromBackground?.choice === 'equipment' && $equipmentGoldOptions?.fromBackground?.selectedChoice ? (backgroundEquipmentGold || 0) : 0);\n  \n  console.log(' totalGoldFromChoices calculation:', {\n    classGoldValue, backgroundGoldValue, classEquipmentGold, backgroundEquipmentGold,\n    classHasVariableGold, backgroundHasVariableGold, \n    classChoice: $goldChoices?.fromClass?.choice,\n    backgroundChoice: $goldChoices?.fromBackground?.choice,\n    classSelectedChoice: $equipmentGoldOptions?.fromClass?.selectedChoice,\n    backgroundSelectedChoice: $equipmentGoldOptions?.fromBackground?.selectedChoice,\n    totalGold\n  });\n  \n  return totalGold;\n});\n\n// Derived store that updates goldRoll for backwards compatibility\nconst goldChoicesCompat = derived(totalGoldFromChoices, ($totalGoldFromChoices) => {\n  goldRoll.set($totalGoldFromChoices);\n  return $totalGoldFromChoices;\n});\n\n// Derived store to check if choices are complete (includes equipment gold completion)\nconst areGoldChoicesComplete = derived([goldChoices, goldRoll, areEquipmentGoldChoicesComplete, parsedEquipmentGold, equipmentGoldOptions], ([$goldChoices, $goldRoll, $areEquipmentGoldChoicesComplete, $parsedEquipmentGold, $equipmentGoldOptions]) => {\n  const isDnd2014 = window.GAS.dnd5eVersion < 4 || window.GAS.dnd5eRules === '2014';\n  let complete = false;\n  if (isDnd2014) {\n    complete = $goldRoll > 0;\n  } else {\n    const basicChoicesComplete = $goldChoices.fromClass.choice !== null && \n                                $goldChoices.fromBackground.choice !== null;\n    \n    if (!basicChoicesComplete) {\n      complete = false;\n    } else {\n      // Check if user chose equipment for either class or background\n      const userChoseClassEquipment = $goldChoices.fromClass.choice === 'equipment';\n      const userChoseBackgroundEquipment = $goldChoices.fromBackground.choice === 'equipment';\n      const userChoseEquipment = userChoseClassEquipment || userChoseBackgroundEquipment;\n      \n      if (!userChoseEquipment) {\n        // User chose gold-only for both - no equipment selection needed\n        complete = true;\n      } else {\n        // User chose equipment for at least one - check equipment gold completion with user choice context\n        \n        // Check if class has variable gold and needs a choice (only if user chose equipment)\n        const classNeedsChoice = userChoseClassEquipment && $parsedEquipmentGold.fromClass.hasVariableGold;\n        const classChoiceComplete = !classNeedsChoice || $equipmentGoldOptions.fromClass.selectedChoice !== null;\n        \n        // Check if background has variable gold and needs a choice (only if user chose equipment)\n        const backgroundNeedsChoice = userChoseBackgroundEquipment && $parsedEquipmentGold.fromBackground.hasVariableGold;\n        const backgroundChoiceComplete = !backgroundNeedsChoice || $equipmentGoldOptions.fromBackground.selectedChoice !== null;\n        \n        complete = classChoiceComplete && backgroundChoiceComplete;\n      }\n    }\n  }\n  return complete;\n});\n\n// Helper functions\nconst setClassGoldChoice = (choice, value) => {\n  goldChoices.update(current => ({\n    ...current,\n    fromClass: {\n      choice,\n      goldValue: value\n    }\n  }));\n};\n\nconst setBackgroundGoldChoice = (choice, value) => {\n  goldChoices.update(current => ({\n    ...current,\n    fromBackground: {\n      choice,\n      goldValue: value\n    }\n  }));\n};\n\nconst clearGoldChoices = () => {\n  goldChoices.set({\n    fromClass: {\n      choice: null,\n      goldValue: 0\n    },\n    fromBackground: {\n      choice: null,\n      goldValue: 0\n    }\n  });\n};\n\nexport {\n  goldChoices,\n  totalGoldFromChoices,\n  areGoldChoicesComplete,\n  setClassGoldChoice,\n  setBackgroundGoldChoice,\n  clearGoldChoices\n}; \n\n// Make the stores globally available for the WorkflowStateMachine and other components\nif (typeof window !== 'undefined') {\n  window.GAS = window.GAS || {};\n  window.GAS.totalGoldFromChoices = totalGoldFromChoices;\n  window.GAS.goldRoll = goldRoll;\n}","import { derived, get, writable } from 'svelte/store';\n// Import directly from storeDefinitions instead of index\nimport { characterClass, background } from './storeDefinitions';\nimport { goldChoices } from './goldChoices';\n\n// Function to clean equipment structure by removing unnecessary OR wrappers\n// Currently disabled - implementing fix at component level instead\nfunction cleanEquipmentStructure(equipment) {\n  if (!Array.isArray(equipment)) return equipment;\n  \n  // For now, just return the equipment as-is\n  // The cleaning will be handled in the component\n  return equipment;\n}\n\n// Base store for starting equipment\n\n// Derived store that automatically updates when class/background change\nconst startingEquipment = derived(\n  [characterClass, background],\n  ([$characterClass, $background]) => {\n      return {\n        fromClass: cleanEquipmentStructure($characterClass?.system?.startingEquipment || []),\n        fromBackground: cleanEquipmentStructure($background?.system?.startingEquipment || [])\n      }\n  }\n);\n\n// Derived stores for specific sources\nconst classStartingEquipment = derived(startingEquipment, ($startingEquipment) => {\n  window.GAS.log.d('[StartingEquipment] startingEquipment', $startingEquipment);\n  return $startingEquipment.fromClass;\n});\n\nconst backgroundStartingEquipment = derived(startingEquipment, ($startingEquipment) => {\n  return $startingEquipment.fromBackground;\n});\n\n// Combined flattened equipment for components that don't need source separation\nconst flattenedStartingEquipment = derived(startingEquipment, ($startingEquipment) => {\n  return [...$startingEquipment.fromClass, ...$startingEquipment.fromBackground];\n});\n\nconst compatibleStartingEquipment = derived([classStartingEquipment, backgroundStartingEquipment, goldChoices], ([$classStartingEquipment, $backgroundStartingEquipment, $goldChoices]) => {\n  window.GAS.log.d('[StartingEquipment] compatibleStartingEquipment inputs', {\n    classStartingEquipment: $classStartingEquipment,\n    goldChoices: $goldChoices\n  });\n  \n  if (window.GAS.dnd5eVersion < 4 || window.GAS.dnd5eRules === \"2014\") {\n    return $classStartingEquipment;\n  } \n  \n  // Check for equipment vs gold choices\n  const classChoseGold = $goldChoices.fromClass.choice === 'gold';\n  const backgroundChoseGold = $goldChoices.fromBackground.choice === 'gold';\n  \n  // If both chose equipment, return both\n  if (!classChoseGold && !backgroundChoseGold) {\n    return [...$classStartingEquipment, ...$backgroundStartingEquipment];\n  } \n  \n  // If only class chose equipment, return class equipment\n  if (!classChoseGold && backgroundChoseGold) {\n    return $classStartingEquipment;\n  } \n  \n  // If only background chose equipment, return background equipment\n  if (classChoseGold && !backgroundChoseGold) {\n    return $backgroundStartingEquipment;\n  }   \n  \n  // Both chose gold, return empty\n  return [];\n});\n\n// Reset function\nconst clearStartingEquipment = () => {\n  // startingEquipment is a derived store, so it will automatically reset\n  // when characterClass and background are reset. No action needed here.\n};\n\nexport {\n  startingEquipment,\n  classStartingEquipment,\n  backgroundStartingEquipment,\n  flattenedStartingEquipment,\n  compatibleStartingEquipment,\n  clearStartingEquipment\n};\n","\"use strict\";\n\nexports.__esModule = true;\nexports.default = mapValues;\nfunction mapValues(obj, callback) {\n  var prototype = Object.getPrototypeOf(obj);\n  var result = Object.create(prototype);\n  Object.keys(obj).forEach(function (key) {\n    result[key] = callback(obj[key]);\n  });\n  return result;\n}","'use strict';\n\nexports.__esModule = true;\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _mapValues = require('../utils/mapValues');\n\nvar _mapValues2 = _interopRequireDefault(_mapValues);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar BaseConfigurator = function () {\n  function BaseConfigurator(parent) {\n    _classCallCheck(this, BaseConfigurator);\n\n    this.parent = parent;\n  }\n\n  BaseConfigurator.prototype.getAncestor = function getAncestor(type) {\n    if (this.parent) {\n      return this.parent instanceof type ? this.parent : this.parent.getAncestor(type);\n    }\n    return null;\n  };\n\n  BaseConfigurator.prototype.buildConfig = function buildConfig() {\n    var mapper = function mapper(value) {\n      if (!value) {\n        return value;\n      }\n      if (value instanceof BaseConfigurator) {\n        return value.buildConfig();\n      }\n      if (Array.isArray(value)) {\n        return value.map(mapper);\n      }\n      if (value && (typeof value === 'undefined' ? 'undefined' : _typeof(value)) === 'object') {\n        return (0, _mapValues2.default)(value, mapper);\n      }\n      return value;\n    };\n    return (0, _mapValues2.default)(this.config, mapper);\n  };\n\n  return BaseConfigurator;\n}();\n\nexports.default = BaseConfigurator;","'use strict';\n\nexports.__esModule = true;\n\nvar _BaseConfigurator2 = require('./BaseConfigurator');\n\nvar _BaseConfigurator3 = _interopRequireDefault(_BaseConfigurator2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar GlobalConfigurator = function (_BaseConfigurator) {\n  _inherits(GlobalConfigurator, _BaseConfigurator);\n\n  function GlobalConfigurator(parent) {\n    _classCallCheck(this, GlobalConfigurator);\n\n    var _this = _possibleConstructorReturn(this, _BaseConfigurator.call(this, parent));\n\n    _this.config = {\n      stateEnterHooks: [],\n      stateExitHooks: [],\n      stateChangeHooks: [],\n      transitionHooks: [],\n      unhandledEventHooks: []\n    };\n    return _this;\n  }\n\n  GlobalConfigurator.prototype.onStateEnter = function onStateEnter(hook) {\n    this.config.stateEnterHooks.push(hook);\n    return this;\n  };\n\n  GlobalConfigurator.prototype.onStateExit = function onStateExit(hook) {\n    this.config.stateExitHooks.push(hook);\n    return this;\n  };\n\n  GlobalConfigurator.prototype.onStateChange = function onStateChange(hook) {\n    this.config.stateChangeHooks.push(hook);\n    return this;\n  };\n\n  GlobalConfigurator.prototype.onTransition = function onTransition(hook) {\n    this.config.transitionHooks.push(hook);\n    return this;\n  };\n\n  GlobalConfigurator.prototype.onUnhandledEvent = function onUnhandledEvent(hook) {\n    this.config.unhandledEventHooks.push(hook);\n    return this;\n  };\n\n  return GlobalConfigurator;\n}(_BaseConfigurator3.default);\n\nexports.default = GlobalConfigurator;","'use strict';\n\nexports.__esModule = true;\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _BaseConfigurator2 = require('./BaseConfigurator');\n\nvar _BaseConfigurator3 = _interopRequireDefault(_BaseConfigurator2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar TransitionConfigurator = function (_BaseConfigurator) {\n  _inherits(TransitionConfigurator, _BaseConfigurator);\n\n  function TransitionConfigurator(parent, targetState) {\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    _classCallCheck(this, TransitionConfigurator);\n\n    var _this = _possibleConstructorReturn(this, _BaseConfigurator.call(this, parent));\n\n    _this.config = _extends({\n      targetState: targetState\n    }, options, {\n      actions: [],\n      condition: null\n    });\n    return _this;\n  }\n\n  TransitionConfigurator.prototype.withAction = function withAction(action) {\n    this.config.actions.push(action);\n    return this;\n  };\n\n  TransitionConfigurator.prototype.withCondition = function withCondition(condition) {\n    this.config.condition = condition;\n    return this;\n  };\n\n  return TransitionConfigurator;\n}(_BaseConfigurator3.default);\n\nexports.default = TransitionConfigurator;","'use strict';\n\nexports.__esModule = true;\n\nvar _BaseConfigurator2 = require('./BaseConfigurator');\n\nvar _BaseConfigurator3 = _interopRequireDefault(_BaseConfigurator2);\n\nvar _TransitionConfigurator = require('./TransitionConfigurator');\n\nvar _TransitionConfigurator2 = _interopRequireDefault(_TransitionConfigurator);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar TriggerConfigurator = function (_BaseConfigurator) {\n  _inherits(TriggerConfigurator, _BaseConfigurator);\n\n  function TriggerConfigurator(parent) {\n    _classCallCheck(this, TriggerConfigurator);\n\n    var _this = _possibleConstructorReturn(this, _BaseConfigurator.call(this, parent));\n\n    _this.config = {\n      transitions: []\n    };\n    return _this;\n  }\n\n  TriggerConfigurator.prototype.transitionTo = function transitionTo(targetState) {\n    return this.transition(targetState);\n  };\n\n  TriggerConfigurator.prototype.selfTransition = function selfTransition() {\n    return this.transition(null);\n  };\n\n  TriggerConfigurator.prototype.internalTransition = function internalTransition() {\n    return this.transition(null, { isInternal: true });\n  };\n\n  TriggerConfigurator.prototype.ignore = function ignore() {\n    return this.transition(null, { ignore: true });\n  };\n\n  TriggerConfigurator.prototype.transition = function transition(targetState, options) {\n    var transitionConfigurator = new _TransitionConfigurator2.default(this, targetState, options);\n    this.config.transitions.push(transitionConfigurator);\n    return transitionConfigurator;\n  };\n\n  return TriggerConfigurator;\n}(_BaseConfigurator3.default);\n\nexports.default = TriggerConfigurator;","'use strict';\n\nexports.__esModule = true;\n\nvar _TriggerConfigurator2 = require('./TriggerConfigurator');\n\nvar _TriggerConfigurator3 = _interopRequireDefault(_TriggerConfigurator2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar TrimerConfigurator = function (_TriggerConfigurator) {\n  _inherits(TrimerConfigurator, _TriggerConfigurator);\n\n  function TrimerConfigurator(parent, timeout) {\n    _classCallCheck(this, TrimerConfigurator);\n\n    var _this = _possibleConstructorReturn(this, _TriggerConfigurator.call(this, parent));\n\n    _this.config.timeout = timeout;\n    return _this;\n  }\n\n  return TrimerConfigurator;\n}(_TriggerConfigurator3.default);\n\nexports.default = TrimerConfigurator;","'use strict';\n\nexports.__esModule = true;\n\nvar _BaseConfigurator2 = require('./BaseConfigurator');\n\nvar _BaseConfigurator3 = _interopRequireDefault(_BaseConfigurator2);\n\nvar _TriggerConfigurator = require('./TriggerConfigurator');\n\nvar _TriggerConfigurator2 = _interopRequireDefault(_TriggerConfigurator);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar AsyncActionConfigurator = function (_BaseConfigurator) {\n  _inherits(AsyncActionConfigurator, _BaseConfigurator);\n\n  function AsyncActionConfigurator(parent, action) {\n    _classCallCheck(this, AsyncActionConfigurator);\n\n    var _this = _possibleConstructorReturn(this, _BaseConfigurator.call(this, parent));\n\n    _this.config = {\n      action: action,\n      successTrigger: new _TriggerConfigurator2.default(_this),\n      failureTrigger: new _TriggerConfigurator2.default(_this)\n    };\n    return _this;\n  }\n\n  AsyncActionConfigurator.prototype.onSuccess = function onSuccess() {\n    return this.config.successTrigger;\n  };\n\n  AsyncActionConfigurator.prototype.onFailure = function onFailure() {\n    return this.config.failureTrigger;\n  };\n\n  return AsyncActionConfigurator;\n}(_BaseConfigurator3.default);\n\nexports.default = AsyncActionConfigurator;","'use strict';\n\nexports.__esModule = true;\n\nvar _BaseConfigurator2 = require('./BaseConfigurator');\n\nvar _BaseConfigurator3 = _interopRequireDefault(_BaseConfigurator2);\n\nvar _TriggerConfigurator = require('./TriggerConfigurator');\n\nvar _TriggerConfigurator2 = _interopRequireDefault(_TriggerConfigurator);\n\nvar _TimerConfigurator = require('./TimerConfigurator');\n\nvar _TimerConfigurator2 = _interopRequireDefault(_TimerConfigurator);\n\nvar _AsyncActionConfigurator = require('./AsyncActionConfigurator');\n\nvar _AsyncActionConfigurator2 = _interopRequireDefault(_AsyncActionConfigurator);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar StateConfigurator = function (_BaseConfigurator) {\n  _inherits(StateConfigurator, _BaseConfigurator);\n\n  function StateConfigurator(parent) {\n    _classCallCheck(this, StateConfigurator);\n\n    var _this = _possibleConstructorReturn(this, _BaseConfigurator.call(this, parent));\n\n    _this.config = {\n      entryActions: [],\n      exitActions: [],\n      events: Object.create(null),\n      anyEventTrigger: null,\n      timers: [],\n      asyncActions: [],\n      submachine: null\n    };\n    return _this;\n  }\n\n  StateConfigurator.prototype.onEnter = function onEnter(action) {\n    this.config.entryActions.push(action);\n    return this;\n  };\n\n  StateConfigurator.prototype.onExit = function onExit(action) {\n    this.config.exitActions.push(action);\n    return this;\n  };\n\n  StateConfigurator.prototype.on = function on(event) {\n    if (!this.config.events[event]) {\n      this.config.events[event] = new _TriggerConfigurator2.default(this);\n    }\n    return this.config.events[event];\n  };\n\n  StateConfigurator.prototype.onAny = function onAny() {\n    if (!this.config.anyEventTrigger) {\n      this.config.anyEventTrigger = new _TriggerConfigurator2.default(this);\n    }\n    return this.config.anyEventTrigger;\n  };\n\n  StateConfigurator.prototype.onTimeout = function onTimeout(timeout) {\n    var timerConfigurator = new _TimerConfigurator2.default(this, timeout);\n    this.config.timers.push(timerConfigurator);\n    return timerConfigurator;\n  };\n\n  StateConfigurator.prototype.do = function _do(asyncAction) {\n    var asyncActionConfigurator = new _AsyncActionConfigurator2.default(this, asyncAction);\n    this.config.asyncActions.push(asyncActionConfigurator);\n    return asyncActionConfigurator;\n  };\n\n  StateConfigurator.prototype.submachine = function submachine(submachineConfig) {\n    this.config.submachine = submachineConfig;\n    return this;\n  };\n\n  return StateConfigurator;\n}(_BaseConfigurator3.default);\n\nexports.default = StateConfigurator;","\"use strict\";\n\nexports.__esModule = true;\nexports.default = invokeEach;\nfunction invokeEach(fns) {\n  for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    args[_key - 1] = arguments[_key];\n  }\n\n  fns.forEach(function (fn) {\n    return fn.apply(undefined, args);\n  });\n}","\"use strict\";\n\nexports.__esModule = true;\nexports.default = merge;\nfunction merge(target, source) {\n  Object.keys(source).forEach(function (key) {\n    target[key] = source[key];\n  });\n  return target;\n}","'use strict';\n\nexports.__esModule = true;\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _invokeEach = require('../utils/invokeEach');\n\nvar _invokeEach2 = _interopRequireDefault(_invokeEach);\n\nvar _merge = require('../utils/merge');\n\nvar _merge2 = _interopRequireDefault(_merge);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar noop = function noop() {};\n\nvar StateMachine = function () {\n  function StateMachine(config, taskScheduler, contextFactory) {\n    _classCallCheck(this, StateMachine);\n\n    if (config === undefined || config === null) {\n      throw new Error('Configuration must be specified.');\n    }\n    if ((typeof config === 'undefined' ? 'undefined' : _typeof(config)) !== 'object') {\n      throw new Error('Configuration must be an object.');\n    }\n    if (config.initialState === undefined || config.initialState === null) {\n      throw new Error('Initial state must be specified.');\n    }\n    this.config = config;\n    this.taskScheduler = taskScheduler;\n    this.contextFactory = contextFactory;\n    this.currentState = null;\n    this.submachines = Object.create(null);\n    this.timerIDs = null;\n    this.asyncActionCancelers = null;\n    this.handleAsyncActionComplete = this.handleAsyncActionComplete.bind(this);\n    this.handleTimeout = this.handleTimeout.bind(this);\n  }\n\n  StateMachine.prototype.getCurrentState = function getCurrentState() {\n    return this.currentState;\n  };\n\n  StateMachine.prototype.canHandle = function canHandle(event, eventPayload) {\n    if (!this.isStarted()) {\n      return false;\n    }\n\n    var context = this.createContextWithEvent(event, eventPayload);\n    return !!this.getFirstAllowedTransitionForEvent(context);\n  };\n\n  StateMachine.prototype.tryHandle = function tryHandle(event, eventPayload) {\n    if (!this.isStarted()) {\n      return false;\n    }\n\n    var context = this.createContextWithEvent(event, eventPayload);\n    var transitionConfig = this.getFirstAllowedTransitionForEvent(context);\n    if (transitionConfig) {\n      this.executeTransition(transitionConfig, context);\n      return true;\n    }\n    return false;\n  };\n\n  StateMachine.prototype.handleUnhandledEvent = function handleUnhandledEvent(event, eventPayload) {\n    if (this.config.global.unhandledEventHooks.length > 0) {\n      (0, _invokeEach2.default)(this.config.global.unhandledEventHooks, event, this.currentState, this.createContextWithEvent(event, eventPayload));\n    } else {\n      throw new Error('Unhandled event \\'' + event + '\\' in state \\'' + this.currentState + '\\'.');\n    }\n  };\n\n  StateMachine.prototype.isStarted = function isStarted() {\n    return this.currentState !== null;\n  };\n\n  StateMachine.prototype.start = function start() {\n    if (!this.isStarted()) {\n      this.enterState(this.config.initialState, this.createContext());\n    }\n  };\n\n  StateMachine.prototype.stop = function stop() {\n    if (this.isStarted()) {\n      this.exitState(this.createContext());\n      this.currentState = null;\n    }\n  };\n\n  StateMachine.prototype.getSubmachine = function getSubmachine() {\n    return this.isStarted() ? this.submachines[this.currentState] : null;\n  };\n\n  StateMachine.prototype.executeTransition = function executeTransition(transitionConfig, context) {\n    if (transitionConfig.ignore) {\n      return;\n    }\n\n    if (!transitionConfig.isInternal) {\n      this.exitState(context);\n    }\n\n    var nextState = transitionConfig.targetState !== null ? transitionConfig.targetState : this.currentState;\n\n    (0, _invokeEach2.default)(this.config.global.transitionHooks, this.currentState, nextState, context);\n    (0, _invokeEach2.default)(transitionConfig.actions, this.currentState, nextState, context);\n\n    if (!transitionConfig.isInternal) {\n      this.enterState(nextState, context);\n    }\n  };\n\n  StateMachine.prototype.enterState = function enterState(state, context) {\n    (0, _invokeEach2.default)(this.config.global.stateEnterHooks, state, context);\n\n    var stateConfig = this.config.states[state];\n    if (stateConfig) {\n      (0, _invokeEach2.default)(stateConfig.entryActions, state, context);\n    }\n\n    if (this.currentState !== null && this.currentState !== state) {\n      (0, _invokeEach2.default)(this.config.global.stateChangeHooks, this.currentState, state, context);\n    }\n\n    try {\n      this.startAsyncActions(state, context);\n      this.startTimers(state);\n      this.startSubmachines(state);\n    } catch (error) {\n      this.stopTimers();\n      this.cancelAsyncActions();\n      throw error;\n    }\n\n    this.currentState = state;\n  };\n\n  StateMachine.prototype.exitState = function exitState(context) {\n    this.stopSubmachines();\n    this.stopTimers();\n    this.cancelAsyncActions();\n\n    (0, _invokeEach2.default)(this.config.global.stateExitHooks, this.currentState, context);\n\n    var stateConfig = this.config.states[this.currentState];\n    if (stateConfig) {\n      (0, _invokeEach2.default)(stateConfig.exitActions, this.currentState, context);\n    }\n  };\n\n  StateMachine.prototype.startAsyncActions = function startAsyncActions(state, context) {\n    var _this = this;\n\n    var stateConfig = this.config.states[state];\n    if (stateConfig) {\n      stateConfig.asyncActions.forEach(function (asyncActionConfig) {\n        return _this.startAsyncAction(asyncActionConfig, state, context);\n      });\n    }\n  };\n\n  StateMachine.prototype.startAsyncAction = function startAsyncAction(asyncActionConfig, state, context) {\n    var action = asyncActionConfig.action,\n        successTrigger = asyncActionConfig.successTrigger,\n        failureTrigger = asyncActionConfig.failureTrigger;\n\n    var handleComplete = this.handleAsyncActionComplete;\n    action(state, context).then(function (result) {\n      return handleComplete(successTrigger, { result: result });\n    }, function (error) {\n      return handleComplete(failureTrigger, { error: error });\n    });\n    this.asyncActionCancelers = this.asyncActionCancelers || [];\n    this.asyncActionCancelers.push(function () {\n      handleComplete = noop;\n    });\n  };\n\n  StateMachine.prototype.cancelAsyncActions = function cancelAsyncActions() {\n    if (this.asyncActionCancelers) {\n      (0, _invokeEach2.default)(this.asyncActionCancelers);\n      this.asyncActionCancelers = null;\n    }\n  };\n\n  StateMachine.prototype.handleAsyncActionComplete = function handleAsyncActionComplete(triggerConfig, additionalContext) {\n    var context = (0, _merge2.default)(this.createContext(), additionalContext);\n    this.executeTrigger(triggerConfig, context);\n  };\n\n  StateMachine.prototype.startTimers = function startTimers(state) {\n    var _this2 = this;\n\n    var stateConfig = this.config.states[state];\n    if (stateConfig && stateConfig.timers.length > 0) {\n      this.timerIDs = stateConfig.timers.map(function (timerConfig) {\n        return setTimeout(_this2.handleTimeout, timerConfig.timeout, timerConfig);\n      });\n    }\n  };\n\n  StateMachine.prototype.stopTimers = function stopTimers() {\n    if (this.timerIDs) {\n      this.timerIDs.forEach(clearTimeout);\n      this.timerIDs = null;\n    }\n  };\n\n  StateMachine.prototype.handleTimeout = function handleTimeout(timerConfig) {\n    this.executeTrigger(timerConfig, this.createContext());\n  };\n\n  StateMachine.prototype.startSubmachines = function startSubmachines(state) {\n    var stateConfig = this.config.states[state];\n    if (stateConfig && stateConfig.submachine) {\n      if (!this.submachines[state]) {\n        this.submachines[state] = new StateMachine(stateConfig.submachine, this.taskScheduler, this.contextFactory);\n      }\n      this.submachines[state].start();\n    }\n  };\n\n  StateMachine.prototype.stopSubmachines = function stopSubmachines() {\n    var submachine = this.submachines[this.currentState];\n    if (submachine) {\n      submachine.stop();\n    }\n  };\n\n  StateMachine.prototype.createContext = function createContext() {\n    return this.contextFactory(this);\n  };\n\n  StateMachine.prototype.createContextWithEvent = function createContextWithEvent(event, eventPayload) {\n    var context = this.createContext();\n    context.event = event;\n    if (eventPayload !== undefined) {\n      context.eventPayload = eventPayload;\n    }\n    return context;\n  };\n\n  StateMachine.getFirstAllowedTransition = function getFirstAllowedTransition(transitions, context) {\n    for (var i = 0; i < transitions.length; i++) {\n      if (!transitions[i].condition || transitions[i].condition(context)) {\n        return transitions[i];\n      }\n    }\n    return null;\n  };\n\n  StateMachine.prototype.getFirstAllowedTransitionForEvent = function getFirstAllowedTransitionForEvent(context) {\n    var stateConfig = this.config.states[this.currentState];\n    if (!stateConfig) {\n      return null;\n    }\n\n    var transitionConfig = null;\n\n    var eventConfig = stateConfig.events[context.event];\n    if (eventConfig) {\n      transitionConfig = StateMachine.getFirstAllowedTransition(eventConfig.transitions, context);\n    }\n\n    if (!transitionConfig && stateConfig.anyEventTrigger) {\n      transitionConfig = StateMachine.getFirstAllowedTransition(stateConfig.anyEventTrigger.transitions, context);\n    }\n\n    return transitionConfig;\n  };\n\n  StateMachine.prototype.executeTrigger = function executeTrigger(triggerConfig, context) {\n    var _this3 = this;\n\n    this.taskScheduler.execute(function () {\n      var transitionConfig = StateMachine.getFirstAllowedTransition(triggerConfig.transitions, context);\n      if (transitionConfig) {\n        _this3.executeTransition(transitionConfig, context);\n      }\n    });\n  };\n\n  return StateMachine;\n}();\n\nexports.default = StateMachine;","'use strict';\n\nexports.__esModule = true;\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar TaskScheduler = function () {\n  function TaskScheduler() {\n    _classCallCheck(this, TaskScheduler);\n\n    this.queue = [];\n    this.isBusy = false;\n  }\n\n  TaskScheduler.prototype.enqueue = function enqueue(task) {\n    if (this.isBusy) {\n      this.queue.push(task);\n    } else {\n      this.execute(task);\n    }\n  };\n\n  TaskScheduler.prototype.execute = function execute(task) {\n    if (this.isBusy) {\n      throw new Error('Cannot execute task because another task is already running.');\n    }\n    this.isBusy = true;\n    try {\n      task();\n      while (this.queue.length > 0) {\n        var nextTask = this.queue.shift();\n        nextTask();\n      }\n    } finally {\n      // Clean up\n      if (this.queue.length > 0) {\n        this.queue = [];\n      }\n      this.isBusy = false;\n    }\n  };\n\n  return TaskScheduler;\n}();\n\nexports.default = TaskScheduler;","'use strict';\n\nexports.__esModule = true;\n\nvar _StateMachine = require('./StateMachine');\n\nvar _StateMachine2 = _interopRequireDefault(_StateMachine);\n\nvar _TaskScheduler = require('./TaskScheduler');\n\nvar _TaskScheduler2 = _interopRequireDefault(_TaskScheduler);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar HierarchicalStateMachine = function () {\n  function HierarchicalStateMachine(rootStateMachine, currentStateMachine, taskScheduler) {\n    _classCallCheck(this, HierarchicalStateMachine);\n\n    this.rootStateMachine = rootStateMachine;\n    this.currentStateMachine = currentStateMachine;\n    this.taskScheduler = taskScheduler;\n  }\n\n  HierarchicalStateMachine.start = function start(config) {\n    var taskScheduler = new _TaskScheduler2.default();\n    var rootStateMachine = void 0;\n    var createContext = function createContext(stateMachine) {\n      return {\n        stateMachine: new HierarchicalStateMachine(rootStateMachine, stateMachine, taskScheduler)\n      };\n    };\n    rootStateMachine = new _StateMachine2.default(config, taskScheduler, createContext);\n    taskScheduler.execute(function () {\n      return rootStateMachine.start();\n    });\n    return new HierarchicalStateMachine(rootStateMachine, rootStateMachine, taskScheduler);\n  };\n\n  HierarchicalStateMachine.prototype.getCurrentState = function getCurrentState() {\n    return this.currentStateMachine.getCurrentState();\n  };\n\n  HierarchicalStateMachine.prototype.getSubmachine = function getSubmachine() {\n    var submachine = this.currentStateMachine.getSubmachine();\n    if (submachine) {\n      return new HierarchicalStateMachine(this.rootStateMachine, submachine, this.taskScheduler);\n    }\n    return null;\n  };\n\n  HierarchicalStateMachine.prototype.getStateHierarchy = function getStateHierarchy() {\n    return this.getStateMachines().map(function (stateMachine) {\n      return stateMachine.getCurrentState();\n    });\n  };\n\n  HierarchicalStateMachine.prototype.canHandle = function canHandle(event, eventPayload) {\n    var stateMachines = this.getStateMachines();\n    for (var i = stateMachines.length - 1; i >= 0; i--) {\n      if (stateMachines[i].canHandle(event, eventPayload)) {\n        return true;\n      }\n    }\n    return false;\n  };\n\n  HierarchicalStateMachine.prototype.handle = function handle(event, eventPayload) {\n    var _this = this;\n\n    this.taskScheduler.enqueue(function () {\n      var stateMachines = _this.getStateMachines();\n      for (var i = stateMachines.length - 1; i >= 0; i--) {\n        if (stateMachines[i].tryHandle(event, eventPayload)) {\n          return;\n        }\n      }\n      _this.currentStateMachine.handleUnhandledEvent(event, eventPayload);\n    });\n    return this;\n  };\n\n  HierarchicalStateMachine.prototype.getStateMachines = function getStateMachines() {\n    var stateMachines = [];\n    var stateMachine = this.rootStateMachine;\n    do {\n      stateMachines.push(stateMachine);\n      stateMachine = stateMachine.getSubmachine();\n    } while (stateMachine);\n    return stateMachines;\n  };\n\n  HierarchicalStateMachine.prototype.toString = function toString() {\n    return 'StateMachine(currentState: ' + this.getCurrentState() + ')';\n  };\n\n  return HierarchicalStateMachine;\n}();\n\nexports.default = HierarchicalStateMachine;","'use strict';\n\nexports.__esModule = true;\n\nvar _BaseConfigurator2 = require('./BaseConfigurator');\n\nvar _BaseConfigurator3 = _interopRequireDefault(_BaseConfigurator2);\n\nvar _GlobalConfigurator = require('./GlobalConfigurator');\n\nvar _GlobalConfigurator2 = _interopRequireDefault(_GlobalConfigurator);\n\nvar _StateConfigurator = require('./StateConfigurator');\n\nvar _StateConfigurator2 = _interopRequireDefault(_StateConfigurator);\n\nvar _HierarchicalStateMachine = require('../core/HierarchicalStateMachine');\n\nvar _HierarchicalStateMachine2 = _interopRequireDefault(_HierarchicalStateMachine);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar StateMachineConfigurator = function (_BaseConfigurator) {\n  _inherits(StateMachineConfigurator, _BaseConfigurator);\n\n  function StateMachineConfigurator() {\n    _classCallCheck(this, StateMachineConfigurator);\n\n    var _this = _possibleConstructorReturn(this, _BaseConfigurator.call(this));\n\n    _this.config = {\n      global: new _GlobalConfigurator2.default(_this),\n      initialState: null,\n      states: Object.create(null)\n    };\n    return _this;\n  }\n\n  StateMachineConfigurator.prototype.global = function global() {\n    return this.config.global;\n  };\n\n  StateMachineConfigurator.prototype.initialState = function initialState(state) {\n    this.config.initialState = state;\n    return this.state(state);\n  };\n\n  StateMachineConfigurator.prototype.state = function state(_state) {\n    if (!this.config.states[_state]) {\n      this.config.states[_state] = new _StateConfigurator2.default(this);\n    }\n    return this.config.states[_state];\n  };\n\n  StateMachineConfigurator.prototype.getConfig = function getConfig() {\n    return this.buildConfig();\n  };\n\n  StateMachineConfigurator.prototype.start = function start() {\n    var config = this.getConfig();\n    return _HierarchicalStateMachine2.default.start(config);\n  };\n\n  return StateMachineConfigurator;\n}(_BaseConfigurator3.default);\n\nexports.default = StateMachineConfigurator;","\"use strict\";\n\nexports.__esModule = true;\nexports.default = delegateToAncestor;\nfunction delegateToAncestor(constructor, ancestorConstructor) {\n  var prototype = constructor.prototype;\n  var ancestorPrototype = ancestorConstructor.prototype;\n  Object.getOwnPropertyNames(ancestorPrototype).filter(function (name) {\n    return !prototype[name] && ancestorPrototype[name] instanceof Function && ancestorPrototype[name] !== ancestorConstructor;\n  }).forEach(function (name) {\n    // eslint-disable-next-line func-names\n    prototype[name] = function () {\n      var method = ancestorPrototype[name];\n\n      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      return method.apply(this.getAncestor(ancestorConstructor), args);\n    };\n  });\n}","'use strict';\n\nexports.__esModule = true;\nexports.StateMachineConfigurator = undefined;\n\nvar _StateMachineConfigurator = require('./StateMachineConfigurator');\n\nvar _StateMachineConfigurator2 = _interopRequireDefault(_StateMachineConfigurator);\n\nvar _GlobalConfigurator = require('./GlobalConfigurator');\n\nvar _GlobalConfigurator2 = _interopRequireDefault(_GlobalConfigurator);\n\nvar _StateConfigurator = require('./StateConfigurator');\n\nvar _StateConfigurator2 = _interopRequireDefault(_StateConfigurator);\n\nvar _TriggerConfigurator = require('./TriggerConfigurator');\n\nvar _TriggerConfigurator2 = _interopRequireDefault(_TriggerConfigurator);\n\nvar _TransitionConfigurator = require('./TransitionConfigurator');\n\nvar _TransitionConfigurator2 = _interopRequireDefault(_TransitionConfigurator);\n\nvar _AsyncActionConfigurator = require('./AsyncActionConfigurator');\n\nvar _AsyncActionConfigurator2 = _interopRequireDefault(_AsyncActionConfigurator);\n\nvar _delegateToAncestor = require('./delegateToAncestor');\n\nvar _delegateToAncestor2 = _interopRequireDefault(_delegateToAncestor);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nexports.StateMachineConfigurator = _StateMachineConfigurator2.default; /* eslint-disable import/prefer-default-export */\n\n(0, _delegateToAncestor2.default)(_GlobalConfigurator2.default, _StateMachineConfigurator2.default);\n(0, _delegateToAncestor2.default)(_StateConfigurator2.default, _StateMachineConfigurator2.default);\n(0, _delegateToAncestor2.default)(_TransitionConfigurator2.default, _StateConfigurator2.default);\n(0, _delegateToAncestor2.default)(_TransitionConfigurator2.default, _TriggerConfigurator2.default);\n(0, _delegateToAncestor2.default)(_TransitionConfigurator2.default, _AsyncActionConfigurator2.default);","'use strict';\n\nexports.__esModule = true;\n\nvar _configuration = require('./configuration');\n\nvar _HierarchicalStateMachine = require('./core/HierarchicalStateMachine');\n\nvar _HierarchicalStateMachine2 = _interopRequireDefault(_HierarchicalStateMachine);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar Finity = {\n  configure: function configure() {\n    return new _configuration.StateMachineConfigurator();\n  },\n  start: function start(config) {\n    return _HierarchicalStateMachine2.default.start(config);\n  }\n};\n\nexports.default = Finity;","/* eslint-disable */\n'use strict';\n\nvar Finity = require('./Finity').default;\nvar merge = require('./utils/merge').default;\n\nmerge(exports, Finity);\n\n// Allow the use of the default import syntax in TypeScript (import Finity from 'finity')\nexports.default = Finity;\n","import { writable, get } from 'svelte/store';\nimport { MODULE_ID } from '~/src/helpers/constants';\nimport { readOnlyTabs, tabs, activeTab, levelUpTabs } from '~/src/stores/index';\nimport { actorInGame } from '~/src/stores/storeDefinitions';\nimport { destroyAdvancementManagers } from '~/src/helpers/AdvancementManager';\nimport { dropItemRegistry } from '~/src/stores/index';\n// Import PrivateSettingKeys from the TypeScript file\nconst PrivateSettingKeys = {\n  LAST_MIGRATION: 'lastMigration',\n  LEVEL_UP_IN_PROGRESS: 'levelUpInProgress',\n};\nimport Finity from 'finity';\n\n// Helper to safely get fromUuidSync\nconst fromUuidSync = (uuid) => {\n  try {\n    return foundry.utils?.fromUuidSync?.(uuid) || null;\n  } catch (error) {\n    window.GAS.log.w('[LEVELUP] Error in fromUuidSync:', error);\n    return null;\n  }\n};\n\n// Helper to suppress Tidy5e auto-reopen during level up\nconst suppressTidy5eAutoReopen = (suppress = true) => {\n  try {\n    const tidy5eModule = game.modules.get(\"tidy5e-sheet\");\n    if (tidy5eModule?.active) {\n      // Set level up in progress flag\n      game.settings.set(MODULE_ID, PrivateSettingKeys.LEVEL_UP_IN_PROGRESS, suppress);\n      \n      if (suppress) {\n        window.GAS.log.d('[LEVELUP] Suppressing Tidy5e auto-reopen during level up');\n        // Only suppress if we have a valid API method\n        if (tidy5eModule.api?.setAutoReopen) {\n          tidy5eModule.api.setAutoReopen(false);\n        }\n      } else {\n        window.GAS.log.d('[LEVELUP] Restoring Tidy5e auto-reopen after level up');\n        // Only restore if we have a valid API method\n        if (tidy5eModule.api?.setAutoReopen) {\n          tidy5eModule.api.setAutoReopen(true);\n        }\n      }\n    } else {\n      // Even if Tidy5e is not active, set the flag for the hook\n      game.settings.set(MODULE_ID, PrivateSettingKeys.LEVEL_UP_IN_PROGRESS, suppress);\n    }\n  } catch (error) {\n    window.GAS.log.w('[LEVELUP] Error managing Tidy5e auto-reopen:', error);\n    // Still set the flag even if there's an error\n    try {\n      game.settings.set(MODULE_ID, PrivateSettingKeys.LEVEL_UP_IN_PROGRESS, suppress);\n    } catch (e) {\n      window.GAS.log.w('[LEVELUP] Error setting level up flag:', e);\n    }\n  }\n};\n\n/**\n * LevelUp workflow states\n */\nexport const LEVELUP_STATES = {\n  IDLE: 'idle',\n  SELECTING_CLASS_LEVEL: 'selecting_class_level',\n  PROCESSING_ADVANCEMENTS: 'processing_advancements',\n  SELECTING_SPELLS: 'selecting_spells',\n  COMPLETED: 'completed',\n  ERROR: 'error'\n};\n\n/**\n * LevelUp workflow events\n */\nexport const LEVELUP_EVENTS = {\n  START_LEVEL_UP: 'start_level_up',\n  CLASS_LEVEL_SELECTED: 'class_level_selected',\n  ADVANCEMENTS_COMPLETE: 'advancements_complete',\n  SPELLS_COMPLETE: 'spells_complete',\n  SKIP_SPELLS: 'skip_spells',\n  ERROR: 'error',\n  RESET: 'reset'\n};\n\n/**\n * Determines the correct spell list class for a character, handling subclasses\n * @param {Actor} actor - The actor to analyze\n * @returns {string|string[]|null} - The class name(s) to use for spell filtering, or null if no spellcasting\n *                                    Can return a string for single list or array for multiple lists (custom classes)\n */\nfunction determineSpellListClass(actor) {\n  if (!actor) return null;\n  \n  const actorData = actor.system || actor.data?.data;\n  if (!actorData) return null;\n  \n  window.GAS.log.d('[LEVELUP] determineSpellListClass called for actor:', actor.name);\n  \n  // ============================================================================\n  // Method 0: Check for CUSTOM spell lists advancement flag\n  // This is ONLY for custom/homebrew classes that have been explicitly configured\n  // Standard D&D classes will NOT have this flag and will use existing logic below\n  // ============================================================================\n  const droppedItems = actor.getFlag(MODULE_ID, 'droppedItems');\n  \n  if (droppedItems) {\n    // Check subclass first (subclass spell lists override class spell lists)\n    let subclassItems = [];\n    if (Array.isArray(droppedItems)) {\n      subclassItems = droppedItems.filter(item => item.type === 'subclass');\n    } else if (typeof droppedItems === 'object' && droppedItems.subclass) {\n      subclassItems = Array.isArray(droppedItems.subclass) ? droppedItems.subclass : [droppedItems.subclass];\n    }\n    \n    for (const item of subclassItems) {\n      const subclassUuid = item.uuid;\n      if (subclassUuid) {\n        try {\n          const subclassItem = fromUuidSync(subclassUuid);\n          if (subclassItem) {\n            const customSpellLists = subclassItem.getFlag(MODULE_ID, 'spellLists');\n            if (customSpellLists && Array.isArray(customSpellLists) && customSpellLists.length > 0) {\n              window.GAS.log.d('[LEVELUP] Found CUSTOM spell lists flag on subclass:', subclassItem.name, '->', customSpellLists);\n              return customSpellLists; // Return array of spell lists for custom subclasses\n            }\n          }\n        } catch (error) {\n          window.GAS.log.w('[LEVELUP] Error checking custom spell lists on subclass:', error);\n        }\n      }\n    }\n    \n    // Check class\n    let classItems = [];\n    if (Array.isArray(droppedItems)) {\n      classItems = droppedItems.filter(item => item.type === 'class');\n    } else if (typeof droppedItems === 'object' && droppedItems.class) {\n      classItems = Array.isArray(droppedItems.class) ? droppedItems.class : [droppedItems.class];\n    }\n    \n    for (const item of classItems) {\n      const classUuid = item.uuid;\n      if (classUuid) {\n        try {\n          const classItem = fromUuidSync(classUuid);\n          if (classItem) {\n            const customSpellLists = classItem.getFlag(MODULE_ID, 'spellLists');\n            if (customSpellLists && Array.isArray(customSpellLists) && customSpellLists.length > 0) {\n              window.GAS.log.d('[LEVELUP] Found CUSTOM spell lists flag on class:', classItem.name, '->', customSpellLists);\n              return customSpellLists; // Return array of spell lists for custom classes\n            }\n          }\n        } catch (error) {\n          window.GAS.log.w('[LEVELUP] Error checking custom spell lists on class:', error);\n        }\n      }\n    }\n  }\n  \n  // ============================================================================\n  // EXISTING LOGIC FOR STANDARD D&D CLASSES - UNCHANGED\n  // Method 1: Check for subclass spellcasting via module flags (dropped items)\n  // ============================================================================\n  window.GAS.log.d('[LEVELUP] droppedItems flag:', droppedItems, 'isArray:', Array.isArray(droppedItems));\n  window.GAS.log.d('[LEVELUP] droppedItems flag:', droppedItems, 'isArray:', Array.isArray(droppedItems));\n  \n  // Handle both array and object formats\n  let subclassItems = [];\n  if (Array.isArray(droppedItems)) {\n    subclassItems = droppedItems.filter(item => item.type === 'subclass');\n  } else if (droppedItems && typeof droppedItems === 'object' && droppedItems.subclass) {\n    subclassItems = Array.isArray(droppedItems.subclass) ? droppedItems.subclass : [droppedItems.subclass];\n  }\n  \n  for (const item of subclassItems) {\n    const subclassUuid = item.uuid;\n    if (subclassUuid) {\n      try {\n        // Try to get the subclass item to parse its description\n        const subclassItem = fromUuidSync(subclassUuid);\n        if (subclassItem) {\n          const spellListClass = parseSpellcastingFromDescription(subclassItem);\n          if (spellListClass) {\n            window.GAS.log.d('[LEVELUP] Found subclass spellcasting via droppedItems:', subclassItem.name, '->', spellListClass);\n            return spellListClass;\n          }\n        }\n      } catch (error) {\n        window.GAS.log.w('[LEVELUP] Error parsing subclass from droppedItems:', error);\n      }\n    }\n  }\n  \n  // Method 2: Check for subclass items on the actor\n  const actorItems = actor.items || [];\n  window.GAS.log.d('[LEVELUP] Checking actor items:', actorItems.map(i => ({ name: i.name, type: i.type })));\n  for (const item of actorItems) {\n    if (item.type === 'subclass') {\n      window.GAS.log.d('[LEVELUP] Found subclass item:', item.name, 'identifier:', item.system?.identifier);\n      const spellListClass = parseSpellcastingFromDescription(item);\n      if (spellListClass) {\n        window.GAS.log.d('[LEVELUP] Found subclass spellcasting via actor items:', item.name, '->', spellListClass);\n        return spellListClass;\n      }\n      \n      // Also check by identifier for known subclasses\n      const identifier = item.system?.identifier?.toLowerCase();\n      if (identifier === 'eldritch-knight' || identifier === 'eldritchknight') {\n        window.GAS.log.d('[LEVELUP] Found Eldritch Knight by identifier -> Wizard');\n        return 'Wizard';\n      } else if (identifier === 'arcane-trickster' || identifier === 'arcanetrickster') {\n        window.GAS.log.d('[LEVELUP] Found Arcane Trickster by identifier -> Wizard');\n        return 'Wizard';\n      } else if (identifier === 'aberrant-mind' || identifier === 'aberrantmind') {\n        window.GAS.log.d('[LEVELUP] Found Aberrant Mind by identifier -> Sorcerer');\n        return 'Sorcerer';\n      }\n    }\n  }\n  \n  // Method 3: Check for subclass in class data\n  const classes = actorData.classes || {};\n  window.GAS.log.d('[LEVELUP] actor classes:', Object.keys(classes));\n  window.GAS.log.d('[LEVELUP] actorData structure:', {\n    classes: classes,\n    hasClasses: !!classes,\n    classesKeys: Object.keys(classes),\n    actorItems: actor.items?.map(i => ({ name: i.name, type: i.type })) || []\n  });\n  \n  for (const [className, classData] of Object.entries(classes)) {\n    const subclass = classData?.system?.subclass;\n    window.GAS.log.d('[LEVELUP] class', className, 'subclass:', subclass);\n    if (subclass) {\n      // Check if this is a known spellcasting subclass\n      const subclassLower = subclass.toLowerCase();\n      if (['eldritchknight', 'arcanetrickster', 'aberrantmind'].includes(subclassLower)) {\n        // These subclasses use specific spell lists\n        if (subclassLower === 'eldritchknight' || subclassLower === 'arcanetrickster') {\n          window.GAS.log.d('[LEVELUP] Found subclass in class data:', subclass, '-> Wizard');\n          return 'Wizard';\n        } else if (subclassLower === 'aberrantmind') {\n          window.GAS.log.d('[LEVELUP] Found subclass in class data:', subclass, '-> Sorcerer');\n          return 'Sorcerer';\n        }\n      }\n    }\n  }\n  \n  // Method 4: Fallback to base class spellcasting\n  const classKeys = Object.keys(classes);\n  if (classKeys.length > 0) {\n    const baseClass = classKeys[0];\n    window.GAS.log.d('[LEVELUP] Using base class for spell list:', baseClass);\n    return baseClass;\n  }\n  \n  window.GAS.log.d('[LEVELUP] No spellcasting class found, returning null');\n  return null;\n}\n\n/**\n * Parses spellcasting feature description to determine spell list class\n * @param {Item} item - The subclass item to analyze\n * @returns {string|null} - The spell list class, or null if not found\n */\nfunction parseSpellcastingFromDescription(item) {\n  if (!item) return null;\n  \n  const description = item.system?.description?.value || item.description?.value || '';\n  if (!description) return null;\n  \n  // Look for patterns like \"Wizard spell list\" in the description\n  const wizardMatch = description.match(/wizard\\s+spell\\s+list/i);\n  if (wizardMatch) {\n    return 'Wizard';\n  }\n  \n  const sorcererMatch = description.match(/sorcerer\\s+spell\\s+list/i);\n  if (sorcererMatch) {\n    return 'Sorcerer';\n  }\n  \n  const bardMatch = description.match(/bard\\s+spell\\s+list/i);\n  if (bardMatch) {\n    return 'Bard';\n  }\n  \n  const clericMatch = description.match(/cleric\\s+spell\\s+list/i);\n  if (clericMatch) {\n    return 'Cleric';\n  }\n  \n  const druidMatch = description.match(/druid\\s+spell\\s+list/i);\n  if (druidMatch) {\n    return 'Druid';\n  }\n  \n  const paladinMatch = description.match(/paladin\\s+spell\\s+list/i);\n  if (paladinMatch) {\n    return 'Paladin';\n  }\n  \n  const rangerMatch = description.match(/ranger\\s+spell\\s+list/i);\n  if (rangerMatch) {\n    return 'Ranger';\n  }\n  \n  const warlockMatch = description.match(/warlock\\s+spell\\s+list/i);\n  if (warlockMatch) {\n    return 'Warlock';\n  }\n  \n  return null;\n}\n\n/**\n * LevelUp workflow context\n */\nexport const levelUpFSMContext = {\n  isProcessing: writable(false),\n  actor: undefined,\n  \n  /**\n   * Determines if spell selection should be shown for level-up\n   */\n  _shouldShowSpellSelection: function (actor) {\n    const enableSpellSelection = game.settings.get(MODULE_ID, 'enableSpellSelection');\n    if (!enableSpellSelection) return false;\n    \n    if (!actor) {\n      // Try to get actor from actorInGame store as fallback\n      const storeActor = get(actorInGame);\n      if (!storeActor) return false;\n      actor = storeActor;\n    }\n    \n    // Check for spellcasting in multiple ways:\n    // 1. Class-based spellcasting (base classes like Wizard, Cleric)\n    // 2. Actor system spellcasting (granted through advancements like Eldritch Knight)\n    // 3. Known spellcasting subclasses (fallback for hardcoded detection)\n    \n    const classes = actor.classes || {};\n    const preSelections = get(levelUpPreAdvancementSelections);\n    let classEntries = Object.entries(classes);\n    \n    if (!classEntries.length && preSelections?.characterClass) {\n      classEntries = [[preSelections.characterClass.system?.identifier || preSelections.characterClass.name || 'selected-class', preSelections.characterClass]];\n    }\n    \n    if (!classEntries.length) {\n      window.GAS.log.d('[LEVELUP] No classes found (actor or pre-selection), returning false for spellcaster check');\n      return false;\n    }\n    \n    const classDataList = classEntries.map(([, classData]) => classData).filter(Boolean);\n    const classNamesLower = classDataList\n      .map((classData) => (classData?.system?.identifier || classData?.name || '').toLowerCase())\n      .filter(Boolean);\n    \n    // Method 1: Check class-based spellcasting progression\n    // This is the PRIMARY check - if any class has spellcasting progression, the actor is a spellcaster\n    const spellcastingInfo = classDataList.map((classData) => {\n      const progression = classData?.system?.spellcasting?.progression;\n      return { \n        className: classData?.name || classData?.system?.identifier || 'unknown-class',\n        identifier: classData?.system?.identifier,\n        progression,\n        isSpellcaster: progression && progression !== \"none\"\n      };\n    });\n    \n    const hasClassSpellcasting = spellcastingInfo.some(info => info.isSpellcaster);\n    \n    // Check if ANY class explicitly has progression: \"none\" - if so, skip actor-level checks entirely\n    const hasExplicitNonSpellcaster = spellcastingInfo.some(info => info.progression === \"none\");\n    \n    // Method 2: Check actor system spellcasting (granted through advancements)\n    // Only check this if:\n    // 1. NO class has spellcasting progression, AND\n    // 2. NO class explicitly has progression: \"none\" (for cases like Eldritch Knight where Fighter has no progression but subclass grants it)\n    const actorData = actor.system || actor.data?.data;\n    \n    let hasActorSpellcasting = false;\n    let hasTraditionalSpellcasting = false;\n    let hasSpellSlots = false;\n    let hasPactMagic = false;\n    \n    // Only check actor-level spellcasting if no class has spellcasting AND no class explicitly says \"none\"\n    // This prevents false positives where non-spellcasters have empty/default spell slot structures\n    if (!hasClassSpellcasting && !hasExplicitNonSpellcaster) {\n      // Check for traditional spellcasting system\n      hasTraditionalSpellcasting = actorData?.spellcasting && Object.keys(actorData.spellcasting).length > 0;\n      \n      // Check for spell slots added by advancements (like Eldritch Knight)\n      hasSpellSlots = actorData?.spells && Object.values(actorData.spells || {}).some(slot => \n        slot && slot.type === 'spell' && slot.max > 0\n      );\n      \n      // Check for pact magic slots (only count if they have max > 0 and actor has Warlock class)\n      // DEBUG: Log what we're actually checking\n      window.GAS.log.d('[LEVELUP] Checking for pact magic:', {\n        hasSpells: !!actorData?.spells,\n        spellsType: typeof actorData?.spells,\n        spellsValue: actorData?.spells,\n        spellsKeys: actorData?.spells ? Object.keys(actorData.spells) : [],\n        spellsValues: actorData?.spells ? Object.values(actorData.spells) : [],\n        classNamesLower\n      });\n      \n      hasPactMagic = actorData?.spells && \n        typeof actorData.spells === 'object' && \n        Object.values(actorData.spells).some(slot => \n          slot && typeof slot === 'object' && slot.type === 'pact' && slot.max > 0\n        ) && \n        classNamesLower.includes('warlock');\n      \n      hasActorSpellcasting = hasTraditionalSpellcasting || hasSpellSlots || hasPactMagic;\n    }\n    \n    // Method 3: Fallback check for known spellcasting classes/subclasses\n    const knownSpellcastingClasses = [\n      'bard', 'cleric', 'druid', 'paladin', 'ranger', 'sorcerer', 'warlock', 'wizard',\n      'artificer', 'aberrantmind', 'arcanetrickster', 'eldritchknight'\n    ];\n    const hasKnownSpellcastingClass = classNamesLower.some(className => \n      knownSpellcastingClasses.includes(className)\n    );\n    \n    // Method 4: Check for subclass spellcasting that might be granted through advancements\n    // This is a more aggressive check for cases where the actor system hasn't been updated yet\n    const hasSubclassSpellcasting = classNamesLower.some(lowerClassName => {\n      // Check for known spellcasting subclasses\n      return ['eldritchknight', 'arcanetrickster', 'aberrantmind'].includes(lowerClassName);\n    });\n    \n    // Method 5: Check for subclass in the class data itself (e.g., fighter with eldritchknight subclass)\n    const hasSubclassInClassData = classDataList.some(classData => {\n      const subclass = classData?.system?.subclass;\n      return subclass && ['eldritchknight', 'arcanetrickster', 'aberrantmind'].includes(subclass.toLowerCase());\n    });\n    \n    const isSpellcaster = hasClassSpellcasting || hasActorSpellcasting || hasKnownSpellcastingClass || hasSubclassSpellcasting || hasSubclassInClassData;\n    \n    window.GAS.log.d('[LEVELUP] Spellcasting detection:', {\n      spellcastingInfo,\n      classNamesLower,\n      hasClassSpellcasting,\n      hasExplicitNonSpellcaster,\n      hasTraditionalSpellcasting,\n      hasSpellSlots,\n      hasPactMagic,\n      hasActorSpellcasting,\n      hasKnownSpellcastingClass,\n      hasSubclassSpellcasting,\n      hasSubclassInClassData,\n      isSpellcaster,\n      actorName: actor.name,\n      actorSpellcasting: actorData?.spellcasting,\n      actorSpells: actorData?.spells,\n      actorSpellcastingKeys: actorData?.spellcasting ? Object.keys(actorData.spellcasting) : [],\n      classSpellcastingInfo: spellcastingInfo\n    });\n    \n    return isSpellcaster;\n  }\n};\n\n/**\n * Creates the LevelUp-specific Finity state machine\n */\nexport function createLevelUpStateMachine() {\n  const fsm = Finity\n    .configure()\n    .initialState('idle')\n    \n    // IDLE STATE\n    .state('idle')\n      .on('start_level_up').transitionTo('selecting_class_level')\n      .on('reset').transitionTo('idle')\n      .on('error').transitionTo('idle')\n      .onEnter((context) => {\n        if (levelUpFSMContext.isProcessing) levelUpFSMContext.isProcessing.set(false);\n        \n        // Destroy advancement managers when returning to idle\n        try {\n          destroyAdvancementManagers();\n        } catch (error) {\n          window.GAS.log.e('[LEVELUP] Error destroying advancement managers on idle:', error);\n        }\n        \n        // Restore Tidy5e auto-reopen when returning to idle\n        suppressTidy5eAutoReopen(false);\n      })\n    \n    // SELECTING CLASS/LEVEL STATE\n    .state('selecting_class_level')\n      .on('class_level_selected').transitionTo('processing_advancements')\n      .on('error').transitionTo('error')\n      .on('reset').transitionTo('idle')\n      .onEnter((context) => {\n        if (levelUpFSMContext.isProcessing) levelUpFSMContext.isProcessing.set(false);\n        window.GAS.log.d('[LEVELUP] Entered SELECTING_CLASS_LEVEL state');\n        \n        // Suppress Tidy5e auto-reopen during level up\n        suppressTidy5eAutoReopen(true);\n        \n        // Ensure we're on the level-up tab\n        activeTab.set('level-up');\n      })\n    \n    // PROCESSING ADVANCEMENTS STATE\n    .state('processing_advancements')\n      .do(async (state, context) => {\n        if (levelUpFSMContext.isProcessing) levelUpFSMContext.isProcessing.set(true);\n        window.GAS.log.d('[LEVELUP] Entered PROCESSING_ADVANCEMENTS state');\n        \n        // Process advancement queue asynchronously\n        await dropItemRegistry.advanceQueue(true);\n        \n        // Add a longer delay to ensure actor is fully updated after advancements\n        // Advancements might update the actor's spellcasting system asynchronously\n        await new Promise(resolve => setTimeout(resolve, 500));\n        \n        window.GAS.log.d('[LEVELUP] Advancement queue completed, checking for spellcasting...');\n      })\n        .onSuccess()\n          .transitionTo('selecting_spells').withCondition((context) => {\n            const actor = levelUpFSMContext.actor || get(actorInGame);\n            const shouldShow = levelUpFSMContext._shouldShowSpellSelection(actor);\n            window.GAS.log.d('[LEVELUP] advancements_complete -> selecting_spells condition:', shouldShow);\n            window.GAS.log.d('[LEVELUP] Actor spellcasting data:', {\n              actorName: actor?.name,\n              classes: Object.keys(actor?.classes || {}),\n              actorSpellcasting: actor?.system?.spellcasting,\n              actorSpells: actor?.system?.spells,\n              hasActorSpellcasting: actor?.system?.spellcasting && Object.keys(actor.system.spellcasting).length > 0,\n              hasSpellSlots: actor?.system?.spells && Object.values(actor.system.spells).some(slot => \n                slot.type === 'spell' && slot.max > 0\n              )\n            });\n            return shouldShow;\n          })\n          .transitionTo('completed') // Default fallback - no spell selection needed\n        .onFailure().transitionTo('error')\n      .on('reset').transitionTo('idle')\n      .on('error').transitionTo('error')\n    \n    // SELECTING SPELLS STATE\n    .state('selecting_spells')\n      .on('spells_complete').transitionTo('completed')\n      .on('skip_spells').transitionTo('completed')\n      .on('error').transitionTo('error')\n      .on('reset').transitionTo('idle')\n      .onEnter((context) => {\n        if (levelUpFSMContext.isProcessing) levelUpFSMContext.isProcessing.set(false);\n        window.GAS.log.d('[LEVELUP] Entered SELECTING_SPELLS state');\n        \n        // Always destroy advancement managers to prevent them from persisting\n        try {\n          destroyAdvancementManagers();\n          window.GAS.log.d('[LEVELUP] Destroyed advancement managers before spell selection');\n        } catch (error) {\n          window.GAS.log.e('[LEVELUP] Error destroying advancement managers:', error);\n        }\n\n        // Freeze the Level Up tab to prevent further changes after advancements\n        try {\n          const currentReadOnly = get(readOnlyTabs) || [];\n          if (!currentReadOnly.includes('level-up')) {\n            readOnlyTabs.update(t => [...t, 'level-up']);\n            window.GAS.log.d('[LEVELUP] Marked level-up tab as read-only');\n          }\n        } catch (e) {\n          window.GAS.log.w('[LEVELUP] Unable to set level-up tab read-only:', e);\n        }\n        \n        // Initialize spell selection for the level-up actor\n        const actor = levelUpFSMContext.actor || get(actorInGame);\n        if (actor) {\n          try {\n            // Import spell selection functions\n            import('~/src/stores/spellSelection').then(({ initializeSpellSelection, loadAvailableSpells }) => {\n              window.GAS.log.d('[LEVELUP] Initializing spell selection for actor:', actor.name);\n              initializeSpellSelection(actor);\n              \n              // Determine the correct spell list for this character\n              const spellListClass = determineSpellListClass(actor);\n              if (spellListClass) {\n                loadAvailableSpells(spellListClass);\n                window.GAS.log.d('[LEVELUP] Loading spells for spell list class:', spellListClass);\n              }\n            });\n          } catch (error) {\n            window.GAS.log.e('[LEVELUP] Error initializing spell selection:', error);\n          }\n        }\n        \n        // Double-check that actor is actually a spellcaster before adding spell tab\n        const isSpellcaster = levelUpFSMContext._shouldShowSpellSelection(actor);\n        window.GAS.log.d('[LEVELUP] Verifying spellcaster status in onEnter:', { isSpellcaster, actorName: actor?.name });\n        \n        if (isSpellcaster) {\n          // Force remove advancement tab and add spells tab\n          levelUpTabs.update(t => {\n            window.GAS.log.d('[LEVELUP] Current levelUpTabs before filtering:', t);\n            \n            // Remove advancement tab if present\n            const filteredTabs = t.filter(tab => {\n              const shouldKeep = tab.id !== \"advancements\";\n              if (!shouldKeep) {\n                window.GAS.log.d('[LEVELUP] Removing advancement tab:', tab);\n              }\n              return shouldKeep;\n            });\n            \n            // Add spells tab if not present\n            if (!filteredTabs.find(tab => tab.id === \"spells\")) {\n              const spellsTab = { label: \"Spells\", id: \"spells\", component: \"Spells\" };\n              filteredTabs.push(spellsTab);\n              window.GAS.log.d('[LEVELUP] Added spells tab:', spellsTab);\n            }\n            \n            window.GAS.log.d('[LEVELUP] Final levelUpTabs after filtering:', filteredTabs);\n            return filteredTabs;\n          });\n          activeTab.set(\"spells\");\n          window.GAS.log.d('[LEVELUP] Set active tab to spells');\n        } else {\n          window.GAS.log.w('[LEVELUP] Actor is not a spellcaster but entered selecting_spells state - transitioning to completed');\n          // If we somehow entered this state for a non-spellcaster, immediately skip to completed\n          const levelUpFSM = getLevelUpFSM();\n          levelUpFSM.handle(LEVELUP_EVENTS.SKIP_SPELLS);\n        }\n      })\n    \n    // COMPLETED STATE\n    .state('completed')\n      .on('reset').transitionTo('idle')\n      .onEnter((context) => {\n        if (levelUpFSMContext.isProcessing) levelUpFSMContext.isProcessing.set(false);\n        window.GAS.log.d('[LEVELUP] Entered COMPLETED state');\n        \n        // Destroy advancement managers\n        try {\n          destroyAdvancementManagers();\n        } catch (error) {\n          window.GAS.log.e('[LEVELUP] Error destroying advancement managers on completed:', error);\n        }\n        \n        // Restore Tidy5e auto-reopen before opening actor sheet\n        suppressTidy5eAutoReopen(false);\n        \n        const actor = levelUpFSMContext.actor || get(actorInGame);\n        if (actor) {\n          window.GAS.log.d('[LEVELUP] Opening actor sheet for:', actor.name);\n          actor.sheet.render(true);\n        }\n        \n        setTimeout(() => {\n          window.GAS.log.d('[LEVELUP] Closing Actor Studio');\n          Hooks.call(\"gas.close\");\n        }, 1500);\n      })\n    \n    // ERROR STATE\n    .state('error')\n      .on('reset').transitionTo('idle')\n      .onEnter((context) => {\n        if (levelUpFSMContext.isProcessing) levelUpFSMContext.isProcessing.set(false);\n        window.GAS.log.e('[LEVELUP] Entered ERROR state:', context.error);\n        if (context.error) ui.notifications.error(context.error);\n      })\n    \n    .start();\n  \n  return fsm;\n}\n\n// Provide a getter for the singleton LevelUp FSM instance\nlet levelUpFSM;\nexport function getLevelUpFSM() {\n  if (!levelUpFSM) {\n    levelUpFSM = createLevelUpStateMachine();\n    // Expose the FSM on window.GAS for debugging\n    if (typeof window !== 'undefined') {\n      window.GAS = window.GAS || {};\n      window.GAS.levelUpFSM = levelUpFSM;\n      console.log('window.GAS.levelUpFSM assigned:', window.GAS.levelUpFSM);\n    }\n  }\n  return levelUpFSM;\n}\n\nexport default {\n  createLevelUpStateMachine,\n  getLevelUpFSM,\n  levelUpFSMContext,\n  LEVELUP_STATES,\n  LEVELUP_EVENTS\n};\n\n// Export the helper functions for use in other components\nexport { determineSpellListClass, parseSpellcastingFromDescription };\n","import { writable, derived, get } from 'svelte/store';\nimport { MODULE_ID } from '~/src/helpers/constants';\nimport { getPacksFromSettings, extractItemsFromPacksAsync } from '~/src/helpers/Utility';\nimport { readOnlyTabs, characterClass, isLevelUp, newLevelValueForExistingClass } from '~/src/stores/index';\nimport { determineSpellListClass, parseSpellcastingFromDescription } from '~/src/helpers/LevelUpStateMachine';\n\n// Import spellsKnown data for determining spell limits\nimport spellsKnownData from './spellsKnown.json';\n\n// Safe logging shim to avoid test failures when certain log methods (g/p) are missing\nif (typeof window !== 'undefined') {\n  window.GAS = window.GAS || {};\n  window.GAS.log = window.GAS.log || {};\n  const l = window.GAS.log;\n  // Preserve existing spies if present\n  l.d = l.d || ((...args) => console.debug(...args));\n  l.w = l.w || ((...args) => console.warn(...args));\n  l.e = l.e || ((...args) => console.error(...args));\n  // General / pretty fallbacks map to debug by default\n  l.g = l.g || l.d;\n  l.p = l.p || l.d;\n}\n\n// Helper: produce a small, safe summary of a `_lazy.classes` object to avoid\n// printing large prototypes or causing getters to run. Returns null when empty.\nfunction safeInspectLazyClasses(lazy) {\n  try {\n    if (!lazy || typeof lazy !== 'object') return null;\n    const keys = Object.keys(lazy || {}).slice(0, 10);\n    const samples = keys.map(k => {\n      const v = lazy[k];\n      const type = v?.type || v?.constructor?.name || null;\n      const id = v?.system?.identifier || v?.system?.id || v?._id || v?.uuid || null;\n      const name = v?.name || v?.system?.name || null;\n      return { key: k, type, id, name };\n    });\n    return { count: Object.keys(lazy).length, keys, samples };\n  } catch (e) {\n    return { error: String(e) };\n  }\n}\n\n// Helper: summarize class information found on a spell document (labels, system, _lazy)\nfunction inspectSpellClasses(doc) {\n  try {\n    const labels = doc.labels?.classes ?? null;\n    const systemClasses = (() => {\n      const sc = doc.system?.classes;\n      if (!sc) return null;\n      // system.classes may be an object with a `value` string or other shapes\n      if (typeof sc === 'object' && sc.value) return sc.value;\n      return sc;\n    })();\n    const lazySummary = safeInspectLazyClasses(doc._lazy?.classes || null);\n    const lazyKeys = doc._lazy?.classes ? Object.keys(doc._lazy.classes).slice(0, 10) : [];\n    return { labels, systemClasses, lazySummary, lazyKeys };\n  } catch (e) {\n    return { error: String(e) };\n  }\n}\n\n// Store for managing the state of spell selection\n\n// List of spells available for selection, fetched from selected compendiums\nexport const availableSpells = writable([]);\n\n// Spells currently selected (Map<spellId, { itemData }>)\nexport const selectedSpells = writable(new Map());\n\n// Current character for spellcasting detection\nexport const currentCharacter = writable(null);\n\n// Derived store to check if character is a spellcaster\nexport const isSpellcaster = derived(\n  [currentCharacter],\n  ([$currentCharacter]) => {\n    if (!$currentCharacter) return false;\n\n    const actorData = $currentCharacter.system || $currentCharacter.data?.data;\n    if (!actorData) return false;\n\n    // Method 1: Check actor.system.spells (D&D 5e standard structure)\n    if (actorData.spells) {\n      const hasSpellSlots = Object.keys(actorData.spells).some(slotKey => {\n        if (slotKey.startsWith('spell') && actorData.spells[slotKey]) {\n          return actorData.spells[slotKey].max > 0;\n        }\n        return false;\n      });\n      \n      if (hasSpellSlots) {\n        window.GAS.log.d('[SPELLS] isSpellcaster: true (from actor.system.spells)');\n        return true;\n      }\n    }\n\n    // Method 2: Fallback to old spellcasting structure\n    if (actorData.spellcasting && Object.keys(actorData.spellcasting).length > 0) {\n      window.GAS.log.d('[SPELLS] isSpellcaster: true (from actor.system.spellcasting)');\n      return true;\n    }\n\n    window.GAS.log.d('[SPELLS] isSpellcaster: false (no spell slots found)');\n    return false;\n  }\n);\n\n// Derived store to get maximum spell level character can cast\nexport const maxSpellLevel = derived(\n  [currentCharacter, isLevelUp, newLevelValueForExistingClass],\n  ([$currentCharacter, $isLevelUp, $newLevelValueForExistingClass]) => {\n    if (!$currentCharacter) return 0;\n\n    const actorData = $currentCharacter.system || $currentCharacter.data?.data;\n    if (!actorData) return 0;\n\n    // Method 1: Check actor.system.spells (D&D 5e standard structure)\n    if (actorData.spells) {\n      let maxLevel = 0;\n      Object.keys(actorData.spells).forEach(slotKey => {\n        if (slotKey.startsWith('spell') && actorData.spells[slotKey]) {\n          const slotLevel = parseInt(slotKey.replace('spell', ''));\n          const slotData = actorData.spells[slotKey];\n          // Check if this spell level has any available slots\n          if (slotLevel > maxLevel && slotData.max > 0) {\n            maxLevel = slotLevel;\n          }\n        }\n      });\n      \n      if (maxLevel > 0) {\n        window.GAS.log.d('[SPELLS] maxSpellLevel from actor.system.spells:', maxLevel);\n        return maxLevel;\n      }\n    }\n\n    // Method 2: Fallback to old spellcasting structure\n    if (actorData.spellcasting) {\n      let maxLevel = 0;\n      Object.values(actorData.spellcasting).forEach(spellcastingData => {\n        if (spellcastingData.slots) {\n          Object.keys(spellcastingData.slots).forEach(slot => {\n            const slotLevel = parseInt(slot.replace('spell', ''));\n            if (slotLevel > maxLevel && spellcastingData.slots[slot].max > 0) {\n              maxLevel = slotLevel;\n            }\n          });\n        }\n      });\n      \n      if (maxLevel > 0) {\n        window.GAS.log.d('[SPELLS] maxSpellLevel from actor.system.spellcasting:', maxLevel);\n        return maxLevel;\n      }\n    }\n\n    window.GAS.log.d('[SPELLS] maxSpellLevel: No spell slots found, returning 0');\n    return 0;\n  }\n);\n\n// Helper function to get spell limits from subclass advancement data\nfunction getSpellLimitsFromSubclassAdvancement(actor, level) {\n  if (!actor) {\n    window.GAS.log.d('[SPELLS] getSpellLimitsFromSubclassAdvancement: No actor provided');\n    return null;\n  }\n\n  window.GAS.log.d('[SPELLS] getSpellLimitsFromSubclassAdvancement: Starting with actor:', actor.name, 'level:', level);\n\n  // Method 1: Check for subclass spellcasting via module flags (dropped items)\n  const droppedItems = actor.getFlag(MODULE_ID, 'droppedItems');\n  window.GAS.log.d('[SPELLS] getSpellLimitsFromSubclassAdvancement: droppedItems flag:', droppedItems);\n  \n  // Handle both array and object formats\n  let subclassItems = [];\n  if (Array.isArray(droppedItems)) {\n    subclassItems = droppedItems.filter(item => item.type === 'subclass');\n    window.GAS.log.d('[SPELLS] getSpellLimitsFromSubclassAdvancement: Found', subclassItems.length, 'subclass items from array format');\n  } else if (droppedItems && typeof droppedItems === 'object' && droppedItems.subclass) {\n    subclassItems = Array.isArray(droppedItems.subclass) ? droppedItems.subclass : [droppedItems.subclass];\n    window.GAS.log.d('[SPELLS] getSpellLimitsFromSubclassAdvancement: Found', subclassItems.length, 'subclass items from object format');\n  } else {\n    window.GAS.log.d('[SPELLS] getSpellLimitsFromSubclassAdvancement: No subclass items found in droppedItems');\n  }\n  \n  for (const item of subclassItems) {\n    const subclassUuid = item.uuid;\n    window.GAS.log.d('[SPELLS] getSpellLimitsFromSubclassAdvancement: Processing subclass item:', item.name, 'uuid:', subclassUuid);\n    if (subclassUuid) {\n      try {\n        const subclassItem = fromUuidSync(subclassUuid);\n        if (subclassItem) {\n          window.GAS.log.d('[SPELLS] getSpellLimitsFromSubclassAdvancement: Successfully loaded subclass item:', subclassItem.name);\n          window.GAS.log.d('[SPELLS] getSpellLimitsFromSubclassAdvancement: Subclass item structure:', {\n            hasDocument: !!subclassItem.document,\n            hasAdvancement: !!subclassItem.document?.advancement,\n            hasByLevel: !!subclassItem.document?.advancement?.byLevel,\n            byLevelKeys: subclassItem.document?.advancement?.byLevel ? Object.keys(subclassItem.document.advancement.byLevel) : 'none',\n            // Also check direct properties\n            hasDirectAdvancement: !!subclassItem.advancement,\n            hasDirectByLevel: !!subclassItem.advancement?.byLevel,\n            directByLevelKeys: subclassItem.advancement?.byLevel ? Object.keys(subclassItem.advancement.byLevel) : 'none',\n            // Check system properties\n            hasSystemAdvancement: !!subclassItem.system?.advancement,\n            systemAdvancementType: typeof subclassItem.system?.advancement,\n            // Log the full structure for debugging\n            fullStructure: {\n              keys: Object.keys(subclassItem),\n              hasDocument: !!subclassItem.document,\n              documentKeys: subclassItem.document ? Object.keys(subclassItem.document) : 'no document',\n              hasAdvancement: !!subclassItem.advancement,\n              advancementKeys: subclassItem.advancement ? Object.keys(subclassItem.advancement) : 'no advancement',\n              hasSystem: !!subclassItem.system,\n              systemKeys: subclassItem.system ? Object.keys(subclassItem.system) : 'no system'\n            }\n          });\n          const limits = parseSpellLimitsFromAdvancement(subclassItem, level);\n          if (limits) {\n            window.GAS.log.d('[SPELLS] Found spell limits from subclass advancement:', limits);\n            return limits;\n          } else {\n            window.GAS.log.d('[SPELLS] getSpellLimitsFromSubclassAdvancement: parseSpellLimitsFromAdvancement returned null for', subclassItem.name);\n          }\n        } else {\n          window.GAS.log.d('[SPELLS] getSpellLimitsFromSubclassAdvancement: fromUuidSync returned null for uuid:', subclassUuid);\n        }\n      } catch (error) {\n        window.GAS.log.w('[SPELLS] Error parsing subclass advancement:', error);\n      }\n    }\n  }\n  \n  // Method 2: Check for subclass items on the actor\n  const actorItems = actor.items || [];\n  window.GAS.log.d('[SPELLS] getSpellLimitsFromSubclassAdvancement: Checking', actorItems.length, 'actor items for subclass type');\n  for (const item of actorItems) {\n    if (item.type === 'subclass') {\n      window.GAS.log.d('[SPELLS] getSpellLimitsFromSubclassAdvancement: Found subclass item on actor:', item.name);\n      const limits = parseSpellLimitsFromAdvancement(item, level);\n      if (limits) {\n        window.GAS.log.d('[SPELLS] Found spell limits from actor subclass item:', limits);\n        return limits;\n      } else {\n        window.GAS.log.d('[SPELLS] getSpellLimitsFromSubclassAdvancement: parseSpellLimitsFromAdvancement returned null for actor subclass item:', item.name);\n      }\n    }\n  }\n  \n  window.GAS.log.d('[SPELLS] getSpellLimitsFromSubclassAdvancement: No spell limits found, returning null');\n  return null;\n}\n\n// Helper function to parse spell limits from advancement data\nfunction parseSpellLimitsFromAdvancement(subclassItem, level) {\n  if (!subclassItem) {\n    window.GAS.log.d('[SPELLS] parseSpellLimitsFromAdvancement: No subclassItem provided');\n    return null;\n  }\n  \n  window.GAS.log.d('[SPELLS] parseSpellLimitsFromAdvancement: Starting with subclassItem:', subclassItem.name, 'level:', level);\n  \n  // Check if this subclass actually grants spellcasting\n  // Only certain subclasses grant spellcasting (e.g., Eldritch Knight, Arcane Trickster)\n  // Most subclasses (e.g., Hunter Ranger, Champion Fighter) do NOT grant spellcasting\n  const spellcasting = subclassItem.system?.spellcasting;\n  const hasSpellcastingProgression = spellcasting && \n    (spellcasting.progression === 'third' || spellcasting.progression === 'half' || spellcasting.progression === 'full');\n  \n  window.GAS.log.d('[SPELLS] parseSpellLimitsFromAdvancement: Spellcasting check:', {\n    hasSpellcasting: !!spellcasting,\n    progression: spellcasting?.progression,\n    hasSpellcastingProgression\n  });\n  \n  if (!hasSpellcastingProgression) {\n    window.GAS.log.d('[SPELLS] parseSpellLimitsFromAdvancement: Subclass does NOT grant spellcasting, returning null');\n    return null;\n  }\n  \n  // Try multiple possible locations for the advancement data\n  let byLevel = null;\n  let levelAdvancements = null;\n  \n  // Method 1: Check document.advancement.byLevel (new D&D 5e structure)\n  if (subclassItem.document?.advancement?.byLevel) {\n    byLevel = subclassItem.document.advancement.byLevel;\n    levelAdvancements = byLevel[level];\n    window.GAS.log.d('[SPELLS] parseSpellLimitsFromAdvancement: Found advancement in document.advancement.byLevel');\n  }\n  // Method 2: Check direct advancement.byLevel (alternative structure)\n  else if (subclassItem.advancement?.byLevel) {\n    byLevel = subclassItem.advancement.byLevel;\n    levelAdvancements = byLevel[level];\n    window.GAS.log.d('[SPELLS] parseSpellLimitsFromAdvancement: Found advancement in direct advancement.byLevel');\n  }\n  // Method 3: Check system.advancement.byLevel (system structure)\n  else if (subclassItem.system?.advancement?.byLevel) {\n    byLevel = subclassItem.system.advancement.byLevel;\n    levelAdvancements = byLevel[level];\n    window.GAS.log.d('[SPELLS] parseSpellLimitsFromAdvancement: Found advancement in system.advancement.byLevel');\n  }\n  \n  if (byLevel && levelAdvancements !== undefined) {\n    window.GAS.log.d('[SPELLS] parseSpellLimitsFromAdvancement: Found byLevel structure:', {\n      byLevelKeys: Object.keys(byLevel),\n      levelAdvancements: levelAdvancements,\n      isArray: Array.isArray(levelAdvancements)\n    });\n    \n    if (Array.isArray(levelAdvancements)) {\n      let cantrips = 0;\n      let spells = 0;\n      \n      window.GAS.log.d('[SPELLS] parseSpellLimitsFromAdvancement: Processing', levelAdvancements.length, 'advancements for level', level);\n      \n      for (const advancement of levelAdvancements) {\n        window.GAS.log.d('[SPELLS] parseSpellLimitsFromAdvancement: Processing advancement:', {\n          type: advancement.type,\n          title: advancement.title,\n          value: advancement.value,\n          fullAdvancement: JSON.stringify(advancement, null, 2)\n        });\n        \n        if (advancement.type === 'ScaleValue' && advancement.title) {\n          const title = advancement.title.toLowerCase();\n          \n          if (title.includes('cantrip')) {\n            // For cantrips, it's usually a fixed value, not a scale\n            cantrips = parseInt(advancement.value) || 0;\n            window.GAS.log.d('[SPELLS] parseSpellLimitsFromAdvancement: Found cantrips:', cantrips);\n          } else if (title.includes('prepared spell')) {\n            // For prepared spells, it's a scale value array\n            window.GAS.log.d('[SPELLS] parseSpellLimitsFromAdvancement: Found Prepared Spells advancement:', {\n              type: advancement.type,\n              title: advancement.title,\n              value: advancement.value,\n              hasLevels: advancement.levels,\n              levelsType: typeof advancement.levels,\n              levelsIsArray: Array.isArray(advancement.levels),\n              levelsLength: advancement.levels?.length,\n              fullAdvancementStructure: JSON.stringify(advancement, null, 2)\n            });\n            \n            if (advancement.levels && Array.isArray(advancement.levels)) {\n              // The levels array is 0-indexed, so level 3 (first level of spellcasting) is index 0\n              const levelIndex = level - 3; // Eldritch Knight starts at level 3\n              window.GAS.log.d('[SPELLS] parseSpellLimitsFromAdvancement: Prepared spells levels array:', advancement.levels, 'levelIndex:', levelIndex);\n              if (levelIndex >= 0 && levelIndex < advancement.levels.length) {\n                spells = advancement.levels[levelIndex];\n                window.GAS.log.d('[SPELLS] parseSpellLimitsFromAdvancement: Found prepared spells:', spells);\n              } else {\n                window.GAS.log.d('[SPELLS] parseSpellLimitsFromAdvancement: levelIndex out of range:', levelIndex, 'array length:', advancement.levels.length);\n              }\n            } else {\n              window.GAS.log.d('[SPELLS] parseSpellLimitsFromAdvancement: Prepared spells advancement has no levels array:', advancement.levels);\n            }\n          }\n        }\n      }\n      \n      // Fallback for cantrips if not found in advancement data\n      // Eldritch Knight gets 2 cantrips at level 3 according to the description\n      if (cantrips === 0 && level >= 3) {\n        cantrips = 2;\n        window.GAS.log.d('[SPELLS] Using fallback cantrip count for Eldritch Knight:', cantrips);\n      }\n      \n      window.GAS.log.d('[SPELLS] parseSpellLimitsFromAdvancement: Final values:', { cantrips, spells, level });\n      \n      if (cantrips > 0 || spells > 0) {\n        window.GAS.log.d('[SPELLS] Parsed from D&D 5e advancement structure:', { cantrips, spells, level });\n        return { cantrips, spells, hasAllSpells: false };\n      } else {\n        window.GAS.log.d('[SPELLS] parseSpellLimitsFromAdvancement: No valid cantrips or spells found in advancement data');\n      }\n    } else {\n      window.GAS.log.d('[SPELLS] parseSpellLimitsFromAdvancement: levelAdvancements is not an array:', levelAdvancements);\n    }\n  } else {\n    window.GAS.log.d('[SPELLS] parseSpellLimitsFromAdvancement: No advancement.byLevel found in any location');\n  }\n  \n  // Fallback to old advancement table structure\n  if (subclassItem.system?.advancement) {\n    const advancement = subclassItem.system.advancement;\n    if (!Array.isArray(advancement)) {\n      return null;\n    }\n    \n    // Find the advancement entry for the current level\n    const levelAdvancement = advancement.find(adv => adv.level === level);\n    if (!levelAdvancement || !levelAdvancement.entries) {\n      return null;\n    }\n    \n    let cantrips = 0;\n    let spells = 0;\n    \n    // Parse the advancement entries to find cantrips and prepared spells\n    for (const entry of levelAdvancement.entries) {\n      if (entry.type === 'entries' && Array.isArray(entry.entries)) {\n        for (const subEntry of entry.entries) {\n          if (subEntry.type === 'table' && subEntry.rows) {\n            // Parse table rows to find cantrips and prepared spells\n            for (const row of subEntry.rows) {\n              if (Array.isArray(row) && row.length >= 2) {\n                const description = row[0]?.toLowerCase() || '';\n                const value = row[1];\n                \n                if (description.includes('cantrip')) {\n                  cantrips = parseInt(value) || 0;\n                } else if (description.includes('prepared spell') || description.includes('spells prepared')) {\n                  spells = parseInt(value) || 0;\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n    \n    if (cantrips > 0 || spells > 0) {\n      window.GAS.log.d('[SPELLS] Parsed from old advancement table structure:', { cantrips, spells, level });\n      return { cantrips, spells, hasAllSpells: false };\n    }\n  }\n  \n  return null;\n}\n\n// Derived store for spell limits based on character class and level\nexport const spellLimits = derived(\n  [characterClass, isLevelUp, newLevelValueForExistingClass, currentCharacter],\n  ([$characterClass, $isLevelUp, $newLevelValueForExistingClass, $currentCharacter]) => {\n    // Calculate the effective character level for spell selection\n    // For character creation: Always use level 1\n    // For level-up: Use the new level value\n    const effectiveCharacterLevel = $isLevelUp && $newLevelValueForExistingClass\n      ? $newLevelValueForExistingClass\n      : 1; // Character creation is always level 1\n\n    if (!$characterClass || !effectiveCharacterLevel) {\n      return { cantrips: 0, spells: 0 };\n    }\n\n    // Determine the correct spell list class (handles subclasses)\n    const spellListClass = determineSpellListClass($currentCharacter);\n    const className = spellListClass || $characterClass.system?.identifier || $characterClass.name || $characterClass.label || $characterClass;\n    // Normalize className to lowercase to match spellsKnown.json keys\n    const classNameLower = typeof className === 'string' ? className.toLowerCase() : className;\n    const rulesVersion = window.GAS?.dnd5eRules || '2014';\n\n    // First, try to get spell limits from subclass advancement data\n    // For level-up scenarios, we need to calculate the difference between old and new levels\n    window.GAS.log.d(' [spellLimits] CHECKING SUBCLASS ADVANCEMENT:', {\n      isLevelUp: $isLevelUp,\n      effectiveCharacterLevel,\n      newLevelValue: $newLevelValueForExistingClass,\n      hasCharacter: !!$currentCharacter,\n      currentCharacterType: typeof $currentCharacter,\n      currentCharacterKeys: $currentCharacter ? Object.keys($currentCharacter).slice(0, 10) : 'null',\n      currentCharacterName: $currentCharacter?.name || 'no name'\n    });\n\n    const subclassLimits = getSpellLimitsFromSubclassAdvancement($currentCharacter, effectiveCharacterLevel);\n    \n    window.GAS.log.d(' [spellLimits] SUBCLASS LIMITS RESULT:', subclassLimits);\n    \n    if (subclassLimits) {\n      // If this is a level-up, we need to calculate the difference\n      if ($isLevelUp && $newLevelValueForExistingClass) {\n        const oldLevel = $newLevelValueForExistingClass - 1;\n        \n        window.GAS.log.d(' [spellLimits] LEVEL-UP DETECTED, calculating difference:', {\n          oldLevel,\n          newLevel: $newLevelValueForExistingClass\n        });\n        \n        const oldSubclassLimits = getSpellLimitsFromSubclassAdvancement($currentCharacter, oldLevel);\n        \n        window.GAS.log.d(' [spellLimits] OLD LEVEL LIMITS:', oldSubclassLimits);\n        \n        if (oldSubclassLimits) {\n          // Calculate the difference (what's NEW at this level)\n          const cantripDifference = Math.max(0, subclassLimits.cantrips - oldSubclassLimits.cantrips);\n          const spellDifference = Math.max(0, subclassLimits.spells - oldSubclassLimits.spells);\n          \n          const result = {\n            cantrips: cantripDifference,\n            spells: spellDifference,\n            hasAllSpells: subclassLimits.hasAllSpells\n          };\n          \n          window.GAS.log.d(' [spellLimits] USING SUBCLASS ADVANCEMENT (DIFFERENCE):', {\n            oldLevel, \n            newLevel: $newLevelValueForExistingClass,\n            oldLimits: oldSubclassLimits,\n            newLimits: subclassLimits,\n            result\n          });\n          \n          return result;\n        } else {\n          window.GAS.log.w(' [spellLimits] Could not get old level limits, falling through to base class calculation');\n        }\n      } else {\n        // For character creation or if we couldn't get old limits, use the total\n        window.GAS.log.d(' [spellLimits] USING SUBCLASS ADVANCEMENT (TOTAL - character creation):', subclassLimits);\n        return subclassLimits;\n      }\n    } else {\n      window.GAS.log.d(' [spellLimits] No subclass limits found, falling back to BASE CLASS calculation');\n    }\n\n    // Fallback to base class data from spellsKnown.json\n    // For level-up scenarios, calculate the difference between old and new levels\n    if ($isLevelUp && $newLevelValueForExistingClass) {\n      const oldLevel = $newLevelValueForExistingClass - 1; // Current level is new level - 1\n      const newLevel = $newLevelValueForExistingClass;\n\n      window.GAS.log.d(' [spellLimits] BASE CLASS CALCULATION (level-up):', {\n        classNameLower,\n        rulesVersion,\n        oldLevel,\n        newLevel\n      });\n\n      // Get spell data for both levels\n      const oldLevelData = spellsKnownData.levels.find(l => l.level === oldLevel);\n      const newLevelData = spellsKnownData.levels.find(l => l.level === newLevel);\n\n      window.GAS.log.d(' [spellLimits] Level data found:', {\n        hasOldData: !!oldLevelData,\n        hasNewData: !!newLevelData,\n        oldDataHasClass: oldLevelData ? !!oldLevelData[classNameLower] : false,\n        newDataHasClass: newLevelData ? !!newLevelData[classNameLower] : false\n      });\n\n      if (!oldLevelData || !newLevelData || !oldLevelData[classNameLower] || !newLevelData[classNameLower]) {\n        window.GAS.log.w(' [spellLimits] No spell data found for class:', classNameLower, 'at levels:', oldLevel, newLevel);\n        return { cantrips: 0, spells: 0 };\n      }\n\n      // Get version-specific data\n      const oldClassData = oldLevelData[classNameLower][rulesVersion] || oldLevelData[classNameLower];\n      const newClassData = newLevelData[classNameLower][rulesVersion] || newLevelData[classNameLower];\n\n      window.GAS.log.d(' [spellLimits] Raw class data:', {\n        oldClassData,\n        newClassData\n      });\n\n      // Parse old level limits\n      const [oldCantrips, oldSpells] = oldClassData.split(' / ');\n      const oldCantripCount = parseInt(oldCantrips) || 0;\n      const oldSpellCount = parseInt(oldSpells) || 0;\n      const oldHasAllSpells = oldSpells === 'All';\n\n      // Parse new level limits\n      const [newCantrips, newSpells] = newClassData.split(' / ');\n      const newCantripCount = parseInt(newCantrips) || 0;\n      const newSpellCount = parseInt(newSpells) || 0;\n      const newHasAllSpells = newSpells === 'All';\n\n      window.GAS.log.d(' [spellLimits] Parsed values:', {\n        oldParsed: { cantrips: oldCantripCount, spells: oldSpellCount, hasAll: oldHasAllSpells },\n        newParsed: { cantrips: newCantripCount, spells: newSpellCount, hasAll: newHasAllSpells }\n      });\n\n      // Calculate the difference (new spells gained on level up)\n      const cantripDifference = Math.max(0, newCantripCount - oldCantripCount);\n      const spellDifference = oldHasAllSpells || newHasAllSpells ? 0 : Math.max(0, newSpellCount - oldSpellCount);\n\n      const result = {\n        cantrips: cantripDifference,\n        spells: spellDifference,\n        hasAllSpells: newHasAllSpells\n      };\n\n      window.GAS.log.d(' [spellLimits] BASE CLASS CALCULATION RESULT (level-up difference):', {\n        oldLevel, \n        newLevel, \n        className: classNameLower,\n        oldValues: { cantrips: oldCantripCount, spells: oldSpellCount },\n        newValues: { cantrips: newCantripCount, spells: newSpellCount },\n        result\n      });\n\n      return result;\n    } else {\n      // Character creation scenario - use total spells for level 1\n      const levelData = spellsKnownData.levels.find(l => l.level === 1);\n      if (!levelData || !levelData[classNameLower]) {\n        window.GAS.log.w('[SPELLS] No spell data found for class:', classNameLower, 'at level 1');\n        return { cantrips: 0, spells: 0 };\n      }\n\n      // Get version-specific data\n      const classData = levelData[classNameLower][rulesVersion] || levelData[classNameLower];\n\n      const [cantrips, spells] = classData.split(' / ');\n      const result = {\n        cantrips: parseInt(cantrips) || 0,\n        spells: parseInt(spells) || 0,\n        hasAllSpells: spells === 'All'\n      };\n      \n      window.GAS.log.d('[SPELLS] Using base class limits (character creation):', result);\n      return result;\n    }\n  }\n);\n\n// Derived store for current spell counts\nexport const currentSpellCounts = derived(\n  [selectedSpells],\n  ([$selectedSpells]) => {\n    const selectedSpellsList = Array.from($selectedSpells.values());\n    const currentCantrips = selectedSpellsList.filter(s => (s.itemData.system?.level || 0) === 0).length;\n    const currentSpells = selectedSpellsList.filter(s => (s.itemData.system?.level || 0) > 0).length;\n\n    return {\n      cantrips: currentCantrips,\n      spells: currentSpells,\n      total: currentCantrips + currentSpells\n    };\n  }\n);\n\n// Derived store for spell selection progress\nexport const spellProgress = derived(\n  [spellLimits, currentSpellCounts, isLevelUp, characterClass, newLevelValueForExistingClass],\n  ([$spellLimits, $currentSpellCounts, $isLevelUp, $characterClass, $newLevelValueForExistingClass]) => {\n    // For classes that get \"All\" spells, only cantrips are required choices\n    const hasAllSpells = $spellLimits.hasAllSpells;\n\n    let totalRequired, totalSelected, progressPercentage, isComplete;\n\n    // Special case: Level-up with no spell level increases for \"All spells\" classes\n    if ($isLevelUp && hasAllSpells && $characterClass && $newLevelValueForExistingClass) {\n      const className = $characterClass.name || $characterClass.label || $characterClass;\n\n      // Calculate max spell levels for old and new levels\n      const getMaxSpellLevelForClass = (level, className, actor = null) => {\n        // Get the current D&D rules version\n        const rulesVersion = window.GAS?.dnd5eRules || '2014';\n        const is2024Rules = rulesVersion === '2024';\n        \n        // If we have an actor, try to determine spellcasting progression from actor's spellcasting system\n        if (actor) {\n          const actorData = actor.system || actor.data?.data;\n          if (actorData?.spellcasting) {\n            // Check if this is subclass spellcasting (like Eldritch Knight)\n            const spellcastingEntries = Object.values(actorData.spellcasting);\n            for (const entry of spellcastingEntries) {\n              if (entry.progression) {\n                // Use the progression from the actor's spellcasting system\n                return getMaxSpellLevelByProgression(level, entry.progression, is2024Rules);\n              }\n            }\n          }\n        }\n        \n        // Fallback to class-based detection\n        return getMaxSpellLevelByClassName(level, className, is2024Rules);\n      };\n\n      // Helper function to calculate max spell level by progression type\n      const getMaxSpellLevelByProgression = (level, progression, is2024Rules) => {\n        switch (progression) {\n          case 'full':\n            return Math.min(9, Math.ceil(level / 2));\n          case 'half':\n            if (is2024Rules) {\n              return Math.min(5, Math.ceil(level / 4));\n            } else {\n              return Math.min(5, Math.ceil((level - 1) / 4));\n            }\n          case 'third':\n            return Math.min(4, Math.ceil((level - 2) / 6));\n          case 'pact':\n            // Warlock progression\n            if (level >= 17) return 5;\n            if (level >= 11) return 3;\n            if (level >= 7) return 2;\n            if (level >= 1) return 1;\n            return 0;\n          default:\n            return 0;\n        }\n      };\n\n      // Helper function to calculate max spell level by class name (fallback)\n      const getMaxSpellLevelByClassName = (level, className, is2024Rules) => {\n        const fullCasters = ['Bard', 'Cleric', 'Druid', 'Sorcerer', 'Wizard'];\n        const halfCasters = ['Paladin', 'Ranger'];\n        const thirdCasters = ['Arcane Trickster', 'Eldritch Knight'];\n        const warlockProgression = ['Warlock'];\n\n        if (fullCasters.includes(className)) {\n          return Math.min(9, Math.ceil(level / 2));\n        } else if (halfCasters.includes(className)) {\n          // Half casters: Different progression for 2014 vs 2024 rules\n          if (is2024Rules) {\n            // 2024 rules: Half casters start spellcasting at level 1\n            return Math.min(5, Math.ceil(level / 4));\n          } else {\n            // 2014 rules: Half casters start spellcasting at level 2\n            return Math.min(5, Math.ceil((level - 1) / 4));\n          }\n        } else if (thirdCasters.includes(className)) {\n          return Math.min(4, Math.ceil((level - 2) / 6));\n        } else if (warlockProgression.includes(className)) {\n          if (level >= 17) return 5;\n          if (level >= 11) return 3;\n          if (level >= 7) return 2;\n          if (level >= 1) return 1;\n          return 0;\n        } else if (className === 'Artificer') {\n          // Artificers: Different progression for 2014 vs 2024 rules\n          if (is2024Rules) {\n            // 2024 rules: Artificers start spellcasting at level 1\n            return Math.min(5, Math.ceil(level / 4));\n          } else {\n            // 2014 rules: Artificers start spellcasting at level 2\n            if (level < 2) return 0;\n            return Math.min(5, Math.ceil((level - 1) / 4));\n          }\n        }\n        return 0;\n      };\n\n      // Get the current character for spellcasting detection\n      const currentActor = get(currentCharacter);\n      const oldMaxSpellLevel = getMaxSpellLevelForClass($newLevelValueForExistingClass - 1, className, currentActor);\n      const newMaxSpellLevel = getMaxSpellLevelForClass($newLevelValueForExistingClass, className, currentActor);\n\n      // If no new spell levels gained AND no new cantrips to select, mark as complete automatically\n      if (newMaxSpellLevel <= oldMaxSpellLevel && $spellLimits.cantrips === 0) {\n        return {\n          totalRequired: 0,\n          totalSelected: 0,\n          progressPercentage: 100,\n          isComplete: true,\n          limits: $spellLimits,\n          counts: $currentSpellCounts,\n          hasAllSpells,\n          noUpdatesNeeded: true\n        };\n      }\n    }\n\n    if (hasAllSpells) {\n      // Classes with all spells: only count cantrips as required for progress\n      // since they automatically get access to all other spells\n      totalRequired = $spellLimits.cantrips;\n      totalSelected = $currentSpellCounts.cantrips;\n\n      if (totalRequired > 0) {\n        progressPercentage = Math.round((totalSelected / totalRequired) * 100);\n        isComplete = totalSelected >= totalRequired;\n      } else {\n        progressPercentage = 100;\n        isComplete = true;\n      }\n    } else {\n      // Regular spellcasters: count both cantrips and spells as required\n      totalRequired = $spellLimits.cantrips + $spellLimits.spells;\n      totalSelected = $currentSpellCounts.total;\n\n      if (totalRequired > 0) {\n        progressPercentage = Math.round((totalSelected / totalRequired) * 100);\n        isComplete = totalSelected >= totalRequired;\n      } else {\n        progressPercentage = 100;\n        isComplete = true;\n      }\n    }\n\n    return {\n      totalRequired,\n      totalSelected,\n      progressPercentage,\n      isComplete,\n      limits: $spellLimits,\n      counts: $currentSpellCounts,\n      hasAllSpells,\n      noUpdatesNeeded: false\n    };\n  }\n);\n\n// Helper to safely get fromUuidSync\nconst fromUuidSync = (uuid) => {\n  try {\n    return foundry.utils?.fromUuidSync?.(uuid) || null;\n  } catch (error) {\n    window.GAS.log.w('[SPELLS] Error in fromUuidSync:', error);\n    return null;\n  }\n};\n\n// Function to initialize character data for spell selection\nexport function initializeSpellSelection(actor) {\n  try {\n    // Clear previous spell selections to prevent persistence across characters\n    selectedSpells.set(new Map());\n    window.GAS.log.d('[SPELLS DEBUG] Cleared previous spell selections');\n\n    currentCharacter.set(actor);\n\n    // Determine character level - check classes or use a default\n    const actorData = actor.system || actor.data?.data;\n    let level = 1;\n\n    if (actorData.details?.level) {\n      level = actorData.details.level;\n    } else if (actorData.classes) {\n      // Sum up class levels\n      level = Object.values(actorData.classes).reduce((total, cls) => {\n        return total + (cls.levels || cls.system?.levels || 0);\n      }, 0);\n    }\n\n    window.GAS.log.d('[SPELLS DEBUG] Initialized spell selection for level:', level);\n    return level;\n  } catch (error) {\n    console.error('[SPELLS DEBUG] Error initializing spell selection:', error);\n    return 1;\n  }\n}\n\n// Function to fetch spells from compendiums with hybrid approach for class filtering\nexport async function loadAvailableSpells(characterClassName = null) {\n  try {\n    // Get spell compendium sources from settings\n    const packs = getPacksFromSettings(\"spells\");\n\n    window.GAS.log.d('[SPELLS DEBUG] loadAvailableSpells called:', {\n      characterClassName,\n      packsFound: packs?.length || 0,\n      packs: packs?.map(p => p.collection) || 'No packs',\n      dnd5eVersion: window.GAS?.dnd5eVersion,\n      willUseClassFiltering: window.GAS?.dnd5eVersion >= 4 && characterClassName\n    });\n\n    if (!packs || packs.length === 0) {\n      availableSpells.set([]);\n      console.warn(\"[SPELLS DEBUG] No spell compendiums configured in settings\");\n      // window.GAS.log.d(\"[SPELLS DEBUG] No spell compendiums configured\");\n      return;\n    }\n\n    // window.GAS.log.d('[SPELLS DEBUG] Loading spells, character class:', characterClassName);\n\n    let allSpells = [];\n\n    for (const pack of packs) {\n      // window.GAS.log.d('[SPELLS DEBUG] Processing pack:', pack.collection);\n\n      if (characterClassName) {\n        // VERSION-BASED APPROACH: D&D 5e v4+ has class data, v3.x does not\n        if (window.GAS?.dnd5eVersion >= 4) {\n          // D&D 5e v4+ - USE CLASS FILTERING (class data exists on spells)\n          \n          // Support for multiple spell lists (custom classes with array of spell lists)\n          const classNamesToCheck = Array.isArray(characterClassName) ? characterClassName : [characterClassName];\n          window.GAS.log.d(`[SPELLS DEBUG] D&D 5e v4+ - Processing pack with class filtering: ${pack.collection}, checking classes:`, classNamesToCheck);\n\n          // Load all documents from the pack\n          const allDocs = await pack.getDocuments();\n          window.GAS.log.d(`[SPELLS DEBUG] Loaded ${allDocs.length} documents from ${pack.collection}`);\n\n          const filteredSpells = [];\n\n          // Filter by class and convert to our format\n          for (const doc of allDocs) {\n            if (doc.type === \"spell\") {\n              // window.GAS.log.d(`[SPELLS DEBUG] Checking spell: ${doc.name}`);\n              // Check multiple possible locations for class information\n              let spellClasses = null;\n              let availableToClass = false;\n\n              // Check each of the character's spell list classes\n              for (const className of classNamesToCheck) {\n                if (availableToClass) break; // Already found a match, skip remaining checks\n\n                // Check doc.labels.classes (2024 style)\n                if (doc.labels?.classes) {\n                  spellClasses = doc.labels.classes;\n                  if (typeof spellClasses === 'string') {\n                    availableToClass = spellClasses.includes(className) ||\n                      spellClasses.toLowerCase().includes(className.toLowerCase()) ||\n                      spellClasses.trim().length === 0;\n                  } else if (Array.isArray(spellClasses)) {\n                    // labels.classes is sometimes an array of class names\n                    availableToClass = spellClasses.some(s => typeof s === 'string' && (\n                      s === className ||\n                      s.toLowerCase() === className.toLowerCase() ||\n                      s.toLowerCase().includes(className.toLowerCase())\n                    ));\n                  }\n                  // window.GAS.log.d(`[SPELLS DEBUG] [${doc.name}] labels.classes found: ${JSON.stringify(spellClasses)}, checking ${className}, availableToClass: ${availableToClass}`);\n                }\n\n                // Check doc.system.classes (potential 2014 style)\n                if (!availableToClass && doc.system?.classes) {\n                  const systemClasses = doc.system.classes;\n                  if (typeof systemClasses === 'object' && systemClasses.value) {\n                    spellClasses = systemClasses.value;\n                    availableToClass = typeof spellClasses === 'string'\n                      ? spellClasses.includes(className) ||\n                      spellClasses.toLowerCase().includes(className.toLowerCase()) ||\n                      spellClasses.trim().length === 0\n                      : false;\n                    // window.GAS.log.d(`[SPELLS DEBUG] [${doc.name}] system.classes.value found: ${spellClasses}, checking ${className}, availableToClass: ${availableToClass}`);\n                  } else {\n                    // window.GAS.log.d(`[SPELLS DEBUG] [${doc.name}] system.classes present but value missing or not object`);\n                    window.GAS.log.d(`[SPELLS DEBUG] [${doc.name}] system.classes present but value missing or not object`);\n                  }\n                  }\n                // If still not available, check for lazy-loaded class items directly (some compendia store class refs under _lazy)\n                if (!availableToClass && doc._lazy?.classes) {\n                  try {\n                    const lazyClasses = doc._lazy.classes;\n                    // window.GAS.log.d(`[SPELLS DEBUG] [${doc.name}] _lazy.classes present, keys=${Object.keys(lazyClasses).slice(0, 5).join(',')}`);\n                    if (typeof lazyClasses === 'object') {\n                      const keys = Object.keys(lazyClasses);\n                      // Quick key match (slug keys like 'bard')\n                      if (keys.some(k => k.toLowerCase() === className.toLowerCase() || k.toLowerCase().includes(className.toLowerCase()))) {\n                        availableToClass = true;\n                        spellClasses = keys.join(', ');\n                      } else {\n                        // Inspect values (ItemDocuments or prototypes)\n                        for (const val of Object.values(lazyClasses)) {\n                          // Handle Item-like shapes (Item5e) where type==='class' and system.identifier exists\n                          const valType = val?.type || val?.constructor?.name || '';\n                          const identifier = val?.system?.identifier || val?.system?.id || '';\n                          const candidateName = val?.name || val?.system?.name || '';\n\n                          // Exact slug/identifier match (most robust)\n                          if (identifier && identifier.toLowerCase() === className.toLowerCase()) {\n                            availableToClass = true;\n                            spellClasses = identifier;\n                            break;\n                          }\n\n                          // If the lazy value is an Item5e class descriptor, check its type and name\n                          if (valType === 'class' || valType.toLowerCase().includes('class')) {\n                            if (typeof candidateName === 'string' && candidateName.toLowerCase() === className.toLowerCase()) {\n                              availableToClass = true;\n                              spellClasses = candidateName;\n                              break;\n                            }\n                            if (typeof candidateName === 'string' && candidateName.toLowerCase().includes(className.toLowerCase())) {\n                              availableToClass = true;\n                              spellClasses = candidateName;\n                              break;\n                            }\n                          }\n\n                          // Fallback: substring match on identifier or name\n                          if ((typeof identifier === 'string' && identifier.toLowerCase().includes(className.toLowerCase())) ||\n                            (typeof candidateName === 'string' && candidateName.toLowerCase().includes(className.toLowerCase()))) {\n                            availableToClass = true;\n                            spellClasses = identifier || candidateName;\n                            break;\n                          }\n                        }\n                      }\n                      // window.GAS.log.d(`[SPELLS DEBUG] [${doc.name}] _lazy.classes resolved: ${spellClasses}, checking ${className}, availableToClass=${availableToClass}`);\n                    }\n                  } catch (e) {\n                    // window.GAS.log.d(`[SPELLS DEBUG] [${doc.name}] Error inspecting _lazy.classes: ${e}`);\n                  }\n                }\n              } // End of classNamesToCheck loop\n\n              if (availableToClass) {\n                // window.GAS.log.d(`[SPELLS DEBUG] [${doc.name}] Spell is available to class: ${characterClassName}`);\n                // Create spell object with enhanced data\n                // Avoid accessing the deprecated SpellData#preparation getter. Prefer new\n                // fields `method` and `prepared` when present, otherwise fall back to\n                // raw source (`_source`) if available, or a safe default.\n                const sys = doc.system || {};\n                const prepObj = (() => {\n                  // New API: method + prepared\n                  if (sys.method !== undefined || sys.prepared !== undefined) {\n                    return { mode: sys.method ?? 'prepared', prepared: sys.prepared ?? false };\n                  }\n                  // Avoid doc.system.preparation getter; inspect raw packed source if present\n                  const rawPrep = doc._source?.system?.preparation;\n                  if (rawPrep) {\n                    return { mode: rawPrep.mode ?? 'prepared', prepared: rawPrep.prepared ?? false };\n                  }\n                  // Fallback default\n                  return { mode: 'prepared', prepared: false };\n                })();\n\n                const spellObj = {\n                  _id: doc.id,\n                  name: doc.name,\n                  img: doc.img,\n                  type: doc.type,\n                  uuid: doc.uuid,\n                  system: {\n                    level: sys.level,\n                    school: sys.school,\n                    preparation: prepObj,\n                    components: sys.components,\n                    description: sys.description,\n                    activation: sys.activation\n                  },\n                  labels: doc.labels\n                };\n                filteredSpells.push(spellObj);\n              } else {\n                // window.GAS.log.d(`[SPELLS DEBUG] [${doc.name}] Spell is NOT available to class: ${characterClassName}`);\n                // Detailed diagnostic for why this spell was filtered out\n                try {\n                  // window.GAS.log.p(`[SPELLS DEBUG] [FILTERED] ${doc.name}`, {\n                  //   pack: pack.collection,\n                  //   uuid: doc.uuid,\n                  //   name: doc.name,\n                  //   level: doc.system?.level,\n                  //   itemClasses: doc.labels.classes,\n                  //   available: availableToClass,\n                  //   characterClassName: characterClassName, \n                  // });\n                } catch (e) {\n                  // Fallback to simple log if structured logging fails\n                  // window.GAS.log.p(`[SPELLS DEBUG] [FILTERED] ${doc.name} pack=${pack.collection} uuid=${doc.uuid} level=${doc.system?.level} labels=${String(doc.labels?.classes)} system=${String(doc.system?.classes)} available=${availableToClass}`);\n                }\n              }\n            } else {\n              // window.GAS.log.p(`[SPELLS DEBUG] filtered out ${doc.name} because doc type is not spell: ${doc.type}`)\n            }\n          }\n\n          allSpells.push(...filteredSpells);\n          // window.GAS.log.d(`[SPELLS DEBUG] Filtered ${filteredSpells.length} spells for class ${characterClassName} from ${pack.collection}`);\n\n        } else {\n          // D&D 5e v3.x - NO CLASS FILTERING (class data doesn't exist on spells)\n          // window.GAS.log.d('[SPELLS DEBUG] Skipping class filtering for D&D 5e v3.x (class data not available on spells)');\n          // window.GAS.log.d(`[SPELLS DEBUG] Processing pack without class filtering: ${pack.collection}`);\n\n          // Use index approach for better performance\n          const index = await pack.getIndex({ fields: ['system.level', 'system.school'] });\n          const indexEntries = Array.from(index.values());\n\n          const spells = indexEntries\n            .filter(entry => entry.type === \"spell\")\n            .map(entry => ({\n              _id: entry._id,\n              name: entry.name,\n              img: entry.img,\n              type: entry.type,\n              uuid: entry.uuid,\n              system: {\n                level: entry.system?.level || 0,\n                school: entry.system?.school || 'unknown',\n                preparation: { mode: 'prepared', prepared: false }, // Default for compatibility\n                components: {},\n                description: { value: '' },\n                activation: {}\n              },\n              labels: {} // Empty labels for v3.x compatibility\n            }));\n\n          allSpells.push(...spells);\n          // window.GAS.log.d(`[SPELLS DEBUG] Loaded ${spells.length} spells (no class filtering) from ${pack.collection}`);\n          if (spells.length === 0) {\n            // Provide more context when index yields no spells\n            try {\n              const sampleTypes = indexEntries.slice(0, 5).map(e => ({ name: e.name, type: e.type }));\n              // window.GAS.log.p(`[SPELLS DEBUG] [INDEX EMPTY] pack=${pack.collection} indexEntries=${indexEntries.length} sample=${JSON.stringify(sampleTypes)}`);\n            } catch (e) {\n              window.GAS.log.p(`[SPELLS DEBUG] [INDEX EMPTY] pack=${pack.collection} indexEntries=${indexEntries.length}`);\n            }\n          }\n        }\n      } else {\n        // NO CLASS FILTERING: Use index data only (much faster)\n        // window.GAS.log.d('[SPELLS DEBUG] Using index-only approach (no class filtering)');\n\n        // Get basic index with system properties (these ARE indexable)\n        const index = await pack.getIndex({ fields: ['system.level', 'system.school'] });\n\n        // Convert index to array for processing\n        const indexEntries = Array.from(index.values());\n\n        const spells = indexEntries\n          .filter(entry => entry.type === \"spell\")\n          .map(entry => ({\n            _id: entry._id,\n            name: entry.name,\n            img: entry.img,\n            type: entry.type,\n            uuid: entry.uuid,\n            system: {\n              level: entry.system?.level || 0,\n              school: entry.system?.school || 'unknown'\n            }\n          }));\n\n        allSpells.push(...spells);\n        // window.GAS.log.d(`[SPELLSDEBUG ] Loaded ${spells.length} spells (index only) from ${pack.collection}`);\n        if (spells.length === 0) {\n          try {\n            const sampleTypes = indexEntries.slice(0, 5).map(e => ({ name: e.name, type: e.type }));\n            // window.GAS.log.p(`[SPELLS DEBUG] [INDEX ONLY EMPTY] pack=${pack.collection} indexEntries=${indexEntries.length} sample=${JSON.stringify(sampleTypes)}`);\n          } catch (e) {\n            window.GAS.log.p(`[SPELLS DEBUG] [INDEX ONLY EMPTY] pack=${pack.collection} indexEntries=${indexEntries.length}`);\n          }\n        }\n      }\n    }\n\n    // Handle duplicates - keep only the first instance of each spell name\n    const seenSpells = new Map();\n    const uniqueSpells = [];\n    for (const spell of allSpells) {\n      const uniqueKey = spell.name.toLowerCase();\n      if (!seenSpells.has(uniqueKey)) {\n        uniqueSpells.push(spell);\n        seenSpells.set(uniqueKey, true);\n      } else {\n        window.GAS.log.d(`[SPELLS DEBUG] Skipping duplicate spell: ${spell.name} (uuid: ${spell.uuid})`);\n      }\n    }\n\n    // Sort spells by level, then by name\n    uniqueSpells.sort((a, b) => {\n      const levelA = a.system?.level || 0;\n      const levelB = b.system?.level || 0;\n      if (levelA !== levelB) {\n        return levelA - levelB;\n      }\n      return a.name.localeCompare(b.name);\n    });\n\n    // Update the store with spells\n    availableSpells.set(uniqueSpells);\n    window.GAS.log.d('[SPELLS] Final loaded spells:', uniqueSpells.length);\n    window.GAS.log.d('[SPELLS DEBUG] FINAL RESULT: Set availableSpells store with', uniqueSpells.length, 'spells for class:', characterClassName);\n    if (uniqueSpells.length === 0) {\n      // When no spells survive filtering, dump helpful state\n      try {\n        // window.GAS.log.p('[SPELLS DEBUG] [NO_SPELLS] All spells filtered out', {\n        //   packs: packs?.map(p => p.collection) || [],\n        //   packsFound: packs?.length || 0,\n        //   characterClassName\n        // });\n      } catch (e) {\n        window.GAS.log.p('[SPELLS DEBUG] [NO_SPELLS] All spells filtered out packs=' + (packs?.map(p => p.collection).join(',') || '') + ' class=' + String(characterClassName));\n      }\n    }\n\n  } catch (error) {\n    console.error(\"Error loading available spells:\", error);\n    availableSpells.set([]);\n  }\n}\n\n// Function to add a spell to selected spells\nexport async function addSpell(spell) {\n  try {\n    const spellId = spell.id || spell._id;\n\n    if (!spellId) {\n      console.error(\"Spell has no id:\", spell);\n      ui.notifications?.warn(\"Spell has no ID\");\n      return;\n    }\n\n    // Try to get full spell data via fromUuid first\n    let fullSpellData = null;\n    if (spell.uuid) {\n      try {\n        const fromUuid = foundry.utils?.fromUuid || globalThis.fromUuid;\n        if (fromUuid) {\n          fullSpellData = await fromUuid(spell.uuid);\n        }\n      } catch (error) {\n        window.GAS.log.w('[SPELLS] fromUuid failed for', spell.name, error);\n      }\n    }\n\n    // If fromUuid failed, use the spell data we already have\n    if (!fullSpellData) {\n      window.GAS.log.d('[SPELLS] Using direct spell data for', spell.name);\n      // The spell object from availableSpells already has all the data we need\n      fullSpellData = spell;\n    }\n\n    selectedSpells.update(spells => {\n      const newSpells = new Map(spells);\n      newSpells.set(spellId, { itemData: fullSpellData });\n      return newSpells;\n    });\n\n  } catch (error) {\n    console.error(\"Error adding spell:\", error);\n    ui.notifications?.warn(\"Error adding spell\");\n  }\n}\n\n// Function to remove a spell from selected spells\nexport function removeSpell(spellId) {\n  try {\n    selectedSpells.update(spells => {\n      const newSpells = new Map(spells);\n      newSpells.delete(spellId);\n      return newSpells;\n    });\n  } catch (error) {\n    console.error(\"Error removing spell:\", error);\n    ui.notifications?.warn(\"Error removing spell\");\n  }\n}\n\n// Function to finalize spell selection and add them to the character\nexport async function finalizeSpellSelection(actor) {\n  // window.GAS.log.d('[SPELLS] finalizeSpellSelection called with actor:', actor?.name);\n\n  if (!actor) {\n    ui.notifications.error(\"No active character\");\n    return false;\n  }\n\n  try {\n    const spells = get(selectedSpells);\n    try {\n      const actorDebug = {\n        name: actor?.name,\n        id: actor?.id,\n        hasCreateEmbeddedDocuments: typeof actor?.createEmbeddedDocuments === 'function',\n        itemsType: actor?.items ? (actor.items.constructor?.name || typeof actor.items) : 'none',\n        itemsCount: (() => {\n          try {\n            if (!actor?.items) return 0;\n            if (typeof actor.items.size === 'number') return actor.items.size;\n            if (Array.isArray(actor.items)) return actor.items.length;\n            if (typeof actor.items === 'object') return Object.keys(actor.items).length;\n            return -1;\n          } catch { return -1; }\n        })()\n      };\n      window.GAS.log.d('[SPELLS][finalize] Starting finalizeSpellSelection', actorDebug);\n      window.GAS.log.d('[SPELLS][finalize] Selected spells map size:', spells?.size ?? 0);\n    } catch (e) {\n      // best-effort logging only\n    }\n  window.GAS.log.d('[SPELLS][finalize] spells selected and to be added', spells);\n    if (spells.size === 0) {\n      ui.notifications.warn(\"No spells selected\");\n      return false;\n    }\n\n    // Convert selected spells to items that can be added to the character\n    const spellItems = Array.from(spells.values()).map(({ itemData }) => {\n      const spellObject = typeof itemData.toObject === 'function'\n        ? itemData.toObject()\n        : foundry.utils.deepClone(itemData);\n      return spellObject;\n    });\n\n  window.GAS.log.d('[SPELLS][finalize] Creating', spellItems.length, 'spell items:', spellItems.map(s => s.name));\n\n    // Check for existing spells and handle duplicates similar to shop\n    const itemsToCreate = [];\n\n    // Resolve various actor shapes: Actor Document with .items Collection/Array/Map or a plain POJO\n    const resolveActorItems = (act) => {\n      // If actor has Collection-like .items with .find, return as-is\n      if (act.items && typeof act.items.find === 'function') return act.items;\n      // If items is a Map or an object, convert to array\n      if (act.items && typeof act.items === 'object') return Array.isArray(act.items) ? act.items : Object.values(act.items);\n      // If actor appears to be a lightweight data object, try to locate live Actor document by id\n      if (act.id && typeof game?.actors?.get === 'function') {\n        const live = game.actors.get(act.id);\n        if (live) return live.items;\n      }\n      // Fallback: empty array\n      return [];\n    };\n\n    const actorItems = resolveActorItems(actor);\n    try {\n      const existingNames = (() => {\n        try {\n          if (!actorItems) return [];\n          if (typeof actorItems.map === 'function') return actorItems.map(i => i?.name).filter(Boolean);\n          return [];\n        } catch { return []; }\n      })();\n      window.GAS.log.d('[SPELLS][finalize] Actor existing items (names):', existingNames);\n    } catch {}\n\n    for (const spellItem of spellItems) {\n      // Normalize lookup against different item shapes\n      let existingSpell = null;\n      try {\n        if (actorItems && typeof actorItems.find === 'function') {\n          existingSpell = actorItems.find(i => i.name === spellItem.name && i.type === \"spell\");\n        } else if (Array.isArray(actorItems)) {\n          existingSpell = actorItems.find(i => i.name === spellItem.name && i.type === \"spell\");\n        }\n      } catch (e) {\n        window.GAS.log.w('[SPELLS] Error while searching actor items for duplicates:', e);\n      }\n\n      if (existingSpell) {\n        window.GAS.log.d('[SPELLS][finalize] Found existing spell on actor, skipping:', spellItem.name);\n        continue;\n      }\n\n      window.GAS.log.d('[SPELLS][finalize] New spell, will create:', spellItem.name);\n      itemsToCreate.push(spellItem);\n    }\n\n    // Create new spells in a single batch if possible\n    if (itemsToCreate.length > 0) {\n      try {\n        window.GAS.log.d('[SPELLS][finalize] About to create items. Using actor.createEmbeddedDocuments? ', typeof actor.createEmbeddedDocuments === 'function');\n        if (typeof actor.createEmbeddedDocuments === 'function') {\n          const createdSpells = await actor.createEmbeddedDocuments(\"Item\", itemsToCreate);\n          window.GAS.log.d('[SPELLS][finalize] Created spells via createEmbeddedDocuments:', createdSpells?.length ?? itemsToCreate.length);\n        } else if (typeof Item === 'function' && typeof Item.create === 'function') {\n          // Fallback: create each item with Item.create({ parent: actor })\n          const created = [];\n          for (const data of itemsToCreate) {\n            try {\n              const createdItem = await Item.create(data, { parent: actor });\n              created.push(createdItem);\n            } catch (e) {\n              window.GAS.log.w('[SPELLS] Failed to create item via Item.create:', data.name, e);\n            }\n          }\n          window.GAS.log.d('[SPELLS][finalize] Created spells via Item.create fallback:', created.length);\n        } else {\n          window.GAS.log.w('[SPELLS][finalize] No API available to create embedded items on actor');\n        }\n      } catch (e) {\n        window.GAS.log.e('[SPELLS][finalize] Error creating spell items:', e);\n        throw e;\n      }\n    }\n\n    // Clear the selection\n    selectedSpells.set(new Map());\n\n    // Make the spells tab readonly\n    readOnlyTabs.update(tabs => [...tabs, 'spells']);\n\n    // Check if we're in level-up mode and handle workflow accordingly\n    const isLevelUpMode = get(isLevelUp);\n    if (isLevelUpMode) {\n      window.GAS.log.d('[SPELLS][finalize] Level-up mode detected, triggering LevelUp workflow completion');\n      // Import and trigger the LevelUp workflow completion\n      const { handleSpellsCompleteLevelUp } = await import('~/src/lib/workflow');\n      await handleSpellsCompleteLevelUp();\n    }\n\n    ui.notifications?.info(`Added ${itemsToCreate.length} spells to character`);\n    window.GAS.log.d('[SPELLS][finalize] Completed finalizeSpellSelection. itemsToCreate:', itemsToCreate.length);\n    return true;\n\n  } catch (error) {\n    console.error(\"Error finalizing spell selection:\", error);\n    ui.notifications?.error(\"Error adding spells to character: \" + error.message);\n    return false;\n  }\n}\n\n// Function to auto-populate all spells for classes that get access to all spells\nexport async function autoPopulateAllSpells(characterClassName, maxSpellLevel, actor, isLevelUp = false, oldMaxSpellLevel = 0) {\n  try {\n    // window.GAS.log.d('[SPELLS] Auto-populating spells for', characterClassName, 'up to level', maxSpellLevel, 'isLevelUp:', isLevelUp, 'oldMaxSpellLevel:', oldMaxSpellLevel);\n\n    // Get current available spells\n    const currentSpells = get(availableSpells);\n    const currentLimits = get(spellLimits);\n\n    if (currentSpells.length === 0) {\n      ui.notifications?.warn(\"No spells available to auto-populate\");\n      return false;\n    }\n\n    // For level-up scenarios, only add spells of the NEW maximum level\n    // For character creation, add all spells up to max level\n    let spellsToAdd;\n    if (isLevelUp && oldMaxSpellLevel > 0) {\n      // Level-up: add spells for any newly accessible levels (greater than oldMaxSpellLevel\n      // and less than or equal to the new maxSpellLevel). Previously this only added\n      // spells exactly at maxSpellLevel which could miss spells at intermediate levels.\n      spellsToAdd = currentSpells.filter(spell => {\n        const spellLevel = spell.system?.level || 0;\n        return spellLevel > oldMaxSpellLevel && spellLevel <= maxSpellLevel;\n      });\n    } else {\n      // Character creation: add all spells up to max level (excluding cantrips)\n      spellsToAdd = currentSpells.filter(spell => {\n        const spellLevel = spell.system?.level || 0;\n        return spellLevel > 0 && spellLevel <= maxSpellLevel;\n      });\n    }\n\n    if (spellsToAdd.length === 0) {\n      if (isLevelUp) {\n        ui.notifications?.info(\"No new spells available for this level up\");\n      } else {\n        ui.notifications?.warn(\"No spells to auto-populate for this level\");\n      }\n      return false;\n    }\n\n    // Create appropriate dialog content based on context\n    let dialogContent;\n    if (isLevelUp && oldMaxSpellLevel > 0) {\n      dialogContent = `\n        <p><strong>${characterClassName}s</strong> have access to all spells of appropriate level.</p>\n        <p>Would you like to automatically add all ${spellsToAdd.length} new level ${maxSpellLevel} spells to your spellbook?</p>\n        <p><em>Note: This will only add spells of the new maximum level (${maxSpellLevel}) that you gained access to.</em></p>\n      `;\n    } else {\n      dialogContent = `\n        <p><strong>${characterClassName}s</strong> have access to all spells of appropriate level.</p>\n        <p>Would you like to automatically add all ${spellsToAdd.length} spells (levels 1-${maxSpellLevel}) to your spellbook?</p>\n        <p><em>Note: You'll still need to select your cantrips manually, as those are limited and cannot be changed later.</em></p>\n      `;\n    }\n\n    // Ask user for confirmation\n    const confirmed = await Dialog.confirm({\n      title: `Auto-populate ${characterClassName} Spells`,\n      content: dialogContent,\n      yes: () => true,\n      no: () => false,\n      defaultYes: true\n    });\n\n    if (!confirmed) {\n      return false;\n    }\n\n    // Add all spells to selection\n    let addedCount = 0;\n    for (const spell of spellsToAdd) {\n      try {\n        await addSpell(spell);\n        addedCount++;\n      } catch (error) {\n        console.warn(`Failed to add spell ${spell.name}:`, error);\n      }\n    }\n\n    ui.notifications?.info(`Auto-populated ${addedCount} spells for ${characterClassName}`);\n    // window.GAS.log.d('[SPELLS] Auto-populated', addedCount, 'spells');\n\n    return true;\n\n  } catch (error) {\n    console.error(\"Error auto-populating spells:\", error);\n    ui.notifications?.error(\"Error auto-populating spells: \" + error.message);\n    return false;\n  }\n}\n\n// Make the stores globally available for other components to access\nif (typeof window !== 'undefined') {\n  if (!window.GAS) window.GAS = {};\n  window.GAS.availableSpells = availableSpells;\n  window.GAS.selectedSpells = selectedSpells;\n  window.GAS.isSpellcaster = isSpellcaster;\n  window.GAS.maxSpellLevel = maxSpellLevel;\n  window.GAS.spellLimits = spellLimits;\n  window.GAS.currentSpellCounts = currentSpellCounts;\n  window.GAS.spellProgress = spellProgress;\n  window.GAS.initializeSpellSelection = initializeSpellSelection;\n  window.GAS.loadAvailableSpells = loadAvailableSpells;\n  window.GAS.addSpell = addSpell;\n  window.GAS.removeSpell = removeSpell;\n  window.GAS.finalizeSpellSelection = finalizeSpellSelection;\n  window.GAS.autoPopulateAllSpells = autoPopulateAllSpells;\n}\n","/**\n * Character creation and management workflows\n * Contains non-reactive logic that can be shared across components\n */\nimport { get } from \"svelte/store\";\nimport { MODULE_ID } from \"~/src/helpers/constants\";\nimport { getWorkflowFSM, workflowFSMContext, WORKFLOW_EVENTS } from \"~/src/helpers/WorkflowStateMachine\";\nimport { getLevelUpFSM, levelUpFSMContext, LEVELUP_EVENTS } from '~/src/helpers/LevelUpStateMachine';\nimport {\n  getLevelByDropType,\n  itemHasAdvancementChoices,\n  isAdvancementsForLevelInItem,\n  dropItemOnCharacter\n} from \"~/src/helpers/Utility\";\nimport { destroyAdvancementManagers } from \"~/src/helpers/AdvancementManager\";\nimport { goldRoll } from '../stores/storeDefinitions';\nimport { totalGoldFromChoices } from '../stores/goldChoices';\nimport { tabs, activeTab, readOnlyTabs } from '../stores/index.js';\nimport { finalizeSpellSelection } from '../stores/spellSelection.js';\nimport { spellProgress } from '../stores/spellSelection.js';\nimport { selectedSpells } from '../stores/spellSelection.js';\n\n/**\n * Handles creating container contents for a container item\n * @param {Object} sourceItem - The original container item from UUID\n * @param {Object} createdContainerItem - The created container item on the actor\n * @param {Object} actor - The target actor\n * @returns {Promise<void>}\n */\nexport async function handleContainerContents(sourceItem, createdContainerItem, actor) {\n  if (sourceItem.type !== 'container') return;\n  \n  try {\n    // Access contents from system.contents\n    const contents = await sourceItem.system.contents;\n    \n    if (contents && contents.size > 0) {\n      window.GAS.log.d('[CONTAINER] Processing container contents for:', sourceItem.name, 'Contents count:', contents.size);\n      \n      // Create each contained item separately with system.container pointing to the main item\n      for (const containedItem of contents) {\n        try {\n          const containedData = game.items.fromCompendium(containedItem);\n          if (containedData) {\n            // Set the container property to point to the main container\n            containedData.system.container = createdContainerItem.id;\n            await Item.create(containedData, { parent: actor });\n            window.GAS.log.d('[CONTAINER] Created contained item:', containedItem.name, 'in container:', createdContainerItem.id);\n          }\n        } catch (error) {\n          console.error('Error creating contained item:', containedItem.name, error);\n        }\n      }\n    } else {\n      window.GAS.log.d('[CONTAINER] Container has no contents or contents is empty');\n    }\n  } catch (error) {\n    console.error('Error processing container contents for:', sourceItem.name, error);\n  }\n}\n\n// Instantiate the Finity-based workflow FSM\n// const workflowFSM = createWorkflowStateMachine();\n\n/**\n * Creates a new actor in the game world and embeds all selected items\n * @param {Object} params - Parameters object\n * @param {Object} params.actor - The actor document to create\n * @param {Object} params.stores - Store references\n * @param {Object} params.dropItemRegistry - Drop item registry for queuing items\n * @returns {Promise<Object>} The created actor\n */\nexport async function createActorInGameAndEmbedItems({\n  actor,\n  stores,\n  dropItemRegistry\n}) {\n  const {\n    race,\n    subRace,\n    background,\n    characterClass,\n    characterSubClass,\n    isLevelUp,\n    preAdvancementSelections,\n    actorInGame,\n    tabs,\n    activeTab\n  } = stores;\n\n  // Initialize the workflow state machine for character creation\n  const fsm = getWorkflowFSM();\n  fsm.handle(WORKFLOW_EVENTS.START_CHARACTER_CREATION);\n\n  // Create Actor\n  const createdActor = await Actor.create(get(actor).toObject());\n  actorInGame.set(createdActor);\n  \n  // Set the actor in the workflow FSM context\n  workflowFSMContext.actor = createdActor;\n\n  // Simple sheet override during drop processing:\n  // 1) Record the current sheet class\n  // 2) Switch to dnd5e.CharacterActorSheet so drops use core dnd5e handlers\n  // 3) Restoration occurs after the queue completes in WorkflowStateMachine\n  try {\n    const originalSheet = createdActor.getFlag('core', 'sheetClass') ?? '';\n    await createdActor.setFlag(MODULE_ID, 'originalSheetClass', originalSheet);\n    await createdActor.setFlag('core', 'sheetClass', 'dnd5e.CharacterActorSheet');\n  } catch (e) {\n    // Non-fatal: if we can't set the flag, proceed normally\n    window.GAS?.log?.w?.('[WORKFLOW] Failed to set temporary sheetClass; continuing', e);\n  }\n\n  const $race = get(race);\n  const $subRace = get(subRace);\n  const $background = get(background);\n  const $characterClass = get(characterClass);\n  const $characterSubClass = get(characterSubClass);\n  const $isLevelUp = get(isLevelUp);\n  const $preAdvancementSelections = get(preAdvancementSelections);\n\n  // Add race\n  if ($race && !$isLevelUp) {\n    dropItemRegistry.add({\n      actor: createdActor,\n      id: \"race\",\n      itemData: $race,\n      isLevelUp: $isLevelUp,\n      hasAdvancementChoices: itemHasAdvancementChoices($race),\n      hasAdvancementsForLevel: isAdvancementsForLevelInItem(\n        getLevelByDropType(createdActor, $race),\n        $race,\n      ),\n    });\n    preAdvancementSelections.update(prev => ({ ...prev, race: $race }));\n  }\n  \n  // Add subrace\n  if ($subRace && !$isLevelUp) {\n    dropItemRegistry.add({\n      actor: createdActor,\n      id: \"subRace\",\n      itemData: $subRace,\n      isLevelUp: $isLevelUp,\n      hasAdvancementChoices: itemHasAdvancementChoices($subRace),\n      hasAdvancementsForLevel: isAdvancementsForLevelInItem(\n        getLevelByDropType(createdActor, $subRace),\n        $subRace,\n      ),\n    });\n    preAdvancementSelections.update(prev => ({ ...prev, subRace: $subRace }));\n  }\n  \n  // Add background\n  if ($background && !$isLevelUp) {\n    dropItemRegistry.add({\n      actor: createdActor,\n      id: \"background\",\n      itemData: $background,\n      isLevelUp: $isLevelUp,\n      hasAdvancementChoices: itemHasAdvancementChoices($background),\n      hasAdvancementsForLevel: isAdvancementsForLevelInItem(\n        getLevelByDropType(createdActor, $background),\n        $background,\n      ),\n    });\n    preAdvancementSelections.update(prev => ({ ...prev, background: $background }));\n  }\n\n  // Add character class\n  if ($characterClass) {\n    dropItemRegistry.add({\n      actor: createdActor,\n      id: \"characterClass\",\n      itemData: $characterClass,\n      isLevelUp: $isLevelUp,\n      isNewMultiClass: get(stores.isNewMultiClass),\n      hasAdvancementChoices: itemHasAdvancementChoices($characterClass),\n      hasAdvancementsForLevel: isAdvancementsForLevelInItem(\n        getLevelByDropType(createdActor, \"class\"),\n        $characterClass,\n      ),\n    });\n    preAdvancementSelections.update(prev => ({ ...prev, class: $characterClass }));\n  }\n\n  // Add character subclass\n  if ($characterSubClass) {\n    dropItemRegistry.add({\n      actor: createdActor,\n      id: \"characterSubClass\",\n      itemData: $characterSubClass,\n      isLevelUp: $isLevelUp,\n      hasAdvancementChoices: itemHasAdvancementChoices($characterSubClass),\n      hasAdvancementsForLevel: isAdvancementsForLevelInItem(\n        getLevelByDropType(createdActor, \"subclass\"),\n        $characterSubClass,\n      ),\n    });\n    preAdvancementSelections.update(prev => ({ ...prev, subclass: $characterSubClass }));\n  }\n\n  fsm.handle(WORKFLOW_EVENTS.CHARACTER_CREATED);\n}\n\n/**\n * Updates an existing actor for level up and embeds new items\n * @param {Object} params - Parameters object\n * @param {Object} params.actor - The actor document to update\n * @param {string} params.actorName - New name for the actor\n * @param {Object} params.stores - Store references\n * @param {Object} params.dropItemRegistry - Drop item registry for queuing items\n * @returns {Promise<void>}\n */\n/**\n * Legacy function for updating actors (DEPRECATED for LevelUp - use updateActorLevelUpWorkflow instead)\n * This function is kept for backward compatibility but should not be used for level-up scenarios\n */\nexport async function updateActorAndEmbedItems({\n  actor,\n  actorName,\n  stores,\n  dropItemRegistry\n}) {\n  const {\n    classUuidForLevelUp,\n    levelUpClassObject,\n    subClassUuidForLevelUp,\n    levelUpSubClassObject,\n    isLevelUp,\n    isNewMultiClass,\n    actorInGame\n  } = stores;\n\n  window.GAS.log.d('[WORKFLOW] updateActorAndEmbedItems (LEGACY)', get(classUuidForLevelUp));\n  window.GAS.log.w('[WORKFLOW] WARNING: updateActorAndEmbedItems is deprecated for level-up. Use updateActorLevelUpWorkflow instead.');\n\n  await get(actor).update({ name: actorName });\n  actorInGame.set(get(actor));\n  \n  // Set the actor in the workflow FSM context\n  workflowFSMContext.actor = get(actor);\n  \n  const $classUuidForLevelUp = get(classUuidForLevelUp);\n  const $subClassUuidForLevelUp = get(subClassUuidForLevelUp);\n  const $levelUpClassObject = get(levelUpClassObject);\n  const $levelUpSubClassObject = get(levelUpSubClassObject);\n  const $isLevelUp = get(isLevelUp);\n  const $isNewMultiClass = get(isNewMultiClass);\n  \n  // Add the class level update to the queue\n  if ($classUuidForLevelUp) {\n    dropItemRegistry.add({\n      actor: get(actor),\n      id: \"characterClass\",\n      itemData: $levelUpClassObject,\n      isLevelUp: $isLevelUp,\n      isNewMultiClass: $isNewMultiClass,\n    });\n  }\n  \n  // Add the subclass to the queue if it exists\n  if ($subClassUuidForLevelUp) {\n    dropItemRegistry.add({\n      actor: get(actor),\n      id: \"characterSubClass\",\n      itemData: $levelUpSubClassObject,\n      isLevelUp: $isLevelUp,\n      hasAdvancementChoices: itemHasAdvancementChoices($levelUpSubClassObject),\n      hasAdvancementsForLevel: isAdvancementsForLevelInItem(\n        getLevelByDropType(get(actor), \"subclass\"),\n        $levelUpSubClassObject,\n      ),\n    });\n  }\n\n  window.GAS.log.d('[WORKFLOW] updateActorAndEmbedItems advancing queue');\n  await dropItemRegistry.advanceQueue(true);\n  \n  // REMOVED: Don't fire QUEUE_PROCESSED event here as it conflicts with LevelUp workflow\n  // The character creation workflow should handle its own state transitions\n  \n  // If advancement is disabled, destroy any open advancement managers\n  if (game.settings.get(MODULE_ID, 'disableAdvancementCapture')) {\n    window.GAS.log.d('[WORKFLOW] Advancement disabled - destroying advancement managers');\n    destroyAdvancementManagers();\n  }\n}\n\n/**\n * LevelUp workflow function that uses the dedicated LevelUp state machine\n * This replaces the old updateActorAndEmbedItems function for level-up scenarios\n */\nexport async function updateActorLevelUpWorkflow({\n  actor,\n  actorName,\n  stores,\n  dropItemRegistry\n}) {\n  const {\n    classUuidForLevelUp,\n    levelUpClassObject,\n    subClassUuidForLevelUp,\n    levelUpSubClassObject,\n    isLevelUp,\n    isNewMultiClass,\n    actorInGame\n  } = stores;\n\n  window.GAS.log.d('[LEVELUP WORKFLOW] Starting level-up workflow', get(classUuidForLevelUp));\n\n  try {\n    // Update actor name\n    await get(actor).update({ name: actorName });\n    actorInGame.set(get(actor));\n    \n    // Set the actor in the LevelUp FSM context\n    levelUpFSMContext.actor = get(actor);\n    \n    const $classUuidForLevelUp = get(classUuidForLevelUp);\n    const $subClassUuidForLevelUp = get(subClassUuidForLevelUp);\n    const $levelUpClassObject = get(levelUpClassObject);\n    const $levelUpSubClassObject = get(levelUpSubClassObject);\n    const $isLevelUp = get(isLevelUp);\n    const $isNewMultiClass = get(isNewMultiClass);\n    \n    // Add the class level update to the queue\n    if ($classUuidForLevelUp) {\n      dropItemRegistry.add({\n        actor: get(actor),\n        id: \"characterClass\",\n        itemData: $levelUpClassObject,\n        isLevelUp: $isLevelUp,\n        isNewMultiClass: $isNewMultiClass,\n        hasAdvancementChoices: itemHasAdvancementChoices($levelUpClassObject),\n        hasAdvancementsForLevel: isAdvancementsForLevelInItem(\n          getLevelByDropType(get(actor), \"class\"),\n          $levelUpClassObject,\n        ),\n      });\n    }\n    \n    // Add the subclass to the queue if it exists\n    if ($subClassUuidForLevelUp) {\n      dropItemRegistry.add({\n        actor: get(actor),\n        id: \"characterSubClass\",\n        itemData: $levelUpSubClassObject,\n        isLevelUp: $isLevelUp,\n        hasAdvancementChoices: itemHasAdvancementChoices($levelUpSubClassObject),\n        hasAdvancementsForLevel: isAdvancementsForLevelInItem(\n          getLevelByDropType(get(actor), \"subclass\"),\n          $levelUpSubClassObject,\n        ),\n      });\n    }\n\n    // Start the LevelUp state machine workflow\n    // First ensure we're in the correct state - reset if needed\n    const levelUpFSM = getLevelUpFSM();\n    const currentState = levelUpFSM.getCurrentState();\n    window.GAS.log.d('[LEVELUP WORKFLOW] Current FSM state before starting:', currentState);\n    \n    // Reset FSM to idle if it's in a terminal state (completed or error)\n    if (currentState === 'completed' || currentState === 'error') {\n      window.GAS.log.d('[LEVELUP WORKFLOW] Resetting FSM from terminal state:', currentState);\n      levelUpFSM.handle(LEVELUP_EVENTS.RESET);\n    }\n    \n    // Start the level-up workflow: idle -> selecting_class_level -> processing_advancements\n    let finalState = levelUpFSM.getCurrentState();\n    if (finalState === 'idle') {\n      window.GAS.log.d('[LEVELUP WORKFLOW] Starting level-up from idle state');\n      levelUpFSM.handle(LEVELUP_EVENTS.START_LEVEL_UP);\n      levelUpFSM.handle(LEVELUP_EVENTS.CLASS_LEVEL_SELECTED);\n    } else {\n      window.GAS.log.w('[LEVELUP WORKFLOW] FSM not in idle state after reset:', finalState);\n      // If the FSM is in any non-idle state (including processing_advancements),\n      // reset it to a known idle state before starting the level-up flow. This\n      // prevents sending the `class_level_selected` event into a state that\n      // doesn't handle it (e.g. processing_advancements) which caused an\n      // unhandled event error.\n      try {\n        levelUpFSM.handle(LEVELUP_EVENTS.RESET);\n        finalState = levelUpFSM.getCurrentState();\n        window.GAS.log.d('[LEVELUP WORKFLOW] FSM state after RESET:', finalState);\n      } catch (err) {\n        window.GAS.log.e('[LEVELUP WORKFLOW] Error resetting LevelUp FSM:', err);\n      }\n\n      // Now attempt to start the flow from idle\n      if (finalState === 'idle') {\n        levelUpFSM.handle(LEVELUP_EVENTS.START_LEVEL_UP);\n        levelUpFSM.handle(LEVELUP_EVENTS.CLASS_LEVEL_SELECTED);\n      } else {\n        window.GAS.log.e('[LEVELUP WORKFLOW] Unable to reset LevelUp FSM to idle. Current state:', finalState);\n      }\n    }\n    \n    window.GAS.log.d('[LEVELUP WORKFLOW] LevelUp workflow initiated');\n    \n  } catch (error) {\n    window.GAS.log.e('[LEVELUP WORKFLOW] Error in level-up workflow:', error);\n    const levelUpFSM = getLevelUpFSM();\n    const currentState = levelUpFSM.getCurrentState();\n    \n    // Only send error event if not already in terminal state\n    if (currentState !== 'error' && currentState !== 'completed') {\n      levelUpFSM.handle(LEVELUP_EVENTS.ERROR, { error: error.message });\n    } else {\n      window.GAS.log.d('[LEVELUP WORKFLOW] FSM in terminal state, skipping error event');\n    }\n    throw error;\n  }\n}\n\n/**\n * Handles adding equipment to the actor\n * @param {Object} params - Parameters object  \n * @param {Object} params.stores - Store references\n * @param {Object} params.actorInGame - The actor to add equipment to\n * @param {Function} params.onEquipmentAdded - Callback when equipment is added\n * @returns {Promise<void>}\n */\nexport async function handleAddEquipment({\n  stores,\n  actorInGame,\n  onEquipmentAdded\n}) {\n  const {\n    flattenedSelections,\n    totalGoldFromChoices,\n    goldRoll\n  } = stores;\n\n  const $actorInGame = get(actorInGame);\n  const $flattenedSelections = get(flattenedSelections);\n  \n  if ($actorInGame) {\n    // Count occurrences of each item by UUID\n    const itemCounts = new Map();\n    \n    // Count how many times each item appears in selections\n    for (const selection of $flattenedSelections) {\n      if (selection.key) {\n        const count = itemCounts.get(selection.key) || 0;\n        itemCounts.set(selection.key, count + 1);\n      }\n    }\n\n    // Process each unique item with its total quantity\n    for (const [uuid, quantity] of itemCounts.entries()) {\n      // Use fromDropData to create a properly formatted item for dropping\n      const fromUuid = foundry.utils?.fromUuid || globalThis.fromUuid;\n      const item = await fromUuid(uuid)\n      if (item) {\n        // Create a copy of the item data and set the quantity\n        const data = game.items.fromCompendium(item);\n        data.system.quantity = quantity;\n        let createdItem;\n        if (window.GAS.dnd5eVersion >= 5) {\n          createdItem = await Item.create(data, { parent: $actorInGame });\n        } else {\n          // For v4.x and below, use dropItemOnCharacter to ensure advancements fire\n          const preIds = new Set($actorInGame.items.map(i => i.id));\n          await dropItemOnCharacter($actorInGame, data);\n          // Poll for the new item to appear on the actor\n          createdItem = await new Promise((resolve) => {\n            const maxAttempts = 20;\n            let attempts = 0;\n            const interval = setInterval(() => {\n              const newItems = $actorInGame.items.filter(i => !preIds.has(i.id) && i.name === data.name && i.type === data.type);\n              if (newItems.length > 0) {\n                clearInterval(interval);\n                resolve(newItems[0]);\n              } else if (++attempts >= maxAttempts) {\n                clearInterval(interval);\n                window.GAS.log.w('[WORKFLOW] Timed out waiting for dropped item to appear on actor:', data.name);\n                resolve(null);\n              }\n            }, 100);\n          });\n        }\n        // Handle containers - contents may be a Promise that resolves to a Collection\n        await handleContainerContents(item, createdItem, $actorInGame);\n        window.GAS.log.d('[WORKFLOW] Successfully created item:', item.name, 'with quantity:', quantity);\n      }\n    }\n\n    // Check if equipment purchase is enabled\n    const enableEquipmentPurchase = game.settings.get(MODULE_ID, 'enableEquipmentPurchase');\n    if (!enableEquipmentPurchase) {\n      // Shop is disabled, add gold directly to actor\n      let goldValue;\n      \n      // Use the appropriate gold source based on DnD5e version\n      if (window.GAS.dnd5eVersion >= 4) {\n        goldValue = get(totalGoldFromChoices);\n        window.GAS.log.d('[WORKFLOW] Adding totalGoldFromChoices to actor for v4:', goldValue);\n      } else {\n        goldValue = get(goldRoll);\n        window.GAS.log.d('[WORKFLOW] Adding goldRoll to actor for v3:', goldValue);\n      }\n      \n      // Add gold to actor if there's any gold to add\n      if (goldValue > 0) {\n        try {\n          await $actorInGame.update({ \"system.currency.gp\": (($actorInGame.system.currency.gp || 0) + goldValue) });\n          window.GAS.log.d('[WORKFLOW] Successfully added', goldValue, 'gold to actor');\n        } catch (error) {\n          console.error('Error adding gold to actor:', error);\n        }\n      }\n    }\n  }\n  \n  // Use state machine to transition to next step\n  const fsm = getWorkflowFSM();\n  \n  window.GAS.log.d('[WORKFLOW] handleAddEquipment - Current FSM state:', fsm.getCurrentState());\n  \n  // Ensure the context has the current actor\n  const contextWithActor = {\n    ...workflowFSMContext,\n    actor: $actorInGame\n  };\n  \n  // Use the helper function to determine the correct equipment completion event\n  const { getEquipmentCompletionEvent } = await import('~/src/helpers/WorkflowStateMachine.js');\n  const completionEvent = getEquipmentCompletionEvent(contextWithActor, false);\n  \n  window.GAS.log.d('[WORKFLOW] handleAddEquipment - Triggering event:', completionEvent, 'with context:', contextWithActor);\n  \n  fsm.handle(completionEvent, contextWithActor);\n  \n  // Call the callback to mark equipment as added\n  if (onEquipmentAdded) {\n    onEquipmentAdded();\n  }\n}\n\nexport async function handleFinalizePurchase({\n  stores,\n  setProcessing\n}) {\n  const {\n    actorInGame,\n    cartTotalCost,\n    remainingGold,\n    finalizePurchase\n  } = stores;\n\n  const $actorInGame = get(actorInGame);\n  const $cartTotalCost = get(cartTotalCost);\n  const $remainingGold = get(remainingGold);\n\n  // Prevent multiple clicks\n  if (setProcessing) {\n    setProcessing(true);\n  }\n\n  if (!$actorInGame) {\n    ui.notifications.error(\"No active character found\");\n    getWorkflowFSM().handle(WORKFLOW_EVENTS.ERROR);\n    if (setProcessing) setProcessing(false);\n    return;\n  }\n\n  if ($cartTotalCost === 0) {\n    const confirmed = await Dialog.confirm({\n      title: \"Empty Cart\",\n      content: \"Your cart is empty. Do you want to continue without purchasing any equipment?\",\n      yes: () => true,\n      no: () => false,\n      defaultYes: true,\n    });\n\n    if (!confirmed) {\n      if (setProcessing) setProcessing(false);\n      return;\n    }\n  }\n\n  if ($remainingGold < 0) {\n    ui.notifications.error(\"Not enough gold for purchase\");\n    if (setProcessing) setProcessing(false);\n    return;\n  }\n\n  window.GAS.log.d('[WORKFLOW] finalizePurchase', finalizePurchase);\n  try {\n    var success = await finalizePurchase($actorInGame);\n    window.GAS.log.d('[WORKFLOW] Purchase finalized successfully:', success);\n  } catch (error) {\n    console.error(\"Error during finalize purchase:\", error);\n    ui.notifications.error(\"An error occurred during purchase.\");\n    getWorkflowFSM().handle(WORKFLOW_EVENTS.ERROR);\n    if (setProcessing) setProcessing(false);\n    return;\n  }\n  try {\n    if (success) {\n      ui.notifications.info(\"Purchase completed successfully\");\n      getWorkflowFSM().handle(WORKFLOW_EVENTS.SHOPPING_COMPLETE);\n    } else {\n      ui.notifications.error(\"Failed to complete purchase\");\n      getWorkflowFSM().handle(WORKFLOW_EVENTS.ERROR, { ...workflowFSMContext, error: \"Failed to complete purchase\" });\n    }\n  } catch (error) {\n    console.error(\"Error handling finalize purchase result:\", error);\n    ui.notifications.error(\"An error occurred while processing the purchase result.\");\n    getWorkflowFSM().handle(WORKFLOW_EVENTS.ERROR, { ...workflowFSMContext, error: error.message });\n  }\n}\n\n/**\n * Checks if an actor has inventory items and returns the result\n * @param {Object} actor - The actor to check\n * @returns {boolean} True if actor has inventory items\n */\nexport function checkActorInventory(actor) {\n  if (actor && actor.items && actor.items.size > 0) {\n    const inventoryTypes = [\"weapon\", \"equipment\", \"consumable\", \"tool\", \"backpack\", \"loot\"];\n    return actor.items.some(item => inventoryTypes.includes(item.type));\n  }\n  return false;\n}\n\n/**\n * Handles the character update workflow with confirmation dialog\n * @param {Object} params - Parameters object\n * @param {Object} params.stores - Store references  \n * @param {Object} params.dropItemRegistry - Drop item registry\n * @returns {Promise<void>}\n */\nexport async function handleCharacterUpdate({\n  stores,\n  dropItemRegistry\n}) {\n  const {\n    hasCharacterCreationChanges,\n    changedCharacterCreationItems,\n    actorInGame,\n    isLevelUp,\n    isNewMultiClass\n  } = stores;\n\n  const $hasCharacterCreationChanges = get(hasCharacterCreationChanges);\n  const $changedCharacterCreationItems = get(changedCharacterCreationItems);\n  const $actorInGame = get(actorInGame);\n  const $isLevelUp = get(isLevelUp);\n  const $isNewMultiClass = get(isNewMultiClass);\n  \n  if (!$hasCharacterCreationChanges) {\n    return;\n  }\n\n  const confirmed = await Dialog.confirm({\n    title: \"Update\",\n    content:\n      \"You have advancements in progress, if you update the actor, any advancements related to the changes will be lost. Are you sure you want to update the actor?\",\n    yes: () => true,\n    no: () => false,\n    defaultYes: false,\n  });\n\n  if (!confirmed) {\n    return;\n  }\n\n  // Store map for getting updated items\n  const storeMap = {\n    'race': stores.race,\n    'background': stores.background,\n    'characterClass': stores.characterClass,\n    'characterSubClass': stores.characterSubClass\n  };\n\n  // Close any open advancement dialogs first\n  const currentProcess = get(dropItemRegistry).currentProcess;\n  if (currentProcess?.app) {\n    currentProcess.app.close();\n  }\n\n  // Remove only the items we're about to update from the queue\n  for (const item of $changedCharacterCreationItems) {\n    dropItemRegistry.remove(item.type);\n  }\n\n  for (const item of $changedCharacterCreationItems) {\n    // Find the item on the actor that matches the type\n    const actorItem = $actorInGame.items.find(i => i.type === item.type);\n\n    // Delete the item from the actor (not the compendium)\n    if (actorItem) {\n      await actorItem.delete();\n    }\n\n    // Get the new item from the store\n    const newStoreItem = get(storeMap[item.type]);\n    if (newStoreItem) {\n      // Add the new item to dropItemRegistry using splice to maintain order\n      dropItemRegistry.splice({\n        actor: $actorInGame,\n        id: item.type,\n        itemData: newStoreItem,\n        isLevelUp: $isLevelUp,\n        isNewMultiClass: item.type === \"characterClass\" ? $isNewMultiClass : undefined,\n        hasAdvancementChoices: itemHasAdvancementChoices(newStoreItem),\n        hasAdvancementsForLevel: isAdvancementsForLevelInItem(\n          getLevelByDropType($actorInGame, item.type === \"characterClass\" ? \"class\" : item.type),\n          newStoreItem\n        ),\n      });\n    }\n  }\n\n  // Start processing the queue once all items are added\n  await dropItemRegistry.advanceQueue(true);\n  // After the queue is advanced, trigger the state machine event for post-queue processing\n  const fsm = getWorkflowFSM();\n  fsm.handle(WORKFLOW_EVENTS.QUEUE_PROCESSED);\n}\n\n/**\n * Checks if an actor is a spellcaster by examining their classes and spellcasting capabilities\n * @param {Object} actor - The actor document to check\n * @returns {boolean} True if the actor is a spellcaster, false otherwise\n */\nexport function checkIfSpellcaster(actor) {\n  window.GAS.log.d('[WORKFLOW] Checking if actor is a spellcaster:', actor?.id);\n  if (!actor) {\n    window.GAS.log.w('[WORKFLOW] No actor found');\n    return false;\n  }\n  \n  const classes = actor.classes || {};\n  if (!Object.keys(classes).length) {\n    window.GAS.log.w('[WORKFLOW] No classes found on actor');\n    return false;\n  }\n  \n  // Iterate through each class and check if any have spellcasting progression !== \"none\"\n  const isSpellcaster = Object.values(classes).some(cls => {\n    const progression = cls.system?.spellcasting?.progression;\n    window.GAS.log.d('[WORKFLOW] Checking class:', cls.name, 'progression:', progression);\n    return progression && progression !== \"none\";\n  });\n\n  window.GAS.log.d('[WORKFLOW] Actor is spellcaster:', isSpellcaster);\n  return isSpellcaster;\n}\n\n/**\n * Handles finalizing spell selection\n * @param {Object} params - Parameters object\n * @param {Object} params.stores - Store references\n * @param {Function} params.setProcessing - Function to set processing state\n * @returns {Promise<void>}\n */\nexport async function handleFinalizeSpells({\n  stores,\n  setProcessing\n}) {\n  const {\n    actorInGame,\n    isLevelUp\n  } = stores;\n\n  const $actorInGame = get(actorInGame);\n  const $isLevelUp = get(isLevelUp);\n  const progress = get(spellProgress);\n\n  // Prevent multiple clicks\n  if (setProcessing) {\n    setProcessing(true);\n  }\n\n  if (!$actorInGame) {\n    ui.notifications.error(\"No active character found\");\n    if (setProcessing) setProcessing(false);\n    return;\n  }\n\n  try {\n    // Guard: if selection isn't complete, do not advance or error the FSM\n    if (!progress?.isComplete) {\n      ui.notifications.warn(\"Please complete your spell selection before finalizing\");\n      if (setProcessing) setProcessing(false);\n      return;\n    }\n\n    // If no updates are needed (e.g., level-up gained no new spells), just complete the workflow\n    if (progress?.noUpdatesNeeded || ((progress?.limits?.cantrips || 0) + (progress?.limits?.spells || 0)) === 0) {\n      // NEW: If the user actually selected spells, we still need to create them.\n      let selectionCount = 0;\n      try {\n        const sel = get(selectedSpells);\n        selectionCount = sel && typeof sel.size === 'number' ? sel.size : 0;\n      } catch {}\n\n      if (selectionCount > 0) {\n        // Proceed with finalization to add the selected spells\n        const success = await finalizeSpellSelection($actorInGame);\n        if (success) {\n          ui.notifications.info(\"Spells added successfully\");\n          if ($isLevelUp) {\n            const levelUpFSM = getLevelUpFSM();\n            const currentState = levelUpFSM.getCurrentState();\n            window.GAS.log.d('[LEVELUP WORKFLOW] Current state before spells_complete:', currentState);\n            window.GAS.log.d('[LEVELUP WORKFLOW] Event to handle:', LEVELUP_EVENTS.SPELLS_COMPLETE);\n            if (currentState !== 'completed') {\n              levelUpFSM.handle(LEVELUP_EVENTS.SPELLS_COMPLETE);\n            } else {\n              window.GAS.log.d('[LEVELUP WORKFLOW] FSM already in completed state, skipping spells_complete event');\n            }\n          } else {\n            const fsm = getWorkflowFSM();\n            const currentState = fsm.getCurrentState();\n            window.GAS.log.d('[WORKFLOW] Current state before spells_complete:', currentState);\n            window.GAS.log.d('[WORKFLOW] Event to handle:', WORKFLOW_EVENTS.SPELLS_COMPLETE);\n            fsm.handle(WORKFLOW_EVENTS.SPELLS_COMPLETE);\n          }\n          if (setProcessing) setProcessing(false);\n          return;\n        } else {\n          // finalizeSpellSelection already warned the user (e.g., no spells selected)\n          if (setProcessing) setProcessing(false);\n          return;\n        }\n      }\n\n      // Make the spells tab readonly\n      readOnlyTabs.update(tabs => tabs.includes('spells') ? tabs : [...tabs, 'spells']);\n\n      // Advance the appropriate FSM without attempting to add spells\n      if ($isLevelUp) {\n        const levelUpFSM = getLevelUpFSM();\n        const currentState = levelUpFSM.getCurrentState();\n        window.GAS.log.d('[LEVELUP WORKFLOW] FinalizeSpells: no updates needed. Current state:', currentState);\n        if (currentState !== 'completed') levelUpFSM.handle(LEVELUP_EVENTS.SPELLS_COMPLETE);\n      } else {\n        const fsm = getWorkflowFSM();\n        window.GAS.log.d('[WORKFLOW] FinalizeSpells: no updates needed. Current state:', fsm.getCurrentState());\n        fsm.handle(WORKFLOW_EVENTS.SPELLS_COMPLETE);\n      }\n      ui.notifications.info(\"Spell selection complete\");\n      if (setProcessing) setProcessing(false);\n      return;\n    }\n\n    // Use the imported spell finalization function\n    const success = await finalizeSpellSelection($actorInGame);\n    \n    if (success) {\n      ui.notifications.info(\"Spells added successfully\");\n      \n      // Use the correct FSM based on level-up mode\n      if ($isLevelUp) {\n        // Level-up mode: use LevelUp FSM\n        const levelUpFSM = getLevelUpFSM();\n        const currentState = levelUpFSM.getCurrentState();\n        window.GAS.log.d('[LEVELUP WORKFLOW] Current state before spells_complete:', currentState);\n        window.GAS.log.d('[LEVELUP WORKFLOW] Event to handle:', LEVELUP_EVENTS.SPELLS_COMPLETE);\n        \n        // Only send the event if we're not already in completed state\n        if (currentState !== 'completed') {\n          levelUpFSM.handle(LEVELUP_EVENTS.SPELLS_COMPLETE);\n        } else {\n          window.GAS.log.d('[LEVELUP WORKFLOW] FSM already in completed state, skipping spells_complete event');\n        }\n      } else {\n        // Character creation mode: use main workflow FSM\n        const fsm = getWorkflowFSM();\n        const currentState = fsm.getCurrentState();\n        window.GAS.log.d('[WORKFLOW] Current state before spells_complete:', currentState);\n        window.GAS.log.d('[WORKFLOW] Event to handle:', WORKFLOW_EVENTS.SPELLS_COMPLETE);\n        \n        fsm.handle(WORKFLOW_EVENTS.SPELLS_COMPLETE);\n      }\n    } else {\n      // Do not push the FSM into an error state for validation failures like \"No spells selected\".\n      // finalizeSpellSelection already surfaced a user-facing message when appropriate.\n      if (setProcessing) setProcessing(false);\n      return;\n    }\n  } catch (error) {\n    console.error(\"Error during spell finalization:\", error);\n    ui.notifications.error(\"An error occurred while adding spells\");\n    \n    // Use the correct FSM for error handling\n    if ($isLevelUp) {\n      const levelUpFSM = getLevelUpFSM();\n      const currentState = levelUpFSM.getCurrentState();\n      if (currentState !== 'error' && currentState !== 'completed') {\n        levelUpFSM.handle(LEVELUP_EVENTS.ERROR);\n      } else {\n        window.GAS.log.d('[LEVELUP WORKFLOW] FSM in terminal state, skipping error event');\n      }\n    } else {\n      const currentState = getWorkflowFSM().getCurrentState();\n      if (currentState !== 'error') {\n        getWorkflowFSM().handle(WORKFLOW_EVENTS.ERROR);\n      }\n    }\n  }\n  \n  if (setProcessing) setProcessing(false);\n}\n\n/**\n * Handles spell selection completion in LevelUp workflow\n */\nexport async function handleSpellsCompleteLevelUp() {\n  window.GAS.log.d('[LEVELUP WORKFLOW] Handling spells completion');\n  \n  try {\n    const levelUpFSM = getLevelUpFSM();\n    levelUpFSM.handle(LEVELUP_EVENTS.SPELLS_COMPLETE);\n    \n    window.GAS.log.d('[LEVELUP WORKFLOW] Spells completion handled successfully');\n    return true;\n    \n  } catch (error) {\n    window.GAS.log.e('[LEVELUP WORKFLOW] Error handling spells completion:', error);\n    const levelUpFSM = getLevelUpFSM();\n    levelUpFSM.handle(LEVELUP_EVENTS.ERROR, { error: error.message });\n    return false;\n  }\n}\n\n/**\n * Handles skipping spell selection in LevelUp workflow\n */\nexport async function handleSkipSpellsLevelUp() {\n  window.GAS.log.d('[LEVELUP WORKFLOW] Handling skip spells');\n  \n  try {\n    const levelUpFSM = getLevelUpFSM();\n    levelUpFSM.handle(LEVELUP_EVENTS.SKIP_SPELLS);\n    \n    window.GAS.log.d('[LEVELUP WORKFLOW] Skip spells handled successfully');\n    return true;\n    \n  } catch (error) {\n    window.GAS.log.e('[LEVELUP WORKFLOW] Error handling skip spells:', error);\n    const levelUpFSM = getLevelUpFSM();\n    levelUpFSM.handle(LEVELUP_EVENTS.ERROR, { error: error.message });\n    return false;\n  }\n}\n\n/**\n * Handles what to do when advancements are complete (was handleEmptyQueue/closeOrEquip)\n * Decides which workflow state to transition to next, based on settings and actor\n * @param {object} context - Finity workflow context (should include actor)\n * @returns {string} The next state name for the FSM\n */\nexport async function handleAdvancementCompletion(context) {\n  const { actor } = context;\n  const enableEquipment = game.settings.get(MODULE_ID, 'enableEquipmentSelection');\n  const enableShop = game.settings.get(MODULE_ID, 'enableEquipmentPurchase');\n  const enableSpells = game.settings.get(MODULE_ID, 'enableSpellSelection');\n\n  // Helper to check if actor is a spellcaster\n  function isSpellcaster(actor) {\n    if (!actor) return false;\n    const classes = actor.classes || {};\n    return Object.values(classes).some(cls => {\n      const progression = cls.system?.spellcasting?.progression;\n      return progression && progression !== 'none';\n    });\n  }\n\n  const spellcaster = isSpellcaster(actor);\n  console.log('[GAS][handleAdvancementCompletion] enableEquipment:', enableEquipment, 'enableShop:', enableShop, 'enableSpells:', enableSpells, 'isSpellcaster:', spellcaster, 'actor:', actor?.name, actor);\n\n  if (!enableEquipment && !enableShop && !enableSpells) {\n    console.log('[GAS][handleAdvancementCompletion] All features disabled, returning completed');\n    return 'completed';\n  }\n  if (enableEquipment) {\n    console.log('[GAS][handleAdvancementCompletion] Equipment enabled, returning selecting_equipment');\n    return 'selecting_equipment';\n  }\n  if (enableShop) {\n    console.log('[GAS][handleAdvancementCompletion] Shop enabled, returning shopping');\n    return 'shopping';\n  }\n  if (enableSpells && spellcaster) {\n    console.log('[GAS][handleAdvancementCompletion] Spells enabled and actor is spellcaster, returning selecting_spells');\n    return 'selecting_spells';\n  }\n  console.log('[GAS][handleAdvancementCompletion] Fallback, returning completed');\n  return 'completed';\n}\n\n\n","import { writable, get } from 'svelte/store';\nimport { MODULE_ID } from '~/src/helpers/constants';\nimport { activeTab, tabs, readOnlyTabs } from '~/src/stores/index';\nimport { compatibleStartingEquipment } from '~/src/stores/startingEquipment';\nimport { preAdvancementSelections, dropItemRegistry } from '~/src/stores/index';\nimport { actorInGame } from '~/src/stores/storeDefinitions';\nimport { handleAdvancementCompletion } from '~/src/lib/workflow.js';\nimport { destroyAdvancementManagers } from '~/src/helpers/AdvancementManager';\nimport Finity from 'finity';\n\n/**\n * Character creation workflow states\n */\nexport const WORKFLOW_STATES = {\n  IDLE: 'idle',\n  CREATING_CHARACTER: 'creating_character',\n  PROCESSING_ADVANCEMENTS: 'processing_advancements',\n  SELECTING_EQUIPMENT: 'selecting_equipment',\n  SELECTING_SPELLS: 'selecting_spells',\n  SHOPPING: 'shopping',\n  COMPLETED: 'completed',\n  ERROR: 'error'\n};\n\n/**\n * Workflow events that can trigger state transitions\n */\nexport const WORKFLOW_EVENTS = {\n  START_CHARACTER_CREATION: 'start_character_creation',\n  CHARACTER_CREATED: 'character_created',\n  ADVANCEMENTS_COMPLETE: 'advancements_complete',\n  EQUIPMENT_COMPLETE: 'equipment_complete',\n  SPELLS_COMPLETE: 'spells_complete',\n  SHOPPING_COMPLETE: 'shopping_complete',\n  SKIP_EQUIPMENT: 'skip_equipment',\n  SKIP_SPELLS: 'skip_spells',\n  SKIP_SHOPPING: 'skip_shopping',\n  ERROR: 'error',\n  RESET: 'reset',\n  QUEUE_PROCESSED: 'queue_processed', // <-- Added new event for post-queue processing\n};\n\n/**\n * Shared workflow context for Finity FSM\n */\nexport const workflowFSMContext = {\n  isProcessing: writable(false),\n  _shouldShowEquipmentSelection: function () {\n    const enableEquipmentSelection = game.settings.get(MODULE_ID, 'enableEquipmentSelection');\n    if (!enableEquipmentSelection) return false;\n    const preSelections = get(preAdvancementSelections);\n    if (!preSelections || Object.keys(preSelections).length === 0 || !preSelections.class || !preSelections.class.system || !preSelections.class.system.startingEquipment || preSelections.class.system.startingEquipment.length === 0 || preSelections.class.system.wealth === undefined) return false;\n    const compatibleEquipment = get(compatibleStartingEquipment);\n    return compatibleEquipment.length > 0;\n  },\n  _shouldShowSpellSelection: function (inGameActor) {\n    const enableSpellSelection = game.settings.get(MODULE_ID, 'enableSpellSelection');\n    if (!enableSpellSelection) return false;\n    \n    // Always prioritize the passed inGameActor parameter if it's provided and valid\n    let actorForDecision = inGameActor;\n    \n    // Only use context actors as fallback when inGameActor is not provided or is empty\n    if (!actorForDecision || (typeof actorForDecision === 'object' && Object.keys(actorForDecision).length === 0)) {\n      if (this?.preCreationActor) {\n        actorForDecision = this.preCreationActor;\n      } else if (this?.postCreationActor) {\n        actorForDecision = this.postCreationActor;\n      } else if (this?.actor) {\n        actorForDecision = this.actor;\n      }\n    }\n    \n    if (!actorForDecision) return false;\n    \n    // Check for spellcasting in multiple ways:\n    // 1. Class-based spellcasting (base classes like Wizard, Cleric)\n    // 2. Actor system spellcasting (granted through advancements like Eldritch Knight)\n    // 3. Known spellcasting subclasses (fallback for hardcoded detection)\n    \n    const classes = actorForDecision.classes || {};\n    const preSelections = get(preAdvancementSelections);\n    let classEntries = Object.entries(classes);\n    \n    // Fallback to the cached compendium class selection when the actor isn't created yet\n    if (!classEntries.length && preSelections?.class) {\n      classEntries = [[preSelections.class.system?.identifier || preSelections.class.name || 'selected-class', preSelections.class]];\n    }\n    \n    if (!classEntries.length) {\n      window.GAS.log.d('[WORKFLOW] No classes available (actor or pre-selection), returning false for spellcaster check');\n      return false;\n    }\n    \n    const classDataList = classEntries.map(([, classData]) => classData).filter(Boolean);\n    const classNamesLower = classDataList\n      .map((classData) => (classData?.system?.identifier || classData?.name || '').toLowerCase())\n      .filter(Boolean);\n    \n    // Method 1: Check class-based spellcasting progression\n    // This is the PRIMARY check - if any class has spellcasting progression, the actor is a spellcaster\n    const spellcastingInfo = classDataList.map((classData) => {\n      const progression = classData?.system?.spellcasting?.progression;\n      return { \n        className: classData?.name || classData?.system?.identifier || 'unknown-class',\n        identifier: classData?.system?.identifier,\n        progression,\n        isSpellcaster: progression && progression !== \"none\"\n      };\n    });\n    \n    const hasClassSpellcasting = spellcastingInfo.some(info => info.isSpellcaster);\n    \n    // Check if ANY class explicitly has progression: \"none\" - if so, skip actor-level checks entirely\n    const hasExplicitNonSpellcaster = spellcastingInfo.some(info => info.progression === \"none\");\n    \n    // DEBUG: Log spellcasting info to understand what we're detecting\n    window.GAS.log.d('[WORKFLOW] Spellcasting info check:', {\n      spellcastingInfo,\n      hasClassSpellcasting,\n      hasExplicitNonSpellcaster,\n      classNamesLower\n    });\n    \n    // Method 2: Check actor system spellcasting (granted through advancements)\n    // Only check this if:\n    // 1. NO class has spellcasting progression, AND\n    // 2. NO class explicitly has progression: \"none\" (for cases like Eldritch Knight where Fighter has no progression but subclass grants it)\n    const actorData = actorForDecision.system || actorForDecision.data?.data;\n    \n    let hasActorSpellcasting = false;\n    let hasTraditionalSpellcasting = false;\n    let hasSpellSlots = false;\n    let hasPactMagic = false;\n    \n    // Only check actor-level spellcasting if no class has spellcasting AND no class explicitly says \"none\"\n    // This prevents false positives where non-spellcasters have empty/default spell slot structures\n    if (!hasClassSpellcasting && !hasExplicitNonSpellcaster) {\n      // Check for traditional spellcasting system\n      hasTraditionalSpellcasting = actorData?.spellcasting && Object.keys(actorData.spellcasting).length > 0;\n      \n      // Check for spell slots added by advancements (like Eldritch Knight)\n      hasSpellSlots = actorData?.spells && Object.values(actorData.spells || {}).some(slot => \n        slot && slot.type === 'spell' && slot.max > 0\n      );\n      \n      // Check for pact magic slots (only count if they have max > 0 and actor has Warlock class)\n      // DEBUG: Log what we're actually checking to understand why hasPactMagic might be true\n      window.GAS.log.d('[WORKFLOW] Checking for pact magic:', {\n        hasSpells: !!actorData?.spells,\n        spellsType: typeof actorData?.spells,\n        spellsIsArray: Array.isArray(actorData?.spells),\n        spellsValue: actorData?.spells,\n        spellsKeys: actorData?.spells && typeof actorData.spells === 'object' ? Object.keys(actorData.spells) : 'N/A',\n        spellsValues: actorData?.spells && typeof actorData.spells === 'object' ? Object.values(actorData.spells) : 'N/A',\n        classNamesLower,\n        hasWarlock: classNamesLower.includes('warlock')\n      });\n      \n      hasPactMagic = actorData?.spells && \n        typeof actorData.spells === 'object' && \n        !Array.isArray(actorData.spells) &&\n        Object.values(actorData.spells).some(slot => \n          slot && typeof slot === 'object' && slot.type === 'pact' && slot.max > 0\n        ) && \n        classNamesLower.includes('warlock');\n      \n      hasActorSpellcasting = hasTraditionalSpellcasting || hasSpellSlots || hasPactMagic;\n    }\n    \n    // Method 3: Fallback check for known spellcasting classes/subclasses\n    const knownSpellcastingClasses = [\n      'bard', 'cleric', 'druid', 'paladin', 'ranger', 'sorcerer', 'warlock', 'wizard',\n      'artificer', 'aberrantmind', 'arcanetrickster', 'eldritchknight'\n    ];\n    const hasKnownSpellcastingClass = classNamesLower.some(className => \n      knownSpellcastingClasses.includes(className)\n    );\n    \n    // Method 4: Check for subclass spellcasting that might be granted through advancements\n    // This is a more aggressive check for cases where the actor system hasn't been updated yet\n    const hasSubclassSpellcasting = classNamesLower.some(lowerClassName => {\n      // Check for known spellcasting subclasses\n      return ['eldritchknight', 'arcanetrickster', 'aberrantmind'].includes(lowerClassName);\n    });\n    \n    // Method 5: Check for subclass in the class data itself (e.g., fighter with eldritchknight subclass)\n    const hasSubclassInClassData = classDataList.some(classData => {\n      const subclass = classData?.system?.subclass;\n      return subclass && ['eldritchknight', 'arcanetrickster', 'aberrantmind'].includes(subclass.toLowerCase());\n    });\n    \n    const isSpellcaster = hasClassSpellcasting || hasActorSpellcasting || hasKnownSpellcastingClass || hasSubclassSpellcasting || hasSubclassInClassData;\n    \n    window.GAS.log.d('[WORKFLOW] Spellcasting detection:', {\n      spellcastingInfo,\n      classNamesLower,\n      hasClassSpellcasting,\n      hasExplicitNonSpellcaster,\n      hasTraditionalSpellcasting,\n      hasSpellSlots,\n      hasPactMagic,\n      hasActorSpellcasting,\n      hasKnownSpellcastingClass,\n      hasSubclassSpellcasting,\n      hasSubclassInClassData,\n      isSpellcaster,\n      actorName: actorForDecision.name,\n      actorDataSpells: actorData?.spells,\n      actorDataSpellsType: typeof actorData?.spells,\n      actorDataSpellsExists: !!actorData?.spells\n    });\n    \n    return isSpellcaster;\n  },\n  _shouldShowShopping: function () {\n    const enableShopping = game.settings.get(MODULE_ID, 'enableEquipmentPurchase');\n    return enableShopping;\n  },\n  actor: undefined,\n};\n\n/**\n * Finity-based state machine for character creation workflow\n */\nexport function createWorkflowStateMachine() {\n  const fsm = Finity\n    .configure()\n    .initialState('idle')\n    .state('idle')\n    .on('start_character_creation').transitionTo('creating_character')\n    .on('reset').transitionTo('idle')\n    .onEnter((context) => {\n      if (workflowFSMContext.isProcessing) workflowFSMContext.isProcessing.set(false);\n      \n      // Destroy advancement managers when returning to idle\n      try {\n        destroyAdvancementManagers();\n      } catch (error) {\n        window.GAS.log.e('[WORKFLOW] Error destroying advancement managers on idle:', error);\n      }\n    })\n    .state('creating_character')\n    .on('character_created').transitionTo('processing_advancements')\n    .on('error').transitionTo('error')\n    .on('reset').transitionTo('idle')\n    .onEnter((context) => {\n      if (workflowFSMContext.isProcessing) workflowFSMContext.isProcessing.set(true);\n      window.GAS.log.d('[WORKFLOW] Entered CREATING_CHARACTER state');\n    })\n    .state('processing_advancements')\n      .do(async (state, context) => {\n        if (workflowFSMContext.isProcessing) workflowFSMContext.isProcessing.set(true);\n        window.GAS.log.d('[WORKFLOW] Entered PROCESSING_ADVANCEMENTS state');\n        // Process advancement queue asynchronously\n        await dropItemRegistry.advanceQueue(true);\n        // After queue completes, restore the actor's original sheetClass if we set a temporary one\n        try {\n          const actor = workflowFSMContext.actor;\n          if (actor) {\n            const originalSheet = await actor.getFlag(MODULE_ID, 'originalSheetClass');\n            if (originalSheet !== undefined) {\n              await actor.setFlag('core', 'sheetClass', originalSheet);\n              // Clear our module flag to avoid future confusion\n              await actor.unsetFlag(MODULE_ID, 'originalSheetClass');\n            }\n          }\n        } catch (e) {\n          window.GAS?.log?.w?.('[WORKFLOW] Failed to restore original sheetClass after queue', e);\n        }\n      })\n        .onSuccess()\n          .transitionTo('selecting_equipment').withCondition((context) => workflowFSMContext._shouldShowEquipmentSelection())\n          .transitionTo('shopping').withCondition((context) => !workflowFSMContext._shouldShowEquipmentSelection() && workflowFSMContext._shouldShowShopping())\n          .transitionTo('selecting_spells').withCondition((context) => !workflowFSMContext._shouldShowEquipmentSelection() && !workflowFSMContext._shouldShowShopping() && workflowFSMContext._shouldShowSpellSelection(workflowFSMContext.actor))\n          .transitionTo('completed') // Default fallback - no other features enabled\n        .onFailure().transitionTo('error')\n      .on('reset').transitionTo('idle')\n      .on('error').transitionTo('error')\n    .state('selecting_equipment')\n    .on('equipment_complete')\n      .transitionTo('shopping').withCondition((context) => {\n        const shouldShow = workflowFSMContext._shouldShowShopping();\n        window.GAS.log.d('[FSM] equipment_complete -> shopping condition:', shouldShow);\n        return shouldShow;\n      })\n      .transitionTo('selecting_spells').withCondition((context) => {\n        const shouldShow = !workflowFSMContext._shouldShowShopping() && workflowFSMContext._shouldShowSpellSelection(workflowFSMContext.actor);\n        window.GAS.log.d('[FSM] equipment_complete -> selecting_spells condition:', shouldShow);\n        return shouldShow;\n      })\n      .transitionTo('completed') // Default fallback\n    .on('shopping_complete')\n      .transitionTo('selecting_spells').withCondition((context) => {\n        // Use the persisted actor from actorInGame store instead of workflowFSMContext.actor\n        const currentActor = get(actorInGame);\n        // Fallback to context actor if store is empty (useful for tests and edge cases)\n        const actorToCheck = currentActor || workflowFSMContext.actor;\n        const shouldShow = workflowFSMContext._shouldShowSpellSelection(actorToCheck);\n        window.GAS.log.d('[FSM] shopping_complete (from selecting_equipment) -> selecting_spells condition:', shouldShow);\n        return shouldShow;\n      })\n      .transitionTo('completed') // Default fallback when spell selection is not needed\n    .on('skip_equipment')\n      .transitionTo('shopping').withCondition((context) => workflowFSMContext._shouldShowShopping())\n      .transitionTo('selecting_spells').withCondition((context) => !workflowFSMContext._shouldShowShopping() && workflowFSMContext._shouldShowSpellSelection(workflowFSMContext.actor))\n      .transitionTo('completed') // Default fallback\n    .on('error').transitionTo('error')\n    .on('reset').transitionTo('idle')\n    .onEnter((context) => {\n      if (workflowFSMContext.isProcessing) workflowFSMContext.isProcessing.set(false);\n      window.GAS.log.d('[WORKFLOW] Entered SELECTING_EQUIPMENT state');\n      \n      // Destroy advancement managers if advancement capture is disabled\n      const disableAdvancementCapture = game.settings.get(MODULE_ID, 'disableAdvancementCapture');\n      if (disableAdvancementCapture) {\n        try {\n          destroyAdvancementManagers();\n        } catch (error) {\n          window.GAS.log.e('[WORKFLOW] Error destroying advancement managers:', error);\n        }\n      }\n      \n      Hooks.call('gas.equipmentSelection', workflowFSMContext.actor);\n    })\n    .state('shopping')\n    .on('shopping_complete')\n      .transitionTo('selecting_spells').withCondition((context) => {\n        // Use the persisted actor from actorInGame store instead of workflowFSMContext.actor\n        const currentActor = get(actorInGame);\n        // Fallback to context actor if store is empty (useful for tests and edge cases)\n        const actorToCheck = currentActor || workflowFSMContext.actor;\n        const shouldShow = workflowFSMContext._shouldShowSpellSelection(actorToCheck);\n        window.GAS.log.d('[FSM] shopping_complete -> selecting_spells condition (using actorInGame):', shouldShow);\n        return shouldShow;\n      })\n      .transitionTo('completed') // Default fallback when spell selection is not needed\n    .on('skip_shopping')\n      .transitionTo('selecting_spells').withCondition((context) => {\n        const currentActor = get(actorInGame);\n        // Fallback to context actor if store is empty (useful for tests and edge cases)\n        const actorToCheck = currentActor || workflowFSMContext.actor;\n        const shouldShow = workflowFSMContext._shouldShowSpellSelection(actorToCheck);\n        window.GAS.log.d('[FSM] skip_shopping -> selecting_spells condition (using actorInGame):', shouldShow);\n        return shouldShow;\n      })\n      .transitionTo('completed') // Default fallback when spell selection is not needed\n    .on('error').transitionTo('error')\n    .on('reset').transitionTo('idle')\n    .onEnter((context) => {\n      if (workflowFSMContext.isProcessing) workflowFSMContext.isProcessing.set(false);\n      window.GAS.log.d('[WORKFLOW] Entered SHOPPING state');\n      // Add shop tab and switch to it\n      const currentTabs = get(tabs);\n      if (!currentTabs.find(t => t.id === \"shop\")) {\n        tabs.update(t => [...t, { label: \"Shop\", id: \"shop\", component: \"ShopTab\" }]);\n      }\n      activeTab.set(\"shop\");\n      const currentReadOnlyTabs = get(readOnlyTabs);\n      if (!currentReadOnlyTabs.includes(\"equipment\")) {\n        readOnlyTabs.update(current => [...current, \"equipment\"]);\n      }\n      const totalGoldFromChoices = window.GAS?.totalGoldFromChoices;\n      const goldRoll = window.GAS?.goldRoll;\n      let goldValue;\n      // Check both version AND rules - only use new system for D&D 2024 rules\n      if (window.GAS.dnd5eVersion >= 4 && window.GAS.dnd5eRules === \"2024\") {\n        goldValue = totalGoldFromChoices ? get(totalGoldFromChoices) : 0;\n        window.GAS.log.d('[WORKFLOW] Using D&D 2024 rules - totalGoldFromChoices:', goldValue);\n      } else {\n        goldValue = goldRoll ? get(goldRoll) : 0;\n        window.GAS.log.d('[WORKFLOW] Using D&D 2014 rules - goldRoll:', goldValue);\n      }\n      const goldValueInCopper = goldValue * 100;\n      if (window.GAS && window.GAS.availableGold && typeof window.GAS.availableGold.set === 'function') {\n        window.GAS.availableGold.set(goldValueInCopper);\n      }\n    })\n    .state('selecting_spells')\n    .on('spells_complete').transitionTo('completed')\n    .on('skip_spells').transitionTo('completed')\n    .on('error').transitionTo('error')\n    .on('reset').transitionTo('idle')\n    .onEnter((context) => {\n      if (workflowFSMContext.isProcessing) workflowFSMContext.isProcessing.set(false);\n      window.GAS.log.d('[WORKFLOW] Entered SELECTING_SPELLS state');\n      \n      // Double-check that actor is actually a spellcaster before adding spell tab\n      const actor = workflowFSMContext.actor || get(actorInGame);\n      const isSpellcaster = workflowFSMContext._shouldShowSpellSelection(actor);\n      window.GAS.log.d('[WORKFLOW] Verifying spellcaster status in onEnter:', { isSpellcaster, actorName: actor?.name });\n      \n      if (isSpellcaster) {\n        const currentTabs = get(tabs);\n        if (!currentTabs.find(t => t.id === \"spells\")) {\n          tabs.update(t => [...t, { label: \"Spells\", id: \"spells\", component: \"Spells\" }]);\n        }\n        activeTab.set(\"spells\");\n      } else {\n        window.GAS.log.w('[WORKFLOW] Actor is not a spellcaster but entered selecting_spells state - transitioning to completed');\n        // If we somehow entered this state for a non-spellcaster, immediately skip to completed\n        const fsm = getWorkflowFSM();\n        fsm.handle(WORKFLOW_EVENTS.SKIP_SPELLS);\n      }\n    })\n    .state('completed')\n    .on('reset').transitionTo('idle')\n    .onEnter((context) => {\n      if (workflowFSMContext.isProcessing) workflowFSMContext.isProcessing.set(false);\n      window.GAS.log.d('[WORKFLOW] Entered COMPLETED state');\n      \n      // Destroy advancement managers\n      try {\n        destroyAdvancementManagers();\n      } catch (error) {\n        window.GAS.log.e('[WORKFLOW] Error destroying advancement managers on completed:', error);\n      }\n      \n      const { actor } = workflowFSMContext;\n      if (actor) {\n        window.GAS.log.d('[WORKFLOW] Opening actor sheet for:', actor.name);\n        actor.sheet.render(true);\n      }\n      setTimeout(() => {\n        window.GAS.log.d('[WORKFLOW] Closing Actor Studio');\n        Hooks.call(\"gas.close\");\n      }, 1500);\n    })\n    .state('error')\n    .on('reset').transitionTo('idle')\n    .onEnter((context) => {\n      if (workflowFSMContext.isProcessing) workflowFSMContext.isProcessing.set(false);\n      window.GAS.log.e('[WORKFLOW] Entered ERROR state:', context.error);\n      if (context.error) ui.notifications.error(context.error);\n    })\n    .start();\n  return fsm;\n}\n\n// Provide a getter for the singleton FSM instance\nlet workflowFSM;\nexport function getWorkflowFSM() {\n  if (!workflowFSM) {\n    workflowFSM = createWorkflowStateMachine();\n    // Expose the FSM on window.GAS for debugging\n    if (typeof window !== 'undefined') {\n      window.GAS = window.GAS || {};\n      window.GAS.workflowFSM = workflowFSM;\n      console.log('window.GAS.workflowFSM assigned:', window.GAS.workflowFSM);\n    }\n  }\n  return workflowFSM;\n}\n\n// Only export the Finity-based FSM and context\nexport default {\n  createWorkflowStateMachine,\n  getWorkflowFSM,\n  workflowFSMContext,\n  WORKFLOW_STATES,\n  WORKFLOW_EVENTS,\n  getEquipmentCompletionEvent\n};\n\n// In AdvancementManager.js or wherever you use the FSM:\n// import { workflowFSMContext } from '~/src/helpers/WorkflowStateMachine';\n// import { createWorkflowStateMachine, WORKFLOW_EVENTS } from '~/src/helpers/WorkflowStateMachine';\n// const workflowFSM = createWorkflowStateMachine();\n//\n// When handling an event, always pass the shared context and any new data:\n// workflowFSM.handle(WORKFLOW_EVENTS.ADVANCEMENTS_COMPLETE, { ...workflowFSMContext, actor: currentActor });\n//\n// This ensures all state actions have access to the required context and stores.\n\n/**\n * Determines the appropriate completion event for equipment selection\n * Based on the state machine logic in selecting_equipment state\n * @param {Object} context - The workflow context containing actor and other data\n * @param {boolean} skipCondition - Whether to skip equipment (not used currently)\n * @returns {string} The event name to trigger ('equipment_complete' or 'skip_equipment')\n */\nexport function getEquipmentCompletionEvent(context, skipCondition = false) {\n  // For now, always return 'equipment_complete' since we're completing equipment selection\n  // The state machine will handle the conditional transitions based on settings\n  return skipCondition ? 'skip_equipment' : 'equipment_complete';\n}\n","import { get } from 'svelte/store';\nimport { activeTab, tabs } from '~/src/stores/index';\nimport { MODULE_ID } from '~/src/helpers/constants';\nimport { delay, prepareItemForDrop, dropItemOnCharacter } from '~/src/helpers/Utility';\nimport { compatibleStartingEquipment } from '~/src/stores/startingEquipment';\nimport { goldRoll } from '~/src/stores/storeDefinitions';\nimport { preAdvancementSelections, actorInGame } from '~/src/stores/index';\nimport { getWorkflowFSM, WORKFLOW_EVENTS } from '~/src/helpers/WorkflowStateMachine';\n\n/**\n * Class responsible for monitoring and managing the advancement process\n */\nexport class AdvancementManager {\n  constructor(store, inProcessStore, getPanel) {\n    this.store = store;\n    this.inProcessStore = inProcessStore;\n    this.monitoringPromise = null;\n    // Allow injection of a custom DOM query function for testability\n    this._getPanel = getPanel || (() => {\n      if (typeof $ !== 'function') return null;\n      return $('#foundryvtt-actor-studio-pc-sheet .window-content main section.a .tab-content .container .content');\n    });\n  }\n\n  /**\n   * Checks if the advancement (or other tab) content is currently empty\n   * @returns {boolean} Whether the content is empty\n   */\n  isTabContentEmpty(tabName = 'advancements') {\n    // Guard: activeTab must be a Svelte store\n    if (!activeTab || typeof get !== 'function') return false;\n    let currentTab;\n    try {\n      currentTab = get(activeTab);\n    } catch (e) {\n      return false;\n    }\n    if (currentTab !== tabName) {\n      return false;\n    }\n    // Use injected or default DOM query function\n    const panel = this._getPanel();\n    if (!panel || typeof panel.html !== 'function') {\n      return false;\n    }\n    return !Boolean(panel.html()?.trim());\n  }\n\n  checkTabContent(resolve, tabName = 'advancements', timeout = 600) {\n    if (this.isTabContentEmpty(tabName)) {\n      resolve();\n    } else {\n      // Automated advancement clicking in debug mode\n      if (window.GAS?.debug) {\n        this.autoAdvanceSteps();\n      }\n      setTimeout(() => this.checkTabContent(resolve, tabName, timeout), timeout);\n    }\n  };\n\n  /**\n   * Automatically advance through advancement dialog steps when in debug mode\n   * Finds and clicks \"next\" buttons, then \"complete\" buttons to speed up debug iteration\n   */\n  autoAdvanceSteps() {\n    // Only run automation in debug mode\n    if (!window.GAS || !window.GAS.debug) {\n      return;\n    }\n    \n    try {\n      const panel = this._getPanel();\n      if (!panel || !panel.length) return;\n\n      // Look for advancement dialogs within the captured area\n      const advancementDialogs = panel.find('.gas-advancements');\n      \n      advancementDialogs.each((index, dialog) => {\n        const $dialog = $(dialog);\n        \n        // First, try to find and click \"next\" buttons\n        const nextButton = $dialog.find('[data-action=\"next\"]').first();\n        if (nextButton.length && !nextButton.prop('disabled')) {\n          window.GAS.log.d('[AUTO-ADVANCE] Clicking next button in dialog', index);\n          nextButton.click();\n          return; // Exit early after clicking next\n        }\n        \n        // If no next button, look for \"complete\" button\n        const completeButton = $dialog.find('[data-action=\"complete\"]').first();\n        if (completeButton.length && !completeButton.prop('disabled')) {\n          window.GAS.log.d('[AUTO-ADVANCE] Clicking complete button in dialog', index);\n          completeButton.click();\n          return; // Exit early after clicking complete\n        }\n        \n        // If no data-action buttons found, try common button text patterns\n        const buttons = $dialog.find('button').filter(function() {\n          const text = $(this).text().toLowerCase().trim();\n          return text.includes('next') || text.includes('continue') || text.includes('complete') || text.includes('finish');\n        });\n        \n        if (buttons.length) {\n          const enabledButton = buttons.filter(':not(:disabled)').first();\n          if (enabledButton.length) {\n            window.GAS.log.d('[AUTO-ADVANCE] Clicking text-based button:', enabledButton.text().trim());\n            enabledButton.click();\n          }\n        }\n      });\n    } catch (error) {\n      window.GAS.log.e('[AUTO-ADVANCE] Error in autoAdvanceSteps:', error);\n    }\n  }\n\n  /**\n   * Waits for the advancement panel to become empty\n   * @returns {Promise} A promise that resolves when the panel is empty\n   */\n  waitForEmptyTab(tabName = 'advancements') {\n    // Return existing promise if already monitoring\n    if (this.monitoringPromise) {\n      return this.monitoringPromise;\n    }\n\n    // Create new monitoring promise\n    this.monitoringPromise = new Promise(resolve => {\n      this.checkTabContent(() => {\n        resolve();\n        // Reset promise after a brief delay to ensure all concurrent calls complete\n        setTimeout(() => {\n          this.monitoringPromise = null;\n        }, 10);\n      }, tabName);\n    });\n\n    return this.monitoringPromise;\n  }\n\n  /**\n   * Monitors the queue for advancements and closes the advancement manager when the queue is empty\n   * Also starts the equipment selection process when the queue is empty if that's enabled, passing \n   * off the close responsibility to the equipment selection process\n   * @returns {Promise<void>}\n   */\n  async watchAdvancementManager() {\n    await delay(game.settings.get(MODULE_ID, 'advancementCaptureTimerThreshold')); //- delay to allow for the items to be dropped\n\n    //- if advancements are enabled handle advancement capture\n    if (!game.settings.get(MODULE_ID, 'disableAdvancementCapture')) {\n      window.GAS.log.d('[ADVANCEMENT MANAGER] waiting for advancements tab to be empty');\n      await this.waitForEmptyTab('advancements');\n      window.GAS.log.d('[ADVANCEMENT MANAGER] advancements tab is empty');\n      \n      // Remove the advancement tab after it becomes empty\n      this.removeAdvancementTab();\n      \n      this.monitoringPromise = null;\n    }\n    // Just return after monitoring - the advanceQueue loop will handle the next item\n    return;\n  }\n\n  /**\n   * Removes the advancement tab from the UI after advancement processing is complete\n   */\n  removeAdvancementTab() {\n    try {\n      const currentTabs = get(tabs);\n      const advancementTabIndex = currentTabs.findIndex(tab => tab.id === 'advancements');\n      \n      if (advancementTabIndex !== -1) {\n        window.GAS.log.d('[ADVANCEMENT MANAGER] removing advancement tab');\n        \n        // Remove the advancement tab\n        tabs.update(tabArray => tabArray.filter(tab => tab.id !== 'advancements'));\n        \n        // If advancement tab was active, switch to the first available tab\n        const currentActiveTab = get(activeTab);\n        if (currentActiveTab === 'advancements') {\n          const updatedTabs = get(tabs);\n          if (updatedTabs.length > 0) {\n            activeTab.set(updatedTabs[0].id);\n            window.GAS.log.d('[ADVANCEMENT MANAGER] switched active tab to', updatedTabs[0].id);\n          }\n        }\n      }\n    } catch (error) {\n      window.GAS.log.e('[ADVANCEMENT MANAGER] error removing advancement tab:', error);\n    }\n  }\n\n\n  /**\n   * Handles the case when the queue is empty\n   */\n  handleEmptyQueue() {\n    window.GAS.log.d('[ADVANCEMENT MANAGER] handleEmptyQueue')\n    const inGameActor = get(actorInGame);\n    const currentActor = inGameActor ? inGameActor : get(this.inProcessStore)?.actor;\n    this.inProcessStore.set(false);\n  }\n\n  /**\n   * Handles processing the next item in the queue\n   * @param {Object} next - The next item to process\n   * @returns {Promise<Object>} The result of processing the item\n   */\n  async handleNextItem(next) {\n    this.inProcessStore.set(next);\n    this.store.remove(next.id);\n    const item = await prepareItemForDrop(next);\n    const currentActor = get(this.inProcessStore)?.actor;\n    // window.GAS.log.d('[ADVANCEMENT MANAGER] handling next item', next);\n    // window.GAS.log.d('[ADVANCEMENT MANAGER] currentActor', currentActor);\n    \n    //- Drop Item on Actor\n    const result = await dropItemOnCharacter(currentActor, item);\n    return result;\n  }\n\n  /**\n   * Advances the queue to process all items\n   * Will open the Advancements tab if it's required and not already open\n   * @returns {Promise<boolean>}\n   */\n  async advanceQueue() {\n    window.GAS.log.d('[ADVANCEMENT MANAGER] advancing queue of length', get(this.store).length);\n    try {\n      \n      // Process all items in the queue\n      while (get(this.store).length > 0) {\n        const currentStore = get(this.store);\n        const next = currentStore[0];\n        \n        if (!next) {\n          break;\n        }\n  \n        //- handle next item\n        window.GAS.log.d('[ADVANCEMENT MANAGER] handling next item', next);\n        const result = await this.handleNextItem(next);\n  \n        //- set the advancement manager watcher for this item\n        window.GAS.log.d('[ADVANCEMENT MANAGER] setting advancement manager watcher');\n        await this.watchAdvancementManager();\n      }\n  \n      //- handle empty queue after processing all items\n      window.GAS.log.d('[ADVANCEMENT MANAGER] queue is empty, handling empty queue');\n      this.handleEmptyQueue();\n      return true;\n    } catch (error) {\n      return false\n    }\n  }\n} \n\n\n// Function to remove all elements with the specified class\nexport const destroyAdvancementManagers = () => {\n    // Select all elements with the class 'application dnd5e2 advancement manager'\n    const elements = document.querySelectorAll('.application.dnd5e2.advancement.manager');\n    console.log('destroyAdvancementManagers advancement managers', elements);\n    // Iterate over the NodeList and remove each element\n    elements.forEach(element => {\n        element.remove(); // Remove the element from the DOM\n    });\n}\n\n// Patch for test: always use injected getPanel if present, else fallback to global.$\n// This ensures test mocks are always respected\nexport function createTestAdvancementManager(store, inProcessStore, panelHtml = '', customGetPanel = null) {\n  if (customGetPanel) {\n    // Use the custom getPanel function directly\n    return new AdvancementManager(store, inProcessStore, customGetPanel);\n  }\n  \n  // Mock panel object with static content\n  const mockPanel = { html: () => panelHtml };\n  // Return AdvancementManager with injected getPanel\n  return new AdvancementManager(store, inProcessStore, () => mockPanel);\n}\n\nexport default {\n  AdvancementManager,\n  destroyAdvancementManagers\n};","import { writable, get, derived } from 'svelte/store';\nimport { AdvancementManager } from '~/src/helpers/AdvancementManager';\n\nexport const advancementQueueStore = () => {\n  const store = writable([]);\n  const inProcess = writable(false);\n  const { subscribe, set, update } = store;\n\n  const remove = (id) => update(apps => apps.filter(app => app.id !== id));\n  const expectedOrder = ['race', 'background', 'characterClass', 'characterSubClass'];\n\n  // Create the store object first\n  const storeObj = {\n    subscribe,\n    add: (app) => {\n      update(apps => {\n        const filteredApps = apps.filter(existingApp => existingApp.id !== app.id);\n        const newApps = [...filteredApps, app];\n        return newApps;\n      });\n    },\n    splice: (app) => {\n      update(apps => {\n        // Remove any existing instance of this item\n        const filteredApps = apps.filter(existingApp => existingApp.id !== app.id);\n\n        // Find the correct position based on expectedOrder\n        const appIndex = expectedOrder.indexOf(app.id);\n        if (appIndex === -1) {\n          // If not in expected order, just append\n          return [...filteredApps, app];\n        }\n\n        // Find the insertion point by looking at the next expected item\n        let insertIndex = filteredApps.length;\n        for (let i = appIndex + 1; i < expectedOrder.length; i++) {\n          const nextExpectedId = expectedOrder[i];\n          const nextItemIndex = filteredApps.findIndex(item => item.id === nextExpectedId);\n          if (nextItemIndex !== -1) {\n            insertIndex = nextItemIndex;\n            break;\n          }\n        }\n\n        // Insert the item at the correct position\n        return [\n          ...filteredApps.slice(0, insertIndex),\n          app,\n          ...filteredApps.slice(insertIndex)\n        ];\n      });\n    },\n    remove,\n    removeAll: () => set([]),\n    currentProcess: derived(inProcess, $inProcess => $inProcess),\n    updateCurrentProcess: (obj) => inProcess.update(p => ({ ...p, ...obj })),\n  };\n\n  // Create the advancement manager after storeObj is defined\n  const advancementManager = new AdvancementManager(storeObj, inProcess);\n\n  // Expose the advancement manager globally for hooks to access\n  if (typeof window !== 'undefined') {\n    window.GAS = window.GAS || {};\n    window.GAS.advancementManager = advancementManager;\n  }\n\n  /**\n   * Advances the queue to the next item\n   * Will open the Advancements tab if it's required and not already open\n   * @param {boolean} initial - Whether this is the initial call to the queue\n   * @returns {Promise<boolean>}\n   */\n  storeObj.advanceQueue = async function (initial) {\n    return await advancementManager.advanceQueue();\n  };\n\n  return storeObj;\n};\n\n// Create the store instance\nexport const dropItemRegistry = advancementQueueStore();","import { writable, derived, get } from 'svelte/store';\nimport { characterClass, background } from './storeDefinitions';\nimport { parsedEquipmentGold, updateGoldFromEquipmentChoice, clearEquipmentGoldChoices } from './equipmentGold';\n\n// Store structure will track selections by group\n// { \n//   groupId: { \n//     selectedItemId: string, \n//     selectedItem: object, \n//     completed: boolean, \n//     inProgress: boolean,\n//     granularSelections: {\n//       // For special types (tool, weapon, armor, focus)\n//       self?: string[], // UUIDs from equipment packs\n//       // For subgroups (AND/OR)\n//       children?: {\n//         [childId: string]: {\n//           type: string, // The special type if any\n//           selections: string[] // UUIDs from equipment packs\n//         }\n//       }\n//     }\n//   } \n// }\nexport const equipmentSelections = writable({});\n\nconst GRANULAR_TYPES = ['tool', 'weapon', 'armor', 'focus'];\nconst SUBGROUP_TYPES = ['AND', 'OR'];\n\nexport function getRequiredSelectionsCount(item) {\n  return item.count || 1;\n}\n\nexport function getEquipmentItemClasses(group, item, disabled) {\n  const classes = [];\n  \n  // Check if this item needs granular selection\n  const needsGranular = GRANULAR_TYPES.includes(item.type);\n  \n  // Add 'selected' class for:\n  // - linked items (always selected)\n  // - completed group items that don't need granular selection\n  // - granular items that have been configured (have granular selections)\n  if (item.type === 'linked' || \n      (group.completed && !needsGranular) ||\n      (needsGranular && group.granularSelections?.children?.[item._id]?.selections?.length > 0)) {\n    classes.push('selected');\n  }\n  \n  // Add 'in-progress' class for granular items that need configuration\n  if (needsGranular && group.selectedItem?.type === 'AND' && \n      (!group.granularSelections?.children?.[item._id]?.selections?.length)) {\n    classes.push('in-progress');\n  }\n  \n  if (item.type === 'focus') classes.push('focus');\n  if (disabled) classes.push('disabled');\n  \n  return classes.join(' ');\n}\n\nexport function getOptionClasses(disabled, group, item) {\n  const classes = [];\n  if (group.selectedItemId === item._id) classes.push('selected');\n  if (isOptionDisabled(disabled, group, item)) classes.push('disabled');\n  if (group.completed) classes.push('completed');\n  if (group.inProgress && !isOptionDisabled(disabled, group, item)) classes.push('in-progress');\n  return classes.join(' ');\n}\n\nexport function isOptionDisabled(disabled, group, item) {\n  return disabled || (group.inProgress && group.selectedItemId && group.selectedItemId !== item._id);\n}\n\n\nexport function handleSelection(disabled, groupId, item) {\n  const selections = get(equipmentSelections);\n\n  window.GAS.log.d('[handleSelection] Entry', {\n    groupId,\n    itemType: item?.type,\n    itemLabel: item?.label,\n    groupType: selections[groupId]?.type,\n    isChoiceGroup: selections[groupId]?.type === 'choice'\n  });\n\n  if (disabled || !item) {\n    return;\n  }\n\n  // Handle choice groups\n  if (selections[groupId]?.type === 'choice') {\n    window.GAS.log.d('[handleSelection] Processing choice group selection', {\n      groupId,\n      selectedItemType: item.type,\n      selectedItemLabel: item.label,\n      isToolType: item.type === 'tool'\n    });\n    \n    selectEquipment(groupId, item._id);\n    return;\n  }\n\n  window.GAS.log.d('[StartingEquipment] handleSelection ENTRY', {\n    groupId,\n    itemDetails: {\n      id: item?._id,\n      type: item?.type,\n      label: item?.label,\n      key: item?.key,\n      fullItem: item\n    },\n    groupState: {\n      type: selections[groupId]?.type,\n      inProgress: selections[groupId]?.inProgress,\n      completed: selections[groupId]?.completed,\n      selectedItem: selections[groupId]?.selectedItem,\n      items: selections[groupId]?.items?.map(i => ({\n        id: i._id,\n        type: i.type,\n        key: i.key,\n        label: i.label,\n        isAND: i.type === 'AND'\n      }))\n    },\n    disabled,\n    isToolType: item?.type === 'tool'\n  });\n\n  if (disabled) {\n    window.GAS.log.d('[StartingEquipment] Selection disabled, returning early');\n    return;\n  }\n\n  const group = selections[groupId];\n\n  if (!group) {\n    window.GAS.log.d('[StartingEquipment] No group found for groupId:', groupId);\n    return;\n  }\n\n  window.GAS.log.d('[StartingEquipment] Group evaluation', {\n    isStandalone: group?.type === 'standalone',\n    hasItems: !!group?.items?.length,\n    firstItemType: group?.items?.[0]?.type,\n    isFirstItemAND: group?.items?.[0]?.type === 'AND',\n    isChoiceGroup: group?.type === 'choice',\n    selectedItemType: item?.type,\n    willCallSelectEquipment: true\n  });\n\n  // For standalone groups with AND items\n  if (group?.type === 'standalone' && group.items[0]?.type === 'AND') {\n    window.GAS.log.d('[StartingEquipment] Handling standalone AND group', {\n      andItemDetails: {\n        id: group.items[0]._id,\n        children: group.items[0].children?.map(c => ({\n          id: c._id,\n          type: c.type,\n          label: c.label\n        }))\n      },\n      currentGranularSelections: group.granularSelections,\n      clickedItem: item\n    });\n    \n    // If a specific granular item (tool, weapon, armor, focus) was clicked, handle it directly\n    if (item && GRANULAR_TYPES.includes(item.type)) {\n      window.GAS.log.d('[StartingEquipment] Granular item clicked in AND group', {\n        itemType: item.type,\n        itemId: item._id,\n        itemLabel: item.label,\n        willSelectANDGroupFirst: true\n      });\n      \n      // First, ensure the AND group is selected\n      if (!group.selectedItemId) {\n        selectEquipment(groupId, group.items[0]._id);\n      }\n      \n      // Then handle the granular item selection\n      // This will be handled by the granular selection UI\n      return;\n    }\n    \n    // For non-granular items or general AND group selection\n    selectEquipment(groupId, group.items[0]._id);\n  }\n  // For choice groups\n  else if (group?.type === 'choice') {\n    window.GAS.log.d('[StartingEquipment] Handling choice group', {\n      groupId,\n      selectedItemId: item._id,\n      selectedItemType: item.type,\n      selectedItemKey: item.key,\n      selectedItemLabel: item.label,\n      isSelectedItemAND: item.type === 'AND',\n      isSelectedItemTool: item.type === 'tool',\n      groupItems: group.items.map(i => ({\n        id: i._id,\n        type: i.type,\n        key: i.key,\n        label: i.label\n      })),\n      aboutToCallSelectEquipment: true\n    });\n    selectEquipment(groupId, item._id);\n  }\n}\n\nfunction needsGranularSelection(item) {\n  return GRANULAR_TYPES.includes(item.type) || SUBGROUP_TYPES.includes(item.type);\n}\n\n// Add this function to check if an item requires multiple selections\nexport function getRequiredSelections(item) {\n  // If the item has a count > 1 and is not an AND type, it requires multiple selections\n  return item.count > 1 && item.type !== 'AND' ? item.count : 1;\n}\n\n// Helper functions to manage selections\nexport function selectEquipment(groupId, itemId) {\n  window.GAS.log.d('SELECT EQUIPMENT | Entry', {\n    groupId,\n    itemId,\n    currentState: get(equipmentSelections)\n  });\n\n  equipmentSelections.update(state => {\n    const group = state[groupId];\n    if (!group) return state;\n\n    // Prevent additional selections if:\n    // 1. The group is completed and not being edited\n    // 2. The group has a selected item and is in progress (handling granular selection)\n    if ((group.completed && !group.inProgress) ||\n      (group.selectedItemId && group.inProgress)) {\n      return state;\n    }\n\n    const selectedItem = group.items.find(i => i._id === itemId);\n    if (!selectedItem) return state;\n\n    window.GAS.log.d('SELECT EQUIPMENT | Processing selection', {\n      selectedItem,\n      isAND: selectedItem.type === 'AND',\n      hasGranularChildren: selectedItem.type === 'AND' &&\n        selectedItem.children?.some(child => GRANULAR_TYPES.includes(child.type))\n    });\n\n    // For granular types (weapon, armor, tool, focus), keep the group in progress\n    if (GRANULAR_TYPES.includes(selectedItem.type)) {\n      window.GAS.log.d('SELECT EQUIPMENT | Granular type selection', {\n        type: selectedItem.type,\n        groupId,\n        itemId,\n        groupType: group.type,\n        isChoiceGroup: group.type === 'choice',\n        willStayInProgress: true\n      });\n\n      return {\n        ...state,\n        [groupId]: {\n          ...group,\n          selectedItemId: itemId,\n          selectedItem,\n          completed: false,\n          inProgress: true,\n          granularSelections: { self: [], children: {} } // Reset granular selections\n        }\n      };\n    }\n\n    // Find next group for progression\n    const sortedGroups = Object.values(state)\n      .sort((a, b) => (a.sort || 0) - (b.sort || 0));\n    const nextGroup = sortedGroups.find(g =>\n      !g.completed && g.id !== groupId\n    );\n\n    // For regular linked items or AND groups, use the original simple selection logic\n    if (selectedItem.type === 'linked' || selectedItem.type === 'AND') {\n      const hasGranularChildren = selectedItem.type === 'AND' &&\n        selectedItem.children?.some(child => GRANULAR_TYPES.includes(child.type));\n\n      window.GAS.log.d('SELECT EQUIPMENT | AND/linked processing', {\n        type: selectedItem.type,\n        hasGranularChildren,\n        children: selectedItem.children\n      });\n\n      const newState = {\n        ...state,\n        [groupId]: {\n          ...group,\n          selectedItemId: itemId,\n          selectedItem,\n          completed: !hasGranularChildren,\n          inProgress: hasGranularChildren,\n          granularSelections: hasGranularChildren ? { self: [], children: {} } : null // Reset granular selections for AND groups\n        },\n        ...((!hasGranularChildren && nextGroup) ? {\n          [nextGroup.id]: {\n            ...nextGroup,\n            inProgress: true\n          }\n        } : {}),\n        // When completing an AND group, also activate any OR choice groups that depend on it\n        ...(!hasGranularChildren ? Object.values(state).reduce((acc, otherGroup) => {\n          if (otherGroup.type === 'choice' && otherGroup.parentGroup === groupId) {\n            acc[otherGroup.id] = {\n              ...otherGroup,\n              inProgress: true\n            };\n          }\n          return acc;\n        }, {}) : {})\n      };\n\n      // Update gold for variable gold equipment choices when AND group is completed\n      if (!hasGranularChildren) {\n        updateGoldForEquipmentChoice(groupId, selectedItem);\n      }\n\n      return newState;\n    }\n\n    // For granular children in an AND group\n    if (group.selectedItem?.type === 'AND' && GRANULAR_TYPES.includes(selectedItem.type)) {\n      window.GAS.log.d('SELECT EQUIPMENT | Granular child in AND group', {\n        groupId,\n        selectedItem,\n        parentGroup: group\n      });\n\n      // Keep the group in progress and maintain the current selectedItem (the AND group)\n      return {\n        ...state,\n        [groupId]: {\n          ...group,\n          inProgress: true,\n          completed: false\n        }\n      };\n    }\n\n    // For weapon/armor/tool selections that need multiple of the same item\n    if (selectedItem.count > 1 && GRANULAR_TYPES.includes(selectedItem.type)) {\n      if (!group.selectedItemId) {\n        // First selection\n        return {\n          ...state,\n          [groupId]: {\n            ...group,\n            selectedItemId: itemId,\n            selectedItem,\n            inProgress: true,\n            completed: false,\n            remainingSelections: selectedItem.count - 1,\n            selections: [{ itemId, count: 1 }],\n            granularSelections: { self: [], children: {} } // Reset granular selections\n          }\n        };\n      }\n\n      // Subsequent selections\n      const selections = [...(group.selections || [])];\n      const existingSelection = selections.find(s => s.itemId === itemId);\n\n      if (existingSelection) {\n        existingSelection.count++;\n      } else {\n        selections.push({ itemId, count: 1 });\n      }\n\n      const remainingSelections = group.remainingSelections - 1;\n      const completed = remainingSelections === 0;\n\n      return {\n        ...state,\n        [groupId]: {\n          ...group,\n          selections,\n          remainingSelections,\n          completed,\n          inProgress: !completed\n        },\n        ...(completed && nextGroup ? {\n          [nextGroup.id]: {\n            ...nextGroup,\n            inProgress: true\n          }\n        } : {})\n      };\n    }\n\n    // Default case - single selection\n    const newState = {\n      ...state,\n      [groupId]: {\n        ...group,\n        selectedItemId: itemId,\n        selectedItem,\n        completed: true,\n        inProgress: false,\n        granularSelections: null // Reset granular selections\n      },\n      ...(nextGroup ? {\n        [nextGroup.id]: {\n          ...nextGroup,\n          inProgress: true\n        }\n      } : {})\n    };\n\n    // Update gold for variable gold equipment choices\n    updateGoldForEquipmentChoice(groupId, selectedItem);\n\n    return newState;\n  });\n}\n\nexport const flattenedSelections = derived(equipmentSelections, ($equipmentSelections) => {\n  const result = Object.values($equipmentSelections)\n    .filter(group => {\n      const hasSelection = !!group.selectedItem || group.type === 'standalone';\n      window.GAS.log.d('[FlattenedSelections] Group filtering', {\n        groupId: group.id,\n        type: group.type,\n        hasSelection,\n        items: group.items\n      });\n      return hasSelection;\n    })\n    .flatMap(group => {\n      window.GAS.log.d('[FlattenedSelections] Processing group', {\n        groupId: group.id,\n        groupType: group.type,\n        items: group.items?.map(item => ({\n          id: item._id,\n          type: item.type,\n          key: item.key,\n          count: item.count,\n          isAND: item.type === 'AND',\n          children: item.type === 'AND' ? item.children?.map(c => ({\n            id: c._id,\n            type: c.type,\n            key: c.key,\n            count: c.count\n          })) : null\n        })),\n        selectedItem: group.selectedItem,\n        granularSelections: group.granularSelections\n      });\n\n      const selections = [];\n\n      // For standalone groups, process all items\n      if (group.type === 'standalone') {\n        group.items.forEach(item => {\n          // If it's an AND group, process its children\n          if (item.type === 'AND') {\n            window.GAS.log.d('[FlattenedSelections] Processing AND item in standalone', {\n              itemId: item._id,\n              children: item.children\n            });\n\n            item.children.forEach(child => {\n              if (child.type === 'linked') {\n                // For linked children, add them directly\n                const count = child.count || 1;\n                for (let i = 0; i < count; i++) {\n                  selections.push({\n                    type: child.type,\n                    key: child.key\n                  });\n                }\n              } else if (GRANULAR_TYPES.includes(child.type)) {\n                // For configurable children, check granular selections\n                const childSelections = group.granularSelections?.children?.[child._id]?.selections || [];\n                childSelections.forEach(uuid => {\n                  selections.push({\n                    type: child.type,\n                    key: uuid\n                  });\n                });\n              }\n            });\n          } else if (item.type === 'linked') {\n            // Handle regular linked items\n            const count = item.count || 1;\n            for (let i = 0; i < count; i++) {\n              selections.push({\n                type: item.type,\n                key: item.key\n              });\n            }\n          }\n        });\n\n        window.GAS.log.d('[FlattenedSelections] Standalone group selections', {\n          groupId: group.id,\n          selections: selections.map(s => ({\n            type: s.type,\n            key: s.key\n          }))\n        });\n\n        return selections;\n      }\n\n      // For choice groups with a selected item\n      if (group.selectedItem) {\n        if (GRANULAR_TYPES.includes(group.selectedItem.type)) {\n          let granularSelections = [];\n          \n          // Check if this group has a parentGroup (child choice group)\n          if (group.parentGroup) {\n            // Look up granular selections from the parent group\n            const parentGroup = $equipmentSelections[group.parentGroup];\n            granularSelections = parentGroup?.granularSelections?.children?.[group.id]?.selections || [];\n          } else {\n            // Look up granular selections from the group itself\n            granularSelections = group.granularSelections?.self || [];\n          }\n          \n          granularSelections.forEach(uuid => {\n            selections.push({\n              type: group.selectedItem.type,\n              key: uuid\n            });\n          });\n        } else if (group.selectedItem.type === 'linked') {\n          const count = group.selectedItem.count || 1;\n          for (let i = 0; i < count; i++) {\n            selections.push({\n              type: group.selectedItem.type,\n              key: group.selectedItem.key\n            });\n          }\n        } else if (group.selectedItem.type === 'AND') {\n          // Process AND group children\n          group.selectedItem.children.forEach(child => {\n            if (child.type === 'linked') {\n              // For linked children, add them directly\n              const count = child.count || 1;\n              for (let i = 0; i < count; i++) {\n                selections.push({\n                  type: child.type,\n                  key: child.key\n                });\n              }\n            } else if (GRANULAR_TYPES.includes(child.type)) {\n              // For configurable children, check granular selections\n              const childSelections = group.granularSelections?.children?.[child._id]?.selections || [];\n              childSelections.forEach(uuid => {\n                selections.push({\n                  type: child.type,\n                  key: uuid\n                });\n              });\n            }\n          });\n        }\n        return selections;\n      }\n\n      return [];\n    });\n\n  window.GAS.log.d('[FlattenedSelections] Final flattened result', {\n    resultCount: result.length,\n    items: result.map(item => ({\n      type: item.type,\n      key: item.key\n    }))\n  });\n\n  return result;\n});\n\n// Add granular selection for special types\nexport function addGranularSelection(groupId, uuid) {\n  equipmentSelections.update(selections => {\n    const group = selections[groupId];\n    if (!group?.selectedItem) return selections;\n\n    // Initialize granularSelections if it doesn't exist\n    const currentGranularSelections = group.granularSelections || { self: [], children: {} };\n\n    const updatedSelections = {\n      ...currentGranularSelections,\n      self: [...(currentGranularSelections.self || []), uuid]\n    };\n\n    const isComplete = updatedSelections.self.length >= getRequiredSelectionsCount(group.selectedItem);\n\n    window.GAS.log.d('[addGranularSelection] Adding granular selection', {\n      groupId,\n      uuid,\n      groupType: group.type,\n      requiredCount: getRequiredSelectionsCount(group.selectedItem),\n      isComplete\n    });\n\n    // Find next group if complete\n    const sortedGroups = Object.values(selections)\n      .sort((a, b) => (a.sort || 0) - (b.sort || 0));\n    const nextGroup = isComplete ? sortedGroups.find(g =>\n      !g.completed && g.id !== groupId\n    ) : null;\n\n    return {\n      ...selections,\n      [groupId]: {\n        ...group,\n        granularSelections: updatedSelections,\n        completed: isComplete,\n        inProgress: !isComplete\n      },\n      ...(nextGroup ? {\n        [nextGroup.id]: {\n          ...nextGroup,\n          inProgress: true\n        }\n      } : {})\n    };\n  });\n}\n\n// Add granular selection for subgroup children\nexport function addChildGranularSelection(groupId, childId, uuid) {\n  window.GAS.log.d('AND GROUP DEBUG | addChildGranularSelection called:', {\n    groupId,\n    childId,\n    uuid,\n    currentStore: get(equipmentSelections)\n  });\n\n  equipmentSelections.update(selections => {\n    const group = selections[groupId];\n    window.GAS.log.d('AND GROUP DEBUG | Current group state:', {\n      group,\n      selectedItem: group?.selectedItem,\n      children: group?.selectedItem?.children,\n      granularSelections: group?.granularSelections\n    });\n\n    if (!group?.selectedItem) return selections;\n\n    const childItem = group.selectedItem.children?.find(c => c._id === childId);\n    window.GAS.log.d('AND GROUP DEBUG | Found child item:', {\n      childItem,\n      allChildren: group.selectedItem.children\n    });\n\n    if (!childItem) return selections;\n\n    // Initialize the granular selections structure if it doesn't exist\n    const currentGranularSelections = group.granularSelections || { self: [], children: {} };\n    window.GAS.log.d('AND GROUP DEBUG | Current granular selections:', currentGranularSelections);\n\n    const updatedSelections = {\n      ...currentGranularSelections,\n      children: {\n        ...currentGranularSelections.children,\n        [childId]: {\n          type: childItem.type,\n          selections: [uuid]\n        }\n      }\n    };\n\n    window.GAS.log.d('AND GROUP DEBUG | Updated selections:', updatedSelections);\n\n    // For AND types, check if all children that need selections have them\n    const isComplete = group.selectedItem.type === 'AND' ?\n      group.selectedItem.children.every(child => {\n        const needsSelection = GRANULAR_TYPES.includes(child.type);\n        const childSelections = updatedSelections.children?.[child._id]?.selections || [];\n        const hasEnoughSelections = childSelections.length >= getRequiredSelectionsCount(child);\n\n        window.GAS.log.d('AND GROUP DEBUG | addChildGranularSelection completion check for child', {\n          childId: child._id,\n          childType: child.type,\n          needsSelection,\n          selections: childSelections,\n          required: getRequiredSelectionsCount(child),\n          hasEnough: hasEnoughSelections\n        });\n\n        return !needsSelection || hasEnoughSelections;\n      }) : false;\n\n    const stillInProgress = group.selectedItem.type === 'AND' ?\n      group.selectedItem.children.some(child =>\n        GRANULAR_TYPES.includes(child.type) &&\n        (!updatedSelections.children?.[child._id]?.selections?.length ||\n          updatedSelections.children[child._id].selections.length < getRequiredSelectionsCount(child))\n      ) : false;\n\n    window.GAS.log.d('AND GROUP DEBUG | addChildGranularSelection completion status', {\n      isComplete,\n      stillInProgress,\n      groupType: group.selectedItem.type\n    });\n\n    // Find next group if complete\n    const sortedGroups = Object.values(selections)\n      .sort((a, b) => (a.sort || 0) - (b.sort || 0));\n    const nextGroup = isComplete ? sortedGroups.find(g =>\n      !g.completed && g.id !== groupId && g.id !== childId\n    ) : null;\n\n    // Check if the specific child is now complete\n    const childSelections = updatedSelections.children?.[childId]?.selections || [];\n    const childIsComplete = childSelections.length >= getRequiredSelectionsCount(childItem);\n\n    window.GAS.log.d('AND GROUP DEBUG | Child completion check', {\n      childId,\n      childSelections,\n      requiredCount: getRequiredSelectionsCount(childItem),\n      childIsComplete,\n      childGroupExists: !!selections[childId]\n    });\n\n    // Debug the child update logic\n    window.GAS.log.d('AND GROUP DEBUG | Child update logic', {\n      childId,\n      childIsComplete,\n      childGroupExists: !!selections[childId],\n      originalChild: selections[childId] ? {\n        id: selections[childId].id,\n        completed: selections[childId].completed,\n        inProgress: selections[childId].inProgress\n      } : null,\n      updateObject: selections[childId] ? {\n        ...selections[childId],\n        completed: childIsComplete,\n        inProgress: !childIsComplete\n      } : null\n    });\n\n    // Build the result object step by step to ensure proper updates\n    const result = {\n      ...selections,\n      [groupId]: {\n        ...group,\n        granularSelections: updatedSelections,\n        completed: isComplete,\n        inProgress: stillInProgress\n      }\n    };\n\n    // Update the child choice group state if it exists\n    if (selections[childId]) {\n      result[childId] = {\n        ...selections[childId],\n        completed: childIsComplete,\n        inProgress: !childIsComplete\n      };\n      window.GAS.log.d('AND GROUP DEBUG | Explicitly updating child group', {\n        childId,\n        beforeUpdate: {\n          completed: selections[childId].completed,\n          inProgress: selections[childId].inProgress\n        },\n        afterUpdate: {\n          completed: childIsComplete,\n          inProgress: !childIsComplete\n        },\n        childIsComplete,\n        notChildIsComplete: !childIsComplete\n      });\n      \n      window.GAS.log.d('AND GROUP DEBUG | Result after child update', {\n        childId,\n        resultChildGroup: result[childId],\n        resultChildCompleted: result[childId]?.completed,\n        resultChildInProgress: result[childId]?.inProgress\n      });\n    }\n\n    // Add next group if needed\n    if (nextGroup) {\n      window.GAS.log.d('AND GROUP DEBUG | Next group logic', {\n        nextGroupId: nextGroup.id,\n        childId,\n        isNextGroupSameAsChild: nextGroup.id === childId,\n        nextGroupDetails: {\n          id: nextGroup.id,\n          type: nextGroup.type,\n          completed: nextGroup.completed,\n          inProgress: nextGroup.inProgress\n        }\n      });\n      \n      result[nextGroup.id] = {\n        ...nextGroup,\n        inProgress: true\n      };\n      \n      window.GAS.log.d('AND GROUP DEBUG | After next group update', {\n        childId,\n        resultChildAfterNextGroup: result[childId],\n        resultChildCompleted: result[childId]?.completed,\n        resultChildInProgress: result[childId]?.inProgress\n      });\n    }\n\n    window.GAS.log.d('AND GROUP DEBUG | addChildGranularSelection final state', result);\n    window.GAS.log.d('AND GROUP DEBUG | Child group final state', {\n      childId,\n      childGroupInResult: result[childId],\n      childCompleted: result[childId]?.completed,\n      childInProgress: result[childId]?.inProgress\n    });\n    window.GAS.log.d('AND GROUP DEBUG | Final result keys', Object.keys(result));\n\n    return result;\n  });\n}\n\n// Remove granular selection (works for both special types and subgroup children)\nexport function removeGranularSelection(groupId, uuid, childId = null) {\n  equipmentSelections.update(selections => {\n    const group = selections[groupId];\n    if (!group) return selections;\n\n    let updatedSelections = { ...group.granularSelections };\n\n    if (childId) {\n      // Remove from child selections\n      updatedSelections.children = {\n        ...updatedSelections.children,\n        [childId]: (updatedSelections.children?.[childId] || []).filter(id => id !== uuid)\n      };\n    } else {\n      // Remove from self selections\n      updatedSelections.self = (updatedSelections.self || []).filter(id => id !== uuid);\n    }\n\n    window.GAS.log.d('[removeGranularSelection] Removing granular selection', {\n      groupId,\n      uuid,\n      groupType: group.type\n    });\n\n    return {\n      ...selections,\n      [groupId]: {\n        ...group,\n        granularSelections: updatedSelections,\n        completed: false,\n        inProgress: true\n      }\n    };\n  });\n}\n\n/**\n * Initializes or updates a group in the equipmentSelections store.\n *\n * @param {string} groupId - The unique identifier for the group.\n * @param {object} groupData - The data describing the group (type, items, etc).\n */\n// Helper function to flatten single-child OR groups\nfunction flattenSingleChildORs(items) {\n  const result = items.map(item => {\n    \n    if (item.type === 'OR' && item.children && Array.isArray(item.children) && item.children.length === 1) {\n      // Flatten single-child OR - return the child instead\n      const child = item.children[0];\n      \n      // Only flatten if the child is valid\n      if (child && typeof child === 'object') {\n        const flattened = {\n          ...child,\n          // Preserve the original OR's _id if child doesn't have one\n          _id: child._id || item._id,\n          // Use the child's label, or fallback to the OR's label if child has no label\n          label: child.label || item.label,\n          // IMPORTANT: Preserve the OR's group, not the child's group\n          // This ensures the flattened item stays in the correct parent group\n          group: item.group,\n          // If the child is an AND, flatten its children too\n          children: child.children ? flattenSingleChildORs(child.children) : undefined\n        };\n        \n        return flattened;\n      }\n    }\n    \n    if (item.type === 'AND' && item.children) {\n      // Recursively flatten children in AND groups\n      const processed = {\n        ...item,\n        children: flattenSingleChildORs(item.children)\n      };\n      \n      return processed;\n    }\n    \n    return item;\n  });\n  \n  return result;\n}\n\nexport function initializeGroup(groupId, groupData) {\n  window.GAS.log.d('AND GROUP DEBUG | initializeGroup called', {\n    groupId,\n    groupType: groupData.type,\n    existingGroup: equipmentSelections ? get(equipmentSelections)[groupId] : null\n  });\n  \n  equipmentSelections.update(selections => {\n    // Flatten single-child OR groups before processing\n    const ENABLE_FLATTENING = true; // Enable to fix single-child OR display\n    \n    // Only apply flattening to standalone groups, not choice groups\n    const flattenedGroupData = (ENABLE_FLATTENING && groupData.type === 'standalone') ? {\n      ...groupData,\n      items: flattenSingleChildORs(groupData.items)\n    } : groupData;\n    \n    // Force re-initialization when flattening is enabled to apply the flattening (only for standalone groups)\n    const needsInitialization = !selections[groupId] || \n      (ENABLE_FLATTENING && groupData.type === 'standalone') ||\n      JSON.stringify(selections[groupId].items) !== JSON.stringify(flattenedGroupData.items);\n    \n    // Only initialize if group doesn't exist or its items have changed\n    if (needsInitialization) {\n      // Check if any existing CHOICE group is in progress\n      // Standalone groups can all be in progress simultaneously, but only one choice group at a time\n      const hasChoiceGroupInProgress = Object.values(selections).some(group =>\n        group.type === 'choice' && (!group.completed || group.inProgress)\n      );\n\n      // For standalone groups, check if all items are fixed (type 'linked')\n      // If so, the group can be auto-completed without user input\n      const isAutoComplete = flattenedGroupData.type === 'standalone' &&\n        flattenedGroupData.items.reduce((canAutoComplete, item) => {\n          if (!canAutoComplete) return false; // Short circuit if already false\n          \n          if (item.type === 'linked') return true;\n          \n          if (item.type === 'AND' || item.type === 'OR') {\n            // For AND/OR groups, all children must also be 'linked' to auto-complete\n            return item.children.reduce((childCanAutoComplete, child) => {\n              if (!childCanAutoComplete) return false;\n              return child.type === 'linked';\n            }, true);\n          }\n          \n          return false;\n        }, true);\n\n      // If this group auto-completes, find the next incomplete group (by sort order)\n      const nextGroup = isAutoComplete ?\n        Object.values(selections)\n          .sort((a, b) => (a.sort || 0) - (b.sort || 0))\n          .find(g => !g.completed) : null;\n\n      // Determine if this group should be in progress\n      let shouldBeInProgress;\n      if (isAutoComplete) {\n        shouldBeInProgress = false; // Auto-complete groups are not in progress\n      } else if (flattenedGroupData.type === 'standalone') {\n        shouldBeInProgress = true; // Standalone groups are always in progress (visible)\n      } else if (flattenedGroupData.type === 'choice') {\n        // Check if the group is already completed - if so, don't reset it to in progress\n        const existingGroup = selections[groupId];\n        if (existingGroup && existingGroup.completed) {\n          shouldBeInProgress = false; // Don't reset completed choice groups\n        } else {\n          // Choice groups with a parent should only be in progress if their parent is completed\n          if (flattenedGroupData.parentGroup) {\n            const parentGroup = selections[flattenedGroupData.parentGroup];\n            shouldBeInProgress = parentGroup && parentGroup.completed && !hasChoiceGroupInProgress;\n          } else {\n            shouldBeInProgress = !hasChoiceGroupInProgress; // Only one choice group in progress at a time\n          }\n        }\n      } else {\n        shouldBeInProgress = false; // Default fallback\n      }\n\n      // Return the updated selections object, initializing or updating this group\n      // If auto-complete, set selectedItem and mark as completed\n      // If auto-complete, also set the next group as inProgress\n      \n              // Check if existing group is completed and preserve that state\n        const existingGroup = selections[groupId];\n        const shouldBeCompleted = isAutoComplete || (existingGroup && existingGroup.completed);\n        \n        window.GAS.log.d('AND GROUP DEBUG | initializeGroup update', {\n          groupId,\n          groupType: flattenedGroupData.type,\n          existingCompleted: existingGroup?.completed || false,\n          existingInProgress: existingGroup?.inProgress || false,\n          shouldBeCompleted,\n          shouldBeInProgress,\n          willOverrideExisting: !!existingGroup\n        });\n        \n        return {\n          ...selections,\n          [groupId]: {\n            id: groupId,\n            ...flattenedGroupData,\n            selectedItemId: isAutoComplete ? flattenedGroupData.items[0]._id : (existingGroup?.selectedItemId || null),\n            selectedItem: isAutoComplete ? flattenedGroupData.items[0] : (existingGroup?.selectedItem || null),\n            completed: shouldBeCompleted,\n            inProgress: shouldBeInProgress,\n            granularSelections: existingGroup?.granularSelections || null\n          },\n        ...(nextGroup && isAutoComplete ? {\n          [nextGroup.id]: {\n            ...nextGroup,\n            inProgress: true\n          }\n        } : {})\n      };\n    }\n    // If the group already exists and items haven't changed, return selections unchanged\n    return selections;\n  });\n}\n\nexport function setGroupInProgress(groupId) {\n  equipmentSelections.update(selections => {\n    // First, set all groups to not in progress\n    const updatedSelections = Object.entries(selections).reduce((acc, [id, group]) => ({\n      ...acc,\n      [id]: { ...group, inProgress: false }\n    }), {});\n\n    // Then set the target group to in progress\n    if (updatedSelections[groupId]) {\n      updatedSelections[groupId] = {\n        ...updatedSelections[groupId],\n        inProgress: true\n      };\n    }\n\n    return updatedSelections;\n  });\n}\n\nexport function editGroup(groupId) {\n  equipmentSelections.update(selections => {\n    window.GAS.log.d('[editGroup] Editing group', {\n      groupId,\n      groupType: selections[groupId]?.type\n    });\n\n    // First, set all groups to not in progress\n    const updatedSelections = Object.entries(selections).reduce((acc, [id, group]) => ({\n      ...acc,\n      [id]: { ...group, inProgress: false }\n    }), {});\n\n    // Then set the target group to in progress and incomplete, and reset all selections\n    if (updatedSelections[groupId]) {\n      updatedSelections[groupId] = {\n        ...updatedSelections[groupId],\n        inProgress: true,\n        completed: false,\n        selectedItemId: null,\n        selectedItem: null,\n        granularSelections: null  // Reset granular selections\n      };\n    }\n\n    return updatedSelections;\n  });\n  \n  // Clear equipment gold choices when editing any equipment group\n  // This ensures that gold calculations are reset when equipment selections are cleared\n  clearEquipmentGoldChoices();\n}\n\n\n// Helper function to check if a group belongs to a specific equipment source\nexport function isGroupFromSource(group, sourceEquipment) {\n  if (!group?.items?.length || !sourceEquipment?.length) return false;\n\n  window.GAS.log.d(`[isGroupFromSource] Checking group ${group.id}:`, {\n    groupItems: group.items.map(item => ({\n      id: item._id,\n      type: item.type,\n      hasChildren: !!item.children?.length,\n      childrenCount: item.children?.length || 0\n    })),\n    sourceEquipment: sourceEquipment.map(item => ({\n      id: item._id,\n      type: item.type,\n      group: item.group\n    }))\n  });\n\n  // Check if any of the group's items match items from the source equipment\n  const matches = group.items.some((groupItem) => {\n    // If this is an AND/OR item, check its children\n    if (groupItem.type === 'AND' || groupItem.type === 'OR') {\n      return groupItem.children?.some(child => \n        sourceEquipment.some(sourceItem => \n          child._id === sourceItem._id ||\n          (child.group && sourceItem._id === child.group)\n        )\n      );\n    }\n    \n    // For direct items, check as before\n    return sourceEquipment.some(\n      (sourceItem) =>\n        groupItem._id === sourceItem._id ||\n        (groupItem.group && sourceItem._id === groupItem.group),\n    );\n  });\n\n  window.GAS.log.d(`[isGroupFromSource] Result for group ${group.id}:`, matches);\n  return matches;\n}\n\nexport function isGroupNonEditable(group) {\n  // Check if it's a standalone group and all items are linked type\n  window.GAS.log.d('isGroupNonEditable', group);\n  return (\n    group.type === \"standalone\" &&\n    group.items.every((item) => {\n      if (item.type === \"linked\") return true;\n      if (item.type === \"AND\" || item.type === \"OR\") {\n        return item.children.every((child) => child.type === \"linked\");\n      }\n      return false;\n    })\n  );\n}\n\nexport function isGroupEditable(group) {\n  // Encapsulate both conditions: group must not be in progress AND must be editable\n  return !group.inProgress && !isGroupNonEditable(group);\n}\n\nexport function matchingGroupsForSource(sortedGroups, sourceGroup) {\n  if (!sourceGroup || !sourceGroup.equipment) return [];\n  return sortedGroups.filter(\n    (g) =>\n      (g.completed || g.inProgress) &&\n      isGroupFromSource(g, sourceGroup.equipment) &&\n      Array.isArray(g.items) &&\n      g.items.length > 0,\n  );\n}\n\nexport function clearEquipmentSelections() {\n  equipmentSelections.set({});\n  // Also clear equipment gold choices when clearing equipment selections\n  clearEquipmentGoldChoices();\n}\n\n// Add getEquipmentIcon function to the store\nexport function getEquipmentIcon(type) {\n  switch (type) {\n    case 'armor':\n      return 'icons/svg/shield.svg';\n    case 'weapon':\n      return 'icons/svg/sword.svg';\n    case 'tool':\n      return 'icons/svg/padlock.svg';\n    case 'focus':\n      return 'icons/svg/book.svg';\n    case 'linked':\n      return 'icons/svg/item-bag.svg';\n    case 'OR':\n      return 'icons/svg/dice-target.svg';\n    default:\n      return 'icons/svg/item-bag.svg';\n  }\n}\n\n// Add to the store's state\nconst selectedItemsData = writable({});\n\n// Add the function to update selected item data\nasync function updateSelectedItemData(groupId, selection) {\n  if (!selection?.granularSelections?.self?.[0]) return;\n  const itemData = await fromUuid(selection.granularSelections.self[0]);\n  if (itemData) {\n    selectedItemsData.update(data => ({\n      ...data,\n      [groupId]: itemData\n    }));\n  }\n}\n\n// Create a derived store that returns the actual data object\nexport const selectedItems = derived(equipmentSelections, ($equipmentSelections, set) => {\n  // Get current value of selectedItemsData\n  let currentData = {};\n  selectedItemsData.subscribe(value => currentData = value)();\n\n  // Update data for each group\n  Object.entries($equipmentSelections).forEach(([groupId, group]) => {\n    updateSelectedItemData(groupId, group);\n  });\n\n  // Return current data\n  set(currentData);\n\n  // Update when selectedItemsData changes\n  return selectedItemsData.subscribe(value => set(value));\n});\n\n// Helper function to update gold when equipment choices are made\nfunction updateGoldForEquipmentChoice(groupId, selectedItem) {\n  // Get the current character class and background\n  const currentClass = get(characterClass);\n  const currentBackground = get(background);\n  \n  // Get parsed equipment gold data\n  const equipmentGold = get(parsedEquipmentGold);\n  \n  let source = null;\n  let goldAmount = 0;\n  let choiceId = null;\n  \n  // For variable gold classes like Fighter, we need to map the equipment selection to gold amounts\n  // This requires analyzing the equipment selection context and matching it to the parsed gold options\n  \n  if (equipmentGold.fromClass.hasVariableGold && currentClass) {\n    // For Fighter class, look for patterns that indicate which choice was made\n    // This would need to be enhanced based on the actual data structure of equipment choices\n    \n    // Try to extract choice information from the selectedItem\n    // The choice might be encoded in the item's key, description, or group structure\n    \n    // For now, we'll try a simple pattern match\n    // In a real implementation, you'd want more sophisticated logic here\n    if (selectedItem.key) {\n      const keyLower = selectedItem.key.toLowerCase();\n      \n      // Look for indicators in the equipment key that might map to gold choices\n      for (const option of equipmentGold.fromClass.goldOptions) {\n        // This is a simplified matching approach\n        // You'd want to enhance this based on your actual data structure\n        if (keyLower.includes(option.choice.toLowerCase()) || \n            keyLower.includes(`choice${option.choice.toLowerCase()}`) ||\n            keyLower.includes(`option${option.choice.toLowerCase()}`)) {\n          source = 'fromClass';\n          goldAmount = option.goldAmount;\n          choiceId = option.choice;\n          break;\n        }\n      }\n      \n      // If no direct match, try to infer from equipment content\n      if (!source && selectedItem.label) {\n        const labelLower = selectedItem.label.toLowerCase();\n        // Try to match based on equipment types that might correlate with gold amounts\n        // This is very basic - you'd want more sophisticated mapping\n        if (labelLower.includes('chain') || labelLower.includes('mail')) {\n          // Assume this is a lower gold option\n          const lowestOption = equipmentGold.fromClass.goldOptions.reduce((min, opt) => \n            opt.goldAmount < min.goldAmount ? opt : min);\n          source = 'fromClass';\n          goldAmount = lowestOption.goldAmount;\n          choiceId = lowestOption.choice;\n        } else if (labelLower.includes('leather')) {\n          // Assume this is a middle gold option\n          const sortedOptions = [...equipmentGold.fromClass.goldOptions].sort((a, b) => a.goldAmount - b.goldAmount);\n          if (sortedOptions.length > 1) {\n            source = 'fromClass';\n            goldAmount = sortedOptions[1].goldAmount;\n            choiceId = sortedOptions[1].choice;\n          }\n        }\n      }\n    }\n  }\n  \n  // Similar logic could be applied for background equipment with variable gold\n  if (!source && equipmentGold.fromBackground.hasVariableGold && currentBackground) {\n    // Background variable gold logic would go here\n  }\n  \n  // Update gold if we found a match\n  if (source && goldAmount > 0) {\n    updateGoldFromEquipmentChoice(source, choiceId, goldAmount);\n    window.GAS.log.d('[EquipmentSelections] Updated gold for equipment choice:', {\n      source,\n      choiceId,\n      goldAmount,\n      selectedItem: selectedItem.label || selectedItem.key,\n      groupId\n    });\n  } else {\n    // Log when we couldn't match an equipment choice to gold\n    window.GAS.log.d('[EquipmentSelections] Could not determine gold amount for equipment choice:', {\n      selectedItem: selectedItem.label || selectedItem.key,\n      groupId,\n      hasVariableGold: equipmentGold.fromClass.hasVariableGold || equipmentGold.fromBackground.hasVariableGold\n    });\n  }\n}\n\n// Call updateGoldForEquipmentChoice in the appropriate places","import { writable, get, derived } from 'svelte/store';\n// Import all store definitions\nimport * as storeDefinitions from './storeDefinitions.js';\n// Re-export all store definitions\nexport * from './storeDefinitions.js';\n\nimport { advancementQueueStore } from '~/src/stores/advancements';\nimport { clearGoldChoices } from '~/src/stores/goldChoices';\nimport { clearEquipmentSelections } from '~/src/stores/equipmentSelections';\nimport { clearStartingEquipment } from '~/src/stores/startingEquipment';\n// Import and re-export equipment gold stores\nimport { \n  equipmentGoldOptions, \n  parsedEquipmentGold, \n  totalEquipmentGold, \n  areEquipmentGoldChoicesComplete,\n  clearEquipmentGoldChoices \n} from '~/src/stores/equipmentGold';\nexport { \n  equipmentGoldOptions, \n  parsedEquipmentGold, \n  totalEquipmentGold, \n  areEquipmentGoldChoicesComplete \n} from '~/src/stores/equipmentGold';\n// Import spell selection store to ensure it gets loaded\nimport '~/src/stores/spellSelection';\nimport { MODULE_ID } from '~/src/helpers/constants';\nimport { getSubclassLevel } from '~/src/helpers/Utility';\n\nconst initialTabs = [\n  { label: 'Abilities', id: 'abilities', component: 'Abilities' },\n  { label: 'Race', id: 'race', component: 'Race' },\n  { label: 'Background', id: 'background', component: 'Background' },\n  { label: 'Class', id: 'class', component: 'Class' },\n];\n\n// Tabs for level up\nconst upTabs = [\n  { label: 'Level Up', id: 'level-up', component: 'LevelUp' },\n];\n\n// Set initial values for tabs\nstoreDefinitions.tabs.set(initialTabs);\nstoreDefinitions.levelUpTabs.set(upTabs);\nstoreDefinitions.pointBuyLimit.set(27);\n\n// Set names for debugging\nstoreDefinitions.race.name = 'race';\nstoreDefinitions.subRace.name = 'subRace';\nstoreDefinitions.characterClass.name = 'characterClass';\nstoreDefinitions.characterSubClass.name = 'characterSubClass';\nstoreDefinitions.background.name = 'background';\nstoreDefinitions.abilities.name = 'abilities';\nstoreDefinitions.spells.name = 'spells';\nstoreDefinitions.isLevelUp.name = 'isLevelUp';\nstoreDefinitions.pointBuyScoreTotal.name = 'pointBuyScoreTotal';\nstoreDefinitions.pointBuyLimit.name = 'pointBuyLimit';\nstoreDefinitions.abilityRolls.name = 'abilityRolls';\nstoreDefinitions.isStandardArrayValues.name = 'isStandardArrayValues';\nstoreDefinitions.newLevelValueForExistingClass.name = 'newLevelValueForExistingClass';\nstoreDefinitions.classUuidForLevelUp.name = 'classUuidForLevelUp';\nstoreDefinitions.level.name = 'level';\nstoreDefinitions.activeTab.name = 'activeTab';\nstoreDefinitions.selectedMultiClassUUID.name = 'selectedMultiClassUUID';\nstoreDefinitions.isActorCreated.name = 'isActorCreated';\nstoreDefinitions.tabs.name = 'tabs';\nstoreDefinitions.levelUpTabs.name = 'levelUpTabs';\nstoreDefinitions.actorInGame.name = 'actorInGame';\nstoreDefinitions.abilityGenerationMethod.name = 'abilityGenerationMethod';\nstoreDefinitions.subClassesForClass.name = 'subClassesForClass';\nstoreDefinitions.levelUpClassObject.name = 'levelUpClassObject';\nstoreDefinitions.activeRowClassKey.name = 'activeRowClassKey';\nstoreDefinitions.levelUpSubClassObject.name = 'levelUpSubClassObject';\nstoreDefinitions.levelUpCombinedHtml.name = 'levelUpCombinedHtml';\n// Export the advancement queue store\nexport const dropItemRegistry = advancementQueueStore();\ndropItemRegistry.name = 'dropItemRegistry';\n\nexport const isNewMultiClass = derived(\n  [storeDefinitions.characterClass, storeDefinitions.newLevelValueForExistingClass],\n  ([$characterClass, $newLevelValueForExistingClass]) => {\n    if ($newLevelValueForExistingClass) return false;\n    if ($characterClass && !$newLevelValueForExistingClass) return true;\n  }\n);\n\nexport const subclassLevelForLevelUp = derived(\n  [storeDefinitions.classUuidForLevelUp, storeDefinitions.levelUpClassObject],\n  ([$classUuidForLevelUp, $levelUpClassObject]) => {\n    if (!$classUuidForLevelUp || !$levelUpClassObject) return false;\n    const result = $classUuidForLevelUp ? getSubclassLevel($levelUpClassObject, MODULE_ID) : false;\n    // window.GAS.log.d('[subclassLevel] classUuidForLevelUp', $classUuidForLevelUp)\n    // window.GAS.log.d('[subclassLevel] levelUpClassObject', $levelUpClassObject)\n    // window.GAS.log.d('[subclassLevel] getSubclassLevel($levelUpClassObject, MODULE_ID)', getSubclassLevel($levelUpClassObject, MODULE_ID))\n    // window.GAS.log.d('[subclassLevel] result', result)\n    return result;\n  }\n);\n\n// Derived store to determine if a new multiclass is selected\nexport const isNewMultiClassSelected = derived(\n  [storeDefinitions.classUuidForLevelUp, storeDefinitions.newLevelValueForExistingClass, storeDefinitions.selectedMultiClassUUID],\n  ([$classUuidForLevelUp, $newLevelValueForExistingClass, $selectedMultiClassUUID]) => {\n    return $classUuidForLevelUp && !$newLevelValueForExistingClass && $selectedMultiClassUUID;\n  }\n);\n\n// Derived store to check if the class gets a subclass at the current level up level\nexport const levelUpClassGetsSubclassThisLevel = derived(\n  [storeDefinitions.classUuidForLevelUp, subclassLevelForLevelUp, storeDefinitions.newLevelValueForExistingClass, storeDefinitions.levelUpClassObject, isNewMultiClassSelected],\n  ([$classUuidForLevelUp, $subclassLevelForLevelUp, $newLevelValueForExistingClass, $levelUpClassObject, $isNewMultiClassSelected]) => {\n    // window.GAS.log.d('[classGetsSubclassThisLevel] classUuidForLevelUp', $classUuidForLevelUp)\n    // window.GAS.log.d('[classGetsSubclassThisLevel] newLevelValueForExistingClass', $newLevelValueForExistingClass)\n    // window.GAS.log.d('[classGetsSubclassThisLevel] levelUpClassObject', $levelUpClassObject)\n    // window.GAS.log.d('[classGetsSubclassThisLevel] isNewMultiClassSelected', $isNewMultiClassSelected)\n    if (!$classUuidForLevelUp || !$levelUpClassObject) return false;\n\n    // Determine the current level: 1 for new multiclass, existing level + 1 for existing class\n    const currentLevel = $isNewMultiClassSelected ? 1 : $newLevelValueForExistingClass;\n\n    // window.GAS.log.d('[classGetsSubclassThisLevel] subclassLevelForLevelUp', $subclassLevelForLevelUp)\n    // window.GAS.log.d('[classGetsSubclassThisLevel] currentLevel', currentLevel)\n    const result = $subclassLevelForLevelUp && $subclassLevelForLevelUp === currentLevel;\n    // window.GAS.log.d('[classGetsSubclassThisLevel] result', result)\n    return result;\n  }\n);\n\n// Cache store for initial character selection state\nexport const preAdvancementSelections = writable({});\npreAdvancementSelections.name = 'preAdvancementSelections';\n\n// Cache store for initial character selection state\nexport const levelUpPreAdvancementSelections = writable({});\nlevelUpPreAdvancementSelections.name = 'levelUpPreAdvancementSelections';\n\n// Derived store to track changes from initial state\nexport const hasCharacterCreationChanges = derived(\n  [storeDefinitions.race, storeDefinitions.background, storeDefinitions.characterClass, storeDefinitions.characterSubClass, preAdvancementSelections],\n  ([$race, $background, $characterClass, $characterSubClass, $preAdvancementSelections]) => {\n    // window.GAS.log.d(\"hasCharacterCreationChanges preAdvancementSelections\", $preAdvancementSelections);\n    if (Object.keys($preAdvancementSelections).length === 0) return false;\n\n    return (\n      $race?.id !== $preAdvancementSelections.race?.id ||\n      $background?.id !== $preAdvancementSelections.background?.id ||\n      $characterClass?.id !== $preAdvancementSelections.class?.id ||\n      $characterSubClass?.id !== $preAdvancementSelections.subclass?.id\n    );\n  }\n);\n\n// Derived store to check if advancements are in progress\nexport const isAdvancementInProgress = derived(\n  [storeDefinitions.tabs],\n  ([$tabs]) => {\n    // window.GAS.log.d('[isAdvancementInProgress] tabs', $tabs)\n    return $tabs.find((tab) => tab.id === 'advancements') ? true : false;\n  }\n);\nexport const isLevelUpAdvancementInProgress = derived(\n  [storeDefinitions.levelUpTabs],\n  ([$levelUpTabs]) => {\n    // window.GAS.log.d('[isLevelUpAdvancementInProgress] tabs', $levelUpTabs)\n    return $levelUpTabs.find((tab) => tab.id === 'advancements') ? true : false;\n  }\n);\n\n//- Derived store to get the changed items\nexport const changedCharacterCreationItems = derived(\n  [storeDefinitions.race, storeDefinitions.background, storeDefinitions.characterClass, storeDefinitions.characterSubClass, preAdvancementSelections],\n  ([$race, $background, $characterClass, $characterSubClass, $preAdvancementSelections]) => {\n    if (Object.keys($preAdvancementSelections).length === 0) return [];\n\n    const changes = [];\n    if ($race?.id !== $preAdvancementSelections.race?.id) {\n      changes.push({ type: 'race', item: $preAdvancementSelections.race });\n    }\n    if ($background?.id !== $preAdvancementSelections.background?.id) {\n      changes.push({ type: 'background', item: $preAdvancementSelections.background });\n    }\n    if ($characterClass?.id !== $preAdvancementSelections.class?.id) {\n      changes.push({ type: 'class', item: $preAdvancementSelections.class });\n    }\n    if ($characterSubClass?.id !== $preAdvancementSelections.subclass?.id) {\n      changes.push({ type: 'subclass', item: $preAdvancementSelections.subclass });\n    }\n    return changes;\n  }\n);\n\nexport const resetLevelUpStores = () => {\n  storeDefinitions.classUuidForLevelUp.set(null); //- tracks the class uuid for level up\n  storeDefinitions.newLevelValueForExistingClass.set(false); //- tracks new level value for existing class\n  storeDefinitions.selectedMultiClassUUID.set(false); //- tracks the selected multi class\n  storeDefinitions.levelUpClassObject.set(null); //- tracks the new multi class object\n  storeDefinitions.levelUpSubClassObject.set(null); //- tracks the new multi class object\n}\n\n// Function to reset all stores\nexport function resetStores() {\n  window.GAS.log.d('[resetStores]')\n  storeDefinitions.race.set(null); //- null | object\n  storeDefinitions.background.set(null); //- null | object\n  storeDefinitions.characterClass.set(null); //- null | object\n  storeDefinitions.characterSubClass.set(null); //- null | object\n  storeDefinitions.abilityRolls.set(false); //- boolean\n  storeDefinitions.level.set(1); //- number\n  storeDefinitions.tabs.set(initialTabs); //- array\n  storeDefinitions.pointBuyScoreTotal.set(12); //- number\n  storeDefinitions.pointBuyLimit.set(game.settings.get(MODULE_ID, \"pointBuyLimit\")); //- number\n  storeDefinitions.activeTab.set(initialTabs[0].id); //- string\n  storeDefinitions.isActorCreated.set(false); //- boolean\n  storeDefinitions.actorInGame.set(null); //- null | object\n  storeDefinitions.abilityGenerationMethod.set(null); //- null | string\n  storeDefinitions.subClassesForClass.set([]); //- array\n  storeDefinitions.goldRoll.set(0); //- number\n  storeDefinitions.readOnlyTabs.set([]); //- array\n  storeDefinitions.levelUpTabs.set(upTabs); //- array\n  storeDefinitions.levelUpClassObject.set(null); //- null | object\n  storeDefinitions.newLevelValueForExistingClass.set(false); //- boolean\n  storeDefinitions.selectedMultiClassUUID.set(null); //- null | uuid string\n  storeDefinitions.activeRowClassKey.set(null); //- null | string\n  storeDefinitions.classUuidForLevelUp.set(null); //- null | uuid string\n  storeDefinitions.levelUpSubClassObject.set(null); //- null | object\n  storeDefinitions.levelUpCombinedHtml.set(''); //- string\n  storeDefinitions.levelUpRichHTML.set(''); //- string\n  storeDefinitions.levelUpRichSubClassHTML.set(''); //- string\n  preAdvancementSelections.set({}); //- void\n  levelUpPreAdvancementSelections.set({}); //- void\n  dropItemRegistry.removeAll(); //- void\n  clearGoldChoices(); //- void\n  clearEquipmentSelections(); //- void\n  clearStartingEquipment(); //- void\n  clearEquipmentGoldChoices(); //- void\n  \n  // Clear spell selection stores\n  try {\n    // Import and clear spell selection stores\n    import('~/src/stores/spellSelection').then(({ selectedSpells }) => {\n      selectedSpells.set(new Map());\n      window.GAS.log.d('[resetStores] Cleared selectedSpells store');\n    }).catch(error => {\n      window.GAS.log.w('[resetStores] Failed to clear spell selection stores:', error);\n    });\n  } catch (error) {\n    window.GAS.log.w('[resetStores] Error importing spell selection module:', error);\n  }\n}\n\n// Auto-update levelUpTabs with level progression information\nconst levelUpTabUpdater = derived(\n  [storeDefinitions.newLevelValueForExistingClass, isNewMultiClassSelected],\n  ([$newLevelValueForExistingClass, $isNewMultiClassSelected]) => {\n    let label = 'Level Up';\n    \n    if ($isNewMultiClassSelected) {\n      // New multiclass: show \"Level Up (MC)\" for multiclass\n      label = 'Level Up (MC)';\n    } else if ($newLevelValueForExistingClass) {\n      // Existing class level up: show progression like \"Level Up (3  4)\"\n      const currentLevel = $newLevelValueForExistingClass - 1;\n      const newLevel = $newLevelValueForExistingClass;\n      label = `Level Up (${currentLevel}  ${newLevel})`;\n    }\n    \n    // Update the levelUpTabs store with the new label\n    storeDefinitions.levelUpTabs.update(tabs => \n      tabs.map(tab => \n        tab.id === 'level-up' \n          ? { ...tab, label } \n          : tab\n      )\n    );\n    \n    return label;\n  }\n);\n\n// Auto-subscribe to activate the level progression updates (safely)\ntry {\n  levelUpTabUpdater.subscribe(() => {});\n} catch (error) {\n  // Ignore initialization errors - the subscription will work when stores are ready\n  console.debug('Level up tab updater subscription deferred');\n}","import { LOG_PREFIX, MODULE_ID, MODULE_CODE, LOG_PREFIX_COLOR, LOG_STYLES} from \"~/src/helpers/constants\"\nimport DTPlugin from \"~/src/plugins/donation-tracker\";\nimport { dropItemRegistry } from \"~/src/stores/index\";\nimport { get } from \"svelte/store\";\nimport { tick } from \"svelte\";\n\n/**\n * Converts various collection types into a standard array\n * @param {Array|Collection|Set|Map|Object} collection - The collection to convert. Can be:\n *   - Array: returned as-is\n *   - Collection: contents property is returned if present\n *   - Set/Map/Object: converted to array via Array.from()\n * @returns {Array} The collection contents as a standard array\n */\nexport function getItemsArray(collection) {\n  if (!collection) return [];\n  if (Array.isArray(collection)) return collection;\n  if (collection.contents) return collection.contents;\n  try { return Array.from(collection); } catch (e) { return []; }\n}\n\n  /**\n   * Get the current items from the actor in the correct format\n   */\n  export function getItemSourcesFromActor(doc) {\n    try {\n      const itemsCollection = doc?.items;\n      if (!itemsCollection) return [];\n      const list = Array.isArray(itemsCollection)\n        ? itemsCollection\n        : (itemsCollection.contents || Array.from(itemsCollection));\n      return list.map((itemDoc) => itemDoc?.toObject ? itemDoc.toObject() : itemDoc);\n    } catch (_) {\n      return [];\n    }\n  }\n\n\nexport async function illuminatedDescription(html, store) {\n  const enriched = await enrichHTML(html);\n  if(!game.settings.get(MODULE_ID, 'illuminatedDescription')) {\n    return enriched;\n  }\n  const jEnriched = jQuery(enriched);\n  let content = enriched;\n  \n  // Check if the content is wrapped in a div\n  if (jEnriched.length === 1 && jEnriched[0].nodeName === 'DIV') {\n    content = jEnriched.html();\n  }\n\n  if (!content) return null;\n  \n  const richHTML = `\n    <div class=\"illuminated-description\">\n      <div class=\"illuminated-initial\" style=\"background-image: url('${store.img}')\"></div>\n      ${content}\n    </div>\n  `;\n  return richHTML;\n}\n\nexport function dnd5eModCalc(score) {\n  return Math.floor((score - 10) / 2);\n}\n\n/**\n * Calculates the D&D 5e skill bonus for a given skill key.\n *\n * @param {object} actor - The actor document object.\n * @param {string} key - The abbreviation of the skill (e.g., 'acr', 'ath').\n * @returns {number|null} The calculated skill bonus, or null if the skill data is not found.\n */\nexport function skillBonus(actor, key) {\n  const skill = actor?.system?.skills?.[key];\n  if (!skill) return null;\n  const ability = skill.ability || 'int';\n  const abilityScore = actor?.system?.abilities?.[ability]?.value ?? 10;\n  const mod = dnd5eModCalc(abilityScore);\n  const tier = Number(skill.value) || 0; // 0/1/2\n  const pb = pbForCR(actor?.system?.details?.cr ?? 0);\n  return mod + (tier * pb);\n}\n\n\n// Standard D&D 5e size display map\nexport const SIZES = { tiny: 'Tiny', sm: 'Small', med: 'Medium', lg: 'Large', huge: 'Huge', grg: 'Gargantuan' };\n\n// Normalize arrays that may sometimes be strings, Sets, or objects\nexport function normalizeList(val) {\n  if (!val) return [];\n  if (Array.isArray(val)) return val;\n  if (val instanceof Set) return Array.from(val);\n  if (typeof val === 'string') return val.split(',').map(s => s.trim()).filter(Boolean);\n  if (typeof val === 'object') return Object.keys(val).filter(k => !!val[k]);\n  return [];\n}\n\n// Utility proficiency bonus by CR (fallback for UI; prefer CRCalculator when available)\nexport function pbForCR(cr) {\n  const n = Number(cr) ?? 0;\n  if (n <= 4) return 2;\n  if (n <= 8) return 3;\n  if (n <= 12) return 4;\n  if (n <= 16) return 5;\n  if (n <= 20) return 6;\n  if (n <= 24) return 7;\n  if (n <= 28) return 8;\n  return 9;\n}\n\n// Utility XP by CR (fallback for UI; prefer CRCalculator when available)\nexport function xpForCR(cr) {\n  const table = {\n    0: 10, 1: 200, 2: 450, 3: 700, 4: 1100, 5: 1800, 6: 2300, 7: 2900, 8: 3900,\n    9: 5000, 10: 5900, 11: 7200, 12: 8400, 13: 10000, 14: 11500, 15: 13000,\n    16: 15000, 17: 18000, 18: 20000, 19: 22000, 20: 25000, 21: 33000, 22: 41000,\n    23: 50000, 24: 62000, 25: 75000, 26: 90000, 27: 105000, 28: 120000, 29: 135000, 30: 155000\n  };\n  const n = Number(cr) ?? 0;\n  return table[n] ?? 0;\n}\n\n\nexport const log = {\n  ASSERT: 1, ERROR: 2, WARN: 3, INFO: 4, DEBUG: 5, VERBOSE: 6,\n  set level(level) {\n    this.a = (level >= this.ASSERT) ? console.assert.bind(window.console, LOG_PREFIX) : () => { };\n    this.e = (level >= this.ERROR) ? console.error.bind(window.console, LOG_PREFIX) : () => { };\n    this.w = (level >= this.WARN) ? console.warn.bind(window.console, LOG_PREFIX) : () => { };\n    this.i = (level >= this.INFO) ? console.info.bind(window.console, LOG_PREFIX) : () => { };\n    this.d = (level >= this.DEBUG) ? console.debug.bind(window.console, LOG_PREFIX) : () => { };\n    this.v = (level >= this.VERBOSE) ? console.log.bind(window.console, LOG_PREFIX) : () => { };\n\n    // Colorized log methods - short versions\n    this.s = (level >= this.VERBOSE) ? console.log.bind(window.console, LOG_PREFIX_COLOR, LOG_STYLES.s) : () => { };\n    this.q = (level >= this.VERBOSE) ? console.log.bind(window.console, LOG_PREFIX_COLOR, LOG_STYLES.q) : () => { };\n    this.p = (level >= this.VERBOSE) ? console.log.bind(window.console, LOG_PREFIX_COLOR, LOG_STYLES.p) : () => { };\n    this.g = (level >= this.VERBOSE) ? console.log.bind(window.console, LOG_PREFIX_COLOR, LOG_STYLES.g) : () => { };\n    this.go = (level >= this.VERBOSE) ? console.log.bind(window.console, LOG_PREFIX_COLOR, LOG_STYLES.go) : () => { };\n    this.r = (level >= this.VERBOSE) ? console.log.bind(window.console, LOG_PREFIX_COLOR, LOG_STYLES.r) : () => { };\n    this.o = (level >= this.VERBOSE) ? console.log.bind(window.console, LOG_PREFIX_COLOR, LOG_STYLES.o) : () => { };\n    this.b = (level >= this.VERBOSE) ? console.log.bind(window.console, LOG_PREFIX_COLOR, LOG_STYLES.b) : () => { };\n    this.y = (level >= this.VERBOSE) ? console.log.bind(window.console, LOG_PREFIX_COLOR, LOG_STYLES.y) : () => { };\n    this.c = (level >= this.VERBOSE) ? console.log.bind(window.console, LOG_PREFIX_COLOR, LOG_STYLES.c) : () => { };\n    this.m = (level >= this.VERBOSE) ? console.log.bind(window.console, LOG_PREFIX_COLOR, LOG_STYLES.m) : () => { };\n    this.gr = (level >= this.VERBOSE) ? console.log.bind(window.console, LOG_PREFIX_COLOR, LOG_STYLES.gr) : () => { };\n    this.br = (level >= this.VERBOSE) ? console.log.bind(window.console, LOG_PREFIX_COLOR, LOG_STYLES.br) : () => { };\n    this.pi = (level >= this.VERBOSE) ? console.log.bind(window.console, LOG_PREFIX_COLOR, LOG_STYLES.pi) : () => { };\n    this.t = (level >= this.VERBOSE) ? console.log.bind(window.console, LOG_PREFIX_COLOR, LOG_STYLES.t) : () => { };\n\n    // Colorized log methods - full name aliases\n    this.goldenrod = this.s;\n    this.steelblue = this.go;\n    this.aqua = this.q;\n    this.purple = this.p;\n    this.green = this.g;\n    this.red = this.r;\n    this.orange = this.o;\n    this.blue = this.b;\n    this.yellow = this.y;\n    this.cyan = this.c;\n    this.magenta = this.m;\n    this.gray = this.gr;\n    this.brown = this.br;\n    this.pink = this.pi;\n    this.teal = this.t;\n\n    this.loggingLevel = level;\n  },\n  get level() { return this.loggingLevel; }\n};\n\nexport const getDnd5eVersion = () => {\n  // Prefer the runtime-initialized value if present (set in hooks/init.js)\n  if (typeof window !== 'undefined' && window.GAS && Number.isFinite(Number(window.GAS.dnd5eVersion))) {\n    return Number(window.GAS.dnd5eVersion);\n  }\n\n  // Fallback: inspect the installed system at runtime if available\n  try {\n    const system = globalThis?.game?.system;\n    if (!system || system.id !== 'dnd5e') return null;\n    const major = Number(system.version?.split?.('.')?.[0]);\n    return Number.isFinite(major) ? major : null;\n  } catch (e) {\n    return null;\n  }\n};\n\nexport const getDndRulesVersion = () => {\n  const ver = (typeof window !== 'undefined' && window.GAS && Number.isFinite(Number(window.GAS.dnd5eVersion)))\n    ? Number(window.GAS.dnd5eVersion)\n    : getDnd5eVersion();\n\n  if (ver === 3) return '2014';\n  return game.settings.get('dnd5e', 'rulesVersion') === 'modern' ? '2024' : '2014';\n};\n\nexport function getLevelByDropType(actor, droppedItem) {\n  // window.GAS.log.d('getLevelByDropType', droppedItem);\n  // window.GAS.log.d('actor', actor);\n  const currentDropItemRegistry = get(dropItemRegistry);\n  // window.GAS.log.d('currentDropItemRegistry', currentDropItemRegistry);\n  switch (droppedItem.type) {\n    case 'class':\n      return actor.classes[droppedItem.system.identifier].system.levels\n    case 'subclass':\n      return actor.classes[droppedItem.system.classIdentifier].system.levels\n    case 'race':\n    case 'background':\n    default:\n      return parseInt(actor.system.details.level) + 1\n  }\n}\n\n/**\n * Gets a rules from a journal by ID and Page\n *\n * @export\n * @async\n * @param {object} rule\n * @param {string} rule.journalId\n * @param {string} rule.pageId\n * @returns {string}\n */\nexport async function getRules(rule) {\n  const { journalId, pageId } = rule;\n  const rules = await game.packs.get('dnd5e.rules');\n  const journal = await rules?.getDocument(journalId);\n  const text = (journal)?.pages?.get(pageId).text;\n  if (!text) {\n    console.error(`Unable to find rule journal on compendium ${DEFAULT_PACKS.RULES}`);\n  }\n  return text;\n}\n\nexport function filterPackForDTPackItems(pack, entries) {\n  // window.GAS.log.d('filterPackForDTPackItems', pack, entries);\n  // window.GAS.log.d('filterPackForDTPackItems filter', entries.filter);\n  if (game.modules.get('donation-tracker')?.active && game.settings.get(MODULE_ID, 'enable-donation-tracker')) {\n\n    //- if the pack has no DT folders, include everything, @why: as this compendium is not managed by DT\n    if (!DTPlugin.packHasDTFolders(pack)) {\n      return entries;\n    }\n    // get dt folder id's from this pack\n    const allowedDTFolderIds = DTPlugin.getDTFolderIdsFromPack(pack)\n    const allDTFolderIds = DTPlugin.getDTFolderIdsFromPack(pack, false)\n\n    const unregisteredAccess = game.settings.get(MODULE_ID, 'enable-donation-tracker-unregistered-access');\n\n    // Game Masters should bypass donation tracker restrictions regardless of their login status\n    if (game.user.isGM) return entries;\n    // filter the index.entries accordingly\n    entries = entries.filter(([key, value]) => {\n\n      // window.GAS.log.d('key', key, value)\n      //- if item is not in a folder\n      // window.GAS.log.d(1)\n      if (!value.folder) {\n        return unregisteredAccess;\n      }\n\n      //- if the item is in a folder that is not a real folder (e.g. deleted folder)\n      // window.GAS.log.d(2)\n      if (!pack.folders.get(value.folder)) return false;\n\n      //- if the item is in a DT folder tree, include it\n      // window.GAS.log.d(4)\n      if (allowedDTFolderIds.includes(value.folder)) return true;\n      // window.GAS.log.d(5)\n\n      //- if item is in a folder that is not a DT folder\n      if (!allDTFolderIds.includes(value.folder)) {\n        // window.GAS.log.d(6)\n        return unregisteredAccess;\n      }\n\n      // window.GAS.log.d(7)\n\n      return false;\n    });\n  }\n  return entries;\n}\n\nexport const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));\n\n\n/**\n * Extracts items from all compendium packs including subfolders.\n * Use this if you're happy with the default pack index.\n * @param {Array} packs compendium packs\n * @param {Array} keys pack data to extract\n * @returns {Array} extracted items\n */\nexport function extractItemsFromPacksSync(packs, keys) {\n  const items = [];\n\n  for (const pack of packs) {\n    // window.GAS.log.d('extractItemsFromPacks pack.metadata', pack.metadata);\n\n    // window.GAS.log.d('pack.metadata.name', pack.metadata.name);\n    if (!pack.index) {\n      ui.notifications.error(game.i18n.localize('GAS.Error.PackIndexNotFound'));\n    }\n    let entries = pack.index.entries()\n    // window.GAS.log.d('entries', entries);\n    // @todo if DonationTracker enabled then https://github.com/geoidesic/foundryvtt-actor-studio/issues/32#issuecomment-2166888022\n    entries = filterPackForDTPackItems(pack, entries);\n    window.GAS.log.d('entries post', entries);\n    let packItems = extractMapIteratorObjectProperties(entries, keys);\n    packItems = packItems.map(item => ({\n      ...item,\n      label: item.label,\n      compoundLabel: `[${pack.metadata.label}] ${item.label}`,\n      packName: pack.metadata.name,\n      packId: pack.metadata.id,\n      packLabel: pack.metadata.label,\n      packType: pack.metadata.type,\n      packPath: pack.metadata.path,\n      packSystem: pack.metadata.system,\n      sourceBook: pack.metadata?.flags?.dnd5e?.sourceBook || null\n    }));\n    // window.GAS.log.d('packItems', packItems);\n    items.push(...packItems);\n  }\n  return items;\n}\n\n/**\n * Gets a localized string\n * @param {string} string - The string to localize\n * @return {string} The localized string\n */\nexport function localize(string) {\n  if (typeof game === 'undefined') return string; //- avoid lint error\n  return game.i18n.localize(`${MODULE_CODE}.${string}`);\n}\n\n\n/**\n * Extracts items from all compendium packs including subfolders.\n * Use this if you need extra index info (via async)\n * @param {Array} packs compendium packs\n * @param {Array} keys pack data to extract\n * @param {boolean|Array} nonIndexKeys pack data to extract that doesn't exist in the index, thus we need to generate a new index, which is an async process\n * @returns {Array} extracted items\n */\nexport async function extractItemsFromPacksAsync(packs, keys, nonIndexKeys = false) {\n  const items = [];\n  // window.GAS.log.d('extractItemsFromPacks packs', packs);\n  // window.GAS.log.d('nonIndexKeys', nonIndexKeys);\n  for (const pack of packs) {\n\n    let index = await pack.getIndex({\n      fields: nonIndexKeys,\n    });\n\n    if (!pack) continue;\n    if (!index) {\n      ui.notifications.error(game.i18n.localize('GAS.Error.PackIndexNotFound'));\n    }\n\n    // window.GAS.log.d('extractItemsFromPacks pack.metadata', pack.metadata);\n    // window.GAS.log.d('extractItemsFromPacks pack.name', pack.metadata.name);\n    // window.GAS.log.d('extractItemsFromPacks pack', pack);\n    // window.GAS.log.d('extractItemsFromPacks packindex', index);\n    let entries = index.entries()\n    // window.GAS.log.d('extractItemsFromPacks entries', entries);\n    entries = filterPackForDTPackItems(pack, entries);\n    // window.GAS.log.d('extractItemsFromPacks entries post', entries);\n\n    let packItems = extractMapIteratorObjectProperties(entries, [...keys, ...nonIndexKeys]);\n    \n    // Debug: Log the first few items to see the data structure\n    if (packItems.length > 0) {\n      // console.log('Enhanced index data structure sample:', {\n      //   packName: pack.metadata.name,\n      //   firstItem: packItems[0],\n      //   keys: [...keys, ...nonIndexKeys],\n      //   hasSystemFields: nonIndexKeys.some(key => key.startsWith('system.'))\n      // });\n    }\n    \n    packItems = packItems.map(item => ({\n      ...item,\n      packName: pack.metadata.name,\n      packId: pack.metadata.id,\n      packLabel: pack.metadata.label,\n      packType: pack.metadata.type,\n      packPath: pack.metadata.path,\n      packSystem: pack.metadata.system,\n    }));\n    // window.GAS.log.d('packItems', packItems)\n    items.push(...packItems);\n  }\n  // window.GAS.log.d('items', items)\n  return items;\n}\n\n/**\n * Extracts properties from a map iterator object\n * @param {MapIterator} mapIterator - The map iterator object\n * @param {Array} keys - The keys to extract\n * @returns {Array} The extracted properties\n */\nexport function extractMapIteratorObjectProperties(mapIterator, keys) {\n  const newArray = [];\n  for (const [key, data] of mapIterator) {\n    // window.GAS.log.b('extractMapIteratorObjectProperties', key, data);\n    const newObj = {};\n    \n    // Debug: Log the first item to see the data structure\n    if (newArray.length === 0) {\n      // console.log('extractMapIteratorObjectProperties - First item data:', {\n      //   key,\n      //   data,\n      //   keys,\n      //   dataKeys: Object.keys(data),\n      //   hasSystemFields: keys.some(k => k.startsWith('system.'))\n      // });\n    }\n    \n    keys.forEach((k) => {\n      if (k.includes('->')) {\n        const split = k.split('->');\n        newObj[split[1]] = data[split[0]];\n      } else if (k.includes('.')) {\n        // For enhanced index data, the system fields are returned as flat properties\n        // Check if the field exists directly in the data\n        if (data.hasOwnProperty(k)) {\n          newObj[k] = data[k];\n        } else {\n          // Fallback to nested property extraction for backward compatibility\n          const value = getNestedProperty(data, k);\n          setNestedProperty(newObj, k, value);\n        }\n        \n        // Debug: Log system field extraction\n        if (k.startsWith('system.')) {\n          // console.log(`System field extraction: ${k} = ${newObj[k]}`, {\n          //   sourceData: data,\n          //   extractedValue: newObj[k],\n          //   hasDirectProperty: data.hasOwnProperty(k)\n          // });\n        }\n      } else {\n        newObj[k] = data[k];\n      }\n    });\n    newObj.key = key;\n    newArray.push(newObj);\n  }\n  return newArray;\n}\n\nexport function getNestedProperty(obj, path) {\n  return path.split('.').reduce((acc, key) => acc && acc[key], obj);\n}\n\nexport function setNestedProperty(obj, path, value) {\n  const keys = path.split('.');\n  const lastKey = keys.pop();\n  const lastObj = keys.reduce((acc, key) => acc[key] = acc[key] || {}, obj);\n  lastObj[lastKey] = value;\n}\n\nexport function getFoldersFromMultiplePacks(packs, depth = 1) {\n  const folders = [];\n  for (const pack of packs) {\n    const packFolders = getPackFolders(pack, depth);\n    folders.push(...packFolders);\n  }\n  return folders;\n}\n\nexport function getPackFolders(pack, depth = 1) {\n  const allRootFolders = extractMapIteratorObjectProperties(pack.folders.entries(), ['depth', 'name', '_id']);\n  const foldersAtDepth = allRootFolders.filter(x => x.depth === depth);\n  return foldersAtDepth\n}\n\nexport const getPacksFromSettings = (type) => {\n  const settings = game.settings.get(MODULE_ID, 'compendiumSources');\n  // Return empty array if settings or type doesn't exist\n  if (!settings || !settings[type]) {\n    return [];\n  }\n\n  let filteredPackNames = settings[type];\n  const packs = [];\n\n  filteredPackNames = filteredPackNames.filter(packName => {\n    const pack = game.packs.get(packName);\n    if (pack) {\n      packs.push(pack);\n      return true;\n    }\n    return false;\n  });\n\n  // Update settings if any packs were removed\n  if (filteredPackNames.length !== settings[type].length) {\n    settings[type] = filteredPackNames;\n    // Only persist the settings after the game is ready; otherwise defer\n    if (game.ready) {\n      game.settings.set(MODULE_ID, 'compendiumSources', settings);\n    } else {\n      try {\n        // Defer the write to the first 'ready' tick\n        globalThis.Hooks?.once?.('ready', () => {\n          try { game.settings.set(MODULE_ID, 'compendiumSources', settings); } catch (_) {}\n        });\n      } catch (_) {}\n    }\n  }\n\n  return packs;\n}\n\nexport const getAllPacksFromAllSettings = () => {\n  const settings = game.settings.get(MODULE_ID, 'compendiumSources');\n  const types = Object.keys(settings);\n  const packs = [];\n  for (const type of types) {\n    const filteredPackNames = settings[type];\n    for (const packName of filteredPackNames) {\n      packs.push(game.packs.get(packName));\n    }\n  }\n  return packs;\n}\n\nexport const getAllPackIdsFromAllSettings = () => {\n  const packs = getAllPacksFromAllSettings();\n  // window.GAS.log.d('getAllPackIdsFromAllSettings', packs);\n  return packs.map(p => {\n    return p.collection\n  });\n}\n\nexport function getAdvancementValue(advancement, key) {\n  if (game.version > 12) {\n    return advancement[key] || null;\n  } else {\n    return advancement.configuration?.[key] || null\n  }\n}\n\nexport function ucfirst(str) {\n  if (!str) return str;\n  return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();\n}\n\nexport function camelCaseToTitleCase(camelCaseStr) {\n  // Split the string at each uppercase letter\n  const words = camelCaseStr.replace(/([A-Z])/g, ' $1').trim();\n\n  // Capitalize the first letter of each word and join them with spaces\n  const titleCaseStr = words.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');\n\n  return titleCaseStr;\n}\n\nexport const getCompendiumSource = (item) => {\n  // window.GAS.log.d('getCompendiumSource', item);\n  let sourceId;\n  if (game.version < 12) {\n    sourceId = item.flags.core.sourceId;\n  } else {\n    sourceId = item._stats.compendiumSource;\n  }\n  // window.GAS.log.d('sourceId', sourceId);\n  return sourceId;\n}\n\n/**\n * Resolve the sheet id for the core dnd5e character sheet in the current environment.\n * Returns something like `dnd5e.CharacterActorSheet` (v13/v4) or `dnd5e.ActorSheet5eCharacter2`/`dnd5e.ActorSheet5eCharacter` (older).\n * Falls back to the default registered sheet if a dnd5e sheet is not found.\n * @param {Actor} actor\n * @returns {string|undefined}\n */\nfunction resolveDnd5eCoreCharacterSheetId(actor) {\n  try {\n    // We only care about character actors for this utility.\n    const type = actor?.type ?? 'character';\n    const config = CONFIG?.Actor?.sheetClasses?.[type] ?? {};\n    const entries = Object.entries(config);\n    if (!entries.length) return undefined;\n\n    // Prefer V2 sheet first, then the newer V1, then legacy.\n    const priority = [\n      'dnd5e.CharacterActorSheet',\n      'dnd5e.ActorSheet5eCharacter2',\n      'dnd5e.ActorSheet5eCharacter'\n    ];\n    for (const id of priority) {\n      if (config[id]) return id;\n    }\n\n    // Fallback: any sheet whose scope is dnd5e.\n    const dnd5eEntry = entries.find(([id]) => id.startsWith('dnd5e.'));\n    if (dnd5eEntry) return dnd5eEntry[0];\n\n    // Last resort: current default sheet id for this subtype.\n    const DSC = foundry?.applications?.apps?.DocumentSheetConfig;\n    if (DSC) {\n      const { defaultClass } = DSC.getSheetClassesForSubType('Actor', type);\n      return defaultClass;\n    }\n  } catch (e) {\n    window.GAS?.log?.w('resolveDnd5eCoreCharacterSheetId failed', e);\n  }\n  return undefined;\n}\n\n/**\n * Wait for the actor to have a sheet instance of a particular registered sheet id.\n * @param {Actor} actor\n * @param {string} sheetId\n * @param {number} [timeoutMs=1500]\n */\nasync function waitForSheetClass(actor, sheetId, timeoutMs = 1500) {\n  const type = actor?.type ?? 'character';\n  const cfg = CONFIG?.Actor?.sheetClasses?.[type]?.[sheetId];\n  const Expected = cfg?.cls;\n  if (!Expected) return;\n  const started = Date.now();\n  while (Date.now() - started < timeoutMs) {\n    // Accessor ensures an instance exists\n    const sheet = actor.sheet;\n    if (sheet && sheet instanceof Expected) return;\n    await delay(50);\n  }\n}\n\n/**\n * Determine the actor's current effective sheet id: per-actor flag or default.\n * @param {Actor} actor\n * @returns {string|undefined}\n */\nfunction getCurrentEffectiveSheetId(actor) {\n  try {\n    const DSC = foundry?.applications?.apps?.DocumentSheetConfig;\n    const type = actor?.type ?? 'character';\n    const currentFlag = actor.getFlag('core', 'sheetClass');\n    if (currentFlag) return currentFlag;\n    if (DSC) {\n      const { defaultClass } = DSC.getSheetClassesForSubType('Actor', type);\n      return defaultClass;\n    }\n  } catch (e) {\n    window.GAS?.log?.w('getCurrentEffectiveSheetId failed', e);\n  }\n}\n\n/**\n * Temporarily switch an Actor's sheet to a target sheet id, then provide a restore function to revert.\n * Uses the same mechanism as the UI: sets the `core.sheetClass` flag on the document.\n * If the current sheet is already the target, no change is made.\n * @param {Actor} actor\n * @param {string|undefined} targetSheetId\n * @returns {Promise<{currentSheetId:string, restore: function(): Promise<void>}>}\n */\nasync function switchActorSheetTemporarily(actor, targetSheetId) {\n  const DSC = foundry?.applications?.apps?.DocumentSheetConfig;\n  const type = actor?.type ?? 'character';\n  const currentFlag = actor.getFlag('core', 'sheetClass');\n  const wasOpen = !!actor.sheet?.rendered;\n  let currentSheetId = currentFlag ?? '';\n  if (!currentSheetId && DSC) {\n    const { defaultClass } = DSC.getSheetClassesForSubType('Actor', type);\n    currentSheetId = defaultClass;\n  }\n\n  // If no valid target or already on target, do nothing.\n  if (!targetSheetId || targetSheetId === currentSheetId) {\n    return {\n      currentSheetId,\n      restore: async () => {}\n    };\n  }\n\n  // Apply the override to switch sheets, mirroring UI behavior (use blank string to clear; concrete id to set).\n  await actor.setFlag('core', 'sheetClass', targetSheetId);\n  // Force a sheet refresh to immediately instantiate the new class\n  if (typeof actor._onSheetChange === 'function') {\n    await actor._onSheetChange({ sheetOpen: wasOpen });\n  }\n  await waitForSheetClass(actor, targetSheetId);\n\n  // Provide a restore function to revert the override.\n  return {\n    currentSheetId,\n    restore: async () => {\n      const revertTo = currentFlag ?? '';\n      // wait briefly for any sheet changes scheduled by the drop handler to complete\n      await delay(100);\n      await actor.setFlag('core', 'sheetClass', revertTo);\n      if (typeof actor._onSheetChange === 'function') {\n        await actor._onSheetChange({ sheetOpen: wasOpen });\n      }\n      if (revertTo) {\n        await waitForSheetClass(actor, revertTo);\n      } else if (DSC) {\n        // If we cleared the override, wait for the default class to settle\n        const { defaultClass } = DSC.getSheetClassesForSubType('Actor', type);\n        if (defaultClass) await waitForSheetClass(actor, defaultClass);\n      }\n\n      // Verify restoration; if not correct, retry once more.\n      const expectedId = revertTo || (DSC ? DSC.getSheetClassesForSubType('Actor', type).defaultClass : undefined);\n      const effectiveId = getCurrentEffectiveSheetId(actor);\n      if (expectedId && effectiveId !== expectedId) {\n        window.GAS?.log?.w('[UTILITY] Sheet restore mismatch; retrying', { expectedId, effectiveId });\n        await delay(150);\n        await actor.setFlag('core', 'sheetClass', revertTo);\n        if (typeof actor._onSheetChange === 'function') {\n          await actor._onSheetChange({ sheetOpen: wasOpen });\n        }\n        if (revertTo) await waitForSheetClass(actor, revertTo);\n        else if (DSC) {\n          const { defaultClass } = DSC.getSheetClassesForSubType('Actor', type);\n          if (defaultClass) await waitForSheetClass(actor, defaultClass);\n        }\n      }\n    }\n  };\n}\n\n/**\n * Prepares an item for dropping onto an actor by creating a new Item instance from the provided data.\n * Handles both level-up and initial character creation scenarios differently:\n * - For level-up with multi-class: Uses the direct UUID of the item\n * - For regular level-up: Uses the compendium source of the item\n * - For initial character creation: Creates from the direct UUID\n * \n * @param {Object} options\n * @param {Object} options.itemData - The source item data containing UUID and compendium information\n * @param {boolean} options.isLevelUp - Whether this is being called during level-up\n * @param {boolean} options.isNewMultiClass - Whether this is a multi-class level-up\n * @returns {Promise<Item|undefined>} The prepared Item instance, or undefined if item creation fails\n */\nexport const prepareItemForDrop = async ({ itemData, isLevelUp, isNewMultiClass }) => {\n  // window.GAS.log.d('prepareItemForDrop');\n  // window.GAS.log.d('isLevelUp? ', isLevelUp);\n  // window.GAS.log.d('isNewMultiClass? ', isNewMultiClass);\n  // window.GAS.log.d('itemData', itemData);\n\n  let item\n  if (isLevelUp && itemData.type === 'class') {\n    if (isNewMultiClass) {\n      item = await Item.implementation.fromDropData({ type: 'Item', uuid: itemData.uuid });\n    } else {\n      item = await Item.implementation.fromDropData({ type: 'Item', uuid: getCompendiumSource(itemData) });\n    }\n\n    if (!item) {\n      log.e('Item not found in compendium', itemData._stats.compendiumSource);\n      ui.notifications.error(game.i18n.localize('GAS.Error.ItemNotFoundInCompendium'));\n      return\n    }\n  } else {\n    const dropData = {\n      type: 'Item',\n      uuid: itemData.uuid,\n    }\n    // window.GAS.log.d('dropData', dropData);\n    item = await Item.implementation.fromDropData(dropData);\n    // window.GAS.log.d('item', item);\n  }\n  return item;\n}\n\n\n/** \n * There are differences in how in-memory documents can be updated between versions of FoundryVTTv12 and v13\n * This function handles the differences and ensures the source is updated correctly.\n * THis is necessary because the TRL library doesn't support innate reactivity to the in-memory documents.\n * @param {Object} source - The source object to update\n * @param {Object} val - The value to update the source with\n * @returns {Promise<void>} A promise that resolves when the source is updated\n */\nexport const updateSource = async (source, val) => {\n  if(source.uuid) {\n    source.update(val);\n  } else {\n    window.GAS.log.p('updateSource', source, val)\n    await source.updateSource(val);\n    await tick();\n    if(source.render) {\n      source.render();\n      window.GAS.log.p('updated source', source)\n    }\n  }\n};\n\nexport const deleteSource = async (source, key) => {\n  for(const item of source[key]) {\n    await source.items.delete(item.id);\n  }\n  await tick();\n  if(source.render) {\n    source.render();\n  }\n}\n\n/**\n * This function is used to get the items from the selected NPC and set them on the in-memory actor.\n * This requires a degree of mapping and flagging because item uuids in the compendium are not \n * the same as the uuids in the in-memory actor.\n * @param {Object} selectedNpcBase - The base NPC object from the compendium\n * @param {Object} actor - The in-memory actor object\n * @param {string} actorName - The name of the actor\n * @returns {Promise<void>} A promise that resolves when the items are set on the in-memory actor\n */\nexport const getAndSetActorItems = async (selectedNpcBase, actor, actorName) => {\n  if (selectedNpcBase && actor) {\n    // Convert embedded items to plain data for source update\n    const items = [];\n    try {\n      const arr = selectedNpcBase.items && (selectedNpcBase.items.contents || Array.from(selectedNpcBase.items) || []);\n      for (const it of arr) {\n        if (!it) continue;\n        const data = it.toObject();\n        // Ensure a fresh ID is generated on the in-memory actor\n        if (data && data._id) delete data._id;\n        // Persist the original compendium UUID under our module namespace so later tabs can reference it\n        try {\n          const srcUuid = it?.uuid || it?.flags?.core?.sourceId || it?.system?.sourceId || null;\n          if (srcUuid) {\n            const fu = (globalThis?.foundry && globalThis.foundry.utils) ? globalThis.foundry.utils : undefined;\n            if (fu?.setProperty) {\n              fu.setProperty(data, `flags.${MODULE_ID}.sourceUuid`, srcUuid);\n            } else {\n              data.flags = data.flags || {};\n              data.flags[MODULE_ID] = { ...(data.flags[MODULE_ID] || {}), sourceUuid: srcUuid };\n            }\n          }\n        } catch (_) {}\n        items.push(data);\n      }\n    } catch (_) {\n      // no-op; fallback to empty items\n    }\n    // Update the in-memory actor source with type, name and items\n    await deleteSource(actor, 'items');\n    await updateSource(actor, {\n      type: 'npc',\n      name: actorName || selectedNpcBase.name,\n      items\n    });\n    // Also update store used by NPC Features list\n    try { itemsFromActor.set(items); } catch (_) {}\n    // After source update, set module flags on the embedded Item documents as well\n    try {\n      const sourceUuidsByNameType = new Map(items.map(d => [`${d.name}::${d.type}`, d?.flags?.[MODULE_ID]?.sourceUuid]));\n      const setFlags = [];\n      actor.items?.forEach?.((doc) => {\n        const key = `${doc?.name}::${doc?.type}`;\n        const src = sourceUuidsByNameType.get(key);\n        if (src && !doc.getFlag?.(MODULE_ID, 'sourceUuid')) {\n          setFlags.push(doc.setFlag(MODULE_ID, 'sourceUuid', src));\n        }\n      });\n      if (setFlags.length > 0) await Promise.allSettled(setFlags);\n    } catch (_) {}\n  }\n}\n\n/**\n * Copies NPC stats (ability scores, hit points, armor class, etc.) from the selected NPC base to the in-memory actor\n * @param {Object} selectedNpcBase - The selected NPC base document\n * @param {Object} actor - The in-memory actor object\n * @returns {Promise<void>} A promise that resolves when the stats are copied\n */\nexport const copyNpcStatsToActor = async (selectedNpcBase, actor) => {\n  if (selectedNpcBase && actor) {\n    try {\n      // Get the NPC base data\n      const npcData = selectedNpcBase.toObject();\n      \n      // Copy the core stats that should be preserved\n      const statsToCopy = {\n        system: {\n          abilities: npcData.system?.abilities || {},\n          attributes: npcData.system?.attributes || {},\n          details: npcData.system?.details || {},\n          traits: npcData.system?.traits || {},\n          skills: npcData.system?.skills || {},\n          resources: npcData.system?.resources || {},\n          currency: npcData.system?.currency || {},\n          inventory: npcData.system?.inventory || {},\n          spells: npcData.system?.spells || {},\n          effects: npcData.system?.effects || {},\n          modifiers: npcData.system?.modifiers || {},\n          profs: npcData.system?.profs || {},\n          bonuses: npcData.system?.bonuses || {},\n          saves: npcData.system?.saves || {},\n          attributes: npcData.system?.attributes || {},\n          ac: npcData.system?.ac || {},\n          hp: npcData.system?.hp || {},\n          speed: npcData.system?.speed || {},\n          spellcasting: npcData.system?.spellcasting || {},\n          level: npcData.system?.level || {},\n          cr: npcData.system?.cr || {},\n          xp: npcData.system?.xp || {},\n          alignment: npcData.system?.alignment || {},\n          size: npcData.system?.size || {},\n          type: npcData.system?.type || {},\n          subtype: npcData.system?.subtype || {},\n          senses: npcData.system?.senses || {},\n          languages: npcData.system?.languages || {},\n          damage: npcData.system?.damage || {},\n          resistances: npcData.system?.resistances || {},\n          immunities: npcData.system?.immunities || {},\n          vulnerabilities: npcData.system?.vulnerabilities || {},\n          conditionImmunities: npcData.system?.conditionImmunities || {},\n          legendary: npcData.system?.legendary || {},\n          legendaryActions: npcData.system?.legendaryActions || {},\n          lair: npcData.system?.lair || {},\n          lairActions: npcData.system?.lairActions || {},\n          regionalEffects: npcData.system?.regionalEffects || {},\n          regionalEffectsEnd: npcData.system?.regionalEffectsEnd || {},\n          environment: npcData.system?.environment || {},\n          source: npcData.system?.source || {},\n          page: npcData.system?.page || {},\n          otherSources: npcData.system?.otherSources || {},\n          additionalSources: npcData.system?.additionalSources || {},\n          additionalSources2: npcData.system?.additionalSources2 || {},\n          additionalSources3: npcData.system?.additionalSources3 || {},\n          additionalSources4: npcData.system?.additionalSources4 || {},\n          additionalSources5: npcData.system?.additionalSources5 || {},\n          additionalSources6: npcData.system?.additionalSources6 || {},\n          additionalSources7: npcData.system?.additionalSources7 || {},\n          additionalSources8: npcData.system?.additionalSources8 || {},\n          additionalSources9: npcData.system?.additionalSources9 || {},\n          additionalSources10: npcData.system?.additionalSources10 || {}\n        },\n        flags: npcData.flags || {},\n        img: npcData.img || '',\n        token: npcData.token || {}\n      };\n      \n      // Update the in-memory actor with the copied stats\n      await updateSource(actor, statsToCopy);\n      \n      // Helpful debug output\n      if (window?.GAS?.log?.g) {\n        window.GAS.log.g('[NPC] In-memory actor stats copied from base NPC', actor);\n      } else {\n        console.log('[NPC] In-memory actor stats copied from base NPC', actor);\n      }\n    } catch (error) {\n      window.GAS.log.e('[NPC] Error copying NPC stats to actor:', error);\n    }\n  }\n};\n\n//- used by dropItemRegistry\nexport const dropItemOnCharacter = async (actor, item) => {\n  // window.GAS.log.d('dropItemOnCharacter');\n  // window.GAS.log.d('dropItemOnCharacter item', item);\n  // window.GAS.log.d('actor.sheet._onDropItemCreate fn', actor.sheet._onDropItemCreate);\n  // window.GAS.log.d('actor.sheet._onDropItem fn', actor.sheet._onDropItem);\n\n  // Track the item being dropped by adding it to the actor's flags\n  try {\n    const itemRecord = {\n      name: item.name,\n      uuid: item.uuid\n    };\n    const existingItems = actor.getFlag(MODULE_ID, `droppedItems.${item.type}`) || [];\n    const updatedItems = [...existingItems, itemRecord];\n    await actor.setFlag(MODULE_ID, `droppedItems.${item.type}`, updatedItems);\n    // window.GAS.log.d(`Added ${item.name} to actor's ${item.type} tracking flags`);\n  } catch (error) {\n    window.GAS.log.e('Error updating actor flags for dropped item:', error);\n  }\n\n  window.GAS.log.g('actor.sheet', actor.sheet)\n\n  // Ensure we are using the core dnd5e character sheet for drop handlers, then restore.\n  const desiredSheetId = resolveDnd5eCoreCharacterSheetId(actor);\n  const { currentSheetId, restore } = await switchActorSheetTemporarily(actor, desiredSheetId);\n\n  try {\n    // Proceed with adding the item to the actor using the active sheet's drop handlers\n    if (game.version < 13) {\n      // Use the older _onDropItemCreate for v11/v12\n      // window.GAS.log.d('[UTILITY] Using _onDropItemCreate for v < 13');\n      return await actor.sheet._onDropItemCreate(item);\n    } else {\n      // For v13+, simulate the drop event by calling _onDropItem\n      // window.GAS.log.d('[UTILITY] Simulating _onDropItem for v >= 13');\n\n      // Prepare a minimal mock event object\n      const mockEvent = {\n        preventDefault: () => {},\n        stopPropagation: () => {},\n        target: { closest: () => false }\n      };\n\n      await actor.sheet._onDropItem(mockEvent, item);\n      return true; // Indicate successful simulation attempt\n    }\n  } catch (error) {\n    window.GAS.log.e(`[UTILITY] Error calling sheet drop handler for actor ${actor.id} and item ${item.uuid}:`, error);\n    ui.notifications.error(`Error adding item ${item.name} via simulated drop.`);\n    return false; // Indicate failure\n  } finally {\n    // Always restore the original sheet (if it was different)\n    try {\n      await restore();\n    } catch (restoreErr) {\n      window.GAS.log.w('[UTILITY] Failed to restore original sheet class', {\n        original: currentSheetId,\n        attempted: desiredSheetId,\n        error: restoreErr\n      });\n    }\n  }\n}\n\nexport function itemHasAdvancementChoices(item) {\n  // window.GAS.log.d('Advancement check:', {\n  //   itemName: item.name,\n  //   itemType: item.type,\n  //   hasSystemAdvancement: !!item.system?.advancement,\n  //   hasDirectAdvancement: !!item.advancement,\n  //   systemAdvLength: item.system?.advancement?.length,\n  //   directAdvLength: Array.isArray(item.advancement) ? item.advancement.length : 0\n  // });\n\n  let hasAdvancementChoices = false;\n  const advancements = [];\n\n  // Collect advancements from both possible locations\n  if (Array.isArray(item.advancement)) {\n    advancements.push(...item.advancement);\n  }\n  if (Array.isArray(item.system?.advancement)) {\n    advancements.push(...item.system.advancement);\n  }\n\n  if (!advancements.length) {\n    window.GAS.log.i('No advancements found');\n    return false;\n  }\n\n  // Check each advancement for choices\n  for (const adv of advancements) {\n    // window.GAS.log.d('Checking advancement:', {\n    //   type: adv.type,\n    //   hasChoices: !!(adv.choices || adv.configuration?.choices),\n    //   choicesLocation: adv.choices ? 'direct' : adv.configuration?.choices ? 'configuration' : 'none'\n    // });\n\n    if (adv.choices || adv.configuration?.choices) {\n      hasAdvancementChoices = true;\n      break;\n    }\n  }\n\n  return hasAdvancementChoices;\n}\n\nexport const isAdvancementsForLevelInItem = (level, item) => {\n  // where structure is like system.advancement = [{level: 1, ...}]\n  const adv = item?.system?.advancement.find(adv => adv.level === level)\n  if (adv) return true;\n  return false\n}\n\n// truncate string\nexport function truncate(str, n) {\n  return str.length > n ? str.substr(0, n - 1) + \"...\" : str;\n}\n\n/** @todo: these were from HCT. None of these apply to the current version of Actor Studio */\nexport function userHasRightPermissions() {\n  const userRole = game.user.role;\n\n  // create actor (REQUIRED)\n  if (!((game).permissions.ACTOR_CREATE).includes(userRole)) {\n    ui.notifications?.error(game.i18n.localize('GAS.Permissions.NeedCreateActorError'));\n    return false;\n  }\n\n  // create item (optional)\n  // if (!((game).permissions.ITEM_CREATE).includes(userRole)) {\n  //   ui.notifications?.warn(game.i18n.localize('GAS.Permissions.NeedCreateItemWarn'));\n  // }\n\n  // upload files (optional)\n  // if (!((game).permissions.FILES_UPLOAD).includes(userRole)) {\n  //   ui.notifications?.warn(game.i18n.localize('GAS.Permissions.NeedFileUploadWarn'));\n  // }\n\n  // browse files (optional)\n  // if (!((game).permissions.FILES_BROWSE).includes(userRole)) {\n  //   ui.notifications?.warn(game.i18n.localize('GAS.Permissions.NeedFileBrowseWarn'));\n  // }\n  return true;\n}\n\n/**\n * Determines the level at which a class gains its subclass\n * @param {Object} characterClass - The character class object\n * @param {string} MODULE_ID - The module ID constant\n * @returns {number|boolean} The level at which subclass is gained, or false if not found\n */\nexport function getSubclassLevel(characterClass, MODULE_ID) {\n  // console.trace();\n  // window.GAS.log.d('[getSubclassLevel] characterClass', characterClass)\n  if (!characterClass) {\n    // window.GAS.log.d('[getSubclassLevel] characterClass is false')\n    return false;\n  }\n\n  // Check for dnd5e system 3.x flag\n  const subclassFlag = characterClass.getFlag?.(MODULE_ID, \"subclassLevel\");\n  if (subclassFlag) {\n    // window.GAS.log.d('[getSubclassLevel] from subclassFlag', subclassFlag)\n    return characterClass.getFlag(MODULE_ID, \"subclassLevel\");\n  }\n\n  // Check for dnd5e system 4.x advancement array\n  // window.GAS.log.d('[getSubclassLevel] characterClass.system', characterClass.system.advancement)\n  const subclassLevel = characterClass.system?.advancement\n    ?.find(advancement => advancement.type === \"Subclass\")?.level;\n\n  // window.GAS.log.d('[getSubclassLevel] subclassLevel from advancement', subclassLevel)\n  return subclassLevel || false;\n}\n\n/**\n * Gets the appropriate TextEditor API for the current Foundry version\n * @returns {Object} The TextEditor API object\n */\nexport function getTextEditorAPI() {\n  if (game.version >= 13) {\n    // V13+ uses the new applications.ux.TextEditor.implementation path\n    return foundry.applications.ux.TextEditor.implementation;\n  } else {\n    // V12 uses the global TextEditor\n    return TextEditor;\n  }\n}\n\n/**\n * Enriches HTML content using the appropriate TextEditor API for the current Foundry version\n * @param {string} content - The HTML content to enrich\n * @param {Object} options - Options for enrichment\n * @returns {Promise<string>} The enriched HTML content\n */\nexport async function enrichHTML(content, options = {}) {\n  const textEditor = getTextEditorAPI();\n  const enriched = await textEditor.enrichHTML(content, options);\n\n  try {\n    // Post-process the enriched HTML string to add a tooltip for broken links\n    // that reference the Player's Handbook compendium. We operate on the\n    // HTML string to avoid relying on the current document DOM.\n    if (typeof enriched === 'string' && enriched.length) {\n      // Create a temporary container to query and mutate elements\n      const wrapper = document?.createElement ? document.createElement('div') : null;\n      if (wrapper) {\n        wrapper.innerHTML = enriched;\n\n        // Find elements that are marked as broken content links.\n        // In templates they may be rendered with class \"content-link broken\" or simply \"broken\".\n        const brokenEls = wrapper.querySelectorAll('.content-link.broken, .broken');\n        brokenEls.forEach(el => {\n          // Search attributes and inner text for a Compendium UUID that includes the players handbook id\n          // Commonly the uuid may appear in attributes like 'data-uuid', 'href', or inside the element text.\n          const attrs = ['data-uuid', 'href', 'data-encoded-uuid', 'data-link'];\n          let found = false;\n          for (const a of attrs) {\n            const val = el.getAttribute?.(a);\n            if (val && val.includes && val.includes('Compendium.dnd-players-handbook')) { found = true; break; }\n          }\n          if (!found) {\n            const txt = el.textContent || '';\n            if (txt.includes && txt.includes('Compendium.dnd-players-handbook')) found = true;\n          }\n          if (found) {\n            el.setAttribute('data-tooltip', \"Requires D&D Player's Handbook module to be installed\");\n          }\n        });\n\n        return wrapper.innerHTML;\n      }\n    }\n  } catch (err) {\n    console.warn('enrichHTML post-process failed', err);\n  }\n\n  return enriched;\n}\n\n/**\n * Delete an item from an actor by ID\n * @param {Object} actor - The actor to delete the item from\n * @param {string} itemId - The ID of the item to delete\n * @returns {Promise<boolean>} - True if deletion was successful, false otherwise\n */\nexport const deleteActorItem = async (actor, itemId) => {\n  try {\n    if (!actor?.items?.delete) {\n      console.error('Actor does not support item deletion');\n      return false;\n    }\n\n    await actor.items.delete(itemId);\n    \n    // Force a refresh of the reactive statement\n    await tick();\n    if (actor.render) {\n      actor.render();\n    }\n    \n    return true;\n  } catch (error) {\n    console.error('Error deleting item from actor:', error);\n    return false;\n  }\n};\n\n/**\n * Update a source object with new values\n * @param {Object} source - The source object to update\n * @param {Object} val - The value to update the source with\n * @returns {Promise<void>} A promise that resolves when the source is updated\n */\n\n/**\n * Get filtered feats from configured compendium sources\n * @returns {Promise<Array>} Array of feat items with metadata\n */\nexport async function getFilteredFeats() {\n  try {\n    // Get feat compendium sources from settings\n    const packs = getPacksFromSettings(\"feats\");\n\n    if (!packs || packs.length === 0) {\n      window.GAS.log.d('[getFilteredFeats] No feat compendiums configured in settings');\n      return [];\n    }\n\n    // Define the basic keys available in the default index\n    const indexKeys = [\n      \"_id\",\n      \"name\",\n      \"img\",\n      \"type\",\n      \"uuid\"\n    ];\n\n    // Define keys that are likely NOT in the index and need async loading\n    const nonIndexKeys = [\n      \"system.prerequisites.level\",\n      \"system.prerequisites.abilities\",\n      \"system.prerequisites.features\",\n      \"system.description.value\"\n    ];\n\n    // Extract feat data using extractItemsFromPacksAsync\n    let lightweightItems = await extractItemsFromPacksAsync(packs, indexKeys, nonIndexKeys);\n\n    // Filter for feats only\n    const feats = lightweightItems.filter(item => item.type === \"feat\");\n\n    window.GAS.log.d(`[getFilteredFeats] Loaded ${feats.length} feats from ${packs.length} packs`);\n    return feats;\n\n  } catch (error) {\n    window.GAS.log.e('[getFilteredFeats] Error loading feats:', error);\n    return [];\n  }\n}","import { TJSGameSettings } from '#runtime/svelte/store/fvtt/settings';\nimport { camelCaseToTitleCase } from '~/src/helpers/Utility'\n\nimport { MODULE_ID } from '~/src/helpers/constants';\nclass DonationTrackerGameSettings extends TJSGameSettings {\n   constructor() {\n      super(MODULE_ID);\n   }\n\n   init() {\n      window.GAS.log.i('Registering Actor Studio Donation Tracker integration')\n      const namespace = this.namespace;\n      const allSettings = [];\n\n      allSettings.push({\n         namespace,\n         key: \"enable-donation-tracker\",\n         options: {\n            name: game.i18n.localize('GAS.Setting.DonationTrackerEnabled.Name'),\n            hint: game.i18n.localize('GAS.Setting.DonationTrackerEnabled.Hint'),\n            scope: \"world\",\n            config: true,\n            type: Boolean,\n            default: true,\n            onchange: () => {\n            }\n         }\n      });\n\n      allSettings.push({\n         namespace,\n         key: \"enable-donation-tracker-unregistered-access\",\n         options: {\n            name: game.i18n.localize('GAS.Setting.DonationTracker_UnregisteredAccess.Name'),\n            hint: game.i18n.localize('GAS.Setting.DonationTracker_UnregisteredAccess.Hint'),\n            scope: \"world\",\n            config: true,\n            type: Boolean,\n            default: false,\n            onchange: () => {\n            }\n         }\n      });\n\n      const membershipRanks = game.membership?.RANKS || []\n      // window.GAS.log.d('membershipRanks', membershipRanks)\n\n      if ( Object.keys(membershipRanks).length > 0) {\n         // window.GAS.log.d('Registering Donation Tracker Ranks')\n         for (const [rank, value] of Object.entries(membershipRanks)) {\n            // window.GAS.log.d('rank', rank)\n            if(value === -1) continue;\n            allSettings.push({\n               namespace,\n               key: `donation-tracker-rank-${rank}`,\n               options: {\n                  name: `${camelCaseToTitleCase(rank)}`,\n                  hint: `${game.i18n.localize('GAS.Setting.DonationTrackerRank.Hint')}: ${camelCaseToTitleCase(rank)}`,\n                  scope: \"world\",\n                  config: true,\n                  type: String,\n                  default: `${camelCaseToTitleCase(rank)}`,\n                  onchange: () => {\n                  }\n               }\n            });\n         }\n      }\n      // window.GAS.log.d('allSettings', allSettings)\n      this.registerAll(allSettings, !game.user.isGM);\n   }\n}\n\nexport default new DonationTrackerGameSettings();\n","/**\n * Usage Tracking Integration for Actor Studio\n * \n * This module integrates with the Polar License Manager usage tracking system\n * to collect anonymous usage data for improving the module.\n */\n\nimport { MODULE_ID } from '~/src/helpers/constants';\nimport pkg from '../package.json' assert { type: \"json\" };\n\nclass UsageTracker {\n  constructor() {\n    this.moduleKey = 'actor_studio_v2';\n    this.moduleName = 'Actor Studio';\n    this.moduleVersion = '2.0.0-beta.7';\n    // Select API URL based on env in package.json\n    const env = pkg.env;\n    if (env === 'dev') {\n      this.apiUrl = 'http://localhost:4000/api/v1';\n    } else {\n      this.apiUrl = 'https://polaris.aardvark.games/api/v1';\n    }\n    this.sessionId = this.generateSessionId();\n    this.consentGranted = false;\n    this.offlineEvents = [];\n    this.maxOfflineEvents = 50;\n    this.initialized = false;\n    \n    console.log('[UsageTracker] Usage tracker created, waiting for initialization...');\n  }\n\n  /**\n   * Initialize the usage tracker when settings are ready\n   */\n  initialize() {\n    if (this.initialized) return;\n    \n    console.log('[UsageTracker] Initializing usage tracker...');\n    \n    // Initialize consent from module settings\n    this.initializeConsent();\n    \n    // Set up periodic sync for offline events\n    this.setupOfflineSync();\n    \n    // Track module loaded\n    this.trackModuleLoaded();\n    \n    this.initialized = true;\n    console.log('[UsageTracker] Usage tracker initialized successfully');\n  }\n\n  /**\n   * Initialize consent from module settings\n   */\n  initializeConsent() {\n    try {\n      // Check if module has consent setting\n      const consentSetting = `${MODULE_ID}.usage-tracking`;\n      if (game.settings && game.settings.settings && game.settings.settings.has(consentSetting)) {\n        this.consentGranted = game.settings.get(MODULE_ID, 'usage-tracking');\n        console.log('[UsageTracker] Consent setting found:', this.consentGranted);\n      } else {\n        console.log('[UsageTracker] Consent setting not found, defaulting to false');\n        this.consentGranted = false;\n      }\n    } catch (error) {\n      console.warn('[UsageTracker] Error initializing consent:', error);\n      this.consentGranted = false;\n    }\n  }\n\n\n\n  /**\n   * Generate a unique session ID\n   */\n  generateSessionId() {\n    return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\n  }\n\n  /**\n   * Track a usage event\n   */\n  async trackEvent(eventType, eventData = null) {\n    if (!this.consentGranted) {\n      console.log(`[UsageTracker] Tracking disabled - user consent required for ${this.moduleKey}`);\n      return;\n    }\n\n    const event = {\n      module_id: this.moduleKey,\n      module_version: this.moduleVersion,\n      foundry_version: game.version || 'unknown',\n      session_id: this.sessionId,\n      event_type: eventType,\n      event_data: eventData ? JSON.stringify(eventData) : null\n    };\n\n    try {\n      await this.sendEvent(event);\n      console.log(`[UsageTracker] Event tracked successfully: ${eventType}`);\n    } catch (error) {\n      console.warn(`[UsageTracker] Failed to send event, storing offline:`, error);\n      this.storeOfflineEvent(event);\n    }\n  }\n\n  /**\n   * Send event to API\n   */\n  async sendEvent(event) {\n    const response = await fetch(`${this.apiUrl}/usage/track`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'x-module-api-key': this.moduleKey\n      },\n      body: JSON.stringify(event)\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n    }\n\n    return response.json();\n  }\n\n  /**\n   * Store event for offline sync\n   */\n  storeOfflineEvent(event) {\n    this.offlineEvents.push({\n      ...event,\n      timestamp: Date.now()\n    });\n\n    // Limit offline events to prevent memory issues\n    if (this.offlineEvents.length > this.maxOfflineEvents) {\n      this.offlineEvents.shift();\n    }\n\n    // Store in localStorage for persistence\n    this.saveOfflineEvents();\n  }\n\n  /**\n   * Save offline events to localStorage\n   */\n  saveOfflineEvents() {\n    try {\n      localStorage.setItem(`usage-tracker-${this.moduleKey}`, JSON.stringify(this.offlineEvents));\n    } catch (error) {\n      console.warn('[UsageTracker] Failed to save offline events:', error);\n    }\n  }\n\n  /**\n   * Load offline events from localStorage\n   */\n  loadOfflineEvents() {\n    try {\n      const stored = localStorage.getItem(`usage-tracker-${this.moduleKey}`);\n      if (stored) {\n        this.offlineEvents = JSON.parse(stored);\n      }\n    } catch (error) {\n      console.warn('[UsageTracker] Failed to load offline events:', error);\n      this.offlineEvents = [];\n    }\n  }\n\n  /**\n   * Sync offline events\n   */\n  async syncOfflineEvents() {\n    if (this.offlineEvents.length === 0) return;\n\n    const eventsToSync = [...this.offlineEvents];\n    this.offlineEvents = [];\n\n    for (const event of eventsToSync) {\n      try {\n        await this.sendEvent(event);\n        console.log(`[UsageTracker] Synced offline event: ${event.event_type}`);\n      } catch (error) {\n        console.warn(`[UsageTracker] Failed to sync event, keeping offline:`, error);\n        this.offlineEvents.push(event);\n      }\n    }\n\n    this.saveOfflineEvents();\n  }\n\n  /**\n   * Set up periodic sync for offline events\n   */\n  setupOfflineSync() {\n    // Load existing offline events\n    this.loadOfflineEvents();\n\n    // Sync every 5 minutes\n    setInterval(() => {\n      if (this.consentGranted && this.offlineEvents.length > 0) {\n        this.syncOfflineEvents();\n      }\n    }, 5 * 60 * 1000);\n\n    // Sync on page unload\n    window.addEventListener('beforeunload', () => {\n      if (this.consentGranted && this.offlineEvents.length > 0) {\n        this.syncOfflineEventsOnUnload();\n      }\n    });\n  }\n\n  /**\n   * Sync offline events on page unload using sendBeacon\n   */\n  syncOfflineEventsOnUnload() {\n    if (this.offlineEvents.length === 0) return;\n\n    const eventsToSync = [...this.offlineEvents];\n    \n    for (const event of eventsToSync) {\n      try {\n        const blob = new Blob([JSON.stringify(event)], { type: 'application/json' });\n        navigator.sendBeacon(`${this.apiUrl}/usage/track`, blob);\n      } catch (error) {\n        console.warn('[UsageTracker] Failed to send beacon:', error);\n      }\n    }\n  }\n\n\n\n  /**\n   * Track module loaded event\n   */\n  trackModuleLoaded() {\n    this.trackEvent('module_loaded', {\n      foundry_version: game.version,\n      system_id: game.system.id,\n      system_version: game.system.version,\n      user_role: game.user.role,\n      is_gm: game.user.isGM,\n      user_type: this.getUserType()\n    });\n  }\n\n  /**\n   * Track session start\n   */\n  trackSessionStart() {\n    this.trackEvent('session_start', {\n      foundry_version: game.version,\n      system_id: game.system.id,\n      system_version: game.system.version,\n      user_role: game.user.role,\n      is_gm: game.user.isGM,\n      user_type: this.getUserType(),\n      world_name: game.world.name,\n      world_id: game.world.id\n    });\n  }\n\n  /**\n   * Track session end\n   */\n  trackSessionEnd() {\n    this.trackEvent('session_end');\n  }\n\n  /**\n   * Track feature usage\n   */\n  trackFeatureUsed(featureName, additionalData = {}) {\n    this.trackEvent('feature_used', {\n      feature: featureName,\n      ...additionalData\n    });\n  }\n\n  /**\n   * Track error\n   */\n  trackError(errorType, errorMessage, additionalData = {}) {\n    this.trackEvent('error', {\n      error_type: errorType,\n      error_message: errorMessage,\n      ...additionalData\n    });\n  }\n\n  /**\n   * Track actor creation\n   */\n  trackActorCreation(actorType, additionalData = {}) {\n    this.trackFeatureUsed('actor_creation', {\n      actor_type: actorType,\n      ...additionalData\n    });\n  }\n\n  /**\n   * Track actor studio opened\n   */\n  trackActorStudioOpened(actorName, folderName, actorType) {\n    this.trackFeatureUsed('actor_studio_opened', {\n      actor_name: actorName,\n      folder_name: folderName,\n      actor_type: actorType,\n      user_role: game.user.role,\n      is_gm: game.user.isGM,\n      user_type: this.getUserType(),\n      foundry_version: game.version,\n      system_id: game.system.id\n    });\n  }\n\n  /**\n   * Track advancement capture\n   */\n  trackAdvancementCapture(initial = false) {\n    this.trackFeatureUsed('advancement_capture', {\n      initial: initial\n    });\n  }\n\n  /**\n   * Track compendium interaction\n   */\n  trackCompendiumInteraction(compendiumName, action) {\n    this.trackFeatureUsed('compendium_interaction', {\n      compendium: compendiumName,\n      action: action\n    });\n  }\n\n  /**\n   * Get descriptive user type based on FoundryVTT user role\n   */\n  getUserType() {\n    const role = game.user.role;\n    const isGM = game.user.isGM;\n    \n    // Map FoundryVTT roles to more descriptive types\n    const userTypeMap = {\n      'none': 'none',\n      'player': 'player',\n      'trusted': 'trusted_player',\n      'assistant': 'assistant',\n      'gamemaster': 'gamemaster'\n    };\n    \n    let userType = userTypeMap[role] || 'unknown';\n    \n    // Add additional context for GMs\n    if (isGM) {\n      userType = 'gamemaster';\n    }\n    \n    return userType;\n  }\n}\n\n// Create global instance\nwindow.GASUsageTracker = new UsageTracker();\n\n// Export for use in other modules\nexport default window.GASUsageTracker; ","import { PUBLIC_VERSION } from '../../../shared/version.js';\n\nif (typeof window !== 'undefined')\n\t// @ts-ignore\n\t(window.__svelte || (window.__svelte = { v: new Set() })).v.add(PUBLIC_VERSION);\n","import { isObject, isIterable } from '@typhonjs-fvtt/runtime/util/object';\n\n/**\r\n * Provides resources for parsing style strings.\r\n */\r\nclass StyleParse\r\n{\r\n   static #regexPixels = /(\\d+)\\s*px/;\r\n\r\n   /**\r\n    * Parses a pixel string / computed styles. Ex. `100px` returns `100`.\r\n    *\r\n    * @param {string}   value - Value to parse.\r\n    *\r\n    * @returns {number|undefined} The integer component of a pixel string.\r\n    */\r\n   static pixels(value)\r\n   {\r\n      if (typeof value !== 'string') { return void 0; }\r\n\r\n      const isPixels = this.#regexPixels.test(value);\r\n      const number = parseInt(value);\r\n\r\n      return isPixels && Number.isFinite(number) ? number : void 0;\r\n   }\r\n\r\n   /**\r\n    * Returns the pixel value for `1rem` based on the root document element. You may apply an optional multiplier.\r\n    *\r\n    * @param {number} [multiplier=1] - Optional multiplier to apply to `rem` pixel value; default: 1.\r\n    *\r\n    * @param {object} [options] - Optional parameters.\r\n    *\r\n    * @param {Document} [options.targetDocument=document] The target DOM {@link Document} if different from the main\r\n    *        browser global `document`.\r\n    *\r\n    * @returns {number} The pixel value for `1rem` with or without a multiplier based on the root document element.\r\n    */\r\n   static remPixels(multiplier = 1, { targetDocument = document } = {})\r\n   {\r\n      return targetDocument?.documentElement ?\r\n       multiplier * parseFloat(globalThis.getComputedStyle(targetDocument.documentElement).fontSize) : void 0;\r\n   }\r\n}\n\n/**\r\n * Provides a managed dynamic style sheet / element useful in configuring global CSS variables. When creating an\r\n * instance of TJSStyleManager you must provide a \"document key\" / string for the style element added. The style element\r\n * can be accessed via `document[docKey]`.\r\n *\r\n * Instances of TJSStyleManager can also be versioned by supplying a positive integer greater than or equal to `1` via\r\n * the 'version' option. This version number is assigned to the associated style element. When a TJSStyleManager\r\n * instance is created and there is an existing instance with a version that is lower than the current instance all CSS\r\n * rules are removed letting the higher version to take precedence. This isn't a perfect system and requires thoughtful\r\n * construction of CSS variables exposed, but allows multiple independently compiled TRL packages to load the latest\r\n * CSS variables. It is recommended to always set `overwrite` option of {@link TJSStyleManager.setProperty} and\r\n * {@link TJSStyleManager.setProperties} to `false` when loading initial values.\r\n */\r\nclass TJSStyleManager\r\n{\r\n   /** @type {CSSStyleRule} */\r\n   #cssRule;\r\n\r\n   /** @type {string} */\r\n   #docKey;\r\n\r\n   /** @type {string} */\r\n   #selector;\r\n\r\n   /** @type {HTMLStyleElement} */\r\n   #styleElement;\r\n\r\n   /** @type {number} */\r\n   #version;\r\n\r\n   /**\r\n    *\r\n    * @param {object}   opts - Options.\r\n    *\r\n    * @param {string}   opts.docKey - Required key providing a link to a specific style sheet element.\r\n    *\r\n    * @param {string}   [opts.selector=:root] - Selector element.\r\n    *\r\n    * @param {Document} [opts.document] - Target document to load styles into.\r\n    *\r\n    * @param {number}   [opts.version] - An integer representing the version / level of styles being managed.\r\n    */\r\n   constructor({ docKey, selector = ':root', document = globalThis.document, version } = {})\r\n   {\r\n      if (typeof docKey !== 'string') { throw new TypeError(`StyleManager error: 'docKey' is not a string.`); }\r\n\r\n      if (Object.prototype.toString.call(document) !== '[object HTMLDocument]')\r\n      {\r\n         throw new TypeError(`TJSStyleManager error: 'document' is not an instance of HTMLDocument.`);\r\n      }\r\n\r\n      if (typeof selector !== 'string') { throw new TypeError(`StyleManager error: 'selector' is not a string.`); }\r\n\r\n      if (version !== void 0 && !Number.isSafeInteger(version) && version < 1)\r\n      {\r\n         throw new TypeError(`StyleManager error: 'version' is defined and is not a positive integer >= 1.`);\r\n      }\r\n\r\n      this.#selector = selector;\r\n      this.#docKey = docKey;\r\n      this.#version = version;\r\n\r\n      if (document[this.#docKey] === void 0)\r\n      {\r\n         this.#styleElement = document.createElement('style');\r\n\r\n         document.head.append(this.#styleElement);\r\n\r\n         // Set initial style manager version if any supplied.\r\n         this.#styleElement._STYLE_MANAGER_VERSION = version;\r\n\r\n         this.#styleElement.sheet.insertRule(`${selector} {}`, 0);\r\n\r\n         this.#cssRule = this.#styleElement.sheet.cssRules[0];\r\n\r\n         document[docKey] = this.#styleElement;\r\n      }\r\n      else\r\n      {\r\n         this.#styleElement = document[docKey];\r\n         this.#cssRule = this.#styleElement.sheet.cssRules[0];\r\n\r\n         if (version)\r\n         {\r\n            const existingVersion = this.#styleElement._STYLE_MANAGER_VERSION ?? 0;\r\n\r\n            // Remove all existing CSS rules / text if version is greater than existing version.\r\n            if (version > existingVersion)\r\n            {\r\n               this.#cssRule.style.cssText = '';\r\n            }\r\n         }\r\n      }\r\n   }\r\n\r\n   /**\r\n    * @returns {string} Provides an accessor to get the `cssText` for the style sheet.\r\n    */\r\n   get cssText()\r\n   {\r\n      return this.#cssRule.style.cssText;\r\n   }\r\n\r\n   /**\r\n    * @returns {number} Returns the version of this instance.\r\n    */\r\n   get version()\r\n   {\r\n      return this.#version;\r\n   }\r\n\r\n   /**\r\n    * Provides a copy constructor to duplicate an existing TJSStyleManager instance into a new document.\r\n    *\r\n    * Note: This is used to support the `PopOut` module.\r\n    *\r\n    * @param {Document} [document] Target browser document to clone into.\r\n    *\r\n    * @returns {TJSStyleManager} New style manager instance.\r\n    */\r\n   clone(document = globalThis.document)\r\n   {\r\n      const newStyleManager = new TJSStyleManager({\r\n         selector: this.#selector,\r\n         docKey: this.#docKey,\r\n         document,\r\n         version: this.#version\r\n      });\r\n\r\n      newStyleManager.#cssRule.style.cssText = this.#cssRule.style.cssText;\r\n\r\n      return newStyleManager;\r\n   }\r\n\r\n   get()\r\n   {\r\n      const cssText = this.#cssRule.style.cssText;\r\n\r\n      const result = {};\r\n\r\n      if (cssText !== '')\r\n      {\r\n         for (const entry of cssText.split(';'))\r\n         {\r\n            if (entry !== '')\r\n            {\r\n               const values = entry.split(':');\r\n               result[values[0].trim()] = values[1];\r\n            }\r\n         }\r\n      }\r\n\r\n      return result;\r\n   }\r\n\r\n   /**\r\n    * Gets a particular CSS variable.\r\n    *\r\n    * @param {string}   key - CSS variable property key.\r\n    *\r\n    * @returns {string} Returns CSS variable value.\r\n    */\r\n   getProperty(key)\r\n   {\r\n      if (typeof key !== 'string') { throw new TypeError(`StyleManager error: 'key' is not a string.`); }\r\n\r\n      return this.#cssRule.style.getPropertyValue(key);\r\n   }\r\n\r\n   /**\r\n    * Set rules by property / value; useful for CSS variables.\r\n    *\r\n    * @param {{ [key: string]: string }}  rules - An object with property / value string pairs to load.\r\n    *\r\n    * @param {boolean}                 [overwrite=true] - When true overwrites any existing values.\r\n    */\r\n   setProperties(rules, overwrite = true)\r\n   {\r\n      if (!isObject(rules)) { throw new TypeError(`StyleManager error: 'rules' is not an object.`); }\r\n\r\n      if (typeof overwrite !== 'boolean') { throw new TypeError(`StyleManager error: 'overwrite' is not a boolean.`); }\r\n\r\n      if (overwrite)\r\n      {\r\n         for (const [key, value] of Object.entries(rules))\r\n         {\r\n            this.#cssRule.style.setProperty(key, value);\r\n         }\r\n      }\r\n      else\r\n      {\r\n         // Only set property keys for entries that don't have an existing rule set.\r\n         for (const [key, value] of Object.entries(rules))\r\n         {\r\n            if (this.#cssRule.style.getPropertyValue(key) === '')\r\n            {\r\n               this.#cssRule.style.setProperty(key, value);\r\n            }\r\n         }\r\n      }\r\n   }\r\n\r\n   /**\r\n    * Sets a particular property.\r\n    *\r\n    * @param {string}   key - CSS variable property key.\r\n    *\r\n    * @param {string}   value - CSS variable value.\r\n    *\r\n    * @param {boolean}  [overwrite=true] - Overwrite any existing value.\r\n    */\r\n   setProperty(key, value, overwrite = true)\r\n   {\r\n      if (typeof key !== 'string') { throw new TypeError(`StyleManager error: 'key' is not a string.`); }\r\n\r\n      if (typeof value !== 'string') { throw new TypeError(`StyleManager error: 'value' is not a string.`); }\r\n\r\n      if (typeof overwrite !== 'boolean') { throw new TypeError(`StyleManager error: 'overwrite' is not a boolean.`); }\r\n\r\n      if (overwrite)\r\n      {\r\n         this.#cssRule.style.setProperty(key, value);\r\n      }\r\n      else\r\n      {\r\n         if (this.#cssRule.style.getPropertyValue(key) === '')\r\n         {\r\n            this.#cssRule.style.setProperty(key, value);\r\n         }\r\n      }\r\n   }\r\n\r\n   /**\r\n    * Removes the property keys specified. If `keys` is an iterable list then all property keys in the list are removed.\r\n    *\r\n    * @param {Iterable<string>} keys - The property keys to remove.\r\n    */\r\n   removeProperties(keys)\r\n   {\r\n      if (!isIterable(keys)) { throw new TypeError(`StyleManager error: 'keys' is not an iterable list.`); }\r\n\r\n      for (const key of keys)\r\n      {\r\n         if (typeof key === 'string') { this.#cssRule.style.removeProperty(key); }\r\n      }\r\n   }\r\n\r\n   /**\r\n    * Removes a particular CSS variable.\r\n    *\r\n    * @param {string}   key - CSS variable property key.\r\n    *\r\n    * @returns {string} CSS variable value when removed.\r\n    */\r\n   removeProperty(key)\r\n   {\r\n      if (typeof key !== 'string') { throw new TypeError(`StyleManager error: 'key' is not a string.`); }\r\n\r\n      return this.#cssRule.style.removeProperty(key);\r\n   }\r\n}\n\nexport { StyleParse, TJSStyleManager };\n//# sourceMappingURL=index.js.map\n","import { TJSStyleManager } from '@typhonjs-fvtt/runtime/util/dom/style';\n\nexport const cssVariables = new TJSStyleManager({ docKey: '#__trl-root-styles', version: 1 });\n","import { isWritableStore } from '@typhonjs-fvtt/runtime/svelte/store/util';\nimport { CrossWindow } from '@typhonjs-fvtt/runtime/util/browser';\nimport { StyleParse } from '@typhonjs-fvtt/runtime/util/dom/style';\nimport { isObject } from '@typhonjs-fvtt/runtime/util/object';\n\n/**\r\n * Provides an instance of {@link ResizeObserver} that can manage multiple elements and notify a wide range of\r\n * {@link ResizeObserverData.ResizeTarget} listeners. Offset width and height is also provided through caching the\r\n * margin and padding styles of the target element.\r\n *\r\n * The action, {@link resizeObserver}, utilizes ResizeObserverManager for automatic registration and removal\r\n * via Svelte.\r\n */\r\nclass ResizeObserverManager\r\n{\r\n   /** @type {Map<HTMLElement, import('./types-local').ResizeObserverSubscriber[]>} */\r\n   #elMap = new Map();\r\n\r\n   /** @type {ResizeObserver} */\r\n   #resizeObserver;\r\n\r\n   /**\r\n    * Defines the various shape / update type of the given target.\r\n    *\r\n    * @type {{ [key: string]: number }}\r\n    */\r\n   static #updateTypes = Object.freeze({\r\n      none: 0,\r\n      attribute: 1,\r\n      function: 2,\r\n      resizeObserved: 3,\r\n      setContentBounds: 4,\r\n      setDimension: 5,\r\n      storeObject: 6,\r\n      storesObject: 7\r\n   });\r\n\r\n   constructor()\r\n   {\r\n      this.#resizeObserver = new ResizeObserver((entries) =>\r\n      {\r\n         for (const entry of entries)\r\n         {\r\n            const subscribers = this.#elMap.get(entry?.target);\r\n\r\n            if (Array.isArray(subscribers))\r\n            {\r\n               const contentWidth = entry.contentRect.width;\r\n               const contentHeight = entry.contentRect.height;\r\n\r\n               for (const subscriber of subscribers)\r\n               {\r\n                  ResizeObserverManager.#updateSubscriber(subscriber, contentWidth, contentHeight);\r\n               }\r\n            }\r\n         }\r\n      });\r\n   }\r\n\r\n   /**\r\n    * Add an {@link HTMLElement} and {@link ResizeObserverData.ResizeTarget} instance for monitoring. Create cached\r\n    * style attributes for the given element include border & padding dimensions for offset width / height calculations.\r\n    *\r\n    * @param {HTMLElement}    el - The element to observe.\r\n    *\r\n    * @param {import('./types').ResizeObserverData.ResizeTarget} target - A target that contains one of several\r\n    *        mechanisms for updating resize data.\r\n    */\r\n   add(el, target)\r\n   {\r\n      if (!CrossWindow.isHTMLElement(el))\r\n      {\r\n         throw new TypeError(`ResizeObserverManager.add error: 'el' is not a HTMLElement.`);\r\n      }\r\n\r\n      // Verify that this target is not already added for this element.\r\n      if (this.#hasTarget(el, target)) { return; }\r\n\r\n      const updateType = ResizeObserverManager.#getUpdateType(target);\r\n\r\n      if (updateType === 0)\r\n      {\r\n         throw new Error(`ResizeObserverManager.add error: 'target' is not a valid ResizeObserverManager target.`);\r\n      }\r\n\r\n      const computed = globalThis.getComputedStyle(el);\r\n\r\n      // Cache styles first from any inline styles then computed styles defaulting to 0 otherwise.\r\n      // Used to create the offset width & height values from the context box ResizeObserver provides.\r\n      const borderBottom = StyleParse.pixels(el.style.borderBottom) ?? StyleParse.pixels(computed.borderBottom) ?? 0;\r\n      const borderLeft = StyleParse.pixels(el.style.borderLeft) ?? StyleParse.pixels(computed.borderLeft) ?? 0;\r\n      const borderRight = StyleParse.pixels(el.style.borderRight) ?? StyleParse.pixels(computed.borderRight) ?? 0;\r\n      const borderTop = StyleParse.pixels(el.style.borderTop) ?? StyleParse.pixels(computed.borderTop) ?? 0;\r\n      const paddingBottom = StyleParse.pixels(el.style.paddingBottom) ?? StyleParse.pixels(computed.paddingBottom) ?? 0;\r\n      const paddingLeft = StyleParse.pixels(el.style.paddingLeft) ?? StyleParse.pixels(computed.paddingLeft) ?? 0;\r\n      const paddingRight = StyleParse.pixels(el.style.paddingRight) ?? StyleParse.pixels(computed.paddingRight) ?? 0;\r\n      const paddingTop = StyleParse.pixels(el.style.paddingTop) ?? StyleParse.pixels(computed.paddingTop) ?? 0;\r\n\r\n      /** @type {import('./types-local').ResizeObserverSubscriber} */\r\n      const data = {\r\n         updateType,\r\n         target,\r\n\r\n         // Stores most recent contentRect.width and contentRect.height values from ResizeObserver.\r\n         contentWidth: 0,\r\n         contentHeight: 0,\r\n\r\n         // Convenience data for total border & padding for offset width & height calculations.\r\n         styles: {\r\n            additionalWidth: borderLeft + borderRight + paddingLeft + paddingRight,\r\n            additionalHeight: borderTop + borderBottom + paddingTop + paddingBottom\r\n         }\r\n      };\r\n\r\n      if (this.#elMap.has(el))\r\n      {\r\n         const subscribers = this.#elMap.get(el);\r\n         subscribers.push(data);\r\n      }\r\n      else\r\n      {\r\n         this.#elMap.set(el, [data]);\r\n      }\r\n\r\n      this.#resizeObserver.observe(el);\r\n   }\r\n\r\n   /**\r\n    * Clears and unobserves all currently tracked elements and managed targets.\r\n    */\r\n   clear()\r\n   {\r\n      for (const el of this.#elMap.keys()) { this.#resizeObserver.unobserve(el); }\r\n\r\n      this.#elMap.clear();\r\n   }\r\n\r\n   /**\r\n    * Removes all {@link ResizeObserverData.ResizeTarget} instances for the given element from monitoring when just an\r\n    * element is provided otherwise removes a specific target from the monitoring map. If no more targets remain then\r\n    * the element is removed from monitoring.\r\n    *\r\n    * @param {HTMLElement} el - Element to remove from monitoring.\r\n    *\r\n    * @param {import('./types').ResizeObserverData.ResizeTarget} [target] - A specific target to remove from monitoring.\r\n    */\r\n   remove(el, target = void 0)\r\n   {\r\n      const subscribers = this.#elMap.get(el);\r\n      if (Array.isArray(subscribers))\r\n      {\r\n         // Remove specific target from subscribers.\r\n         if (target !== void 0)\r\n         {\r\n            const index = subscribers.findIndex((entry) => entry.target === target);\r\n            if (index >= 0)\r\n            {\r\n               subscribers.splice(index, 1);\r\n            }\r\n         }\r\n         else\r\n         {\r\n            // Remove all subscribers.\r\n            subscribers.length = 0;\r\n         }\r\n\r\n         // Remove element monitoring if last target removed.\r\n         if (subscribers.length === 0)\r\n         {\r\n            this.#elMap.delete(el);\r\n            this.#resizeObserver.unobserve(el);\r\n         }\r\n      }\r\n   }\r\n\r\n   /**\r\n    * Provides a function that when invoked with an element updates the cached styles for each subscriber of the\r\n    * element.\r\n    *\r\n    * The style attributes cached to calculate offset height / width include border & padding dimensions. You only need\r\n    * to update the cache if you change border or padding attributes of the element.\r\n    *\r\n    * @param {HTMLElement} el - A HTML element.\r\n    */\r\n   updateCache(el)\r\n   {\r\n      const subscribers = this.#elMap.get(el);\r\n\r\n      if (Array.isArray(subscribers))\r\n      {\r\n         const computed = globalThis.getComputedStyle(el);\r\n\r\n         // Cache styles first from any inline styles then computed styles defaulting to 0 otherwise.\r\n         // Used to create the offset width & height values from the context box ResizeObserver provides.\r\n         const borderBottom = StyleParse.pixels(el.style.borderBottom) ?? StyleParse.pixels(computed.borderBottom) ?? 0;\r\n         const borderLeft = StyleParse.pixels(el.style.borderLeft) ?? StyleParse.pixels(computed.borderLeft) ?? 0;\r\n         const borderRight = StyleParse.pixels(el.style.borderRight) ?? StyleParse.pixels(computed.borderRight) ?? 0;\r\n         const borderTop = StyleParse.pixels(el.style.borderTop) ?? StyleParse.pixels(computed.borderTop) ?? 0;\r\n         const paddingBottom = StyleParse.pixels(el.style.paddingBottom) ??\r\n          StyleParse.pixels(computed.paddingBottom) ?? 0;\r\n         const paddingLeft = StyleParse.pixels(el.style.paddingLeft) ?? StyleParse.pixels(computed.paddingLeft) ?? 0;\r\n         const paddingRight = StyleParse.pixels(el.style.paddingRight) ?? StyleParse.pixels(computed.paddingRight) ?? 0;\r\n         const paddingTop = StyleParse.pixels(el.style.paddingTop) ?? StyleParse.pixels(computed.paddingTop) ?? 0;\r\n\r\n         const additionalWidth = borderLeft + borderRight + paddingLeft + paddingRight;\r\n         const additionalHeight = borderTop + borderBottom + paddingTop + paddingBottom;\r\n\r\n         for (const subscriber of subscribers)\r\n         {\r\n            subscriber.styles.additionalWidth = additionalWidth;\r\n            subscriber.styles.additionalHeight = additionalHeight;\r\n            ResizeObserverManager.#updateSubscriber(subscriber, subscriber.contentWidth, subscriber.contentHeight);\r\n         }\r\n      }\r\n   }\r\n\r\n   // Internal implementation ----------------------------------------------------------------------------------------\r\n\r\n   /**\r\n    * Determines the shape of the target instance regarding valid update mechanisms to set width & height changes.\r\n    *\r\n    * @param {import('./types').ResizeObserverData.ResizeTarget}  target - The target instance.\r\n    *\r\n    * @returns {number} Update type value.\r\n    */\r\n   static #getUpdateType(target)\r\n   {\r\n      if (typeof target?.resizeObserved === 'function') { return this.#updateTypes.resizeObserved; }\r\n      if (typeof target?.setDimension === 'function') { return this.#updateTypes.setDimension; }\r\n      if (typeof target?.setContentBounds === 'function') { return this.#updateTypes.setContentBounds; }\r\n\r\n      const targetType = typeof target;\r\n\r\n      // Does the target have resizeObserved writable store?\r\n      if (targetType !== null && (targetType === 'object' || targetType === 'function'))\r\n      {\r\n         if (isWritableStore(target.resizeObserved))\r\n         {\r\n            return this.#updateTypes.storeObject;\r\n         }\r\n\r\n         // Now check for a child stores object which is a common TRL pattern for exposing stores.\r\n         const stores = target?.stores;\r\n         if (isObject(stores) || typeof stores === 'function')\r\n         {\r\n            if (isWritableStore(stores.resizeObserved))\r\n            {\r\n               return this.#updateTypes.storesObject;\r\n            }\r\n         }\r\n      }\r\n\r\n      if (targetType !== null && targetType === 'object') { return this.#updateTypes.attribute; }\r\n\r\n      if (targetType === 'function') { return this.#updateTypes.function; }\r\n\r\n      return this.#updateTypes.none;\r\n   }\r\n\r\n   /**\r\n    * Determines if a given element and target is already being observed.\r\n    *\r\n    * @param {HTMLElement} el - A HTMLElement.\r\n    *\r\n    * @param {import('./types').ResizeObserverData.ResizeTarget} [target] - A specific target to find.\r\n    *\r\n    * @returns {boolean} Whether the target is already being tracked for the given element.\r\n    */\r\n   #hasTarget(el, target)\r\n   {\r\n      if (target === void 0 || target === null) { return false; }\r\n\r\n      const subscribers = this.#elMap.get(el);\r\n      if (Array.isArray(subscribers))\r\n      {\r\n         return subscribers.findIndex((entry) => entry.target === target) >= 0;\r\n      }\r\n\r\n      return false;\r\n   }\r\n\r\n   /**\r\n    * Updates a subscriber target with given content width & height values. Offset width & height is calculated from\r\n    * the content values + cached styles.\r\n    *\r\n    * @param {import('./types-local').ResizeObserverSubscriber} subscriber - Internal data about subscriber.\r\n    *\r\n    * @param {number|undefined}  contentWidth - ResizeObserver `contentRect.width` value or undefined.\r\n    *\r\n    * @param {number|undefined}  contentHeight - ResizeObserver `contentRect.height` value or undefined.\r\n    */\r\n   static #updateSubscriber(subscriber, contentWidth, contentHeight)\r\n   {\r\n      const styles = subscriber.styles;\r\n\r\n      subscriber.contentWidth = contentWidth;\r\n      subscriber.contentHeight = contentHeight;\r\n\r\n      const offsetWidth = Number.isFinite(contentWidth) ? contentWidth + styles.additionalWidth : void 0;\r\n      const offsetHeight = Number.isFinite(contentHeight) ? contentHeight + styles.additionalHeight : void 0;\r\n\r\n      const target = subscriber.target;\r\n\r\n      switch (subscriber.updateType)\r\n      {\r\n         case this.#updateTypes.attribute:\r\n            target.contentWidth = contentWidth;\r\n            target.contentHeight = contentHeight;\r\n            target.offsetWidth = offsetWidth;\r\n            target.offsetHeight = offsetHeight;\r\n            break;\r\n\r\n         case this.#updateTypes.function:\r\n            target?.(offsetWidth, offsetHeight, contentWidth, contentHeight);\r\n            break;\r\n\r\n         case this.#updateTypes.resizeObserved:\r\n            target.resizeObserved?.(offsetWidth, offsetHeight, contentWidth, contentHeight);\r\n            break;\r\n\r\n         case this.#updateTypes.setContentBounds:\r\n            target.setContentBounds?.(contentWidth, contentHeight);\r\n            break;\r\n\r\n         case this.#updateTypes.setDimension:\r\n            target.setDimension?.(offsetWidth, offsetHeight);\r\n            break;\r\n\r\n         case this.#updateTypes.storeObject:\r\n            target.resizeObserved.update((object) =>\r\n            {\r\n               object.contentHeight = contentHeight;\r\n               object.contentWidth = contentWidth;\r\n               object.offsetHeight = offsetHeight;\r\n               object.offsetWidth = offsetWidth;\r\n\r\n               return object;\r\n            });\r\n            break;\r\n\r\n         case this.#updateTypes.storesObject:\r\n            target.stores.resizeObserved.update((object) =>\r\n            {\r\n               object.contentHeight = contentHeight;\r\n               object.contentWidth = contentWidth;\r\n               object.offsetHeight = offsetHeight;\r\n               object.offsetWidth = offsetWidth;\r\n\r\n               return object;\r\n            });\r\n            break;\r\n      }\r\n   }\r\n}\n\nexport { ResizeObserverManager };\n//# sourceMappingURL=index.js.map\n","import { ResizeObserverManager } from '@typhonjs-fvtt/runtime/util/dom/observer';\n\n/**\r\n * Provides a single global ResizeObserverManager instance for the resizeObserver action.\r\n *\r\n * @type {ResizeObserverManager}\r\n */\r\nconst resizeObserverActionManager = new ResizeObserverManager();\r\n\r\n/**\r\n * Provides an action to monitor the given {@link HTMLElement} node with {@link ResizeObserver} via\r\n * {@link ResizeObserverManager} posting width / height changes to the {@link ResizeObserverData.ResizeTarget} in\r\n * various ways depending on the shape of the target. The target can be one of the following and the\r\n * precedence order is listed from top to bottom:\r\n *\r\n * - has a `resizeObserved` function as attribute; offset then content width / height are passed as parameters.\r\n * - has a `setContentBounds` function as attribute; content width / height are passed as parameters.\r\n * - has a `setDimension` function as attribute; offset width / height are passed as parameters.\r\n * - target is an object; offset and content width / height attributes directly set on target.\r\n * - target is a function; the function invoked with offset then content width / height parameters.\r\n * - has a writable store `resizeObserved` as an attribute; updated with offset & content width / height.\r\n * - has an object 'stores' that has a writable store `resizeObserved` as an attribute; updated with offset &\r\n *   content width / height.\r\n *\r\n * Note: Svelte currently uses an archaic IFrame based workaround to monitor offset / client width & height changes.\r\n * A more up to date way to do this is with ResizeObserver. To track when Svelte receives ResizeObserver support\r\n * monitor this issue: {@link https://github.com/sveltejs/svelte/issues/4233}\r\n *\r\n * Can-I-Use: {@link https://caniuse.com/resizeobserver}\r\n *\r\n * @param {HTMLElement} node - The node associated with the action.\r\n *\r\n * @param {import('#runtime/util/dom/observer').ResizeObserverData.ResizeTarget} target - A\r\n *        {@link ResizeObserverManager} target to update with observed width & height changes.\r\n *\r\n * @returns {(import('svelte/action').ActionReturn<\r\n *   import('#runtime/util/dom/observer').ResizeObserverData.ResizeTarget\r\n * >)} The action lifecycle methods.\r\n *\r\n * @see https://github.com/sveltejs/svelte/issues/4233\r\n */\r\nfunction resizeObserver(node, target)\r\n{\r\n   resizeObserverActionManager.add(node, target);\r\n\r\n   return {\r\n      /**\r\n       * @param {import('#runtime/util/dom/observer').ResizeObserverData.ResizeTarget} newTarget - A\r\n       *        {@link ResizeObserverManager} target to update with observed width & height changes.\r\n       */\r\n      update: (newTarget) =>\r\n      {\r\n         resizeObserverActionManager.remove(node, target);\r\n         target = newTarget;\r\n         resizeObserverActionManager.add(node, target);\r\n      },\r\n\r\n      destroy: () =>\r\n      {\r\n         resizeObserverActionManager.remove(node, target);\r\n      }\r\n   };\r\n}\r\n\r\n/**\r\n * Provides a function that when invoked with an element updates the cached styles for each subscriber of the element.\r\n *\r\n * The style attributes cached to calculate offset height / width include border & padding dimensions. You only need\r\n * to update the cache if you change border or padding attributes of the element.\r\n *\r\n * @param {HTMLElement} el - A HTML element.\r\n */\r\nresizeObserver.updateCache = function(el)\r\n{\r\n   resizeObserverActionManager.updateCache(el);\r\n};\n\nexport { resizeObserver };\n//# sourceMappingURL=index.js.map\n","import { isObject } from '@typhonjs-fvtt/runtime/util/object';\n\n/**\r\n * Provides an action to apply CSS style properties provided as an object.\r\n *\r\n * @param {HTMLElement} node - Target element\r\n *\r\n * @param {{ [key: string]: string | null }}  properties - Hyphen case CSS property key / value object of properties\r\n *        to set.\r\n *\r\n * @returns {import('svelte/action').ActionReturn<{ [key: string]: string | null }>} Lifecycle functions.\r\n */\r\nfunction applyStyles(node, properties)\r\n{\r\n   /** Sets properties on node. */\r\n   function setProperties()\r\n   {\r\n      if (!isObject(properties)) { return; }\r\n\r\n      for (const prop of Object.keys(properties))\r\n      {\r\n         node.style.setProperty(`${prop}`, properties[prop]);\r\n      }\r\n   }\r\n\r\n   setProperties();\r\n\r\n   return {\r\n      /**\r\n       * @param {{ [key: string]: string | null }}  newProperties - Key / value object of properties to set.\r\n       */\r\n      update: (newProperties) =>\r\n      {\r\n         properties = newProperties;\r\n         setProperties();\r\n      }\r\n   };\r\n}\n\nexport { applyStyles };\n//# sourceMappingURL=index.js.map\n","import { isObject } from '@typhonjs-fvtt/runtime/util/object';\n\n/**\r\n * Applies the given action dynamically allowing the hosted action to be updated reactively while still appropriately\r\n * handling the action lifecycle methods.\r\n *\r\n * @param {HTMLElement} node - The node associated with the action.\r\n *\r\n * @param {import('./types').DynamicActionOptions} options - Defines the action to dynamically mount.\r\n *\r\n * @returns {import('svelte/action').ActionReturn<import('./types').DynamicActionOptions>} The action lifecycle\r\n *          methods.\r\n */\r\nfunction dynamicAction(node, { action, data } = {})\r\n{\r\n   let actionResult;\r\n\r\n   if (typeof action === 'function') { actionResult = action(node, data); }\r\n\r\n   return {\r\n      /**\r\n       * @param {import('./types').DynamicActionOptions} newOptions - Defines the new action to dynamically mount.\r\n       */\r\n      update: (newOptions) =>\r\n      {\r\n         // If `newOptions` is not an object then destroy any old action.\r\n         if (!isObject(newOptions))\r\n         {\r\n            actionResult?.destroy?.();\r\n            action = void 0;\r\n            data = void 0;\r\n\r\n            return;\r\n         }\r\n\r\n         const { action: newAction, data: newData } = newOptions;\r\n\r\n         if (typeof newAction !== 'function')\r\n         {\r\n            console.warn(`dynamicAction.update warning: Aborting as 'action' is not a function.`);\r\n            return;\r\n         }\r\n\r\n         const hasNewData = newData !== data;\r\n\r\n         if (hasNewData) { data = newData; }\r\n\r\n         if (newAction !== action)\r\n         {\r\n            // If the action changes destroy the previous action and apply the new one.\r\n            actionResult?.destroy?.();\r\n\r\n            action = newAction;\r\n            actionResult = action(node, data);\r\n         }\r\n         else if (hasNewData)\r\n         {\r\n            actionResult?.update?.(data);\r\n         }\r\n      },\r\n\r\n      destroy: () =>\r\n      {\r\n         actionResult?.destroy?.();\r\n\r\n         action = void 0;\r\n         data = void 0;\r\n         actionResult = void 0;\r\n      }\r\n   };\r\n}\n\nexport { dynamicAction };\n//# sourceMappingURL=index.js.map\n","import { writable, get } from 'svelte/store';\nimport { CrossWindow } from '@typhonjs-fvtt/runtime/util/browser';\n\n/**\n * Generates derived, readable, writable helper functions wrapping the given Storage API provided with any additional\n * customization for data serialization. By default, JSON serialization is used.\n *\n * @param {object}   opts - Generator options.\n *\n * @param {Storage}  opts.storage - The web storage source.\n *\n * @param {(value: any, ...rest: any[]) => string}  [opts.serialize] - Replace with custom serialization;\n *        default: `JSON.stringify`.\n *\n * @param {(value: string, ...rest: any[]) => any}  [opts.deserialize] - Replace with custom deserialization;\n *        default: `JSON.parse`.\n *\n * @returns {StorageStores} A complete set of store helper functions and associated storage API instance and\n *          serialization strategy.\n */\nfunction storeGenerator({ storage, serialize = JSON.stringify, deserialize = JSON.parse }) {\n    function isSimpleDeriver(deriver) {\n        return deriver.length < 2;\n    }\n    function storageReadable(key, value, start) {\n        return {\n            subscribe: storageWritable(key, value, start).subscribe\n        };\n    }\n    function storageWritable(key, value, start) {\n        function wrap_start(ogSet) {\n            return start(function wrap_set(new_value) {\n                if (storage) {\n                    storage.setItem(key, serialize(new_value));\n                }\n                return ogSet(new_value);\n            }, function wrap_update(fn) {\n                set(fn(get(ogStore)));\n            });\n        }\n        if (storage) {\n            const storageValue = storage.getItem(key);\n            try {\n                if (storageValue) {\n                    value = deserialize(storageValue);\n                }\n            }\n            catch (err) { /**/ }\n            storage.setItem(key, serialize(value));\n        }\n        const ogStore = writable(value, start ? wrap_start : void 0);\n        function set(new_value) {\n            if (storage) {\n                storage.setItem(key, serialize(new_value));\n            }\n            ogStore.set(new_value);\n        }\n        function update(fn) {\n            set(fn(get(ogStore)));\n        }\n        function subscribe(run, invalidate) {\n            return ogStore.subscribe(run, invalidate);\n        }\n        return { set, update, subscribe };\n    }\n    function storageDerived(key, stores, fn, initial_value) {\n        const single = !Array.isArray(stores);\n        const stores_array = single ? [stores] : stores;\n        if (storage && storage.getItem(key)) {\n            try {\n                initial_value = deserialize(storage.getItem(key));\n            }\n            catch (err) { /**/ }\n        }\n        return storageReadable(key, initial_value, (set, update) => {\n            let inited = false;\n            const values = [];\n            let pending = 0;\n            let cleanup;\n            const sync = () => {\n                if (pending) {\n                    return;\n                }\n                cleanup?.();\n                const input = single ? values[0] : values;\n                if (isSimpleDeriver(fn)) {\n                    set(fn(input));\n                }\n                else {\n                    const result = fn(input, set, update);\n                    if (typeof result === 'function') {\n                        cleanup = result;\n                    }\n                }\n            };\n            const unsubscribers = stores_array.map((store, i) => store.subscribe((value) => {\n                values[i] = value;\n                pending &= ~(1 << i);\n                if (inited) {\n                    sync();\n                }\n            }, () => { pending |= (1 << i); }));\n            inited = true;\n            sync();\n            return function stop() {\n                // Equivalent to run_all from Svelte internals.\n                unsubscribers.forEach((unsubscriber) => unsubscriber());\n                cleanup?.();\n            };\n        });\n    }\n    return {\n        readable: storageReadable,\n        writable: storageWritable,\n        derived: storageDerived,\n        storage,\n        serialize,\n        deserialize\n    };\n}\n\n/**\n * Provides all Storage API enabled `localStorage` store helper functions. Data is serialized as JSON.\n */\nconst localStores = storeGenerator({ storage: globalThis?.localStorage });\n/**\n * Provides the Storage API enabled derived `localStorage` store helper function. Data is serialized as JSON.\n */\nlocalStores.derived;\n/**\n * Provides the Storage API enabled readable `localStorage` store helper function. Data is serialized as JSON.\n */\nlocalStores.readable;\n/**\n * Provides the Storage API enabled writable `localStorage` store helper function. Data is serialized as JSON.\n */\nlocalStores.writable;\n\n/**\n * Provides all Storage API enabled `sessionStorage` store helper functions. Data is serialized as JSON.\n */\nconst sessionStores = storeGenerator({ storage: globalThis?.sessionStorage });\n/**\n * Provides the Storage API enabled derived `sessionStorage` store helper function. Data is serialized as JSON.\n */\nsessionStores.derived;\n/**\n * Provides the Storage API enabled readable `sessionStorage` store helper function. Data is serialized as JSON.\n */\nsessionStores.readable;\n/**\n * Provides the Storage API enabled writable `sessionStorage` store helper function. Data is serialized as JSON.\n */\nsessionStores.writable;\n\n/**\r\n * Provides the base Storage API store manager. It is recommended to use {@link TJSLocalStorage} &\r\n * {@link TJSSessionStorage} for standard browser local and session storage use cases. TJSWebStorage exists\r\n * to provide additional customization options for custom Storage API compatible storage instances and custom\r\n * serialization configuration.\r\n *\r\n * @implements {import('./types').WebStorage}\r\n */\r\nclass TJSWebStorage\r\n{\r\n   /** @type {import('./').StorageStores} */\r\n   #storageStores;\r\n\r\n   /**\r\n    * @type {(Map<string, {\r\n    *    store: import('svelte/store').Writable,\r\n    *    deserialize?: (value: string, ...rest: any[]) => any,\r\n    *    serialize?: (value: any, ...rest: any[]) => string\r\n    * }>)}\r\n    */\r\n   #stores = new Map();\r\n\r\n   /**\r\n    * @param {import('./').StorageStores} storageStores - Provides a complete set of\r\n    *        storage API store helper functions and the associated storage API instance and serializations strategy.\r\n    */\r\n   constructor(storageStores)\r\n   {\r\n      this.#storageStores = storageStores;\r\n   }\r\n\r\n   /**\r\n    * Creates a new store for the given key.\r\n    *\r\n    * @template T\r\n    *\r\n    * @param {string}   key - Key to lookup in stores map.\r\n    *\r\n    * @param {T}        [defaultValue] - A default value to set for the store.\r\n    *\r\n    * @param {import('./').StorageStores} [storageStores] - Additional store creation options.\r\n    *\r\n    * @returns {import('svelte/store').Writable<T>} The new store.\r\n    */\r\n   #createStore(key, defaultValue = void 0, storageStores)\r\n   {\r\n      try\r\n      {\r\n         const value = this.#storageStores.storage.getItem(key);\r\n         if (value !== null)\r\n         {\r\n            const deserialize = storageStores?.deserialize ?? this.#storageStores.deserialize;\r\n            defaultValue = deserialize(value);\r\n         }\r\n      }\r\n      catch (err) { /**/ }\r\n\r\n      const writable = storageStores?.writable ?? this.#storageStores.writable;\r\n\r\n      return writable(key, defaultValue);\r\n   }\r\n\r\n   /**\r\n    * @param {string}   key - Storage key.\r\n    *\r\n    * @returns {(value: string, ...rest: any[]) => any} Deserialize function.\r\n    */\r\n   #getDeserialize(key)\r\n   {\r\n      return this.#stores.get(key)?.deserialize ?? this.#storageStores.deserialize;\r\n   }\r\n\r\n   /**\r\n    * @param {string}   key - Storage key.\r\n    *\r\n    * @returns {(value: any, ...rest: any[]) => string} Serialize function.\r\n    */\r\n   #getSerialize(key)\r\n   {\r\n      return this.#stores.get(key)?.serialize ?? this.#storageStores.serialize;\r\n   }\r\n\r\n   /**\r\n    * Gets a store from the `stores` Map or creates a new store for the key and a given default value.\r\n    *\r\n    * @template T\r\n    *\r\n    * @param {string}   key - Key to lookup in stores map.\r\n    *\r\n    * @param {T}        [defaultValue] - A default value to set for the store.\r\n    *\r\n    * @param {import('./').StorageStores} [storageStores] - Additional store creation options.\r\n    *\r\n    * @returns {import('svelte/store').Writable<T>} The store for the given key.\r\n    */\r\n   #getStore(key, defaultValue = void 0, storageStores)\r\n   {\r\n      const storeEntry = this.#stores.get(key);\r\n      if (storeEntry) { return storeEntry.store; }\r\n\r\n      const store = this.#createStore(key, defaultValue, storageStores);\r\n\r\n      // Set any key specific storage helper details.\r\n      this.#stores.set(key, {\r\n         store,\r\n         deserialize: storageStores?.deserialize,\r\n         serialize: storageStores?.serialize\r\n      });\r\n\r\n      return store;\r\n   }\r\n\r\n   /**\r\n    * Get value from the storage API.\r\n    *\r\n    * @param {string}   key - Key to lookup in storage API.\r\n    *\r\n    * @param {*}        [defaultValue] - A default value to return if key not present in session storage.\r\n    *\r\n    * @returns {*} Value from session storage or if not defined any default value provided.\r\n    */\r\n   getItem(key, defaultValue)\r\n   {\r\n      let value = defaultValue;\r\n\r\n      const storageValue = this.#storageStores.storage.getItem(key);\r\n\r\n      if (storageValue !== null)\r\n      {\r\n         try\r\n         {\r\n            value = this.#getDeserialize(key)(storageValue);\r\n         }\r\n         catch (err)\r\n         {\r\n            value = defaultValue;\r\n         }\r\n      }\r\n      else if (defaultValue !== void 0)\r\n      {\r\n         try\r\n         {\r\n            const newValue = this.#getSerialize(key)(defaultValue);\r\n\r\n            // If there is no existing storage value and defaultValue is defined the storage value needs to be set.\r\n            this.#storageStores.storage.setItem(key, newValue);\r\n         }\r\n         catch (err) { /* */ }\r\n      }\r\n\r\n      return value;\r\n   }\r\n\r\n   /**\r\n    * Returns the backing Svelte store for the given key; potentially sets a default value if the key\r\n    * is not already set.\r\n    *\r\n    * @template T\r\n    *\r\n    * @param {string}   key - Key to lookup in storage API.\r\n    *\r\n    * @param {T}        [defaultValue] - A default value to return if key not present in session storage.\r\n    *\r\n    * @param {import('./').StorageStores} [storageStores] - Additional store creation options.\r\n    *\r\n    * @returns {import('svelte/store').Writable<T>} The Svelte store for this key.\r\n    */\r\n   getStore(key, defaultValue, storageStores)\r\n   {\r\n      return this.#getStore(key, defaultValue, storageStores);\r\n   }\r\n\r\n   /**\r\n    * Returns whether a store has already been created for the given key.\r\n    *\r\n    * @param {string}   key - Key to lookup in storage API.\r\n    */\r\n   hasStore(key)\r\n   {\r\n      return this.#stores.has(key);\r\n   }\r\n\r\n   /**\r\n    * Sets the value for the given key in storage API.\r\n    *\r\n    * @param {string}   key - Key to lookup in storage API.\r\n    *\r\n    * @param {*}        value - A value to set for this key.\r\n    */\r\n   setItem(key, value)\r\n   {\r\n      const store = this.#getStore(key);\r\n      store.set(value);\r\n   }\r\n\r\n   /**\r\n    * Convenience method to swap a boolean value stored in storage API updating the associated store value.\r\n    *\r\n    * @param {string}   key - Key to lookup in storage API.\r\n    *\r\n    * @param {boolean}  [defaultValue] - A default value to return if key not present in session storage.\r\n    *\r\n    * @returns {boolean} The boolean swap for the given key.\r\n    */\r\n   swapItemBoolean(key, defaultValue)\r\n   {\r\n      const store = this.#getStore(key, defaultValue);\r\n\r\n      let currentValue = false;\r\n\r\n      try\r\n      {\r\n         currentValue = !!this.#getDeserialize(key)(this.#storageStores.storage.getItem(key));\r\n      }\r\n      catch (err) { /**/ }\r\n\r\n      const newValue = typeof currentValue === 'boolean' ? !currentValue : false;\r\n\r\n      store.set(newValue);\r\n      return newValue;\r\n   }\r\n\r\n   // Iterators ------------------------------------------------------------------------------------------------------\r\n\r\n   /**\r\n    * @template T\r\n    *\r\n    * Returns an iterable for the session storage keys and stores.\r\n    *\r\n    * @param {RegExp} [regex] - Optional regular expression to filter by storage keys.\r\n    *\r\n    * @returns {IterableIterator<[string, import('svelte/store').Writable<T>]>} Iterable iterator of keys and stores.\r\n    * @yields {import('svelte/store').Writable<[string, Writable<T>]>}\r\n    */\r\n   *entries(regex = void 0)\r\n   {\r\n      if (regex !== void 0 && !CrossWindow.isRegExp(regex)) { throw new TypeError(`'regex' is not a RegExp`); }\r\n\r\n      if (!this.#stores.size) { return void 0; }\r\n\r\n      if (regex)\r\n      {\r\n         for (const key of this.#stores.keys())\r\n         {\r\n            if (regex.test(key)) { yield [key, this.getStore(key)]; }\r\n         }\r\n      }\r\n      else\r\n      {\r\n         for (const key of this.#stores.keys()) { yield [key, this.getStore(key)]; }\r\n      }\r\n   }\r\n\r\n   /**\r\n    * Returns an iterable for the session storage keys from existing stores.\r\n    *\r\n    * @param {RegExp} [regex] - Optional regular expression to filter by storage keys.\r\n    *\r\n    * @returns {IterableIterator<string>} Iterable iterator of session storage keys.\r\n    * @yields {string}\r\n    */\r\n   *keys(regex = void 0)\r\n   {\r\n      if (regex !== void 0 && !CrossWindow.isRegExp(regex)) { throw new TypeError(`'regex' is not a RegExp`); }\r\n\r\n      if (!this.#stores.size) { return void 0; }\r\n\r\n      if (regex)\r\n      {\r\n         for (const key of this.#stores.keys())\r\n         {\r\n            if (regex.test(key)) { yield key; }\r\n         }\r\n      }\r\n      else\r\n      {\r\n         for (const key of this.#stores.keys()) { yield key; }\r\n      }\r\n   }\r\n\r\n   /**\r\n    * @template T\r\n    *\r\n    * Returns an iterable for the session storage stores.\r\n    *\r\n    * @param {RegExp} [regex] - Optional regular expression to filter by storage keys.\r\n    *\r\n    * @returns {IterableIterator<import('svelte/store').Writable<T>>} Iterable iterator of stores.\r\n    * @yields {import('svelte/store').Writable<T>}\r\n    */\r\n   *stores(regex = void 0)\r\n   {\r\n      if (regex !== void 0 && !CrossWindow.isRegExp(regex)) { throw new TypeError(`'regex' is not a RegExp`); }\r\n\r\n      if (!this.#stores.size) { return void 0; }\r\n\r\n      if (regex)\r\n      {\r\n         for (const key of this.#stores.keys())\r\n         {\r\n            if (regex.test(key)) { yield this.getStore(key); }\r\n         }\r\n      }\r\n      else\r\n      {\r\n         for (const key of this.#stores.keys()) { yield this.getStore(key); }\r\n      }\r\n   }\r\n}\n\n/**\r\n * Provides a {@link TJSWebStorage} instance for standard browser local storage use cases.\r\n */\r\nclass TJSLocalStorage extends TJSWebStorage\r\n{\r\n   constructor()\r\n   {\r\n      super(localStores);\r\n   }\r\n}\n\n/**\r\n * Provides a {@link TJSWebStorage} instance for standard browser session storage use cases.\r\n */\r\nclass TJSSessionStorage extends TJSWebStorage\r\n{\r\n   constructor()\r\n   {\r\n      super(sessionStores);\r\n   }\r\n}\n\nexport { TJSLocalStorage, TJSSessionStorage, TJSWebStorage, localStores, sessionStores, storeGenerator };\n//# sourceMappingURL=index.js.map\n","import { derived, get } from 'svelte/store';\n\n/**\n * @external Store\n * @see [Svelte stores](https://svelte.dev/docs#component-format-script-4-prefix-stores-with-$-to-access-their-values-store-contract)\n */\n\n/**\n * Create a store similar to [Svelte's `derived`](https://svelte.dev/docs#run-time-svelte-store-writable),\n * but which has its own `set` and `update` methods and can send values back to the origin stores.\n * [Read more...](https://github.com/PixievoltNo1/svelte-writable-derived#default-export-writablederived)\n * \n * @param {Store|Store[]} origins One or more stores to derive from. Same as\n * [`derived`](https://svelte.dev/docs#run-time-svelte-store-writable)'s 1st parameter.\n * @param {!Function} derive The callback to determine the derived value. Same as\n * [`derived`](https://svelte.dev/docs#run-time-svelte-store-writable)'s 2nd parameter.\n * @param {!Function} reflect Called when the derived store gets a new value via its `set` or\n * `update` methods, and determines new values for the origin stores.\n * [Read more...](https://github.com/PixievoltNo1/svelte-writable-derived#new-parameter-reflect)\n * @param [initial] The new store's initial value. Same as\n * [`derived`](https://svelte.dev/docs#run-time-svelte-store-writable)'s 3rd parameter.\n * \n * @returns {Store} A writable store.\n */\nfunction writableDerived(origins, derive, reflect, initial) {\n\tvar childDerivedSetter, originValues, blockNextDerive = false;\n\tvar reflectOldValues = reflect.length >= 2;\n\tvar wrappedDerive = (got, set, update) => {\n\t\tchildDerivedSetter = set;\n\t\tif (reflectOldValues) {\n\t\t\toriginValues = got;\n\t\t}\n\t\tif (!blockNextDerive) {\n\t\t\tlet returned = derive(got, set, update);\n\t\t\tif (derive.length < 2) {\n\t\t\t\tset(returned);\n\t\t\t} else {\n\t\t\t\treturn returned;\n\t\t\t}\n\t\t}\n\t\tblockNextDerive = false;\n\t};\n\tvar childDerived = derived(origins, wrappedDerive, initial);\n\t\n\tvar singleOrigin = !Array.isArray(origins);\n\tfunction doReflect(reflecting) {\n\t\tvar setWith = reflect(reflecting, originValues);\n\t\tif (singleOrigin) {\n\t\t\tblockNextDerive = true;\n\t\t\torigins.set(setWith);\n\t\t} else {\n\t\t\tsetWith.forEach( (value, i) => {\n\t\t\t\tblockNextDerive = true;\n\t\t\t\torigins[i].set(value);\n\t\t\t} );\n\t\t}\n\t\tblockNextDerive = false;\n\t}\n\t\n\tvar tryingSet = false;\n\tfunction update(fn) {\n\t\tvar isUpdated, mutatedBySubscriptions, oldValue, newValue;\n\t\tif (tryingSet) {\n\t\t\tnewValue = fn( get(childDerived) );\n\t\t\tchildDerivedSetter(newValue);\n\t\t\treturn;\n\t\t}\n\t\tvar unsubscribe = childDerived.subscribe( (value) => {\n\t\t\tif (!tryingSet) {\n\t\t\t\toldValue = value;\n\t\t\t} else if (!isUpdated) {\n\t\t\t\tisUpdated = true;\n\t\t\t} else {\n\t\t\t\tmutatedBySubscriptions = true;\n\t\t\t}\n\t\t} );\n\t\tnewValue = fn(oldValue);\n\t\ttryingSet = true;\n\t\tchildDerivedSetter(newValue);\n\t\tunsubscribe();\n\t\ttryingSet = false;\n\t\tif (mutatedBySubscriptions) {\n\t\t\tnewValue = get(childDerived);\n\t\t}\n\t\tif (isUpdated) {\n\t\t\tdoReflect(newValue);\n\t\t}\n\t}\n\treturn {\n\t\tsubscribe: childDerived.subscribe,\n\t\tset(value) { update( () => value ); },\n\t\tupdate,\n\t};\n}\n\n/**\n * Create a store for a property value in an object contained in another store.\n * [Read more...](https://github.com/PixievoltNo1/svelte-writable-derived#named-export-propertystore)\n * \n * @param {Store} origin The store containing the object to get/set from.\n * @param {string|number|symbol|Array<string|number|symbol>} propName The property to get/set, or a path of\n * properties in nested objects.\n *\n * @returns {Store} A writable store.\n */\nfunction propertyStore(origin, propName) {\n\tif (!Array.isArray(propName)) {\n\t\treturn writableDerived(\n\t\t\torigin,\n\t\t\t(object) => object[propName],\n\t\t\t(reflecting, object) => {\n\t\t\t\tobject[propName] = reflecting;\n\t\t\t\treturn object;\n\t\t\t},\n\t\t);\n\t} else {\n\t\tlet props = propName.concat();\n\t\treturn writableDerived(\n\t\t\torigin,\n\t\t\t(value) => {\n\t\t\t\tfor (let i = 0; i < props.length; ++i) {\n\t\t\t\t\tvalue = value[ props[i] ];\n\t\t\t\t}\n\t\t\t\treturn value;\n\t\t\t},\n\t\t\t(reflecting, object) => {\n\t\t\t\tlet target = object;\n\t\t\t\tfor (let i = 0; i < props.length - 1; ++i) {\n\t\t\t\t\ttarget = target[ props[i] ];\n\t\t\t\t}\n\t\t\t\ttarget[ props[props.length - 1] ] = reflecting;\n\t\t\t\treturn object;\n\t\t\t},\n\t\t);\n\t}\n}\n\nexport { propertyStore, writableDerived };\n//# sourceMappingURL=index.js.map\n","import { CrossWindow } from '@typhonjs-fvtt/runtime/util/browser';\nimport { isObject } from '@typhonjs-fvtt/runtime/util/object';\nimport { group_outros, transition_out, check_outros } from 'svelte/internal';\n\n/**\n * Provides utilities to verify and parse {@link TJSSvelte.Config} configuration objects.\n */\nclass APIConfig {\n    constructor() { }\n    /**\n     * Validates `config` argument whether it is a valid {@link TJSSvelte.Config.Dynamic} or\n     * {@link TJSSvelte.Config.Standard} configuration object suitable for parsing by\n     * {@link TJSSvelte.API.Config.parseConfig}.\n     *\n     * @param config - The potential config object to validate.\n     *\n     * @param [options] - Options.\n     *\n     * @param [options.raiseException=false] - If validation fails raise an exception.\n     *\n     * @returns Is the config a valid TJSSvelte.Config.Dynamic or TJSSvelte.Config.Standard configuration object.\n     *\n     * @throws {TypeError}  Any validation error when `raiseException` is enabled.\n     */\n    static isConfig(config, { raiseException = false } = {}) {\n        if (!isObject(config)) {\n            if (raiseException) {\n                throw new TypeError(`TJSSvelte.config.isConfig error: 'config' is not an object.`);\n            }\n            return false;\n        }\n        if (!TJSSvelte.util.isComponent(config.class)) {\n            if (raiseException) {\n                throw new TypeError(`TJSSvelte.config.isConfig error: 'config.class' is not a Svelte component constructor.`);\n            }\n            return false;\n        }\n        return true;\n    }\n    /**\n     * Validates `config` argument whether it is a valid {@link TJSSvelte.Config.Embed} configuration object\n     * suitable for directly mounting via the `<svelte:component>` directive.\n     *\n     * @param config - The potential config object to validate.\n     *\n     * @param [options] - Options.\n     *\n     * @param [options.raiseException=false] - If validation fails raise an exception.\n     *\n     * @returns Is the config a valid TJSSvelte.Config.Embed configuration object.\n     *\n     * @throws {TypeError}  Any validation error when `raiseException` is enabled.\n     */\n    static isConfigEmbed(config, { raiseException = false } = {}) {\n        if (!isObject(config)) {\n            if (raiseException) {\n                throw new TypeError(`TJSSvelte.config.isConfigEmbed error: 'config' is not an object.`);\n            }\n            return false;\n        }\n        if (!TJSSvelte.util.isComponent(config.class)) {\n            if (raiseException) {\n                throw new TypeError(`TJSSvelte.config.isConfigEmbed error: 'config.class' is not a Svelte component constructor.`);\n            }\n            return false;\n        }\n        if (config.props !== void 0 && !isObject(config.props)) {\n            if (raiseException) {\n                throw new TypeError(`TJSSvelte.config.isConfigEmbed error: 'config.props' is not an object.`);\n            }\n            return false;\n        }\n        return true;\n    }\n    /**\n     * Parses a TyphonJS Svelte dynamic or standard config object ensuring that the class specified is a Svelte\n     * component, loads any dynamic defined `context` or `props` preparing the config object for loading into the\n     * Svelte component.\n     *\n     * @param config - Svelte config object.\n     *\n     * @param [options] - Options.\n     *\n     * @param [options.contextExternal] - When true any context data provided will be loaded into `#external`\n     *        context separating it from any internal context created by the component.\n     *\n     * @param [options.thisArg] - `This` reference to set for invoking any `context` or `props` defined as\n     *        functions for {@link Config.Dynamic} configuration objects.\n     *\n     * @returns The processed Svelte config object turned with parsed `props` & `context` converted into the format\n     *          supported by Svelte.\n     */\n    static parseConfig(config, { contextExternal = false, thisArg = void 0 } = {}) {\n        if (!isObject(config)) {\n            throw new TypeError(`TJSSvelte.config.parseConfig - 'config' is not an object:\\n${JSON.stringify(config)}.`);\n        }\n        if (!TJSSvelte.util.isComponent(config.class)) {\n            throw new TypeError(`TJSSvelte.config.parseConfig - 'class' is not a Svelte component constructor for config:\\n${JSON.stringify(config)}.`);\n        }\n        if (config.hydrate !== void 0 && typeof config.hydrate !== 'boolean') {\n            throw new TypeError(`TJSSvelte.config.parseConfig - 'hydrate' is not a boolean for config:\\n${JSON.stringify(config)}.`);\n        }\n        if (config.intro !== void 0 && typeof config.intro !== 'boolean') {\n            throw new TypeError(`TJSSvelte.config.parseConfig - 'intro' is not a boolean for config:\\n${JSON.stringify(config)}.`);\n        }\n        if (config.target !== void 0 && !CrossWindow.isElement(config.target) &&\n            !CrossWindow.isShadowRoot(config.target) && !CrossWindow.isDocumentFragment(config.target)) {\n            throw new TypeError(`TJSSvelte.config.parseConfig - 'target' is not a Element, ShadowRoot, or DocumentFragment for config:\\n${JSON.stringify(config)}.`);\n        }\n        if (config.anchor !== void 0 && !CrossWindow.isElement(config.anchor) &&\n            !CrossWindow.isShadowRoot(config.anchor) && !CrossWindow.isDocumentFragment(config.anchor)) {\n            throw new TypeError(`TJSSvelte.config.parseConfig - 'anchor' is not a string, Element for config:\\n${JSON.stringify(config)}.`);\n        }\n        if (config.context !== void 0 && typeof config.context !== 'function' && !isObject(config.context)) {\n            throw new TypeError(`TJSSvelte.config.parseConfig - 'context' is not a function or object for config:\\n${JSON.stringify(config)}.`);\n        }\n        const svelteConfig = { ...config };\n        let context = {};\n        // If a context callback function is provided then invoke it with `this` being the Foundry app.\n        // If an object is returned it adds the entries to external context.\n        if (typeof svelteConfig.context === 'function') {\n            const contextFunc = svelteConfig.context;\n            delete svelteConfig.context;\n            const result = contextFunc.call(thisArg);\n            if (isObject(result)) {\n                context = { ...result };\n            }\n            else {\n                throw new Error(`TJSSvelte.config.parseConfig - 'context' is a function that did not return an object for config:\\n${JSON.stringify(config)}`);\n            }\n        }\n        else if (isObject(svelteConfig.context)) {\n            context = svelteConfig.context;\n            delete svelteConfig.context;\n        }\n        // If a props is a function then invoke it with `this` being the Foundry app.\n        // If an object is returned set it as the props.\n        svelteConfig.props = this.#processProps(svelteConfig.props, thisArg, config);\n        if (contextExternal) {\n            svelteConfig.context = new Map();\n            svelteConfig.context.set('#external', context);\n        }\n        else {\n            svelteConfig.context = new Map(Object.entries(context));\n        }\n        return svelteConfig;\n    }\n    // Internal implementation ----------------------------------------------------------------------------------------\n    /**\n     * Processes Svelte props. Potentially props can be a function to invoke with `thisArg`.\n     *\n     * @param props - Svelte props.\n     *\n     * @param thisArg - `This` reference to set for invoking any props function.\n     *\n     * @param config - Svelte config\n     *\n     * @returns Svelte props.\n     */\n    static #processProps(props, thisArg, config) {\n        // If a props is a function then invoke it with `this` being the Foundry app.\n        // If an object is returned set it as the props.\n        if (typeof props === 'function') {\n            const result = props.call(thisArg);\n            if (isObject(result)) {\n                return result;\n            }\n            else {\n                throw new Error(`TJSSvelte.config.parseConfig - 'props' is a function that did not return an object for config:\\n${JSON.stringify(config)}`);\n            }\n        }\n        else if (isObject(props)) {\n            return props;\n        }\n        else if (props !== void 0) {\n            throw new Error(`TJSSvelte.config.parseConfig - 'props' is not a function or an object for config:\\n${JSON.stringify(config)}`);\n        }\n        return {};\n    }\n}\nObject.seal(APIConfig);\n\n// @ts-ignore\n/**\n * Various utilities to duck type / detect Svelte components and run outro transition while destroying a component\n * externally.\n */\nclass APIUtil {\n    constructor() { }\n    /**\n     * Provides basic duck typing to determine if the provided function is a constructor function for a Svelte\n     * component.\n     *\n     * @param comp - Data to check as a Svelte component.\n     *\n     * @returns Whether basic duck typing succeeds.\n     */\n    static isComponent(comp) {\n        if (comp === null || comp === void 0 || typeof comp !== 'function') {\n            return false;\n        }\n        // When using Vite in a developer build the SvelteComponent is wrapped in a ProxyComponent class.\n        // This class doesn't define methods on the prototype, so we must check if the constructor name\n        // starts with `Proxy<` as it provides the wrapped component as `Proxy<_wrapped component name_>`.\n        const prototypeName = comp?.prototype?.constructor?.name;\n        if (typeof prototypeName === 'string' && (prototypeName.startsWith('Proxy<') ||\n            prototypeName === 'ProxyComponent')) {\n            return true;\n        }\n        return typeof window !== 'undefined' ?\n            typeof comp?.prototype?.$destroy === 'function' && typeof comp?.prototype?.$on === 'function' : // client-side\n            typeof comp?.prototype?.render === 'function'; // server-side\n    }\n    /**\n     * Provides basic duck typing to determine if the provided object is a HMR ProxyComponent instance or class.\n     *\n     * @param {unknown}  comp - Data to check as a HMR proxy component.\n     *\n     * @returns {boolean} Whether basic duck typing succeeds.\n     */\n    static isHMRProxy(comp) {\n        const instanceName = comp?.constructor?.name;\n        if (typeof instanceName === 'string' && (instanceName.startsWith('Proxy<') || instanceName === 'ProxyComponent')) {\n            return true;\n        }\n        // @ts-ignore\n        const prototypeName = comp?.prototype?.constructor?.name;\n        return typeof prototypeName === 'string' && (prototypeName.startsWith('Proxy<') ||\n            prototypeName === 'ProxyComponent');\n    }\n    /**\n     * Runs outro transition then destroys Svelte component.\n     *\n     * Workaround for https://github.com/sveltejs/svelte/issues/4056\n     *\n     * @param instance - A Svelte component.\n     *\n     * @returns Promise returned after outro transition completed and component destroyed.\n     */\n    static async outroAndDestroy(instance) {\n        if (instance === void 0 || instance === null) {\n            return Promise.resolve();\n        }\n        return new Promise((resolve) => {\n            if (instance?.$$?.fragment && instance?.$$?.fragment?.o) {\n                group_outros();\n                transition_out(instance.$$.fragment, 0, 0, () => {\n                    instance?.$destroy?.();\n                    resolve();\n                });\n                check_outros();\n            }\n            else {\n                instance?.$destroy?.();\n                resolve();\n            }\n        });\n    }\n}\nObject.seal(APIUtil);\n\n/**\n * Provides utilities to verify and parse {@link TJSSvelte.Config} configuration objects and general verification of\n * Svelte components.\n */\nclass TJSSvelte {\n    constructor() { }\n    static get config() { return APIConfig; }\n    /**\n     * @returns The utility API.\n     */\n    static get util() { return APIUtil; }\n}\nObject.seal(TJSSvelte);\n\nexport { TJSSvelte };\n//# sourceMappingURL=index.js.map\n","/*\nAdapted from https://github.com/mattdesl\nDistributed under MIT License https://github.com/mattdesl/eases/blob/master/LICENSE.md\n*/\nexport { identity as linear } from '../internal/index.js';\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function backInOut(t) {\n\tconst s = 1.70158 * 1.525;\n\tif ((t *= 2) < 1) return 0.5 * (t * t * ((s + 1) * t - s));\n\treturn 0.5 * ((t -= 2) * t * ((s + 1) * t + s) + 2);\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function backIn(t) {\n\tconst s = 1.70158;\n\treturn t * t * ((s + 1) * t - s);\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function backOut(t) {\n\tconst s = 1.70158;\n\treturn --t * t * ((s + 1) * t + s) + 1;\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function bounceOut(t) {\n\tconst a = 4.0 / 11.0;\n\tconst b = 8.0 / 11.0;\n\tconst c = 9.0 / 10.0;\n\tconst ca = 4356.0 / 361.0;\n\tconst cb = 35442.0 / 1805.0;\n\tconst cc = 16061.0 / 1805.0;\n\tconst t2 = t * t;\n\treturn t < a\n\t\t? 7.5625 * t2\n\t\t: t < b\n\t\t? 9.075 * t2 - 9.9 * t + 3.4\n\t\t: t < c\n\t\t? ca * t2 - cb * t + cc\n\t\t: 10.8 * t * t - 20.52 * t + 10.72;\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function bounceInOut(t) {\n\treturn t < 0.5 ? 0.5 * (1.0 - bounceOut(1.0 - t * 2.0)) : 0.5 * bounceOut(t * 2.0 - 1.0) + 0.5;\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function bounceIn(t) {\n\treturn 1.0 - bounceOut(1.0 - t);\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function circInOut(t) {\n\tif ((t *= 2) < 1) return -0.5 * (Math.sqrt(1 - t * t) - 1);\n\treturn 0.5 * (Math.sqrt(1 - (t -= 2) * t) + 1);\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function circIn(t) {\n\treturn 1.0 - Math.sqrt(1.0 - t * t);\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function circOut(t) {\n\treturn Math.sqrt(1 - --t * t);\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function cubicInOut(t) {\n\treturn t < 0.5 ? 4.0 * t * t * t : 0.5 * Math.pow(2.0 * t - 2.0, 3.0) + 1.0;\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function cubicIn(t) {\n\treturn t * t * t;\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function cubicOut(t) {\n\tconst f = t - 1.0;\n\treturn f * f * f + 1.0;\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function elasticInOut(t) {\n\treturn t < 0.5\n\t\t? 0.5 * Math.sin(((+13.0 * Math.PI) / 2) * 2.0 * t) * Math.pow(2.0, 10.0 * (2.0 * t - 1.0))\n\t\t: 0.5 *\n\t\t\t\tMath.sin(((-13.0 * Math.PI) / 2) * (2.0 * t - 1.0 + 1.0)) *\n\t\t\t\tMath.pow(2.0, -10.0 * (2.0 * t - 1.0)) +\n\t\t\t\t1.0;\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function elasticIn(t) {\n\treturn Math.sin((13.0 * t * Math.PI) / 2) * Math.pow(2.0, 10.0 * (t - 1.0));\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function elasticOut(t) {\n\treturn Math.sin((-13.0 * (t + 1.0) * Math.PI) / 2) * Math.pow(2.0, -10.0 * t) + 1.0;\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function expoInOut(t) {\n\treturn t === 0.0 || t === 1.0\n\t\t? t\n\t\t: t < 0.5\n\t\t? +0.5 * Math.pow(2.0, 20.0 * t - 10.0)\n\t\t: -0.5 * Math.pow(2.0, 10.0 - t * 20.0) + 1.0;\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function expoIn(t) {\n\treturn t === 0.0 ? t : Math.pow(2.0, 10.0 * (t - 1.0));\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function expoOut(t) {\n\treturn t === 1.0 ? t : 1.0 - Math.pow(2.0, -10.0 * t);\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function quadInOut(t) {\n\tt /= 0.5;\n\tif (t < 1) return 0.5 * t * t;\n\tt--;\n\treturn -0.5 * (t * (t - 2) - 1);\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function quadIn(t) {\n\treturn t * t;\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function quadOut(t) {\n\treturn -t * (t - 2.0);\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function quartInOut(t) {\n\treturn t < 0.5 ? +8.0 * Math.pow(t, 4.0) : -8.0 * Math.pow(t - 1.0, 4.0) + 1.0;\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function quartIn(t) {\n\treturn Math.pow(t, 4.0);\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function quartOut(t) {\n\treturn Math.pow(t - 1.0, 3.0) * (1.0 - t) + 1.0;\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function quintInOut(t) {\n\tif ((t *= 2) < 1) return 0.5 * t * t * t * t * t;\n\treturn 0.5 * ((t -= 2) * t * t * t * t + 2);\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function quintIn(t) {\n\treturn t * t * t * t * t;\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function quintOut(t) {\n\treturn --t * t * t * t * t + 1;\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function sineInOut(t) {\n\treturn -0.5 * (Math.cos(Math.PI * t) - 1);\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function sineIn(t) {\n\tconst v = Math.cos(t * Math.PI * 0.5);\n\tif (Math.abs(v) < 1e-14) return 1;\n\telse return 1 - v;\n}\n\n/**\n * https://svelte.dev/docs/svelte-easing\n * @param {number} t\n * @returns {number}\n */\nexport function sineOut(t) {\n\treturn Math.sin((t * Math.PI) / 2);\n}\n","import * as svelteEasingFunc from 'svelte/easing';\n\n/**\r\n * Defines a read-only list of Svelte easing function names.\r\n *\r\n * @type {Readonly<import('./types').EasingFunctionName[]>}\r\n */\r\nconst easingList = Object.freeze([\r\n   'backIn',\r\n   'backInOut',\r\n   'backOut',\r\n   'bounceIn',\r\n   'bounceInOut',\r\n   'bounceOut',\r\n   'circIn',\r\n   'circInOut',\r\n   'circOut',\r\n   'cubicIn',\r\n   'cubicInOut',\r\n   'cubicOut',\r\n   'elasticIn',\r\n   'elasticInOut',\r\n   'elasticOut',\r\n   'expoIn',\r\n   'expoInOut',\r\n   'expoOut',\r\n   'linear',\r\n   'quadIn',\r\n   'quadInOut',\r\n   'quadOut',\r\n   'quartIn',\r\n   'quartInOut',\r\n   'quartOut',\r\n   'quintIn',\r\n   'quintInOut',\r\n   'quintOut',\r\n   'sineIn',\r\n   'sineInOut',\r\n   'sineOut'\r\n]);\n\n/**\r\n * @type {Readonly<{ [key in import('./types').EasingFunctionName]: import('#runtime/svelte/easing').EasingFunction }>}\r\n */\r\nconst easingFunc = svelteEasingFunc;\n\n/**\r\n * Performs a lookup for standard Svelte easing functions by name. For convenience if passing in a function it is\r\n * returned verbatim.\r\n *\r\n * @param {import('./types').EasingReference} easingRef - The name of a standard Svelte easing function or a supplied\r\n *        easing function.\r\n *\r\n * @param {object}   [options] - Optional parameters.\r\n *\r\n * @param {import('./types').EasingFunctionName | false} [options.default='linear'] - A default easing function by\r\n *        name to return. When specified as `false` no default fallback easing function is selected. The default value\r\n *        is `linear`.\r\n *\r\n * @returns {import('#runtime/svelte/easing').EasingFunction} The requested easing function.\r\n */\r\nfunction getEasingFunc(easingRef, options)\r\n{\r\n   if (typeof easingRef === 'function') { return easingRef; }\r\n\r\n   const easingFn = easingFunc[easingRef];\r\n\r\n   return easingFn ? easingFn : easingFunc[options?.default ?? 'linear'];\r\n}\n\nexport { easingFunc, easingList, getEasingFunc };\n//# sourceMappingURL=index.js.map\n","import { CrossWindow } from '@typhonjs-fvtt/runtime/util/browser';\nimport { isObject, isIterable } from '@typhonjs-fvtt/runtime/util/object';\n\n/**\r\n * Provides several helpful utility methods for accessibility and keyboard navigation.\r\n *\r\n * Note: Global debugging can be enabled by setting `A11yHelper.debug = true`.\r\n */\r\nclass A11yHelper\r\n{\r\n   /**\r\n    * You can set global focus debugging enabled by setting `A11yHelper.debug = true`.\r\n    *\r\n    * @type {boolean}\r\n    */\r\n   static #globalDebug = false;\r\n\r\n   /**\r\n    * @returns {boolean} Global debugging enabled.\r\n    */\r\n   static get debug() { return this.#globalDebug; }\r\n\r\n   /**\r\n    * @param {boolean}  debug - Global debug enabled\r\n    */\r\n   static set debug(debug)\r\n   {\r\n      if (typeof debug !== 'boolean') { throw new TypeError(`'debug' is not a boolean.`); }\r\n\r\n      this.#globalDebug = debug;\r\n   }\r\n\r\n   /**\r\n    * Runs a media query to determine if the user / OS configuration is set up for reduced motion / animation.\r\n    *\r\n    * @returns {boolean} User prefers reduced motion.\r\n    */\r\n   static get prefersReducedMotion()\r\n   {\r\n      return globalThis?.matchMedia('(prefers-reduced-motion: reduce)')?.matches ?? false;\r\n   }\r\n\r\n   /**\r\n    * Apply focus to the HTMLElement / SVGElement targets in a given A11yFocusSource data object. An iterable list\r\n    * `options.focusEl` can contain HTMLElement / SVGElements or selector strings. If multiple focus targets are\r\n    * provided in a list then the first valid target found will be focused. If focus target is a string then a lookup\r\n    * via `document.querySelector` is performed. In this case you should provide a unique selector for the desired\r\n    * focus target.\r\n    *\r\n    * Note: The body of this method is postponed to the next clock tick to allow any changes in the DOM to occur that\r\n    * might alter focus targets before applying.\r\n    *\r\n    * @param {A11yFocusSource | { focusSource: A11yFocusSource }}   options - The focus options instance to apply.\r\n    */\r\n   static applyFocusSource(options)\r\n   {\r\n      if (!isObject(options)) { return; }\r\n\r\n      // Handle the case of receiving an object with embedded `focusSource`.\r\n      const focusOpts = isObject(options?.focusSource) ? options.focusSource : options;\r\n\r\n      setTimeout(() =>\r\n      {\r\n         const debug = typeof focusOpts.debug === 'boolean' ? this.debug || focusOpts.debug : this.debug;\r\n\r\n         if (isIterable(focusOpts.focusEl))\r\n         {\r\n            if (debug)\r\n            {\r\n               console.debug(`A11yHelper.applyFocusSource debug - Attempting to apply focus target: `,\r\n                focusOpts.focusEl);\r\n            }\r\n\r\n            for (const target of focusOpts.focusEl)\r\n            {\r\n               if (target?.nodeType === Node.ELEMENT_NODE && target?.isConnected)\r\n               {\r\n                  target?.focus();\r\n                  if (debug)\r\n                  {\r\n                     console.debug(`A11yHelper.applyFocusSource debug - Applied focus to target: `, target);\r\n                  }\r\n                  break;\r\n               }\r\n               else if (typeof target === 'string')\r\n               {\r\n                  const element = document.querySelector(target);\r\n                  if (element?.nodeType === Node.ELEMENT_NODE && element?.isConnected)\r\n                  {\r\n                     element?.focus();\r\n                     if (debug)\r\n                     {\r\n                        console.debug(`A11yHelper.applyFocusSource debug - Applied focus to target: `, element);\r\n                     }\r\n                     break;\r\n                  }\r\n                  else if (debug)\r\n                  {\r\n                     console.debug(`A11yHelper.applyFocusSource debug - Could not query selector: `, target);\r\n                  }\r\n               }\r\n            }\r\n         }\r\n         else if (debug)\r\n         {\r\n            console.debug(`A11yHelper.applyFocusSource debug - No focus targets defined.`);\r\n         }\r\n      }, 0);\r\n   }\r\n\r\n   /**\r\n    * Returns first focusable element within a specified element.\r\n    *\r\n    * @param {Element | Document} [element=document] - Optional element to start query.\r\n    *\r\n    * @param {FocusableElementOptions} [options] - Optional parameters.\r\n    *\r\n    * @returns {FocusableElement} First focusable child element.\r\n    */\r\n   static getFirstFocusableElement(element = document, options)\r\n   {\r\n      const focusableElements = this.getFocusableElements(element, options);\r\n\r\n      return focusableElements.length > 0 ? focusableElements[0] : void 0;\r\n   }\r\n\r\n   /**\r\n    * Returns all focusable elements within a specified element.\r\n    *\r\n    * @param {Element | Document} [element=document] Optional element to start query.\r\n    *\r\n    * @param {FocusableElementOptions} [options] - Optional parameters.\r\n    *\r\n    * @returns {Array<FocusableElement>} Child keyboard focusable elements.\r\n    */\r\n   static getFocusableElements(element = document, { anchorHref = true, ignoreClasses, ignoreElements,\r\n    parentHidden = false, selectors } = {})\r\n   {\r\n      if (element?.nodeType !== Node.ELEMENT_NODE && element?.nodeType !== Node.DOCUMENT_NODE)\r\n      {\r\n         throw new TypeError(`'element' is not a HTMLElement, SVGElement, or Document instance.`);\r\n      }\r\n\r\n      if (typeof anchorHref !== 'boolean')\r\n      {\r\n         throw new TypeError(`'anchorHref' is not a boolean.`);\r\n      }\r\n\r\n      if (ignoreClasses !== void 0 && !isIterable(ignoreClasses))\r\n      {\r\n         throw new TypeError(`'ignoreClasses' is not an iterable list.`);\r\n      }\r\n\r\n      if (ignoreElements !== void 0 && !CrossWindow.isSet(ignoreElements))\r\n      {\r\n         throw new TypeError(`'ignoreElements' is not a Set.`);\r\n      }\r\n\r\n      if (selectors !== void 0 && typeof selectors !== 'string')\r\n      {\r\n         throw new TypeError(`'selectors' is not a string.`);\r\n      }\r\n\r\n      const selectorQuery = selectors ?? this.#getFocusableSelectors(anchorHref);\r\n\r\n      let allElements = [...element.querySelectorAll(selectorQuery)];\r\n\r\n      if (ignoreElements && ignoreClasses)\r\n      {\r\n         allElements = allElements.filter((el) =>\r\n         {\r\n            let hasIgnoreClass = false;\r\n            for (const ignoreClass of ignoreClasses)\r\n            {\r\n               if (el.classList.contains(ignoreClass))\r\n               {\r\n                  hasIgnoreClass = true;\r\n                  break;\r\n               }\r\n            }\r\n\r\n            return !hasIgnoreClass && !ignoreElements.has(el) && el.style.display !== 'none' &&\r\n             el.style.visibility !== 'hidden' && !el.hasAttribute('disabled') && !el.hasAttribute('inert') &&\r\n              el.getAttribute('aria-hidden') !== 'true';\r\n         });\r\n      }\r\n      else if (ignoreClasses)\r\n      {\r\n         allElements = allElements.filter((el) =>\r\n         {\r\n            let hasIgnoreClass = false;\r\n            for (const ignoreClass of ignoreClasses)\r\n            {\r\n               if (el.classList.contains(ignoreClass))\r\n               {\r\n                  hasIgnoreClass = true;\r\n                  break;\r\n               }\r\n            }\r\n\r\n            return !hasIgnoreClass && el.style.display !== 'none' && el.style.visibility !== 'hidden' &&\r\n             !el.hasAttribute('disabled') && !el.hasAttribute('inert') && el.getAttribute('aria-hidden') !== 'true';\r\n         });\r\n      }\r\n      else if (ignoreElements)\r\n      {\r\n         allElements = allElements.filter((el) =>\r\n         {\r\n            return !ignoreElements.has(el) && el.style.display !== 'none' && el.style.visibility !== 'hidden' &&\r\n             !el.hasAttribute('disabled') && !el.hasAttribute('inert') && el.getAttribute('aria-hidden') !== 'true';\r\n         });\r\n      }\r\n      else\r\n      {\r\n         allElements = allElements.filter((el) =>\r\n         {\r\n            return el.style.display !== 'none' && el.style.visibility !== 'hidden' && !el.hasAttribute('disabled') &&\r\n             !el.hasAttribute('inert') && el.getAttribute('aria-hidden') !== 'true';\r\n         });\r\n      }\r\n\r\n      if (parentHidden)\r\n      {\r\n         allElements = allElements.filter((el) =>\r\n         {\r\n            return !this.isParentHidden(el, element);\r\n         });\r\n      }\r\n\r\n      return allElements;\r\n   }\r\n\r\n   /**\r\n    * Returns the default focusable selectors query.\r\n    *\r\n    * @param {boolean}  [anchorHref=true] - When true anchors must have an HREF.\r\n    *\r\n    * @returns {string} Focusable selectors for `querySelectorAll`.\r\n    */\r\n   static #getFocusableSelectors(anchorHref = true)\r\n   {\r\n      return `button, [contenteditable=\"\"], [contenteditable=\"true\"], details summary:not([tabindex=\"-1\"]), embed, a${\r\n       anchorHref ? '[href]' : ''}, iframe, object, input:not([type=hidden]), select, textarea, ` +\r\n        `[tabindex]:not([tabindex=\"-1\"])`;\r\n   }\r\n\r\n   /**\r\n    * Gets a A11yFocusSource object from the given DOM event allowing for optional X / Y screen space overrides.\r\n    * Browsers (Firefox / Chrome) forwards a mouse event for the context menu keyboard button. Provides detection of\r\n    * when the context menu event is from the keyboard. Firefox as of (1/23) does not provide the correct screen space\r\n    * coordinates, so for keyboard context menu presses coordinates are generated from the centroid point of the\r\n    * element.\r\n    *\r\n    * A default fallback element or selector string may be provided to provide the focus target. If the event comes from\r\n    * the keyboard however the source focused element is inserted as the target with the fallback value appended to the\r\n    * list of focus targets. When A11yFocusSource is applied by {@link A11yHelper.applyFocusSource} the target focus\r\n    * list is iterated through until a connected target is found and focus applied.\r\n    *\r\n    * @param {object} options - Options\r\n    *\r\n    * @param {KeyboardEvent | MouseEvent}   [options.event] - The source DOM event.\r\n    *\r\n    * @param {boolean} [options.debug] - When true {@link A11yHelper.applyFocusSource} logs focus target data.\r\n    *\r\n    * @param {FocusableElement | string} [options.focusEl] - A specific HTMLElement / SVGElement or selector\r\n    *        string as the focus target.\r\n    *\r\n    * @param {number}   [options.x] - Used when an event isn't provided; integer of event source in screen space.\r\n    *\r\n    * @param {number}   [options.y] - Used when an event isn't provided; integer of event source in screen space.\r\n    *\r\n    * @returns {A11yFocusSource} A A11yFocusSource object.\r\n    *\r\n    * @see https://bugzilla.mozilla.org/show_bug.cgi?id=1426671\r\n    * @see https://bugzilla.mozilla.org/show_bug.cgi?id=314314\r\n    *\r\n    * @privateRemarks\r\n    * TODO: Evaluate / test against touch input devices.\r\n    */\r\n   static getFocusSource({ event, x, y, focusEl, debug = false })\r\n   {\r\n      if (focusEl !== void 0 && !this.isFocusSource(focusEl))\r\n      {\r\n         throw new TypeError(\r\n          `A11yHelper.getFocusSource error: 'focusEl' is not a HTMLElement, SVGElement, or string.`);\r\n      }\r\n\r\n      if (debug !== void 0 && typeof debug !== 'boolean')\r\n      {\r\n         throw new TypeError(`A11yHelper.getFocusSource error: 'debug' is not a boolean.`);\r\n      }\r\n\r\n      const debugEnabled = typeof debug === 'boolean' ? this.debug || debug : this.debug;\r\n\r\n      // Handle the case when no event is provided and x, y, or focusEl is explicitly defined.\r\n      if (event === void 0)\r\n      {\r\n         if (typeof x !== 'number')\r\n         {\r\n            throw new TypeError(`A11yHelper.getFocusSource error: 'event' not defined and 'x' is not a number.`);\r\n         }\r\n\r\n         if (typeof y !== 'number')\r\n         {\r\n            throw new TypeError(`A11yHelper.getFocusSource error: 'event' not defined and 'y' is not a number.`);\r\n         }\r\n\r\n         const result = {\r\n            debug,\r\n            focusEl: focusEl !== void 0 ? [focusEl] : void 0,\r\n            x,\r\n            y,\r\n         };\r\n\r\n         if (debugEnabled)\r\n         {\r\n            console.debug(`A11yHelper.getFocusSource debug: generated 'focusSource' without event: `, result);\r\n         }\r\n\r\n         return result;\r\n      }\r\n\r\n      // Perform duck typing on event constructor name.\r\n      if (event !== void 0 && !CrossWindow.isUserInputEvent(event))\r\n      {\r\n         throw new TypeError(\r\n          `A11yHelper.getFocusSource error: 'event' is not a KeyboardEvent, MouseEvent, or PointerEvent.`);\r\n      }\r\n\r\n      if (x !== void 0 && !Number.isInteger(x))\r\n      {\r\n         throw new TypeError(`A11yHelper.getFocusSource error: 'x' is not a number.`);\r\n      }\r\n\r\n      if (y !== void 0 && !Number.isInteger(y))\r\n      {\r\n         throw new TypeError(`A11yHelper.getFocusSource error: 'y' is not a number.`);\r\n      }\r\n\r\n      /** @type {Element} */\r\n      let targetEl;\r\n\r\n      if (event)\r\n      {\r\n         if (A11yHelper.isFocusable(event.target))\r\n         {\r\n            targetEl = event.target;\r\n            if (debugEnabled)\r\n            {\r\n               console.debug(`A11yHelper.getFocusSource debug: 'targetEl' set to event.target: `, targetEl);\r\n            }\r\n         }\r\n         else if (A11yHelper.isFocusable(event.currentTarget))\r\n         {\r\n            targetEl = event.currentTarget;\r\n            if (debugEnabled)\r\n            {\r\n               console.debug(`A11yHelper.getFocusSource debug: 'targetEl' set to event.currentTarget: `, targetEl);\r\n            }\r\n         }\r\n         else\r\n         {\r\n            if (debugEnabled)\r\n            {\r\n               console.debug(\r\n                `A11yHelper.getFocusSource debug: 'event.target' / 'event.currentTarget' are not focusable.`);\r\n               console.debug(`A11yHelper.getFocusSource debug: 'event.target': `, event.target);\r\n               console.debug(`A11yHelper.getFocusSource debug: 'event.currentTarget': `, event.currentTarget);\r\n            }\r\n         }\r\n\r\n         if (targetEl)\r\n         {\r\n            if (targetEl?.nodeType !== Node.ELEMENT_NODE && typeof targetEl?.focus !== 'function')\r\n            {\r\n               throw new TypeError(`A11yHelper.getFocusSource error: 'targetEl' is not an HTMLElement or SVGElement.`);\r\n            }\r\n         }\r\n      }\r\n\r\n      const result = { debug };\r\n\r\n      // Perform duck typing on event constructor name.\r\n      if (CrossWindow.isPointerEvent(event))\r\n      {\r\n         // Firefox currently (11/24) does not correctly determine the location of a keyboard originated\r\n         // context menu location, so calculate position from middle of the event target.\r\n         // Firefox fires a mouse event for the context menu key.\r\n         if (event?.button !== 2 && event.type === 'contextmenu')\r\n         {\r\n            // Always include x / y coordinates and targetEl may not be defined.\r\n            const rectTarget = targetEl ?? event.target;\r\n\r\n            const rect = rectTarget.getBoundingClientRect();\r\n            result.source = 'keyboard';\r\n            result.x = x ?? rect.left + (rect.width / 2);\r\n            result.y = y ?? rect.top + (rect.height / 2);\r\n            result.focusEl = targetEl ? [targetEl] : [];\r\n\r\n            if (focusEl) { result.focusEl.push(focusEl); }\r\n         }\r\n         else\r\n         {\r\n            result.source = 'pointer';\r\n            result.x = x ?? event.pageX;\r\n            result.y = y ?? event.pageY;\r\n            result.focusEl = targetEl ? [targetEl] : [];\r\n\r\n            if (focusEl) { result.focusEl.push(focusEl); }\r\n         }\r\n      }\r\n      else\r\n      {\r\n         // Always include x / y coordinates and targetEl may not be defined.\r\n         const rectTarget = targetEl ?? event?.target;\r\n\r\n         if (rectTarget)\r\n         {\r\n            const rect = rectTarget.getBoundingClientRect();\r\n            result.source = 'keyboard';\r\n            result.x = x ?? rect.left + (rect.width / 2);\r\n            result.y = y ?? rect.top + (rect.height / 2);\r\n            result.focusEl = targetEl ? [targetEl] : [];\r\n         }\r\n\r\n         if (focusEl) { result.focusEl.push(focusEl); }\r\n      }\r\n\r\n      if (debugEnabled)\r\n      {\r\n         console.debug(`A11yHelper.getFocusSource debug: generated 'focusSource' with event: `, result);\r\n      }\r\n\r\n      return result;\r\n   }\r\n\r\n   /**\r\n    * Returns first focusable element within a specified element.\r\n    *\r\n    * @param {Element | Document} [element=document] - Optional element to start query.\r\n    *\r\n    * @param {FocusableElementOptions} [options] - Optional parameters.\r\n    *\r\n    * @returns {FocusableElement} Last focusable child element.\r\n    */\r\n   static getLastFocusableElement(element = document, options)\r\n   {\r\n      const focusableElements = this.getFocusableElements(element, options);\r\n\r\n      return focusableElements.length > 0 ? focusableElements[focusableElements.length - 1] : void 0;\r\n   }\r\n\r\n   /**\r\n    * Tests if the given element is focusable.\r\n    *\r\n    * @param {unknown} el - Element to test.\r\n    *\r\n    * @param {object} [options] - Optional parameters.\r\n    *\r\n    * @param {boolean} [options.anchorHref=true] - When true anchors must have an HREF.\r\n    *\r\n    * @param {Iterable<string>} [options.ignoreClasses] - Iterable list of classes to ignore elements.\r\n    *\r\n    * @returns {boolean} Element is focusable.\r\n    */\r\n   static isFocusable(el, { anchorHref = true, ignoreClasses } = {})\r\n   {\r\n      if (el === void 0 || el === null || el?.hidden || !el?.isConnected || el?.nodeType !== Node.ELEMENT_NODE ||\r\n       typeof el?.focus !== 'function')\r\n      {\r\n         return false;\r\n      }\r\n\r\n      if (typeof anchorHref !== 'boolean')\r\n      {\r\n         throw new TypeError(`'anchorHref' is not a boolean.`);\r\n      }\r\n\r\n      if (ignoreClasses !== void 0 && !isIterable(ignoreClasses))\r\n      {\r\n         throw new TypeError(`'ignoreClasses' is not an iterable list.`);\r\n      }\r\n\r\n      const contenteditableAttr = el.getAttribute('contenteditable');\r\n      const contenteditableFocusable = typeof contenteditableAttr === 'string' &&\r\n       (contenteditableAttr === '' || contenteditableAttr === 'true');\r\n\r\n      const tabindexAttr = globalThis.parseInt(el.getAttribute('tabindex'));\r\n      const tabindexFocusable = Number.isInteger(tabindexAttr) && tabindexAttr >= 0;\r\n\r\n      if (contenteditableFocusable || tabindexFocusable || CrossWindow.isFocusableHTMLElement(el))\r\n      {\r\n         // Ensure that an anchor element has an `href` attribute.\r\n         if (anchorHref && !tabindexFocusable && CrossWindow.isHTMLAnchorElement(el) &&\r\n          typeof el.getAttribute('href') !== 'string')\r\n         {\r\n            return false;\r\n         }\r\n\r\n         return el.style.display !== 'none' && el.style.visibility !== 'hidden' && !el.hasAttribute('disabled') &&\r\n          !el.hasAttribute('inert') && el.getAttribute('aria-hidden') !== 'true';\r\n      }\r\n\r\n      return false;\r\n   }\r\n\r\n   /**\r\n    * Convenience method to check if the given data is a valid focus source.\r\n    *\r\n    * @param {Element | EventTarget | string}   data - Either an HTMLElement, SVGElement, or selector string.\r\n    *\r\n    * @returns {boolean} Is valid focus source.\r\n    */\r\n   static isFocusSource(data)\r\n   {\r\n      return typeof data === 'string' || (data?.nodeType === Node.ELEMENT_NODE && typeof data?.focus === 'function');\r\n   }\r\n\r\n   /**\r\n    * Tests if the given `element` is a Element node and has a `focus` method.\r\n    *\r\n    * @param {unknown}  element - Element to test for focus method.\r\n    *\r\n    * @returns {element is FocusableElement} Whether the element has a focus method.\r\n    */\r\n   static isFocusTarget(element)\r\n   {\r\n      return element !== void 0 && element !== null && element?.nodeType === Node.ELEMENT_NODE &&\r\n       typeof element?.focus === 'function';\r\n   }\r\n\r\n   /**\r\n    * Perform a parent traversal from the current active element attempting to match the given element to test whether\r\n    * current active element is within that element.\r\n    *\r\n    * @param {Element}  element - An element to match in parent traversal from the active element.\r\n    *\r\n    * @returns {boolean} Whether there is focus within the given element.\r\n    */\r\n   static isFocusWithin(element)\r\n   {\r\n      if (!isObject(element) || element?.hidden || !element?.isConnected) { return false; }\r\n\r\n      let active = CrossWindow.getActiveElement(element);\r\n\r\n      if (!active) { return false; }\r\n\r\n      while (active)\r\n      {\r\n         if (active === element) { return true; }\r\n\r\n         active = active.parentElement;\r\n      }\r\n\r\n      return false;\r\n   }\r\n\r\n   /**\r\n    * Traverses the given element's parent elements to check if any parent has `offsetWidth` and `offsetHeight` of 0,\r\n    * indicating that a parent element is hidden. If a parent element is hidden, the given element is also considered\r\n    * hidden. This is a reasonably efficient check and can be enabled as a filter step in conjunction with focusable\r\n    * element detection methods like {@link A11yHelper.getFocusableElements}.\r\n    *\r\n    * @param {Element}  element - The starting element to check.\r\n    *\r\n    * @param {Element}  [stopElement] - The stopping parent element for traversal. If not defined, `document.body` is\r\n    *        used as the stopping element.\r\n    *\r\n    * @returns {boolean} `true` if a parent element of the given element is hidden; otherwise, `false`.\r\n    */\r\n   static isParentHidden(element, stopElement)\r\n   {\r\n      if (!CrossWindow.isElement(element)) { throw new TypeError(`'element' is not an Element.`); }\r\n\r\n      // Set `stopElement` to `document.body` if undefined.\r\n      stopElement = stopElement ?? CrossWindow.getDocument(element)?.body;\r\n\r\n      if (!CrossWindow.isElement(stopElement)) { throw new TypeError(`'stopElement' must be an Element.`); }\r\n\r\n      let current = element.parentElement;\r\n\r\n      while (current)\r\n      {\r\n         // Stop traversal if `stopElement` is reached.\r\n         if (current === stopElement) { break; }\r\n\r\n         // Check if the current parent is hidden by its size.\r\n         if (current.offsetWidth === 0 && current.offsetHeight === 0) { return true; }\r\n\r\n         current = current.parentElement;\r\n      }\r\n\r\n      // No parent is hidden.\r\n      return false;\r\n   }\r\n}\n\nexport { A11yHelper };\n//# sourceMappingURL=index.js.map\n","/**\r\n * Clamps a value between min / max values.\r\n *\r\n * @param {number}   value - Value to clamp.\r\n *\r\n * @param {number}   min - Minimum value.\r\n *\r\n * @param {number}   max - Maximum value.\r\n *\r\n * @returns {number} Clamped value.\r\n */\r\nfunction clamp(value = 0, min = 0, max = 0)\r\n{\r\n   return Math.min(Math.max(value, min), max);\r\n}\n\n/**\r\n * Converts the given number from degrees to radians.\r\n *\r\n * @param {number}   deg - Degree number to convert\r\n *\r\n * @returns {number} Degree as radians.\r\n */\r\nfunction degToRad(deg)\r\n{\r\n   return deg * (Math.PI / 180.0);\r\n}\n\n/**\r\n * Provides methods for retrieving pseudorandom values and other utilities using {@link Math.random}.\r\n */\r\nclass MathRandom\r\n{\r\n   /**\r\n    * Private constructor to prevent instantiation.\r\n    *\r\n    * @private\r\n    */\r\n   constructor()\r\n   {\r\n      throw new Error('This class should not be instantiated.');\r\n   }\r\n\r\n   /**\r\n    * Returns a random inclusive integer.\r\n    *\r\n    * @param {number}   min - Minimum value.\r\n    *\r\n    * @param {number}   max - Maximum value.\r\n    *\r\n    * @returns {number} Random inclusive integer.\r\n    */\r\n   static getInt(min, max)\r\n   {\r\n      min = Math.ceil(min);\r\n      max = Math.floor(max);\r\n\r\n      return Math.floor(Math.random() * (max - min + 1)) + min;\r\n   }\r\n\r\n   /**\r\n    * Returns a random floating point number between min (inclusive) and max (exclusive).\r\n    *\r\n    * @param {number}   min - Minimum value\r\n    *\r\n    * @param {number}   max - Maximum value.\r\n    *\r\n    * @returns {number} Random float.\r\n    */\r\n   static getFloat(min, max)\r\n   {\r\n      return Math.random() * (max - min) + min;\r\n   }\r\n\r\n   /**\r\n    * Returns a random boolean.\r\n    *\r\n    * @returns {boolean} Random boolean.\r\n    */\r\n   static getBoolean()\r\n   {\r\n      return Math.random() > 0.5;\r\n   }\r\n\r\n   /**\r\n    * Shuffles an array using the Fisher-Yates shuffle algorithm. Modifies the input array in place and returns it.\r\n    *\r\n    * @template T\r\n    *\r\n    * @param {T[]} arr - The array to shuffle.\r\n    *\r\n    * @returns {T[]} The shuffled array.\r\n    */\r\n   static shuffleArray(arr)\r\n   {\r\n      for (let i = arr.length - 1; i > 0; i--)\r\n      {\r\n         const j = MathRandom.getInt(0, i);\r\n         [arr[i], arr[j]] = [arr[j], arr[i]];\r\n      }\r\n\r\n      return arr;\r\n   }\r\n}\n\n/**\r\n * Converts the given number from radians to degrees.\r\n *\r\n * @param {number}   rad - Radian number to convert.\r\n *\r\n * @returns {number} Degree as radians.\r\n */\r\nfunction radToDeg(rad)\r\n{\r\n   return rad * (180.0 / Math.PI);\r\n}\n\nexport { MathRandom, clamp, degToRad, radToDeg };\n//# sourceMappingURL=index.js.map\n","/**\r\n * Performs linear interpolation between a start & end value by given amount between 0 - 1 inclusive.\r\n *\r\n * @param {number}   start - Start value.\r\n *\r\n * @param {number}   end - End value.\r\n *\r\n * @param {number}   amount - Current amount between 0 - 1 inclusive.\r\n *\r\n * @returns {number} Linear interpolated value between start & end.\r\n */\r\nfunction lerp(start, end, amount)\r\n{\r\n   return (1 - amount) * start + amount * end;\r\n}\n\nexport { lerp };\n//# sourceMappingURL=index.js.map\n","// gl-matrix - v4.0.0-beta.3 - A high performance matrix and vector library.\n// @author Brandon Jones\n// @author Colin MacKenzie IV\n// @license MIT (https://github.com/toji/gl-matrix/blob/master/LICENSE.md)\n\n// src/common/index.ts\nvar GLM_EPSILON = 1e-6;\n\n// gl-matrix - v4.0.0-beta.3 - A high performance matrix and vector library.\n// @author Brandon Jones\n// @author Colin MacKenzie IV\n// @license MIT (https://github.com/toji/gl-matrix/blob/master/LICENSE.md)\n\nvar Mat2 = class _Mat2 extends Float32Array {\n  static #IDENTITY_2X2 = new Float32Array([\n    1,\n    0,\n    0,\n    1\n  ]);\n  /**\n   * Create a {@link Mat2}.\n   *\n   * @category Constructor\n   */\n  constructor(...values) {\n    switch (values.length) {\n      case 4:\n        super(values);\n        break;\n      case 2:\n        super(values[0], values[1], 4);\n        break;\n      case 1:\n        const v = values[0];\n        if (typeof v === \"number\") {\n          super([\n            v,\n            v,\n            v,\n            v\n          ]);\n        } else {\n          super(v, 0, 4);\n        }\n        break;\n      default:\n        super(_Mat2.#IDENTITY_2X2);\n        break;\n    }\n  }\n  // ============\n  // Accessors\n  // ============\n  /**\n   * A string representation of `this`\n   * Equivalent to `Mat2.str(this);`\n   *\n   * @category Accessors\n   */\n  get str() {\n    return _Mat2.str(this);\n  }\n  // ===================\n  // Instance methods\n  // ===================\n  /**\n   * Copy the values from another {@link Mat2} into `this`.\n   *\n   * @param a the source vector\n   * @returns `this`\n   * @category Methods\n   */\n  copy(a) {\n    this.set(a);\n    return this;\n  }\n  /**\n   * Set `this` to the identity matrix\n   * Equivalent to Mat2.identity(this)\n   *\n   * @returns `this`\n   * @category Methods\n   */\n  identity() {\n    this.set(_Mat2.#IDENTITY_2X2);\n    return this;\n  }\n  /**\n   * Multiplies this {@link Mat2} against another one\n   * Equivalent to `Mat2.multiply(this, this, b);`\n   *\n   * @param b - The second operand\n   * @returns `this`\n   * @category Methods\n   */\n  multiply(b) {\n    return _Mat2.multiply(this, this, b);\n  }\n  /**\n   * Alias for {@link Mat2.multiply}\n   * @category Methods\n   */\n  mul(b) {\n    return this;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Transpose this {@link Mat2}\n   * Equivalent to `Mat2.transpose(this, this);`\n   *\n   * @returns `this`\n   * @category Methods\n   */\n  transpose() {\n    return _Mat2.transpose(this, this);\n  }\n  /**\n   * Inverts this {@link Mat2}\n   * Equivalent to `Mat4.invert(this, this);`\n   *\n   * @returns `this`\n   * @category Methods\n   */\n  invert() {\n    return _Mat2.invert(this, this);\n  }\n  /**\n   * Scales this {@link Mat2} by the dimensions in the given vec3 not using vectorization\n   * Equivalent to `Mat2.scale(this, this, v);`\n   *\n   * @param v - The {@link Vec2} to scale the matrix by\n   * @returns `this`\n   * @category Methods\n   */\n  scale(v) {\n    return _Mat2.scale(this, this, v);\n  }\n  /**\n   * Rotates this {@link Mat2} by the given angle around the given axis\n   * Equivalent to `Mat2.rotate(this, this, rad);`\n   *\n   * @param rad - the angle to rotate the matrix by\n   * @returns `this`\n   * @category Methods\n   */\n  rotate(rad) {\n    return _Mat2.rotate(this, this, rad);\n  }\n  // ===================\n  // Static accessors\n  // ===================\n  /**\n   * @category Static\n   *\n   * @returns The number of bytes in a {@link Mat2}.\n   */\n  static get BYTE_LENGTH() {\n    return 4 * Float32Array.BYTES_PER_ELEMENT;\n  }\n  // ===================\n  // Static methods\n  // ===================\n  /**\n   * Creates a new, identity {@link Mat2}\n   * @category Static\n   *\n   * @returns A new {@link Mat2}\n   */\n  static create() {\n    return new _Mat2();\n  }\n  /**\n   * Creates a new {@link Mat2} initialized with values from an existing matrix\n   * @category Static\n   *\n   * @param a - Matrix to clone\n   * @returns A new {@link Mat2}\n   */\n  static clone(a) {\n    return new _Mat2(a);\n  }\n  /**\n   * Copy the values from one {@link Mat2} to another\n   * @category Static\n   *\n   * @param out - The receiving Matrix\n   * @param a - Matrix to copy\n   * @returns `out`\n   */\n  static copy(out, a) {\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    return out;\n  }\n  /**\n   * Create a new {@link Mat2} with the given values\n   * @category Static\n   *\n   * @param values - Matrix components\n   * @returns A new {@link Mat2}\n   */\n  static fromValues(...values) {\n    return new _Mat2(...values);\n  }\n  /**\n   * Set the components of a {@link Mat2} to the given values\n   * @category Static\n   *\n   * @param out - The receiving matrix\n   * @param values - Matrix components\n   * @returns `out`\n   */\n  static set(out, ...values) {\n    out[0] = values[0];\n    out[1] = values[1];\n    out[2] = values[2];\n    out[3] = values[3];\n    return out;\n  }\n  /**\n   * Set a {@link Mat2} to the identity matrix\n   * @category Static\n   *\n   * @param out - The receiving matrix\n   * @returns `out`\n   */\n  static identity(out) {\n    out[0] = 1;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 1;\n    return out;\n  }\n  /**\n   * Transpose the values of a {@link Mat2}\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the source matrix\n   * @returns `out`\n   */\n  static transpose(out, a) {\n    if (out === a) {\n      const a1 = a[1];\n      out[1] = a[2];\n      out[2] = a1;\n    } else {\n      out[0] = a[0];\n      out[1] = a[2];\n      out[2] = a[1];\n      out[3] = a[3];\n    }\n    return out;\n  }\n  /**\n   * Inverts a {@link Mat2}\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the source matrix\n   * @returns `out` or `null` if the matrix is not invertible\n   */\n  static invert(out, a) {\n    const a0 = a[0];\n    const a1 = a[1];\n    const a2 = a[2];\n    const a3 = a[3];\n    let det = a0 * a3 - a2 * a1;\n    if (!det) {\n      return null;\n    }\n    det = 1 / det;\n    out[0] = a3 * det;\n    out[1] = -a1 * det;\n    out[2] = -a2 * det;\n    out[3] = a0 * det;\n    return out;\n  }\n  /**\n   * Calculates the adjugate of a {@link Mat2}\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the source matrix\n   * @returns `out`\n   */\n  static adjoint(out, a) {\n    const a0 = a[0];\n    out[0] = a[3];\n    out[1] = -a[1];\n    out[2] = -a[2];\n    out[3] = a0;\n    return out;\n  }\n  /**\n   * Calculates the determinant of a {@link Mat2}\n   * @category Static\n   *\n   * @param a - the source matrix\n   * @returns determinant of a\n   */\n  static determinant(a) {\n    return a[0] * a[3] - a[2] * a[1];\n  }\n  /**\n   * Adds two {@link Mat2}'s\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  static add(out, a, b) {\n    out[0] = a[0] + b[0];\n    out[1] = a[1] + b[1];\n    out[2] = a[2] + b[2];\n    out[3] = a[3] + b[3];\n    return out;\n  }\n  /**\n   * Subtracts matrix b from matrix a\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  static subtract(out, a, b) {\n    out[0] = a[0] - b[0];\n    out[1] = a[1] - b[1];\n    out[2] = a[2] - b[2];\n    out[3] = a[3] - b[3];\n    return out;\n  }\n  /**\n   * Alias for {@link Mat2.subtract}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static sub(out, a, b) {\n    return out;\n  }\n  /**\n   * Multiplies two {@link Mat2}s\n   * @category Static\n   *\n   * @param out - The receiving Matrix\n   * @param a - The first operand\n   * @param b - The second operand\n   * @returns `out`\n   */\n  static multiply(out, a, b) {\n    const a0 = a[0];\n    const a1 = a[1];\n    const a2 = a[2];\n    const a3 = a[3];\n    const b0 = b[0];\n    const b1 = b[1];\n    const b2 = b[2];\n    const b3 = b[3];\n    out[0] = a0 * b0 + a2 * b1;\n    out[1] = a1 * b0 + a3 * b1;\n    out[2] = a0 * b2 + a2 * b3;\n    out[3] = a1 * b2 + a3 * b3;\n    return out;\n  }\n  /**\n   * Alias for {@link Mat2.multiply}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static mul(out, a, b) {\n    return out;\n  }\n  /**\n   * Rotates a {@link Mat2} by the given angle\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the matrix to rotate\n   * @param rad - the angle to rotate the matrix by\n   * @returns `out`\n   */\n  static rotate(out, a, rad) {\n    const a0 = a[0];\n    const a1 = a[1];\n    const a2 = a[2];\n    const a3 = a[3];\n    const s = Math.sin(rad);\n    const c = Math.cos(rad);\n    out[0] = a0 * c + a2 * s;\n    out[1] = a1 * c + a3 * s;\n    out[2] = a0 * -s + a2 * c;\n    out[3] = a1 * -s + a3 * c;\n    return out;\n  }\n  /**\n   * Scales the {@link Mat2} by the dimensions in the given {@link Vec2}\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the matrix to scale\n   * @param v - the {@link Vec2} to scale the matrix by\n   * @returns `out`\n   **/\n  static scale(out, a, v) {\n    const a0 = a[0];\n    const a1 = a[1];\n    const a2 = a[2];\n    const a3 = a[3];\n    const v0 = v[0];\n    const v1 = v[1];\n    out[0] = a0 * v0;\n    out[1] = a1 * v0;\n    out[2] = a2 * v1;\n    out[3] = a3 * v1;\n    return out;\n  }\n  /**\n   * Creates a {@link Mat2} from a given angle around a given axis\n   * This is equivalent to (but much faster than):\n   * ```js\n   *   mat2.identity(dest);\n   *   mat2.rotate(dest, dest, rad);\n   * ```\n   * @category Static\n   *\n   * @param out - {@link Mat2} receiving operation result\n   * @param rad - the angle to rotate the matrix by\n   * @returns `out`\n   */\n  static fromRotation(out, rad) {\n    const s = Math.sin(rad);\n    const c = Math.cos(rad);\n    out[0] = c;\n    out[1] = s;\n    out[2] = -s;\n    out[3] = c;\n    return out;\n  }\n  /**\n   * Creates a {@link Mat2} from a vector scaling\n   * This is equivalent to (but much faster than):\n   * ```js\n   *   mat2.identity(dest);\n   *   mat2.scale(dest, dest, vec);\n   * ```\n   * @category Static\n   *\n   * @param out - {@link Mat2} receiving operation result\n   * @param v - Scaling vector\n   * @returns `out`\n   */\n  static fromScaling(out, v) {\n    out[0] = v[0];\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = v[1];\n    return out;\n  }\n  /**\n   * Returns Frobenius norm of a {@link Mat2}\n   * @category Static\n   *\n   * @param a - the matrix to calculate Frobenius norm of\n   * @returns Frobenius norm\n   */\n  static frob(a) {\n    return Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2] + a[3] * a[3]);\n  }\n  /**\n   * Multiply each element of a {@link Mat2} by a scalar.\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the matrix to scale\n   * @param b - amount to scale the matrix's elements by\n   * @returns `out`\n   */\n  static multiplyScalar(out, a, b) {\n    out[0] = a[0] * b;\n    out[1] = a[1] * b;\n    out[2] = a[2] * b;\n    out[3] = a[3] * b;\n    return out;\n  }\n  /**\n   * Adds two {@link Mat2}'s after multiplying each element of the second operand by a scalar value.\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @param scale - the amount to scale b's elements by before adding\n   * @returns `out`\n   */\n  static multiplyScalarAndAdd(out, a, b, scale) {\n    out[0] = a[0] + b[0] * scale;\n    out[1] = a[1] + b[1] * scale;\n    out[2] = a[2] + b[2] * scale;\n    out[3] = a[3] + b[3] * scale;\n    return out;\n  }\n  /**\n   * Returns L, D and U matrices (Lower triangular, Diagonal and Upper triangular) by factorizing the input matrix\n   * @category Static\n   *\n   * @param L - the lower triangular matrix\n   * @param D - the diagonal matrix\n   * @param U - the upper triangular matrix\n   * @param a - the input matrix to factorize\n   */\n  static LDU(L, D, U, a) {\n    L[2] = a[2] / a[0];\n    U[0] = a[0];\n    U[1] = a[1];\n    U[3] = a[3] - L[2] * U[1];\n    return [L, D, U];\n  }\n  /**\n   * Returns whether two {@link Mat2}s have exactly the same elements in the same position (when compared with ===)\n   * @category Static\n   *\n   * @param a - The first matrix.\n   * @param b - The second matrix.\n   * @returns True if the matrices are equal, false otherwise.\n   */\n  static exactEquals(a, b) {\n    return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n  }\n  /**\n   * Returns whether two {@link Mat2}s have approximately the same elements in the same position.\n   * @category Static\n   *\n   * @param a - The first matrix.\n   * @param b - The second matrix.\n   * @returns True if the matrices are equal, false otherwise.\n   */\n  static equals(a, b) {\n    const a0 = a[0];\n    const a1 = a[1];\n    const a2 = a[2];\n    const a3 = a[3];\n    const b0 = b[0];\n    const b1 = b[1];\n    const b2 = b[2];\n    const b3 = b[3];\n    return Math.abs(a0 - b0) <= GLM_EPSILON * Math.max(1, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= GLM_EPSILON * Math.max(1, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= GLM_EPSILON * Math.max(1, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= GLM_EPSILON * Math.max(1, Math.abs(a3), Math.abs(b3));\n  }\n  /**\n   * Returns a string representation of a {@link Mat2}\n   * @category Static\n   *\n   * @param a - matrix to represent as a string\n   * @returns string representation of the matrix\n   */\n  static str(a) {\n    return `Mat2(${a.join(\", \")})`;\n  }\n};\nMat2.prototype.mul = Mat2.prototype.multiply;\nMat2.mul = Mat2.multiply;\nMat2.sub = Mat2.subtract;\nvar Mat2d = class _Mat2d extends Float32Array {\n  static #IDENTITY_2X3 = new Float32Array([\n    1,\n    0,\n    0,\n    1,\n    0,\n    0\n  ]);\n  /**\n   * Create a {@link Mat2}.\n   *\n   * @category Constructor\n   */\n  constructor(...values) {\n    switch (values.length) {\n      case 6:\n        super(values);\n        break;\n      case 2:\n        super(values[0], values[1], 6);\n        break;\n      case 1:\n        const v = values[0];\n        if (typeof v === \"number\") {\n          super([\n            v,\n            v,\n            v,\n            v,\n            v,\n            v\n          ]);\n        } else {\n          super(v, 0, 6);\n        }\n        break;\n      default:\n        super(_Mat2d.#IDENTITY_2X3);\n        break;\n    }\n  }\n  // ============\n  // Accessors\n  // ============\n  /**\n   * A string representation of `this`\n   * Equivalent to `Mat2d.str(this);`\n   *\n   * @category Accessors\n   */\n  get str() {\n    return _Mat2d.str(this);\n  }\n  // ===================\n  // Instances methods\n  // ===================\n  /**\n   * Copy the values from another {@link Mat2d} into `this`.\n   * @category Methods\n   *\n   * @param a the source vector\n   * @returns `this`\n   */\n  copy(a) {\n    this.set(a);\n    return this;\n  }\n  /**\n   * Set `this` to the identity matrix\n   * Equivalent to Mat2d.identity(this)\n   * @category Methods\n   *\n   * @returns `this`\n   */\n  identity() {\n    this.set(_Mat2d.#IDENTITY_2X3);\n    return this;\n  }\n  /**\n   * Multiplies this {@link Mat2d} against another one\n   * Equivalent to `Mat2d.multiply(this, this, b);`\n   * @category Methods\n   *\n   * @param out - The receiving Matrix\n   * @param a - The first operand\n   * @param b - The second operand\n   * @returns `this`\n   */\n  multiply(b) {\n    return _Mat2d.multiply(this, this, b);\n  }\n  /**\n   * Alias for {@link Mat2d.multiply}\n   * @category Methods\n   */\n  mul(b) {\n    return this;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Translate this {@link Mat2d} by the given vector\n   * Equivalent to `Mat2d.translate(this, this, v);`\n   * @category Methods\n   *\n   * @param v - The {@link Vec2} to translate by\n   * @returns `this`\n   */\n  translate(v) {\n    return _Mat2d.translate(this, this, v);\n  }\n  /**\n   * Rotates this {@link Mat2d} by the given angle around the given axis\n   * Equivalent to `Mat2d.rotate(this, this, rad);`\n   * @category Methods\n   *\n   * @param rad - the angle to rotate the matrix by\n   * @returns `this`\n   */\n  rotate(rad) {\n    return _Mat2d.rotate(this, this, rad);\n  }\n  /**\n   * Scales this {@link Mat2d} by the dimensions in the given vec3 not using vectorization\n   * Equivalent to `Mat2d.scale(this, this, v);`\n   * @category Methods\n   *\n   * @param v - The {@link Vec2} to scale the matrix by\n   * @returns `this`\n   */\n  scale(v) {\n    return _Mat2d.scale(this, this, v);\n  }\n  // ===================\n  // Static accessors\n  // ===================\n  /**\n   * @category Static\n   *\n   * @returns The number of bytes in a {@link Mat2d}.\n   */\n  static get BYTE_LENGTH() {\n    return 6 * Float32Array.BYTES_PER_ELEMENT;\n  }\n  // ===================\n  // Static methods\n  // ===================\n  /**\n   * Creates a new, identity {@link Mat2d}\n   * @category Static\n   *\n   * @returns A new {@link Mat2d}\n   */\n  static create() {\n    return new _Mat2d();\n  }\n  /**\n   * Creates a new {@link Mat2d} initialized with values from an existing matrix\n   * @category Static\n   *\n   * @param a - Matrix to clone\n   * @returns A new {@link Mat2d}\n   */\n  static clone(a) {\n    return new _Mat2d(a);\n  }\n  /**\n   * Copy the values from one {@link Mat2d} to another\n   * @category Static\n   *\n   * @param out - The receiving Matrix\n   * @param a - Matrix to copy\n   * @returns `out`\n   */\n  static copy(out, a) {\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    out[4] = a[4];\n    out[5] = a[5];\n    return out;\n  }\n  /**\n   * Create a new {@link Mat2d} with the given values\n   * @category Static\n   *\n   * @param values - Matrix components\n   * @returns A new {@link Mat2d}\n   */\n  static fromValues(...values) {\n    return new _Mat2d(...values);\n  }\n  /**\n   * Set the components of a {@link Mat2d} to the given values\n   * @category Static\n   *\n   * @param out - The receiving matrix\n   * @param values - Matrix components\n   * @returns `out`\n   */\n  static set(out, ...values) {\n    out[0] = values[0];\n    out[1] = values[1];\n    out[2] = values[2];\n    out[3] = values[3];\n    out[4] = values[4];\n    out[5] = values[5];\n    return out;\n  }\n  /**\n   * Set a {@link Mat2d} to the identity matrix\n   * @category Static\n   *\n   * @param out - The receiving matrix\n   * @returns `out`\n   */\n  static identity(out) {\n    out[0] = 1;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 1;\n    out[4] = 0;\n    out[5] = 0;\n    return out;\n  }\n  /**\n   * Inverts a {@link Mat2d}\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the source matrix\n   * @returns `out` or `null` if the matrix is not invertible\n   */\n  static invert(out, a) {\n    const aa = a[0];\n    const ab = a[1];\n    const ac = a[2];\n    const ad = a[3];\n    const atx = a[4];\n    const aty = a[5];\n    let det = aa * ad - ab * ac;\n    if (!det) {\n      return null;\n    }\n    det = 1 / det;\n    out[0] = ad * det;\n    out[1] = -ab * det;\n    out[2] = -ac * det;\n    out[3] = aa * det;\n    out[4] = (ac * aty - ad * atx) * det;\n    out[5] = (ab * atx - aa * aty) * det;\n    return out;\n  }\n  /**\n   * Calculates the determinant of a {@link Mat2d}\n   * @category Static\n   *\n   * @param a - the source matrix\n   * @returns determinant of a\n   */\n  static determinant(a) {\n    return a[0] * a[3] - a[1] * a[2];\n  }\n  /**\n   * Adds two {@link Mat2d}'s\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  static add(out, a, b) {\n    out[0] = a[0] + b[0];\n    out[1] = a[1] + b[1];\n    out[2] = a[2] + b[2];\n    out[3] = a[3] + b[3];\n    out[4] = a[4] + b[4];\n    out[5] = a[5] + b[5];\n    return out;\n  }\n  /**\n   * Subtracts matrix b from matrix a\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  static subtract(out, a, b) {\n    out[0] = a[0] - b[0];\n    out[1] = a[1] - b[1];\n    out[2] = a[2] - b[2];\n    out[3] = a[3] - b[3];\n    out[4] = a[4] - b[4];\n    out[5] = a[5] - b[5];\n    return out;\n  }\n  /**\n   * Alias for {@link Mat2d.subtract}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static sub(out, a, b) {\n    return out;\n  }\n  /**\n   * Multiplies two {@link Mat2d}s\n   * @category Static\n   *\n   * @param out - The receiving Matrix\n   * @param a - The first operand\n   * @param b - The second operand\n   * @returns `out`\n   */\n  static multiply(out, a, b) {\n    const a0 = a[0];\n    const a1 = a[1];\n    const a2 = a[2];\n    const a3 = a[3];\n    const a4 = a[4];\n    const a5 = a[5];\n    const b0 = b[0];\n    const b1 = b[1];\n    const b2 = b[2];\n    const b3 = b[3];\n    const b4 = b[4];\n    const b5 = b[5];\n    out[0] = a0 * b0 + a2 * b1;\n    out[1] = a1 * b0 + a3 * b1;\n    out[2] = a0 * b2 + a2 * b3;\n    out[3] = a1 * b2 + a3 * b3;\n    out[4] = a0 * b4 + a2 * b5 + a4;\n    out[5] = a1 * b4 + a3 * b5 + a5;\n    return out;\n  }\n  /**\n   * Alias for {@link Mat2d.multiply}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static mul(out, a, b) {\n    return out;\n  }\n  /**\n   * Translate a {@link Mat2d} by the given vector\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the matrix to translate\n   * @param v - vector to translate by\n   * @returns `out`\n   */\n  static translate(out, a, v) {\n    const a0 = a[0];\n    const a1 = a[1];\n    const a2 = a[2];\n    const a3 = a[3];\n    const a4 = a[4];\n    const a5 = a[5];\n    const v0 = v[0];\n    const v1 = v[1];\n    out[0] = a0;\n    out[1] = a1;\n    out[2] = a2;\n    out[3] = a3;\n    out[4] = a0 * v0 + a2 * v1 + a4;\n    out[5] = a1 * v0 + a3 * v1 + a5;\n    return out;\n  }\n  /**\n   * Rotates a {@link Mat2d} by the given angle\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the matrix to rotate\n   * @param rad - the angle to rotate the matrix by\n   * @returns `out`\n   */\n  static rotate(out, a, rad) {\n    const a0 = a[0];\n    const a1 = a[1];\n    const a2 = a[2];\n    const a3 = a[3];\n    const a4 = a[4];\n    const a5 = a[5];\n    const s = Math.sin(rad);\n    const c = Math.cos(rad);\n    out[0] = a0 * c + a2 * s;\n    out[1] = a1 * c + a3 * s;\n    out[2] = a0 * -s + a2 * c;\n    out[3] = a1 * -s + a3 * c;\n    out[4] = a4;\n    out[5] = a5;\n    return out;\n  }\n  /**\n   * Scales the {@link Mat2d} by the dimensions in the given {@link Vec2}\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the matrix to scale\n   * @param v - the {@link Vec2} to scale the matrix by\n   * @returns `out`\n   **/\n  static scale(out, a, v) {\n    const a0 = a[0];\n    const a1 = a[1];\n    const a2 = a[2];\n    const a3 = a[3];\n    const a4 = a[4];\n    const a5 = a[5];\n    const v0 = v[0];\n    const v1 = v[1];\n    out[0] = a0 * v0;\n    out[1] = a1 * v0;\n    out[2] = a2 * v1;\n    out[3] = a3 * v1;\n    out[4] = a4;\n    out[5] = a5;\n    return out;\n  }\n  // TODO: Got to fromRotation\n  /**\n   * Creates a {@link Mat2d} from a vector translation\n   * This is equivalent to (but much faster than):\n   * ```js\n   *   Mat2d.identity(dest);\n   *   Mat2d.translate(dest, dest, vec);\n   * ```\n   * @category Static\n   *\n   * @param out - {@link Mat2d} receiving operation result\n   * @param v - Translation vector\n   * @returns `out`\n   */\n  static fromTranslation(out, v) {\n    out[0] = 1;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 1;\n    out[4] = v[0];\n    out[5] = v[1];\n    return out;\n  }\n  /**\n   * Creates a {@link Mat2d} from a given angle around a given axis\n   * This is equivalent to (but much faster than):\n   * ```js\n   *   Mat2d.identity(dest);\n   *   Mat2d.rotate(dest, dest, rad);\n   * ```\n   * @category Static\n   *\n   * @param out - {@link Mat2d} receiving operation result\n   * @param rad - the angle to rotate the matrix by\n   * @returns `out`\n   */\n  static fromRotation(out, rad) {\n    const s = Math.sin(rad);\n    const c = Math.cos(rad);\n    out[0] = c;\n    out[1] = s;\n    out[2] = -s;\n    out[3] = c;\n    out[4] = 0;\n    out[5] = 0;\n    return out;\n  }\n  /**\n   * Creates a {@link Mat2d} from a vector scaling\n   * This is equivalent to (but much faster than):\n   * ```js\n   *   Mat2d.identity(dest);\n   *   Mat2d.scale(dest, dest, vec);\n   * ```\n   * @category Static\n   *\n   * @param out - {@link Mat2d} receiving operation result\n   * @param v - Scaling vector\n   * @returns `out`\n   */\n  static fromScaling(out, v) {\n    out[0] = v[0];\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = v[1];\n    out[4] = 0;\n    out[5] = 0;\n    return out;\n  }\n  /**\n   * Returns Frobenius norm of a {@link Mat2d}\n   * @category Static\n   *\n   * @param a - the matrix to calculate Frobenius norm of\n   * @returns Frobenius norm\n   */\n  static frob(a) {\n    return Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2] + a[3] * a[3] + a[4] * a[4] + a[5] * a[5] + 1);\n  }\n  /**\n   * Multiply each element of a {@link Mat2d} by a scalar.\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the matrix to scale\n   * @param b - amount to scale the matrix's elements by\n   * @returns `out`\n   */\n  static multiplyScalar(out, a, b) {\n    out[0] = a[0] * b;\n    out[1] = a[1] * b;\n    out[2] = a[2] * b;\n    out[3] = a[3] * b;\n    out[4] = a[4] * b;\n    out[5] = a[5] * b;\n    return out;\n  }\n  /**\n   * Adds two {@link Mat2d}'s after multiplying each element of the second operand by a scalar value.\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @param scale - the amount to scale b's elements by before adding\n   * @returns `out`\n   */\n  static multiplyScalarAndAdd(out, a, b, scale) {\n    out[0] = a[0] + b[0] * scale;\n    out[1] = a[1] + b[1] * scale;\n    out[2] = a[2] + b[2] * scale;\n    out[3] = a[3] + b[3] * scale;\n    out[4] = a[4] + b[4] * scale;\n    out[5] = a[5] + b[5] * scale;\n    return out;\n  }\n  /**\n   * Returns whether two {@link Mat2d}s have exactly the same elements in the same position (when compared with ===).\n   * @category Static\n   *\n   * @param a - The first matrix.\n   * @param b - The second matrix.\n   * @returns True if the matrices are equal, false otherwise.\n   */\n  static exactEquals(a, b) {\n    return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5];\n  }\n  /**\n   * Returns whether two {@link Mat2d}s have approximately the same elements in the same position.\n   * @category Static\n   *\n   * @param a - The first matrix.\n   * @param b - The second matrix.\n   * @returns True if the matrices are equal, false otherwise.\n   */\n  static equals(a, b) {\n    const a0 = a[0];\n    const a1 = a[1];\n    const a2 = a[2];\n    const a3 = a[3];\n    const a4 = a[4];\n    const a5 = a[5];\n    const b0 = b[0];\n    const b1 = b[1];\n    const b2 = b[2];\n    const b3 = b[3];\n    const b4 = b[4];\n    const b5 = b[5];\n    return Math.abs(a0 - b0) <= GLM_EPSILON * Math.max(1, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= GLM_EPSILON * Math.max(1, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= GLM_EPSILON * Math.max(1, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= GLM_EPSILON * Math.max(1, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= GLM_EPSILON * Math.max(1, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= GLM_EPSILON * Math.max(1, Math.abs(a5), Math.abs(b5));\n  }\n  /**\n   * Returns a string representation of a {@link Mat2d}\n   * @category Static\n   *\n   * @param a - matrix to represent as a string\n   * @returns string representation of the matrix\n   */\n  static str(a) {\n    return `Mat2d(${a.join(\", \")})`;\n  }\n};\nMat2d.mul = Mat2d.multiply;\nMat2d.sub = Mat2d.subtract;\nvar Mat3 = class _Mat3 extends Float32Array {\n  static #IDENTITY_3X3 = new Float32Array([\n    1,\n    0,\n    0,\n    0,\n    1,\n    0,\n    0,\n    0,\n    1\n  ]);\n  /**\n   * Create a {@link Mat3}.\n   *\n   * @category Constructor\n   */\n  constructor(...values) {\n    switch (values.length) {\n      case 9:\n        super(values);\n        break;\n      case 2:\n        super(values[0], values[1], 9);\n        break;\n      case 1:\n        const v = values[0];\n        if (typeof v === \"number\") {\n          super([\n            v,\n            v,\n            v,\n            v,\n            v,\n            v,\n            v,\n            v,\n            v\n          ]);\n        } else {\n          super(v, 0, 9);\n        }\n        break;\n      default:\n        super(_Mat3.#IDENTITY_3X3);\n        break;\n    }\n  }\n  // ============\n  // Accessors\n  // ============\n  /**\n   * A string representation of `this`\n   * Equivalent to `Mat3.str(this);`\n   *\n   * @category Accessors\n   */\n  get str() {\n    return _Mat3.str(this);\n  }\n  // ===================\n  // Instance methods\n  // ===================\n  /**\n   * Copy the values from another {@link Mat3} into `this`.\n   * @category Methods\n   *\n   * @param a the source vector\n   * @returns `this`\n   */\n  copy(a) {\n    this.set(a);\n    return this;\n  }\n  /**\n   * Set `this` to the identity matrix\n   * Equivalent to Mat3.identity(this)\n   * @category Methods\n   *\n   * @returns `this`\n   */\n  identity() {\n    this.set(_Mat3.#IDENTITY_3X3);\n    return this;\n  }\n  /**\n   * Multiplies this {@link Mat3} against another one\n   * Equivalent to `Mat3.multiply(this, this, b);`\n   * @category Methods\n   *\n   * @param out - The receiving Matrix\n   * @param a - The first operand\n   * @param b - The second operand\n   * @returns `this`\n   */\n  multiply(b) {\n    return _Mat3.multiply(this, this, b);\n  }\n  /**\n   * Alias for {@link Mat3.multiply}\n   * @category Methods\n   */\n  mul(b) {\n    return this;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Transpose this {@link Mat3}\n   * Equivalent to `Mat3.transpose(this, this);`\n   * @category Methods\n   *\n   * @returns `this`\n   */\n  transpose() {\n    return _Mat3.transpose(this, this);\n  }\n  /**\n   * Inverts this {@link Mat3}\n   * Equivalent to `Mat4.invert(this, this);`\n   * @category Methods\n   *\n   * @returns `this`\n   */\n  invert() {\n    return _Mat3.invert(this, this);\n  }\n  /**\n   * Translate this {@link Mat3} by the given vector\n   * Equivalent to `Mat3.translate(this, this, v);`\n   * @category Methods\n   *\n   * @param v - The {@link Vec2} to translate by\n   * @returns `this`\n   */\n  translate(v) {\n    return _Mat3.translate(this, this, v);\n  }\n  /**\n   * Rotates this {@link Mat3} by the given angle around the given axis\n   * Equivalent to `Mat3.rotate(this, this, rad);`\n   * @category Methods\n   *\n   * @param rad - the angle to rotate the matrix by\n   * @returns `this`\n   */\n  rotate(rad) {\n    return _Mat3.rotate(this, this, rad);\n  }\n  /**\n   * Scales this {@link Mat3} by the dimensions in the given vec3 not using vectorization\n   * Equivalent to `Mat3.scale(this, this, v);`\n   * @category Methods\n   *\n   * @param v - The {@link Vec2} to scale the matrix by\n   * @returns `this`\n   */\n  scale(v) {\n    return _Mat3.scale(this, this, v);\n  }\n  // ===================\n  // Static accessors\n  // ===================\n  /**\n   * @category Static\n   *\n   * @returns The number of bytes in a {@link Mat3}.\n   */\n  static get BYTE_LENGTH() {\n    return 9 * Float32Array.BYTES_PER_ELEMENT;\n  }\n  // ===================\n  // Static methods\n  // ===================\n  /**\n   * Creates a new, identity {@link Mat3}\n   * @category Static\n   *\n   * @returns A new {@link Mat3}\n   */\n  static create() {\n    return new _Mat3();\n  }\n  /**\n   * Creates a new {@link Mat3} initialized with values from an existing matrix\n   * @category Static\n   *\n   * @param a - Matrix to clone\n   * @returns A new {@link Mat3}\n   */\n  static clone(a) {\n    return new _Mat3(a);\n  }\n  /**\n   * Copy the values from one {@link Mat3} to another\n   * @category Static\n   *\n   * @param out - The receiving Matrix\n   * @param a - Matrix to copy\n   * @returns `out`\n   */\n  static copy(out, a) {\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    out[4] = a[4];\n    out[5] = a[5];\n    out[6] = a[6];\n    out[7] = a[7];\n    out[8] = a[8];\n    return out;\n  }\n  /**\n   * Create a new {@link Mat3} with the given values\n   * @category Static\n   *\n   * @param values - Matrix components\n   * @returns A new {@link Mat3}\n   */\n  static fromValues(...values) {\n    return new _Mat3(...values);\n  }\n  /**\n   * Set the components of a {@link Mat3} to the given values\n   * @category Static\n   *\n   * @param out - The receiving matrix\n   * @param values - Matrix components\n   * @returns `out`\n   */\n  static set(out, ...values) {\n    out[0] = values[0];\n    out[1] = values[1];\n    out[2] = values[2];\n    out[3] = values[3];\n    out[4] = values[4];\n    out[5] = values[5];\n    out[6] = values[6];\n    out[7] = values[7];\n    out[8] = values[8];\n    return out;\n  }\n  /**\n   * Set a {@link Mat3} to the identity matrix\n   * @category Static\n   *\n   * @param out - The receiving matrix\n   * @returns `out`\n   */\n  static identity(out) {\n    out[0] = 1;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 1;\n    out[5] = 0;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 1;\n    return out;\n  }\n  /**\n   * Transpose the values of a {@link Mat3}\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the source matrix\n   * @returns `out`\n   */\n  static transpose(out, a) {\n    if (out === a) {\n      const a01 = a[1], a02 = a[2], a12 = a[5];\n      out[1] = a[3];\n      out[2] = a[6];\n      out[3] = a01;\n      out[5] = a[7];\n      out[6] = a02;\n      out[7] = a12;\n    } else {\n      out[0] = a[0];\n      out[1] = a[3];\n      out[2] = a[6];\n      out[3] = a[1];\n      out[4] = a[4];\n      out[5] = a[7];\n      out[6] = a[2];\n      out[7] = a[5];\n      out[8] = a[8];\n    }\n    return out;\n  }\n  /**\n   * Inverts a {@link Mat3}\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the source matrix\n   * @returns `out` or `null` if the matrix is not invertible\n   */\n  static invert(out, a) {\n    const a00 = a[0], a01 = a[1], a02 = a[2];\n    const a10 = a[3], a11 = a[4], a12 = a[5];\n    const a20 = a[6], a21 = a[7], a22 = a[8];\n    const b01 = a22 * a11 - a12 * a21;\n    const b11 = -a22 * a10 + a12 * a20;\n    const b21 = a21 * a10 - a11 * a20;\n    let det = a00 * b01 + a01 * b11 + a02 * b21;\n    if (!det) {\n      return null;\n    }\n    det = 1 / det;\n    out[0] = b01 * det;\n    out[1] = (-a22 * a01 + a02 * a21) * det;\n    out[2] = (a12 * a01 - a02 * a11) * det;\n    out[3] = b11 * det;\n    out[4] = (a22 * a00 - a02 * a20) * det;\n    out[5] = (-a12 * a00 + a02 * a10) * det;\n    out[6] = b21 * det;\n    out[7] = (-a21 * a00 + a01 * a20) * det;\n    out[8] = (a11 * a00 - a01 * a10) * det;\n    return out;\n  }\n  /**\n   * Calculates the adjugate of a {@link Mat3}\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the source matrix\n   * @returns `out`\n   */\n  static adjoint(out, a) {\n    const a00 = a[0];\n    const a01 = a[1];\n    const a02 = a[2];\n    const a10 = a[3];\n    const a11 = a[4];\n    const a12 = a[5];\n    const a20 = a[6];\n    const a21 = a[7];\n    const a22 = a[8];\n    out[0] = a11 * a22 - a12 * a21;\n    out[1] = a02 * a21 - a01 * a22;\n    out[2] = a01 * a12 - a02 * a11;\n    out[3] = a12 * a20 - a10 * a22;\n    out[4] = a00 * a22 - a02 * a20;\n    out[5] = a02 * a10 - a00 * a12;\n    out[6] = a10 * a21 - a11 * a20;\n    out[7] = a01 * a20 - a00 * a21;\n    out[8] = a00 * a11 - a01 * a10;\n    return out;\n  }\n  /**\n   * Calculates the determinant of a {@link Mat3}\n   * @category Static\n   *\n   * @param a - the source matrix\n   * @returns determinant of a\n   */\n  static determinant(a) {\n    const a00 = a[0];\n    const a01 = a[1];\n    const a02 = a[2];\n    const a10 = a[3];\n    const a11 = a[4];\n    const a12 = a[5];\n    const a20 = a[6];\n    const a21 = a[7];\n    const a22 = a[8];\n    return a00 * (a22 * a11 - a12 * a21) + a01 * (-a22 * a10 + a12 * a20) + a02 * (a21 * a10 - a11 * a20);\n  }\n  /**\n   * Adds two {@link Mat3}'s\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  static add(out, a, b) {\n    out[0] = a[0] + b[0];\n    out[1] = a[1] + b[1];\n    out[2] = a[2] + b[2];\n    out[3] = a[3] + b[3];\n    out[4] = a[4] + b[4];\n    out[5] = a[5] + b[5];\n    out[6] = a[6] + b[6];\n    out[7] = a[7] + b[7];\n    out[8] = a[8] + b[8];\n    return out;\n  }\n  /**\n   * Subtracts matrix b from matrix a\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  static subtract(out, a, b) {\n    out[0] = a[0] - b[0];\n    out[1] = a[1] - b[1];\n    out[2] = a[2] - b[2];\n    out[3] = a[3] - b[3];\n    out[4] = a[4] - b[4];\n    out[5] = a[5] - b[5];\n    out[6] = a[6] - b[6];\n    out[7] = a[7] - b[7];\n    out[8] = a[8] - b[8];\n    return out;\n  }\n  /**\n   * Alias for {@link Mat3.subtract}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static sub(out, a, b) {\n    return out;\n  }\n  /**\n   * Multiplies two {@link Mat3}s\n   * @category Static\n   *\n   * @param out - The receiving Matrix\n   * @param a - The first operand\n   * @param b - The second operand\n   * @returns `out`\n   */\n  static multiply(out, a, b) {\n    const a00 = a[0];\n    const a01 = a[1];\n    const a02 = a[2];\n    const a10 = a[3];\n    const a11 = a[4];\n    const a12 = a[5];\n    const a20 = a[6];\n    const a21 = a[7];\n    const a22 = a[8];\n    let b0 = b[0];\n    let b1 = b[1];\n    let b2 = b[2];\n    out[0] = b0 * a00 + b1 * a10 + b2 * a20;\n    out[1] = b0 * a01 + b1 * a11 + b2 * a21;\n    out[2] = b0 * a02 + b1 * a12 + b2 * a22;\n    b0 = b[3];\n    b1 = b[4];\n    b2 = b[5];\n    out[3] = b0 * a00 + b1 * a10 + b2 * a20;\n    out[4] = b0 * a01 + b1 * a11 + b2 * a21;\n    out[5] = b0 * a02 + b1 * a12 + b2 * a22;\n    b0 = b[6];\n    b1 = b[7];\n    b2 = b[8];\n    out[6] = b0 * a00 + b1 * a10 + b2 * a20;\n    out[7] = b0 * a01 + b1 * a11 + b2 * a21;\n    out[8] = b0 * a02 + b1 * a12 + b2 * a22;\n    return out;\n  }\n  /**\n   * Alias for {@link Mat3.multiply}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static mul(out, a, b) {\n    return out;\n  }\n  /**\n   * Translate a {@link Mat3} by the given vector\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the matrix to translate\n   * @param v - vector to translate by\n   * @returns `out`\n   */\n  static translate(out, a, v) {\n    const a00 = a[0];\n    const a01 = a[1];\n    const a02 = a[2];\n    const a10 = a[3];\n    const a11 = a[4];\n    const a12 = a[5];\n    const a20 = a[6];\n    const a21 = a[7];\n    const a22 = a[8];\n    const x = v[0];\n    const y = v[1];\n    out[0] = a00;\n    out[1] = a01;\n    out[2] = a02;\n    out[3] = a10;\n    out[4] = a11;\n    out[5] = a12;\n    out[6] = x * a00 + y * a10 + a20;\n    out[7] = x * a01 + y * a11 + a21;\n    out[8] = x * a02 + y * a12 + a22;\n    return out;\n  }\n  /**\n   * Rotates a {@link Mat3} by the given angle\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the matrix to rotate\n   * @param rad - the angle to rotate the matrix by\n   * @returns `out`\n   */\n  static rotate(out, a, rad) {\n    const a00 = a[0];\n    const a01 = a[1];\n    const a02 = a[2];\n    const a10 = a[3];\n    const a11 = a[4];\n    const a12 = a[5];\n    const a20 = a[6];\n    const a21 = a[7];\n    const a22 = a[8];\n    const s = Math.sin(rad);\n    const c = Math.cos(rad);\n    out[0] = c * a00 + s * a10;\n    out[1] = c * a01 + s * a11;\n    out[2] = c * a02 + s * a12;\n    out[3] = c * a10 - s * a00;\n    out[4] = c * a11 - s * a01;\n    out[5] = c * a12 - s * a02;\n    out[6] = a20;\n    out[7] = a21;\n    out[8] = a22;\n    return out;\n  }\n  /**\n   * Scales the {@link Mat3} by the dimensions in the given {@link Vec2}\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the matrix to scale\n   * @param v - the {@link Vec2} to scale the matrix by\n   * @returns `out`\n   **/\n  static scale(out, a, v) {\n    const x = v[0];\n    const y = v[1];\n    out[0] = x * a[0];\n    out[1] = x * a[1];\n    out[2] = x * a[2];\n    out[3] = y * a[3];\n    out[4] = y * a[4];\n    out[5] = y * a[5];\n    out[6] = a[6];\n    out[7] = a[7];\n    out[8] = a[8];\n    return out;\n  }\n  /**\n   * Creates a {@link Mat3} from a vector translation\n   * This is equivalent to (but much faster than):\n   * ```js\n   *   mat3.identity(dest);\n   *   mat3.translate(dest, dest, vec);\n   * ```\n   * @category Static\n   *\n   * @param out - {@link Mat3} receiving operation result\n   * @param v - Translation vector\n   * @returns `out`\n   */\n  static fromTranslation(out, v) {\n    out[0] = 1;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 1;\n    out[5] = 0;\n    out[6] = v[0];\n    out[7] = v[1];\n    out[8] = 1;\n    return out;\n  }\n  /**\n   * Creates a {@link Mat3} from a given angle around a given axis\n   * This is equivalent to (but much faster than):\n   *\n   *     mat3.identity(dest);\n   *     mat3.rotate(dest, dest, rad);\n   * @category Static\n   *\n   * @param out - {@link Mat3} receiving operation result\n   * @param rad - the angle to rotate the matrix by\n   * @returns `out`\n   */\n  static fromRotation(out, rad) {\n    const s = Math.sin(rad);\n    const c = Math.cos(rad);\n    out[0] = c;\n    out[1] = s;\n    out[2] = 0;\n    out[3] = -s;\n    out[4] = c;\n    out[5] = 0;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 1;\n    return out;\n  }\n  /**\n   * Creates a {@link Mat3} from a vector scaling\n   * This is equivalent to (but much faster than):\n   * ```js\n   *   mat3.identity(dest);\n   *   mat3.scale(dest, dest, vec);\n   * ```\n   * @category Static\n   *\n   * @param out - {@link Mat3} receiving operation result\n   * @param v - Scaling vector\n   * @returns `out`\n   */\n  static fromScaling(out, v) {\n    out[0] = v[0];\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = v[1];\n    out[5] = 0;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 1;\n    return out;\n  }\n  /**\n   * Copies the upper-left 3x3 values of a {@link Mat2d} into the given\n   * {@link Mat3}.\n   * @category Static\n   *\n   * @param out - the receiving 3x3 matrix\n   * @param a - the source 2x3 matrix\n   * @returns `out`\n   */\n  static fromMat2d(out, a) {\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = 0;\n    out[3] = a[2];\n    out[4] = a[3];\n    out[5] = 0;\n    out[6] = a[4];\n    out[7] = a[5];\n    out[8] = 1;\n    return out;\n  }\n  /**\n   * Calculates a {@link Mat3} from the given quaternion\n   * @category Static\n   *\n   * @param out - {@link Mat3} receiving operation result\n   * @param q - {@link Quat} to create matrix from\n   * @returns `out`\n   */\n  static fromQuat(out, q) {\n    const x = q[0];\n    const y = q[1];\n    const z = q[2];\n    const w = q[3];\n    const x2 = x + x;\n    const y2 = y + y;\n    const z2 = z + z;\n    const xx = x * x2;\n    const yx = y * x2;\n    const yy = y * y2;\n    const zx = z * x2;\n    const zy = z * y2;\n    const zz = z * z2;\n    const wx = w * x2;\n    const wy = w * y2;\n    const wz = w * z2;\n    out[0] = 1 - yy - zz;\n    out[3] = yx - wz;\n    out[6] = zx + wy;\n    out[1] = yx + wz;\n    out[4] = 1 - xx - zz;\n    out[7] = zy - wx;\n    out[2] = zx - wy;\n    out[5] = zy + wx;\n    out[8] = 1 - xx - yy;\n    return out;\n  }\n  /**\n   * Copies the upper-left 3x3 values of a {@link Mat4} into the given\n   * {@link Mat3}.\n   * @category Static\n   *\n   * @param out - the receiving 3x3 matrix\n   * @param a - the source 4x4 matrix\n   * @returns `out`\n   */\n  static fromMat4(out, a) {\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[4];\n    out[4] = a[5];\n    out[5] = a[6];\n    out[6] = a[8];\n    out[7] = a[9];\n    out[8] = a[10];\n    return out;\n  }\n  /**\n   * Calculates a 3x3 normal matrix (transpose inverse) from the 4x4 matrix\n   * @category Static\n   *\n   * @param {mat3} out mat3 receiving operation result\n   * @param {ReadonlyMat4} a Mat4 to derive the normal matrix from\n   * @returns `out` or `null` if the matrix is not invertible\n   */\n  static normalFromMat4(out, a) {\n    const a00 = a[0];\n    const a01 = a[1];\n    const a02 = a[2];\n    const a03 = a[3];\n    const a10 = a[4];\n    const a11 = a[5];\n    const a12 = a[6];\n    const a13 = a[7];\n    const a20 = a[8];\n    const a21 = a[9];\n    const a22 = a[10];\n    const a23 = a[11];\n    const a30 = a[12];\n    const a31 = a[13];\n    const a32 = a[14];\n    const a33 = a[15];\n    const b00 = a00 * a11 - a01 * a10;\n    const b01 = a00 * a12 - a02 * a10;\n    const b02 = a00 * a13 - a03 * a10;\n    const b03 = a01 * a12 - a02 * a11;\n    const b04 = a01 * a13 - a03 * a11;\n    const b05 = a02 * a13 - a03 * a12;\n    const b06 = a20 * a31 - a21 * a30;\n    const b07 = a20 * a32 - a22 * a30;\n    const b08 = a20 * a33 - a23 * a30;\n    const b09 = a21 * a32 - a22 * a31;\n    const b10 = a21 * a33 - a23 * a31;\n    const b11 = a22 * a33 - a23 * a32;\n    let det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n    if (!det) {\n      return null;\n    }\n    det = 1 / det;\n    out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n    out[1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n    out[2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n    out[3] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n    out[4] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n    out[5] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n    out[6] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n    out[7] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n    out[8] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n    return out;\n  }\n  /**\n   * Calculates a {@link Mat3} normal matrix (transpose inverse) from a {@link Mat4}\n   * This version omits the calculation of the constant factor (1/determinant), so\n   * any normals transformed with it will need to be renormalized.\n   * From https://stackoverflow.com/a/27616419/25968\n   * @category Static\n   *\n   * @param out - Matrix receiving operation result\n   * @param a - Mat4 to derive the normal matrix from\n   * @returns `out`\n   */\n  static normalFromMat4Fast(out, a) {\n    const ax = a[0];\n    const ay = a[1];\n    const az = a[2];\n    const bx = a[4];\n    const by = a[5];\n    const bz = a[6];\n    const cx = a[8];\n    const cy = a[9];\n    const cz = a[10];\n    out[0] = by * cz - cz * cy;\n    out[1] = bz * cx - cx * cz;\n    out[2] = bx * cy - cy * cx;\n    out[3] = cy * az - cz * ay;\n    out[4] = cz * ax - cx * az;\n    out[5] = cx * ay - cy * ax;\n    out[6] = ay * bz - az * by;\n    out[7] = az * bx - ax * bz;\n    out[8] = ax * by - ay * bx;\n    return out;\n  }\n  /**\n   * Generates a 2D projection matrix with the given bounds\n   * @category Static\n   *\n   * @param out mat3 frustum matrix will be written into\n   * @param width Width of your gl context\n   * @param height Height of gl context\n   * @returns `out`\n   */\n  static projection(out, width, height) {\n    out[0] = 2 / width;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = -2 / height;\n    out[5] = 0;\n    out[6] = -1;\n    out[7] = 1;\n    out[8] = 1;\n    return out;\n  }\n  /**\n   * Returns Frobenius norm of a {@link Mat3}\n   * @category Static\n   *\n   * @param a - the matrix to calculate Frobenius norm of\n   * @returns Frobenius norm\n   */\n  static frob(a) {\n    return Math.sqrt(\n      a[0] * a[0] + a[1] * a[1] + a[2] * a[2] + a[3] * a[3] + a[4] * a[4] + a[5] * a[5] + a[6] * a[6] + a[7] * a[7] + a[8] * a[8]\n    );\n  }\n  /**\n   * Multiply each element of a {@link Mat3} by a scalar.\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the matrix to scale\n   * @param b - amount to scale the matrix's elements by\n   * @returns `out`\n   */\n  static multiplyScalar(out, a, b) {\n    out[0] = a[0] * b;\n    out[1] = a[1] * b;\n    out[2] = a[2] * b;\n    out[3] = a[3] * b;\n    out[4] = a[4] * b;\n    out[5] = a[5] * b;\n    out[6] = a[6] * b;\n    out[7] = a[7] * b;\n    out[8] = a[8] * b;\n    return out;\n  }\n  /**\n   * Adds two {@link Mat3}'s after multiplying each element of the second operand by a scalar value.\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @param scale - the amount to scale b's elements by before adding\n   * @returns `out`\n   */\n  static multiplyScalarAndAdd(out, a, b, scale) {\n    out[0] = a[0] + b[0] * scale;\n    out[1] = a[1] + b[1] * scale;\n    out[2] = a[2] + b[2] * scale;\n    out[3] = a[3] + b[3] * scale;\n    out[4] = a[4] + b[4] * scale;\n    out[5] = a[5] + b[5] * scale;\n    out[6] = a[6] + b[6] * scale;\n    out[7] = a[7] + b[7] * scale;\n    out[8] = a[8] + b[8] * scale;\n    return out;\n  }\n  /**\n   * Returns whether two {@link Mat3}s have exactly the same elements in the same position (when compared with ===).\n   * @category Static\n   *\n   * @param a - The first matrix.\n   * @param b - The second matrix.\n   * @returns True if the matrices are equal, false otherwise.\n   */\n  static exactEquals(a, b) {\n    return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8];\n  }\n  /**\n   * Returns whether two {@link Mat3}s have approximately the same elements in the same position.\n   * @category Static\n   *\n   * @param a - The first matrix.\n   * @param b - The second matrix.\n   * @returns True if the matrices are equal, false otherwise.\n   */\n  static equals(a, b) {\n    const a0 = a[0];\n    const a1 = a[1];\n    const a2 = a[2];\n    const a3 = a[3];\n    const a4 = a[4];\n    const a5 = a[5];\n    const a6 = a[6];\n    const a7 = a[7];\n    const a8 = a[8];\n    const b0 = b[0];\n    const b1 = b[1];\n    const b2 = b[2];\n    const b3 = b[3];\n    const b4 = b[4];\n    const b5 = b[5];\n    const b6 = b[6];\n    const b7 = b[7];\n    const b8 = b[8];\n    return Math.abs(a0 - b0) <= GLM_EPSILON * Math.max(1, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= GLM_EPSILON * Math.max(1, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= GLM_EPSILON * Math.max(1, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= GLM_EPSILON * Math.max(1, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= GLM_EPSILON * Math.max(1, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= GLM_EPSILON * Math.max(1, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= GLM_EPSILON * Math.max(1, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= GLM_EPSILON * Math.max(1, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= GLM_EPSILON * Math.max(1, Math.abs(a8), Math.abs(b8));\n  }\n  /**\n   * Returns a string representation of a {@link Mat3}\n   * @category Static\n   *\n   * @param a - matrix to represent as a string\n   * @returns string representation of the matrix\n   */\n  static str(a) {\n    return `Mat3(${a.join(\", \")})`;\n  }\n};\nMat3.prototype.mul = Mat3.prototype.multiply;\nMat3.mul = Mat3.multiply;\nMat3.sub = Mat3.subtract;\nvar Mat4 = class _Mat4 extends Float32Array {\n  static #IDENTITY_4X4 = new Float32Array([\n    1,\n    0,\n    0,\n    0,\n    0,\n    1,\n    0,\n    0,\n    0,\n    0,\n    1,\n    0,\n    0,\n    0,\n    0,\n    1\n  ]);\n  /**\n   * Temporary variable to prevent repeated allocations in the algorithms within Mat4.\n   * These are declared as TypedArrays to aid in tree-shaking.\n   */\n  static #TMP_VEC3 = new Float32Array(3);\n  /**\n   * Create a {@link Mat4}.\n   *\n   * @category Constructor\n   */\n  constructor(...values) {\n    switch (values.length) {\n      case 16:\n        super(values);\n        break;\n      case 2:\n        super(values[0], values[1], 16);\n        break;\n      case 1:\n        const v = values[0];\n        if (typeof v === \"number\") {\n          super([\n            v,\n            v,\n            v,\n            v,\n            v,\n            v,\n            v,\n            v,\n            v,\n            v,\n            v,\n            v,\n            v,\n            v,\n            v,\n            v\n          ]);\n        } else {\n          super(v, 0, 16);\n        }\n        break;\n      default:\n        super(_Mat4.#IDENTITY_4X4);\n        break;\n    }\n  }\n  // ============\n  // Accessors\n  // ============\n  /**\n   * A string representation of `this`\n   * Equivalent to `Mat4.str(this);`\n   *\n   * @category Accessors\n   */\n  get str() {\n    return _Mat4.str(this);\n  }\n  // ===================\n  // Instance methods\n  // ===================\n  /**\n   * Copy the values from another {@link Mat4} into `this`.\n   * @category Methods\n   *\n   * @param a the source vector\n   * @returns `this`\n   */\n  copy(a) {\n    this.set(a);\n    return this;\n  }\n  /**\n   * Set `this` to the identity matrix\n   * Equivalent to Mat4.identity(this)\n   * @category Methods\n   *\n   * @returns `this`\n   */\n  identity() {\n    this.set(_Mat4.#IDENTITY_4X4);\n    return this;\n  }\n  /**\n   * Multiplies this {@link Mat4} against another one\n   * Equivalent to `Mat4.multiply(this, this, b);`\n   * @category Methods\n   *\n   * @param b - The second operand\n   * @returns `this`\n   */\n  multiply(b) {\n    return _Mat4.multiply(this, this, b);\n  }\n  /**\n   * Alias for {@link Mat4.multiply}\n   * @category Methods\n   */\n  mul(b) {\n    return this;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Transpose this {@link Mat4}\n   * Equivalent to `Mat4.transpose(this, this);`\n   * @category Methods\n   *\n   * @returns `this`\n   */\n  transpose() {\n    return _Mat4.transpose(this, this);\n  }\n  /**\n   * Inverts this {@link Mat4}\n   * Equivalent to `Mat4.invert(this, this);`\n   * @category Methods\n   *\n   * @returns `this`\n   */\n  invert() {\n    return _Mat4.invert(this, this);\n  }\n  /**\n   * Translate this {@link Mat4} by the given vector\n   * Equivalent to `Mat4.translate(this, this, v);`\n   * @category Methods\n   *\n   * @param v - The {@link Vec3} to translate by\n   * @returns `this`\n   */\n  translate(v) {\n    return _Mat4.translate(this, this, v);\n  }\n  /**\n   * Rotates this {@link Mat4} by the given angle around the given axis\n   * Equivalent to `Mat4.rotate(this, this, rad, axis);`\n   * @category Methods\n   *\n   * @param rad - the angle to rotate the matrix by\n   * @param axis - the axis to rotate around\n   * @returns `this`\n   */\n  rotate(rad, axis) {\n    return _Mat4.rotate(this, this, rad, axis);\n  }\n  /**\n   * Scales this {@link Mat4} by the dimensions in the given vec3 not using vectorization\n   * Equivalent to `Mat4.scale(this, this, v);`\n   * @category Methods\n   *\n   * @param v - The {@link Vec3} to scale the matrix by\n   * @returns `this`\n   */\n  scale(v) {\n    return _Mat4.scale(this, this, v);\n  }\n  /**\n   * Rotates this {@link Mat4} by the given angle around the X axis\n   * Equivalent to `Mat4.rotateX(this, this, rad);`\n   * @category Methods\n   *\n   * @param rad - the angle to rotate the matrix by\n   * @returns `this`\n   */\n  rotateX(rad) {\n    return _Mat4.rotateX(this, this, rad);\n  }\n  /**\n   * Rotates this {@link Mat4} by the given angle around the Y axis\n   * Equivalent to `Mat4.rotateY(this, this, rad);`\n   * @category Methods\n   *\n   * @param rad - the angle to rotate the matrix by\n   * @returns `this`\n   */\n  rotateY(rad) {\n    return _Mat4.rotateY(this, this, rad);\n  }\n  /**\n   * Rotates this {@link Mat4} by the given angle around the Z axis\n   * Equivalent to `Mat4.rotateZ(this, this, rad);`\n   * @category Methods\n   *\n   * @param rad - the angle to rotate the matrix by\n   * @returns `this`\n   */\n  rotateZ(rad) {\n    return _Mat4.rotateZ(this, this, rad);\n  }\n  /**\n   * Generates a perspective projection matrix with the given bounds.\n   * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n   * which matches WebGL/OpenGL's clip volume.\n   * Passing null/undefined/no value for far will generate infinite projection matrix.\n   * Equivalent to `Mat4.perspectiveNO(this, fovy, aspect, near, far);`\n   * @category Methods\n   *\n   * @param fovy - Vertical field of view in radians\n   * @param aspect - Aspect ratio. typically viewport width/height\n   * @param near - Near bound of the frustum\n   * @param far - Far bound of the frustum, can be null or Infinity\n   * @returns `this`\n   */\n  perspectiveNO(fovy, aspect, near, far) {\n    return _Mat4.perspectiveNO(this, fovy, aspect, near, far);\n  }\n  /**\n   * Generates a perspective projection matrix suitable for WebGPU with the given bounds.\n   * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n   * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n   * Passing null/undefined/no value for far will generate infinite projection matrix.\n   * Equivalent to `Mat4.perspectiveZO(this, fovy, aspect, near, far);`\n   * @category Methods\n   *\n   * @param fovy - Vertical field of view in radians\n   * @param aspect - Aspect ratio. typically viewport width/height\n   * @param near - Near bound of the frustum\n   * @param far - Far bound of the frustum, can be null or Infinity\n   * @returns `this`\n   */\n  perspectiveZO(fovy, aspect, near, far) {\n    return _Mat4.perspectiveZO(this, fovy, aspect, near, far);\n  }\n  /**\n   * Generates a orthogonal projection matrix with the given bounds.\n   * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n   * which matches WebGL/OpenGL's clip volume.\n   * Equivalent to `Mat4.orthoNO(this, left, right, bottom, top, near, far);`\n   * @category Methods\n   *\n   * @param left - Left bound of the frustum\n   * @param right - Right bound of the frustum\n   * @param bottom - Bottom bound of the frustum\n   * @param top - Top bound of the frustum\n   * @param near - Near bound of the frustum\n   * @param far - Far bound of the frustum\n   * @returns `this`\n   */\n  orthoNO(left, right, bottom, top, near, far) {\n    return _Mat4.orthoNO(this, left, right, bottom, top, near, far);\n  }\n  /**\n   * Generates a orthogonal projection matrix with the given bounds.\n   * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n   * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n   * Equivalent to `Mat4.orthoZO(this, left, right, bottom, top, near, far);`\n   * @category Methods\n   *\n   * @param left - Left bound of the frustum\n   * @param right - Right bound of the frustum\n   * @param bottom - Bottom bound of the frustum\n   * @param top - Top bound of the frustum\n   * @param near - Near bound of the frustum\n   * @param far - Far bound of the frustum\n   * @returns `this`\n   */\n  orthoZO(left, right, bottom, top, near, far) {\n    return _Mat4.orthoZO(this, left, right, bottom, top, near, far);\n  }\n  // ===================\n  // Static accessors\n  // ===================\n  /**\n   * @category Static\n   *\n   * @returns The number of bytes in a {@link Mat4}.\n   */\n  static get BYTE_LENGTH() {\n    return 16 * Float32Array.BYTES_PER_ELEMENT;\n  }\n  // ===================\n  // Static methods\n  // ===================\n  /**\n   * Creates a new, identity {@link Mat4}\n   * @category Static\n   *\n   * @returns A new {@link Mat4}\n   */\n  static create() {\n    return new _Mat4();\n  }\n  /**\n   * Creates a new {@link Mat4} initialized with values from an existing matrix\n   * @category Static\n   *\n   * @param a - Matrix to clone\n   * @returns A new {@link Mat4}\n   */\n  static clone(a) {\n    return new _Mat4(a);\n  }\n  /**\n   * Copy the values from one {@link Mat4} to another\n   * @category Static\n   *\n   * @param out - The receiving Matrix\n   * @param a - Matrix to copy\n   * @returns `out`\n   */\n  static copy(out, a) {\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    out[4] = a[4];\n    out[5] = a[5];\n    out[6] = a[6];\n    out[7] = a[7];\n    out[8] = a[8];\n    out[9] = a[9];\n    out[10] = a[10];\n    out[11] = a[11];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n    return out;\n  }\n  /**\n   * Create a new mat4 with the given values\n   * @category Static\n   *\n   * @param values - Matrix components\n   * @returns A new {@link Mat4}\n   */\n  static fromValues(...values) {\n    return new _Mat4(...values);\n  }\n  /**\n   * Set the components of a mat4 to the given values\n   * @category Static\n   *\n   * @param out - The receiving matrix\n   * @param values - Matrix components\n   * @returns `out`\n   */\n  static set(out, ...values) {\n    out[0] = values[0];\n    out[1] = values[1];\n    out[2] = values[2];\n    out[3] = values[3];\n    out[4] = values[4];\n    out[5] = values[5];\n    out[6] = values[6];\n    out[7] = values[7];\n    out[8] = values[8];\n    out[9] = values[9];\n    out[10] = values[10];\n    out[11] = values[11];\n    out[12] = values[12];\n    out[13] = values[13];\n    out[14] = values[14];\n    out[15] = values[15];\n    return out;\n  }\n  /**\n   * Set a {@link Mat4} to the identity matrix\n   * @category Static\n   *\n   * @param out - The receiving Matrix\n   * @returns `out`\n   */\n  static identity(out) {\n    out[0] = 1;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[5] = 1;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[10] = 1;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n    out[15] = 1;\n    return out;\n  }\n  /**\n   * Transpose the values of a {@link Mat4}\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the source matrix\n   * @returns `out`\n   */\n  static transpose(out, a) {\n    if (out === a) {\n      const a01 = a[1], a02 = a[2], a03 = a[3];\n      const a12 = a[6], a13 = a[7];\n      const a23 = a[11];\n      out[1] = a[4];\n      out[2] = a[8];\n      out[3] = a[12];\n      out[4] = a01;\n      out[6] = a[9];\n      out[7] = a[13];\n      out[8] = a02;\n      out[9] = a12;\n      out[11] = a[14];\n      out[12] = a03;\n      out[13] = a13;\n      out[14] = a23;\n    } else {\n      out[0] = a[0];\n      out[1] = a[4];\n      out[2] = a[8];\n      out[3] = a[12];\n      out[4] = a[1];\n      out[5] = a[5];\n      out[6] = a[9];\n      out[7] = a[13];\n      out[8] = a[2];\n      out[9] = a[6];\n      out[10] = a[10];\n      out[11] = a[14];\n      out[12] = a[3];\n      out[13] = a[7];\n      out[14] = a[11];\n      out[15] = a[15];\n    }\n    return out;\n  }\n  /**\n   * Inverts a {@link Mat4}\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the source matrix\n   * @returns `out` or `null` if the matrix is not invertible\n   */\n  static invert(out, a) {\n    const a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3];\n    const a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7];\n    const a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11];\n    const a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15];\n    const b00 = a00 * a11 - a01 * a10;\n    const b01 = a00 * a12 - a02 * a10;\n    const b02 = a00 * a13 - a03 * a10;\n    const b03 = a01 * a12 - a02 * a11;\n    const b04 = a01 * a13 - a03 * a11;\n    const b05 = a02 * a13 - a03 * a12;\n    const b06 = a20 * a31 - a21 * a30;\n    const b07 = a20 * a32 - a22 * a30;\n    const b08 = a20 * a33 - a23 * a30;\n    const b09 = a21 * a32 - a22 * a31;\n    const b10 = a21 * a33 - a23 * a31;\n    const b11 = a22 * a33 - a23 * a32;\n    let det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n    if (!det) {\n      return null;\n    }\n    det = 1 / det;\n    out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n    out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n    out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n    out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;\n    out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n    out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n    out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n    out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;\n    out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n    out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n    out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n    out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;\n    out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;\n    out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;\n    out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;\n    out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;\n    return out;\n  }\n  /**\n   * Calculates the adjugate of a {@link Mat4}\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the source matrix\n   * @returns `out`\n   */\n  static adjoint(out, a) {\n    const a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3];\n    const a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7];\n    const a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11];\n    const a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15];\n    const b00 = a00 * a11 - a01 * a10;\n    const b01 = a00 * a12 - a02 * a10;\n    const b02 = a00 * a13 - a03 * a10;\n    const b03 = a01 * a12 - a02 * a11;\n    const b04 = a01 * a13 - a03 * a11;\n    const b05 = a02 * a13 - a03 * a12;\n    const b06 = a20 * a31 - a21 * a30;\n    const b07 = a20 * a32 - a22 * a30;\n    const b08 = a20 * a33 - a23 * a30;\n    const b09 = a21 * a32 - a22 * a31;\n    const b10 = a21 * a33 - a23 * a31;\n    const b11 = a22 * a33 - a23 * a32;\n    out[0] = a11 * b11 - a12 * b10 + a13 * b09;\n    out[1] = a02 * b10 - a01 * b11 - a03 * b09;\n    out[2] = a31 * b05 - a32 * b04 + a33 * b03;\n    out[3] = a22 * b04 - a21 * b05 - a23 * b03;\n    out[4] = a12 * b08 - a10 * b11 - a13 * b07;\n    out[5] = a00 * b11 - a02 * b08 + a03 * b07;\n    out[6] = a32 * b02 - a30 * b05 - a33 * b01;\n    out[7] = a20 * b05 - a22 * b02 + a23 * b01;\n    out[8] = a10 * b10 - a11 * b08 + a13 * b06;\n    out[9] = a01 * b08 - a00 * b10 - a03 * b06;\n    out[10] = a30 * b04 - a31 * b02 + a33 * b00;\n    out[11] = a21 * b02 - a20 * b04 - a23 * b00;\n    out[12] = a11 * b07 - a10 * b09 - a12 * b06;\n    out[13] = a00 * b09 - a01 * b07 + a02 * b06;\n    out[14] = a31 * b01 - a30 * b03 - a32 * b00;\n    out[15] = a20 * b03 - a21 * b01 + a22 * b00;\n    return out;\n  }\n  /**\n   * Calculates the determinant of a {@link Mat4}\n   * @category Static\n   *\n   * @param a - the source matrix\n   * @returns determinant of a\n   */\n  static determinant(a) {\n    const a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3];\n    const a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7];\n    const a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11];\n    const a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15];\n    const b0 = a00 * a11 - a01 * a10;\n    const b1 = a00 * a12 - a02 * a10;\n    const b2 = a01 * a12 - a02 * a11;\n    const b3 = a20 * a31 - a21 * a30;\n    const b4 = a20 * a32 - a22 * a30;\n    const b5 = a21 * a32 - a22 * a31;\n    const b6 = a00 * b5 - a01 * b4 + a02 * b3;\n    const b7 = a10 * b5 - a11 * b4 + a12 * b3;\n    const b8 = a20 * b2 - a21 * b1 + a22 * b0;\n    const b9 = a30 * b2 - a31 * b1 + a32 * b0;\n    return a13 * b6 - a03 * b7 + a33 * b8 - a23 * b9;\n  }\n  /**\n   * Multiplies two {@link Mat4}s\n   * @category Static\n   *\n   * @param out - The receiving Matrix\n   * @param a - The first operand\n   * @param b - The second operand\n   * @returns `out`\n   */\n  static multiply(out, a, b) {\n    const a00 = a[0];\n    const a01 = a[1];\n    const a02 = a[2];\n    const a03 = a[3];\n    const a10 = a[4];\n    const a11 = a[5];\n    const a12 = a[6];\n    const a13 = a[7];\n    const a20 = a[8];\n    const a21 = a[9];\n    const a22 = a[10];\n    const a23 = a[11];\n    const a30 = a[12];\n    const a31 = a[13];\n    const a32 = a[14];\n    const a33 = a[15];\n    let b0 = b[0];\n    let b1 = b[1];\n    let b2 = b[2];\n    let b3 = b[3];\n    out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n    out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n    out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n    out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n    b0 = b[4];\n    b1 = b[5];\n    b2 = b[6];\n    b3 = b[7];\n    out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n    out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n    out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n    out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n    b0 = b[8];\n    b1 = b[9];\n    b2 = b[10];\n    b3 = b[11];\n    out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n    out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n    out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n    out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n    b0 = b[12];\n    b1 = b[13];\n    b2 = b[14];\n    b3 = b[15];\n    out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n    out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n    out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n    out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n    return out;\n  }\n  /**\n   * Alias for {@link Mat4.multiply}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static mul(out, a, b) {\n    return out;\n  }\n  /**\n   * Translate a {@link Mat4} by the given vector\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the matrix to translate\n   * @param v - vector to translate by\n   * @returns `out`\n   */\n  static translate(out, a, v) {\n    const x = v[0];\n    const y = v[1];\n    const z = v[2];\n    if (a === out) {\n      out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];\n      out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];\n      out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];\n      out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];\n    } else {\n      const a00 = a[0];\n      const a01 = a[1];\n      const a02 = a[2];\n      const a03 = a[3];\n      const a10 = a[4];\n      const a11 = a[5];\n      const a12 = a[6];\n      const a13 = a[7];\n      const a20 = a[8];\n      const a21 = a[9];\n      const a22 = a[10];\n      const a23 = a[11];\n      out[0] = a00;\n      out[1] = a01;\n      out[2] = a02;\n      out[3] = a03;\n      out[4] = a10;\n      out[5] = a11;\n      out[6] = a12;\n      out[7] = a13;\n      out[8] = a20;\n      out[9] = a21;\n      out[10] = a22;\n      out[11] = a23;\n      out[12] = a00 * x + a10 * y + a20 * z + a[12];\n      out[13] = a01 * x + a11 * y + a21 * z + a[13];\n      out[14] = a02 * x + a12 * y + a22 * z + a[14];\n      out[15] = a03 * x + a13 * y + a23 * z + a[15];\n    }\n    return out;\n  }\n  /**\n   * Scales the {@link Mat4} by the dimensions in the given {@link Vec3} not using vectorization\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the matrix to scale\n   * @param v - the {@link Vec3} to scale the matrix by\n   * @returns `out`\n   **/\n  static scale(out, a, v) {\n    const x = v[0];\n    const y = v[1];\n    const z = v[2];\n    out[0] = a[0] * x;\n    out[1] = a[1] * x;\n    out[2] = a[2] * x;\n    out[3] = a[3] * x;\n    out[4] = a[4] * y;\n    out[5] = a[5] * y;\n    out[6] = a[6] * y;\n    out[7] = a[7] * y;\n    out[8] = a[8] * z;\n    out[9] = a[9] * z;\n    out[10] = a[10] * z;\n    out[11] = a[11] * z;\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n    return out;\n  }\n  /**\n   * Rotates a {@link Mat4} by the given angle around the given axis\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the matrix to rotate\n   * @param rad - the angle to rotate the matrix by\n   * @param axis - the axis to rotate around\n   * @returns `out` or `null` if axis has a length of 0\n   */\n  static rotate(out, a, rad, axis) {\n    let x = axis[0];\n    let y = axis[1];\n    let z = axis[2];\n    let len = Math.sqrt(x * x + y * y + z * z);\n    if (len < GLM_EPSILON) {\n      return null;\n    }\n    len = 1 / len;\n    x *= len;\n    y *= len;\n    z *= len;\n    const s = Math.sin(rad);\n    const c = Math.cos(rad);\n    const t = 1 - c;\n    const a00 = a[0];\n    const a01 = a[1];\n    const a02 = a[2];\n    const a03 = a[3];\n    const a10 = a[4];\n    const a11 = a[5];\n    const a12 = a[6];\n    const a13 = a[7];\n    const a20 = a[8];\n    const a21 = a[9];\n    const a22 = a[10];\n    const a23 = a[11];\n    const b00 = x * x * t + c;\n    const b01 = y * x * t + z * s;\n    const b02 = z * x * t - y * s;\n    const b10 = x * y * t - z * s;\n    const b11 = y * y * t + c;\n    const b12 = z * y * t + x * s;\n    const b20 = x * z * t + y * s;\n    const b21 = y * z * t - x * s;\n    const b22 = z * z * t + c;\n    out[0] = a00 * b00 + a10 * b01 + a20 * b02;\n    out[1] = a01 * b00 + a11 * b01 + a21 * b02;\n    out[2] = a02 * b00 + a12 * b01 + a22 * b02;\n    out[3] = a03 * b00 + a13 * b01 + a23 * b02;\n    out[4] = a00 * b10 + a10 * b11 + a20 * b12;\n    out[5] = a01 * b10 + a11 * b11 + a21 * b12;\n    out[6] = a02 * b10 + a12 * b11 + a22 * b12;\n    out[7] = a03 * b10 + a13 * b11 + a23 * b12;\n    out[8] = a00 * b20 + a10 * b21 + a20 * b22;\n    out[9] = a01 * b20 + a11 * b21 + a21 * b22;\n    out[10] = a02 * b20 + a12 * b21 + a22 * b22;\n    out[11] = a03 * b20 + a13 * b21 + a23 * b22;\n    if (a !== out) {\n      out[12] = a[12];\n      out[13] = a[13];\n      out[14] = a[14];\n      out[15] = a[15];\n    }\n    return out;\n  }\n  /**\n   * Rotates a matrix by the given angle around the X axis\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the matrix to rotate\n   * @param rad - the angle to rotate the matrix by\n   * @returns `out`\n   */\n  static rotateX(out, a, rad) {\n    const s = Math.sin(rad);\n    const c = Math.cos(rad);\n    const a10 = a[4];\n    const a11 = a[5];\n    const a12 = a[6];\n    const a13 = a[7];\n    const a20 = a[8];\n    const a21 = a[9];\n    const a22 = a[10];\n    const a23 = a[11];\n    if (a !== out) {\n      out[0] = a[0];\n      out[1] = a[1];\n      out[2] = a[2];\n      out[3] = a[3];\n      out[12] = a[12];\n      out[13] = a[13];\n      out[14] = a[14];\n      out[15] = a[15];\n    }\n    out[4] = a10 * c + a20 * s;\n    out[5] = a11 * c + a21 * s;\n    out[6] = a12 * c + a22 * s;\n    out[7] = a13 * c + a23 * s;\n    out[8] = a20 * c - a10 * s;\n    out[9] = a21 * c - a11 * s;\n    out[10] = a22 * c - a12 * s;\n    out[11] = a23 * c - a13 * s;\n    return out;\n  }\n  /**\n   * Rotates a matrix by the given angle around the Y axis\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the matrix to rotate\n   * @param rad - the angle to rotate the matrix by\n   * @returns `out`\n   */\n  static rotateY(out, a, rad) {\n    const s = Math.sin(rad);\n    const c = Math.cos(rad);\n    const a00 = a[0];\n    const a01 = a[1];\n    const a02 = a[2];\n    const a03 = a[3];\n    const a20 = a[8];\n    const a21 = a[9];\n    const a22 = a[10];\n    const a23 = a[11];\n    if (a !== out) {\n      out[4] = a[4];\n      out[5] = a[5];\n      out[6] = a[6];\n      out[7] = a[7];\n      out[12] = a[12];\n      out[13] = a[13];\n      out[14] = a[14];\n      out[15] = a[15];\n    }\n    out[0] = a00 * c - a20 * s;\n    out[1] = a01 * c - a21 * s;\n    out[2] = a02 * c - a22 * s;\n    out[3] = a03 * c - a23 * s;\n    out[8] = a00 * s + a20 * c;\n    out[9] = a01 * s + a21 * c;\n    out[10] = a02 * s + a22 * c;\n    out[11] = a03 * s + a23 * c;\n    return out;\n  }\n  /**\n   * Rotates a matrix by the given angle around the Z axis\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the matrix to rotate\n   * @param rad - the angle to rotate the matrix by\n   * @returns `out`\n   */\n  static rotateZ(out, a, rad) {\n    const s = Math.sin(rad);\n    const c = Math.cos(rad);\n    const a00 = a[0];\n    const a01 = a[1];\n    const a02 = a[2];\n    const a03 = a[3];\n    const a10 = a[4];\n    const a11 = a[5];\n    const a12 = a[6];\n    const a13 = a[7];\n    if (a !== out) {\n      out[8] = a[8];\n      out[9] = a[9];\n      out[10] = a[10];\n      out[11] = a[11];\n      out[12] = a[12];\n      out[13] = a[13];\n      out[14] = a[14];\n      out[15] = a[15];\n    }\n    out[0] = a00 * c + a10 * s;\n    out[1] = a01 * c + a11 * s;\n    out[2] = a02 * c + a12 * s;\n    out[3] = a03 * c + a13 * s;\n    out[4] = a10 * c - a00 * s;\n    out[5] = a11 * c - a01 * s;\n    out[6] = a12 * c - a02 * s;\n    out[7] = a13 * c - a03 * s;\n    return out;\n  }\n  /**\n   * Creates a {@link Mat4} from a vector translation\n   * This is equivalent to (but much faster than):\n   * ```js\n   *   mat4.identity(dest);\n   *   mat4.translate(dest, dest, vec);\n   * ```\n   * @category Static\n   *\n   * @param out - {@link Mat4} receiving operation result\n   * @param v - Translation vector\n   * @returns `out`\n   */\n  static fromTranslation(out, v) {\n    out[0] = 1;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[5] = 1;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[10] = 1;\n    out[11] = 0;\n    out[12] = v[0];\n    out[13] = v[1];\n    out[14] = v[2];\n    out[15] = 1;\n    return out;\n  }\n  /**\n   * Creates a {@link Mat4} from a vector scaling\n   * This is equivalent to (but much faster than):\n   * ```js\n   *   mat4.identity(dest);\n   *   mat4.scale(dest, dest, vec);\n   * ```\n   * @category Static\n   *\n   * @param out - {@link Mat4} receiving operation result\n   * @param v - Scaling vector\n   * @returns `out`\n   */\n  static fromScaling(out, v) {\n    out[0] = v[0];\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[5] = v[1];\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[10] = v[2];\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n    out[15] = 1;\n    return out;\n  }\n  /**\n   * Creates a {@link Mat4} from a given angle around a given axis\n   * This is equivalent to (but much faster than):\n   * ```js\n   *   mat4.identity(dest);\n   *   mat4.rotate(dest, dest, rad, axis);\n   * ```\n   * @category Static\n   *\n   * @param out - {@link Mat4} receiving operation result\n   * @param rad - the angle to rotate the matrix by\n   * @param axis - the axis to rotate around\n   * @returns `out` or `null` if `axis` has a length of 0\n   */\n  static fromRotation(out, rad, axis) {\n    let x = axis[0];\n    let y = axis[1];\n    let z = axis[2];\n    let len = Math.sqrt(x * x + y * y + z * z);\n    if (len < GLM_EPSILON) {\n      return null;\n    }\n    len = 1 / len;\n    x *= len;\n    y *= len;\n    z *= len;\n    const s = Math.sin(rad);\n    const c = Math.cos(rad);\n    const t = 1 - c;\n    out[0] = x * x * t + c;\n    out[1] = y * x * t + z * s;\n    out[2] = z * x * t - y * s;\n    out[3] = 0;\n    out[4] = x * y * t - z * s;\n    out[5] = y * y * t + c;\n    out[6] = z * y * t + x * s;\n    out[7] = 0;\n    out[8] = x * z * t + y * s;\n    out[9] = y * z * t - x * s;\n    out[10] = z * z * t + c;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n    out[15] = 1;\n    return out;\n  }\n  /**\n   * Creates a matrix from the given angle around the X axis\n   * This is equivalent to (but much faster than):\n   * ```js\n   *   mat4.identity(dest);\n   *   mat4.rotateX(dest, dest, rad);\n   * ```\n   * @category Static\n   *\n   * @param out - mat4 receiving operation result\n   * @param rad - the angle to rotate the matrix by\n   * @returns `out`\n   */\n  static fromXRotation(out, rad) {\n    const s = Math.sin(rad);\n    const c = Math.cos(rad);\n    out[0] = 1;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[5] = c;\n    out[6] = s;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = -s;\n    out[10] = c;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n    out[15] = 1;\n    return out;\n  }\n  /**\n   * Creates a matrix from the given angle around the Y axis\n   * This is equivalent to (but much faster than):\n   * ```js\n   *   mat4.identity(dest);\n   *   mat4.rotateY(dest, dest, rad);\n   * ```\n   * @category Static\n   *\n   * @param out - mat4 receiving operation result\n   * @param rad - the angle to rotate the matrix by\n   * @returns `out`\n   */\n  static fromYRotation(out, rad) {\n    const s = Math.sin(rad);\n    const c = Math.cos(rad);\n    out[0] = c;\n    out[1] = 0;\n    out[2] = -s;\n    out[3] = 0;\n    out[4] = 0;\n    out[5] = 1;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = s;\n    out[9] = 0;\n    out[10] = c;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n    out[15] = 1;\n    return out;\n  }\n  /**\n   * Creates a matrix from the given angle around the Z axis\n   * This is equivalent to (but much faster than):\n   * ```js\n   *   mat4.identity(dest);\n   *   mat4.rotateZ(dest, dest, rad);\n   * ```\n   * @category Static\n   *\n   * @param out - mat4 receiving operation result\n   * @param rad - the angle to rotate the matrix by\n   * @returns `out`\n   */\n  static fromZRotation(out, rad) {\n    const s = Math.sin(rad);\n    const c = Math.cos(rad);\n    out[0] = c;\n    out[1] = s;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = -s;\n    out[5] = c;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[10] = 1;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n    out[15] = 1;\n    return out;\n  }\n  /**\n   * Creates a matrix from a quaternion rotation and vector translation\n   * This is equivalent to (but much faster than):\n   * ```js\n   *   mat4.identity(dest);\n   *   mat4.translate(dest, vec);\n   *   let quatMat = mat4.create();\n   *   quat4.toMat4(quat, quatMat);\n   *   mat4.multiply(dest, quatMat);\n   * ```\n   * @category Static\n   *\n   * @param out - mat4 receiving operation result\n   * @param q - Rotation quaternion\n   * @param v - Translation vector\n   * @returns `out`\n   */\n  static fromRotationTranslation(out, q, v) {\n    const x = q[0];\n    const y = q[1];\n    const z = q[2];\n    const w = q[3];\n    const x2 = x + x;\n    const y2 = y + y;\n    const z2 = z + z;\n    const xx = x * x2;\n    const xy = x * y2;\n    const xz = x * z2;\n    const yy = y * y2;\n    const yz = y * z2;\n    const zz = z * z2;\n    const wx = w * x2;\n    const wy = w * y2;\n    const wz = w * z2;\n    out[0] = 1 - (yy + zz);\n    out[1] = xy + wz;\n    out[2] = xz - wy;\n    out[3] = 0;\n    out[4] = xy - wz;\n    out[5] = 1 - (xx + zz);\n    out[6] = yz + wx;\n    out[7] = 0;\n    out[8] = xz + wy;\n    out[9] = yz - wx;\n    out[10] = 1 - (xx + yy);\n    out[11] = 0;\n    out[12] = v[0];\n    out[13] = v[1];\n    out[14] = v[2];\n    out[15] = 1;\n    return out;\n  }\n  /**\n   * Sets a {@link Mat4} from a {@link Quat2}.\n   * @category Static\n   *\n   * @param out - Matrix\n   * @param a - Dual Quaternion\n   * @returns `out`\n   */\n  static fromQuat2(out, a) {\n    const bx = -a[0];\n    const by = -a[1];\n    const bz = -a[2];\n    const bw = a[3];\n    const ax = a[4];\n    const ay = a[5];\n    const az = a[6];\n    const aw = a[7];\n    const magnitude = bx * bx + by * by + bz * bz + bw * bw;\n    if (magnitude > 0) {\n      _Mat4.#TMP_VEC3[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2 / magnitude;\n      _Mat4.#TMP_VEC3[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2 / magnitude;\n      _Mat4.#TMP_VEC3[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2 / magnitude;\n    } else {\n      _Mat4.#TMP_VEC3[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2;\n      _Mat4.#TMP_VEC3[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2;\n      _Mat4.#TMP_VEC3[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2;\n    }\n    _Mat4.fromRotationTranslation(out, a, _Mat4.#TMP_VEC3);\n    return out;\n  }\n  /**\n   * Calculates a {@link Mat4} normal matrix (transpose inverse) from a {@link Mat4}\n   * @category Static\n   *\n   * @param out - Matrix receiving operation result\n   * @param a - Mat4 to derive the normal matrix from\n   * @returns `out` or `null` if the matrix is not invertible\n   */\n  static normalFromMat4(out, a) {\n    const a00 = a[0];\n    const a01 = a[1];\n    const a02 = a[2];\n    const a03 = a[3];\n    const a10 = a[4];\n    const a11 = a[5];\n    const a12 = a[6];\n    const a13 = a[7];\n    const a20 = a[8];\n    const a21 = a[9];\n    const a22 = a[10];\n    const a23 = a[11];\n    const a30 = a[12];\n    const a31 = a[13];\n    const a32 = a[14];\n    const a33 = a[15];\n    const b00 = a00 * a11 - a01 * a10;\n    const b01 = a00 * a12 - a02 * a10;\n    const b02 = a00 * a13 - a03 * a10;\n    const b03 = a01 * a12 - a02 * a11;\n    const b04 = a01 * a13 - a03 * a11;\n    const b05 = a02 * a13 - a03 * a12;\n    const b06 = a20 * a31 - a21 * a30;\n    const b07 = a20 * a32 - a22 * a30;\n    const b08 = a20 * a33 - a23 * a30;\n    const b09 = a21 * a32 - a22 * a31;\n    const b10 = a21 * a33 - a23 * a31;\n    const b11 = a22 * a33 - a23 * a32;\n    let det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n    if (!det) {\n      return null;\n    }\n    det = 1 / det;\n    out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n    out[1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n    out[2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n    out[3] = 0;\n    out[4] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n    out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n    out[6] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n    out[7] = 0;\n    out[8] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n    out[9] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n    out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n    out[15] = 1;\n    return out;\n  }\n  /**\n   * Calculates a {@link Mat4} normal matrix (transpose inverse) from a {@link Mat4}\n   * This version omits the calculation of the constant factor (1/determinant), so\n   * any normals transformed with it will need to be renormalized.\n   * From https://stackoverflow.com/a/27616419/25968\n   * @category Static\n   *\n   * @param out - Matrix receiving operation result\n   * @param a - Mat4 to derive the normal matrix from\n   * @returns `out`\n   */\n  static normalFromMat4Fast(out, a) {\n    const ax = a[0];\n    const ay = a[1];\n    const az = a[2];\n    const bx = a[4];\n    const by = a[5];\n    const bz = a[6];\n    const cx = a[8];\n    const cy = a[9];\n    const cz = a[10];\n    out[0] = by * cz - cz * cy;\n    out[1] = bz * cx - cx * cz;\n    out[2] = bx * cy - cy * cx;\n    out[3] = 0;\n    out[4] = cy * az - cz * ay;\n    out[5] = cz * ax - cx * az;\n    out[6] = cx * ay - cy * ax;\n    out[7] = 0;\n    out[8] = ay * bz - az * by;\n    out[9] = az * bx - ax * bz;\n    out[10] = ax * by - ay * bx;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n    out[15] = 1;\n    return out;\n  }\n  /**\n   * Returns the translation vector component of a transformation\n   * matrix. If a matrix is built with fromRotationTranslation,\n   * the returned vector will be the same as the translation vector\n   * originally supplied.\n   * @category Static\n   *\n   * @param  {vec3} out Vector to receive translation component\n   * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n   * @return {vec3} out\n   */\n  static getTranslation(out, mat) {\n    out[0] = mat[12];\n    out[1] = mat[13];\n    out[2] = mat[14];\n    return out;\n  }\n  /**\n   * Returns the scaling factor component of a transformation\n   * matrix. If a matrix is built with fromRotationTranslationScale\n   * with a normalized Quaternion parameter, the returned vector will be\n   * the same as the scaling vector\n   * originally supplied.\n   * @category Static\n   *\n   * @param  {vec3} out Vector to receive scaling factor component\n   * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n   * @return {vec3} out\n   */\n  static getScaling(out, mat) {\n    const m11 = mat[0];\n    const m12 = mat[1];\n    const m13 = mat[2];\n    const m21 = mat[4];\n    const m22 = mat[5];\n    const m23 = mat[6];\n    const m31 = mat[8];\n    const m32 = mat[9];\n    const m33 = mat[10];\n    out[0] = Math.sqrt(m11 * m11 + m12 * m12 + m13 * m13);\n    out[1] = Math.sqrt(m21 * m21 + m22 * m22 + m23 * m23);\n    out[2] = Math.sqrt(m31 * m31 + m32 * m32 + m33 * m33);\n    return out;\n  }\n  /**\n   * Returns a quaternion representing the rotational component\n   * of a transformation matrix. If a matrix is built with\n   * fromRotationTranslation, the returned quaternion will be the\n   * same as the quaternion originally supplied.\n   * @category Static\n   *\n   * @param out - Quaternion to receive the rotation component\n   * @param mat - Matrix to be decomposed (input)\n   * @return `out`\n   */\n  static getRotation(out, mat) {\n    _Mat4.getScaling(_Mat4.#TMP_VEC3, mat);\n    const is1 = 1 / _Mat4.#TMP_VEC3[0];\n    const is2 = 1 / _Mat4.#TMP_VEC3[1];\n    const is3 = 1 / _Mat4.#TMP_VEC3[2];\n    const sm11 = mat[0] * is1;\n    const sm12 = mat[1] * is2;\n    const sm13 = mat[2] * is3;\n    const sm21 = mat[4] * is1;\n    const sm22 = mat[5] * is2;\n    const sm23 = mat[6] * is3;\n    const sm31 = mat[8] * is1;\n    const sm32 = mat[9] * is2;\n    const sm33 = mat[10] * is3;\n    const trace = sm11 + sm22 + sm33;\n    let S = 0;\n    if (trace > 0) {\n      S = Math.sqrt(trace + 1) * 2;\n      out[3] = 0.25 * S;\n      out[0] = (sm23 - sm32) / S;\n      out[1] = (sm31 - sm13) / S;\n      out[2] = (sm12 - sm21) / S;\n    } else if (sm11 > sm22 && sm11 > sm33) {\n      S = Math.sqrt(1 + sm11 - sm22 - sm33) * 2;\n      out[3] = (sm23 - sm32) / S;\n      out[0] = 0.25 * S;\n      out[1] = (sm12 + sm21) / S;\n      out[2] = (sm31 + sm13) / S;\n    } else if (sm22 > sm33) {\n      S = Math.sqrt(1 + sm22 - sm11 - sm33) * 2;\n      out[3] = (sm31 - sm13) / S;\n      out[0] = (sm12 + sm21) / S;\n      out[1] = 0.25 * S;\n      out[2] = (sm23 + sm32) / S;\n    } else {\n      S = Math.sqrt(1 + sm33 - sm11 - sm22) * 2;\n      out[3] = (sm12 - sm21) / S;\n      out[0] = (sm31 + sm13) / S;\n      out[1] = (sm23 + sm32) / S;\n      out[2] = 0.25 * S;\n    }\n    return out;\n  }\n  /**\n   * Decomposes a transformation matrix into its rotation, translation\n   * and scale components. Returns only the rotation component\n   * @category Static\n   *\n   * @param out_r - Quaternion to receive the rotation component\n   * @param out_t - Vector to receive the translation vector\n   * @param out_s - Vector to receive the scaling factor\n   * @param mat - Matrix to be decomposed (input)\n   * @returns `out_r`\n   */\n  static decompose(out_r, out_t, out_s, mat) {\n    out_t[0] = mat[12];\n    out_t[1] = mat[13];\n    out_t[2] = mat[14];\n    const m11 = mat[0];\n    const m12 = mat[1];\n    const m13 = mat[2];\n    const m21 = mat[4];\n    const m22 = mat[5];\n    const m23 = mat[6];\n    const m31 = mat[8];\n    const m32 = mat[9];\n    const m33 = mat[10];\n    out_s[0] = Math.sqrt(m11 * m11 + m12 * m12 + m13 * m13);\n    out_s[1] = Math.sqrt(m21 * m21 + m22 * m22 + m23 * m23);\n    out_s[2] = Math.sqrt(m31 * m31 + m32 * m32 + m33 * m33);\n    const is1 = 1 / out_s[0];\n    const is2 = 1 / out_s[1];\n    const is3 = 1 / out_s[2];\n    const sm11 = m11 * is1;\n    const sm12 = m12 * is2;\n    const sm13 = m13 * is3;\n    const sm21 = m21 * is1;\n    const sm22 = m22 * is2;\n    const sm23 = m23 * is3;\n    const sm31 = m31 * is1;\n    const sm32 = m32 * is2;\n    const sm33 = m33 * is3;\n    const trace = sm11 + sm22 + sm33;\n    let S = 0;\n    if (trace > 0) {\n      S = Math.sqrt(trace + 1) * 2;\n      out_r[3] = 0.25 * S;\n      out_r[0] = (sm23 - sm32) / S;\n      out_r[1] = (sm31 - sm13) / S;\n      out_r[2] = (sm12 - sm21) / S;\n    } else if (sm11 > sm22 && sm11 > sm33) {\n      S = Math.sqrt(1 + sm11 - sm22 - sm33) * 2;\n      out_r[3] = (sm23 - sm32) / S;\n      out_r[0] = 0.25 * S;\n      out_r[1] = (sm12 + sm21) / S;\n      out_r[2] = (sm31 + sm13) / S;\n    } else if (sm22 > sm33) {\n      S = Math.sqrt(1 + sm22 - sm11 - sm33) * 2;\n      out_r[3] = (sm31 - sm13) / S;\n      out_r[0] = (sm12 + sm21) / S;\n      out_r[1] = 0.25 * S;\n      out_r[2] = (sm23 + sm32) / S;\n    } else {\n      S = Math.sqrt(1 + sm33 - sm11 - sm22) * 2;\n      out_r[3] = (sm12 - sm21) / S;\n      out_r[0] = (sm31 + sm13) / S;\n      out_r[1] = (sm23 + sm32) / S;\n      out_r[2] = 0.25 * S;\n    }\n    return out_r;\n  }\n  /**\n   * Creates a matrix from a quaternion rotation, vector translation and vector scale\n   * This is equivalent to (but much faster than):\n   * ```js\n   *   mat4.identity(dest);\n   *   mat4.translate(dest, vec);\n   *   let quatMat = mat4.create();\n   *   quat4.toMat4(quat, quatMat);\n   *   mat4.multiply(dest, quatMat);\n   *   mat4.scale(dest, scale);\n   * ```\n   * @category Static\n   *\n   * @param out - mat4 receiving operation result\n   * @param q - Rotation quaternion\n   * @param v - Translation vector\n   * @param s - Scaling vector\n   * @returns `out`\n   */\n  static fromRotationTranslationScale(out, q, v, s) {\n    const x = q[0];\n    const y = q[1];\n    const z = q[2];\n    const w = q[3];\n    const x2 = x + x;\n    const y2 = y + y;\n    const z2 = z + z;\n    const xx = x * x2;\n    const xy = x * y2;\n    const xz = x * z2;\n    const yy = y * y2;\n    const yz = y * z2;\n    const zz = z * z2;\n    const wx = w * x2;\n    const wy = w * y2;\n    const wz = w * z2;\n    const sx = s[0];\n    const sy = s[1];\n    const sz = s[2];\n    out[0] = (1 - (yy + zz)) * sx;\n    out[1] = (xy + wz) * sx;\n    out[2] = (xz - wy) * sx;\n    out[3] = 0;\n    out[4] = (xy - wz) * sy;\n    out[5] = (1 - (xx + zz)) * sy;\n    out[6] = (yz + wx) * sy;\n    out[7] = 0;\n    out[8] = (xz + wy) * sz;\n    out[9] = (yz - wx) * sz;\n    out[10] = (1 - (xx + yy)) * sz;\n    out[11] = 0;\n    out[12] = v[0];\n    out[13] = v[1];\n    out[14] = v[2];\n    out[15] = 1;\n    return out;\n  }\n  /**\n   * Creates a matrix from a quaternion rotation, vector translation and vector scale, rotating and scaling around the\n   * given origin. This is equivalent to (but much faster than):\n   * ```js\n   *   mat4.identity(dest);\n   *   mat4.translate(dest, vec);\n   *   mat4.translate(dest, origin);\n   *   let quatMat = mat4.create();\n   *   quat4.toMat4(quat, quatMat);\n   *   mat4.multiply(dest, quatMat);\n   *   mat4.scale(dest, scale)\n   *   mat4.translate(dest, negativeOrigin);\n   * ```\n   * @category Static\n   *\n   * @param out - mat4 receiving operation result\n   * @param q - Rotation quaternion\n   * @param v - Translation vector\n   * @param s - Scaling vector\n   * @param o - The origin vector around which to scale and rotate\n   * @returns `out`\n   */\n  static fromRotationTranslationScaleOrigin(out, q, v, s, o) {\n    const x = q[0];\n    const y = q[1];\n    const z = q[2];\n    const w = q[3];\n    const x2 = x + x;\n    const y2 = y + y;\n    const z2 = z + z;\n    const xx = x * x2;\n    const xy = x * y2;\n    const xz = x * z2;\n    const yy = y * y2;\n    const yz = y * z2;\n    const zz = z * z2;\n    const wx = w * x2;\n    const wy = w * y2;\n    const wz = w * z2;\n    const sx = s[0];\n    const sy = s[1];\n    const sz = s[2];\n    const ox = o[0];\n    const oy = o[1];\n    const oz = o[2];\n    const out0 = (1 - (yy + zz)) * sx;\n    const out1 = (xy + wz) * sx;\n    const out2 = (xz - wy) * sx;\n    const out4 = (xy - wz) * sy;\n    const out5 = (1 - (xx + zz)) * sy;\n    const out6 = (yz + wx) * sy;\n    const out8 = (xz + wy) * sz;\n    const out9 = (yz - wx) * sz;\n    const out10 = (1 - (xx + yy)) * sz;\n    out[0] = out0;\n    out[1] = out1;\n    out[2] = out2;\n    out[3] = 0;\n    out[4] = out4;\n    out[5] = out5;\n    out[6] = out6;\n    out[7] = 0;\n    out[8] = out8;\n    out[9] = out9;\n    out[10] = out10;\n    out[11] = 0;\n    out[12] = v[0] + ox - (out0 * ox + out4 * oy + out8 * oz);\n    out[13] = v[1] + oy - (out1 * ox + out5 * oy + out9 * oz);\n    out[14] = v[2] + oz - (out2 * ox + out6 * oy + out10 * oz);\n    out[15] = 1;\n    return out;\n  }\n  /**\n   * Calculates a 4x4 matrix from the given quaternion\n   * @category Static\n   *\n   * @param out - mat4 receiving operation result\n   * @param q - Quaternion to create matrix from\n   * @returns `out`\n   */\n  static fromQuat(out, q) {\n    const x = q[0];\n    const y = q[1];\n    const z = q[2];\n    const w = q[3];\n    const x2 = x + x;\n    const y2 = y + y;\n    const z2 = z + z;\n    const xx = x * x2;\n    const yx = y * x2;\n    const yy = y * y2;\n    const zx = z * x2;\n    const zy = z * y2;\n    const zz = z * z2;\n    const wx = w * x2;\n    const wy = w * y2;\n    const wz = w * z2;\n    out[0] = 1 - yy - zz;\n    out[1] = yx + wz;\n    out[2] = zx - wy;\n    out[3] = 0;\n    out[4] = yx - wz;\n    out[5] = 1 - xx - zz;\n    out[6] = zy + wx;\n    out[7] = 0;\n    out[8] = zx + wy;\n    out[9] = zy - wx;\n    out[10] = 1 - xx - yy;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n    out[15] = 1;\n    return out;\n  }\n  /**\n   * Generates a frustum matrix with the given bounds\n   * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n   * which matches WebGL/OpenGL's clip volume.\n   * Passing null/undefined/no value for far will generate infinite projection matrix.\n   * @category Static\n   *\n   * @param out - mat4 frustum matrix will be written into\n   * @param left - Left bound of the frustum\n   * @param right - Right bound of the frustum\n   * @param bottom - Bottom bound of the frustum\n   * @param top - Top bound of the frustum\n   * @param near - Near bound of the frustum\n   * @param far -  Far bound of the frustum, can be null or Infinity\n   * @returns `out`\n   */\n  static frustumNO(out, left, right, bottom, top, near, far = Infinity) {\n    const rl = 1 / (right - left);\n    const tb = 1 / (top - bottom);\n    out[0] = near * 2 * rl;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[5] = near * 2 * tb;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = (right + left) * rl;\n    out[9] = (top + bottom) * tb;\n    out[11] = -1;\n    out[12] = 0;\n    out[13] = 0;\n    out[15] = 0;\n    if (far != null && far !== Infinity) {\n      const nf = 1 / (near - far);\n      out[10] = (far + near) * nf;\n      out[14] = 2 * far * near * nf;\n    } else {\n      out[10] = -1;\n      out[14] = -2 * near;\n    }\n    return out;\n  }\n  /**\n   * Alias for {@link Mat4.frustumNO}\n   * @category Static\n   * @deprecated Use {@link Mat4.frustumNO} or {@link Mat4.frustumZO} explicitly\n   */\n  static frustum(out, left, right, bottom, top, near, far = Infinity) {\n    return out;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Generates a frustum matrix with the given bounds\n   * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n   * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n   * Passing null/undefined/no value for far will generate infinite projection matrix.\n   * @category Static\n   *\n   * @param out - mat4 frustum matrix will be written into\n   * @param left - Left bound of the frustum\n   * @param right - Right bound of the frustum\n   * @param bottom - Bottom bound of the frustum\n   * @param top - Top bound of the frustum\n   * @param near - Near bound of the frustum\n   * @param far - Far bound of the frustum, can be null or Infinity\n   * @returns `out`\n   */\n  static frustumZO(out, left, right, bottom, top, near, far = Infinity) {\n    const rl = 1 / (right - left);\n    const tb = 1 / (top - bottom);\n    out[0] = near * 2 * rl;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[5] = near * 2 * tb;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = (right + left) * rl;\n    out[9] = (top + bottom) * tb;\n    out[11] = -1;\n    out[12] = 0;\n    out[13] = 0;\n    out[15] = 0;\n    if (far != null && far !== Infinity) {\n      const nf = 1 / (near - far);\n      out[10] = far * nf;\n      out[14] = far * near * nf;\n    } else {\n      out[10] = -1;\n      out[14] = -near;\n    }\n    return out;\n  }\n  /**\n   * Generates a perspective projection matrix with the given bounds.\n   * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n   * which matches WebGL/OpenGL's clip volume.\n   * Passing null/undefined/no value for far will generate infinite projection matrix.\n   * @category Static\n   *\n   * @param out - mat4 frustum matrix will be written into\n   * @param fovy - Vertical field of view in radians\n   * @param aspect - Aspect ratio. typically viewport width/height\n   * @param near - Near bound of the frustum\n   * @param far - Far bound of the frustum, can be null or Infinity\n   * @returns `out`\n   */\n  static perspectiveNO(out, fovy, aspect, near, far = Infinity) {\n    const f = 1 / Math.tan(fovy / 2);\n    out[0] = f / aspect;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[5] = f;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[11] = -1;\n    out[12] = 0;\n    out[13] = 0;\n    out[15] = 0;\n    if (far != null && far !== Infinity) {\n      const nf = 1 / (near - far);\n      out[10] = (far + near) * nf;\n      out[14] = 2 * far * near * nf;\n    } else {\n      out[10] = -1;\n      out[14] = -2 * near;\n    }\n    return out;\n  }\n  /**\n   * Alias for {@link Mat4.perspectiveNO}\n   * @category Static\n   * @deprecated Use {@link Mat4.perspectiveNO} or {@link Mat4.perspectiveZO} explicitly\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static perspective(out, fovy, aspect, near, far = Infinity) {\n    return out;\n  }\n  /**\n   * Generates a perspective projection matrix suitable for WebGPU with the given bounds.\n   * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n   * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n   * Passing null/undefined/no value for far will generate infinite projection matrix.\n   * @category Static\n   *\n   * @param out - mat4 frustum matrix will be written into\n   * @param fovy - Vertical field of view in radians\n   * @param aspect - Aspect ratio. typically viewport width/height\n   * @param near - Near bound of the frustum\n   * @param far - Far bound of the frustum, can be null or Infinity\n   * @returns `out`\n   */\n  static perspectiveZO(out, fovy, aspect, near, far = Infinity) {\n    const f = 1 / Math.tan(fovy / 2);\n    out[0] = f / aspect;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[5] = f;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[11] = -1;\n    out[12] = 0;\n    out[13] = 0;\n    out[15] = 0;\n    if (far != null && far !== Infinity) {\n      const nf = 1 / (near - far);\n      out[10] = far * nf;\n      out[14] = far * near * nf;\n    } else {\n      out[10] = -1;\n      out[14] = -near;\n    }\n    return out;\n  }\n  /**\n   * Generates a perspective projection matrix with the given field of view. This is primarily useful for generating\n   * projection matrices to be used with the still experimental WebVR API.\n   * @category Static\n   *\n   * @param out - mat4 frustum matrix will be written into\n   * @param fov - Object containing the following values: upDegrees, downDegrees, leftDegrees, rightDegrees\n   * @param near - Near bound of the frustum\n   * @param far - Far bound of the frustum\n   * @returns `out`\n   * @deprecated\n   */\n  static perspectiveFromFieldOfView(out, fov, near, far) {\n    const upTan = Math.tan(fov.upDegrees * Math.PI / 180);\n    const downTan = Math.tan(fov.downDegrees * Math.PI / 180);\n    const leftTan = Math.tan(fov.leftDegrees * Math.PI / 180);\n    const rightTan = Math.tan(fov.rightDegrees * Math.PI / 180);\n    const xScale = 2 / (leftTan + rightTan);\n    const yScale = 2 / (upTan + downTan);\n    out[0] = xScale;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[5] = yScale;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = -((leftTan - rightTan) * xScale * 0.5);\n    out[9] = (upTan - downTan) * yScale * 0.5;\n    out[10] = far / (near - far);\n    out[11] = -1;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = far * near / (near - far);\n    out[15] = 0;\n    return out;\n  }\n  /**\n   * Generates an orthogonal projection matrix with the given bounds. The near / far clip planes correspond to a\n   * normalized device coordinate Z range of [-1, 1], which matches WebGL / OpenGLs clip volume.\n   * @category Static\n   *\n   * @param out - mat4 frustum matrix will be written into\n   * @param left - Left bound of the frustum\n   * @param right - Right bound of the frustum\n   * @param bottom - Bottom bound of the frustum\n   * @param top - Top bound of the frustum\n   * @param near - Near bound of the frustum\n   * @param far - Far bound of the frustum\n   * @returns `out`\n   */\n  static orthoNO(out, left, right, bottom, top, near, far) {\n    const lr = 1 / (left - right);\n    const bt = 1 / (bottom - top);\n    const nf = 1 / (near - far);\n    out[0] = -2 * lr;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[5] = -2 * bt;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[10] = 2 * nf;\n    out[11] = 0;\n    out[12] = (left + right) * lr;\n    out[13] = (top + bottom) * bt;\n    out[14] = (far + near) * nf;\n    out[15] = 1;\n    return out;\n  }\n  /**\n   * Alias for {@link Mat4.orthoNO}\n   * @category Static\n   * @deprecated Use {@link Mat4.orthoNO} or {@link Mat4.orthoZO} explicitly\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static ortho(out, left, right, bottom, top, near, far) {\n    return out;\n  }\n  /**\n   * Generates a orthogonal projection matrix with the given bounds. The near / far clip planes correspond to a\n   * normalized device coordinate Z range of [0, 1], which matches WebGPU / Vulkan / DirectX / Metal's clip volume.\n   * @category Static\n   *\n   * @param out - mat4 frustum matrix will be written into\n   * @param left - Left bound of the frustum\n   * @param right - Right bound of the frustum\n   * @param bottom - Bottom bound of the frustum\n   * @param top - Top bound of the frustum\n   * @param near - Near bound of the frustum\n   * @param far - Far bound of the frustum\n   * @returns `out`\n   */\n  static orthoZO(out, left, right, bottom, top, near, far) {\n    const lr = 1 / (left - right);\n    const bt = 1 / (bottom - top);\n    const nf = 1 / (near - far);\n    out[0] = -2 * lr;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[5] = -2 * bt;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[10] = nf;\n    out[11] = 0;\n    out[12] = (left + right) * lr;\n    out[13] = (top + bottom) * bt;\n    out[14] = near * nf;\n    out[15] = 1;\n    return out;\n  }\n  /**\n   * Generates a look-at matrix with the given eye position, focal point, and up axis. If you want a matrix that\n   * actually makes an object look at another object, you should use targetTo instead.\n   * @category Static\n   *\n   * @param out - mat4 frustum matrix will be written into\n   * @param eye - Position of the viewer\n   * @param center - Point the viewer is looking at\n   * @param up - vec3 pointing up\n   * @returns `out`\n   */\n  static lookAt(out, eye, center, up) {\n    const eyex = eye[0];\n    const eyey = eye[1];\n    const eyez = eye[2];\n    const upx = up[0];\n    const upy = up[1];\n    const upz = up[2];\n    const centerx = center[0];\n    const centery = center[1];\n    const centerz = center[2];\n    if (Math.abs(eyex - centerx) < GLM_EPSILON && Math.abs(eyey - centery) < GLM_EPSILON && Math.abs(eyez - centerz) < GLM_EPSILON) {\n      return _Mat4.identity(out);\n    }\n    let z0 = eyex - centerx;\n    let z1 = eyey - centery;\n    let z2 = eyez - centerz;\n    let len = 1 / Math.sqrt(z0 * z0 + z1 * z1 + z2 * z2);\n    z0 *= len;\n    z1 *= len;\n    z2 *= len;\n    let x0 = upy * z2 - upz * z1;\n    let x1 = upz * z0 - upx * z2;\n    let x2 = upx * z1 - upy * z0;\n    len = Math.sqrt(x0 * x0 + x1 * x1 + x2 * x2);\n    if (!len) {\n      x0 = 0;\n      x1 = 0;\n      x2 = 0;\n    } else {\n      len = 1 / len;\n      x0 *= len;\n      x1 *= len;\n      x2 *= len;\n    }\n    let y0 = z1 * x2 - z2 * x1;\n    let y1 = z2 * x0 - z0 * x2;\n    let y2 = z0 * x1 - z1 * x0;\n    len = Math.sqrt(y0 * y0 + y1 * y1 + y2 * y2);\n    if (!len) {\n      y0 = 0;\n      y1 = 0;\n      y2 = 0;\n    } else {\n      len = 1 / len;\n      y0 *= len;\n      y1 *= len;\n      y2 *= len;\n    }\n    out[0] = x0;\n    out[1] = y0;\n    out[2] = z0;\n    out[3] = 0;\n    out[4] = x1;\n    out[5] = y1;\n    out[6] = z1;\n    out[7] = 0;\n    out[8] = x2;\n    out[9] = y2;\n    out[10] = z2;\n    out[11] = 0;\n    out[12] = -(x0 * eyex + x1 * eyey + x2 * eyez);\n    out[13] = -(y0 * eyex + y1 * eyey + y2 * eyez);\n    out[14] = -(z0 * eyex + z1 * eyey + z2 * eyez);\n    out[15] = 1;\n    return out;\n  }\n  /**\n   * Generates a matrix that makes something look at something else.\n   * @category Static\n   *\n   * @param out - mat4 frustum matrix will be written into\n   * @param eye - Position of the viewer\n   * @param target - Point the viewer is looking at\n   * @param up - vec3 pointing up\n   * @returns `out`\n   */\n  static targetTo(out, eye, target, up) {\n    const eyex = eye[0];\n    const eyey = eye[1];\n    const eyez = eye[2];\n    const upx = up[0];\n    const upy = up[1];\n    const upz = up[2];\n    let z0 = eyex - target[0];\n    let z1 = eyey - target[1];\n    let z2 = eyez - target[2];\n    let len = z0 * z0 + z1 * z1 + z2 * z2;\n    if (len > 0) {\n      len = 1 / Math.sqrt(len);\n      z0 *= len;\n      z1 *= len;\n      z2 *= len;\n    }\n    let x0 = upy * z2 - upz * z1;\n    let x1 = upz * z0 - upx * z2;\n    let x2 = upx * z1 - upy * z0;\n    len = x0 * x0 + x1 * x1 + x2 * x2;\n    if (len > 0) {\n      len = 1 / Math.sqrt(len);\n      x0 *= len;\n      x1 *= len;\n      x2 *= len;\n    }\n    out[0] = x0;\n    out[1] = x1;\n    out[2] = x2;\n    out[3] = 0;\n    out[4] = z1 * x2 - z2 * x1;\n    out[5] = z2 * x0 - z0 * x2;\n    out[6] = z0 * x1 - z1 * x0;\n    out[7] = 0;\n    out[8] = z0;\n    out[9] = z1;\n    out[10] = z2;\n    out[11] = 0;\n    out[12] = eyex;\n    out[13] = eyey;\n    out[14] = eyez;\n    out[15] = 1;\n    return out;\n  }\n  /**\n   * Returns Frobenius norm of a {@link Mat4}\n   * @category Static\n   *\n   * @param a - the matrix to calculate Frobenius norm of\n   * @returns Frobenius norm\n   */\n  static frob(a) {\n    return Math.sqrt(\n      a[0] * a[0] + a[1] * a[1] + a[2] * a[2] + a[3] * a[3] + a[4] * a[4] + a[5] * a[5] + a[6] * a[6] + a[7] * a[7] + a[8] * a[8] + a[9] * a[9] + a[10] * a[10] + a[11] * a[11] + a[12] * a[12] + a[13] * a[13] + a[14] * a[14] + a[15] * a[15]\n    );\n  }\n  /**\n   * Adds two {@link Mat4}'s\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  static add(out, a, b) {\n    out[0] = a[0] + b[0];\n    out[1] = a[1] + b[1];\n    out[2] = a[2] + b[2];\n    out[3] = a[3] + b[3];\n    out[4] = a[4] + b[4];\n    out[5] = a[5] + b[5];\n    out[6] = a[6] + b[6];\n    out[7] = a[7] + b[7];\n    out[8] = a[8] + b[8];\n    out[9] = a[9] + b[9];\n    out[10] = a[10] + b[10];\n    out[11] = a[11] + b[11];\n    out[12] = a[12] + b[12];\n    out[13] = a[13] + b[13];\n    out[14] = a[14] + b[14];\n    out[15] = a[15] + b[15];\n    return out;\n  }\n  /**\n   * Subtracts matrix b from matrix a\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  static subtract(out, a, b) {\n    out[0] = a[0] - b[0];\n    out[1] = a[1] - b[1];\n    out[2] = a[2] - b[2];\n    out[3] = a[3] - b[3];\n    out[4] = a[4] - b[4];\n    out[5] = a[5] - b[5];\n    out[6] = a[6] - b[6];\n    out[7] = a[7] - b[7];\n    out[8] = a[8] - b[8];\n    out[9] = a[9] - b[9];\n    out[10] = a[10] - b[10];\n    out[11] = a[11] - b[11];\n    out[12] = a[12] - b[12];\n    out[13] = a[13] - b[13];\n    out[14] = a[14] - b[14];\n    out[15] = a[15] - b[15];\n    return out;\n  }\n  /**\n   * Alias for {@link Mat4.subtract}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static sub(out, a, b) {\n    return out;\n  }\n  /**\n   * Multiply each element of the matrix by a scalar.\n   * @category Static\n   *\n   * @param out - the receiving matrix\n   * @param a - the matrix to scale\n   * @param b - amount to scale the matrix's elements by\n   * @returns `out`\n   */\n  static multiplyScalar(out, a, b) {\n    out[0] = a[0] * b;\n    out[1] = a[1] * b;\n    out[2] = a[2] * b;\n    out[3] = a[3] * b;\n    out[4] = a[4] * b;\n    out[5] = a[5] * b;\n    out[6] = a[6] * b;\n    out[7] = a[7] * b;\n    out[8] = a[8] * b;\n    out[9] = a[9] * b;\n    out[10] = a[10] * b;\n    out[11] = a[11] * b;\n    out[12] = a[12] * b;\n    out[13] = a[13] * b;\n    out[14] = a[14] * b;\n    out[15] = a[15] * b;\n    return out;\n  }\n  /**\n   * Adds two mat4's after multiplying each element of the second operand by a scalar value.\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @param scale - the amount to scale b's elements by before adding\n   * @returns `out`\n   */\n  static multiplyScalarAndAdd(out, a, b, scale) {\n    out[0] = a[0] + b[0] * scale;\n    out[1] = a[1] + b[1] * scale;\n    out[2] = a[2] + b[2] * scale;\n    out[3] = a[3] + b[3] * scale;\n    out[4] = a[4] + b[4] * scale;\n    out[5] = a[5] + b[5] * scale;\n    out[6] = a[6] + b[6] * scale;\n    out[7] = a[7] + b[7] * scale;\n    out[8] = a[8] + b[8] * scale;\n    out[9] = a[9] + b[9] * scale;\n    out[10] = a[10] + b[10] * scale;\n    out[11] = a[11] + b[11] * scale;\n    out[12] = a[12] + b[12] * scale;\n    out[13] = a[13] + b[13] * scale;\n    out[14] = a[14] + b[14] * scale;\n    out[15] = a[15] + b[15] * scale;\n    return out;\n  }\n  /**\n   * Returns whether two {@link Mat4}s have exactly the same elements in the same position (when compared with ===).\n   * @category Static\n   *\n   * @param a - The first matrix.\n   * @param b - The second matrix.\n   * @returns True if the matrices are equal, false otherwise.\n   */\n  static exactEquals(a, b) {\n    return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8] && a[9] === b[9] && a[10] === b[10] && a[11] === b[11] && a[12] === b[12] && a[13] === b[13] && a[14] === b[14] && a[15] === b[15];\n  }\n  /**\n   * Returns whether two {@link Mat4}s have approximately the same elements in the same position.\n   * @category Static\n   *\n   * @param a - The first matrix.\n   * @param b - The second matrix.\n   * @returns True if the matrices are equal, false otherwise.\n   */\n  static equals(a, b) {\n    const a0 = a[0];\n    const a1 = a[1];\n    const a2 = a[2];\n    const a3 = a[3];\n    const a4 = a[4];\n    const a5 = a[5];\n    const a6 = a[6];\n    const a7 = a[7];\n    const a8 = a[8];\n    const a9 = a[9];\n    const a10 = a[10];\n    const a11 = a[11];\n    const a12 = a[12];\n    const a13 = a[13];\n    const a14 = a[14];\n    const a15 = a[15];\n    const b0 = b[0];\n    const b1 = b[1];\n    const b2 = b[2];\n    const b3 = b[3];\n    const b4 = b[4];\n    const b5 = b[5];\n    const b6 = b[6];\n    const b7 = b[7];\n    const b8 = b[8];\n    const b9 = b[9];\n    const b10 = b[10];\n    const b11 = b[11];\n    const b12 = b[12];\n    const b13 = b[13];\n    const b14 = b[14];\n    const b15 = b[15];\n    return Math.abs(a0 - b0) <= GLM_EPSILON * Math.max(1, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= GLM_EPSILON * Math.max(1, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= GLM_EPSILON * Math.max(1, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= GLM_EPSILON * Math.max(1, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= GLM_EPSILON * Math.max(1, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= GLM_EPSILON * Math.max(1, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= GLM_EPSILON * Math.max(1, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= GLM_EPSILON * Math.max(1, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= GLM_EPSILON * Math.max(1, Math.abs(a8), Math.abs(b8)) && Math.abs(a9 - b9) <= GLM_EPSILON * Math.max(1, Math.abs(a9), Math.abs(b9)) && Math.abs(a10 - b10) <= GLM_EPSILON * Math.max(1, Math.abs(a10), Math.abs(b10)) && Math.abs(a11 - b11) <= GLM_EPSILON * Math.max(1, Math.abs(a11), Math.abs(b11)) && Math.abs(a12 - b12) <= GLM_EPSILON * Math.max(1, Math.abs(a12), Math.abs(b12)) && Math.abs(a13 - b13) <= GLM_EPSILON * Math.max(1, Math.abs(a13), Math.abs(b13)) && Math.abs(a14 - b14) <= GLM_EPSILON * Math.max(1, Math.abs(a14), Math.abs(b14)) && Math.abs(a15 - b15) <= GLM_EPSILON * Math.max(1, Math.abs(a15), Math.abs(b15));\n  }\n  /**\n   * Returns a string representation of a {@link Mat4}\n   * @category Static\n   *\n   * @param a - matrix to represent as a string\n   * @returns string representation of the matrix\n   */\n  static str(a) {\n    return `Mat4(${a.join(\", \")})`;\n  }\n};\nMat4.prototype.mul = Mat4.prototype.multiply;\nMat4.sub = Mat4.subtract;\nMat4.mul = Mat4.multiply;\nMat4.frustum = Mat4.frustumNO;\nMat4.perspective = Mat4.perspectiveNO;\nMat4.ortho = Mat4.orthoNO;\nvar Vec3 = class _Vec3 extends Float32Array {\n  /**\n   * Create a {@link Vec3}.\n   *\n   * @category Constructor\n   */\n  constructor(...values) {\n    switch (values.length) {\n      case 3:\n        super(values);\n        break;\n      case 2:\n        super(values[0], values[1], 3);\n        break;\n      case 1: {\n        const v = values[0];\n        if (typeof v === \"number\") {\n          super([v, v, v]);\n        } else {\n          super(v, 0, 3);\n        }\n        break;\n      }\n      default:\n        super(3);\n        break;\n    }\n  }\n  // ============\n  // Accessors\n  // ============\n  // Getters and setters to make component access read better.\n  // These are likely to be a little bit slower than direct array access.\n  /**\n   * The x component of the vector. Equivalent to `this[0];`\n   * @category Vector Components\n   */\n  get x() {\n    return this[0];\n  }\n  set x(value) {\n    this[0] = value;\n  }\n  /**\n   * The y component of the vector. Equivalent to `this[1];`\n   * @category Vector Components\n   */\n  get y() {\n    return this[1];\n  }\n  set y(value) {\n    this[1] = value;\n  }\n  /**\n   * The z component of the vector. Equivalent to `this[2];`\n   * @category Vector Components\n   */\n  get z() {\n    return this[2];\n  }\n  set z(value) {\n    this[2] = value;\n  }\n  // Alternate set of getters and setters in case this is being used to define\n  // a color.\n  /**\n   * The r component of the vector. Equivalent to `this[0];`\n   * @category Color Components\n   */\n  get r() {\n    return this[0];\n  }\n  set r(value) {\n    this[0] = value;\n  }\n  /**\n   * The g component of the vector. Equivalent to `this[1];`\n   * @category Color Components\n   */\n  get g() {\n    return this[1];\n  }\n  set g(value) {\n    this[1] = value;\n  }\n  /**\n   * The b component of the vector. Equivalent to `this[2];`\n   * @category Color Components\n   */\n  get b() {\n    return this[2];\n  }\n  set b(value) {\n    this[2] = value;\n  }\n  /**\n   * The magnitude (length) of this.\n   * Equivalent to `Vec3.magnitude(this);`\n   *\n   * Magnitude is used because the `length` attribute is already defined by\n   * TypedArrays to mean the number of elements in the array.\n   *\n   * @category Accessors\n   */\n  get magnitude() {\n    const x = this[0];\n    const y = this[1];\n    const z = this[2];\n    return Math.sqrt(x * x + y * y + z * z);\n  }\n  /**\n   * Alias for {@link Vec3.magnitude}\n   *\n   * @category Accessors\n   */\n  get mag() {\n    return this.magnitude;\n  }\n  /**\n   * The squared magnitude (length) of `this`.\n   * Equivalent to `Vec3.squaredMagnitude(this);`\n   *\n   * @category Accessors\n   */\n  get squaredMagnitude() {\n    const x = this[0];\n    const y = this[1];\n    const z = this[2];\n    return x * x + y * y + z * z;\n  }\n  /**\n   * Alias for {@link Vec3.squaredMagnitude}\n   *\n   * @category Accessors\n   */\n  get sqrMag() {\n    return this.squaredMagnitude;\n  }\n  /**\n   * A string representation of `this`\n   * Equivalent to `Vec3.str(this);`\n   *\n   * @category Accessors\n   */\n  get str() {\n    return _Vec3.str(this);\n  }\n  // ===================\n  // Instances methods\n  // ===================\n  /**\n   * Copy the values from another {@link Vec3} into `this`.\n   * @category Methods\n   *\n   * @param a the source vector\n   * @returns `this`\n   */\n  copy(a) {\n    this.set(a);\n    return this;\n  }\n  /**\n   * Adds a {@link Vec3} to `this`.\n   * Equivalent to `Vec3.add(this, this, b);`\n   * @category Methods\n   *\n   * @param b - The vector to add to `this`\n   * @returns `this`\n   */\n  add(b) {\n    this[0] += b[0];\n    this[1] += b[1];\n    this[2] += b[2];\n    return this;\n  }\n  /**\n   * Subtracts a {@link Vec3} from `this`.\n   * Equivalent to `Vec3.subtract(this, this, b);`\n   * @category Methods\n   *\n   * @param b - The vector to subtract from `this`\n   * @returns `this`\n   */\n  subtract(b) {\n    this[0] -= b[0];\n    this[1] -= b[1];\n    this[2] -= b[2];\n    return this;\n  }\n  /**\n   * Alias for {@link Vec3.subtract}\n   * @category Methods\n   */\n  sub(b) {\n    return this;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Multiplies `this` by a {@link Vec3}.\n   * Equivalent to `Vec3.multiply(this, this, b);`\n   * @category Methods\n   *\n   * @param b - The vector to multiply `this` by\n   * @returns `this`\n   */\n  multiply(b) {\n    this[0] *= b[0];\n    this[1] *= b[1];\n    this[2] *= b[2];\n    return this;\n  }\n  /**\n   * Alias for {@link Vec3.multiply}\n   * @category Methods\n   */\n  mul(b) {\n    return this;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Divides `this` by a {@link Vec3}.\n   * Equivalent to `Vec3.divide(this, this, b);`\n   * @category Methods\n   *\n   * @param b - The vector to divide `this` by\n   * @returns `this`\n   */\n  divide(b) {\n    this[0] /= b[0];\n    this[1] /= b[1];\n    this[2] /= b[2];\n    return this;\n  }\n  /**\n   * Alias for {@link Vec3.divide}\n   * @category Methods\n   */\n  div(b) {\n    return this;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Scales `this` by a scalar number.\n   * Equivalent to `Vec3.scale(this, this, b);`\n   * @category Methods\n   *\n   * @param b - Amount to scale `this` by\n   * @returns `this`\n   */\n  scale(b) {\n    this[0] *= b;\n    this[1] *= b;\n    this[2] *= b;\n    return this;\n  }\n  /**\n   * Calculates `this` scaled by a scalar value then adds the result to `this`.\n   * Equivalent to `Vec3.scaleAndAdd(this, this, b, scale);`\n   * @category Methods\n   *\n   * @param b - The vector to add to `this`\n   * @param scale - The amount to scale `b` by before adding\n   * @returns `this`\n   */\n  scaleAndAdd(b, scale) {\n    this[0] += b[0] * scale;\n    this[1] += b[1] * scale;\n    this[2] += b[2] * scale;\n    return this;\n  }\n  /**\n   * Calculates the Euclidean distance between another {@link Vec3} and `this`.\n   * Equivalent to `Vec3.distance(this, b);`\n   * @category Methods\n   *\n   * @param b - The vector to calculate the distance to\n   * @returns Distance between `this` and `b`\n   */\n  distance(b) {\n    return _Vec3.distance(this, b);\n  }\n  /**\n   * Alias for {@link Vec3.distance}\n   * @category Methods\n   */\n  dist(b) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Calculates the squared Euclidean distance between another {@link Vec3} and `this`.\n   * Equivalent to `Vec3.squaredDistance(this, b);`\n   * @category Methods\n   *\n   * @param b The vector to calculate the squared distance to\n   * @returns Squared distance between `this` and `b`\n   */\n  squaredDistance(b) {\n    return _Vec3.squaredDistance(this, b);\n  }\n  /**\n   * Alias for {@link Vec3.squaredDistance}\n   * @category Methods\n   */\n  sqrDist(b) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Negates the components of `this`.\n   * Equivalent to `Vec3.negate(this, this);`\n   * @category Methods\n   *\n   * @returns `this`\n   */\n  negate() {\n    this[0] *= -1;\n    this[1] *= -1;\n    this[2] *= -1;\n    return this;\n  }\n  /**\n   * Inverts the components of `this`.\n   * Equivalent to `Vec3.inverse(this, this);`\n   * @category Methods\n   *\n   * @returns `this`\n   */\n  invert() {\n    this[0] = 1 / this[0];\n    this[1] = 1 / this[1];\n    this[2] = 1 / this[2];\n    return this;\n  }\n  /**\n   * Sets each component of `this` to its absolute value.\n   * Equivalent to `Vec3.abs(this, this);`\n   * @category Methods\n   *\n   * @returns `this`\n   */\n  abs() {\n    this[0] = Math.abs(this[0]);\n    this[1] = Math.abs(this[1]);\n    this[2] = Math.abs(this[2]);\n    return this;\n  }\n  /**\n   * Calculates the dot product of this and another {@link Vec3}.\n   * Equivalent to `Vec3.dot(this, b);`\n   * @category Methods\n   *\n   * @param b - The second operand\n   * @returns Dot product of `this` and `b`\n   */\n  dot(b) {\n    return this[0] * b[0] + this[1] * b[1] + this[2] * b[2];\n  }\n  /**\n   * Normalize `this`.\n   * Equivalent to `Vec3.normalize(this, this);`\n   * @category Methods\n   *\n   * @returns `this`\n   */\n  normalize() {\n    return _Vec3.normalize(this, this);\n  }\n  // ===================\n  // Static accessors\n  // ===================\n  /**\n   * @category Static\n   *\n   * @returns The number of bytes in a {@link Vec3}.\n   */\n  static get BYTE_LENGTH() {\n    return 3 * Float32Array.BYTES_PER_ELEMENT;\n  }\n  // ===================\n  // Static methods\n  // ===================\n  /**\n   * Creates a new, empty vec3\n   * @category Static\n   *\n   * @returns a new 3D vector\n   */\n  static create() {\n    return new _Vec3();\n  }\n  /**\n   * Creates a new vec3 initialized with values from an existing vector\n   * @category Static\n   *\n   * @param a - vector to clone\n   * @returns a new 3D vector\n   */\n  static clone(a) {\n    return new _Vec3(a);\n  }\n  /**\n   * Calculates the magnitude (length) of a {@link Vec3}\n   * @category Static\n   *\n   * @param a - Vector to calculate magnitude of\n   * @returns Magnitude of a\n   */\n  static magnitude(a) {\n    const x = a[0];\n    const y = a[1];\n    const z = a[2];\n    return Math.sqrt(x * x + y * y + z * z);\n  }\n  /**\n   * Alias for {@link Vec3.magnitude}\n   * @category Static\n   */\n  static mag(a) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Alias for {@link Vec3.magnitude}\n   * @category Static\n   * @deprecated Use {@link Vec3.magnitude} to avoid conflicts with builtin `length` methods/attribs\n   *\n   * @param a - vector to calculate length of\n   * @returns length of a\n   */\n  // Length conflicts with Function.length\n  static length(a) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Alias for {@link Vec3.magnitude}\n   * @category Static\n   * @deprecated Use {@link Vec3.mag}\n   */\n  static len(a) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Creates a new vec3 initialized with the given values\n   * @category Static\n   *\n   * @param x - X component\n   * @param y - Y component\n   * @param z - Z component\n   * @returns a new 3D vector\n   */\n  static fromValues(x, y, z) {\n    return new _Vec3(x, y, z);\n  }\n  /**\n   * Copy the values from one vec3 to another\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the source vector\n   * @returns `out`\n   */\n  static copy(out, a) {\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    return out;\n  }\n  /**\n   * Set the components of a vec3 to the given values\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param x - X component\n   * @param y - Y component\n   * @param z - Z component\n   * @returns `out`\n   */\n  static set(out, x, y, z) {\n    out[0] = x;\n    out[1] = y;\n    out[2] = z;\n    return out;\n  }\n  /**\n   * Adds two {@link Vec3}s\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param a - The first operand\n   * @param b - The second operand\n   * @returns `out`\n   */\n  static add(out, a, b) {\n    out[0] = a[0] + b[0];\n    out[1] = a[1] + b[1];\n    out[2] = a[2] + b[2];\n    return out;\n  }\n  /**\n   * Subtracts vector b from vector a\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  static subtract(out, a, b) {\n    out[0] = a[0] - b[0];\n    out[1] = a[1] - b[1];\n    out[2] = a[2] - b[2];\n    return out;\n  }\n  /**\n   * Alias for {@link Vec3.subtract}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static sub(out, a, b) {\n    return [0, 0, 0];\n  }\n  /**\n   * Multiplies two vec3's\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  static multiply(out, a, b) {\n    out[0] = a[0] * b[0];\n    out[1] = a[1] * b[1];\n    out[2] = a[2] * b[2];\n    return out;\n  }\n  /**\n   * Alias for {@link Vec3.multiply}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static mul(out, a, b) {\n    return [0, 0, 0];\n  }\n  /**\n   * Divides two vec3's\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  static divide(out, a, b) {\n    out[0] = a[0] / b[0];\n    out[1] = a[1] / b[1];\n    out[2] = a[2] / b[2];\n    return out;\n  }\n  /**\n   * Alias for {@link Vec3.divide}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static div(out, a, b) {\n    return [0, 0, 0];\n  }\n  /**\n   * Math.ceil the components of a vec3\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - vector to ceil\n   * @returns `out`\n   */\n  static ceil(out, a) {\n    out[0] = Math.ceil(a[0]);\n    out[1] = Math.ceil(a[1]);\n    out[2] = Math.ceil(a[2]);\n    return out;\n  }\n  /**\n   * Math.floor the components of a vec3\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - vector to floor\n   * @returns `out`\n   */\n  static floor(out, a) {\n    out[0] = Math.floor(a[0]);\n    out[1] = Math.floor(a[1]);\n    out[2] = Math.floor(a[2]);\n    return out;\n  }\n  /**\n   * Returns the minimum of two vec3's\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  static min(out, a, b) {\n    out[0] = Math.min(a[0], b[0]);\n    out[1] = Math.min(a[1], b[1]);\n    out[2] = Math.min(a[2], b[2]);\n    return out;\n  }\n  /**\n   * Returns the maximum of two vec3's\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  static max(out, a, b) {\n    out[0] = Math.max(a[0], b[0]);\n    out[1] = Math.max(a[1], b[1]);\n    out[2] = Math.max(a[2], b[2]);\n    return out;\n  }\n  /**\n   * symmetric round the components of a vec3\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - vector to round\n   * @returns `out`\n   */\n  /*\n    static round(out: Vec3Like, a: Readonly<Vec3Like>): Vec3Like {\n    out[0] = glMatrix.round(a[0]);\n    out[1] = glMatrix.round(a[1]);\n    out[2] = glMatrix.round(a[2]);\n    return out;\n  }*/\n  /**\n   * Scales a vec3 by a scalar number\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the vector to scale\n   * @param scale - amount to scale the vector by\n   * @returns `out`\n   */\n  static scale(out, a, scale) {\n    out[0] = a[0] * scale;\n    out[1] = a[1] * scale;\n    out[2] = a[2] * scale;\n    return out;\n  }\n  /**\n   * Adds two vec3's after scaling the second operand by a scalar value\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @param scale - the amount to scale b by before adding\n   * @returns `out`\n   */\n  static scaleAndAdd(out, a, b, scale) {\n    out[0] = a[0] + b[0] * scale;\n    out[1] = a[1] + b[1] * scale;\n    out[2] = a[2] + b[2] * scale;\n    return out;\n  }\n  /**\n   * Calculates the Euclidean distance between two vec3's\n   * @category Static\n   *\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns distance between a and b\n   */\n  static distance(a, b) {\n    const x = b[0] - a[0];\n    const y = b[1] - a[1];\n    const z = b[2] - a[2];\n    return Math.sqrt(x * x + y * y + z * z);\n  }\n  /**\n   * Alias for {@link Vec3.distance}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static dist(a, b) {\n    return 0;\n  }\n  /**\n   * Calculates the squared Euclidean distance between two vec3's\n   * @category Static\n   *\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns squared distance between a and b\n   */\n  static squaredDistance(a, b) {\n    const x = b[0] - a[0];\n    const y = b[1] - a[1];\n    const z = b[2] - a[2];\n    return x * x + y * y + z * z;\n  }\n  /**\n   * Alias for {@link Vec3.squaredDistance}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static sqrDist(a, b) {\n    return 0;\n  }\n  /**\n   * Calculates the squared length of a vec3\n   * @category Static\n   *\n   * @param a - vector to calculate squared length of\n   * @returns squared length of a\n   */\n  static squaredLength(a) {\n    const x = a[0];\n    const y = a[1];\n    const z = a[2];\n    return x * x + y * y + z * z;\n  }\n  /**\n   * Alias for {@link Vec3.squaredLength}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static sqrLen(a, b) {\n    return 0;\n  }\n  /**\n   * Negates the components of a vec3\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - vector to negate\n   * @returns `out`\n   */\n  static negate(out, a) {\n    out[0] = -a[0];\n    out[1] = -a[1];\n    out[2] = -a[2];\n    return out;\n  }\n  /**\n   * Returns the inverse of the components of a vec3\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - vector to invert\n   * @returns `out`\n   */\n  static inverse(out, a) {\n    out[0] = 1 / a[0];\n    out[1] = 1 / a[1];\n    out[2] = 1 / a[2];\n    return out;\n  }\n  /**\n   * Returns the absolute value of the components of a {@link Vec3}\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param a - Vector to compute the absolute values of\n   * @returns `out`\n   */\n  static abs(out, a) {\n    out[0] = Math.abs(a[0]);\n    out[1] = Math.abs(a[1]);\n    out[2] = Math.abs(a[2]);\n    return out;\n  }\n  /**\n   * Normalize a vec3\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - vector to normalize\n   * @returns `out`\n   */\n  static normalize(out, a) {\n    const x = a[0];\n    const y = a[1];\n    const z = a[2];\n    let len = x * x + y * y + z * z;\n    if (len > 0) {\n      len = 1 / Math.sqrt(len);\n    }\n    out[0] = a[0] * len;\n    out[1] = a[1] * len;\n    out[2] = a[2] * len;\n    return out;\n  }\n  /**\n   * Calculates the dot product of two vec3's\n   * @category Static\n   *\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns dot product of a and b\n   */\n  static dot(a, b) {\n    return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n  }\n  /**\n   * Computes the cross product of two vec3's\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  static cross(out, a, b) {\n    const ax = a[0], ay = a[1], az = a[2];\n    const bx = b[0], by = b[1], bz = b[2];\n    out[0] = ay * bz - az * by;\n    out[1] = az * bx - ax * bz;\n    out[2] = ax * by - ay * bx;\n    return out;\n  }\n  /**\n   * Performs a linear interpolation between two vec3's\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @param t - interpolation amount, in the range [0-1], between the two inputs\n   * @returns `out`\n   */\n  static lerp(out, a, b, t) {\n    const ax = a[0];\n    const ay = a[1];\n    const az = a[2];\n    out[0] = ax + t * (b[0] - ax);\n    out[1] = ay + t * (b[1] - ay);\n    out[2] = az + t * (b[2] - az);\n    return out;\n  }\n  /**\n   * Performs a spherical linear interpolation between two vec3's\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @param t - interpolation amount, in the range [0-1], between the two inputs\n   * @returns `out`\n   */\n  static slerp(out, a, b, t) {\n    const angle = Math.acos(Math.min(Math.max(_Vec3.dot(a, b), -1), 1));\n    const sinTotal = Math.sin(angle);\n    const ratioA = Math.sin((1 - t) * angle) / sinTotal;\n    const ratioB = Math.sin(t * angle) / sinTotal;\n    out[0] = ratioA * a[0] + ratioB * b[0];\n    out[1] = ratioA * a[1] + ratioB * b[1];\n    out[2] = ratioA * a[2] + ratioB * b[2];\n    return out;\n  }\n  /**\n   * Performs a hermite interpolation with two control points\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @param c - the third operand\n   * @param d - the fourth operand\n   * @param t - interpolation amount, in the range [0-1], between the two inputs\n   * @returns `out`\n   */\n  static hermite(out, a, b, c, d, t) {\n    const factorTimes2 = t * t;\n    const factor1 = factorTimes2 * (2 * t - 3) + 1;\n    const factor2 = factorTimes2 * (t - 2) + t;\n    const factor3 = factorTimes2 * (t - 1);\n    const factor4 = factorTimes2 * (3 - 2 * t);\n    out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n    out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n    out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n    return out;\n  }\n  /**\n   * Performs a bezier interpolation with two control points\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @param c - the third operand\n   * @param d - the fourth operand\n   * @param t - interpolation amount, in the range [0-1], between the two inputs\n   * @returns `out`\n   */\n  static bezier(out, a, b, c, d, t) {\n    const inverseFactor = 1 - t;\n    const inverseFactorTimesTwo = inverseFactor * inverseFactor;\n    const factorTimes2 = t * t;\n    const factor1 = inverseFactorTimesTwo * inverseFactor;\n    const factor2 = 3 * t * inverseFactorTimesTwo;\n    const factor3 = 3 * factorTimes2 * inverseFactor;\n    const factor4 = factorTimes2 * t;\n    out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n    out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n    out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n    return out;\n  }\n  /**\n   * Generates a random vector with the given scale\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param {Number} [scale] Length of the resulting vector. If omitted, a unit vector will be returned\n   * @returns `out`\n   */\n  /*\n      static random(out: Vec3Like, scale) {\n      scale = scale === undefined ? 1.0 : scale;\n  \n      let r = glMatrix.RANDOM() * 2.0 * Math.PI;\n      let z = glMatrix.RANDOM() * 2.0 - 1.0;\n      let zScale = Math.sqrt(1.0 - z * z) * scale;\n  \n      out[0] = Math.cos(r) * zScale;\n      out[1] = Math.sin(r) * zScale;\n      out[2] = z * scale;\n      return out;\n    }*/\n  /**\n   * Transforms the vec3 with a mat4.\n   * 4th vector component is implicitly '1'\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the vector to transform\n   * @param m - matrix to transform with\n   * @returns `out`\n   */\n  static transformMat4(out, a, m) {\n    const x = a[0], y = a[1], z = a[2];\n    const w = m[3] * x + m[7] * y + m[11] * z + m[15] || 1;\n    out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;\n    out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;\n    out[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;\n    return out;\n  }\n  /**\n   * Transforms the vec3 with a mat3.\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the vector to transform\n   * @param m - the 3x3 matrix to transform with\n   * @returns `out`\n   */\n  static transformMat3(out, a, m) {\n    const x = a[0], y = a[1], z = a[2];\n    out[0] = x * m[0] + y * m[3] + z * m[6];\n    out[1] = x * m[1] + y * m[4] + z * m[7];\n    out[2] = x * m[2] + y * m[5] + z * m[8];\n    return out;\n  }\n  /**\n   * Transforms the vec3 with a quat\n   * Can also be used for dual quaternions. (Multiply it with the real part)\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the vector to transform\n   * @param q - quaternion to transform with\n   * @returns `out`\n   */\n  static transformQuat(out, a, q) {\n    const qx = q[0];\n    const qy = q[1];\n    const qz = q[2];\n    const w2 = q[3] * 2;\n    const x = a[0];\n    const y = a[1];\n    const z = a[2];\n    const uvx = qy * z - qz * y;\n    const uvy = qz * x - qx * z;\n    const uvz = qx * y - qy * x;\n    const uuvx = (qy * uvz - qz * uvy) * 2;\n    const uuvy = (qz * uvx - qx * uvz) * 2;\n    const uuvz = (qx * uvy - qy * uvx) * 2;\n    out[0] = x + uvx * w2 + uuvx;\n    out[1] = y + uvy * w2 + uuvy;\n    out[2] = z + uvz * w2 + uuvz;\n    return out;\n  }\n  /**\n   * Rotate a 3D vector around the x-axis\n   * @category Static\n   *\n   * @param out - The receiving vec3\n   * @param a - The vec3 point to rotate\n   * @param b - The origin of the rotation\n   * @param rad - The angle of rotation in radians\n   * @returns `out`\n   */\n  static rotateX(out, a, b, rad) {\n    const by = b[1];\n    const bz = b[2];\n    const py = a[1] - by;\n    const pz = a[2] - bz;\n    out[0] = a[0];\n    out[1] = py * Math.cos(rad) - pz * Math.sin(rad) + by;\n    out[2] = py * Math.sin(rad) + pz * Math.cos(rad) + bz;\n    return out;\n  }\n  /**\n   * Rotate a 3D vector around the y-axis\n   * @category Static\n   *\n   * @param out - The receiving vec3\n   * @param a - The vec3 point to rotate\n   * @param b - The origin of the rotation\n   * @param rad - The angle of rotation in radians\n   * @returns `out`\n   */\n  static rotateY(out, a, b, rad) {\n    const bx = b[0];\n    const bz = b[2];\n    const px = a[0] - bx;\n    const pz = a[2] - bz;\n    out[0] = pz * Math.sin(rad) + px * Math.cos(rad) + bx;\n    out[1] = a[1];\n    out[2] = pz * Math.cos(rad) - px * Math.sin(rad) + bz;\n    return out;\n  }\n  /**\n   * Rotate a 3D vector around the z-axis\n   * @category Static\n   *\n   * @param out - The receiving vec3\n   * @param a - The vec3 point to rotate\n   * @param b - The origin of the rotation\n   * @param rad - The angle of rotation in radians\n   * @returns `out`\n   */\n  static rotateZ(out, a, b, rad) {\n    const bx = b[0];\n    const by = b[1];\n    const px = a[0] - bx;\n    const py = a[1] - by;\n    out[0] = px * Math.cos(rad) - py * Math.sin(rad) + bx;\n    out[1] = px * Math.sin(rad) + py * Math.cos(rad) + by;\n    out[2] = b[2];\n    return out;\n  }\n  /**\n   * Get the angle between two 3D vectors\n   * @category Static\n   *\n   * @param a - The first operand\n   * @param b - The second operand\n   * @returns The angle in radians\n   */\n  static angle(a, b) {\n    const ax = a[0];\n    const ay = a[1];\n    const az = a[2];\n    const bx = b[0];\n    const by = b[1];\n    const bz = b[2];\n    const mag = Math.sqrt((ax * ax + ay * ay + az * az) * (bx * bx + by * by + bz * bz));\n    const cosine = mag && _Vec3.dot(a, b) / mag;\n    return Math.acos(Math.min(Math.max(cosine, -1), 1));\n  }\n  /**\n   * Set the components of a vec3 to zero\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @returns `out`\n   */\n  static zero(out) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n    return out;\n  }\n  /**\n   * Returns a string representation of a vector\n   * @category Static\n   *\n   * @param a - vector to represent as a string\n   * @returns string representation of the vector\n   */\n  static str(a) {\n    return `Vec3(${a.join(\", \")})`;\n  }\n  /**\n   * Returns whether the vectors have exactly the same elements in the same position (when compared with ===)\n   * @category Static\n   *\n   * @param a - The first vector.\n   * @param b - The second vector.\n   * @returns True if the vectors are equal, false otherwise.\n   */\n  static exactEquals(a, b) {\n    return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n  }\n  /**\n   * Returns whether the vectors have approximately the same elements in the same position.\n   * @category Static\n   *\n   * @param a - The first vector.\n   * @param b - The second vector.\n   * @returns True if the vectors are equal, false otherwise.\n   */\n  static equals(a, b) {\n    const a0 = a[0];\n    const a1 = a[1];\n    const a2 = a[2];\n    const b0 = b[0];\n    const b1 = b[1];\n    const b2 = b[2];\n    return Math.abs(a0 - b0) <= GLM_EPSILON * Math.max(1, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= GLM_EPSILON * Math.max(1, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= GLM_EPSILON * Math.max(1, Math.abs(a2), Math.abs(b2));\n  }\n};\nVec3.prototype.sub = Vec3.prototype.subtract;\nVec3.prototype.mul = Vec3.prototype.multiply;\nVec3.prototype.div = Vec3.prototype.divide;\nVec3.prototype.dist = Vec3.prototype.distance;\nVec3.prototype.sqrDist = Vec3.prototype.squaredDistance;\nVec3.sub = Vec3.subtract;\nVec3.mul = Vec3.multiply;\nVec3.div = Vec3.divide;\nVec3.dist = Vec3.distance;\nVec3.sqrDist = Vec3.squaredDistance;\nVec3.sqrLen = Vec3.squaredLength;\nVec3.mag = Vec3.magnitude;\nVec3.length = Vec3.magnitude;\nVec3.len = Vec3.magnitude;\nvar Vec4 = class _Vec4 extends Float32Array {\n  /**\n   * Create a {@link Vec4}.\n   *\n   * @category Constructor\n   */\n  constructor(...values) {\n    switch (values.length) {\n      case 4:\n        super(values);\n        break;\n      case 2:\n        super(values[0], values[1], 4);\n        break;\n      case 1: {\n        const v = values[0];\n        if (typeof v === \"number\") {\n          super([v, v, v, v]);\n        } else {\n          super(v, 0, 4);\n        }\n        break;\n      }\n      default:\n        super(4);\n        break;\n    }\n  }\n  // ============\n  // Accessors\n  // ============\n  // Getters and setters to make component access read better.\n  // These are likely to be a little bit slower than direct array access.\n  /**\n   * The x component of the vector. Equivalent to `this[0];`\n   * @category Vector Components\n   */\n  get x() {\n    return this[0];\n  }\n  set x(value) {\n    this[0] = value;\n  }\n  /**\n   * The y component of the vector. Equivalent to `this[1];`\n   * @category Vector Components\n   */\n  get y() {\n    return this[1];\n  }\n  set y(value) {\n    this[1] = value;\n  }\n  /**\n   * The z component of the vector. Equivalent to `this[2];`\n   * @category Vector Components\n   */\n  get z() {\n    return this[2];\n  }\n  set z(value) {\n    this[2] = value;\n  }\n  /**\n   * The w component of the vector. Equivalent to `this[3];`\n   * @category Vector Components\n   */\n  get w() {\n    return this[3];\n  }\n  set w(value) {\n    this[3] = value;\n  }\n  // Alternate set of getters and setters in case this is being used to define\n  // a color.\n  /**\n   * The r component of the vector. Equivalent to `this[0];`\n   * @category Color Components\n   */\n  get r() {\n    return this[0];\n  }\n  set r(value) {\n    this[0] = value;\n  }\n  /**\n   * The g component of the vector. Equivalent to `this[1];`\n   * @category Color Components\n   */\n  get g() {\n    return this[1];\n  }\n  set g(value) {\n    this[1] = value;\n  }\n  /**\n   * The b component of the vector. Equivalent to `this[2];`\n   * @category Color Components\n   */\n  get b() {\n    return this[2];\n  }\n  set b(value) {\n    this[2] = value;\n  }\n  /**\n   * The a component of the vector. Equivalent to `this[3];`\n   * @category Color Components\n   */\n  get a() {\n    return this[3];\n  }\n  set a(value) {\n    this[3] = value;\n  }\n  /**\n   * The magnitude (length) of this.\n   * Equivalent to `Vec4.magnitude(this);`\n   *\n   * Magnitude is used because the `length` attribute is already defined by\n   * TypedArrays to mean the number of elements in the array.\n   *\n   * @category Accessors\n   */\n  get magnitude() {\n    const x = this[0];\n    const y = this[1];\n    const z = this[2];\n    const w = this[3];\n    return Math.sqrt(x * x + y * y + z * z + w * w);\n  }\n  /**\n   * Alias for {@link Vec4.magnitude}\n   *\n   * @category Accessors\n   */\n  get mag() {\n    return this.magnitude;\n  }\n  /**\n   * A string representation of `this`\n   * Equivalent to `Vec4.str(this);`\n   *\n   * @category Accessors\n   */\n  get str() {\n    return _Vec4.str(this);\n  }\n  // ===================\n  // Instances methods\n  // ===================\n  /**\n   * Copy the values from another {@link Vec4} into `this`.\n   * @category Methods\n   *\n   * @param a the source vector\n   * @returns `this`\n   */\n  copy(a) {\n    super.set(a);\n    return this;\n  }\n  /**\n   * Adds a {@link Vec4} to `this`.\n   * Equivalent to `Vec4.add(this, this, b);`\n   * @category Methods\n   *\n   * @param b - The vector to add to `this`\n   * @returns `this`\n   */\n  add(b) {\n    this[0] += b[0];\n    this[1] += b[1];\n    this[2] += b[2];\n    this[3] += b[3];\n    return this;\n  }\n  /**\n   * Subtracts a {@link Vec4} from `this`.\n   * Equivalent to `Vec4.subtract(this, this, b);`\n   * @category Methods\n   *\n   * @param b - The vector to subtract from `this`\n   * @returns `this`\n   */\n  subtract(b) {\n    this[0] -= b[0];\n    this[1] -= b[1];\n    this[2] -= b[2];\n    this[3] -= b[3];\n    return this;\n  }\n  /**\n   * Alias for {@link Vec4.subtract}\n   * @category Methods\n   */\n  sub(b) {\n    return this;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Multiplies `this` by a {@link Vec4}.\n   * Equivalent to `Vec4.multiply(this, this, b);`\n   * @category Methods\n   *\n   * @param b - The vector to multiply `this` by\n   * @returns `this`\n   */\n  multiply(b) {\n    this[0] *= b[0];\n    this[1] *= b[1];\n    this[2] *= b[2];\n    this[3] *= b[3];\n    return this;\n  }\n  /**\n   * Alias for {@link Vec4.multiply}\n   * @category Methods\n   */\n  mul(b) {\n    return this;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Divides `this` by a {@link Vec4}.\n   * Equivalent to `Vec4.divide(this, this, b);`\n   * @category Methods\n   *\n   * @param b - The vector to divide `this` by\n   * @returns `this`\n   */\n  divide(b) {\n    this[0] /= b[0];\n    this[1] /= b[1];\n    this[2] /= b[2];\n    this[3] /= b[3];\n    return this;\n  }\n  /**\n   * Alias for {@link Vec4.divide}\n   * @category Methods\n   */\n  div(b) {\n    return this;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Scales `this` by a scalar number.\n   * Equivalent to `Vec4.scale(this, this, b);`\n   * @category Methods\n   *\n   * @param b - Amount to scale `this` by\n   * @returns `this`\n   */\n  scale(b) {\n    this[0] *= b;\n    this[1] *= b;\n    this[2] *= b;\n    this[3] *= b;\n    return this;\n  }\n  /**\n   * Calculates `this` scaled by a scalar value then adds the result to `this`.\n   * Equivalent to `Vec4.scaleAndAdd(this, this, b, scale);`\n   * @category Methods\n   *\n   * @param b - The vector to add to `this`\n   * @param scale - The amount to scale `b` by before adding\n   * @returns `this`\n   */\n  scaleAndAdd(b, scale) {\n    this[0] += b[0] * scale;\n    this[1] += b[1] * scale;\n    this[2] += b[2] * scale;\n    this[3] += b[3] * scale;\n    return this;\n  }\n  /**\n   * Calculates the Euclidean distance between another {@link Vec4} and `this`.\n   * Equivalent to `Vec4.distance(this, b);`\n   * @category Methods\n   *\n   * @param b - The vector to calculate the distance to\n   * @returns Distance between `this` and `b`\n   */\n  distance(b) {\n    return _Vec4.distance(this, b);\n  }\n  /**\n   * Alias for {@link Vec4.distance}\n   * @category Methods\n   */\n  dist(b) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Calculates the squared Euclidean distance between another {@link Vec4} and `this`.\n   * Equivalent to `Vec4.squaredDistance(this, b);`\n   * @category Methods\n   *\n   * @param b The vector to calculate the squared distance to\n   * @returns Squared distance between `this` and `b`\n   */\n  squaredDistance(b) {\n    return _Vec4.squaredDistance(this, b);\n  }\n  /**\n   * Alias for {@link Vec4.squaredDistance}\n   * @category Methods\n   */\n  sqrDist(b) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Negates the components of `this`.\n   * Equivalent to `Vec4.negate(this, this);`\n   * @category Methods\n   *\n   * @returns `this`\n   */\n  negate() {\n    this[0] *= -1;\n    this[1] *= -1;\n    this[2] *= -1;\n    this[3] *= -1;\n    return this;\n  }\n  /**\n   * Inverts the components of `this`.\n   * Equivalent to `Vec4.inverse(this, this);`\n   * @category Methods\n   *\n   * @returns `this`\n   */\n  invert() {\n    this[0] = 1 / this[0];\n    this[1] = 1 / this[1];\n    this[2] = 1 / this[2];\n    this[3] = 1 / this[3];\n    return this;\n  }\n  /**\n   * Sets each component of `this` to it's absolute value.\n   * Equivalent to `Vec4.abs(this, this);`\n   * @category Methods\n   *\n   * @returns `this`\n   */\n  abs() {\n    this[0] = Math.abs(this[0]);\n    this[1] = Math.abs(this[1]);\n    this[2] = Math.abs(this[2]);\n    this[3] = Math.abs(this[3]);\n    return this;\n  }\n  /**\n   * Calculates the dot product of this and another {@link Vec4}.\n   * Equivalent to `Vec4.dot(this, b);`\n   * @category Methods\n   *\n   * @param b - The second operand\n   * @returns Dot product of `this` and `b`\n   */\n  dot(b) {\n    return this[0] * b[0] + this[1] * b[1] + this[2] * b[2] + this[3] * b[3];\n  }\n  /**\n   * Normalize `this`.\n   * Equivalent to `Vec4.normalize(this, this);`\n   * @category Methods\n   *\n   * @returns `this`\n   */\n  normalize() {\n    return _Vec4.normalize(this, this);\n  }\n  // ===================\n  // Static accessors\n  // ===================\n  /**\n   * @category Static\n   *\n   * @returns The number of bytes in a {@link Vec4}.\n   */\n  static get BYTE_LENGTH() {\n    return 4 * Float32Array.BYTES_PER_ELEMENT;\n  }\n  // ===================\n  // Static methods\n  // ===================\n  /**\n   * Creates a new, empty {@link Vec4}\n   * @category Static\n   *\n   * @returns a new 4D vector\n   */\n  static create() {\n    return new _Vec4();\n  }\n  /**\n   * Creates a new {@link Vec4} initialized with values from an existing vector\n   * @category Static\n   *\n   * @param a - vector to clone\n   * @returns a new 4D vector\n   */\n  static clone(a) {\n    return new _Vec4(a);\n  }\n  /**\n   * Creates a new {@link Vec4} initialized with the given values\n   * @category Static\n   *\n   * @param x - X component\n   * @param y - Y component\n   * @param z - Z component\n   * @param w - W component\n   * @returns a new 4D vector\n   */\n  static fromValues(x, y, z, w) {\n    return new _Vec4(x, y, z, w);\n  }\n  /**\n   * Copy the values from one {@link Vec4} to another\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the source vector\n   * @returns `out`\n   */\n  static copy(out, a) {\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    return out;\n  }\n  /**\n   * Set the components of a {@link Vec4} to the given values\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param x - X component\n   * @param y - Y component\n   * @param z - Z component\n   * @param w - W component\n   * @returns `out`\n   */\n  static set(out, x, y, z, w) {\n    out[0] = x;\n    out[1] = y;\n    out[2] = z;\n    out[3] = w;\n    return out;\n  }\n  /**\n   * Adds two {@link Vec4}s\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param a - The first operand\n   * @param b - The second operand\n   * @returns `out`\n   */\n  static add(out, a, b) {\n    out[0] = a[0] + b[0];\n    out[1] = a[1] + b[1];\n    out[2] = a[2] + b[2];\n    out[3] = a[3] + b[3];\n    return out;\n  }\n  /**\n   * Subtracts vector b from vector a\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  static subtract(out, a, b) {\n    out[0] = a[0] - b[0];\n    out[1] = a[1] - b[1];\n    out[2] = a[2] - b[2];\n    out[3] = a[3] - b[3];\n    return out;\n  }\n  /**\n   * Alias for {@link Vec4.subtract}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static sub(out, a, b) {\n    return out;\n  }\n  /**\n   * Multiplies two {@link Vec4}'s\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  static multiply(out, a, b) {\n    out[0] = a[0] * b[0];\n    out[1] = a[1] * b[1];\n    out[2] = a[2] * b[2];\n    out[3] = a[3] * b[3];\n    return out;\n  }\n  /**\n   * Alias for {@link Vec4.multiply}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static mul(out, a, b) {\n    return out;\n  }\n  /**\n   * Divides two {@link Vec4}'s\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  static divide(out, a, b) {\n    out[0] = a[0] / b[0];\n    out[1] = a[1] / b[1];\n    out[2] = a[2] / b[2];\n    out[3] = a[3] / b[3];\n    return out;\n  }\n  /**\n   * Alias for {@link Vec4.divide}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static div(out, a, b) {\n    return out;\n  }\n  /**\n   * Math.ceil the components of a {@link Vec4}\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - vector to ceil\n   * @returns `out`\n   */\n  static ceil(out, a) {\n    out[0] = Math.ceil(a[0]);\n    out[1] = Math.ceil(a[1]);\n    out[2] = Math.ceil(a[2]);\n    out[3] = Math.ceil(a[3]);\n    return out;\n  }\n  /**\n   * Math.floor the components of a {@link Vec4}\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - vector to floor\n   * @returns `out`\n   */\n  static floor(out, a) {\n    out[0] = Math.floor(a[0]);\n    out[1] = Math.floor(a[1]);\n    out[2] = Math.floor(a[2]);\n    out[3] = Math.floor(a[3]);\n    return out;\n  }\n  /**\n   * Returns the minimum of two {@link Vec4}'s\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  static min(out, a, b) {\n    out[0] = Math.min(a[0], b[0]);\n    out[1] = Math.min(a[1], b[1]);\n    out[2] = Math.min(a[2], b[2]);\n    out[3] = Math.min(a[3], b[3]);\n    return out;\n  }\n  /**\n   * Returns the maximum of two {@link Vec4}'s\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  static max(out, a, b) {\n    out[0] = Math.max(a[0], b[0]);\n    out[1] = Math.max(a[1], b[1]);\n    out[2] = Math.max(a[2], b[2]);\n    out[3] = Math.max(a[3], b[3]);\n    return out;\n  }\n  /**\n   * Math.round the components of a {@link Vec4}\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - vector to round\n   * @returns `out`\n   */\n  static round(out, a) {\n    out[0] = Math.round(a[0]);\n    out[1] = Math.round(a[1]);\n    out[2] = Math.round(a[2]);\n    out[3] = Math.round(a[3]);\n    return out;\n  }\n  /**\n   * Scales a {@link Vec4} by a scalar number\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the vector to scale\n   * @param scale - amount to scale the vector by\n   * @returns `out`\n   */\n  static scale(out, a, scale) {\n    out[0] = a[0] * scale;\n    out[1] = a[1] * scale;\n    out[2] = a[2] * scale;\n    out[3] = a[3] * scale;\n    return out;\n  }\n  /**\n   * Adds two {@link Vec4}'s after scaling the second operand by a scalar value\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @param scale - the amount to scale b by before adding\n   * @returns `out`\n   */\n  static scaleAndAdd(out, a, b, scale) {\n    out[0] = a[0] + b[0] * scale;\n    out[1] = a[1] + b[1] * scale;\n    out[2] = a[2] + b[2] * scale;\n    out[3] = a[3] + b[3] * scale;\n    return out;\n  }\n  /**\n   * Calculates the Euclidean distance between two {@link Vec4}'s\n   * @category Static\n   *\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns distance between a and b\n   */\n  static distance(a, b) {\n    const x = b[0] - a[0];\n    const y = b[1] - a[1];\n    const z = b[2] - a[2];\n    const w = b[3] - a[3];\n    return Math.hypot(x, y, z, w);\n  }\n  /**\n   * Alias for {@link Vec4.distance}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static dist(a, b) {\n    return 0;\n  }\n  /**\n   * Calculates the squared Euclidean distance between two {@link Vec4}'s\n   * @category Static\n   *\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns squared distance between a and b\n   */\n  static squaredDistance(a, b) {\n    const x = b[0] - a[0];\n    const y = b[1] - a[1];\n    const z = b[2] - a[2];\n    const w = b[3] - a[3];\n    return x * x + y * y + z * z + w * w;\n  }\n  /**\n   * Alias for {@link Vec4.squaredDistance}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static sqrDist(a, b) {\n    return 0;\n  }\n  /**\n   * Calculates the magnitude (length) of a {@link Vec4}\n   * @category Static\n   *\n   * @param a - vector to calculate length of\n   * @returns length of `a`\n   */\n  static magnitude(a) {\n    const x = a[0];\n    const y = a[1];\n    const z = a[2];\n    const w = a[3];\n    return Math.sqrt(x * x + y * y + z * z + w * w);\n  }\n  /**\n   * Alias for {@link Vec4.magnitude}\n   * @category Static\n   */\n  static mag(a) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Alias for {@link Vec4.magnitude}\n   * @category Static\n   * @deprecated Use {@link Vec4.magnitude} to avoid conflicts with builtin `length` methods/attribs\n   */\n  // Length conflicts with Function.length\n  static length(a) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Alias for {@link Vec4.magnitude}\n   * @category Static\n   * @deprecated Use {@link Vec4.mag}\n   */\n  static len(a) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Calculates the squared length of a {@link Vec4}\n   * @category Static\n   *\n   * @param a - vector to calculate squared length of\n   * @returns squared length of a\n   */\n  static squaredLength(a) {\n    const x = a[0];\n    const y = a[1];\n    const z = a[2];\n    const w = a[3];\n    return x * x + y * y + z * z + w * w;\n  }\n  /**\n   * Alias for {@link Vec4.squaredLength}\n   * @category Static\n   */\n  static sqrLen(a) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Negates the components of a {@link Vec4}\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - vector to negate\n   * @returns `out`\n   */\n  static negate(out, a) {\n    out[0] = -a[0];\n    out[1] = -a[1];\n    out[2] = -a[2];\n    out[3] = -a[3];\n    return out;\n  }\n  /**\n   * Returns the inverse of the components of a {@link Vec4}\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - vector to invert\n   * @returns `out`\n   */\n  static inverse(out, a) {\n    out[0] = 1 / a[0];\n    out[1] = 1 / a[1];\n    out[2] = 1 / a[2];\n    out[3] = 1 / a[3];\n    return out;\n  }\n  /**\n   * Returns the absolute value of the components of a {@link Vec4}\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param a - Vector to compute the absolute values of\n   * @returns `out`\n   */\n  static abs(out, a) {\n    out[0] = Math.abs(a[0]);\n    out[1] = Math.abs(a[1]);\n    out[2] = Math.abs(a[2]);\n    out[3] = Math.abs(a[3]);\n    return out;\n  }\n  /**\n   * Normalize a {@link Vec4}\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - vector to normalize\n   * @returns `out`\n   */\n  static normalize(out, a) {\n    const x = a[0];\n    const y = a[1];\n    const z = a[2];\n    const w = a[3];\n    let len = x * x + y * y + z * z + w * w;\n    if (len > 0) {\n      len = 1 / Math.sqrt(len);\n    }\n    out[0] = x * len;\n    out[1] = y * len;\n    out[2] = z * len;\n    out[3] = w * len;\n    return out;\n  }\n  /**\n   * Calculates the dot product of two {@link Vec4}'s\n   * @category Static\n   *\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns dot product of a and b\n   */\n  static dot(a, b) {\n    return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\n  }\n  /**\n   * Returns the cross-product of three vectors in a 4-dimensional space\n   * @category Static\n   *\n   * @param out the receiving vector\n   * @param u - the first vector\n   * @param v - the second vector\n   * @param w - the third vector\n   * @returns result\n   */\n  static cross(out, u, v, w) {\n    const a = v[0] * w[1] - v[1] * w[0];\n    const b = v[0] * w[2] - v[2] * w[0];\n    const c = v[0] * w[3] - v[3] * w[0];\n    const d = v[1] * w[2] - v[2] * w[1];\n    const e = v[1] * w[3] - v[3] * w[1];\n    const f = v[2] * w[3] - v[3] * w[2];\n    const g = u[0];\n    const h = u[1];\n    const i = u[2];\n    const j = u[3];\n    out[0] = h * f - i * e + j * d;\n    out[1] = -(g * f) + i * c - j * b;\n    out[2] = g * e - h * c + j * a;\n    out[3] = -(g * d) + h * b - i * a;\n    return out;\n  }\n  /**\n   * Performs a linear interpolation between two {@link Vec4}'s\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the first operand\n   * @param b - the second operand\n   * @param t - interpolation amount, in the range [0-1], between the two inputs\n   * @returns `out`\n   */\n  static lerp(out, a, b, t) {\n    const ax = a[0];\n    const ay = a[1];\n    const az = a[2];\n    const aw = a[3];\n    out[0] = ax + t * (b[0] - ax);\n    out[1] = ay + t * (b[1] - ay);\n    out[2] = az + t * (b[2] - az);\n    out[3] = aw + t * (b[3] - aw);\n    return out;\n  }\n  /**\n   * Generates a random vector with the given scale\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param [scale] - Length of the resulting vector. If ommitted, a unit vector will be returned\n   * @returns `out`\n   */\n  /*\n      static random(out: Vec4Like, scale): Vec4Like {\n      scale = scale || 1.0;\n  \n      // Marsaglia, George. Choosing a Point from the Surface of a\n      // Sphere. Ann. Math. Statist. 43 (1972), no. 2, 645--646.\n      // http://projecteuclid.org/euclid.aoms/1177692644;\n      var v1, v2, v3, v4;\n      var s1, s2;\n      do {\n        v1 = glMatrix.RANDOM() * 2 - 1;\n        v2 = glMatrix.RANDOM() * 2 - 1;\n        s1 = v1 * v1 + v2 * v2;\n      } while (s1 >= 1);\n      do {\n        v3 = glMatrix.RANDOM() * 2 - 1;\n        v4 = glMatrix.RANDOM() * 2 - 1;\n        s2 = v3 * v3 + v4 * v4;\n      } while (s2 >= 1);\n  \n      var d = Math.sqrt((1 - s1) / s2);\n      out[0] = scale * v1;\n      out[1] = scale * v2;\n      out[2] = scale * v3 * d;\n      out[3] = scale * v4 * d;\n      return out;\n    }*/\n  /**\n   * Transforms the {@link Vec4} with a {@link Mat4}.\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the vector to transform\n   * @param m - matrix to transform with\n   * @returns `out`\n   */\n  static transformMat4(out, a, m) {\n    const x = a[0];\n    const y = a[1];\n    const z = a[2];\n    const w = a[3];\n    out[0] = m[0] * x + m[4] * y + m[8] * z + m[12] * w;\n    out[1] = m[1] * x + m[5] * y + m[9] * z + m[13] * w;\n    out[2] = m[2] * x + m[6] * y + m[10] * z + m[14] * w;\n    out[3] = m[3] * x + m[7] * y + m[11] * z + m[15] * w;\n    return out;\n  }\n  /**\n   * Transforms the {@link Vec4} with a {@link Quat}\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the vector to transform\n   * @param q - quaternion to transform with\n   * @returns `out`\n   */\n  static transformQuat(out, a, q) {\n    const x = a[0];\n    const y = a[1];\n    const z = a[2];\n    const qx = q[0];\n    const qy = q[1];\n    const qz = q[2];\n    const qw = q[3];\n    const ix = qw * x + qy * z - qz * y;\n    const iy = qw * y + qz * x - qx * z;\n    const iz = qw * z + qx * y - qy * x;\n    const iw = -qx * x - qy * y - qz * z;\n    out[0] = ix * qw + iw * -qx + iy * -qz - iz * -qy;\n    out[1] = iy * qw + iw * -qy + iz * -qx - ix * -qz;\n    out[2] = iz * qw + iw * -qz + ix * -qy - iy * -qx;\n    out[3] = a[3];\n    return out;\n  }\n  /**\n   * Set the components of a {@link Vec4} to zero\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @returns `out`\n   */\n  static zero(out) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    return out;\n  }\n  /**\n   * Returns a string representation of a {@link Vec4}\n   * @category Static\n   *\n   * @param a - vector to represent as a string\n   * @returns string representation of the vector\n   */\n  static str(a) {\n    return `Vec4(${a.join(\", \")})`;\n  }\n  /**\n   * Returns whether the vectors have exactly the same elements in the same position (when compared with ===)\n   * @category Static\n   *\n   * @param a - The first vector.\n   * @param b - The second vector.\n   * @returns True if the vectors are equal, false otherwise.\n   */\n  static exactEquals(a, b) {\n    return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n  }\n  /**\n   * Returns whether the vectors have approximately the same elements in the same position.\n   * @category Static\n   *\n   * @param a - The first vector.\n   * @param b - The second vector.\n   * @returns True if the vectors are equal, false otherwise.\n   */\n  static equals(a, b) {\n    const a0 = a[0];\n    const a1 = a[1];\n    const a2 = a[2];\n    const a3 = a[3];\n    const b0 = b[0];\n    const b1 = b[1];\n    const b2 = b[2];\n    const b3 = b[3];\n    return Math.abs(a0 - b0) <= GLM_EPSILON * Math.max(1, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= GLM_EPSILON * Math.max(1, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= GLM_EPSILON * Math.max(1, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= GLM_EPSILON * Math.max(1, Math.abs(a3), Math.abs(b3));\n  }\n};\nVec4.prototype.sub = Vec4.prototype.subtract;\nVec4.prototype.mul = Vec4.prototype.multiply;\nVec4.prototype.div = Vec4.prototype.divide;\nVec4.prototype.dist = Vec4.prototype.distance;\nVec4.prototype.sqrDist = Vec4.prototype.squaredDistance;\nVec4.sub = Vec4.subtract;\nVec4.mul = Vec4.multiply;\nVec4.div = Vec4.divide;\nVec4.dist = Vec4.distance;\nVec4.sqrDist = Vec4.squaredDistance;\nVec4.sqrLen = Vec4.squaredLength;\nVec4.mag = Vec4.magnitude;\nVec4.length = Vec4.magnitude;\nVec4.len = Vec4.magnitude;\nvar Quat = class _Quat extends Float32Array {\n  static #DEFAULT_ANGLE_ORDER = \"zyx\";\n  // Temporary variables to prevent repeated allocations in the algorithms within Quat.\n  // These are declared as TypedArrays to aid in tree-shaking.\n  static #TMP_QUAT1 = new Float32Array(4);\n  static #TMP_QUAT2 = new Float32Array(4);\n  static #TMP_MAT3 = new Float32Array(9);\n  static #TMP_VEC3 = new Float32Array(3);\n  static #X_UNIT_VEC3 = new Float32Array([1, 0, 0]);\n  static #Y_UNIT_VEC3 = new Float32Array([0, 1, 0]);\n  /**\n   * Create a {@link Quat}.\n   *\n   * @category Constructor\n   */\n  constructor(...values) {\n    switch (values.length) {\n      case 4:\n        super(values);\n        break;\n      case 2:\n        super(values[0], values[1], 4);\n        break;\n      case 1: {\n        const v = values[0];\n        if (typeof v === \"number\") {\n          super([v, v, v, v]);\n        } else {\n          super(v, 0, 4);\n        }\n        break;\n      }\n      default:\n        super(4);\n        this[3] = 1;\n        break;\n    }\n  }\n  // ============\n  // Accessors\n  // ============\n  // Getters and setters to make component access read better.\n  // These are likely to be a little bit slower than direct array access.\n  /**\n   * The x component of the quaternion. Equivalent to `this[0];`\n   * @category Quaternion Components\n   */\n  get x() {\n    return this[0];\n  }\n  set x(value) {\n    this[0] = value;\n  }\n  /**\n   * The y component of the quaternion. Equivalent to `this[1];`\n   * @category Quaternion Components\n   */\n  get y() {\n    return this[1];\n  }\n  set y(value) {\n    this[1] = value;\n  }\n  /**\n   * The z component of the quaternion. Equivalent to `this[2];`\n   * @category Quaternion Components\n   */\n  get z() {\n    return this[2];\n  }\n  set z(value) {\n    this[2] = value;\n  }\n  /**\n   * The w component of the quaternion. Equivalent to `this[3];`\n   * @category Quaternion Components\n   */\n  get w() {\n    return this[3];\n  }\n  set w(value) {\n    this[3] = value;\n  }\n  /**\n   * The magnitude (length) of this.\n   * Equivalent to `Quat.magnitude(this);`\n   *\n   * Magnitude is used because the `length` attribute is already defined by\n   * TypedArrays to mean the number of elements in the array.\n   *\n   * @category Accessors\n   */\n  get magnitude() {\n    const x = this[0];\n    const y = this[1];\n    const z = this[2];\n    const w = this[3];\n    return Math.sqrt(x * x + y * y + z * z + w * w);\n  }\n  /**\n   * Alias for {@link Quat.magnitude}\n   *\n   * @category Accessors\n   */\n  get mag() {\n    return this.magnitude;\n  }\n  /**\n   * A string representation of `this`\n   * Equivalent to `Quat.str(this);`\n   *\n   * @category Accessors\n   */\n  get str() {\n    return _Quat.str(this);\n  }\n  // ===================\n  // Instances methods\n  // ===================\n  /**\n   * Copy the values from another {@link Quat} into `this`.\n   * @category Methods\n   *\n   * @param a the source quaternion\n   * @returns `this`\n   */\n  copy(a) {\n    super.set(a);\n    return this;\n  }\n  /**\n   * Set `this` to the identity quaternion\n   * Equivalent to Quat.identity(this)\n   * @category Methods\n   *\n   * @returns `this`\n   */\n  identity() {\n    this[0] = 0;\n    this[1] = 0;\n    this[2] = 0;\n    this[3] = 1;\n    return this;\n  }\n  /**\n   * Multiplies `this` by a {@link Quat}.\n   * Equivalent to `Quat.multiply(this, this, b);`\n   * @category Methods\n   *\n   * @param b - The vector to multiply `this` by\n   * @returns `this`\n   */\n  multiply(b) {\n    return _Quat.multiply(this, this, b);\n  }\n  /**\n   * Alias for {@link Quat.multiply}\n   * @category Methods\n   */\n  mul(b) {\n    return this;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Rotates `this` by the given angle about the X axis\n   * Equivalent to `Quat.rotateX(this, this, rad);`\n   * @category Methods\n   *\n   * @param rad - angle (in radians) to rotate\n   * @returns `this`\n   */\n  rotateX(rad) {\n    return _Quat.rotateX(this, this, rad);\n  }\n  /**\n   * Rotates `this` by the given angle about the Y axis\n   * Equivalent to `Quat.rotateY(this, this, rad);`\n   * @category Methods\n   *\n   * @param rad - angle (in radians) to rotate\n   * @returns `this`\n   */\n  rotateY(rad) {\n    return _Quat.rotateY(this, this, rad);\n  }\n  /**\n   * Rotates `this` by the given angle about the Z axis\n   * Equivalent to `Quat.rotateZ(this, this, rad);`\n   * @category Methods\n   *\n   * @param rad - angle (in radians) to rotate\n   * @returns `this`\n   */\n  rotateZ(rad) {\n    return _Quat.rotateZ(this, this, rad);\n  }\n  /**\n   * Inverts `this`\n   * Equivalent to `Quat.invert(this, this);`\n   * @category Methods\n   *\n   * @returns `this`\n   */\n  invert() {\n    return _Quat.invert(this, this);\n  }\n  /**\n   * Scales `this` by a scalar number\n   * Equivalent to `Quat.scale(this, this, scale);`\n   * @category Methods\n   *\n   * @param scale - amount to scale the vector by\n   * @returns `this`\n   */\n  scale(scale) {\n    this[0] *= scale;\n    this[1] *= scale;\n    this[2] *= scale;\n    this[3] *= scale;\n    return this;\n  }\n  /**\n   * Calculates the dot product of `this` and another {@link Quat}\n   * Equivalent to `Quat.dot(this, b);`\n   * @category Methods\n   *\n   * @param b - the second operand\n   * @returns dot product of `this` and b\n   */\n  dot(b) {\n    return _Quat.dot(this, b);\n  }\n  // ===================\n  // Static accessors\n  // ===================\n  /**\n   * @category Static\n   *\n   * @returns The number of bytes in a {@link Quat}.\n   */\n  static get BYTE_LENGTH() {\n    return 4 * Float32Array.BYTES_PER_ELEMENT;\n  }\n  // ===================\n  // Static methods\n  // ===================\n  /**\n   * Creates a new identity quat\n   * @category Static\n   *\n   * @returns a new quaternion\n   */\n  static create() {\n    return new _Quat();\n  }\n  /**\n   * Set a quat to the identity quaternion\n   * @category Static\n   *\n   * @param out - the receiving quaternion\n   * @returns `out`\n   */\n  static identity(out) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 1;\n    return out;\n  }\n  /**\n   * Sets a quat from the given angle and rotation axis,\n   * then returns it.\n   * @category Static\n   *\n   * @param out - the receiving quaternion\n   * @param axis - the axis around which to rotate\n   * @param rad - the angle in radians\n   * @returns `out`\n   **/\n  static setAxisAngle(out, axis, rad) {\n    rad *= 0.5;\n    const s = Math.sin(rad);\n    out[0] = s * axis[0];\n    out[1] = s * axis[1];\n    out[2] = s * axis[2];\n    out[3] = Math.cos(rad);\n    return out;\n  }\n  /**\n   * Gets the rotation axis and angle for a given\n   *  quaternion. If a quaternion is created with\n   *  setAxisAngle, this method will return the same\n   *  values as provided in the original parameter list\n   *  OR functionally equivalent values.\n   * Example: The quaternion formed by axis [0, 0, 1] and\n   *  angle -90 is the same as the quaternion formed by\n   *  [0, 0, 1] and 270. This method favors the latter.\n   * @category Static\n   *\n   * @param out_axis - Vector receiving the axis of rotation\n   * @param q - Quaternion to be decomposed\n   * @return Angle, in radians, of the rotation\n   */\n  static getAxisAngle(out_axis, q) {\n    const rad = Math.acos(q[3]) * 2;\n    const s = Math.sin(rad / 2);\n    if (s > GLM_EPSILON) {\n      out_axis[0] = q[0] / s;\n      out_axis[1] = q[1] / s;\n      out_axis[2] = q[2] / s;\n    } else {\n      out_axis[0] = 1;\n      out_axis[1] = 0;\n      out_axis[2] = 0;\n    }\n    return rad;\n  }\n  /**\n   * Gets the angular distance between two unit quaternions\n   * @category Static\n   *\n   * @param  {ReadonlyQuat} a     Origin unit quaternion\n   * @param  {ReadonlyQuat} b     Destination unit quaternion\n   * @return {Number}     Angle, in radians, between the two quaternions\n   */\n  static getAngle(a, b) {\n    const dotproduct = _Quat.dot(a, b);\n    return Math.acos(2 * dotproduct * dotproduct - 1);\n  }\n  /**\n   * Multiplies two quaternions.\n   * @category Static\n   *\n   * @param out - the receiving quaternion\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  static multiply(out, a, b) {\n    const ax = a[0];\n    const ay = a[1];\n    const az = a[2];\n    const aw = a[3];\n    const bx = b[0];\n    const by = b[1];\n    const bz = b[2];\n    const bw = b[3];\n    out[0] = ax * bw + aw * bx + ay * bz - az * by;\n    out[1] = ay * bw + aw * by + az * bx - ax * bz;\n    out[2] = az * bw + aw * bz + ax * by - ay * bx;\n    out[3] = aw * bw - ax * bx - ay * by - az * bz;\n    return out;\n  }\n  /**\n   * Rotates a quaternion by the given angle about the X axis\n   * @category Static\n   *\n   * @param out - quat receiving operation result\n   * @param a - quat to rotate\n   * @param rad - angle (in radians) to rotate\n   * @returns `out`\n   */\n  static rotateX(out, a, rad) {\n    rad *= 0.5;\n    const ax = a[0];\n    const ay = a[1];\n    const az = a[2];\n    const aw = a[3];\n    const bx = Math.sin(rad);\n    const bw = Math.cos(rad);\n    out[0] = ax * bw + aw * bx;\n    out[1] = ay * bw + az * bx;\n    out[2] = az * bw - ay * bx;\n    out[3] = aw * bw - ax * bx;\n    return out;\n  }\n  /**\n   * Rotates a quaternion by the given angle about the Y axis\n   * @category Static\n   *\n   * @param out - quat receiving operation result\n   * @param a - quat to rotate\n   * @param rad - angle (in radians) to rotate\n   * @returns `out`\n   */\n  static rotateY(out, a, rad) {\n    rad *= 0.5;\n    const ax = a[0];\n    const ay = a[1];\n    const az = a[2];\n    const aw = a[3];\n    const by = Math.sin(rad);\n    const bw = Math.cos(rad);\n    out[0] = ax * bw - az * by;\n    out[1] = ay * bw + aw * by;\n    out[2] = az * bw + ax * by;\n    out[3] = aw * bw - ay * by;\n    return out;\n  }\n  /**\n   * Rotates a quaternion by the given angle about the Z axis\n   * @category Static\n   *\n   * @param out - quat receiving operation result\n   * @param a - quat to rotate\n   * @param rad - angle (in radians) to rotate\n   * @returns `out`\n   */\n  static rotateZ(out, a, rad) {\n    rad *= 0.5;\n    const ax = a[0];\n    const ay = a[1];\n    const az = a[2];\n    const aw = a[3];\n    const bz = Math.sin(rad);\n    const bw = Math.cos(rad);\n    out[0] = ax * bw + ay * bz;\n    out[1] = ay * bw - ax * bz;\n    out[2] = az * bw + aw * bz;\n    out[3] = aw * bw - az * bz;\n    return out;\n  }\n  /**\n   * Calculates the W component of a quat from the X, Y, and Z components.\n   * Assumes that quaternion is 1 unit in length.\n   * Any existing W component will be ignored.\n   * @category Static\n   *\n   * @param out - the receiving quaternion\n   * @param a - quat to calculate W component of\n   * @returns `out`\n   */\n  static calculateW(out, a) {\n    const x = a[0], y = a[1], z = a[2];\n    out[0] = x;\n    out[1] = y;\n    out[2] = z;\n    out[3] = Math.sqrt(Math.abs(1 - x * x - y * y - z * z));\n    return out;\n  }\n  /**\n   * Calculate the exponential of a unit quaternion.\n   * @category Static\n   *\n   * @param out - the receiving quaternion\n   * @param a - quat to calculate the exponential of\n   * @returns `out`\n   */\n  static exp(out, a) {\n    const x = a[0], y = a[1], z = a[2], w = a[3];\n    const r = Math.sqrt(x * x + y * y + z * z);\n    const et = Math.exp(w);\n    const s = r > 0 ? et * Math.sin(r) / r : 0;\n    out[0] = x * s;\n    out[1] = y * s;\n    out[2] = z * s;\n    out[3] = et * Math.cos(r);\n    return out;\n  }\n  /**\n   * Calculate the natural logarithm of a unit quaternion.\n   * @category Static\n   *\n   * @param out - the receiving quaternion\n   * @param a - quat to calculate the exponential of\n   * @returns `out`\n   */\n  static ln(out, a) {\n    const x = a[0], y = a[1], z = a[2], w = a[3];\n    const r = Math.sqrt(x * x + y * y + z * z);\n    const t = r > 0 ? Math.atan2(r, w) / r : 0;\n    out[0] = x * t;\n    out[1] = y * t;\n    out[2] = z * t;\n    out[3] = 0.5 * Math.log(x * x + y * y + z * z + w * w);\n    return out;\n  }\n  /**\n   * Calculate the scalar power of a unit quaternion.\n   * @category Static\n   *\n   * @param out - the receiving quaternion\n   * @param a - quat to calculate the exponential of\n   * @param b - amount to scale the quaternion by\n   * @returns `out`\n   */\n  static pow(out, a, b) {\n    _Quat.ln(out, a);\n    _Quat.scale(out, out, b);\n    _Quat.exp(out, out);\n    return out;\n  }\n  /**\n   * Performs a spherical linear interpolation between two quat\n   * @category Static\n   *\n   * @param out - the receiving quaternion\n   * @param a - the first operand\n   * @param b - the second operand\n   * @param t - interpolation amount, in the range [0-1], between the two inputs\n   * @returns `out`\n   */\n  static slerp(out, a, b, t) {\n    const ax = a[0], ay = a[1], az = a[2], aw = a[3];\n    let bx = b[0], by = b[1], bz = b[2], bw = b[3];\n    let scale0;\n    let scale1;\n    let cosom = ax * bx + ay * by + az * bz + aw * bw;\n    if (cosom < 0) {\n      cosom = -cosom;\n      bx = -bx;\n      by = -by;\n      bz = -bz;\n      bw = -bw;\n    }\n    if (1 - cosom > GLM_EPSILON) {\n      const omega = Math.acos(cosom);\n      const sinom = Math.sin(omega);\n      scale0 = Math.sin((1 - t) * omega) / sinom;\n      scale1 = Math.sin(t * omega) / sinom;\n    } else {\n      scale0 = 1 - t;\n      scale1 = t;\n    }\n    out[0] = scale0 * ax + scale1 * bx;\n    out[1] = scale0 * ay + scale1 * by;\n    out[2] = scale0 * az + scale1 * bz;\n    out[3] = scale0 * aw + scale1 * bw;\n    return out;\n  }\n  /**\n   * Generates a random unit quaternion\n   * @category Static\n   *\n   * @param out - the receiving quaternion\n   * @returns `out`\n   */\n  /* static random(out: QuatLike): QuatLike {\n      // Implementation of http://planning.cs.uiuc.edu/node198.html\n      // TODO: Calling random 3 times is probably not the fastest solution\n      let u1 = glMatrix.RANDOM();\n      let u2 = glMatrix.RANDOM();\n      let u3 = glMatrix.RANDOM();\n  \n      let sqrt1MinusU1 = Math.sqrt(1 - u1);\n      let sqrtU1 = Math.sqrt(u1);\n  \n      out[0] = sqrt1MinusU1 * Math.sin(2.0 * Math.PI * u2);\n      out[1] = sqrt1MinusU1 * Math.cos(2.0 * Math.PI * u2);\n      out[2] = sqrtU1 * Math.sin(2.0 * Math.PI * u3);\n      out[3] = sqrtU1 * Math.cos(2.0 * Math.PI * u3);\n      return out;\n    }*/\n  /**\n   * Calculates the inverse of a quat\n   * @category Static\n   *\n   * @param out - the receiving quaternion\n   * @param a - quat to calculate inverse of\n   * @returns `out`\n   */\n  static invert(out, a) {\n    const a0 = a[0], a1 = a[1], a2 = a[2], a3 = a[3];\n    const dot = a0 * a0 + a1 * a1 + a2 * a2 + a3 * a3;\n    const invDot = dot ? 1 / dot : 0;\n    out[0] = -a0 * invDot;\n    out[1] = -a1 * invDot;\n    out[2] = -a2 * invDot;\n    out[3] = a3 * invDot;\n    return out;\n  }\n  /**\n   * Calculates the conjugate of a quat\n   * If the quaternion is normalized, this function is faster than `quat.inverse` and produces the same result.\n   * @category Static\n   *\n   * @param out - the receiving quaternion\n   * @param a - quat to calculate conjugate of\n   * @returns `out`\n   */\n  static conjugate(out, a) {\n    out[0] = -a[0];\n    out[1] = -a[1];\n    out[2] = -a[2];\n    out[3] = a[3];\n    return out;\n  }\n  /**\n   * Creates a quaternion from the given 3x3 rotation matrix.\n   *\n   * NOTE: The resultant quaternion is not normalized, so you should be sure\n   * to re-normalize the quaternion yourself where necessary.\n   * @category Static\n   *\n   * @param out - the receiving quaternion\n   * @param m - rotation matrix\n   * @returns `out`\n   */\n  static fromMat3(out, m) {\n    const fTrace = m[0] + m[4] + m[8];\n    let fRoot;\n    if (fTrace > 0) {\n      fRoot = Math.sqrt(fTrace + 1);\n      out[3] = 0.5 * fRoot;\n      fRoot = 0.5 / fRoot;\n      out[0] = (m[5] - m[7]) * fRoot;\n      out[1] = (m[6] - m[2]) * fRoot;\n      out[2] = (m[1] - m[3]) * fRoot;\n    } else {\n      let i = 0;\n      if (m[4] > m[0]) {\n        i = 1;\n      }\n      if (m[8] > m[i * 3 + i]) {\n        i = 2;\n      }\n      const j = (i + 1) % 3;\n      const k = (i + 2) % 3;\n      fRoot = Math.sqrt(m[i * 3 + i] - m[j * 3 + j] - m[k * 3 + k] + 1);\n      out[i] = 0.5 * fRoot;\n      fRoot = 0.5 / fRoot;\n      out[3] = (m[j * 3 + k] - m[k * 3 + j]) * fRoot;\n      out[j] = (m[j * 3 + i] + m[i * 3 + j]) * fRoot;\n      out[k] = (m[k * 3 + i] + m[i * 3 + k]) * fRoot;\n    }\n    return out;\n  }\n  /**\n   * Creates a quaternion from the given euler angle x, y, z.\n   * @category Static\n   *\n   * @param out - the receiving quaternion\n   * @param x - Angle to rotate around X axis in degrees.\n   * @param y - Angle to rotate around Y axis in degrees.\n   * @param z - Angle to rotate around Z axis in degrees.\n   * @param {'xyz'|'xzy'|'yxz'|'yzx'|'zxy'|'zyx'} order - Intrinsic order for conversion, default is zyx.\n   * @returns `out`\n   */\n  static fromEuler(out, x, y, z, order = _Quat.#DEFAULT_ANGLE_ORDER) {\n    const halfToRad = 0.5 * Math.PI / 180;\n    x *= halfToRad;\n    y *= halfToRad;\n    z *= halfToRad;\n    const sx = Math.sin(x);\n    const cx = Math.cos(x);\n    const sy = Math.sin(y);\n    const cy = Math.cos(y);\n    const sz = Math.sin(z);\n    const cz = Math.cos(z);\n    switch (order) {\n      case \"xyz\":\n        out[0] = sx * cy * cz + cx * sy * sz;\n        out[1] = cx * sy * cz - sx * cy * sz;\n        out[2] = cx * cy * sz + sx * sy * cz;\n        out[3] = cx * cy * cz - sx * sy * sz;\n        break;\n      case \"xzy\":\n        out[0] = sx * cy * cz - cx * sy * sz;\n        out[1] = cx * sy * cz - sx * cy * sz;\n        out[2] = cx * cy * sz + sx * sy * cz;\n        out[3] = cx * cy * cz + sx * sy * sz;\n        break;\n      case \"yxz\":\n        out[0] = sx * cy * cz + cx * sy * sz;\n        out[1] = cx * sy * cz - sx * cy * sz;\n        out[2] = cx * cy * sz - sx * sy * cz;\n        out[3] = cx * cy * cz + sx * sy * sz;\n        break;\n      case \"yzx\":\n        out[0] = sx * cy * cz + cx * sy * sz;\n        out[1] = cx * sy * cz + sx * cy * sz;\n        out[2] = cx * cy * sz - sx * sy * cz;\n        out[3] = cx * cy * cz - sx * sy * sz;\n        break;\n      case \"zxy\":\n        out[0] = sx * cy * cz - cx * sy * sz;\n        out[1] = cx * sy * cz + sx * cy * sz;\n        out[2] = cx * cy * sz + sx * sy * cz;\n        out[3] = cx * cy * cz - sx * sy * sz;\n        break;\n      case \"zyx\":\n        out[0] = sx * cy * cz - cx * sy * sz;\n        out[1] = cx * sy * cz + sx * cy * sz;\n        out[2] = cx * cy * sz - sx * sy * cz;\n        out[3] = cx * cy * cz + sx * sy * sz;\n        break;\n      default:\n        throw new Error(`Unknown angle order ${order}`);\n    }\n    return out;\n  }\n  /**\n   * Returns a string representation of a quatenion\n   * @category Static\n   *\n   * @param a - vector to represent as a string\n   * @returns string representation of the vector\n   */\n  static str(a) {\n    return `Quat(${a.join(\", \")})`;\n  }\n  /**\n   * Creates a new quat initialized with values from an existing quaternion\n   * @category Static\n   *\n   * @param a - quaternion to clone\n   * @returns a new quaternion\n   */\n  static clone(a) {\n    return new _Quat(a);\n  }\n  /**\n   * Creates a new quat initialized with the given values\n   * @category Static\n   *\n   * @param x - X component\n   * @param y - Y component\n   * @param z - Z component\n   * @param w - W component\n   * @returns a new quaternion\n   */\n  static fromValues(x, y, z, w) {\n    return new _Quat(x, y, z, w);\n  }\n  /**\n   * Copy the values from one quat to another\n   * @category Static\n   *\n   * @param out - the receiving quaternion\n   * @param a - the source quaternion\n   * @returns `out`\n   */\n  static copy(out, a) {\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    return out;\n  }\n  /**\n   * Set the components of a {@link Quat} to the given values\n   * @category Static\n   *\n   * @param out - the receiving quaternion\n   * @param x - X component\n   * @param y - Y component\n   * @param z - Z component\n   * @param w - W component\n   * @returns `out`\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static set(out, x, y, z, w) {\n    return out;\n  }\n  /**\n   * Adds two {@link Quat}'s\n   * @category Static\n   *\n   * @param out - the receiving quaternion\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static add(out, a, b) {\n    return out;\n  }\n  /**\n   * Alias for {@link Quat.multiply}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static mul(out, a, b) {\n    return out;\n  }\n  /**\n   * Scales a quat by a scalar number\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - the vector to scale\n   * @param b - amount to scale the vector by\n   * @returns `out`\n   */\n  static scale(out, a, scale) {\n    out[0] = a[0] * scale;\n    out[1] = a[1] * scale;\n    out[2] = a[2] * scale;\n    out[3] = a[3] * scale;\n    return out;\n  }\n  /**\n   * Calculates the dot product of two quat's\n   * @category Static\n   *\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns dot product of a and b\n   */\n  static dot(a, b) {\n    return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\n  }\n  /**\n   * Performs a linear interpolation between two quat's\n   * @category Static\n   *\n   * @param out - the receiving quaternion\n   * @param a - the first operand\n   * @param b - the second operand\n   * @param t - interpolation amount, in the range [0-1], between the two inputs\n   * @returns `out`\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static lerp(out, a, b, t) {\n    return out;\n  }\n  /**\n   * Calculates the magnitude (length) of a {@link Quat}\n   * @category Static\n   *\n   * @param a - quaternion to calculate length of\n   * @returns length of `a`\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static magnitude(a) {\n    return 0;\n  }\n  /**\n   * Alias for {@link Quat.magnitude}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static mag(a) {\n    return 0;\n  }\n  /**\n   * Alias for {@link Quat.magnitude}\n   * @category Static\n   * @deprecated Use {@link Quat.magnitude} to avoid conflicts with builtin `length` methods/attribs\n   */\n  // Length conflicts with Function.length\n  static length(a) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Alias for {@link Quat.magnitude}\n   * @category Static\n   * @deprecated Use {@link Quat.mag}\n   */\n  static len(a) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Calculates the squared length of a {@link Quat}\n   * @category Static\n   *\n   * @param a - quaternion to calculate squared length of\n   * @returns squared length of a\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static squaredLength(a) {\n    return 0;\n  }\n  /**\n   * Alias for {@link Quat.squaredLength}\n   * @category Static\n   */\n  static sqrLen(a) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Normalize a {@link Quat}\n   * @category Static\n   *\n   * @param out - the receiving quaternion\n   * @param a - quaternion to normalize\n   * @returns `out`\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static normalize(out, a) {\n    return out;\n  }\n  /**\n   * Returns whether the quaternions have exactly the same elements in the same position (when compared with ===)\n   * @category Static\n   *\n   * @param a - The first quaternion.\n   * @param b - The second quaternion.\n   * @returns True if the vectors are equal, false otherwise.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static exactEquals(a, b) {\n    return false;\n  }\n  /**\n   * Returns whether the quaternions have approximately the same elements in the same position.\n   * @category Static\n   *\n   * @param a - The first vector.\n   * @param b - The second vector.\n   * @returns True if the vectors are equal, false otherwise.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static equals(a, b) {\n    return false;\n  }\n  /**\n   * Sets a quaternion to represent the shortest rotation from one\n   * vector to another.\n   *\n   * Both vectors are assumed to be unit length.\n   * @category Static\n   *\n   * @param out - the receiving quaternion.\n   * @param a - the initial vector\n   * @param b - the destination vector\n   * @returns `out`\n   */\n  static rotationTo(out, a, b) {\n    const dot = Vec3.dot(a, b);\n    if (dot < -0.999999) {\n      Vec3.cross(_Quat.#TMP_VEC3, _Quat.#X_UNIT_VEC3, a);\n      if (Vec3.mag(_Quat.#TMP_VEC3) < 1e-6) {\n        Vec3.cross(_Quat.#TMP_VEC3, _Quat.#Y_UNIT_VEC3, a);\n      }\n      Vec3.normalize(_Quat.#TMP_VEC3, _Quat.#TMP_VEC3);\n      _Quat.setAxisAngle(out, _Quat.#TMP_VEC3, Math.PI);\n      return out;\n    } else if (dot > 0.999999) {\n      out[0] = 0;\n      out[1] = 0;\n      out[2] = 0;\n      out[3] = 1;\n      return out;\n    } else {\n      Vec3.cross(_Quat.#TMP_VEC3, a, b);\n      out[0] = _Quat.#TMP_VEC3[0];\n      out[1] = _Quat.#TMP_VEC3[1];\n      out[2] = _Quat.#TMP_VEC3[2];\n      out[3] = 1 + dot;\n      return _Quat.normalize(out, out);\n    }\n  }\n  /**\n   * Performs a spherical linear interpolation with two control points\n   * @category Static\n   *\n   * @param out - the receiving quaternion\n   * @param a - the first operand\n   * @param b - the second operand\n   * @param c - the third operand\n   * @param d - the fourth operand\n   * @param t - interpolation amount, in the range [0-1], between the two inputs\n   * @returns `out`\n   */\n  static sqlerp(out, a, b, c, d, t) {\n    _Quat.slerp(_Quat.#TMP_QUAT1, a, d, t);\n    _Quat.slerp(_Quat.#TMP_QUAT2, b, c, t);\n    _Quat.slerp(out, _Quat.#TMP_QUAT1, _Quat.#TMP_QUAT2, 2 * t * (1 - t));\n    return out;\n  }\n  /**\n   * Sets the specified quaternion with values corresponding to the given\n   * axes. Each axis is a vec3 and is expected to be unit length and\n   * perpendicular to all other specified axes.\n   * @category Static\n   *\n   * @param out - The receiving quaternion\n   * @param view - the vector representing the viewing direction\n   * @param right - the vector representing the local `right` direction\n   * @param up - the vector representing the local `up` direction\n   * @returns `out`\n   */\n  static setAxes(out, view, right, up) {\n    _Quat.#TMP_MAT3[0] = right[0];\n    _Quat.#TMP_MAT3[3] = right[1];\n    _Quat.#TMP_MAT3[6] = right[2];\n    _Quat.#TMP_MAT3[1] = up[0];\n    _Quat.#TMP_MAT3[4] = up[1];\n    _Quat.#TMP_MAT3[7] = up[2];\n    _Quat.#TMP_MAT3[2] = -view[0];\n    _Quat.#TMP_MAT3[5] = -view[1];\n    _Quat.#TMP_MAT3[8] = -view[2];\n    return _Quat.normalize(out, _Quat.fromMat3(out, _Quat.#TMP_MAT3));\n  }\n};\nQuat.set = Vec4.set;\nQuat.add = Vec4.add;\nQuat.lerp = Vec4.lerp;\nQuat.normalize = Vec4.normalize;\nQuat.squaredLength = Vec4.squaredLength;\nQuat.sqrLen = Vec4.squaredLength;\nQuat.exactEquals = Vec4.exactEquals;\nQuat.equals = Vec4.equals;\nQuat.magnitude = Vec4.magnitude;\nQuat.prototype.mul = Quat.prototype.multiply;\nQuat.mul = Quat.multiply;\nQuat.mag = Quat.magnitude;\nQuat.length = Quat.magnitude;\nQuat.len = Quat.magnitude;\nvar Quat2 = class _Quat2 extends Float32Array {\n  // Temporary variables to prevent repeated allocations in the algorithms within Quat2.\n  // These are declared as TypedArrays to aid in tree-shaking.\n  static #TMP_QUAT = new Float32Array(4);\n  static #TMP_VEC3 = new Float32Array(3);\n  /**\n   * Create a {@link Quat2}.\n   *\n   * @category Constructor\n   */\n  constructor(...values) {\n    switch (values.length) {\n      case 8:\n        super(values);\n        break;\n      case 2:\n        super(values[0], values[1], 8);\n        break;\n      case 1: {\n        const v = values[0];\n        if (typeof v === \"number\") {\n          super([v, v, v, v, v, v, v, v]);\n        } else {\n          super(v, 0, 8);\n        }\n        break;\n      }\n      default:\n        super(8);\n        this[3] = 1;\n        break;\n    }\n  }\n  // ============\n  // Accessors\n  // ============\n  /**\n   * A string representation of `this`\n   * Equivalent to `Quat2.str(this);`\n   *\n   * @category Accessors\n   */\n  get str() {\n    return _Quat2.str(this);\n  }\n  // ===================\n  // Instances methods\n  // ===================\n  /**\n   * Copy the values from another {@link Quat2} into `this`.\n   * @category Methods\n   *\n   * @param a the source dual quaternion\n   * @returns `this`\n   */\n  copy(a) {\n    super.set(a);\n    return this;\n  }\n  // ===================\n  // Static accessors\n  // ===================\n  /**\n   * @category Static\n   *\n   * @returns The number of bytes in a {@link Quat2}.\n   */\n  static get BYTE_LENGTH() {\n    return 8 * Float32Array.BYTES_PER_ELEMENT;\n  }\n  // ===================\n  // Static methods\n  // ===================\n  /**\n   * Creates a new identity {@link Quat2}\n   * @category Static\n   *\n   * @returns a new dual quaternion [real -> rotation, dual -> translation]\n   */\n  static create() {\n    return new _Quat2();\n  }\n  /**\n   * Creates a {@link Quat2} quat initialized with values from an existing quaternion\n   * @category Static\n   *\n   * @param a - dual quaternion to clone\n   * @returns a new dual quaternion\n   */\n  static clone(a) {\n    return new _Quat2(a);\n  }\n  /**\n   * Creates a new {@link Quat2}  initialized with the given values\n   * @category Static\n   *\n   * @param x1 - 1st X component\n   * @param y1 - 1st Y component\n   * @param z1 - 1st Z component\n   * @param w1 - 1st W component\n   * @param x2 - 2nd X component\n   * @param y2 - 2nd Y component\n   * @param z2 - 2nd Z component\n   * @param w2 - 2nd W component\n   * @returns a new dual quaternion\n   */\n  static fromValues(x1, y1, z1, w1, x2, y2, z2, w2) {\n    return new _Quat2(x1, y1, z1, w1, x2, y2, z2, w2);\n  }\n  /**\n   * Creates a new {@link Quat2} from the given values (quat and translation)\n   * @category Static\n   *\n   * @param x1 - X component (rotation)\n   * @param y1 - Y component (rotation)\n   * @param z1 - Z component (rotation)\n   * @param w1 - W component (rotation)\n   * @param x2 - X component (translation)\n   * @param y2 - Y component (translation)\n   * @param z2 - Z component (translation)\n   * @returns a new dual quaternion\n   */\n  static fromRotationTranslationValues(x1, y1, z1, w1, x2, y2, z2) {\n    const ax = x2 * 0.5;\n    const ay = y2 * 0.5;\n    const az = z2 * 0.5;\n    return new _Quat2(\n      x1,\n      y1,\n      z1,\n      w1,\n      ax * w1 + ay * z1 - az * y1,\n      ay * w1 + az * x1 - ax * z1,\n      az * w1 + ax * y1 - ay * x1,\n      -ax * x1 - ay * y1 - az * z1\n    );\n  }\n  /**\n   * Sets a {@link Quat2} from a quaternion and a translation\n   * @category Static\n   *\n   * @param out - dual quaternion receiving operation result\n   * @param q - a normalized quaternion\n   * @param t - translation vector\n   * @returns `out`\n   */\n  static fromRotationTranslation(out, q, t) {\n    const ax = t[0] * 0.5;\n    const ay = t[1] * 0.5;\n    const az = t[2] * 0.5;\n    const bx = q[0];\n    const by = q[1];\n    const bz = q[2];\n    const bw = q[3];\n    out[0] = bx;\n    out[1] = by;\n    out[2] = bz;\n    out[3] = bw;\n    out[4] = ax * bw + ay * bz - az * by;\n    out[5] = ay * bw + az * bx - ax * bz;\n    out[6] = az * bw + ax * by - ay * bx;\n    out[7] = -ax * bx - ay * by - az * bz;\n    return out;\n  }\n  /**\n   * Sets a {@link Quat2} from a translation\n   * @category Static\n   *\n   * @param out - dual quaternion receiving operation result\n   * @param t - translation vector\n   * @returns `out`\n   */\n  static fromTranslation(out, t) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 1;\n    out[4] = t[0] * 0.5;\n    out[5] = t[1] * 0.5;\n    out[6] = t[2] * 0.5;\n    out[7] = 0;\n    return out;\n  }\n  /**\n   * Sets a {@link Quat2} from a quaternion\n   * @category Static\n   *\n   * @param out - dual quaternion receiving operation result\n   * @param q - a normalized quaternion\n   * @returns `out`\n   */\n  static fromRotation(out, q) {\n    out[0] = q[0];\n    out[1] = q[1];\n    out[2] = q[2];\n    out[3] = q[3];\n    out[4] = 0;\n    out[5] = 0;\n    out[6] = 0;\n    out[7] = 0;\n    return out;\n  }\n  /**\n   * Sets a {@link Quat2} from a quaternion\n   * @category Static\n   *\n   * @param out - dual quaternion receiving operation result\n   * @param a - the matrix\n   * @returns `out`\n   */\n  static fromMat4(out, a) {\n    Mat4.getRotation(_Quat2.#TMP_QUAT, a);\n    Mat4.getTranslation(_Quat2.#TMP_VEC3, a);\n    return _Quat2.fromRotationTranslation(out, _Quat2.#TMP_QUAT, _Quat2.#TMP_VEC3);\n  }\n  /**\n   * Copy the values from one {@link Quat2} to another\n   * @category Static\n   *\n   * @param out - the receiving dual quaternion\n   * @param a - the source dual quaternion\n   * @returns `out`\n   */\n  static copy(out, a) {\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    out[4] = a[4];\n    out[5] = a[5];\n    out[6] = a[6];\n    out[7] = a[7];\n    return out;\n  }\n  /**\n   * Set a {@link Quat2} to the identity dual quaternion\n   * @category Static\n   *\n   * @param out - the receiving dual quaternion\n   * @returns `out`\n   */\n  static identity(out) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 1;\n    out[4] = 0;\n    out[5] = 0;\n    out[6] = 0;\n    out[7] = 0;\n    return out;\n  }\n  /**\n   * Set the components of a {@link Quat2} to the given values\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param x1 - 1st X component\n   * @param y1 - 1st Y component\n   * @param z1 - 1st Z component\n   * @param w1 - 1st W component\n   * @param x2 - 2nd X component\n   * @param y2 - 2nd Y component\n   * @param z2 - 2nd Z component\n   * @param w2 - 2nd W component\n   * @returns `out`\n   */\n  static set(out, x1, y1, z1, w1, x2, y2, z2, w2) {\n    out[0] = x1;\n    out[1] = y1;\n    out[2] = z1;\n    out[3] = w1;\n    out[4] = x2;\n    out[5] = y2;\n    out[6] = z2;\n    out[7] = w2;\n    return out;\n  }\n  /**\n   * Gets the real part of a dual quat\n   * @category Static\n   *\n   * @param out - real part\n   * @param a - Dual Quaternion\n   * @return `out`\n   */\n  static getReal(out, a) {\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    return out;\n  }\n  /**\n   * Gets the dual part of a dual quat\n   * @category Static\n   *\n   * @param out - dual part\n   * @param a - Dual Quaternion\n   * @return `out`\n   */\n  static getDual(out, a) {\n    out[0] = a[4];\n    out[1] = a[5];\n    out[2] = a[6];\n    out[3] = a[7];\n    return out;\n  }\n  /**\n   * Set the real component of a {@link Quat2} to the given quaternion\n   * @category Static\n   *\n   * @param out - the receiving dual quaternion\n   * @param a - a quaternion representing the real part\n   * @return `out`\n   */\n  static setReal(out, a) {\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    return out;\n  }\n  /**\n   * Set the dual component of a {@link Quat2} to the given quaternion\n   * @category Static\n   *\n   * @param out - the receiving dual quaternion\n   * @param a - a quaternion representing the dual part\n   * @return `out`\n   */\n  static setDual(out, a) {\n    out[4] = a[0];\n    out[5] = a[1];\n    out[6] = a[2];\n    out[7] = a[3];\n    return out;\n  }\n  /**\n   * Gets the translation of a normalized {@link Quat2}\n   * @category Static\n   *\n   * @param out - the receiving translation vector\n   * @param a - Dual Quaternion to be decomposed\n   * @return `out`\n   */\n  static getTranslation(out, a) {\n    const ax = a[4];\n    const ay = a[5];\n    const az = a[6];\n    const aw = a[7];\n    const bx = -a[0];\n    const by = -a[1];\n    const bz = -a[2];\n    const bw = a[3];\n    out[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2;\n    out[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2;\n    out[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2;\n    return out;\n  }\n  /**\n   * Translates a {@link Quat2} by the given vector\n   * @category Static\n   *\n   * @param out - the receiving dual quaternion\n   * @param a - the dual quaternion to translate\n   * @param v - vector to translate by\n   * @returns `out`\n   */\n  static translate(out, a, v) {\n    const ax1 = a[0];\n    const ay1 = a[1];\n    const az1 = a[2];\n    const aw1 = a[3];\n    const bx1 = v[0] * 0.5;\n    const by1 = v[1] * 0.5;\n    const bz1 = v[2] * 0.5;\n    const ax2 = a[4];\n    const ay2 = a[5];\n    const az2 = a[6];\n    const aw2 = a[7];\n    out[0] = ax1;\n    out[1] = ay1;\n    out[2] = az1;\n    out[3] = aw1;\n    out[4] = aw1 * bx1 + ay1 * bz1 - az1 * by1 + ax2;\n    out[5] = aw1 * by1 + az1 * bx1 - ax1 * bz1 + ay2;\n    out[6] = aw1 * bz1 + ax1 * by1 - ay1 * bx1 + az2;\n    out[7] = -ax1 * bx1 - ay1 * by1 - az1 * bz1 + aw2;\n    return out;\n  }\n  /**\n   * Rotates a {@link Quat2} around the X axis\n   * @category Static\n   *\n   * @param out - the receiving dual quaternion\n   * @param a - the dual quaternion to rotate\n   * @param rad - angle (in radians) to rotate\n   * @returns `out`\n   */\n  static rotateX(out, a, rad) {\n    let bx = -a[0];\n    let by = -a[1];\n    let bz = -a[2];\n    let bw = a[3];\n    const ax = a[4];\n    const ay = a[5];\n    const az = a[6];\n    const aw = a[7];\n    const ax1 = ax * bw + aw * bx + ay * bz - az * by;\n    const ay1 = ay * bw + aw * by + az * bx - ax * bz;\n    const az1 = az * bw + aw * bz + ax * by - ay * bx;\n    const aw1 = aw * bw - ax * bx - ay * by - az * bz;\n    Quat.rotateX(out, a, rad);\n    bx = out[0];\n    by = out[1];\n    bz = out[2];\n    bw = out[3];\n    out[4] = ax1 * bw + aw1 * bx + ay1 * bz - az1 * by;\n    out[5] = ay1 * bw + aw1 * by + az1 * bx - ax1 * bz;\n    out[6] = az1 * bw + aw1 * bz + ax1 * by - ay1 * bx;\n    out[7] = aw1 * bw - ax1 * bx - ay1 * by - az1 * bz;\n    return out;\n  }\n  /**\n   * Rotates a {@link Quat2} around the Y axis\n   * @category Static\n   *\n   * @param out - the receiving dual quaternion\n   * @param a - the dual quaternion to rotate\n   * @param rad - angle (in radians) to rotate\n   * @returns `out`\n   */\n  static rotateY(out, a, rad) {\n    let bx = -a[0];\n    let by = -a[1];\n    let bz = -a[2];\n    let bw = a[3];\n    const ax = a[4];\n    const ay = a[5];\n    const az = a[6];\n    const aw = a[7];\n    const ax1 = ax * bw + aw * bx + ay * bz - az * by;\n    const ay1 = ay * bw + aw * by + az * bx - ax * bz;\n    const az1 = az * bw + aw * bz + ax * by - ay * bx;\n    const aw1 = aw * bw - ax * bx - ay * by - az * bz;\n    Quat.rotateY(out, a, rad);\n    bx = out[0];\n    by = out[1];\n    bz = out[2];\n    bw = out[3];\n    out[4] = ax1 * bw + aw1 * bx + ay1 * bz - az1 * by;\n    out[5] = ay1 * bw + aw1 * by + az1 * bx - ax1 * bz;\n    out[6] = az1 * bw + aw1 * bz + ax1 * by - ay1 * bx;\n    out[7] = aw1 * bw - ax1 * bx - ay1 * by - az1 * bz;\n    return out;\n  }\n  /**\n   * Rotates a {@link Quat2} around the Z axis\n   * @category Static\n   *\n   * @param out - the receiving dual quaternion\n   * @param a - the dual quaternion to rotate\n   * @param rad - angle (in radians) to rotate\n   * @returns `out`\n   */\n  static rotateZ(out, a, rad) {\n    let bx = -a[0];\n    let by = -a[1];\n    let bz = -a[2];\n    let bw = a[3];\n    const ax = a[4];\n    const ay = a[5];\n    const az = a[6];\n    const aw = a[7];\n    const ax1 = ax * bw + aw * bx + ay * bz - az * by;\n    const ay1 = ay * bw + aw * by + az * bx - ax * bz;\n    const az1 = az * bw + aw * bz + ax * by - ay * bx;\n    const aw1 = aw * bw - ax * bx - ay * by - az * bz;\n    Quat.rotateZ(out, a, rad);\n    bx = out[0];\n    by = out[1];\n    bz = out[2];\n    bw = out[3];\n    out[4] = ax1 * bw + aw1 * bx + ay1 * bz - az1 * by;\n    out[5] = ay1 * bw + aw1 * by + az1 * bx - ax1 * bz;\n    out[6] = az1 * bw + aw1 * bz + ax1 * by - ay1 * bx;\n    out[7] = aw1 * bw - ax1 * bx - ay1 * by - az1 * bz;\n    return out;\n  }\n  /**\n   * Rotates a {@link Quat2} by a given quaternion (a * q)\n   * @category Static\n   *\n   * @param out - the receiving dual quaternion\n   * @param a - the dual quaternion to rotate\n   * @param q - quaternion to rotate by\n   * @returns `out`\n   */\n  static rotateByQuatAppend(out, a, q) {\n    const qx = q[0];\n    const qy = q[1];\n    const qz = q[2];\n    const qw = q[3];\n    let ax = a[0];\n    let ay = a[1];\n    let az = a[2];\n    let aw = a[3];\n    out[0] = ax * qw + aw * qx + ay * qz - az * qy;\n    out[1] = ay * qw + aw * qy + az * qx - ax * qz;\n    out[2] = az * qw + aw * qz + ax * qy - ay * qx;\n    out[3] = aw * qw - ax * qx - ay * qy - az * qz;\n    ax = a[4];\n    ay = a[5];\n    az = a[6];\n    aw = a[7];\n    out[4] = ax * qw + aw * qx + ay * qz - az * qy;\n    out[5] = ay * qw + aw * qy + az * qx - ax * qz;\n    out[6] = az * qw + aw * qz + ax * qy - ay * qx;\n    out[7] = aw * qw - ax * qx - ay * qy - az * qz;\n    return out;\n  }\n  /**\n   * Rotates a {@link Quat2} by a given quaternion (q * a)\n   * @category Static\n   *\n   * @param out - the receiving dual quaternion\n   * @param q - quaternion to rotate by\n   * @param a - the dual quaternion to rotate\n   * @returns `out`\n   */\n  static rotateByQuatPrepend(out, q, a) {\n    const qx = q[0];\n    const qy = q[1];\n    const qz = q[2];\n    const qw = q[3];\n    let bx = a[0];\n    let by = a[1];\n    let bz = a[2];\n    let bw = a[3];\n    out[0] = qx * bw + qw * bx + qy * bz - qz * by;\n    out[1] = qy * bw + qw * by + qz * bx - qx * bz;\n    out[2] = qz * bw + qw * bz + qx * by - qy * bx;\n    out[3] = qw * bw - qx * bx - qy * by - qz * bz;\n    bx = a[4];\n    by = a[5];\n    bz = a[6];\n    bw = a[7];\n    out[4] = qx * bw + qw * bx + qy * bz - qz * by;\n    out[5] = qy * bw + qw * by + qz * bx - qx * bz;\n    out[6] = qz * bw + qw * bz + qx * by - qy * bx;\n    out[7] = qw * bw - qx * bx - qy * by - qz * bz;\n    return out;\n  }\n  /**\n   * Rotates a {@link Quat2} around a given axis. Does the normalization automatically\n   * @category Static\n   *\n   * @param out - the receiving dual quaternion\n   * @param a - the dual quaternion to rotate\n   * @param axis - the axis to rotate around\n   * @param rad - how far the rotation should be\n   * @returns `out`\n   */\n  static rotateAroundAxis(out, a, axis, rad) {\n    if (Math.abs(rad) < GLM_EPSILON) {\n      return _Quat2.copy(out, a);\n    }\n    const axisLength = Math.sqrt(axis[0] * axis[0] + axis[1] * axis[1] + axis[2] * axis[2]);\n    rad *= 0.5;\n    const s = Math.sin(rad);\n    const bx = s * axis[0] / axisLength;\n    const by = s * axis[1] / axisLength;\n    const bz = s * axis[2] / axisLength;\n    const bw = Math.cos(rad);\n    const ax1 = a[0];\n    const ay1 = a[1];\n    const az1 = a[2];\n    const aw1 = a[3];\n    out[0] = ax1 * bw + aw1 * bx + ay1 * bz - az1 * by;\n    out[1] = ay1 * bw + aw1 * by + az1 * bx - ax1 * bz;\n    out[2] = az1 * bw + aw1 * bz + ax1 * by - ay1 * bx;\n    out[3] = aw1 * bw - ax1 * bx - ay1 * by - az1 * bz;\n    const ax = a[4];\n    const ay = a[5];\n    const az = a[6];\n    const aw = a[7];\n    out[4] = ax * bw + aw * bx + ay * bz - az * by;\n    out[5] = ay * bw + aw * by + az * bx - ax * bz;\n    out[6] = az * bw + aw * bz + ax * by - ay * bx;\n    out[7] = aw * bw - ax * bx - ay * by - az * bz;\n    return out;\n  }\n  /**\n   * Adds two {@link Quat2}s\n   * @category Static\n   *\n   * @param out - the receiving dual quaternion\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns `out`\n   */\n  static add(out, a, b) {\n    out[0] = a[0] + b[0];\n    out[1] = a[1] + b[1];\n    out[2] = a[2] + b[2];\n    out[3] = a[3] + b[3];\n    out[4] = a[4] + b[4];\n    out[5] = a[5] + b[5];\n    out[6] = a[6] + b[6];\n    out[7] = a[7] + b[7];\n    return out;\n  }\n  /**\n   * Multiplies two {@link Quat2}s\n   * @category Static\n   *\n   * @param out - the receiving dual quaternion\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns {quat2} out\n   */\n  static multiply(out, a, b) {\n    const ax0 = a[0];\n    const ay0 = a[1];\n    const az0 = a[2];\n    const aw0 = a[3];\n    const bx1 = b[4];\n    const by1 = b[5];\n    const bz1 = b[6];\n    const bw1 = b[7];\n    const ax1 = a[4];\n    const ay1 = a[5];\n    const az1 = a[6];\n    const aw1 = a[7];\n    const bx0 = b[0];\n    const by0 = b[1];\n    const bz0 = b[2];\n    const bw0 = b[3];\n    out[0] = ax0 * bw0 + aw0 * bx0 + ay0 * bz0 - az0 * by0;\n    out[1] = ay0 * bw0 + aw0 * by0 + az0 * bx0 - ax0 * bz0;\n    out[2] = az0 * bw0 + aw0 * bz0 + ax0 * by0 - ay0 * bx0;\n    out[3] = aw0 * bw0 - ax0 * bx0 - ay0 * by0 - az0 * bz0;\n    out[4] = ax0 * bw1 + aw0 * bx1 + ay0 * bz1 - az0 * by1 + ax1 * bw0 + aw1 * bx0 + ay1 * bz0 - az1 * by0;\n    out[5] = ay0 * bw1 + aw0 * by1 + az0 * bx1 - ax0 * bz1 + ay1 * bw0 + aw1 * by0 + az1 * bx0 - ax1 * bz0;\n    out[6] = az0 * bw1 + aw0 * bz1 + ax0 * by1 - ay0 * bx1 + az1 * bw0 + aw1 * bz0 + ax1 * by0 - ay1 * bx0;\n    out[7] = aw0 * bw1 - ax0 * bx1 - ay0 * by1 - az0 * bz1 + aw1 * bw0 - ax1 * bx0 - ay1 * by0 - az1 * bz0;\n    return out;\n  }\n  /**\n   * Alias for {@link Quat2.multiply}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static mul(out, a, b) {\n    return out;\n  }\n  /**\n   * Scales a {@link Quat2} by a scalar value\n   * @category Static\n   *\n   * @param out - the receiving dual quaterion\n   * @param a - the dual quaternion to scale\n   * @param b - scalar value to scale the dual quaterion by\n   * @returns `out`\n   */\n  static scale(out, a, b) {\n    out[0] = a[0] * b;\n    out[1] = a[1] * b;\n    out[2] = a[2] * b;\n    out[3] = a[3] * b;\n    out[4] = a[4] * b;\n    out[5] = a[5] * b;\n    out[6] = a[6] * b;\n    out[7] = a[7] * b;\n    return out;\n  }\n  /**\n   * Calculates the dot product of two {@link Quat2}s (The dot product of the real parts)\n   * @category Static\n   *\n   * @param a - the first operand\n   * @param b - the second operand\n   * @returns dot product of a and b\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static dot(a, b) {\n    return 0;\n  }\n  /**\n   * Performs a linear interpolation between two {@link Quat2}s\n   * NOTE: The resulting dual quaternions won't always be normalized (The error is most noticeable when `t = 0.5`)\n   * @category Static\n   *\n   * @param out - the receiving dual quat\n   * @param a - the first operand\n   * @param b - the second operand\n   * @param t - interpolation amount, in the range [0-1], between the two inputs\n   * @returns `out`\n   */\n  static lerp(out, a, b, t) {\n    const mt = 1 - t;\n    if (_Quat2.dot(a, b) < 0) {\n      t = -t;\n    }\n    out[0] = a[0] * mt + b[0] * t;\n    out[1] = a[1] * mt + b[1] * t;\n    out[2] = a[2] * mt + b[2] * t;\n    out[3] = a[3] * mt + b[3] * t;\n    out[4] = a[4] * mt + b[4] * t;\n    out[5] = a[5] * mt + b[5] * t;\n    out[6] = a[6] * mt + b[6] * t;\n    out[7] = a[7] * mt + b[7] * t;\n    return out;\n  }\n  /**\n   * Calculates the inverse of a {@link Quat2}. If they are normalized, conjugate is cheaper\n   * @category Static\n   *\n   * @param out - the receiving dual quaternion\n   * @param a - dual quat to calculate inverse of\n   * @returns `out`\n   */\n  static invert(out, a) {\n    const sqlen = _Quat2.squaredLength(a);\n    out[0] = -a[0] / sqlen;\n    out[1] = -a[1] / sqlen;\n    out[2] = -a[2] / sqlen;\n    out[3] = a[3] / sqlen;\n    out[4] = -a[4] / sqlen;\n    out[5] = -a[5] / sqlen;\n    out[6] = -a[6] / sqlen;\n    out[7] = a[7] / sqlen;\n    return out;\n  }\n  /**\n   * Calculates the conjugate of a {@link Quat2}. If the dual quaternion is normalized, this function is faster than\n   * {@link Quat2.invert} and produces the same result.\n   * @category Static\n   *\n   * @param out - the receiving dual quaternion\n   * @param a - dual quaternion to calculate conjugate of\n   * @returns `out`\n   */\n  static conjugate(out, a) {\n    out[0] = -a[0];\n    out[1] = -a[1];\n    out[2] = -a[2];\n    out[3] = a[3];\n    out[4] = -a[4];\n    out[5] = -a[5];\n    out[6] = -a[6];\n    out[7] = a[7];\n    return out;\n  }\n  /**\n   * Calculates the magnitude (length) of a {@link Quat2}\n   * @category Static\n   *\n   * @param a - dual quaternion to calculate length of\n   * @returns length of `a`\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static magnitude(a) {\n    return 0;\n  }\n  /**\n   * Alias for {@link Quat2.magnitude}\n   * @category Static\n   */\n  static mag(a) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Alias for {@link Quat2.magnitude}\n   * @category Static\n   * @deprecated Use {@link Quat2.magnitude} to avoid conflicts with builtin `length` methods/attribs\n   */\n  // Length conflicts with Function.length\n  static length(a) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Alias for {@link Quat2.magnitude}\n   * @category Static\n   * @deprecated Use {@link Quat2.mag}\n   */\n  static len(a) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Calculates the squared length of a {@link Quat2}\n   * @category Static\n   *\n   * @param a - dual quaternion to calculate squared length of\n   * @returns squared length of a\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static squaredLength(a) {\n    return 0;\n  }\n  /**\n   * Alias for {@link Quat2.squaredLength}\n   * @category Static\n   */\n  static sqrLen(a) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Normalize a {@link Quat2}\n   * @category Static\n   *\n   * @param out - the receiving dual quaternion\n   * @param a - dual quaternion to normalize\n   * @returns `out`\n   */\n  static normalize(out, a) {\n    let magnitude = _Quat2.squaredLength(a);\n    if (magnitude > 0) {\n      magnitude = Math.sqrt(magnitude);\n      const a0 = a[0] / magnitude;\n      const a1 = a[1] / magnitude;\n      const a2 = a[2] / magnitude;\n      const a3 = a[3] / magnitude;\n      const b0 = a[4];\n      const b1 = a[5];\n      const b2 = a[6];\n      const b3 = a[7];\n      const a_dot_b = a0 * b0 + a1 * b1 + a2 * b2 + a3 * b3;\n      out[0] = a0;\n      out[1] = a1;\n      out[2] = a2;\n      out[3] = a3;\n      out[4] = (b0 - a0 * a_dot_b) / magnitude;\n      out[5] = (b1 - a1 * a_dot_b) / magnitude;\n      out[6] = (b2 - a2 * a_dot_b) / magnitude;\n      out[7] = (b3 - a3 * a_dot_b) / magnitude;\n    }\n    return out;\n  }\n  /**\n   * Returns a string representation of a {@link Quat2}\n   * @category Static\n   *\n   * @param a - dual quaternion to represent as a string\n   * @returns string representation of the vector\n   */\n  static str(a) {\n    return `Quat2(${a.join(\", \")})`;\n  }\n  /**\n   * Returns whether the {@link Quat2}s have exactly the same elements in the same position (when compared with ===)\n   * @category Static\n   *\n   * @param a - The first dual quaternion.\n   * @param b - The second dual quaternion.\n   * @returns True if the dual quaternions are equal, false otherwise.\n   */\n  static exactEquals(a, b) {\n    return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7];\n  }\n  /**\n   * Returns whether the {@link Quat2}s have approximately the same elements in the same position.\n   * @category Static\n   *\n   * @param a - The first dual quaternion.\n   * @param b - The second dual quaternion.\n   * @returns True if the dual quaternions are equal, false otherwise.\n   */\n  static equals(a, b) {\n    const a0 = a[0];\n    const a1 = a[1];\n    const a2 = a[2];\n    const a3 = a[3];\n    const a4 = a[4];\n    const a5 = a[5];\n    const a6 = a[6];\n    const a7 = a[7];\n    const b0 = b[0];\n    const b1 = b[1];\n    const b2 = b[2];\n    const b3 = b[3];\n    const b4 = b[4];\n    const b5 = b[5];\n    const b6 = b[6];\n    const b7 = b[7];\n    return Math.abs(a0 - b0) <= GLM_EPSILON * Math.max(1, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= GLM_EPSILON * Math.max(1, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= GLM_EPSILON * Math.max(1, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= GLM_EPSILON * Math.max(1, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= GLM_EPSILON * Math.max(1, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= GLM_EPSILON * Math.max(1, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= GLM_EPSILON * Math.max(1, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= GLM_EPSILON * Math.max(1, Math.abs(a7), Math.abs(b7));\n  }\n};\nQuat2.dot = Quat.dot;\nQuat2.squaredLength = Quat.squaredLength;\nQuat2.sqrLen = Quat.squaredLength;\nQuat2.mag = Quat.magnitude;\nQuat2.length = Quat.magnitude;\nQuat2.len = Quat.magnitude;\nQuat2.mul = Quat2.multiply;\nvar Vec2 = class _Vec2 extends Float32Array {\n  /**\n   * Create a {@link Vec2}.\n   *\n   * @category Constructor\n   */\n  constructor(...values) {\n    switch (values.length) {\n      case 2: {\n        const v = values[0];\n        if (typeof v === \"number\") {\n          super([v, values[1]]);\n        } else {\n          super(v, values[1], 2);\n        }\n        break;\n      }\n      case 1: {\n        const v = values[0];\n        if (typeof v === \"number\") {\n          super([v, v]);\n        } else {\n          super(v, 0, 2);\n        }\n        break;\n      }\n      default:\n        super(2);\n        break;\n    }\n  }\n  // ============\n  // Accessors\n  // ============\n  // Getters and setters to make component access read better.\n  // These are likely to be a little bit slower than direct array access.\n  /**\n   * The x component of the vector. Equivalent to `this[0];`\n   * @category Vector Components\n   */\n  get x() {\n    return this[0];\n  }\n  set x(value) {\n    this[0] = value;\n  }\n  /**\n   * The y component of the vector. Equivalent to `this[1];`\n   * @category Vector Components\n   */\n  get y() {\n    return this[1];\n  }\n  set y(value) {\n    this[1] = value;\n  }\n  // Alternate set of getters and setters in case this is being used to define\n  // a color.\n  /**\n   * The r component of the vector. Equivalent to `this[0];`\n   * @category Color Components\n   */\n  get r() {\n    return this[0];\n  }\n  set r(value) {\n    this[0] = value;\n  }\n  /**\n   * The g component of the vector. Equivalent to `this[1];`\n   * @category Color Components\n   */\n  get g() {\n    return this[1];\n  }\n  set g(value) {\n    this[1] = value;\n  }\n  /**\n   * The magnitude (length) of this.\n   * Equivalent to `Vec2.magnitude(this);`\n   *\n   * Magnitude is used because the `length` attribute is already defined by\n   * TypedArrays to mean the number of elements in the array.\n   *\n   * @category Accessors\n   */\n  get magnitude() {\n    return Math.hypot(this[0], this[1]);\n  }\n  /**\n   * Alias for {@link Vec2.magnitude}\n   *\n   * @category Accessors\n   */\n  get mag() {\n    return this.magnitude;\n  }\n  /**\n   * The squared magnitude (length) of `this`.\n   * Equivalent to `Vec2.squaredMagnitude(this);`\n   *\n   * @category Accessors\n   */\n  get squaredMagnitude() {\n    const x = this[0];\n    const y = this[1];\n    return x * x + y * y;\n  }\n  /**\n   * Alias for {@link Vec2.squaredMagnitude}\n   *\n   * @category Accessors\n   */\n  get sqrMag() {\n    return this.squaredMagnitude;\n  }\n  /**\n   * A string representation of `this`\n   * Equivalent to `Vec2.str(this);`\n   *\n   * @category Accessors\n   */\n  get str() {\n    return _Vec2.str(this);\n  }\n  // ===================\n  // Instances methods\n  // ===================\n  /**\n   * Copy the values from another {@link Vec2} into `this`.\n   * @category Methods\n   *\n   * @param a the source vector\n   * @returns `this`\n   */\n  copy(a) {\n    this.set(a);\n    return this;\n  }\n  // Instead of zero(), use a.fill(0) for instances;\n  /**\n   * Adds a {@link Vec2} to `this`.\n   * Equivalent to `Vec2.add(this, this, b);`\n   * @category Methods\n   *\n   * @param b - The vector to add to `this`\n   * @returns `this`\n   */\n  add(b) {\n    this[0] += b[0];\n    this[1] += b[1];\n    return this;\n  }\n  /**\n   * Subtracts a {@link Vec2} from `this`.\n   * Equivalent to `Vec2.subtract(this, this, b);`\n   * @category Methods\n   *\n   * @param b - The vector to subtract from `this`\n   * @returns `this`\n   */\n  subtract(b) {\n    this[0] -= b[0];\n    this[1] -= b[1];\n    return this;\n  }\n  /**\n   * Alias for {@link Vec2.subtract}\n   * @category Methods\n   */\n  sub(b) {\n    return this;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Multiplies `this` by a {@link Vec2}.\n   * Equivalent to `Vec2.multiply(this, this, b);`\n   * @category Methods\n   *\n   * @param b - The vector to multiply `this` by\n   * @returns `this`\n   */\n  multiply(b) {\n    this[0] *= b[0];\n    this[1] *= b[1];\n    return this;\n  }\n  /**\n   * Alias for {@link Vec2.multiply}\n   * @category Methods\n   */\n  mul(b) {\n    return this;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Divides `this` by a {@link Vec2}.\n   * Equivalent to `Vec2.divide(this, this, b);`\n   * @category Methods\n   *\n   * @param b - The vector to divide `this` by\n   * @returns `this`\n   */\n  divide(b) {\n    this[0] /= b[0];\n    this[1] /= b[1];\n    return this;\n  }\n  /**\n   * Alias for {@link Vec2.divide}\n   * @category Methods\n   */\n  div(b) {\n    return this;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Scales `this` by a scalar number.\n   * Equivalent to `Vec2.scale(this, this, b);`\n   * @category Methods\n   *\n   * @param b - Amount to scale `this` by\n   * @returns `this`\n   */\n  scale(b) {\n    this[0] *= b;\n    this[1] *= b;\n    return this;\n  }\n  /**\n   * Calculates `this` scaled by a scalar value then adds the result to `this`.\n   * Equivalent to `Vec2.scaleAndAdd(this, this, b, scale);`\n   * @category Methods\n   *\n   * @param b - The vector to add to `this`\n   * @param scale - The amount to scale `b` by before adding\n   * @returns `this`\n   */\n  scaleAndAdd(b, scale) {\n    this[0] += b[0] * scale;\n    this[1] += b[1] * scale;\n    return this;\n  }\n  /**\n   * Calculates the Euclidean distance between another {@link Vec2} and `this`.\n   * Equivalent to `Vec2.distance(this, b);`\n   * @category Methods\n   *\n   * @param b - The vector to calculate the distance to\n   * @returns Distance between `this` and `b`\n   */\n  distance(b) {\n    return _Vec2.distance(this, b);\n  }\n  /**\n   * Alias for {@link Vec2.distance}\n   * @category Methods\n   */\n  dist(b) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Calculates the squared Euclidean distance between another {@link Vec2} and `this`.\n   * Equivalent to `Vec2.squaredDistance(this, b);`\n   * @category Methods\n   *\n   * @param b The vector to calculate the squared distance to\n   * @returns Squared distance between `this` and `b`\n   */\n  squaredDistance(b) {\n    return _Vec2.squaredDistance(this, b);\n  }\n  /**\n   * Alias for {@link Vec2.squaredDistance}\n   * @category Methods\n   */\n  sqrDist(b) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Negates the components of `this`.\n   * Equivalent to `Vec2.negate(this, this);`\n   * @category Methods\n   *\n   * @returns `this`\n   */\n  negate() {\n    this[0] *= -1;\n    this[1] *= -1;\n    return this;\n  }\n  /**\n   * Inverts the components of `this`.\n   * Equivalent to `Vec2.inverse(this, this);`\n   * @category Methods\n   *\n   * @returns `this`\n   */\n  invert() {\n    this[0] = 1 / this[0];\n    this[1] = 1 / this[1];\n    return this;\n  }\n  /**\n   * Sets each component of `this` to it's absolute value.\n   * Equivalent to `Vec2.abs(this, this);`\n   * @category Methods\n   *\n   * @returns `this`\n   */\n  abs() {\n    this[0] = Math.abs(this[0]);\n    this[1] = Math.abs(this[1]);\n    return this;\n  }\n  /**\n   * Calculates the dot product of this and another {@link Vec2}.\n   * Equivalent to `Vec2.dot(this, b);`\n   * @category Methods\n   *\n   * @param b - The second operand\n   * @returns Dot product of `this` and `b`\n   */\n  dot(b) {\n    return this[0] * b[0] + this[1] * b[1];\n  }\n  /**\n   * Normalize `this`.\n   * Equivalent to `Vec2.normalize(this, this);`\n   * @category Methods\n   *\n   * @returns `this`\n   */\n  normalize() {\n    return _Vec2.normalize(this, this);\n  }\n  // ===================\n  // Static accessors\n  // ===================\n  /**\n   * @category Static\n   *\n   * @returns The number of bytes in a {@link Vec2}.\n   */\n  static get BYTE_LENGTH() {\n    return 2 * Float32Array.BYTES_PER_ELEMENT;\n  }\n  // ===================\n  // Static methods\n  // ===================\n  /**\n   * Creates a new, empty {@link Vec2}\n   * @category Static\n   *\n   * @returns A new 2D vector\n   */\n  static create() {\n    return new _Vec2();\n  }\n  /**\n   * Creates a new {@link Vec2} initialized with values from an existing vector\n   * @category Static\n   *\n   * @param a - Vector to clone\n   * @returns A new 2D vector\n   */\n  static clone(a) {\n    return new _Vec2(a);\n  }\n  /**\n   * Creates a new {@link Vec2} initialized with the given values\n   * @category Static\n   *\n   * @param x - X component\n   * @param y - Y component\n   * @returns A new 2D vector\n   */\n  static fromValues(x, y) {\n    return new _Vec2(x, y);\n  }\n  /**\n   * Copy the values from one {@link Vec2} to another\n   * @category Static\n   *\n   * @param out - the receiving vector\n   * @param a - The source vector\n   * @returns `out`\n   */\n  static copy(out, a) {\n    out[0] = a[0];\n    out[1] = a[1];\n    return out;\n  }\n  /**\n   * Set the components of a {@link Vec2} to the given values\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param x - X component\n   * @param y - Y component\n   * @returns `out`\n   */\n  static set(out, x, y) {\n    out[0] = x;\n    out[1] = y;\n    return out;\n  }\n  /**\n   * Adds two {@link Vec2}s\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param a - The first operand\n   * @param b - The second operand\n   * @returns `out`\n   */\n  static add(out, a, b) {\n    out[0] = a[0] + b[0];\n    out[1] = a[1] + b[1];\n    return out;\n  }\n  /**\n   * Subtracts vector b from vector a\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param a - The first operand\n   * @param b - The second operand\n   * @returns `out`\n   */\n  static subtract(out, a, b) {\n    out[0] = a[0] - b[0];\n    out[1] = a[1] - b[1];\n    return out;\n  }\n  /**\n   * Alias for {@link Vec2.subtract}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static sub(out, a, b) {\n    return [0, 0];\n  }\n  /**\n   * Multiplies two {@link Vec2}s\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param a - The first operand\n   * @param b - The second operand\n   * @returns `out`\n   */\n  static multiply(out, a, b) {\n    out[0] = a[0] * b[0];\n    out[1] = a[1] * b[1];\n    return out;\n  }\n  /**\n   * Alias for {@link Vec2.multiply}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static mul(out, a, b) {\n    return [0, 0];\n  }\n  /**\n   * Divides two {@link Vec2}s\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param a - The first operand\n   * @param b - The second operand\n   * @returns `out`\n   */\n  static divide(out, a, b) {\n    out[0] = a[0] / b[0];\n    out[1] = a[1] / b[1];\n    return out;\n  }\n  /**\n   * Alias for {@link Vec2.divide}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static div(out, a, b) {\n    return [0, 0];\n  }\n  /**\n   * Math.ceil the components of a {@link Vec2}\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param a - Vector to ceil\n   * @returns `out`\n   */\n  static ceil(out, a) {\n    out[0] = Math.ceil(a[0]);\n    out[1] = Math.ceil(a[1]);\n    return out;\n  }\n  /**\n   * Math.floor the components of a {@link Vec2}\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param a - Vector to floor\n   * @returns `out`\n   */\n  static floor(out, a) {\n    out[0] = Math.floor(a[0]);\n    out[1] = Math.floor(a[1]);\n    return out;\n  }\n  /**\n   * Returns the minimum of two {@link Vec2}s\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param a - The first operand\n   * @param b - The second operand\n   * @returns `out`\n   */\n  static min(out, a, b) {\n    out[0] = Math.min(a[0], b[0]);\n    out[1] = Math.min(a[1], b[1]);\n    return out;\n  }\n  /**\n   * Returns the maximum of two {@link Vec2}s\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param a - The first operand\n   * @param b - The second operand\n   * @returns `out`\n   */\n  static max(out, a, b) {\n    out[0] = Math.max(a[0], b[0]);\n    out[1] = Math.max(a[1], b[1]);\n    return out;\n  }\n  /**\n   * Math.round the components of a {@link Vec2}\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param a - Vector to round\n   * @returns `out`\n   */\n  static round(out, a) {\n    out[0] = Math.round(a[0]);\n    out[1] = Math.round(a[1]);\n    return out;\n  }\n  /**\n   * Scales a {@link Vec2} by a scalar number\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param a - The vector to scale\n   * @param b - Amount to scale the vector by\n   * @returns `out`\n   */\n  static scale(out, a, b) {\n    out[0] = a[0] * b;\n    out[1] = a[1] * b;\n    return out;\n  }\n  /**\n   * Adds two Vec2's after scaling the second operand by a scalar value\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param a - The first operand\n   * @param b - The second operand\n   * @param scale - The amount to scale b by before adding\n   * @returns `out`\n   */\n  static scaleAndAdd(out, a, b, scale) {\n    out[0] = a[0] + b[0] * scale;\n    out[1] = a[1] + b[1] * scale;\n    return out;\n  }\n  /**\n   * Calculates the Euclidean distance between two {@link Vec2}s\n   * @category Static\n   *\n   * @param a - The first operand\n   * @param b - The second operand\n   * @returns distance between `a` and `b`\n   */\n  static distance(a, b) {\n    return Math.hypot(b[0] - a[0], b[1] - a[1]);\n  }\n  /**\n   * Alias for {@link Vec2.distance}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static dist(a, b) {\n    return 0;\n  }\n  /**\n   * Calculates the squared Euclidean distance between two {@link Vec2}s\n   * @category Static\n   *\n   * @param a - The first operand\n   * @param b - The second operand\n   * @returns Squared distance between `a` and `b`\n   */\n  static squaredDistance(a, b) {\n    const x = b[0] - a[0];\n    const y = b[1] - a[1];\n    return x * x + y * y;\n  }\n  /**\n   * Alias for {@link Vec2.distance}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static sqrDist(a, b) {\n    return 0;\n  }\n  /**\n   * Calculates the magnitude (length) of a {@link Vec2}\n   * @category Static\n   *\n   * @param a - Vector to calculate magnitude of\n   * @returns Magnitude of a\n   */\n  static magnitude(a) {\n    const x = a[0];\n    const y = a[1];\n    return Math.sqrt(x * x + y * y);\n  }\n  /**\n   * Alias for {@link Vec2.magnitude}\n   * @category Static\n   */\n  static mag(a) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Alias for {@link Vec2.magnitude}\n   * @category Static\n   * @deprecated Use {@link Vec2.magnitude} to avoid conflicts with builtin `length` methods/attribs\n   *\n   * @param a - vector to calculate length of\n   * @returns length of a\n   */\n  // Length conflicts with Function.length\n  static length(a) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Alias for {@link Vec2.magnitude}\n   * @category Static\n   * @deprecated Use {@link Vec2.mag}\n   */\n  static len(a) {\n    return 0;\n  }\n  // eslint-disable-line @typescript-eslint/no-unused-vars\n  /**\n   * Calculates the squared length of a {@link Vec2}\n   * @category Static\n   *\n   * @param a - Vector to calculate squared length of\n   * @returns Squared length of a\n   */\n  static squaredLength(a) {\n    const x = a[0];\n    const y = a[1];\n    return x * x + y * y;\n  }\n  /**\n   * Alias for {@link Vec2.squaredLength}\n   * @category Static\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  static sqrLen(a, b) {\n    return 0;\n  }\n  /**\n   * Negates the components of a {@link Vec2}\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param a - Vector to negate\n   * @returns `out`\n   */\n  static negate(out, a) {\n    out[0] = -a[0];\n    out[1] = -a[1];\n    return out;\n  }\n  /**\n   * Returns the inverse of the components of a {@link Vec2}\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param a - Vector to invert\n   * @returns `out`\n   */\n  static inverse(out, a) {\n    out[0] = 1 / a[0];\n    out[1] = 1 / a[1];\n    return out;\n  }\n  /**\n   * Returns the absolute value of the components of a {@link Vec2}\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param a - Vector to compute the absolute values of\n   * @returns `out`\n   */\n  static abs(out, a) {\n    out[0] = Math.abs(a[0]);\n    out[1] = Math.abs(a[1]);\n    return out;\n  }\n  /**\n   * Normalize a {@link Vec2}\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param a - Vector to normalize\n   * @returns `out`\n   */\n  static normalize(out, a) {\n    const x = a[0];\n    const y = a[1];\n    let len = x * x + y * y;\n    if (len > 0) {\n      len = 1 / Math.sqrt(len);\n    }\n    out[0] = a[0] * len;\n    out[1] = a[1] * len;\n    return out;\n  }\n  /**\n   * Calculates the dot product of two {@link Vec2}s\n   * @category Static\n   *\n   * @param a - The first operand\n   * @param b - The second operand\n   * @returns Dot product of `a` and `b`\n   */\n  static dot(a, b) {\n    return a[0] * b[0] + a[1] * b[1];\n  }\n  /**\n   * Computes the cross product of two {@link Vec2}s\n   * Note that the cross product must by definition produce a 3D vector.\n   * For this reason there is also not instance equivalent for this function.\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param a - The first operand\n   * @param b - The second operand\n   * @returns `out`\n   */\n  static cross(out, a, b) {\n    const z = a[0] * b[1] - a[1] * b[0];\n    out[0] = out[1] = 0;\n    out[2] = z;\n    return out;\n  }\n  /**\n   * Performs a linear interpolation between two {@link Vec2}s\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @param a - The first operand\n   * @param b - The second operand\n   * @param t - Interpolation amount, in the range [0-1], between the two inputs\n   * @returns `out`\n   */\n  static lerp(out, a, b, t) {\n    const ax = a[0];\n    const ay = a[1];\n    out[0] = ax + t * (b[0] - ax);\n    out[1] = ay + t * (b[1] - ay);\n    return out;\n  }\n  /**\n   * Transforms the {@link Vec2} with a {@link Mat2}\n   *\n   * @param out - The receiving vector\n   * @param a - The vector to transform\n   * @param m - Matrix to transform with\n   * @returns `out`\n   * @category Static\n   */\n  static transformMat2(out, a, m) {\n    const x = a[0];\n    const y = a[1];\n    out[0] = m[0] * x + m[2] * y;\n    out[1] = m[1] * x + m[3] * y;\n    return out;\n  }\n  /**\n   * Transforms the {@link Vec2} with a {@link Mat2d}\n   *\n   * @param out - The receiving vector\n   * @param a - The vector to transform\n   * @param m - Matrix to transform with\n   * @returns `out`\n   * @category Static\n   */\n  static transformMat2d(out, a, m) {\n    const x = a[0];\n    const y = a[1];\n    out[0] = m[0] * x + m[2] * y + m[4];\n    out[1] = m[1] * x + m[3] * y + m[5];\n    return out;\n  }\n  /**\n   * Transforms the {@link Vec2} with a {@link Mat3}\n   * 3rd vector component is implicitly '1'\n   *\n   * @param out - The receiving vector\n   * @param a - The vector to transform\n   * @param m - Matrix to transform with\n   * @returns `out`\n   * @category Static\n   */\n  static transformMat3(out, a, m) {\n    const x = a[0];\n    const y = a[1];\n    out[0] = m[0] * x + m[3] * y + m[6];\n    out[1] = m[1] * x + m[4] * y + m[7];\n    return out;\n  }\n  /**\n   * Transforms the {@link Vec2} with a {@link Mat4}\n   * 3rd vector component is implicitly '0'\n   * 4th vector component is implicitly '1'\n   *\n   * @param out - The receiving vector\n   * @param a - The vector to transform\n   * @param m - Matrix to transform with\n   * @returns `out`\n   * @category Static\n   */\n  static transformMat4(out, a, m) {\n    const x = a[0];\n    const y = a[1];\n    out[0] = m[0] * x + m[4] * y + m[12];\n    out[1] = m[1] * x + m[5] * y + m[13];\n    return out;\n  }\n  /**\n   * Rotate a 2D vector\n   * @category Static\n   *\n   * @param out - The receiving {@link Vec2}\n   * @param a - The {@link Vec2} point to rotate\n   * @param b - The origin of the rotation\n   * @param rad - The angle of rotation in radians\n   * @returns `out`\n   */\n  static rotate(out, a, b, rad) {\n    const p0 = a[0] - b[0];\n    const p1 = a[1] - b[1];\n    const sinC = Math.sin(rad);\n    const cosC = Math.cos(rad);\n    out[0] = p0 * cosC - p1 * sinC + b[0];\n    out[1] = p0 * sinC + p1 * cosC + b[1];\n    return out;\n  }\n  /**\n   * Get the angle between two 2D vectors\n   * @category Static\n   *\n   * @param a - The first operand\n   * @param b - The second operand\n   * @returns The angle in radians\n   */\n  static angle(a, b) {\n    const x1 = a[0];\n    const y1 = a[1];\n    const x2 = b[0];\n    const y2 = b[1];\n    const mag = Math.sqrt(x1 * x1 + y1 * y1) * Math.sqrt(x2 * x2 + y2 * y2);\n    const cosine = mag && (x1 * x2 + y1 * y2) / mag;\n    return Math.acos(Math.min(Math.max(cosine, -1), 1));\n  }\n  /**\n   * Set the components of a {@link Vec2} to zero\n   * @category Static\n   *\n   * @param out - The receiving vector\n   * @returns `out`\n   */\n  static zero(out) {\n    out[0] = 0;\n    out[1] = 0;\n    return out;\n  }\n  /**\n   * Returns whether the vectors have exactly the same elements in the same position (when compared with ===)\n   * @category Static\n   *\n   * @param a - The first vector.\n   * @param b - The second vector.\n   * @returns `true` if the vectors components are ===, `false` otherwise.\n   */\n  static exactEquals(a, b) {\n    return a[0] === b[0] && a[1] === b[1];\n  }\n  /**\n   * Returns whether the vectors have approximately the same elements in the same position.\n   * @category Static\n   *\n   * @param a - The first vector.\n   * @param b - The second vector.\n   * @returns `true` if the vectors are approximately equal, `false` otherwise.\n   */\n  static equals(a, b) {\n    const a0 = a[0];\n    const a1 = a[1];\n    const b0 = b[0];\n    const b1 = b[1];\n    return Math.abs(a0 - b0) <= GLM_EPSILON * Math.max(1, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= GLM_EPSILON * Math.max(1, Math.abs(a1), Math.abs(b1));\n  }\n  /**\n   * Returns a string representation of a vector\n   * @category Static\n   *\n   * @param a - Vector to represent as a string\n   * @returns String representation of the vector\n   */\n  static str(a) {\n    return `Vec2(${a.join(\", \")})`;\n  }\n};\nVec2.prototype.sub = Vec2.prototype.subtract;\nVec2.prototype.mul = Vec2.prototype.multiply;\nVec2.prototype.div = Vec2.prototype.divide;\nVec2.prototype.dist = Vec2.prototype.distance;\nVec2.prototype.sqrDist = Vec2.prototype.squaredDistance;\nVec2.sub = Vec2.subtract;\nVec2.mul = Vec2.multiply;\nVec2.div = Vec2.divide;\nVec2.dist = Vec2.distance;\nVec2.sqrDist = Vec2.squaredDistance;\nVec2.sqrLen = Vec2.squaredLength;\nVec2.mag = Vec2.magnitude;\nVec2.length = Vec2.magnitude;\nVec2.len = Vec2.magnitude;\n\nexport { Mat2, Mat2d, Mat3, Mat4, Quat, Quat2, Vec2, Vec3, Vec4 };\n//# sourceMappingURL=index.js.map\n","/**\r\n * Awaits `requestAnimationFrame` calls by the counter specified. This allows asynchronous applications for direct /\r\n * inline style modification amongst other direct animation techniques.\r\n *\r\n * @param {number}   [cntr=1] - A positive integer greater than 0 for amount of requestAnimationFrames to wait.\r\n *\r\n * @returns {Promise<number>} Returns time of last `requestAnimationFrame` callback.\r\n */\r\nasync function nextAnimationFrame(cntr = 1)\r\n{\r\n   if (!Number.isInteger(cntr) || cntr < 1)\r\n   {\r\n      throw new TypeError(`nextAnimationFrame error: 'cntr' must be a positive integer greater than 0.`);\r\n   }\r\n\r\n   let currentTime;\r\n\r\n   // Await count of `rAF` callbacks.\r\n   for (;--cntr >= 0;) { currentTime = await new Promise((resolve) => requestAnimationFrame(resolve)); }\r\n\r\n   return currentTime;\r\n}\n\nexport { nextAnimationFrame };\n//# sourceMappingURL=index.js.map\n","import { hasSetter, isIterable, isObject, isPlainObject } from '@typhonjs-fvtt/runtime/util/object';\nimport { getEasingFunc } from '@typhonjs-fvtt/runtime/svelte/easing';\nimport { A11yHelper } from '@typhonjs-fvtt/runtime/util/a11y';\nimport { radToDeg, degToRad, clamp } from '@typhonjs-fvtt/runtime/math/util';\nimport { subscribeIgnoreFirst } from '@typhonjs-fvtt/runtime/svelte/store/util';\nimport { propertyStore } from '@typhonjs-fvtt/runtime/svelte/store/writable-derived';\nimport { lerp } from '@typhonjs-fvtt/runtime/math/interpolate';\nimport { CrossWindow } from '@typhonjs-fvtt/runtime/util/browser';\nimport { Mat4, Vec3 } from '@typhonjs-fvtt/runtime/math/gl-matrix';\nimport { writable } from 'svelte/store';\nimport { StyleParse } from '@typhonjs-fvtt/runtime/util/dom/style';\nimport { nextAnimationFrame } from '@typhonjs-fvtt/runtime/util/animate';\n\n/**\n * Provides an action to apply a TJSPosition instance to a HTMLElement and invoke `position.parent`\n *\n * @param node - The node associated with the action.\n *\n * @param position - A position or positionable instance.\n *\n * @returns The action lifecycle methods.\n */\nfunction applyPosition(node, position) {\n    /**\n     * Find actual position instance checking for a Positionable instance.\n     */\n    let actualPosition = (position?.position ?? position);\n    if (hasSetter(actualPosition, 'parent')) {\n        actualPosition.parent = node;\n    }\n    return {\n        update: (newPosition) => {\n            const newActualPosition = (newPosition?.position ?? position);\n            // Sanity case to short circuit update if positions are the same instance.\n            if (newActualPosition === actualPosition && newActualPosition.parent === actualPosition.parent) {\n                return;\n            }\n            if (hasSetter(actualPosition, 'parent')) {\n                actualPosition.parent = void 0;\n            }\n            actualPosition = newActualPosition;\n            if (hasSetter(actualPosition, 'parent')) {\n                actualPosition.parent = node;\n            }\n        },\n        destroy: () => { if (hasSetter(actualPosition, 'parent')) {\n            actualPosition.parent = void 0;\n        } }\n    };\n}\n\n/**\n * Provides an action to enable pointer dragging of an HTMLElement and invoke `position.set` on a given\n * {@link TJSPosition} instance provided. When the attached boolean store state changes the draggable action is enabled\n * or disabled.\n *\n * @param node - The node associated with the action.\n *\n * @param options - Draggable action options.\n *\n * @returns Action lifecycle functions.\n */\nfunction draggable(node, { position, enabled = true, button = 0, storeDragging = void 0, tween = false, tweenOptions = { duration: 1, ease: 'cubicOut' }, hasTargetClassList, ignoreTargetClassList }) {\n    if (hasTargetClassList !== void 0 && !isIterable(hasTargetClassList)) {\n        throw new TypeError(`'hasTargetClassList' is not iterable.`);\n    }\n    if (ignoreTargetClassList !== void 0 && !isIterable(ignoreTargetClassList)) {\n        throw new TypeError(`'ignoreTargetClassList' is not iterable.`);\n    }\n    /**\n     * Used for direct call to `position.set`.\n     */\n    const positionData = { left: 0, top: 0 };\n    /**\n     * Find actual position instance checking for a Positionable instance.\n     */\n    let actualPosition = (position?.position ?? position);\n    /**\n     * Duplicate the app / Positionable starting position to track differences.\n     */\n    let initialPosition = null;\n    /**\n     * Stores the initial X / Y on drag down.\n     */\n    let initialDragPoint = { x: 0, y: 0 };\n    /**\n     * Stores the current dragging state and gates the move pointer as the dragging store is not set until the first\n     * pointer move.\n     */\n    let dragging = false;\n    /**\n     * Stores the quickTo callback to use for optimized tweening when easing is enabled.\n     */\n    let quickTo = actualPosition.animate.quickTo(['top', 'left'], tweenOptions);\n    /**\n     * Event handlers associated with this action, so they may be later unregistered.\n     */\n    const handlers = {\n        dragDown: ['pointerdown', onDragPointerDown, false],\n        dragMove: ['pointermove', onDragPointerChange, false],\n        dragUp: ['pointerup', onDragPointerUp, false]\n    };\n    /**\n     * Activates listeners.\n     */\n    function activateListeners() {\n        // Drag handlers\n        node.addEventListener(...handlers.dragDown);\n        node.classList.add('draggable');\n    }\n    /**\n     * Removes listeners.\n     */\n    function removeListeners() {\n        if (typeof storeDragging?.set === 'function') {\n            storeDragging.set(false);\n        }\n        // Drag handlers\n        node.removeEventListener(...handlers.dragDown);\n        node.removeEventListener(...handlers.dragMove);\n        node.removeEventListener(...handlers.dragUp);\n        node.classList.remove('draggable');\n    }\n    if (enabled) {\n        activateListeners();\n    }\n    /**\n     * Handle the initial pointer down that activates dragging behavior for the positionable.\n     *\n     * @param event - The pointer down event.\n     */\n    function onDragPointerDown(event) {\n        if (event.button !== button || !event.isPrimary) {\n            return;\n        }\n        // Do not process if the position system is not enabled.\n        if (!actualPosition.enabled) {\n            return;\n        }\n        // Potentially ignore this event if `ignoreTargetClassList` is defined and the `event.target` has a matching\n        // class.\n        if (ignoreTargetClassList !== void 0 && A11yHelper.isFocusTarget(event.target)) {\n            for (const targetClass of ignoreTargetClassList) {\n                if (event.target.classList.contains(targetClass)) {\n                    return;\n                }\n            }\n        }\n        // Potentially ignore this event if `hasTargetClassList` is defined and the `event.target` does not have any\n        // matching class from the list.\n        if (hasTargetClassList !== void 0 && A11yHelper.isFocusTarget(event.target)) {\n            let foundTarget = false;\n            for (const targetClass of hasTargetClassList) {\n                if (event.target.classList.contains(targetClass)) {\n                    foundTarget = true;\n                    break;\n                }\n            }\n            if (!foundTarget) {\n                return;\n            }\n        }\n        event.preventDefault();\n        dragging = false;\n        // Record initial position.\n        initialPosition = actualPosition.get();\n        initialDragPoint = { x: event.clientX, y: event.clientY };\n        // Add move and pointer up handlers.\n        node.addEventListener(...handlers.dragMove);\n        node.addEventListener(...handlers.dragUp);\n        node.setPointerCapture(event.pointerId);\n    }\n    /**\n     * Move the positionable.\n     *\n     * @param event - The pointer move event.\n     */\n    function onDragPointerChange(event) {\n        // See chorded button presses for pointer events:\n        // https://www.w3.org/TR/pointerevents3/#chorded-button-interactions\n        // TODO: Support different button configurations for PointerEvents.\n        if ((event.buttons & 1) === 0) {\n            onDragPointerUp(event);\n            return;\n        }\n        if (event.button !== -1 || !event.isPrimary) {\n            return;\n        }\n        event.preventDefault();\n        // Only set store dragging on first move event.\n        if (!dragging && typeof storeDragging?.set === 'function') {\n            dragging = true;\n            storeDragging.set(true);\n        }\n        const newLeft = initialPosition?.left + (event.clientX - initialDragPoint.x);\n        const newTop = initialPosition?.top + (event.clientY - initialDragPoint.y);\n        if (tween) {\n            quickTo(newTop, newLeft);\n        }\n        else {\n            positionData.left = newLeft;\n            positionData.top = newTop;\n            actualPosition.set(positionData);\n        }\n    }\n    /**\n     * Finish dragging and set the final position and removing listeners.\n     *\n     * @param event - The pointer up event.\n     */\n    function onDragPointerUp(event) {\n        event.preventDefault();\n        dragging = false;\n        if (typeof storeDragging?.set === 'function') {\n            storeDragging.set(false);\n        }\n        node.removeEventListener(...handlers.dragMove);\n        node.removeEventListener(...handlers.dragUp);\n    }\n    return {\n        // The default of enabled being true won't automatically add listeners twice.\n        update: (options) => {\n            if (options.position !== void 0) {\n                // Find actual position instance checking for a Positionable instance.\n                const newPosition = (options.position?.position ?? options.position);\n                if (newPosition !== actualPosition) {\n                    actualPosition = newPosition;\n                    quickTo = actualPosition.animate.quickTo(['top', 'left'], tweenOptions);\n                }\n            }\n            if (typeof options.enabled === 'boolean') {\n                enabled = options.enabled;\n                if (enabled) {\n                    activateListeners();\n                }\n                else {\n                    removeListeners();\n                }\n            }\n            if (typeof options.button === 'number') {\n                button = options.button;\n            }\n            if (typeof options.tween === 'boolean') {\n                tween = options.tween;\n            }\n            if (isObject(options.tweenOptions)) {\n                tweenOptions = options.tweenOptions;\n                quickTo.options(tweenOptions);\n            }\n            if (options.hasTargetClassList !== void 0) {\n                if (!isIterable(options.hasTargetClassList)) {\n                    throw new TypeError(`'hasTargetClassList' is not iterable.`);\n                }\n                else {\n                    hasTargetClassList = options.hasTargetClassList;\n                }\n            }\n            if (options.ignoreTargetClassList !== void 0) {\n                if (!isIterable(options.ignoreTargetClassList)) {\n                    throw new TypeError(`'ignoreTargetClassList' is not iterable.`);\n                }\n                else {\n                    ignoreTargetClassList = options.ignoreTargetClassList;\n                }\n            }\n        },\n        destroy: () => removeListeners()\n    };\n}\n/**\n * Provides an instance of the {@link draggable} action options support / Readable store to make updating / setting\n * draggable options much easier. When subscribing to the options instance returned by {@link draggable.options} the\n * Subscriber handler receives the entire instance.\n */\nclass DraggableOptionsStore {\n    tween;\n    tweenOptions;\n    #initialTween;\n    /**\n     */\n    #initialTweenOptions;\n    #tween = false;\n    /**\n     */\n    #tweenOptions = { duration: 1, ease: 'cubicOut' };\n    /**\n     * Stores the subscribers.\n     */\n    #subscribers = [];\n    /**\n     * @param [opts] - Optional parameters.\n     *\n     * @param [opts.tween = false] - Tween enabled.\n     *\n     * @param [opts.tweenOptions] - Quick tween options.\n     */\n    constructor({ tween = false, tweenOptions } = {}) {\n        // Define the following getters directly on this instance and make them enumerable. This allows them to be\n        // picked up w/ `Object.assign`.\n        Object.defineProperty(this, 'tween', {\n            get: () => { return this.#tween; },\n            set: (newTween) => {\n                if (typeof newTween !== 'boolean') {\n                    throw new TypeError(`'tween' is not a boolean.`);\n                }\n                this.#tween = newTween;\n                this.#updateSubscribers();\n            },\n            enumerable: true\n        });\n        Object.defineProperty(this, 'tweenOptions', {\n            get: () => { return this.#tweenOptions; },\n            set: (newTweenOptions) => {\n                if (!isObject(newTweenOptions)) {\n                    throw new TypeError(`'tweenOptions' is not an object.`);\n                }\n                if (newTweenOptions.duration !== void 0) {\n                    if (!Number.isFinite(newTweenOptions.duration)) {\n                        throw new TypeError(`'tweenOptions.duration' is not a finite number.`);\n                    }\n                    if (newTweenOptions.duration < 0) {\n                        this.#tweenOptions.duration = 0;\n                    }\n                    else {\n                        this.#tweenOptions.duration = newTweenOptions.duration;\n                    }\n                }\n                if (newTweenOptions.ease !== void 0) {\n                    const easeFn = getEasingFunc(newTweenOptions.ease);\n                    if (typeof easeFn !== 'function') {\n                        throw new TypeError(`'tweenOptions.ease' is not a function or Svelte easing function name.`);\n                    }\n                    this.#tweenOptions.ease = newTweenOptions.ease;\n                }\n                this.#updateSubscribers();\n            },\n            enumerable: true\n        });\n        // Set default options.\n        if (tween !== void 0) {\n            this.tween = tween;\n        }\n        if (tweenOptions !== void 0) {\n            this.tweenOptions = tweenOptions;\n        }\n        this.#initialTween = this.#tween;\n        this.#initialTweenOptions = Object.assign({}, this.#tweenOptions);\n    }\n    /**\n     * @returns Get tween duration.\n     */\n    get tweenDuration() { return this.#tweenOptions.duration; }\n    /**\n     * @returns Get easing function or easing function name.\n     */\n    get tweenEase() { return this.#tweenOptions.ease; }\n    /**\n     * @param duration - Set tween duration.\n     */\n    set tweenDuration(duration) {\n        if (!Number.isFinite(duration)) {\n            throw new TypeError(`'duration' is not a finite number.`);\n        }\n        if (duration < 0) {\n            duration = 0;\n        }\n        this.#tweenOptions.duration = duration;\n        this.#updateSubscribers();\n    }\n    /**\n     * @param ease - Set easing function by name or direct function.\n     */\n    set tweenEase(ease) {\n        const easeFn = getEasingFunc(ease);\n        if (typeof easeFn !== 'function') {\n            throw new TypeError(`'ease' is not a function or Svelte easing function name.`);\n        }\n        this.#tweenOptions.ease = ease;\n        this.#updateSubscribers();\n    }\n    /**\n     * Resets all options data to initial values.\n     */\n    reset() {\n        this.#tween = this.#initialTween;\n        this.#tweenOptions = Object.assign({}, this.#initialTweenOptions);\n        this.#updateSubscribers();\n    }\n    /**\n     * Resets tween enabled state to initial value.\n     */\n    resetTween() {\n        this.#tween = this.#initialTween;\n        this.#updateSubscribers();\n    }\n    /**\n     * Resets tween options to initial values.\n     */\n    resetTweenOptions() {\n        this.#tweenOptions = Object.assign({}, this.#initialTweenOptions);\n        this.#updateSubscribers();\n    }\n    /**\n     * Store subscribe method.\n     *\n     * @param handler - Callback function that is invoked on update / changes. Receives the DraggableOptionsStore\n     *        instance.\n     *\n     * @returns Unsubscribe function.\n     */\n    subscribe(handler) {\n        const currentIdx = this.#subscribers.findIndex((entry) => entry === handler);\n        if (currentIdx === -1) {\n            this.#subscribers.push(handler); // add handler to the array of subscribers\n            handler(this); // call handler with current value\n        }\n        // Return unsubscribe function.\n        return () => {\n            const existingIdx = this.#subscribers.findIndex((entry) => entry === handler);\n            if (existingIdx !== -1) {\n                this.#subscribers.splice(existingIdx, 1);\n            }\n        };\n    }\n    #updateSubscribers() {\n        const subscriptions = this.#subscribers;\n        // Early out if there are no subscribers.\n        if (subscriptions.length > 0) {\n            for (let cntr = 0; cntr < subscriptions.length; cntr++) {\n                subscriptions[cntr](this);\n            }\n        }\n    }\n}\n/**\n * Define a function to get a DraggableOptionsStore instance.\n *\n * @param options - Initial options for DraggableOptionsStore.\n *\n * @returns A new options instance.\n */\ndraggable.options = (options) => new DraggableOptionsStore(options);\n\n/**\n * Provides a basic animation implementation for TJSPosition animation.\n */\nclass AnimationControl {\n    /**\n     */\n    #animationData;\n    /**\n     */\n    #finishedPromise;\n    /**\n     */\n    #willFinish;\n    /**\n     * Defines a static empty / void animation control.\n     */\n    static #voidControl = new AnimationControl(null);\n    /**\n     * Provides a static void / undefined AnimationControl that is automatically resolved.\n     */\n    static get voidControl() { return this.#voidControl; }\n    /**\n     * @param [animationData] - Animation data.\n     *\n     * @param [willFinish] - Promise that tracks animation finished state.\n     */\n    constructor(animationData, willFinish = false) {\n        this.#animationData = animationData;\n        this.#willFinish = willFinish;\n        // Set this control to animation data.\n        if (isObject(animationData)) {\n            animationData.control = this;\n        }\n    }\n    /**\n     * Get a promise that resolves when animation is finished.\n     *\n     * @returns Animation finished Promise.\n     */\n    get finished() {\n        if (!CrossWindow.isPromise(this.#finishedPromise)) {\n            this.#finishedPromise = this.#willFinish ? new Promise((resolve) => this.#animationData.resolve = resolve) :\n                Promise.resolve({ cancelled: false });\n        }\n        return this.#finishedPromise;\n    }\n    /**\n     * Returns whether this animation is currently active / animating.\n     *\n     * Note: a delayed animation may not be started / active yet. Use {@link AnimationControl.isFinished} to determine\n     * if an animation is actually finished.\n     *\n     * @returns Animation active state.\n     */\n    get isActive() { return this.#animationData?.active ?? false; }\n    /**\n     * Returns whether this animation is completely finished.\n     *\n     * @returns Animation finished state.\n     */\n    get isFinished() { return this.#animationData?.finished ?? true; }\n    /**\n     * Cancels the animation.\n     */\n    cancel() {\n        const animationData = this.#animationData;\n        if (animationData === null || animationData === void 0) {\n            return;\n        }\n        // Set cancelled state to true and this animation data instance will be removed from AnimationManager on next\n        // update.\n        animationData.cancelled = true;\n    }\n}\n\n/**\n * Provides animation management and scheduling allowing all TJSPosition instances to utilize one micro-task.\n */\nclass AnimationManager {\n    /**\n     * Cancels all animations except `quickTo` animations.\n     */\n    static cancelFn = (data) => data?.quickTo !== true;\n    /**\n     * Cancels all animations.\n     */\n    static cancelAllFn = () => true;\n    /**\n     * Defines the options used for {@link TJSPosition.set}.\n     */\n    static #tjsPositionSetOptions = Object.freeze({ immediateElementUpdate: true });\n    /**\n     */\n    static #activeList = [];\n    /**\n     * Provides the `this` context for {@link AnimationManager.animate} to be scheduled on rAF.\n     */\n    static #animateBound = (timeFrame) => this.animate(timeFrame);\n    /**\n     */\n    static #pendingList = [];\n    /**\n     * Tracks whether a requestAnimationFrame callback is pending via {@link AnimationManager.add};\n     */\n    static #rafPending = false;\n    /**\n     * Time of last `rAF` callback.\n     */\n    static #timeFrame;\n    /**\n     * Time of `performance.now()` at last `rAF` callback.\n     */\n    static #timeNow;\n    /**\n     * @returns Time of last `rAF` callback.\n     */\n    static get timeFrame() {\n        return this.#timeFrame;\n    }\n    /**\n     * @returns Time of `performance.now()` at last `rAF` callback.\n     */\n    static get timeNow() {\n        return this.#timeNow;\n    }\n    /**\n     * Add animation data.\n     *\n     * @param data -\n     */\n    static add(data) {\n        if (data.cancelled) {\n            this.#cleanupData(data);\n            return;\n        }\n        AnimationManager.#pendingList.push(data);\n        // If there is no rAF pending schedule one now.\n        if (!AnimationManager.#rafPending) {\n            AnimationManager.#rafPending = true;\n            globalThis.requestAnimationFrame(this.#animateBound);\n        }\n    }\n    /**\n     * Manage all animation.\n     *\n     * @param timeFrame - rAF callback time.\n     */\n    static animate(timeFrame) {\n        AnimationManager.#rafPending = false;\n        AnimationManager.#timeNow = globalThis.performance.now();\n        AnimationManager.#timeFrame = timeFrame;\n        // Early out of the continual rAF callback when there are no current animations scheduled.\n        if (AnimationManager.#activeList.length === 0 && AnimationManager.#pendingList.length === 0) {\n            return;\n        }\n        if (AnimationManager.#pendingList.length) {\n            // Process new data\n            for (let cntr = AnimationManager.#pendingList.length; --cntr >= 0;) {\n                const data = AnimationManager.#pendingList[cntr];\n                // If animation instance has been cancelled before start then remove it from new list and cleanup.\n                if (data.cancelled || (data.el !== void 0 && !data.el.isConnected)) {\n                    AnimationManager.#pendingList.splice(cntr, 1);\n                    this.#cleanupData(data);\n                }\n                // If data is active then process it now. Delayed animations start with `active` false.\n                if (data.active) {\n                    // Set any transform origin for the animation.\n                    if (data.transformOrigin) {\n                        data.position.set({ transformOrigin: data.transformOrigin });\n                    }\n                    data.start = AnimationManager.#timeFrame;\n                    // Remove from new list and add to active list.\n                    AnimationManager.#pendingList.splice(cntr, 1);\n                    AnimationManager.#activeList.push(data);\n                }\n            }\n        }\n        // Process active animations.\n        for (let cntr = AnimationManager.#activeList.length; --cntr >= 0;) {\n            const data = AnimationManager.#activeList[cntr];\n            // Remove any animations that have been canceled.\n            if (data.cancelled || (data.el !== void 0 && !data.el.isConnected)) {\n                AnimationManager.#activeList.splice(cntr, 1);\n                this.#cleanupData(data);\n                continue;\n            }\n            data.current = timeFrame - data.start;\n            // Remove this animation instance if current animating time exceeds duration.\n            if (data.current >= data.duration) {\n                // Prepare final update with end position data.\n                for (let dataCntr = data.keys.length; --dataCntr >= 0;) {\n                    const key = data.keys[dataCntr];\n                    data.newData[key] = data.destination[key];\n                }\n                data.position.set(data.newData, AnimationManager.#tjsPositionSetOptions);\n                AnimationManager.#activeList.splice(cntr, 1);\n                this.#cleanupData(data);\n                continue;\n            }\n            // Apply easing to create an eased time.\n            const easedTime = data.ease(data.current / data.duration);\n            for (let dataCntr = data.keys.length; --dataCntr >= 0;) {\n                const key = data.keys[dataCntr];\n                data.newData[key] = data.interpolate(data.initial[key], data.destination[key], easedTime);\n            }\n            data.position.set(data.newData, AnimationManager.#tjsPositionSetOptions);\n        }\n        globalThis.requestAnimationFrame(this.#animateBound);\n    }\n    /**\n     * Cancels all animations for given TJSPosition instance.\n     *\n     * @param position - TJSPosition instance.\n     *\n     * @param [cancelFn] - An optional function to control cancelling animations.\n     */\n    static cancel(position, cancelFn = AnimationManager.cancelFn) {\n        for (let cntr = AnimationManager.#activeList.length; --cntr >= 0;) {\n            const data = AnimationManager.#activeList[cntr];\n            if (data.position === position && cancelFn(data)) {\n                AnimationManager.#activeList.splice(cntr, 1);\n                data.cancelled = true;\n                this.#cleanupData(data);\n            }\n        }\n        for (let cntr = AnimationManager.#pendingList.length; --cntr >= 0;) {\n            const data = AnimationManager.#pendingList[cntr];\n            if (data.position === position && cancelFn(data)) {\n                AnimationManager.#pendingList.splice(cntr, 1);\n                data.cancelled = true;\n                this.#cleanupData(data);\n            }\n        }\n    }\n    /**\n     * Cancels all active and delayed animations.\n     */\n    static cancelAll() {\n        for (let cntr = AnimationManager.#activeList.length; --cntr >= 0;) {\n            const data = AnimationManager.#activeList[cntr];\n            data.cancelled = true;\n            this.#cleanupData(data);\n        }\n        for (let cntr = AnimationManager.#pendingList.length; --cntr >= 0;) {\n            const data = AnimationManager.#pendingList[cntr];\n            data.cancelled = true;\n            this.#cleanupData(data);\n        }\n        AnimationManager.#activeList.length = 0;\n        AnimationManager.#pendingList.length = 0;\n    }\n    /**\n     * @param data - Animation data to cleanup.\n     */\n    static #cleanupData(data) {\n        // Update state.\n        data.active = false;\n        data.finished = true;\n        // Reset any transform origin for the animation to initial value.\n        if (data.transformOriginInitial) {\n            data.position.set({ transformOrigin: data.transformOriginInitial });\n        }\n        if (typeof data.cleanup === 'function') {\n            data.cleanup(data);\n        }\n        if (typeof data.resolve === 'function') {\n            data.resolve({ cancelled: data.cancelled });\n        }\n        // Remove retained data if not a `quickTo` animation.\n        if (!data.quickTo) {\n            data.cleanup = void 0;\n            data.control = void 0;\n            data.destination = void 0;\n            data.el = void 0;\n            data.ease = void 0;\n            data.initial = void 0;\n            data.interpolate = void 0;\n            data.keys = void 0;\n            data.newData = void 0;\n            data.position = void 0;\n            data.resolve = void 0;\n        }\n    }\n    /**\n     * Gets all {@link AnimationControl} instances for a given TJSPosition instance.\n     *\n     * @param position - TJSPosition instance.\n     *\n     * @returns All scheduled AnimationControl instances for the given TJSPosition instance.\n     */\n    static getScheduled(position) {\n        const results = [];\n        for (let cntr = AnimationManager.#activeList.length; --cntr >= 0;) {\n            const data = AnimationManager.#activeList[cntr];\n            if (data.position === position && data.control) {\n                results.push(data.control);\n            }\n        }\n        for (let cntr = AnimationManager.#pendingList.length; --cntr >= 0;) {\n            const data = AnimationManager.#pendingList[cntr];\n            if (data.position === position && data.control) {\n                results.push(data.control);\n            }\n        }\n        return results;\n    }\n    /**\n     * Returns the status of any scheduled or pending animations for the given {@link TJSPosition} instance.\n     *\n     * @param position - TJSPosition instance.\n     *\n     * @param [options] - Scheduling options.\n     *\n     * @returns True if scheduled / false if not.\n     */\n    static isScheduled(position, { active = true, pending = true } = {}) {\n        if (active) {\n            for (let cntr = AnimationManager.#activeList.length; --cntr >= 0;) {\n                if (AnimationManager.#activeList[cntr].position === position) {\n                    return true;\n                }\n            }\n        }\n        if (pending) {\n            for (let cntr = AnimationManager.#pendingList.length; --cntr >= 0;) {\n                if (AnimationManager.#pendingList[cntr].position === position) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n}\n\n/**\n * Defines stored positional data.\n */\nclass TJSPositionData {\n    height;\n    left;\n    maxHeight;\n    maxWidth;\n    minHeight;\n    minWidth;\n    rotateX;\n    rotateY;\n    rotateZ;\n    scale;\n    top;\n    transformOrigin;\n    translateX;\n    translateY;\n    translateZ;\n    width;\n    zIndex;\n    /**\n     * @param [opts] - Options.\n     *\n     * @param [opts.height] -\n     *\n     * @param [opts.left] -\n     *\n     * @param [opts.maxHeight] -\n     *\n     * @param [opts.maxWidth] -\n     *\n     * @param [opts.minHeight] -\n     *\n     * @param [opts.minWidth] -\n     *\n     * @param [opts.rotateX] -\n     *\n     * @param [opts.rotateY] -\n     *\n     * @param [opts.rotateZ] -\n     *\n     * @param [opts.scale] -\n     *\n     * @param [opts.translateX] -\n     *\n     * @param [opts.translateY] -\n     *\n     * @param [opts.translateZ] -\n     *\n     * @param [opts.top] -\n     *\n     * @param [opts.transformOrigin] -\n     *\n     * @param [opts.width] -\n     *\n     * @param [opts.zIndex] -\n     *\n     * @param [opts.rotation] - Alias for `rotateZ`.\n     */\n    constructor({ height = null, left = null, maxHeight = null, maxWidth = null, minHeight = null, minWidth = null, rotateX = null, rotateY = null, rotateZ = null, scale = null, translateX = null, translateY = null, translateZ = null, top = null, transformOrigin = null, width = null, zIndex = null } = {}) {\n        this.height = height;\n        this.left = left;\n        this.maxHeight = maxHeight;\n        this.maxWidth = maxWidth;\n        this.minHeight = minHeight;\n        this.minWidth = minWidth;\n        this.rotateX = rotateX;\n        this.rotateY = rotateY;\n        this.rotateZ = rotateZ;\n        this.scale = scale;\n        this.top = top;\n        this.transformOrigin = transformOrigin;\n        this.translateX = translateX;\n        this.translateY = translateY;\n        this.translateZ = translateZ;\n        this.width = width;\n        this.zIndex = zIndex;\n    }\n}\n\n/**\n * Various internal utilities to work with {@link TJSPositionData}.\n */\nclass TJSPositionDataUtil {\n    /**\n     * Stores the TJSPositionData properties that can be animated.\n     */\n    static #animateKeys = Object.freeze(new Set([\n        // Main keys\n        'left', 'top', 'maxWidth', 'maxHeight', 'minWidth', 'minHeight', 'width', 'height',\n        'rotateX', 'rotateY', 'rotateZ', 'scale', 'translateX', 'translateY', 'translateZ', 'zIndex',\n        // Aliases\n        'rotation'\n    ]));\n    /**\n     * Stores the TJSPositionData property aliases that can be animated.\n     */\n    static #animateKeyAliases = Object.freeze(new Map([['rotation', 'rotateZ']]));\n    /**\n     * Provides numeric defaults for all parameters. This is used by {@link TJSPosition.get} to optionally provide\n     * numeric defaults.\n     */\n    static #numericDefaults = Object.freeze({\n        // Other keys\n        height: 0,\n        left: 0,\n        maxHeight: null,\n        maxWidth: null,\n        minHeight: null,\n        minWidth: null,\n        top: 0,\n        transformOrigin: null,\n        width: 0,\n        zIndex: null,\n        rotateX: 0,\n        rotateY: 0,\n        rotateZ: 0,\n        scale: 1,\n        translateX: 0,\n        translateY: 0,\n        translateZ: 0\n    });\n    /**\n     * Convenience to copy from source to target of two TJSPositionData like objects. If a target is not supplied a new\n     * {@link TJSPositionData} instance is created.\n     *\n     * @param source - The source instance to copy from.\n     *\n     * @param [target] - Target TJSPositionData like object; if one is not provided a new instance is created.\n     *\n     * @returns The target instance with all TJSPositionData fields.\n     */\n    static copyData(source, target = new TJSPositionData()) {\n        target.height = source.height ?? null;\n        target.left = source.left ?? null;\n        target.maxHeight = source.maxHeight ?? null;\n        target.maxWidth = source.maxWidth ?? null;\n        target.minHeight = source.minHeight ?? null;\n        target.minWidth = source.minWidth ?? null;\n        target.rotateX = source.rotateX ?? null;\n        target.rotateY = source.rotateY ?? null;\n        target.rotateZ = source.rotateZ ?? null;\n        target.scale = source.scale ?? null;\n        target.top = source.top ?? null;\n        target.transformOrigin = source.transformOrigin ?? null;\n        target.translateX = source.translateX ?? null;\n        target.translateY = source.translateY ?? null;\n        target.translateZ = source.translateZ ?? null;\n        target.width = source.width ?? null;\n        target.zIndex = source.zIndex ?? null;\n        return target;\n    }\n    /**\n     * Returns the non-aliased animation key.\n     *\n     * @param key - Animation key / possibly aliased key.\n     *\n     * @returns Actual non-aliased animation key.\n     */\n    static getAnimationKey(key) {\n        return this.#animateKeyAliases.get(key) ?? key;\n    }\n    /**\n     * Queries an object by the given key or otherwise returns any numeric default.\n     *\n     * @param data - An object to query for the given animation key.\n     *\n     * @param key - Animation key.\n     *\n     * @returns Data at key or numeric default.\n     */\n    static getDataOrDefault(data, key) {\n        key = this.#animateKeyAliases.get(key) ?? key;\n        return data[key] ?? this.#numericDefaults[key];\n    }\n    /**\n     * Tests if the given key is an animation key.\n     *\n     * @param key - A potential animation key.\n     *\n     * @returns Is animation key.\n     */\n    static isAnimationKey(key) {\n        return this.#animateKeys.has(key);\n    }\n    /**\n     * Sets numeric defaults for a {@link TJSPositionData} like object.\n     *\n     * @param data - A TJSPositionData like object.\n     */\n    static setNumericDefaults(data) {\n        // Transform keys\n        if (data.rotateX === null) {\n            data.rotateX = 0;\n        }\n        if (data.rotateY === null) {\n            data.rotateY = 0;\n        }\n        if (data.rotateZ === null) {\n            data.rotateZ = 0;\n        }\n        if (data.translateX === null) {\n            data.translateX = 0;\n        }\n        if (data.translateY === null) {\n            data.translateY = 0;\n        }\n        if (data.translateZ === null) {\n            data.translateZ = 0;\n        }\n        if (data.scale === null) {\n            data.scale = 1;\n        }\n    }\n}\n\n/**\n * Converts {@link TJSPositionData} properties defined as strings to number values. The string values can be defined\n * as relative adjustments with a leading operator. Various unit formats are supported as well.\n */\nclass ConvertStringData {\n    /**\n     * Animation keys for different processing categories.\n     */\n    static #animKeyTypes = {\n        // Animation keys that can be specified in `px` converted to a number.\n        numPx: Object.freeze(new Set(['left', 'top', 'maxWidth', 'maxHeight', 'minWidth', 'minHeight', 'width', 'height',\n            'translateX', 'translateY', 'translateZ'])),\n        // Animation keys that can be specified in percentage of parent element constraint.\n        percentParent: Object.freeze(new Set(['left', 'top', 'maxWidth', 'maxHeight', 'minWidth', 'minHeight', 'width',\n            'height'])),\n        // Only rotation animation keys can be specified in `rad` / `turn` converted to a number.\n        rotationRadTurn: Object.freeze(new Set(['rotateX', 'rotateY', 'rotateZ', 'rotation']))\n    };\n    /**\n     * Parses string data values. Relative values must start with leading values '+=', '-=', or '*=' followed by a\n     * float / numeric value. IE `+=45` or for percentage '+=10%'. Also handles exact percent value such as `10` or\n     * `10%`. Percentage values are based on the current value, parent element constraints, or constraints of the type\n     * of value like rotation being bound by 360 degrees.\n     *\n     * @privateRemarks\n     * TODO: In the future support more specific CSS unit types.\n     */\n    static #regexStringData = /^(?<operation>[-+*]=)?(?<value>-?\\d*\\.?\\d+)(?<unit>%|%~|px|rad|turn)?$/;\n    /**\n     * Stores the results for match groups from `regexStringData`;\n     */\n    static #matchResults = Object.seal({\n        operation: void 0,\n        value: 0,\n        unit: void 0\n    });\n    /**\n     * Converts any relative string values for animatable keys to actual updates performed against current data.\n     *\n     * @param data - position data.\n     *\n     * @param position - The source position data.\n     *\n     * @param el - Target positioned element.\n     *\n     * @returns Converted data.\n     */\n    static process(data, position, el) {\n        // Used in `%` calculations. The first `%` conversion that requires parent element height and width will attempt\n        // to cache the parent element client height & width of the given element.\n        let parentClientHeight = Number.NaN;\n        let parentClientWidth = Number.NaN;\n        for (const key in data) {\n            // Key is animatable / numeric.\n            if (TJSPositionDataUtil.isAnimationKey(key)) {\n                const value = data[key];\n                if (typeof value !== 'string') {\n                    continue;\n                }\n                // Ignore 'auto' and 'inherit' string values.\n                if (value === 'auto' || value === 'inherit') {\n                    continue;\n                }\n                const animKey = key;\n                const regexResults = this.#regexStringData.exec(value);\n                // Additional state indicating a particular key is handled.\n                let handled = false;\n                if (regexResults && regexResults.groups) {\n                    const results = this.#matchResults;\n                    results.operation = regexResults.groups.operation;\n                    results.value = parseFloat(regexResults.groups.value);\n                    results.unit = regexResults.groups.unit;\n                    // Retrieve current value, but if null use the numeric default.\n                    const current = TJSPositionDataUtil.getDataOrDefault(position, key);\n                    switch (results.unit) {\n                        // Animation keys that support percentage changes including constraints against the parent element.\n                        case '%':\n                            {\n                                // Cache parent client width / height on first parent percent based key.\n                                if (this.#animKeyTypes.percentParent.has(key) && (Number.isNaN(parentClientHeight) ||\n                                    Number.isNaN(parentClientWidth))) {\n                                    if (el?.parentElement?.isConnected) {\n                                        parentClientHeight = el.parentElement.clientHeight;\n                                        parentClientWidth = el.parentElement.clientWidth;\n                                    }\n                                    else {\n                                        parentClientHeight = 0;\n                                        parentClientWidth = 0;\n                                        console.warn(`TJSPosition - ConvertStringData warning: could not determine parent constraints for key '${key}' with value '${value}'.`);\n                                        data[key] = void 0;\n                                        continue;\n                                    }\n                                }\n                                handled = this.#handlePercent(animKey, current, data, results, parentClientHeight, parentClientWidth);\n                                break;\n                            }\n                        // Animation keys that support percentage changes from current values.\n                        case '%~':\n                            handled = this.#handleRelativePercent(animKey, current, data, results);\n                            break;\n                        // Animation keys that support `px` / treat as raw number.\n                        case 'px':\n                            handled = this.#animKeyTypes.numPx.has(key) ?\n                                this.#applyResultsValue(animKey, current, data, results) : false;\n                            break;\n                        // Only rotation animation keys support `rad` / `turn`.\n                        case 'rad':\n                        case 'turn':\n                            handled = this.#animKeyTypes.rotationRadTurn.has(key) ?\n                                this.#handleRotationRadTurn(animKey, current, data, results) : false;\n                            break;\n                        // No units / treat as raw number.\n                        default:\n                            handled = this.#applyResultsValue(animKey, current, data, results);\n                            break;\n                    }\n                }\n                if (!regexResults || !handled) {\n                    console.warn(`TJSPosition - ConvertStringData warning: malformed key '${key}' with value '${value}'.`);\n                    data[key] = void 0;\n                }\n            }\n        }\n        return data;\n    }\n    // Internal implementation ----------------------------------------------------------------------------------------\n    /**\n     * Provides the common update to source data after `results.value` has been converted to the proper value\n     * respectively.\n     *\n     * @param key - Animation key.\n     *\n     * @param current - Current value\n     *\n     * @param data - Source data to convert.\n     *\n     * @param results - Match results.\n     *\n     * @returns Adjustment successful.\n     */\n    static #applyResultsValue(key, current, data, results) {\n        if (!results.operation) {\n            data[key] = results.value;\n            return true;\n        }\n        switch (results.operation) {\n            case '-=':\n                data[key] = current - results.value;\n                break;\n            case '+=':\n                data[key] = current + results.value;\n                break;\n            case '*=':\n                data[key] = current * results.value;\n                break;\n            default:\n                return false;\n        }\n        return true;\n    }\n    /**\n     * Handles the `%` unit type where values are adjusted against the parent element client width / height or in the\n     * case of rotation the percentage of 360 degrees.\n     *\n     * @param key - Animation key.\n     *\n     * @param current - Current value\n     *\n     * @param data - Source data to convert.\n     *\n     * @param results - Match results.\n     *\n     * @param parentClientHeight - Parent element client height.\n     *\n     * @param parentClientWidth - Parent element client width.\n     *\n     * @returns Adjustment successful.\n     */\n    static #handlePercent(key, current, data, results, parentClientHeight, parentClientWidth) {\n        switch (key) {\n            // Calculate value; take into account keys that calculate parent client width.\n            case 'left':\n            case 'maxWidth':\n            case 'minWidth':\n            case 'width':\n            case 'translateX':\n                results.value = parentClientWidth * (results.value / 100);\n                break;\n            // Calculate value; take into account keys that calculate parent client height.\n            case 'top':\n            case 'maxHeight':\n            case 'minHeight':\n            case 'height':\n            case 'translateY':\n                results.value = parentClientHeight * (results.value / 100);\n                break;\n            // Calculate value; convert percentage into degrees\n            case 'rotateX':\n            case 'rotateY':\n            case 'rotateZ':\n            case 'rotation':\n                results.value = 360 * (results.value / 100);\n                break;\n            default:\n                return false;\n        }\n        return this.#applyResultsValue(key, current, data, results);\n    }\n    /**\n     * Handles the `%~` unit type where values are adjusted against the current value for the given key.\n     *\n     * @param key - Animation key.\n     *\n     * @param current - Current value\n     *\n     * @param data - Source data to convert.\n     *\n     * @param results - Match results.\n     *\n     * @returns Adjustment successful.\n     */\n    static #handleRelativePercent(key, current, data, results) {\n        // Normalize percentage.\n        results.value = results.value / 100;\n        if (!results.operation) {\n            data[key] = current * results.value;\n            return true;\n        }\n        switch (results.operation) {\n            case '-=':\n                data[key] = current - (current * results.value);\n                break;\n            case '+=':\n                data[key] = current + (current * results.value);\n                break;\n            case '*=':\n                data[key] = current * (current * results.value);\n                break;\n            default:\n                return false;\n        }\n        return true;\n    }\n    /**\n     * Handles the `rad` / `turn` unit types for rotation animation keys.\n     *\n     * @param key - Animation key.\n     *\n     * @param current - Current value\n     *\n     * @param data - Source data to convert.\n     *\n     * @param results - Match results.\n     *\n     * @returns Adjustment successful.\n     */\n    static #handleRotationRadTurn(key, current, data, results) {\n        // Convert radians / turn into degrees.\n        switch (results.unit) {\n            case 'rad':\n                results.value = radToDeg(results.value);\n                break;\n            case 'turn':\n                results.value = 360 * results.value;\n                break;\n        }\n        return this.#applyResultsValue(key, current, data, results);\n    }\n}\n\n/**\n * Provides the output data for {@link TransformAPI.getData}.\n */\nclass TJSTransformData {\n    constructor() {\n        Object.seal(this);\n    }\n    /**\n     * Stores the calculated bounding rectangle.\n     */\n    #boundingRect = new DOMRect();\n    /**\n     * Stores the individual transformed corner points of the window in screen space clockwise from:\n     * top left -> top right -> bottom right -> bottom left.\n     */\n    #corners = [new Vec3(), new Vec3(), new Vec3(), new Vec3()];\n    /**\n     * Stores the current gl-matrix Mat4 data.\n     */\n    #mat4 = new Mat4();\n    /**\n     * Stores the pre-origin & post-origin translations to apply to matrix transforms.\n     */\n    #originTranslations = [new Mat4(), new Mat4()];\n    /**\n     * @returns The bounding rectangle.\n     */\n    get boundingRect() { return this.#boundingRect; }\n    /**\n     * @returns The transformed corner points as Vec3 in screen space.\n     */\n    get corners() { return this.#corners; }\n    /**\n     * @returns Returns the CSS style string for the transform matrix.\n     */\n    get css() { return `matrix3d(${this.mat4.join(',')})`; }\n    /**\n     * @returns The transform matrix.\n     */\n    get mat4() { return this.#mat4; }\n    /**\n     * @returns The pre / post translation matrices for origin translation.\n     */\n    get originTranslations() { return this.#originTranslations; }\n}\n\n/**\n * Provides type guards for `Number`.\n */\nclass NumberGuard {\n    constructor() { }\n    static isFinite(value) {\n        return typeof value === 'number' && Number.isFinite(value);\n    }\n    static isFiniteOrNull(value) {\n        return value === null || (typeof value === 'number' && Number.isFinite(value));\n    }\n}\n\n/**\n * Caches computed styles of a {@link TJSPosition} target element.\n */\nclass TJSPositionStyleCache {\n    el;\n    computed;\n    marginLeft;\n    marginTop;\n    maxHeight;\n    maxWidth;\n    minHeight;\n    minWidth;\n    hasWillChange;\n    stores;\n    resizeObserved;\n    constructor() {\n        this.el = void 0;\n        this.computed = void 0;\n        this.marginLeft = void 0;\n        this.marginTop = void 0;\n        this.maxHeight = void 0;\n        this.maxWidth = void 0;\n        this.minHeight = void 0;\n        this.minWidth = void 0;\n        this.hasWillChange = false;\n        this.resizeObserved = Object.seal({\n            contentHeight: void 0,\n            contentWidth: void 0,\n            offsetHeight: void 0,\n            offsetWidth: void 0\n        });\n        /**\n         * Provides a writable store to track offset & content width / height from an associated `resizeObserver` action.\n         */\n        const storeResizeObserved = writable(this.resizeObserved);\n        this.stores = {\n            element: writable(this.el),\n            resizeContentHeight: propertyStore(storeResizeObserved, 'contentHeight'),\n            resizeContentWidth: propertyStore(storeResizeObserved, 'contentWidth'),\n            resizeObserved: storeResizeObserved,\n            resizeObservable: writable(false),\n            resizeOffsetHeight: propertyStore(storeResizeObserved, 'offsetHeight'),\n            resizeOffsetWidth: propertyStore(storeResizeObserved, 'offsetWidth')\n        };\n    }\n    /**\n     * Returns the cached offsetHeight from any attached `resizeObserver` action otherwise gets the offsetHeight from\n     * the element directly. The more optimized path is using `resizeObserver` as getting it from the element\n     * directly is more expensive and alters the execution order of an animation frame.\n     *\n     * @returns The element offsetHeight.\n     */\n    get offsetHeight() {\n        if (this.el !== void 0 && A11yHelper.isFocusTarget(this.el)) {\n            return this.resizeObserved.offsetHeight !== void 0 ? this.resizeObserved.offsetHeight : this.el.offsetHeight;\n        }\n        throw new Error(`TJSPositionStyleCache - get offsetHeight error: no element assigned.`);\n    }\n    /**\n     * Returns the cached offsetWidth from any attached `resizeObserver` action otherwise gets the offsetWidth from\n     * the element directly. The more optimized path is using `resizeObserver` as getting it from the element\n     * directly is more expensive and alters the execution order of an animation frame.\n     *\n     * @returns The element offsetHeight.\n     */\n    get offsetWidth() {\n        if (this.el !== void 0 && A11yHelper.isFocusTarget(this.el)) {\n            return this.resizeObserved.offsetWidth !== void 0 ? this.resizeObserved.offsetWidth : this.el.offsetWidth;\n        }\n        throw new Error(`TJSPositionStyleCache - get offsetWidth error: no element assigned.`);\n    }\n    /**\n     * @param el -\n     *\n     * @returns Does element match cached element.\n     */\n    hasData(el) { return this.el === el; }\n    /**\n     * Resets the style cache.\n     */\n    reset() {\n        // Remove will-change inline style from previous element if it is still connected.\n        if (this.el !== void 0 && A11yHelper.isFocusTarget(this.el) && this.el.isConnected && !this.hasWillChange) {\n            this.el.style.willChange = '';\n        }\n        this.el = void 0;\n        this.computed = void 0;\n        this.marginLeft = void 0;\n        this.marginTop = void 0;\n        this.maxHeight = void 0;\n        this.maxWidth = void 0;\n        this.minHeight = void 0;\n        this.minWidth = void 0;\n        this.hasWillChange = false;\n        // Silently reset `resizedObserved`; With proper usage the `resizeObserver` action issues an update on removal.\n        this.resizeObserved.contentHeight = void 0;\n        this.resizeObserved.contentWidth = void 0;\n        this.resizeObserved.offsetHeight = void 0;\n        this.resizeObserved.offsetWidth = void 0;\n        // Reset the tracked element this TJSPosition instance is modifying.\n        this.stores.element.set(void 0);\n    }\n    /**\n     * Updates the style cache with new data from the given element.\n     *\n     * @param el - An HTML element.\n     */\n    update(el) {\n        this.el = el;\n        this.computed = globalThis.getComputedStyle(el);\n        this.marginLeft = StyleParse.pixels(el.style.marginLeft) ?? StyleParse.pixels(this.computed.marginLeft);\n        this.marginTop = StyleParse.pixels(el.style.marginTop) ?? StyleParse.pixels(this.computed.marginTop);\n        this.maxHeight = StyleParse.pixels(el.style.maxHeight) ?? StyleParse.pixels(this.computed.maxHeight);\n        this.maxWidth = StyleParse.pixels(el.style.maxWidth) ?? StyleParse.pixels(this.computed.maxWidth);\n        // Note that the computed styles for below will always be 0px / 0 when no style is active.\n        this.minHeight = StyleParse.pixels(el.style.minHeight) ?? StyleParse.pixels(this.computed.minHeight);\n        this.minWidth = StyleParse.pixels(el.style.minWidth) ?? StyleParse.pixels(this.computed.minWidth);\n        // Tracks if there already is a will-change property on the inline or computed styles.\n        const willChange = el.style.willChange !== '' ? el.style.willChange : this.computed.willChange ?? '';\n        this.hasWillChange = willChange !== '' && willChange !== 'auto';\n        // Update the tracked element this TJSPosition instance is modifying.\n        this.stores.element.set(el);\n    }\n}\n\n/**\n *\n */\nclass TJSTransforms {\n    /**\n     * Stores transform data.\n     */\n    #data = {};\n    /**\n     * Stores the transform keys in the order added.\n     */\n    #orderList = [];\n    /**\n     * Defines the keys of TJSPositionData that are transform keys.\n     */\n    static #transformKeys = Object.freeze([\n        'rotateX', 'rotateY', 'rotateZ', 'scale', 'translateX', 'translateY', 'translateZ'\n    ]);\n    /**\n     * Validates that a given key is a transform key.\n     *\n     * @param key - A potential transform key.\n     */\n    static #isTransformKey(key) {\n        return this.#transformKeys.includes(key);\n    }\n    /**\n     * Defines bitwise keys for transforms used in {@link TJSTransforms.getMat4}.\n     */\n    static #transformKeysBitwise = Object.freeze({\n        rotateX: 1,\n        rotateY: 2,\n        rotateZ: 4,\n        scale: 8,\n        translateX: 16,\n        translateY: 32,\n        translateZ: 64\n    });\n    /**\n     * Defines the default transform origin.\n     */\n    static #transformOriginDefault = 'top left';\n    /**\n     * Defines the valid transform origins.\n     */\n    static #transformOrigins = Object.freeze([\n        'top left', 'top center', 'top right', 'center left', 'center', 'center right', 'bottom left', 'bottom center',\n        'bottom right'\n    ]);\n    /**\n     * Defines a valid Set of transform origins.\n     */\n    static #transformOriginsSet = Object.freeze(new Set(this.#transformOrigins));\n    // Temporary variables --------------------------------------------------------------------------------------------\n    /**\n     */\n    static #mat4Result = new Mat4();\n    /**\n     */\n    static #mat4Temp = new Mat4();\n    /**\n     */\n    static #vec3Temp = new Vec3();\n    /**\n     */\n    static #vectorScale = [1, 1, 1];\n    /**\n     */\n    static #vectorTranslate = [0, 0, 0];\n    /**\n     * Returns a list of supported transform origins.\n     *\n     * @returns The supported transform origin strings.\n     */\n    static get transformOrigins() {\n        return this.#transformOrigins;\n    }\n    /**\n     * Returns whether the given string is a {@link TransformAPI.TransformOrigin}.\n     *\n     * @param origin - A potential transform origin string.\n     *\n     * @returns True if origin is a TransformOrigin string.\n     */\n    static isTransformOrigin(origin) {\n        return this.#transformOriginsSet.has(origin);\n    }\n    /**\n     * @returns Whether there are active transforms in local data.\n     */\n    get isActive() { return this.#orderList.length > 0; }\n    /**\n     * @returns Any local rotateX data.\n     */\n    get rotateX() { return this.#data.rotateX; }\n    /**\n     * @returns Any local rotateY data.\n     */\n    get rotateY() { return this.#data.rotateY; }\n    /**\n     * @returns Any local rotateZ data.\n     */\n    get rotateZ() { return this.#data.rotateZ; }\n    /**\n     * @returns Any local rotateZ scale.\n     */\n    get scale() { return this.#data.scale; }\n    /**\n     * @returns Any local translateZ data.\n     */\n    get translateX() { return this.#data.translateX; }\n    /**\n     * @returns Any local translateZ data.\n     */\n    get translateY() { return this.#data.translateY; }\n    /**\n     * @returns Any local translateZ data.\n     */\n    get translateZ() { return this.#data.translateZ; }\n    /**\n     * Sets the local rotateX data if the value is a finite number otherwise removes the local data.\n     *\n     * @param value - A value to set.\n     */\n    set rotateX(value) {\n        if (Number.isFinite(value)) {\n            if (this.#data.rotateX === void 0) {\n                this.#orderList.push('rotateX');\n            }\n            this.#data.rotateX = value;\n        }\n        else {\n            if (this.#data.rotateX !== void 0) {\n                const index = this.#orderList.findIndex((entry) => entry === 'rotateX');\n                if (index >= 0) {\n                    this.#orderList.splice(index, 1);\n                }\n            }\n            delete this.#data.rotateX;\n        }\n    }\n    /**\n     * Sets the local rotateY data if the value is a finite number otherwise removes the local data.\n     *\n     * @param value - A value to set.\n     */\n    set rotateY(value) {\n        if (Number.isFinite(value)) {\n            if (this.#data.rotateY === void 0) {\n                this.#orderList.push('rotateY');\n            }\n            this.#data.rotateY = value;\n        }\n        else {\n            if (this.#data.rotateY !== void 0) {\n                const index = this.#orderList.findIndex((entry) => entry === 'rotateY');\n                if (index >= 0) {\n                    this.#orderList.splice(index, 1);\n                }\n            }\n            delete this.#data.rotateY;\n        }\n    }\n    /**\n     * Sets the local rotateZ data if the value is a finite number otherwise removes the local data.\n     *\n     * @param value - A value to set.\n     */\n    set rotateZ(value) {\n        if (Number.isFinite(value)) {\n            if (this.#data.rotateZ === void 0) {\n                this.#orderList.push('rotateZ');\n            }\n            this.#data.rotateZ = value;\n        }\n        else {\n            if (this.#data.rotateZ !== void 0) {\n                const index = this.#orderList.findIndex((entry) => entry === 'rotateZ');\n                if (index >= 0) {\n                    this.#orderList.splice(index, 1);\n                }\n            }\n            delete this.#data.rotateZ;\n        }\n    }\n    /**\n     * Sets the local scale data if the value is a finite number otherwise removes the local data.\n     *\n     * @param value - A value to set.\n     */\n    set scale(value) {\n        if (Number.isFinite(value)) {\n            if (this.#data.scale === void 0) {\n                this.#orderList.push('scale');\n            }\n            this.#data.scale = value;\n        }\n        else {\n            if (this.#data.scale !== void 0) {\n                const index = this.#orderList.findIndex((entry) => entry === 'scale');\n                if (index >= 0) {\n                    this.#orderList.splice(index, 1);\n                }\n            }\n            delete this.#data.scale;\n        }\n    }\n    /**\n     * Sets the local translateX data if the value is a finite number otherwise removes the local data.\n     *\n     * @param value - A value to set.\n     */\n    set translateX(value) {\n        if (Number.isFinite(value)) {\n            if (this.#data.translateX === void 0) {\n                this.#orderList.push('translateX');\n            }\n            this.#data.translateX = value;\n        }\n        else {\n            if (this.#data.translateX !== void 0) {\n                const index = this.#orderList.findIndex((entry) => entry === 'translateX');\n                if (index >= 0) {\n                    this.#orderList.splice(index, 1);\n                }\n            }\n            delete this.#data.translateX;\n        }\n    }\n    /**\n     * Sets the local translateY data if the value is a finite number otherwise removes the local data.\n     *\n     * @param value - A value to set.\n     */\n    set translateY(value) {\n        if (Number.isFinite(value)) {\n            if (this.#data.translateY === void 0) {\n                this.#orderList.push('translateY');\n            }\n            this.#data.translateY = value;\n        }\n        else {\n            if (this.#data.translateY !== void 0) {\n                const index = this.#orderList.findIndex((entry) => entry === 'translateY');\n                if (index >= 0) {\n                    this.#orderList.splice(index, 1);\n                }\n            }\n            delete this.#data.translateY;\n        }\n    }\n    /**\n     * Sets the local translateZ data if the value is a finite number otherwise removes the local data.\n     *\n     * @param value - A value to set.\n     */\n    set translateZ(value) {\n        if (Number.isFinite(value)) {\n            if (this.#data.translateZ === void 0) {\n                this.#orderList.push('translateZ');\n            }\n            this.#data.translateZ = value;\n        }\n        else {\n            if (this.#data.translateZ !== void 0) {\n                const index = this.#orderList.findIndex((entry) => entry === 'translateZ');\n                if (index >= 0) {\n                    this.#orderList.splice(index, 1);\n                }\n            }\n            delete this.#data.translateZ;\n        }\n    }\n    /**\n     * Returns the `matrix3d` CSS transform for the given position / transform data.\n     *\n     * @param [data] - Optional position data otherwise use local stored transform data.\n     *\n     * @returns The CSS `matrix3d` string.\n     */\n    getCSS(data = this.#data) {\n        return `matrix3d(${this.getMat4(data, TJSTransforms.#mat4Result).join(',')})`;\n    }\n    /**\n     * Returns the `matrix3d` CSS transform for the given position / transform data.\n     *\n     * @param [data] - Optional position data otherwise use local stored transform data.\n     *\n     * @returns The CSS `matrix3d` string.\n     */\n    getCSSOrtho(data = this.#data) {\n        return `matrix3d(${this.getMat4Ortho(data, TJSTransforms.#mat4Result).join(',')})`;\n    }\n    /**\n     * Collects all data including a bounding rect, transform matrix, and points array of the given\n     * {@link TJSPositionData} instance with the applied local transform data.\n     *\n     * @param position - The position data to process.\n     *\n     * @param [output] - Optional TJSTransformData output instance.\n     *\n     * @param [validationData] - Optional validation data for adjustment parameters.\n     *\n     * @returns The output TJSTransformData instance.\n     */\n    getData(position, output = new TJSTransformData(), validationData) {\n        const valWidth = validationData?.width ?? 0;\n        const valHeight = validationData?.height ?? 0;\n        const valOffsetTop = validationData?.offsetTop ?? validationData?.marginTop ?? 0;\n        const valOffsetLeft = validationData?.offsetLeft ?? validationData?.marginLeft ?? 0;\n        position.top += valOffsetTop;\n        position.left += valOffsetLeft;\n        const width = NumberGuard.isFinite(position.width) ? position.width : valWidth;\n        const height = NumberGuard.isFinite(position.height) ? position.height : valHeight;\n        const rect = output.corners;\n        if (this.hasTransform(position)) {\n            rect[0][0] = rect[0][1] = rect[0][2] = 0;\n            rect[1][0] = width;\n            rect[1][1] = rect[1][2] = 0;\n            rect[2][0] = width;\n            rect[2][1] = height;\n            rect[2][2] = 0;\n            rect[3][0] = 0;\n            rect[3][1] = height;\n            rect[3][2] = 0;\n            const matrix = this.getMat4(position, output.mat4);\n            const translate = TJSTransforms.#getOriginTranslation(position.transformOrigin, width, height, output.originTranslations);\n            if (TJSTransforms.#transformOriginDefault === position.transformOrigin) {\n                Vec3.transformMat4(rect[0], rect[0], matrix);\n                Vec3.transformMat4(rect[1], rect[1], matrix);\n                Vec3.transformMat4(rect[2], rect[2], matrix);\n                Vec3.transformMat4(rect[3], rect[3], matrix);\n            }\n            else {\n                Vec3.transformMat4(rect[0], rect[0], translate[0]);\n                Vec3.transformMat4(rect[0], rect[0], matrix);\n                Vec3.transformMat4(rect[0], rect[0], translate[1]);\n                Vec3.transformMat4(rect[1], rect[1], translate[0]);\n                Vec3.transformMat4(rect[1], rect[1], matrix);\n                Vec3.transformMat4(rect[1], rect[1], translate[1]);\n                Vec3.transformMat4(rect[2], rect[2], translate[0]);\n                Vec3.transformMat4(rect[2], rect[2], matrix);\n                Vec3.transformMat4(rect[2], rect[2], translate[1]);\n                Vec3.transformMat4(rect[3], rect[3], translate[0]);\n                Vec3.transformMat4(rect[3], rect[3], matrix);\n                Vec3.transformMat4(rect[3], rect[3], translate[1]);\n            }\n            rect[0][0] = position.left + rect[0][0];\n            rect[0][1] = position.top + rect[0][1];\n            rect[1][0] = position.left + rect[1][0];\n            rect[1][1] = position.top + rect[1][1];\n            rect[2][0] = position.left + rect[2][0];\n            rect[2][1] = position.top + rect[2][1];\n            rect[3][0] = position.left + rect[3][0];\n            rect[3][1] = position.top + rect[3][1];\n        }\n        else {\n            rect[0][0] = position.left;\n            rect[0][1] = position.top;\n            rect[1][0] = position.left + width;\n            rect[1][1] = position.top;\n            rect[2][0] = position.left + width;\n            rect[2][1] = position.top + height;\n            rect[3][0] = position.left;\n            rect[3][1] = position.top + height;\n            Mat4.identity(output.mat4);\n        }\n        let maxX = Number.MIN_SAFE_INTEGER;\n        let maxY = Number.MIN_SAFE_INTEGER;\n        let minX = Number.MAX_SAFE_INTEGER;\n        let minY = Number.MAX_SAFE_INTEGER;\n        for (let cntr = 4; --cntr >= 0;) {\n            if (rect[cntr][0] > maxX) {\n                maxX = rect[cntr][0];\n            }\n            if (rect[cntr][0] < minX) {\n                minX = rect[cntr][0];\n            }\n            if (rect[cntr][1] > maxY) {\n                maxY = rect[cntr][1];\n            }\n            if (rect[cntr][1] < minY) {\n                minY = rect[cntr][1];\n            }\n        }\n        const boundingRect = output.boundingRect;\n        boundingRect.x = minX;\n        boundingRect.y = minY;\n        boundingRect.width = maxX - minX;\n        boundingRect.height = maxY - minY;\n        position.top -= valOffsetTop;\n        position.left -= valOffsetLeft;\n        return output;\n    }\n    /**\n     * Creates a transform matrix based on local data applied in order it was added.\n     *\n     * If no data object is provided then the source is the local transform data. If another data object is supplied\n     * then the stored local transform order is applied then all remaining transform keys are applied. This allows the\n     * construction of a transform matrix in advance of setting local data and is useful in collision detection.\n     *\n     * @param [data] - TJSPositionData instance or local transform data.\n     *\n     * @param [output] - The output mat4 instance.\n     *\n     * @returns Transform matrix.\n     */\n    getMat4(data = this.#data, output = new Mat4()) {\n        const matrix = Mat4.identity(output);\n        // Bitwise tracks applied transform keys from local transform data.\n        let seenKeys = 0;\n        const orderList = this.#orderList;\n        // First apply ordered transforms from local transform data.\n        for (let cntr = 0; cntr < orderList.length; cntr++) {\n            const key = orderList[cntr];\n            switch (key) {\n                case 'rotateX':\n                    seenKeys |= TJSTransforms.#transformKeysBitwise.rotateX;\n                    Mat4.multiply(matrix, matrix, Mat4.fromXRotation(TJSTransforms.#mat4Temp, degToRad(data[key] ?? 0)));\n                    break;\n                case 'rotateY':\n                    seenKeys |= TJSTransforms.#transformKeysBitwise.rotateY;\n                    Mat4.multiply(matrix, matrix, Mat4.fromYRotation(TJSTransforms.#mat4Temp, degToRad(data[key] ?? 0)));\n                    break;\n                case 'rotateZ':\n                    seenKeys |= TJSTransforms.#transformKeysBitwise.rotateZ;\n                    Mat4.multiply(matrix, matrix, Mat4.fromZRotation(TJSTransforms.#mat4Temp, degToRad(data[key] ?? 0)));\n                    break;\n                case 'scale':\n                    seenKeys |= TJSTransforms.#transformKeysBitwise.scale;\n                    TJSTransforms.#vectorScale[0] = TJSTransforms.#vectorScale[1] = data[key] ?? 0;\n                    Mat4.multiply(matrix, matrix, Mat4.fromScaling(TJSTransforms.#mat4Temp, TJSTransforms.#vectorScale));\n                    break;\n                case 'translateX':\n                    seenKeys |= TJSTransforms.#transformKeysBitwise.translateX;\n                    TJSTransforms.#vectorTranslate[0] = data.translateX ?? 0;\n                    TJSTransforms.#vectorTranslate[1] = 0;\n                    TJSTransforms.#vectorTranslate[2] = 0;\n                    Mat4.multiply(matrix, matrix, Mat4.fromTranslation(TJSTransforms.#mat4Temp, TJSTransforms.#vectorTranslate));\n                    break;\n                case 'translateY':\n                    seenKeys |= TJSTransforms.#transformKeysBitwise.translateY;\n                    TJSTransforms.#vectorTranslate[0] = 0;\n                    TJSTransforms.#vectorTranslate[1] = data.translateY ?? 0;\n                    TJSTransforms.#vectorTranslate[2] = 0;\n                    Mat4.multiply(matrix, matrix, Mat4.fromTranslation(TJSTransforms.#mat4Temp, TJSTransforms.#vectorTranslate));\n                    break;\n                case 'translateZ':\n                    seenKeys |= TJSTransforms.#transformKeysBitwise.translateZ;\n                    TJSTransforms.#vectorTranslate[0] = 0;\n                    TJSTransforms.#vectorTranslate[1] = 0;\n                    TJSTransforms.#vectorTranslate[2] = data.translateZ ?? 0;\n                    Mat4.multiply(matrix, matrix, Mat4.fromTranslation(TJSTransforms.#mat4Temp, TJSTransforms.#vectorTranslate));\n                    break;\n            }\n        }\n        // Now apply any new keys not set in local transform data that have not been applied yet.\n        if (data !== this.#data) {\n            for (let cntr = 0; cntr < TJSTransforms.#transformKeys.length; cntr++) {\n                const key = TJSTransforms.#transformKeys[cntr];\n                // Reject bad / no data or if the key has already been applied.\n                if (data[key] === null || (seenKeys & TJSTransforms.#transformKeysBitwise[key]) > 0) {\n                    continue;\n                }\n                const value = data[key];\n                switch (key) {\n                    case 'rotateX':\n                        Mat4.multiply(matrix, matrix, Mat4.fromXRotation(TJSTransforms.#mat4Temp, degToRad(value)));\n                        break;\n                    case 'rotateY':\n                        Mat4.multiply(matrix, matrix, Mat4.fromYRotation(TJSTransforms.#mat4Temp, degToRad(value)));\n                        break;\n                    case 'rotateZ':\n                        Mat4.multiply(matrix, matrix, Mat4.fromZRotation(TJSTransforms.#mat4Temp, degToRad(value)));\n                        break;\n                    case 'scale':\n                        TJSTransforms.#vectorScale[0] = TJSTransforms.#vectorScale[1] = value;\n                        Mat4.multiply(matrix, matrix, Mat4.fromScaling(TJSTransforms.#mat4Temp, TJSTransforms.#vectorScale));\n                        break;\n                    case 'translateX':\n                        TJSTransforms.#vectorTranslate[0] = value;\n                        TJSTransforms.#vectorTranslate[1] = 0;\n                        TJSTransforms.#vectorTranslate[2] = 0;\n                        Mat4.multiply(matrix, matrix, Mat4.fromTranslation(TJSTransforms.#mat4Temp, TJSTransforms.#vectorTranslate));\n                        break;\n                    case 'translateY':\n                        TJSTransforms.#vectorTranslate[0] = 0;\n                        TJSTransforms.#vectorTranslate[1] = value;\n                        TJSTransforms.#vectorTranslate[2] = 0;\n                        Mat4.multiply(matrix, matrix, Mat4.fromTranslation(TJSTransforms.#mat4Temp, TJSTransforms.#vectorTranslate));\n                        break;\n                    case 'translateZ':\n                        TJSTransforms.#vectorTranslate[0] = 0;\n                        TJSTransforms.#vectorTranslate[1] = 0;\n                        TJSTransforms.#vectorTranslate[2] = value;\n                        Mat4.multiply(matrix, matrix, Mat4.fromTranslation(TJSTransforms.#mat4Temp, TJSTransforms.#vectorTranslate));\n                        break;\n                }\n            }\n        }\n        return matrix;\n    }\n    /**\n     * Provides an orthographic enhancement to convert left / top positional data to a translate operation.\n     *\n     * This transform matrix takes into account that the remaining operations are , but adds any left / top attributes\n     * from passed in data to translate X / Y.\n     *\n     * If no data object is provided then the source is the local transform data. If another data object is supplied\n     * then the stored local transform order is applied then all remaining transform keys are applied. This allows the\n     * construction of a transform matrix in advance of setting local data and is useful in collision detection.\n     *\n     * @param [data] - TJSPositionData instance or local transform data.\n     *\n     * @param [output] - The output mat4 instance.\n     *\n     * @returns Transform matrix.\n     */\n    getMat4Ortho(data = this.#data, output = new Mat4()) {\n        const matrix = Mat4.identity(output);\n        // Attempt to retrieve values from passed in data otherwise default to 0.\n        // Always perform the translation last regardless of order added to local transform data.\n        // Add data.left to translateX and data.top to translateY.\n        TJSTransforms.#vectorTranslate[0] = (data.left ?? 0) + (data.translateX ?? 0);\n        TJSTransforms.#vectorTranslate[1] = (data.top ?? 0) + (data.translateY ?? 0);\n        TJSTransforms.#vectorTranslate[2] = data.translateZ ?? 0;\n        Mat4.multiply(matrix, matrix, Mat4.fromTranslation(TJSTransforms.#mat4Temp, TJSTransforms.#vectorTranslate));\n        // Scale can also be applied out of order.\n        if (data.scale !== null && data.scale !== void 0) {\n            TJSTransforms.#vectorScale[0] = TJSTransforms.#vectorScale[1] = data.scale;\n            Mat4.multiply(matrix, matrix, Mat4.fromScaling(TJSTransforms.#mat4Temp, TJSTransforms.#vectorScale));\n        }\n        // Early out if there is no rotation data.\n        if (data.rotateX === null && data.rotateY === null && data.rotateZ === null) {\n            return matrix;\n        }\n        // Rotation transforms must be applied in the order they are added.\n        // Bitwise tracks applied transform keys from local transform data.\n        let seenKeys = 0;\n        const orderList = this.#orderList;\n        // First apply ordered transforms from local transform data.\n        for (let cntr = 0; cntr < orderList.length; cntr++) {\n            const key = orderList[cntr];\n            switch (key) {\n                case 'rotateX':\n                    seenKeys |= TJSTransforms.#transformKeysBitwise.rotateX;\n                    Mat4.multiply(matrix, matrix, Mat4.fromXRotation(TJSTransforms.#mat4Temp, degToRad(data[key] ?? 0)));\n                    break;\n                case 'rotateY':\n                    seenKeys |= TJSTransforms.#transformKeysBitwise.rotateY;\n                    Mat4.multiply(matrix, matrix, Mat4.fromYRotation(TJSTransforms.#mat4Temp, degToRad(data[key] ?? 0)));\n                    break;\n                case 'rotateZ':\n                    seenKeys |= TJSTransforms.#transformKeysBitwise.rotateZ;\n                    Mat4.multiply(matrix, matrix, Mat4.fromZRotation(TJSTransforms.#mat4Temp, degToRad(data[key] ?? 0)));\n                    break;\n            }\n        }\n        // Now apply any new keys not set in local transform data that have not been applied yet.\n        if (data !== this.#data) {\n            for (let cntr = 0; cntr < TJSTransforms.#transformKeys.length; cntr++) {\n                const key = TJSTransforms.#transformKeys[cntr];\n                // Reject bad / no data or if the key has already been applied.\n                if (data[key] === null || (seenKeys & TJSTransforms.#transformKeysBitwise[key]) > 0) {\n                    continue;\n                }\n                switch (key) {\n                    case 'rotateX':\n                        Mat4.multiply(matrix, matrix, Mat4.fromXRotation(TJSTransforms.#mat4Temp, degToRad(data[key] ?? 0)));\n                        break;\n                    case 'rotateY':\n                        Mat4.multiply(matrix, matrix, Mat4.fromYRotation(TJSTransforms.#mat4Temp, degToRad(data[key] ?? 0)));\n                        break;\n                    case 'rotateZ':\n                        Mat4.multiply(matrix, matrix, Mat4.fromZRotation(TJSTransforms.#mat4Temp, degToRad(data[key] ?? 0)));\n                        break;\n                }\n            }\n        }\n        return matrix;\n    }\n    /**\n     * Tests an object if it contains transform keys and the values are finite numbers.\n     *\n     * @param data - An object to test for transform data.\n     *\n     * @returns Whether the given TJSPositionData has transforms.\n     */\n    hasTransform(data) {\n        for (const key of TJSTransforms.#transformKeys) {\n            if (Number.isFinite(data[key])) {\n                return true;\n            }\n        }\n        return false;\n    }\n    /**\n     * Resets internal data from the given object containing valid transform keys.\n     *\n     * @param data - An object with transform data.\n     */\n    reset(data) {\n        for (const key in data) {\n            if (TJSTransforms.#isTransformKey(key)) {\n                const value = data[key];\n                if (NumberGuard.isFinite(value)) {\n                    this.#data[key] = value;\n                }\n                else {\n                    const index = this.#orderList.findIndex((entry) => entry === key);\n                    if (index >= 0) {\n                        this.#orderList.splice(index, 1);\n                    }\n                    delete this.#data[key];\n                }\n            }\n        }\n    }\n    // Internal implementation ----------------------------------------------------------------------------------------\n    /**\n     * Returns the translations necessary to translate a matrix operation based on the `transformOrigin` parameter of the\n     * given position instance. The first entry / index 0 is the pre-translation and last entry / index 1 is the post-\n     * translation.\n     *\n     * This method is used internally, but may be useful if you need the origin translation matrices to transform\n     * bespoke points based on any `transformOrigin` set in {@link TJSPositionData}.\n     *\n     * @param transformOrigin - The transform origin attribute from TJSPositionData.\n     *\n     * @param width - The TJSPositionData width or validation data width when 'auto'.\n     *\n     * @param height - The TJSPositionData height or validation data height when 'auto'.\n     *\n     * @param output - Output Mat4 array.\n     *\n     * @returns Output Mat4 array.\n     */\n    static #getOriginTranslation(transformOrigin, width, height, output) {\n        const vector = TJSTransforms.#vec3Temp;\n        switch (transformOrigin) {\n            case 'top left':\n                vector[0] = vector[1] = 0;\n                Mat4.fromTranslation(output[0], vector);\n                Mat4.fromTranslation(output[1], vector);\n                break;\n            case 'top center':\n                vector[0] = -width * 0.5;\n                vector[1] = 0;\n                Mat4.fromTranslation(output[0], vector);\n                vector[0] = width * 0.5;\n                Mat4.fromTranslation(output[1], vector);\n                break;\n            case 'top right':\n                vector[0] = -width;\n                vector[1] = 0;\n                Mat4.fromTranslation(output[0], vector);\n                vector[0] = width;\n                Mat4.fromTranslation(output[1], vector);\n                break;\n            case 'center left':\n                vector[0] = 0;\n                vector[1] = -height * 0.5;\n                Mat4.fromTranslation(output[0], vector);\n                vector[1] = height * 0.5;\n                Mat4.fromTranslation(output[1], vector);\n                break;\n            // By default, null / no transform is 'center'.\n            case null:\n            case 'center':\n                vector[0] = -width * 0.5;\n                vector[1] = -height * 0.5;\n                Mat4.fromTranslation(output[0], vector);\n                vector[0] = width * 0.5;\n                vector[1] = height * 0.5;\n                Mat4.fromTranslation(output[1], vector);\n                break;\n            case 'center right':\n                vector[0] = -width;\n                vector[1] = -height * 0.5;\n                Mat4.fromTranslation(output[0], vector);\n                vector[0] = width;\n                vector[1] = height * 0.5;\n                Mat4.fromTranslation(output[1], vector);\n                break;\n            case 'bottom left':\n                vector[0] = 0;\n                vector[1] = -height;\n                Mat4.fromTranslation(output[0], vector);\n                vector[1] = height;\n                Mat4.fromTranslation(output[1], vector);\n                break;\n            case 'bottom center':\n                vector[0] = -width * 0.5;\n                vector[1] = -height;\n                Mat4.fromTranslation(output[0], vector);\n                vector[0] = width * 0.5;\n                vector[1] = height;\n                Mat4.fromTranslation(output[1], vector);\n                break;\n            case 'bottom right':\n                vector[0] = -width;\n                vector[1] = -height;\n                Mat4.fromTranslation(output[0], vector);\n                vector[0] = width;\n                vector[1] = height;\n                Mat4.fromTranslation(output[1], vector);\n                break;\n            // No valid transform origin parameter; set identity.\n            default:\n                Mat4.identity(output[0]);\n                Mat4.identity(output[1]);\n                break;\n        }\n        return output;\n    }\n}\n\nclass AnimationScheduler {\n    /**\n     * Used to copy data from a TJSPosition instance.\n     */\n    static #data = {};\n    static #getEaseOptions = Object.freeze({ default: false });\n    /**\n     * Adds / schedules an animation w/ the AnimationManager. This contains the final steps common to all tweens.\n     *\n     * @param position -\n     *\n     * @param initial -\n     *\n     * @param destination -\n     *\n     * @param duration -\n     *\n     * @param el -\n     *\n     * @param delay -\n     *\n     * @param ease -\n     *\n     * @param [interpolate=lerp] -\n     *\n     * @param [transformOrigin] -\n     *\n     * @param [transformOriginInitial] -\n     *\n     * @param [cleanup] -\n     *\n     * @returns An AnimationControl instance or null if none created.\n     */\n    static #addAnimation(position, initial, destination, duration, el, delay, ease, interpolate = lerp, transformOrigin, transformOriginInitial, cleanup) {\n        // Set initial data for transform values that are often null by default.\n        TJSPositionDataUtil.setNumericDefaults(initial);\n        TJSPositionDataUtil.setNumericDefaults(destination);\n        // Reject all initial data that is not a number.\n        for (const key in initial) {\n            if (!Number.isFinite(initial[key])) {\n                delete initial[key];\n            }\n        }\n        const keys = Object.keys(initial);\n        const newData = Object.assign({}, initial);\n        // Nothing to animate, so return now.\n        // TODO handle in respective animation controls.\n        if (keys.length === 0) {\n            return null;\n        }\n        /**\n         */\n        const animationData = {\n            active: true,\n            cleanup,\n            cancelled: false,\n            control: void 0,\n            current: 0,\n            destination,\n            duration: duration * 1000, // Internally the AnimationManager works in ms.\n            ease,\n            el,\n            finished: false,\n            initial,\n            interpolate,\n            keys,\n            newData,\n            position,\n            resolve: void 0,\n            start: void 0,\n            transformOrigin,\n            transformOriginInitial,\n            quickTo: false\n        };\n        if (delay > 0) {\n            animationData.active = false;\n            // Delay w/ setTimeout and make active w/ AnimationManager.\n            setTimeout(() => animationData.active = true, delay * 1000);\n        }\n        // Schedule immediately w/ AnimationManager\n        AnimationManager.add(animationData);\n        // Create animation control\n        return new AnimationControl(animationData, true);\n    }\n    /**\n     * Provides a tween from given position data to the current position.\n     *\n     * @param position - The target position instance.\n     *\n     * @param fromData - The starting position.\n     *\n     * @param options - Tween options.\n     *\n     * @param [cleanup] - Custom animation cleanup function.\n     *\n     * @returns An AnimationControl instance or null if none created.\n     */\n    static from(position, fromData, options = {}, cleanup) {\n        if (!isObject(fromData)) {\n            throw new TypeError(`AnimationAPI.from error: 'fromData' is not an object.`);\n        }\n        // TJSPositionNS.PositionParent\n        const parent = position.parent;\n        // Early out if the application is not positionable.  TODO: THIS IS REFERENCING APPLICATION OPTIONS.\n        if (parent !== void 0 && typeof parent?.options?.positionable === 'boolean' && !parent?.options?.positionable) {\n            return null;\n        }\n        let { delay = 0, duration = 1, ease = 'cubicOut', strategy, transformOrigin } = options;\n        // Handle any defined scheduling strategy.\n        if (strategy !== void 0) {\n            if (this.#handleStrategy(position, strategy) === null) {\n                return null;\n            }\n        }\n        // Cache any target element allowing AnimationManager to stop animation if it becomes disconnected from DOM.\n        const targetEl = A11yHelper.isFocusTarget(parent) ? parent : parent?.elementTarget;\n        const el = A11yHelper.isFocusTarget(targetEl) && targetEl.isConnected ? targetEl :\n            void 0;\n        if (!Number.isFinite(delay) || delay < 0) {\n            throw new TypeError(`AnimationScheduler.from error: 'delay' is not a positive number.`);\n        }\n        if (!Number.isFinite(duration) || duration < 0) {\n            throw new TypeError(`AnimationScheduler.from error: 'duration' is not a positive number.`);\n        }\n        ease = getEasingFunc(ease, this.#getEaseOptions);\n        if (typeof ease !== 'function') {\n            throw new TypeError(`AnimationScheduler.from error: 'ease' is not a function or valid Svelte easing function name.`);\n        }\n        // TODO: In the future potentially support more interpolation functions besides `lerp`.\n        const initial = {};\n        const destination = {};\n        position.get(this.#data);\n        // Determine if any transform origin for the animation is valid.\n        transformOrigin = TJSTransforms.isTransformOrigin(transformOrigin) ? transformOrigin : void 0;\n        // Given a valid transform origin store the initial transform origin to be restored.\n        const transformOriginInitial = transformOrigin !== void 0 ?\n            this.#data.transformOrigin : void 0;\n        // Set initial data if the key / data is defined and the end position is not equal to current data.\n        for (const key in fromData) {\n            // Must use actual key from any aliases.\n            const animKey = TJSPositionDataUtil.getAnimationKey(key);\n            if (this.#data[animKey] !== void 0 && fromData[key] !== this.#data[animKey]) {\n                initial[key] = fromData[key];\n                destination[key] = this.#data[animKey];\n            }\n        }\n        ConvertStringData.process(initial, this.#data, el);\n        return this.#addAnimation(position, initial, destination, duration, el, delay, ease, lerp, transformOrigin, transformOriginInitial, cleanup);\n    }\n    /**\n     * Provides a tween from given position data to the given position.\n     *\n     * @param position - The target position instance.\n     *\n     * @param fromData - The starting position.\n     *\n     * @param toData - The ending position.\n     *\n     * @param options - Tween options.\n     *\n     * @param [cleanup] - Custom animation cleanup function.\n     *\n     * @returns An AnimationControl instance or null if none created.\n     */\n    static fromTo(position, fromData, toData, options = {}, cleanup) {\n        if (!isObject(fromData)) {\n            throw new TypeError(`AnimationScheduler.fromTo error: 'fromData' is not an object.`);\n        }\n        if (!isObject(toData)) {\n            throw new TypeError(`AnimationScheduler.fromTo error: 'toData' is not an object.`);\n        }\n        // TJSPositionNS.PositionParent\n        const parent = position.parent;\n        // Early out if the application is not positionable.  TODO: THIS IS REFERENCING APPLICATION OPTIONS.\n        if (parent !== void 0 && typeof parent?.options?.positionable === 'boolean' && !parent?.options?.positionable) {\n            return null;\n        }\n        let { delay = 0, duration = 1, ease = 'cubicOut', strategy, transformOrigin } = options;\n        // Handle any defined scheduling strategy.\n        if (strategy !== void 0) {\n            if (this.#handleStrategy(position, strategy) === null) {\n                return null;\n            }\n        }\n        // Cache any target element allowing AnimationManager to stop animation if it becomes disconnected from DOM.\n        const targetEl = A11yHelper.isFocusTarget(parent) ? parent : parent?.elementTarget;\n        const el = A11yHelper.isFocusTarget(targetEl) && targetEl.isConnected ? targetEl :\n            void 0;\n        if (!Number.isFinite(delay) || delay < 0) {\n            throw new TypeError(`AnimationScheduler.fromTo error: 'delay' is not a positive number.`);\n        }\n        if (!Number.isFinite(duration) || duration < 0) {\n            throw new TypeError(`AnimationScheduler.fromTo error: 'duration' is not a positive number.`);\n        }\n        ease = getEasingFunc(ease, this.#getEaseOptions);\n        if (typeof ease !== 'function') {\n            throw new TypeError(`AnimationScheduler.fromTo error: 'ease' is not a function or valid Svelte easing function name.`);\n        }\n        // TODO: In the future potentially support more interpolation functions besides `lerp`.\n        const initial = {};\n        const destination = {};\n        position.get(this.#data);\n        // Determine if any transform origin for the animation is valid.\n        transformOrigin = TJSTransforms.isTransformOrigin(transformOrigin) ? transformOrigin : void 0;\n        // Given a valid transform origin store the initial transform origin to be restored.\n        const transformOriginInitial = transformOrigin !== void 0 ?\n            this.#data.transformOrigin : void 0;\n        // Set initial data if the key / data is defined and the end position is not equal to current data.\n        for (const key in fromData) {\n            if (toData[key] === void 0) {\n                console.warn(`AnimationScheduler.fromTo warning: skipping key ('${key}') from 'fromData' as it is missing in 'toData'.`);\n                continue;\n            }\n            // Must use actual key from any aliases.\n            const animKey = TJSPositionDataUtil.getAnimationKey(key);\n            if (this.#data[animKey] !== void 0) {\n                initial[key] = fromData[key];\n                destination[key] = toData[key];\n            }\n        }\n        ConvertStringData.process(initial, this.#data, el);\n        ConvertStringData.process(destination, this.#data, el);\n        return this.#addAnimation(position, initial, destination, duration, el, delay, ease, lerp, transformOrigin, transformOriginInitial, cleanup);\n    }\n    /**\n     * Provides a tween to given position data from the current position.\n     *\n     * @param position - The target position instance.\n     *\n     * @param toData - The destination position.\n     *\n     * @param options - Tween options.\n     *\n     * @param [cleanup] - Custom animation cleanup function.\n     *\n     * @returns An AnimationControl instance or null if none created.\n     */\n    static to(position, toData, options, cleanup) {\n        if (!isObject(toData)) {\n            throw new TypeError(`AnimationScheduler.to error: 'toData' is not an object.`);\n        }\n        // TJSPositionNS.PositionParent\n        const parent = position.parent;\n        // Early out if the application is not positionable.  TODO: THIS IS REFERENCING APPLICATION OPTIONS.\n        if (parent !== void 0 && typeof parent?.options?.positionable === 'boolean' && !parent?.options?.positionable) {\n            return null;\n        }\n        let { delay = 0, duration = 1, ease = 'cubicOut', strategy, transformOrigin } = options;\n        // Handle any defined scheduling strategy.\n        if (strategy !== void 0) {\n            if (this.#handleStrategy(position, strategy) === null) {\n                return null;\n            }\n        }\n        // Cache any target element allowing AnimationManager to stop animation if it becomes disconnected from DOM.\n        const targetEl = A11yHelper.isFocusTarget(parent) ? parent : parent?.elementTarget;\n        const el = A11yHelper.isFocusTarget(targetEl) && targetEl.isConnected ? targetEl : void 0;\n        if (!Number.isFinite(delay) || delay < 0) {\n            throw new TypeError(`AnimationScheduler.to error: 'delay' is not a positive number.`);\n        }\n        if (!Number.isFinite(duration) || duration < 0) {\n            throw new TypeError(`AnimationScheduler.to error: 'duration' is not a positive number.`);\n        }\n        ease = getEasingFunc(ease, this.#getEaseOptions);\n        if (typeof ease !== 'function') {\n            throw new TypeError(`AnimationScheduler.to error: 'ease' is not a function or valid Svelte easing function name.`);\n        }\n        // TODO: In the future potentially support more interpolation functions besides `lerp`.\n        const initial = {};\n        const destination = {};\n        position.get(this.#data);\n        // Determine if any transform origin for the animation is valid.\n        transformOrigin = TJSTransforms.isTransformOrigin(transformOrigin) ? transformOrigin : void 0;\n        // Given a valid transform origin store the initial transform origin to be restored.\n        const transformOriginInitial = transformOrigin !== void 0 ?\n            this.#data.transformOrigin : void 0;\n        // Set initial data if the key / data is defined and the end position is not equal to current data.\n        for (const key in toData) {\n            // Must use actual key from any aliases.\n            const animKey = TJSPositionDataUtil.getAnimationKey(key);\n            if (this.#data[animKey] !== void 0 && toData[key] !== this.#data[animKey]) {\n                destination[key] = toData[key];\n                initial[key] = this.#data[animKey];\n            }\n        }\n        ConvertStringData.process(destination, this.#data, el);\n        return this.#addAnimation(position, initial, destination, duration, el, delay, ease, lerp, transformOrigin, transformOriginInitial, cleanup);\n    }\n    // Internal implementation ----------------------------------------------------------------------------------------\n    /**\n     * Handle any defined scheduling strategy allowing existing scheduled animations for the same position instance\n     * to be controlled.\n     *\n     * @param position - The target position instance.\n     *\n     * @param strategy - A scheduling strategy to apply.\n     *\n     * @returns Returns null to abort scheduling current animation.\n     */\n    static #handleStrategy(position, strategy) {\n        switch (strategy) {\n            case 'cancel':\n                if (AnimationManager.isScheduled(position)) {\n                    AnimationManager.cancel(position);\n                }\n                break;\n            case 'cancelAll':\n                if (AnimationManager.isScheduled(position)) {\n                    AnimationManager.cancel(position, AnimationManager.cancelAllFn);\n                }\n                break;\n            case 'exclusive':\n                if (AnimationManager.isScheduled(position)) {\n                    return null;\n                }\n                break;\n            default:\n                console.warn(`AnimationScheduler error: 'strategy' is not 'cancel', 'cancelAll', or 'exclusive'.`);\n                return null;\n        }\n    }\n}\n\n/**\n */\nclass AnimationAPIImpl {\n    static #getEaseOptions = Object.freeze({ default: false });\n    /**\n     */\n    #data;\n    #position;\n    /**\n     * @param position -\n     *\n     * @param data -\n     */\n    constructor(position, data) {\n        this.#position = position;\n        this.#data = data;\n        Object.seal(this);\n    }\n    /**\n     * Returns if there are scheduled animations whether active or pending for this TJSPosition instance.\n     *\n     * @returns Are there scheduled animations.\n     */\n    get isScheduled() {\n        return AnimationManager.isScheduled(this.#position);\n    }\n    /**\n     * Cancels all animation instances for this TJSPosition instance.\n     */\n    cancel() {\n        AnimationManager.cancel(this.#position, AnimationManager.cancelAllFn);\n    }\n    /**\n     * Returns all currently scheduled AnimationControl instances for this TJSPosition instance.\n     *\n     * @returns All currently scheduled animation controls for this TJSPosition instance.\n     */\n    getScheduled() {\n        return AnimationManager.getScheduled(this.#position);\n    }\n    /**\n     * Provides a tween from given position data to the current position.\n     *\n     * @param fromData - The starting position.\n     *\n     * @param [options] - Optional tween parameters.\n     *\n     * @returns A control object that can cancel animation and provides a `finished` Promise.\n     */\n    from(fromData, options) {\n        const animationControl = AnimationScheduler.from(this.#position, fromData, options);\n        return animationControl ? animationControl : AnimationControl.voidControl;\n    }\n    /**\n     * Provides a tween from given position data to the given position.\n     *\n     * @param fromData - The starting position.\n     *\n     * @param toData - The ending position.\n     *\n     * @param [options] - Optional tween parameters.\n     *\n     * @returns A control object that can cancel animation and provides a `finished` Promise.\n     */\n    fromTo(fromData, toData, options) {\n        const animationControl = AnimationScheduler.fromTo(this.#position, fromData, toData, options);\n        return animationControl ? animationControl : AnimationControl.voidControl;\n    }\n    /**\n     * Provides a tween to given position data from the current position.\n     *\n     * @param toData - The destination position.\n     *\n     * @param [options] - Optional tween parameters.\n     *\n     * @returns A control object that can cancel animation and provides a `finished` Promise.\n     */\n    to(toData, options) {\n        const animationControl = AnimationScheduler.to(this.#position, toData, options);\n        return animationControl ? animationControl : AnimationControl.voidControl;\n    }\n    /**\n     * Returns a function that provides an optimized way to constantly update a to-tween.\n     *\n     * @param keys - The keys for quickTo.\n     *\n     * @param [options] - Optional quick tween parameters.\n     *\n     * @returns quick-to tween function.\n     */\n    quickTo(keys, options = {}) {\n        if (!isIterable(keys)) {\n            throw new TypeError(`AnimationAPI.quickTo error: 'keys' is not an iterable list.`);\n        }\n        // TJSPosition.PositionParent\n        const parent = this.#position.parent;\n        // Early out if the application is not positionable.\n        if (parent !== void 0 && typeof parent?.options?.positionable === 'boolean' && !parent?.options?.positionable) {\n            throw new Error(`AnimationAPI.quickTo error: 'parent' is not positionable.`);\n        }\n        let { duration = 1, ease = 'cubicOut' } = options;\n        if (!Number.isFinite(duration) || duration < 0) {\n            throw new TypeError(`AnimationAPI.quickTo error: 'duration' is not a positive number.`);\n        }\n        ease = getEasingFunc(ease, AnimationAPIImpl.#getEaseOptions);\n        if (typeof ease !== 'function') {\n            throw new TypeError(`AnimationAPI.quickTo error: 'ease' is not a function or valid Svelte easing function name.`);\n        }\n        // TODO: In the future potentially support more interpolation functions besides `lerp`.\n        const initial = {};\n        const destination = {};\n        const data = this.#data;\n        // Set initial data if the key / data is defined and the end position is not equal to current data.\n        for (const key of keys) {\n            if (typeof key !== 'string') {\n                throw new TypeError(`AnimationAPI.quickTo error: key ('${key}') is not a string.`);\n            }\n            if (!TJSPositionDataUtil.isAnimationKey(key)) {\n                throw new Error(`AnimationAPI.quickTo error: key ('${key}') is not animatable.`);\n            }\n            // Must use actual key from any aliases.\n            const value = TJSPositionDataUtil.getDataOrDefault(data, key);\n            if (value !== null) {\n                destination[key] = value;\n                initial[key] = value;\n            }\n        }\n        const keysArray = [...keys];\n        Object.freeze(keysArray);\n        const newData = Object.assign({}, initial);\n        const animationData = {\n            active: true,\n            cancelled: false,\n            control: void 0,\n            current: 0,\n            destination,\n            duration: duration * 1000, // Internally the AnimationManager works in ms.\n            ease,\n            el: void 0,\n            finished: true, // Note: start in finished state to add to AnimationManager on first callback.\n            initial,\n            interpolate: lerp,\n            keys: keysArray,\n            newData,\n            position: this.#position,\n            resolve: void 0,\n            start: 0,\n            quickTo: true\n        };\n        const quickToCB = (...args) => {\n            const argsLength = args.length;\n            if (argsLength === 0) {\n                return;\n            }\n            for (let cntr = keysArray.length; --cntr >= 0;) {\n                const key = keysArray[cntr];\n                // Must use actual key from any aliases.\n                const animKey = TJSPositionDataUtil.getAnimationKey(key);\n                if (data[animKey] !== void 0) {\n                    initial[key] = data[animKey];\n                }\n            }\n            // Handle case where the first arg is an object. Update all quickTo keys from data contained in the object.\n            if (isObject(args[0])) {\n                const objData = args[0];\n                for (const key in objData) {\n                    if (destination[key] !== void 0) {\n                        destination[key] = objData[key];\n                    }\n                }\n            }\n            else // Assign each variable argument to the key specified in the initial `keys` array above.\n             {\n                for (let cntr = 0; cntr < argsLength && cntr < keysArray.length; cntr++) {\n                    const key = keysArray[cntr];\n                    if (destination[key] !== void 0) {\n                        destination[key] = args[cntr];\n                    }\n                }\n            }\n            // Set initial data for transform values that are often null by default.\n            TJSPositionDataUtil.setNumericDefaults(initial);\n            TJSPositionDataUtil.setNumericDefaults(destination);\n            // Set target element to animation data to track if it is removed from the DOM hence ending the animation.\n            const targetEl = A11yHelper.isFocusTarget(parent) ? parent : parent?.elementTarget;\n            animationData.el = A11yHelper.isFocusTarget(targetEl) && targetEl.isConnected ? targetEl : void 0;\n            ConvertStringData.process(destination, data, animationData.el);\n            // Reschedule the quickTo animation with AnimationManager as it is finished.\n            if (animationData.finished) {\n                animationData.cancelled = false;\n                animationData.finished = false;\n                animationData.active = true;\n                animationData.current = 0;\n                AnimationManager.add(animationData);\n            }\n            else // QuickTo animation is currently scheduled w/ AnimationManager so reset start and current time.\n             {\n                const now = globalThis.performance.now();\n                animationData.cancelled = false;\n                animationData.current = 0;\n                // Offset start time by delta between last rAF time. This allows a delayed tween to start from the\n                // precise delayed time.\n                animationData.start = now + (AnimationManager.timeNow - now);\n            }\n        };\n        Object.defineProperty(quickToCB, 'keys', {\n            value: keysArray,\n            writable: false,\n            configurable: false\n        });\n        Object.defineProperty(quickToCB, 'options', {\n            value: (optionsCB) => {\n                let { duration, ease } = optionsCB;\n                if (duration !== void 0 && (!Number.isFinite(duration) || duration < 0)) {\n                    throw new TypeError(`AnimationAPI.quickTo.options error: 'duration' is not a positive number.`);\n                }\n                ease = getEasingFunc(ease, AnimationAPIImpl.#getEaseOptions);\n                if (ease !== void 0 && typeof ease !== 'function') {\n                    throw new TypeError(`AnimationAPI.quickTo.options error: 'ease' is not a function or valid Svelte easing function name.`);\n                }\n                // TODO: In the future potentially support more interpolation functions besides `lerp`.\n                if (NumberGuard.isFinite(duration) && duration >= 0) {\n                    animationData.duration = duration * 1000;\n                }\n                if (ease) {\n                    animationData.ease = ease;\n                }\n                return quickToCB;\n            },\n            writable: false,\n            configurable: false\n        });\n        return quickToCB;\n    }\n}\n\n/**\n * Provides a implementation for a TJSPosition animation for a group of TJSPosition instances.\n */\nclass AnimationGroupControl {\n    /**\n     */\n    #animationControls;\n    /**\n     */\n    #finishedPromise;\n    /**\n     * Defines a static empty / void animation control.\n     */\n    static #voidControl = new AnimationGroupControl(null);\n    /**\n     * Provides a static void / undefined AnimationGroupControl that is automatically resolved.\n     */\n    static get voidControl() { return this.#voidControl; }\n    /**\n     * @param animationControls - A Set of AnimationControl instances.\n     */\n    constructor(animationControls) {\n        this.#animationControls = animationControls;\n    }\n    /**\n     * Get a promise that resolves when all animations are finished.\n     *\n     * @returns Finished Promise for all animations.\n     */\n    get finished() {\n        const animationControls = this.#animationControls;\n        if (!CrossWindow.isPromise(this.#finishedPromise)) {\n            if (animationControls === null || animationControls === void 0 || animationControls.size === 0) {\n                this.#finishedPromise = Promise.resolve({ cancelled: false });\n            }\n            else {\n                const promises = [];\n                for (const animationControl of animationControls) {\n                    promises.push(animationControl.finished);\n                }\n                this.#finishedPromise = Promise.allSettled(promises).then((results) => {\n                    // Check if any promises were rejected or resolved with `cancelled: true`.\n                    const anyCancelled = results.some((result) => result.status === 'rejected' ||\n                        (result.status === 'fulfilled' && result.value.cancelled));\n                    // Return a single BasicAnimationState based on the aggregation of individual results.\n                    return { cancelled: anyCancelled };\n                });\n            }\n        }\n        return this.#finishedPromise;\n    }\n    /**\n     * Returns whether there are active animation instances for this group.\n     *\n     * Note: a delayed animation may not be started / active yet. Use {@link AnimationGroupControl.isFinished} to\n     * determine if all animations in the group are finished.\n     *\n     * @returns Are there active animation instances.\n     */\n    get isActive() {\n        const animationControls = this.#animationControls;\n        if (animationControls === null || animationControls === void 0 || animationControls.size === 0) {\n            return false;\n        }\n        for (const animationControl of animationControls) {\n            if (animationControl.isActive) {\n                return true;\n            }\n        }\n        return false;\n    }\n    /**\n     * Returns whether all animations in the group are finished.\n     *\n     * @returns Are all animation instances finished.\n     */\n    get isFinished() {\n        const animationControls = this.#animationControls;\n        if (animationControls === null || animationControls === void 0 || animationControls.size === 0) {\n            return true;\n        }\n        for (const animationControl of animationControls) {\n            if (!animationControl.isFinished) {\n                return false;\n            }\n        }\n        return true;\n    }\n    /**\n     * Cancels the all animations.\n     */\n    cancel() {\n        const animationControls = this.#animationControls;\n        if (animationControls === null || animationControls === void 0 || animationControls.size === 0) {\n            return;\n        }\n        for (const animationControl of animationControls) {\n            animationControl.cancel();\n        }\n    }\n}\n\n/**\n * Provides a public API for grouping multiple {@link TJSPosition} animations together with the\n * AnimationManager.\n *\n * Note: To remove cyclic dependencies as this class provides the TJSPosition static / group Animation API `instanceof`\n * checks are not done against TJSPosition. Instead, a check for the animate property being an instanceof\n * {@link AnimationAPI} is performed in {@link AnimationGroupAPI.#getPosition}.\n *\n * Note: This is a static class that conforms to the {@link AnimationGroupAPI} interface.\n *\n * @see AnimationAPI\n */\nclass AnimationGroupAPIImpl {\n    constructor() { }\n    /**\n     * Returns the TJSPosition instance for the possible given positionable by checking the instance by checking for\n     * AnimationAPI.\n     *\n     * @param positionable - Possible position group entry.\n     *\n     * @returns Returns actual TJSPosition instance.\n     */\n    static #getPosition(positionable) {\n        if (!isObject(positionable)) {\n            return null;\n        }\n        if (positionable.animate instanceof AnimationAPIImpl) {\n            return positionable;\n        }\n        if (positionable.position?.animate instanceof AnimationAPIImpl) {\n            return positionable.position;\n        }\n        return null;\n    }\n    /**\n     * Cancels any animation for given TJSPosition.PositionGroup data.\n     *\n     * @param positionGroup - The position group to cancel.\n     */\n    static cancel(positionGroup) {\n        if (isIterable(positionGroup)) {\n            let index = -1;\n            for (const entry of positionGroup) {\n                index++;\n                const actualPosition = this.#getPosition(entry);\n                if (!actualPosition) {\n                    console.warn(`AnimationGroupAPI.cancel warning: No TJSPosition instance found at index: ${index}.`);\n                    continue;\n                }\n                AnimationManager.cancel(actualPosition);\n            }\n        }\n        else {\n            const actualPosition = this.#getPosition(positionGroup);\n            if (!actualPosition) {\n                console.warn(`AnimationGroupAPI.cancel warning: No TJSPosition instance found.`);\n                return;\n            }\n            AnimationManager.cancel(actualPosition);\n        }\n    }\n    /**\n     * Cancels all TJSPosition animation.\n     */\n    static cancelAll() { AnimationManager.cancelAll(); }\n    /**\n     * Gets all animation controls for the given position group data.\n     *\n     * @param positionGroup - A position group.\n     *\n     * @returns Results array.\n     */\n    static getScheduled(positionGroup) {\n        const results = [];\n        if (isIterable(positionGroup)) {\n            let index = -1;\n            for (const entry of positionGroup) {\n                index++;\n                const actualPosition = this.#getPosition(entry);\n                if (!actualPosition) {\n                    console.warn(`AnimationGroupAPI.getScheduled warning: No TJSPosition instance found at index: ${index}.`);\n                    continue;\n                }\n                const controls = AnimationManager.getScheduled(actualPosition);\n                results.push({\n                    position: actualPosition,\n                    entry: actualPosition !== entry ? entry : void 0,\n                    controls\n                });\n            }\n        }\n        else {\n            const actualPosition = this.#getPosition(positionGroup);\n            if (!actualPosition) {\n                console.warn(`AnimationGroupAPI.getScheduled warning: No TJSPosition instance found.`);\n                return results;\n            }\n            const controls = AnimationManager.getScheduled(actualPosition);\n            results.push({\n                position: actualPosition,\n                entry: actualPosition !== positionGroup ? positionGroup : void 0,\n                controls\n            });\n        }\n        return results;\n    }\n    /**\n     * Provides a type guard to test in the given key is an {@link AnimationAPIImpl.AnimationKey}.\n     *\n     * @param key - A key value to test.\n     *\n     * @returns Whether the given key is an animation key.\n     */\n    static isAnimationKey(key) {\n        return TJSPositionDataUtil.isAnimationKey(key);\n    }\n    /**\n     * Returns the status _for the entire position group_ specified if all position instances of the group are scheduled.\n     *\n     * @param positionGroup - A position group.\n     *\n     * @param [options] - Options.\n     *\n     * @returns True if all are scheduled / false if just one position instance in the group is not scheduled.\n     */\n    static isScheduled(positionGroup, options) {\n        if (isIterable(positionGroup)) {\n            let index = -1;\n            for (const entry of positionGroup) {\n                index++;\n                const actualPosition = this.#getPosition(entry);\n                if (!actualPosition) {\n                    console.warn(`AnimationGroupAPI.isScheduled warning: No TJSPosition instance found at index: ${index}.`);\n                    continue;\n                }\n                if (!AnimationManager.isScheduled(actualPosition, options)) {\n                    return false;\n                }\n            }\n        }\n        else {\n            const actualPosition = this.#getPosition(positionGroup);\n            if (!actualPosition) {\n                console.warn(`AnimationGroupAPI.isScheduled warning: No TJSPosition instance found.`);\n                return false;\n            }\n            if (!AnimationManager.isScheduled(actualPosition, options)) {\n                return false;\n            }\n        }\n        return true;\n    }\n    /**\n     * Provides the `from` animation tween for one or more positionable instances as a group.\n     *\n     * @param positionGroup - A position group.\n     *\n     * @param fromData - A position data object assigned to all positionable instances or a callback function invoked for\n     *        unique data for each instance.\n     *\n     * @param [options] - Tween options assigned to all positionable instances or a callback function invoked for unique\n     *        options for each instance.\n     *\n     * @returns Basic animation control.\n     */\n    static from(positionGroup, fromData, options) {\n        if (!isObject(fromData) && typeof fromData !== 'function') {\n            throw new TypeError(`AnimationGroupAPI.from error: 'fromData' is not an object or function.`);\n        }\n        if (options !== void 0 && !isObject(options) && typeof options !== 'function') {\n            throw new TypeError(`AnimationGroupAPI.from error: 'options' is not an object or function.`);\n        }\n        /**\n         */\n        const animationControls = new Set();\n        /**\n         */\n        const cleanupFn = (data) => animationControls.delete(data.control);\n        let index = -1;\n        /**\n         */\n        let callbackOptions;\n        const hasDataCallback = typeof fromData === 'function';\n        const hasOptionCallback = typeof options === 'function';\n        const hasCallback = hasDataCallback || hasOptionCallback;\n        if (hasCallback) {\n            callbackOptions = { index, position: void 0, entry: void 0 };\n        }\n        let actualFromData = fromData;\n        let actualOptions = isObject(options) ? options : void 0;\n        if (isIterable(positionGroup)) {\n            for (const entry of positionGroup) {\n                index++;\n                const actualPosition = this.#getPosition(entry);\n                if (!actualPosition) {\n                    console.warn(`AnimationGroupAPI.from warning: No TJSPosition instance found at index: ${index}.`);\n                    continue;\n                }\n                if (hasCallback) {\n                    callbackOptions.index = index;\n                    callbackOptions.position = actualPosition;\n                    callbackOptions.entry = actualPosition !== entry ? entry : void 0;\n                }\n                if (hasDataCallback && typeof fromData === 'function') {\n                    actualFromData = fromData(callbackOptions);\n                    // Returned data from callback is null / undefined, so skip this position instance.\n                    if (actualFromData === null || actualFromData === void 0) {\n                        continue;\n                    }\n                    if (!isObject(actualFromData)) {\n                        throw new TypeError(`AnimationGroupAPI.from error: 'fromData' callback function iteration(${index}) failed to return an object.`);\n                    }\n                }\n                if (hasOptionCallback && typeof options === 'function') {\n                    actualOptions = options(callbackOptions);\n                    // Returned data from callback is null / undefined, so skip this position instance.\n                    if (actualOptions === null || actualOptions === void 0) {\n                        continue;\n                    }\n                    if (!isObject(actualOptions)) {\n                        throw new TypeError(`AnimationGroupAPI.from error: 'options' callback function iteration(${index}) failed to return an object.`);\n                    }\n                }\n                const animationControl = AnimationScheduler.from(actualPosition, actualFromData, actualOptions, cleanupFn);\n                if (animationControl) {\n                    animationControls.add(animationControl);\n                }\n            }\n        }\n        else {\n            const actualPosition = this.#getPosition(positionGroup);\n            if (!actualPosition) {\n                console.warn(`AnimationGroupAPI.from warning: No TJSPosition instance found.`);\n                return AnimationGroupControl.voidControl;\n            }\n            if (hasCallback) {\n                callbackOptions.index = 0;\n                callbackOptions.position = actualPosition;\n                callbackOptions.entry = actualPosition !== positionGroup ? positionGroup :\n                    void 0;\n            }\n            if (hasDataCallback && typeof fromData === 'function') {\n                actualFromData = fromData(callbackOptions);\n                // Returned data from callback is null / undefined, so skip this position instance.\n                if (actualFromData === null || actualFromData === void 0) {\n                    return AnimationGroupControl.voidControl;\n                }\n                if (!isObject(actualFromData)) {\n                    throw new TypeError(`AnimationGroupAPI.from error: 'fromData' callback function failed to return an object.`);\n                }\n            }\n            if (hasOptionCallback && typeof options === 'function') {\n                actualOptions = options(callbackOptions);\n                // Returned data from callback is null / undefined, so skip this position instance.\n                if (actualOptions === null || actualOptions === void 0) {\n                    return AnimationGroupControl.voidControl;\n                }\n                if (!isObject(actualOptions)) {\n                    throw new TypeError(`AnimationGroupAPI.from error: 'options' callback function failed to return an object.`);\n                }\n            }\n            const animationControl = AnimationScheduler.from(actualPosition, actualFromData, actualOptions, cleanupFn);\n            if (animationControl) {\n                animationControls.add(animationControl);\n            }\n        }\n        return new AnimationGroupControl(animationControls);\n    }\n    /**\n     * Provides the `fromTo` animation tween for one or more positionable instances as a group.\n     *\n     * @param positionGroup - A position group.\n     *\n     * @param fromData - A position data object assigned to all positionable instances or a callback function invoked for\n     *        unique data for each instance.\n     *\n     * @param toData - A position data object assigned to all positionable instances or a callback function invoked for\n     *        unique data for each instance.\n     *\n     * @param [options] - Tween options assigned to all positionable instances or a callback function invoked for unique\n     *        options for each instance.\n     *\n     * @returns Basic animation control.\n     */\n    static fromTo(positionGroup, fromData, toData, options) {\n        if (!isObject(fromData) && typeof fromData !== 'function') {\n            throw new TypeError(`AnimationGroupAPI.fromTo error: 'fromData' is not an object or function.`);\n        }\n        if (!isObject(toData) && typeof toData !== 'function') {\n            throw new TypeError(`AnimationGroupAPI.fromTo error: 'toData' is not an object or function.`);\n        }\n        if (options !== void 0 && !isObject(options) && typeof options !== 'function') {\n            throw new TypeError(`AnimationGroupAPI.fromTo error: 'options' is not an object or function.`);\n        }\n        const animationControls = new Set();\n        /**\n         */\n        const cleanupFn = (data) => animationControls.delete(data.control);\n        let index = -1;\n        /**\n         */\n        let callbackOptions;\n        const hasFromCallback = typeof fromData === 'function';\n        const hasToCallback = typeof toData === 'function';\n        const hasOptionCallback = typeof options === 'function';\n        const hasCallback = hasFromCallback || hasToCallback || hasOptionCallback;\n        if (hasCallback) {\n            callbackOptions = { index, position: void 0, entry: void 0 };\n        }\n        let actualFromData = fromData;\n        let actualToData = toData;\n        let actualOptions = isObject(options) ? options : void 0;\n        if (isIterable(positionGroup)) {\n            for (const entry of positionGroup) {\n                index++;\n                const actualPosition = this.#getPosition(entry);\n                if (!actualPosition) {\n                    console.warn(`AnimationGroupAPI.fromTo warning: No TJSPosition instance found at index: ${index}.`);\n                    continue;\n                }\n                if (hasCallback) {\n                    callbackOptions.index = index;\n                    callbackOptions.position = actualPosition;\n                    callbackOptions.entry = actualPosition !== entry ? entry : void 0;\n                }\n                if (hasFromCallback && typeof fromData === 'function') {\n                    actualFromData = fromData(callbackOptions);\n                    // Returned data from callback is null / undefined, so skip this position instance.\n                    if (actualFromData === null || actualFromData === void 0) {\n                        continue;\n                    }\n                    if (!isObject(actualFromData)) {\n                        throw new TypeError(`AnimationGroupAPI.fromTo error: 'fromData' callback function iteration(${index}) failed to return an object.`);\n                    }\n                }\n                if (hasToCallback && typeof toData === 'function') {\n                    actualToData = toData(callbackOptions);\n                    // Returned data from callback is null / undefined, so skip this position instance.\n                    if (actualToData === null || actualToData === void 0) {\n                        continue;\n                    }\n                    if (!isObject(actualToData)) {\n                        throw new TypeError(`AnimationGroupAPI.fromTo error: 'toData' callback function iteration(${index}) failed to return an object.`);\n                    }\n                }\n                if (hasOptionCallback && typeof options === 'function') {\n                    actualOptions = options(callbackOptions);\n                    // Returned data from callback is null / undefined, so skip this position instance.\n                    if (actualOptions === null || actualOptions === void 0) {\n                        continue;\n                    }\n                    if (!isObject(actualOptions)) {\n                        throw new TypeError(`AnimationGroupAPI.fromTo error: 'options' callback function iteration(${index}) failed to return an object.`);\n                    }\n                }\n                const animationControl = AnimationScheduler.fromTo(actualPosition, actualFromData, actualToData, actualOptions, cleanupFn);\n                if (animationControl) {\n                    animationControls.add(animationControl);\n                }\n            }\n        }\n        else {\n            const actualPosition = this.#getPosition(positionGroup);\n            if (!actualPosition) {\n                console.warn(`AnimationGroupAPI.fromTo warning: No TJSPosition instance found.`);\n                return AnimationGroupControl.voidControl;\n            }\n            if (hasCallback) {\n                callbackOptions.index = 0;\n                callbackOptions.position = actualPosition;\n                callbackOptions.entry = actualPosition !== positionGroup ? positionGroup :\n                    void 0;\n            }\n            if (hasFromCallback && typeof fromData === 'function') {\n                actualFromData = fromData(callbackOptions);\n                // Returned data from callback is null / undefined, so skip this position instance.\n                if (actualFromData === null || actualFromData === void 0) {\n                    return AnimationGroupControl.voidControl;\n                }\n                if (!isObject(actualFromData)) {\n                    throw new TypeError(`AnimationGroupAPI.fromTo error: 'fromData' callback function failed to return an object.`);\n                }\n            }\n            if (hasToCallback && typeof toData === 'function') {\n                actualToData = toData(callbackOptions);\n                // Returned data from callback is null / undefined, so skip this position instance.\n                if (actualToData === null || actualToData === void 0) {\n                    return AnimationGroupControl.voidControl;\n                }\n                if (!isObject(actualToData)) {\n                    throw new TypeError(`AnimationGroupAPI.fromTo error: 'toData' callback function failed to return an object.`);\n                }\n            }\n            if (hasOptionCallback && typeof options === 'function') {\n                actualOptions = options(callbackOptions);\n                // Returned data from callback is null / undefined, so skip this position instance.\n                if (actualOptions === null || actualOptions === void 0) {\n                    return AnimationGroupControl.voidControl;\n                }\n                if (!isObject(actualOptions)) {\n                    throw new TypeError(`AnimationGroupAPI.fromTo error: 'options' callback function failed to return an object.`);\n                }\n            }\n            const animationControl = AnimationScheduler.fromTo(actualPosition, actualFromData, actualToData, actualOptions, cleanupFn);\n            if (animationControl) {\n                animationControls.add(animationControl);\n            }\n        }\n        return new AnimationGroupControl(animationControls);\n    }\n    /**\n     * Provides the `to` animation tween for one or more positionable instances as a group.\n     *\n     * @param positionGroup - A position group.\n     *\n     * @param toData - A position data object assigned to all positionable instances or a callback function invoked for\n     *        unique data for each instance.\n     *\n     * @param [options] - Tween options assigned to all positionable instances or a callback function invoked for unique\n     *        options for each instance.\n     *\n     * @returns Basic animation control.\n     */\n    static to(positionGroup, toData, options) {\n        if (!isObject(toData) && typeof toData !== 'function') {\n            throw new TypeError(`AnimationGroupAPI.to error: 'toData' is not an object or function.`);\n        }\n        if (options !== void 0 && !isObject(options) && typeof options !== 'function') {\n            throw new TypeError(`AnimationGroupAPI.to error: 'options' is not an object or function.`);\n        }\n        /**\n         */\n        const animationControls = new Set();\n        /**\n         */\n        const cleanupFn = (data) => animationControls.delete(data.control);\n        let index = -1;\n        /**\n         */\n        let callbackOptions;\n        const hasDataCallback = typeof toData === 'function';\n        const hasOptionCallback = typeof options === 'function';\n        const hasCallback = hasDataCallback || hasOptionCallback;\n        if (hasCallback) {\n            callbackOptions = { index, position: void 0, entry: void 0 };\n        }\n        let actualToData = toData;\n        let actualOptions = isObject(options) ? options : void 0;\n        if (isIterable(positionGroup)) {\n            for (const entry of positionGroup) {\n                index++;\n                const actualPosition = this.#getPosition(entry);\n                if (!actualPosition) {\n                    console.warn(`AnimationGroupAPI.to warning: No TJSPosition instance found at index: ${index}.`);\n                    continue;\n                }\n                if (hasCallback) {\n                    callbackOptions.index = index;\n                    callbackOptions.position = actualPosition;\n                    callbackOptions.entry = actualPosition !== entry ? entry : void 0;\n                }\n                if (hasDataCallback && typeof toData === 'function') {\n                    actualToData = toData(callbackOptions);\n                    // Returned data from callback is null / undefined, so skip this position instance.\n                    if (actualToData === null || actualToData === void 0) {\n                        continue;\n                    }\n                    if (!isObject(actualToData)) {\n                        throw new TypeError(`AnimationGroupAPI.to error: 'toData' callback function iteration(${index}) failed to return an object.`);\n                    }\n                }\n                if (hasOptionCallback && typeof options === 'function') {\n                    actualOptions = options(callbackOptions);\n                    // Returned data from callback is null / undefined, so skip this position instance.\n                    if (actualOptions === null || actualOptions === void 0) {\n                        continue;\n                    }\n                    if (!isObject(actualOptions)) {\n                        throw new TypeError(`AnimationGroupAPI.to error: 'options' callback function iteration(${index}) failed to return an object.`);\n                    }\n                }\n                const animationControl = AnimationScheduler.to(actualPosition, actualToData, actualOptions, cleanupFn);\n                if (animationControl) {\n                    animationControls.add(animationControl);\n                }\n            }\n        }\n        else {\n            const actualPosition = this.#getPosition(positionGroup);\n            if (!actualPosition) {\n                console.warn(`AnimationGroupAPI.to warning: No TJSPosition instance found.`);\n                return AnimationGroupControl.voidControl;\n            }\n            if (hasCallback) {\n                callbackOptions.index = 0;\n                callbackOptions.position = actualPosition;\n                callbackOptions.entry = actualPosition !== positionGroup ? positionGroup :\n                    void 0;\n            }\n            if (hasDataCallback && typeof toData === 'function') {\n                actualToData = toData(callbackOptions);\n                // Returned data from callback is null / undefined, so skip this position instance.\n                if (actualToData === null || actualToData === void 0) {\n                    return AnimationGroupControl.voidControl;\n                }\n                if (!isObject(actualToData)) {\n                    throw new TypeError(`AnimationGroupAPI.to error: 'toData' callback function failed to return an object.`);\n                }\n            }\n            if (hasOptionCallback && typeof options === 'function') {\n                actualOptions = options(callbackOptions);\n                // Returned data from callback is null / undefined, so skip this position instance.\n                if (actualOptions === null || actualOptions === void 0) {\n                    return AnimationGroupControl.voidControl;\n                }\n                if (!isObject(actualOptions)) {\n                    throw new TypeError(`AnimationGroupAPI.to error: 'options' callback function failed to return an object.`);\n                }\n            }\n            const animationControl = AnimationScheduler.to(actualPosition, actualToData, actualOptions, cleanupFn);\n            if (animationControl) {\n                animationControls.add(animationControl);\n            }\n        }\n        return new AnimationGroupControl(animationControls);\n    }\n    /**\n     * Provides the `quickTo` animation tweening function for one or more positionable instances as a group.\n     *\n     * @param positionGroup - A position group.\n     *\n     * @param keys - Animation keys to target.\n     *\n     * @param [options] - Quick tween options assigned to all positionable instances or a callback function invoked for\n     *        unique options for each instance.\n     *\n     * @returns quick-to tween function.\n     */\n    static quickTo(positionGroup, keys, options) {\n        if (!isIterable(keys)) {\n            throw new TypeError(`AnimationGroupAPI.quickTo error: 'keys' is not an iterable list.`);\n        }\n        if (options !== void 0 && !isObject(options) && typeof options !== 'function') {\n            throw new TypeError(`AnimationGroupAPI.quickTo error: 'options' is not an object or function.`);\n        }\n        /**\n         */\n        const quickToCallbacks = [];\n        let index = -1;\n        const hasOptionCallback = typeof options === 'function';\n        const callbackOptions = { index, position: void 0, entry: void 0 };\n        let actualOptions = isObject(options) ? options : void 0;\n        if (isIterable(positionGroup)) {\n            for (const entry of positionGroup) {\n                index++;\n                const actualPosition = this.#getPosition(entry);\n                if (!actualPosition) {\n                    console.warn(`AnimationGroupAPI.quickTo warning: No TJSPosition instance found at index: ${index}.`);\n                    continue;\n                }\n                callbackOptions.index = index;\n                callbackOptions.position = actualPosition;\n                callbackOptions.entry = actualPosition !== entry ? entry : void 0;\n                if (hasOptionCallback && typeof options === 'function') {\n                    actualOptions = options(callbackOptions);\n                    // Returned data from callback is null / undefined, so skip this position instance.\n                    if (actualOptions === null || actualOptions === void 0) {\n                        continue;\n                    }\n                    if (!isObject(actualOptions)) {\n                        throw new TypeError(`AnimationGroupAPI.quickTo error: 'options' callback function iteration(${index}) failed to return an object.`);\n                    }\n                }\n                quickToCallbacks.push(actualPosition.animate.quickTo(keys, actualOptions));\n            }\n        }\n        else {\n            const actualPosition = this.#getPosition(positionGroup);\n            if (!actualPosition) {\n                console.warn(`AnimationGroupAPI.quickTo warning: No TJSPosition instance found.`);\n                return;\n            }\n            callbackOptions.index = 0;\n            callbackOptions.position = actualPosition;\n            callbackOptions.entry = actualPosition !== positionGroup ? positionGroup : void 0;\n            if (hasOptionCallback && typeof options === 'function') {\n                actualOptions = options(callbackOptions);\n                // Returned data from callback is null / undefined, so skip this position instance.\n                if (actualOptions === null || actualOptions === void 0) {\n                    return;\n                }\n                if (!isObject(actualOptions)) {\n                    throw new TypeError(`AnimationGroupAPI.quickTo error: 'options' callback function failed to return an object.`);\n                }\n            }\n            quickToCallbacks.push(actualPosition.animate.quickTo(keys, actualOptions));\n        }\n        const keysArray = [...keys];\n        Object.freeze(keysArray);\n        const quickToCB = (...args) => {\n            const argsLength = args.length;\n            if (argsLength === 0) {\n                return;\n            }\n            if (typeof args[0] === 'function') {\n                const dataCallback = args[0];\n                index = -1;\n                let cntr = 0;\n                if (isIterable(positionGroup)) {\n                    for (const entry of positionGroup) {\n                        index++;\n                        const actualPosition = this.#getPosition(entry);\n                        if (!actualPosition) {\n                            continue;\n                        }\n                        callbackOptions.index = index;\n                        callbackOptions.position = actualPosition;\n                        callbackOptions.entry = actualPosition !== entry ? entry : void 0;\n                        const toData = dataCallback(callbackOptions);\n                        // Returned data from callback is null / undefined, so skip this position instance.\n                        if (toData === null || toData === void 0) {\n                            continue;\n                        }\n                        /**\n                         */\n                        const toDataIterable = isIterable(toData);\n                        if (!Number.isFinite(toData) && !toDataIterable && !isObject(toData)) {\n                            throw new TypeError(`AnimationGroupAPI.quickTo error: 'toData' callback function iteration(${index}) failed to return a finite number, iterable list, or object.`);\n                        }\n                        if (toDataIterable) {\n                            quickToCallbacks[cntr++](...toData);\n                        }\n                        else {\n                            quickToCallbacks[cntr++](toData);\n                        }\n                    }\n                }\n                else {\n                    const actualPosition = this.#getPosition(positionGroup);\n                    if (!actualPosition) {\n                        return;\n                    }\n                    callbackOptions.index = 0;\n                    callbackOptions.position = actualPosition;\n                    callbackOptions.entry = actualPosition !== positionGroup ? positionGroup : void 0;\n                    const toData = dataCallback(callbackOptions);\n                    // Returned data from callback is null / undefined, so skip this position instance.\n                    if (toData === null || toData === void 0) {\n                        return;\n                    }\n                    const toDataIterable = isIterable(toData);\n                    if (!Number.isFinite(toData) && !toDataIterable && !isObject(toData)) {\n                        throw new TypeError(`AnimationGroupAPI.quickTo error: 'toData' callback function iteration(${index}) failed to return a finite number, iterable list, or object.`);\n                    }\n                    if (toDataIterable) {\n                        quickToCallbacks[cntr++](...toData);\n                    }\n                    else {\n                        quickToCallbacks[cntr++](toData);\n                    }\n                }\n            }\n            else {\n                for (let cntr = quickToCallbacks.length; --cntr >= 0;) {\n                    quickToCallbacks[cntr](...args);\n                }\n            }\n        };\n        Object.defineProperty(quickToCB, 'keys', {\n            value: keysArray,\n            writable: false,\n            configurable: false\n        });\n        Object.defineProperty(quickToCB, 'options', {\n            /**\n             * Sets options of quickTo tween.\n             * @param options -\n             */\n            value: (options) => {\n                if (options !== void 0 && !isObject(options)) {\n                    throw new TypeError(`AnimationGroupAPI.quickTo error: 'options' is not an object.`);\n                }\n                // Set options object for each quickTo callback.\n                if (isObject(options)) {\n                    for (let cntr = quickToCallbacks.length; --cntr >= 0;) {\n                        quickToCallbacks[cntr].options(options);\n                    }\n                }\n                return quickToCB;\n            },\n            writable: false,\n            configurable: false\n        });\n        return quickToCB;\n    }\n}\nObject.seal(AnimationGroupAPIImpl);\n\n/**\n *\n */\nclass PositionStateAPI {\n    /**\n     */\n    #data;\n    /**\n     */\n    #dataSaved = new Map();\n    /**\n     */\n    #position;\n    /**\n     */\n    #transforms;\n    constructor(position, data, transforms) {\n        this.#position = position;\n        this.#data = data;\n        this.#transforms = transforms;\n        Object.seal(this);\n    }\n    /**\n     * Clears all saved position data except any default state.\n     */\n    clear() {\n        for (const key of this.#dataSaved.keys()) {\n            if (key !== '#defaultData') {\n                this.#dataSaved.delete(key);\n            }\n        }\n    }\n    /**\n     * Returns any stored save state by name.\n     *\n     * @param options - Options.\n     *\n     * @param options.name - Saved data name.\n     *\n     * @returns Any saved position data.\n     */\n    get({ name }) {\n        if (typeof name !== 'string') {\n            throw new TypeError(`TJSPosition - get error: 'name' is not a string.`);\n        }\n        return this.#dataSaved.get(name);\n    }\n    /**\n     * Returns any associated default position data.\n     *\n     * @returns Any saved default position data.\n     */\n    getDefault() {\n        return this.#dataSaved.get('#defaultData');\n    }\n    /**\n     * @returns The saved position data names / keys.\n     */\n    keys() {\n        return this.#dataSaved.keys();\n    }\n    /**\n     * Removes and returns any position data by name.\n     *\n     * @param options - Options.\n     *\n     * @param options.name - Name to remove and retrieve.\n     *\n     * @returns Any saved position data.\n     */\n    remove({ name }) {\n        if (typeof name !== 'string') {\n            throw new TypeError(`TJSPosition - remove: 'name' is not a string.`);\n        }\n        const data = this.#dataSaved.get(name);\n        this.#dataSaved.delete(name);\n        return data;\n    }\n    /**\n     * Resets position instance to default data and invokes set.\n     *\n     * @param [options] - Optional parameters.\n     *\n     * @param [options.keepZIndex=false] - When true keeps current z-index.\n     *\n     * @param [options.invokeSet=true] - When true invokes set method.\n     *\n     * @returns Operation successful.\n     */\n    reset({ keepZIndex = false, invokeSet = true } = {}) {\n        const defaultData = this.#dataSaved.get('#defaultData');\n        // Quit early if there is no saved default data.\n        if (!isObject(defaultData)) {\n            return false;\n        }\n        // Cancel all animations for TJSPosition if there are currently any scheduled.\n        if (this.#position.animate.isScheduled) {\n            this.#position.animate.cancel();\n        }\n        const zIndex = this.#position.zIndex;\n        const data = Object.assign({}, defaultData);\n        if (keepZIndex) {\n            data.zIndex = zIndex;\n        }\n        // Reset the transform data.\n        this.#transforms.reset(data);\n        const parent = this.#position.parent;\n        // If current minimized invoke `maximize`. TODO: REFACTOR FOR APPLICATION DIRECT ACCESS.\n        if (parent?.reactive?.minimized) {\n            parent?.maximize?.({ animate: false, duration: 0 });\n        }\n        // Note next clock tick scheduling.\n        if (invokeSet) {\n            setTimeout(() => this.#position.set(data), 0);\n        }\n        return true;\n    }\n    /**\n     * Restores a saved positional state returning the data. Several optional parameters are available to control\n     * whether the restore action occurs silently (no store / inline styles updates), animates to the stored data, or\n     * simply sets the stored data. Restoring via {@link AnimationAPI.to} allows specification of the duration and\n     * easing along with configuring a Promise to be returned if awaiting the end of the animation.\n     *\n     * @param options - Parameters\n     *\n     * @param options.name - Saved data set name.\n     *\n     * @param [options.remove=false] - Deletes data set.\n     *\n     * @param [options.properties] - Specific properties to set / animate.\n     *\n     * @param [options.silent] - Set position data directly; no store or style updates.\n     *\n     * @param [options.async=false] - If animating return a Promise that resolves with any saved data.\n     *\n     * @param [options.animateTo=false] - Animate to restore data.\n     *\n     * @param [options.duration=0.1] - Duration in seconds.\n     *\n     * @param [options.ease='linear'] - Easing function name or function.\n     *\n     * @returns Any saved position data.\n     */\n    restore({ name, remove = false, properties, silent = false, async = false, animateTo = false, duration = 0.1, ease = 'linear' }) {\n        if (typeof name !== 'string') {\n            throw new TypeError(`TJSPosition - restore error: 'name' is not a string.`);\n        }\n        const dataSaved = this.#dataSaved.get(name);\n        if (dataSaved) {\n            if (remove) {\n                this.#dataSaved.delete(name);\n            }\n            let data = dataSaved;\n            if (isIterable(properties)) {\n                data = {};\n                for (const property of properties) {\n                    data[property] = dataSaved[property];\n                }\n            }\n            // Update data directly with no store or inline style updates.\n            if (silent) {\n                for (const property in data) {\n                    if (property in this.#data) {\n                        this.#data[property] = data[property];\n                    }\n                }\n                return dataSaved;\n            }\n            else if (animateTo) // Animate to saved data.\n             {\n                // Provide special handling to potentially change transform origin as this parameter is not animated.\n                if (data.transformOrigin !== this.#position.transformOrigin) {\n                    this.#position.transformOrigin = data.transformOrigin;\n                }\n                // Return a Promise with saved data that resolves after animation ends.\n                if (async) {\n                    return this.#position.animate.to(data, { duration, ease }).finished.then(() => dataSaved);\n                }\n                else // Animate synchronously.\n                 {\n                    this.#position.animate.to(data, { duration, ease });\n                }\n            }\n            else {\n                // Default options is to set data for an immediate update.\n                this.#position.set(data);\n            }\n        }\n        // Saved data potentially not found, but must still return a Promise when async is true.\n        return async ? Promise.resolve(dataSaved) : dataSaved;\n    }\n    /**\n     * Saves current position state with the opportunity to add extra data to the saved state. Simply include extra\n     * properties in `options` to save extra data.\n     *\n     * @param options - Options.\n     *\n     * @param options.name - name to index this saved data.\n     *\n     * @param [optionsGet] - Additional options for {@link TJSPosition.get} when serializing position state. By default,\n     *        `nullable` values are included.\n     *\n     * @returns Current position data plus any extra data stored.\n     */\n    save({ name, ...extra }, optionsGet) {\n        if (typeof name !== 'string') {\n            throw new TypeError(`TJSPosition - save error: 'name' is not a string.`);\n        }\n        const data = this.#position.get(extra, optionsGet);\n        this.#dataSaved.set(name, data);\n        return data;\n    }\n    /**\n     * Directly sets a saved position state. Simply include extra properties in `options` to set extra data.\n     *\n     * @param opts - Options.\n     *\n     * @param opts.name - name to index this saved data.\n     */\n    set({ name, ...data }) {\n        if (typeof name !== 'string') {\n            throw new TypeError(`TJSPosition - set error: 'name' is not a string.`);\n        }\n        this.#dataSaved.set(name, data);\n    }\n}\n\n/**\n * Provides a base {@link System.SystemBase} implementation.\n */\nclass SystemBase {\n    /**\n     * When true constrains the min / max width or height to element.\n     */\n    #constrain;\n    /**\n     */\n    #element;\n    /**\n     * When true the validator is active.\n     */\n    #enabled;\n    /**\n     * Provides a manual setting of the element height. As things go `offsetHeight` causes a browser layout and is not\n     * performance oriented. If manually set this height is used instead of `offsetHeight`.\n     */\n    #height;\n    /**\n     * Set from an optional value in the constructor to lock accessors preventing modification.\n     */\n    #lock;\n    /**\n     * Stores the subscribers.\n     */\n    #subscribers = [];\n    /**\n     * Provides a manual setting of the element width. As things go `offsetWidth` causes a browser layout and is not\n     * performance oriented. If manually set this width is used instead of `offsetWidth`.\n     */\n    #width;\n    /**\n     * @param [options] - Initial options.\n     *\n     * @param [options.constrain=true] - Initial constrained state.\n     *\n     * @param [options.element] - Target element.\n     *\n     * @param [options.enabled=true] - Enabled state.\n     *\n     * @param [options.lock=false] - Lock parameters from being set.\n     *\n     * @param [options.width] - Manual width.\n     *\n     * @param [options.height] - Manual height.\n     */\n    constructor({ constrain = true, element, enabled = true, lock = false, width, height } = {}) {\n        this.#constrain = true;\n        this.#enabled = true;\n        this.constrain = constrain;\n        this.element = element;\n        this.enabled = enabled;\n        this.width = width;\n        this.height = height;\n        this.#lock = typeof lock === 'boolean' ? lock : false;\n    }\n    /**\n     * @returns The current constrain state.\n     */\n    get constrain() { return this.#constrain; }\n    /**\n     * @returns Target element.\n     */\n    get element() { return this.#element; }\n    /**\n     * @returns The current enabled state.\n     */\n    get enabled() { return this.#enabled; }\n    /**\n     * @returns Get manual height.\n     */\n    get height() { return this.#height; }\n    /**\n     * @return Get locked state.\n     */\n    get locked() { return this.#lock; }\n    /**\n     * @returns Get manual width.\n     */\n    get width() { return this.#width; }\n    /**\n     * @param constrain - New constrain state.\n     */\n    set constrain(constrain) {\n        if (this.#lock) {\n            return;\n        }\n        if (typeof constrain !== 'boolean') {\n            throw new TypeError(`'constrain' is not a boolean.`);\n        }\n        this.#constrain = constrain;\n        this.#updateSubscribers();\n    }\n    /**\n     * @param element - Set target element.\n     */\n    set element(element) {\n        if (this.#lock) {\n            return;\n        }\n        if (element === void 0 || element === null || A11yHelper.isFocusTarget(element)) {\n            this.#element = element;\n        }\n        else {\n            throw new TypeError(`'element' is not a HTMLElement, undefined, or null.`);\n        }\n        this.#updateSubscribers();\n    }\n    /**\n     * @param enabled - New enabled state.\n     */\n    set enabled(enabled) {\n        if (this.#lock) {\n            return;\n        }\n        if (typeof enabled !== 'boolean') {\n            throw new TypeError(`'enabled' is not a boolean.`);\n        }\n        this.#enabled = enabled;\n        this.#updateSubscribers();\n    }\n    /**\n     * @param height - Set manual height.\n     */\n    set height(height) {\n        if (this.#lock) {\n            return;\n        }\n        if (height === void 0 || Number.isFinite(height)) {\n            this.#height = height;\n        }\n        else {\n            throw new TypeError(`'height' is not a finite number or undefined.`);\n        }\n        this.#updateSubscribers();\n    }\n    /**\n     * @param width - Set manual width.\n     */\n    set width(width) {\n        if (this.#lock) {\n            return;\n        }\n        if (width === void 0 || Number.isFinite(width)) {\n            this.#width = width;\n        }\n        else {\n            throw new TypeError(`'width' is not a finite number or undefined.`);\n        }\n        this.#updateSubscribers();\n    }\n    /**\n     * Set manual width & height.\n     *\n     * @param width - New manual width.\n     *\n     * @param height - New manual height.\n     */\n    setDimension(width, height) {\n        if (this.#lock) {\n            return;\n        }\n        if (width === void 0 || Number.isFinite(width)) {\n            this.#width = width;\n        }\n        else {\n            throw new TypeError(`'width' is not a finite number or undefined.`);\n        }\n        if (height === void 0 || Number.isFinite(height)) {\n            this.#height = height;\n        }\n        else {\n            throw new TypeError(`'height' is not a finite number or undefined.`);\n        }\n        this.#updateSubscribers();\n    }\n    /**\n     * @param handler - Callback function that is invoked on update / changes. Receives a copy of the TJSPositionData.\n     *\n     * @returns Unsubscribe function.\n     */\n    subscribe(handler) {\n        const currentIdx = this.#subscribers.findIndex((entry) => entry === handler);\n        if (currentIdx === -1) {\n            this.#subscribers.push(handler); // add handler to the array of subscribers\n            handler(this); // call handler with current value\n        }\n        // Return unsubscribe function.\n        return () => {\n            const existingIdx = this.#subscribers.findIndex((entry) => entry === handler);\n            if (existingIdx !== -1) {\n                this.#subscribers.splice(existingIdx, 1);\n            }\n        };\n    }\n    /**\n     * Updates subscribers on changes.\n     */\n    #updateSubscribers() {\n        for (let cntr = 0; cntr < this.#subscribers.length; cntr++) {\n            this.#subscribers[cntr](this);\n        }\n    }\n}\n\n/**\n * Provides a {@link System.Initial.InitialSystem} implementation to center an element being positioned.\n */\nclass Centered extends SystemBase {\n    /**\n     * Get the left constraint based on any manual target values or the browser inner width.\n     *\n     * @param width - Target width.\n     *\n     * @returns Calculated left constraint.\n     */\n    getLeft(width) {\n        // Determine containing bounds from manual values; or any element; lastly the browser width / height.\n        const boundsWidth = this.width ?? this.element?.offsetWidth ?? globalThis.innerWidth;\n        return (boundsWidth - width) / 2;\n    }\n    /**\n     * Get the top constraint based on any manual target values or the browser inner height.\n     *\n     * @param height - Target height.\n     *\n     * @returns Calculated top constraint.\n     */\n    getTop(height) {\n        const boundsHeight = this.height ?? this.element?.offsetHeight ?? globalThis.innerHeight;\n        return (boundsHeight - height) / 2;\n    }\n}\n\n/**\n * Provides the storage and sequencing of managed position validators. Each validator added may be a bespoke function or\n * a {@link ValidatorData} object containing an `id`, `validator`, and `weight` attributes; `validator` is the only\n * required attribute.\n *\n * The `id` attribute can be anything that creates a unique ID for the validator; recommended strings or numbers. This\n * allows validators to be removed by ID easily.\n *\n * The `weight` attribute is a number between 0 and 1 inclusive that allows validators to be added in a predictable\n * order which is especially handy if they are manipulated at runtime. A lower weighted validator always runs before a\n * higher weighted validator. If no weight is specified the default of '1' is assigned, and it is appended to the end of\n * the validators list.\n *\n * This class forms the public API which is accessible from the {@link TJSPosition.validators} getter in the main\n * TJSPosition instance.\n * ```\n * const position = new TJSPosition();\n * position.validators.add(...);\n * position.validators.clear();\n * position.validators.length;\n * position.validators.remove(...);\n * position.validators.removeBy(...);\n * position.validators.removeById(...);\n * ```\n */\nclass AdapterValidators {\n    /**\n     */\n    #enabled = true;\n    /**\n     */\n    #validatorData;\n    /**\n     */\n    #mapUnsubscribe = new Map();\n    #updateFn;\n    /**\n     * @returns Returns this and internal storage for validator adapter.\n     */\n    static create(updateFn) {\n        const validatorAPI = new AdapterValidators(updateFn);\n        return [validatorAPI, validatorAPI.#validatorData];\n    }\n    /**\n     */\n    constructor(updateFn) {\n        this.#validatorData = [];\n        this.#updateFn = updateFn;\n        Object.seal(this);\n    }\n    /**\n     * @returns Returns the enabled state.\n     */\n    get enabled() { return this.#enabled; }\n    /**\n     * @returns Returns the length of the validators array.\n     */\n    get length() { return this.#validatorData.length; }\n    /**\n     * @param enabled - Sets enabled state.\n     */\n    set enabled(enabled) {\n        if (typeof enabled !== 'boolean') {\n            throw new TypeError(`'enabled' is not a boolean.`);\n        }\n        this.#enabled = enabled;\n    }\n    /**\n     * Provides an iterator for validators.\n     *\n     * @returns iterator.\n     */\n    *[Symbol.iterator]() {\n        if (this.#validatorData.length === 0) {\n            return;\n        }\n        for (const entry of this.#validatorData) {\n            yield { ...entry };\n        }\n    }\n    /**\n     * Adds the given validators.\n     *\n     * @param validators - Validators to add.\n     */\n    add(...validators) {\n        /**\n         * Tracks the number of validators added that have subscriber functionality.\n         */\n        let subscribeCount = 0;\n        for (const validator of validators) {\n            const validatorType = typeof validator;\n            if ((validatorType !== 'function' && validatorType !== 'object') || validator === null) {\n                throw new TypeError(`AdapterValidator error: 'validator' is not a function or object.`);\n            }\n            /**\n             */\n            let data = void 0;\n            /**\n             */\n            let subscribeFn = void 0;\n            switch (validatorType) {\n                case 'function':\n                    data = {\n                        id: void 0,\n                        validate: validator,\n                        weight: 1\n                    };\n                    subscribeFn = validator.subscribe;\n                    break;\n                case 'object':\n                    if ('validate' in validator) {\n                        if (typeof validator.validate !== 'function') {\n                            throw new TypeError(`AdapterValidator error: 'validate' attribute is not a function.`);\n                        }\n                        if (validator.weight !== void 0 && typeof validator.weight !== 'number' ||\n                            (validator?.weight < 0 || validator?.weight > 1)) {\n                            throw new TypeError(`AdapterValidator error: 'weight' attribute is not a number between '0 - 1' inclusive.`);\n                        }\n                        data = {\n                            id: validator.id !== void 0 ? validator.id : void 0,\n                            validate: validator.validate.bind(validator),\n                            weight: validator.weight || 1\n                        };\n                        subscribeFn = validator.validate.subscribe ?? validator.subscribe;\n                    }\n                    else {\n                        throw new TypeError(`AdapterValidator error: 'validate' attribute is not a function.`);\n                    }\n                    break;\n            }\n            // Find the index to insert where data.weight is less than existing values weight.\n            const index = this.#validatorData.findIndex((value) => data.weight < value.weight);\n            // If an index was found insert at that location.\n            if (index >= 0) {\n                this.#validatorData.splice(index, 0, data);\n            }\n            else // push to end of validators.\n             {\n                this.#validatorData.push(data);\n            }\n            if (typeof subscribeFn === 'function') {\n                const unsubscribe = subscribeFn.call(validator, this.#updateFn);\n                // Ensure that unsubscribe is a function.\n                if (typeof unsubscribe !== 'function') {\n                    throw new TypeError('AdapterValidator error: Validator has subscribe function, but no unsubscribe function is returned.');\n                }\n                // Ensure that the same validator is not subscribed to multiple times.\n                if (this.#mapUnsubscribe.has(data.validate)) {\n                    throw new Error('AdapterValidator error: Validator added already has an unsubscribe function registered.');\n                }\n                this.#mapUnsubscribe.set(data.validate, unsubscribe);\n                subscribeCount++;\n            }\n        }\n        // Validators with subscriber functionality are assumed to immediately invoke the `subscribe` callback. If the\n        // subscriber count is less than the amount of validators added then automatically trigger an update manually.\n        if (subscribeCount < validators.length) {\n            this.#updateFn();\n        }\n    }\n    /**\n     * Clears / removes all validators.\n     */\n    clear() {\n        this.#validatorData.length = 0;\n        // Unsubscribe from all validators with subscription support.\n        for (const unsubscribe of this.#mapUnsubscribe.values()) {\n            unsubscribe();\n        }\n        this.#mapUnsubscribe.clear();\n        this.#updateFn();\n    }\n    /**\n     * Removes one or more given validators.\n     *\n     * @param validators - Validators to remove.\n     */\n    remove(...validators) {\n        const length = this.#validatorData.length;\n        if (length === 0) {\n            return;\n        }\n        for (const data of validators) {\n            // Handle the case that the validator may either be a function or a validator entry / object.\n            const actualValidator = typeof data === 'function' ? data : isObject(data) ? data.validate : void 0;\n            if (!actualValidator) {\n                continue;\n            }\n            for (let cntr = this.#validatorData.length; --cntr >= 0;) {\n                if (this.#validatorData[cntr].validate === actualValidator) {\n                    this.#validatorData.splice(cntr, 1);\n                    // Invoke any unsubscribe function for given validator then remove from tracking.\n                    let unsubscribe = void 0;\n                    if (typeof (unsubscribe = this.#mapUnsubscribe.get(actualValidator)) === 'function') {\n                        unsubscribe();\n                        this.#mapUnsubscribe.delete(actualValidator);\n                    }\n                }\n            }\n        }\n        // Invoke update as a validator was removed.\n        if (length !== this.#validatorData.length) {\n            this.#updateFn();\n        }\n    }\n    /**\n     * Remove validators by the provided callback. The callback takes 3 parameters: `id`, `validator`, and `weight`.\n     * Any truthy value returned will remove that validator.\n     *\n     * @param callback - Callback function to evaluate each validator entry.\n     */\n    removeBy(callback) {\n        const length = this.#validatorData.length;\n        if (length === 0) {\n            return;\n        }\n        if (typeof callback !== 'function') {\n            throw new TypeError(`AdapterValidator error: 'callback' is not a function.`);\n        }\n        this.#validatorData = this.#validatorData.filter((data) => {\n            const remove = callback.call(callback, { ...data });\n            if (remove) {\n                let unsubscribe;\n                if (typeof (unsubscribe = this.#mapUnsubscribe.get(data.validate)) === 'function') {\n                    unsubscribe();\n                    this.#mapUnsubscribe.delete(data.validate);\n                }\n            }\n            // Reverse remove boolean to properly validator / remove this validator.\n            return !remove;\n        });\n        if (length !== this.#validatorData.length) {\n            this.#updateFn();\n        }\n    }\n    /**\n     * Removes any validators with matching IDs.\n     *\n     * @param ids - IDs to remove.\n     */\n    removeById(...ids) {\n        const length = this.#validatorData.length;\n        if (length === 0) {\n            return;\n        }\n        this.#validatorData = this.#validatorData.filter((data) => {\n            let remove = false;\n            for (const id of ids) {\n                remove ||= data.id === id;\n            }\n            // If not keeping invoke any unsubscribe function for given validator then remove from tracking.\n            if (remove) {\n                let unsubscribe;\n                if (typeof (unsubscribe = this.#mapUnsubscribe.get(data.validate)) === 'function') {\n                    unsubscribe();\n                    this.#mapUnsubscribe.delete(data.validate);\n                }\n            }\n            return !remove; // Swap here to actually remove the item via array validator method.\n        });\n        if (length !== this.#validatorData.length) {\n            this.#updateFn();\n        }\n    }\n}\n\nclass TransformBounds extends SystemBase {\n    static #TRANSFORM_DATA = new TJSTransformData();\n    /**\n     * Provides a validator that respects transforms in positional data constraining the position to within the target\n     * elements bounds.\n     *\n     * @param valData - The associated validation data for position updates.\n     *\n     * @returns Potentially adjusted position data.\n     */\n    validate(valData) {\n        // Early out if element is undefined or local enabled state is false.\n        if (!this.enabled) {\n            return valData.position;\n        }\n        // Determine containing bounds from manual values; or any element; lastly the browser width / height.\n        const boundsWidth = this.width ?? this.element?.offsetWidth ?? globalThis.innerWidth;\n        const boundsHeight = this.height ?? this.element?.offsetHeight ?? globalThis.innerHeight;\n        // Ensure min / max width constraints when position width is a number; not 'auto' or 'inherit'. If constrain is\n        // true cap width bounds.\n        if (typeof valData.position.width === 'number') {\n            const maxW = valData.maxWidth ?? (this.constrain ? boundsWidth : Number.MAX_SAFE_INTEGER);\n            valData.position.width = clamp(valData.width, valData.minWidth, maxW);\n        }\n        // Ensure min / max height constraints when position height is a number; not 'auto' or 'inherit'. If constrain\n        // is true cap height bounds.\n        if (typeof valData.position.height === 'number') {\n            const maxH = valData.maxHeight ?? (this.constrain ? boundsHeight : Number.MAX_SAFE_INTEGER);\n            valData.position.height = clamp(valData.height, valData.minHeight, maxH);\n        }\n        // Get transform data. First set constraints including any margin top / left as offsets and width / height. Used\n        // when position width / height is 'auto'.\n        const data = valData.transforms.getData(valData.position, TransformBounds.#TRANSFORM_DATA, valData);\n        // Check the bounding rectangle against browser height / width. Adjust position based on how far the overlap of\n        // the bounding rect is outside the bounds height / width. The order below matters as the constraints are top /\n        // left oriented, so perform those checks last.\n        const initialX = data.boundingRect.x;\n        const initialY = data.boundingRect.y;\n        const marginTop = valData.marginTop ?? 0;\n        const marginLeft = valData.marginLeft ?? 0;\n        if (data.boundingRect.bottom + marginTop > boundsHeight) {\n            data.boundingRect.y += boundsHeight - data.boundingRect.bottom - marginTop;\n        }\n        if (data.boundingRect.right + marginLeft > boundsWidth) {\n            data.boundingRect.x += boundsWidth - data.boundingRect.right - marginLeft;\n        }\n        if (data.boundingRect.top - marginTop < 0) {\n            data.boundingRect.y += Math.abs(data.boundingRect.top - marginTop);\n        }\n        if (data.boundingRect.left - marginLeft < 0) {\n            data.boundingRect.x += Math.abs(data.boundingRect.left - marginLeft);\n        }\n        valData.position.left -= initialX - data.boundingRect.x;\n        valData.position.top -= initialY - data.boundingRect.y;\n        return valData.position;\n    }\n}\n\n/**\n * Tracks changes to positional data during {@link TJSPosition.set} updates to minimize changes to the element style in\n * {@link UpdateElementManager}.\n */\nclass PositionChangeSet {\n    left;\n    top;\n    width;\n    height;\n    maxHeight;\n    maxWidth;\n    minHeight;\n    minWidth;\n    zIndex;\n    transform;\n    transformOrigin;\n    constructor() {\n        this.left = false;\n        this.top = false;\n        this.width = false;\n        this.height = false;\n        this.maxHeight = false;\n        this.maxWidth = false;\n        this.minHeight = false;\n        this.minWidth = false;\n        this.zIndex = false;\n        this.transform = false;\n        this.transformOrigin = false;\n    }\n    hasChange() {\n        return this.left || this.top || this.width || this.height || this.maxHeight || this.maxWidth || this.minHeight ||\n            this.minWidth || this.zIndex || this.transform || this.transformOrigin;\n    }\n    set(value) {\n        this.left = value;\n        this.top = value;\n        this.width = value;\n        this.height = value;\n        this.maxHeight = value;\n        this.maxWidth = value;\n        this.minHeight = value;\n        this.minWidth = value;\n        this.zIndex = value;\n        this.transform = value;\n        this.transformOrigin = value;\n    }\n}\n\n/**\n * Encapsulates internal data from a TJSPosition instance to be manipulated by {@link UpdateElementManager}.\n */\nclass UpdateElementData {\n    changeSet;\n    data;\n    dataSubscribers;\n    dimensionData;\n    options;\n    queued;\n    storeDimension;\n    storeTransform;\n    styleCache;\n    subscribers;\n    transforms;\n    transformData;\n    constructor(changeSet, data, options, styleCache, subscribers, transforms) {\n        /**\n         */\n        this.changeSet = changeSet;\n        /**\n         * Stores the private data from TJSPosition.\n         */\n        this.data = data;\n        /**\n         * Provides a copy of local data sent to subscribers.\n         */\n        this.dataSubscribers = Object.seal(new TJSPositionData());\n        /**\n         * Stores the current dimension data used for the readable `dimension` store.\n         */\n        this.dimensionData = Object.seal({ width: 0, height: 0 });\n        /**\n         */\n        this.options = options;\n        /**\n         * Stores if this TJSPosition / update data is queued for update.\n         */\n        this.queued = false;\n        /**\n         */\n        this.styleCache = styleCache;\n        /**\n         */\n        this.storeDimension = writable(this.dimensionData);\n        /**\n         */\n        this.subscribers = subscribers;\n        /**\n         */\n        this.transforms = transforms;\n        /**\n         * Stores the current transform data used for the readable `transform` store. It is only active when there are\n         * subscribers to the store or calculateTransform options is true.\n         */\n        this.transformData = new TJSTransformData();\n        /**\n         * When there are subscribers set option to calculate transform updates; set to false when no subscribers.\n         */\n        this.storeTransform = writable(this.transformData, () => {\n            this.options.transformSubscribed = true;\n            return () => this.options.transformSubscribed = false;\n        });\n    }\n}\n\n/**\n * Decouples updates to any parent target HTMLElement inline styles. Invoke {@link TJSPosition.elementUpdated} to await\n * on the returned promise that is resolved with the current render time via `nextAnimationFrame` /\n * `requestAnimationFrame`. This allows the underlying data model to be updated immediately while updates to the\n * element are in sync with the browser and potentially in the future be further throttled.\n */\nclass UpdateElementManager {\n    /**\n     * Stores the active list of all TJSPosition instances currently updating. The list entries are recycled between\n     * updates.\n     */\n    static list = [];\n    /**\n     * Tracks the current position in the list.\n     */\n    static listCntr = 0;\n    static updatePromise;\n    /**\n     * Potentially adds the given element and internal updateData instance to the list.\n     *\n     * @param el - An HTMLElement instance.\n     *\n     * @param updateData - An UpdateElementData instance.\n     *\n     * @returns The unified next frame update promise. Returns `currentTime`.\n     */\n    static add(el, updateData) {\n        if (this.listCntr < this.list.length) {\n            const entry = this.list[this.listCntr];\n            entry[0] = el;\n            entry[1] = updateData;\n        }\n        else {\n            this.list.push([el, updateData]);\n        }\n        this.listCntr++;\n        updateData.queued = true;\n        if (!this.updatePromise) {\n            this.updatePromise = this.wait();\n        }\n        return this.updatePromise;\n    }\n    /**\n     * Await on `nextAnimationFrame` and iterate over list map invoking callback functions.\n     *\n     * @returns The next frame Promise / currentTime from nextAnimationFrame.\n     */\n    static async wait() {\n        // Await the next animation frame. In the future this can be extended to multiple frames to divide update rate.\n        const currentTime = await nextAnimationFrame();\n        this.updatePromise = void 0;\n        for (let cntr = this.listCntr; --cntr >= 0;) {\n            // Obtain data for entry.\n            const entry = this.list[cntr];\n            const el = entry[0];\n            const updateData = entry[1];\n            // Clear entry data.\n            entry[0] = void 0;\n            entry[1] = void 0;\n            // Reset queued state.\n            updateData.queued = false;\n            // Early out if the element is no longer connected to the DOM / shadow root.\n            if (!el.isConnected) {\n                continue;\n            }\n            if (updateData.options.ortho) {\n                UpdateElementManager.#updateElementOrtho(el, updateData);\n            }\n            else {\n                UpdateElementManager.#updateElement(el, updateData);\n            }\n            // If calculate transform options is enabled then update the transform data and set the readable store.\n            if (updateData.options.calculateTransform || updateData.options.transformSubscribed) {\n                UpdateElementManager.#updateTransform(updateData);\n            }\n            // Update all subscribers with changed data.\n            this.updateSubscribers(updateData);\n        }\n        this.listCntr = 0;\n        return currentTime;\n    }\n    /**\n     * Potentially immediately updates the given element.\n     *\n     * @param el - An HTMLElement instance.\n     *\n     * @param updateData - An UpdateElementData instance.\n     */\n    static immediate(el, updateData) {\n        // Early out if the element is no longer connected to the DOM / shadow root.\n        if (!el.isConnected) {\n            return;\n        }\n        if (updateData.options.ortho) {\n            UpdateElementManager.#updateElementOrtho(el, updateData);\n        }\n        else {\n            UpdateElementManager.#updateElement(el, updateData);\n        }\n        // If calculate transform options is enabled then update the transform data and set the readable store.\n        if (updateData.options.calculateTransform || updateData.options.transformSubscribed) {\n            UpdateElementManager.#updateTransform(updateData);\n        }\n        // Update all subscribers with changed data.\n        this.updateSubscribers(updateData);\n    }\n    /**\n     * @param updateData - Data change set.\n     */\n    static updateSubscribers(updateData) {\n        const data = updateData.data;\n        const changeSet = updateData.changeSet;\n        if (!changeSet.hasChange()) {\n            return;\n        }\n        // Make a copy of the data.\n        const output = TJSPositionDataUtil.copyData(data, updateData.dataSubscribers);\n        const subscribers = updateData.subscribers;\n        // Early out if there are no subscribers.\n        if (subscribers.length > 0) {\n            for (let cntr = 0; cntr < subscribers.length; cntr++) {\n                subscribers[cntr](output);\n            }\n        }\n        // Update dimension data if width / height has changed.\n        if (changeSet.width || changeSet.height) {\n            updateData.dimensionData.width = data.width;\n            updateData.dimensionData.height = data.height;\n            updateData.storeDimension.set(updateData.dimensionData);\n        }\n        changeSet.set(false);\n    }\n    // Internal Implementation ----------------------------------------------------------------------------------------\n    /**\n     * Temporary data for validation.\n     */\n    static #validationData = Object.seal({\n        height: 0,\n        width: 0,\n        marginLeft: 0,\n        marginTop: 0\n    });\n    /**\n     * Decouples updates to any parent target HTMLElement inline styles. Invoke {@link TJSPosition.elementUpdated} to\n     * await on the returned promise that is resolved with the current render time via `nextAnimationFrame` /\n     * `requestAnimationFrame`. This allows the underlying data model to be updated immediately while updates to the\n     * element are in sync with the browser and potentially in the future be further throttled.\n     *\n     * @param el - The target HTMLElement.\n     *\n     * @param updateData - Update data.\n     */\n    static #updateElement(el, updateData) {\n        const changeSet = updateData.changeSet;\n        const data = updateData.data;\n        if (changeSet.left) {\n            el.style.left = `${data.left}px`;\n        }\n        if (changeSet.top) {\n            el.style.top = `${data.top}px`;\n        }\n        if (changeSet.zIndex) {\n            el.style.zIndex = typeof data.zIndex === 'number' ? `${data.zIndex}` : '';\n        }\n        if (changeSet.width) {\n            el.style.width = typeof data.width === 'number' ? `${data.width}px` : data.width;\n        }\n        if (changeSet.height) {\n            el.style.height = typeof data.height === 'number' ? `${data.height}px` : data.height;\n        }\n        if (changeSet.transformOrigin) {\n            el.style.transformOrigin = data.transformOrigin;\n        }\n        // Update all transforms in order added to transforms object.\n        if (changeSet.transform) {\n            el.style.transform = updateData.transforms.isActive ? updateData.transforms.getCSS() : '';\n        }\n    }\n    /**\n     * Decouples updates to any parent target HTMLElement inline styles. Invoke {@link TJSPosition.elementUpdated} to\n     * await on the returned promise that is resolved with the current render time via `nextAnimationFrame` /\n     * `requestAnimationFrame`. This allows the underlying data model to be updated immediately while updates to the\n     * element are in sync with the browser and potentially in the future be further throttled.\n     *\n     * @param el - The target HTMLElement.\n     *\n     * @param updateData - Update data.\n     */\n    static #updateElementOrtho(el, updateData) {\n        const changeSet = updateData.changeSet;\n        const data = updateData.data;\n        if (changeSet.zIndex) {\n            el.style.zIndex = typeof data.zIndex === 'number' ? `${data.zIndex}` : '';\n        }\n        if (changeSet.width) {\n            el.style.width = typeof data.width === 'number' ? `${data.width}px` : data.width;\n        }\n        if (changeSet.height) {\n            el.style.height = typeof data.height === 'number' ? `${data.height}px` : data.height;\n        }\n        if (changeSet.transformOrigin) {\n            el.style.transformOrigin = data.transformOrigin;\n        }\n        // Update all transforms in order added to transforms object.\n        if (changeSet.left || changeSet.top || changeSet.transform) {\n            el.style.transform = updateData.transforms.getCSSOrtho(data);\n        }\n    }\n    /**\n     * Updates the applied transform data and sets the readable `transform` store.\n     *\n     * @param updateData - Update element data.\n     */\n    static #updateTransform(updateData) {\n        const validationData = this.#validationData;\n        validationData.height = updateData.data.height !== 'auto' && updateData.data.height !== 'inherit' ?\n            updateData.data.height : updateData.styleCache.offsetHeight;\n        validationData.width = updateData.data.width !== 'auto' && updateData.data.width !== 'inherit' ?\n            updateData.data.width : updateData.styleCache.offsetWidth;\n        validationData.marginLeft = updateData.styleCache.marginLeft;\n        validationData.marginTop = updateData.styleCache.marginTop;\n        // Get transform data. First set constraints including any margin top / left as offsets and width / height. Used\n        // when position width / height is 'auto'.\n        updateData.transforms.getData(updateData.data, updateData.transformData, validationData);\n        updateData.storeTransform.set(updateData.transformData);\n    }\n}\n\nvar _a;\n/**\n * Provides an advanced compound store for positioning elements dynamically including an optimized pipeline for updating\n * an associated element. Essential tweening / animation is supported in addition to a validation API to constrain\n * positional updates.\n */\nclass TJSPosition {\n    /**\n     * Public API for {@link TJSPosition.Initial}.\n     */\n    static #positionInitial = Object.freeze({\n        browserCentered: new Centered({ lock: true }),\n        Centered\n    });\n    /**\n     * Public API for {@link TJSPosition.Validators}\n     */\n    static #positionValidators = Object.freeze({\n        TransformBounds,\n        transformWindow: new TransformBounds({ lock: true })\n    });\n    /**\n     * Stores all position data / properties.\n     */\n    #data = Object.seal(new TJSPositionData());\n    /**\n     * Provides the animation API.\n     */\n    #animate = new AnimationAPIImpl(this, this.#data);\n    /**\n     * Provides a way to turn on / off the position handling.\n     */\n    #enabled = true;\n    /**\n     * Stores ongoing options that are set in the constructor or by transform store subscription.\n     */\n    #options = {\n        calculateTransform: false,\n        initial: void 0,\n        ortho: true,\n        transformSubscribed: false,\n    };\n    /**\n     * The associated parent for positional data tracking. Used in validators.\n     */\n    #parent;\n    /**\n     * Stores the style attributes that changed on update.\n     */\n    #positionChangeSet = new PositionChangeSet();\n    /**\n     * Tracks the current state if this position instance is a candidate for resize observation by the `resizeObserver`\n     * action. This is `true` when `width` or `height` is `auto` or `inherit`.\n     */\n    #resizeObservable = false;\n    /**\n     */\n    #stores;\n    /**\n     * Stores an instance of the computer styles for the target element.\n     */\n    #styleCache;\n    /**\n     * Stores the subscribers.\n     */\n    #subscribers = [];\n    /**\n     */\n    #transforms = new TJSTransforms();\n    /**\n     */\n    #updateElementData;\n    /**\n     * Stores the UpdateElementManager wait promise.\n     */\n    #updateElementPromise;\n    /**\n     */\n    #validators;\n    /**\n     */\n    #validatorData;\n    /**\n     */\n    #state = new PositionStateAPI(this, this.#data, this.#transforms);\n    /**\n     * @returns Public Animation Group API.\n     */\n    static get Animate() { return AnimationGroupAPIImpl; }\n    /**\n     * @returns TJSPositionData constructor.\n     */\n    static get Data() { return TJSPositionData; }\n    /**\n     * @returns TJSPosition default initial systems.\n     */\n    static get Initial() { return this.#positionInitial; }\n    /**\n     * @returns `SystemBase` constructor.\n     */\n    static get SystemBase() { return SystemBase; }\n    /**\n     * Returns TJSTransformData class / constructor.\n     *\n     * @returns TransformData class / constructor.\n     */\n    static get TransformData() { return TJSTransformData; }\n    /**\n     * Returns default validator systems.\n     *\n     * @returns Available validators.\n     */\n    static get Validators() { return this.#positionValidators; }\n    /**\n     * Returns a list of supported transform origins.\n     *\n     * @returns The supported transform origin strings.\n     */\n    static get transformOrigins() {\n        return TJSTransforms.transformOrigins;\n    }\n    /**\n     * Convenience to copy from source to target of two TJSPositionData like objects. If a target is not supplied a new\n     * {@link TJSPositionData} instance is created.\n     *\n     * @param source - The source instance to copy from.\n     *\n     * @param [target] - Target TJSPositionData like object; if one is not provided a new instance is created.\n     *\n     * @returns The target instance with all TJSPositionData fields.\n     */\n    static copyData(source, target) {\n        return TJSPositionDataUtil.copyData(source, target);\n    }\n    /**\n     * Returns a duplicate of a given position instance copying any options and validators. The position parent is not\n     * copied and a new one must be set manually via the {@link TJSPosition.parent} setter.\n     *\n     * @param position - A position instance.\n     *\n     * @param [options] - Unique new options to set.\n     *\n     * @returns A duplicate position instance.\n     */\n    static duplicate(position, options = {}) {\n        if (!(position instanceof _a)) {\n            throw new TypeError(`'position' is not an instance of TJSPosition.`);\n        }\n        const newPosition = new _a(options);\n        newPosition.#options = Object.assign({}, position.#options, options);\n        newPosition.#validators.add(...position.#validators);\n        newPosition.set(position.#data);\n        return newPosition;\n    }\n    /**\n     * @param [parentOrOptions] - A  potential parent element or object w/ `elementTarget` accessor. You may also forego\n     *        setting the parent and pass in the options object.\n     *\n     * @param [options] - The options object.\n     */\n    constructor(parentOrOptions, options) {\n        // Test if `parent` is a plain object; if so treat as options object.\n        if (isPlainObject(parentOrOptions)) {\n            options = parentOrOptions;\n        }\n        else {\n            this.#parent = parentOrOptions;\n        }\n        this.#styleCache = new TJSPositionStyleCache();\n        const updateData = new UpdateElementData(this.#positionChangeSet, this.#data, this.#options, this.#styleCache, this.#subscribers, this.#transforms);\n        this.#updateElementData = updateData;\n        // Set TJSPosition options -------------------------------------------------------------------------------------\n        if (typeof options?.calculateTransform === 'boolean') {\n            this.#options.calculateTransform = options.calculateTransform;\n        }\n        if (typeof options?.ortho === 'boolean') {\n            this.#options.ortho = options.ortho;\n        }\n        // Initialize stores -------------------------------------------------------------------------------------------\n        this.#stores = Object.freeze({\n            // The main properties for manipulating TJSPosition.\n            height: propertyStore(this, 'height'),\n            left: propertyStore(this, 'left'),\n            rotateX: propertyStore(this, 'rotateX'),\n            rotateY: propertyStore(this, 'rotateY'),\n            rotateZ: propertyStore(this, 'rotateZ'),\n            scale: propertyStore(this, 'scale'),\n            top: propertyStore(this, 'top'),\n            transformOrigin: propertyStore(this, 'transformOrigin'),\n            translateX: propertyStore(this, 'translateX'),\n            translateY: propertyStore(this, 'translateY'),\n            translateZ: propertyStore(this, 'translateZ'),\n            width: propertyStore(this, 'width'),\n            zIndex: propertyStore(this, 'zIndex'),\n            // Stores that control validation when width / height is not `auto`.\n            maxHeight: propertyStore(this, 'maxHeight'),\n            maxWidth: propertyStore(this, 'maxWidth'),\n            minHeight: propertyStore(this, 'minHeight'),\n            minWidth: propertyStore(this, 'minWidth'),\n            // Readable stores based on updates or from resize observer changes.\n            dimension: { subscribe: updateData.storeDimension.subscribe },\n            element: { subscribe: this.#styleCache.stores.element.subscribe },\n            resizeContentHeight: { subscribe: this.#styleCache.stores.resizeContentHeight.subscribe },\n            resizeContentWidth: { subscribe: this.#styleCache.stores.resizeContentWidth.subscribe },\n            resizeObservable: { subscribe: this.#styleCache.stores.resizeObservable.subscribe },\n            resizeOffsetHeight: { subscribe: this.#styleCache.stores.resizeOffsetHeight.subscribe },\n            resizeOffsetWidth: { subscribe: this.#styleCache.stores.resizeOffsetWidth.subscribe },\n            transform: { subscribe: updateData.storeTransform.subscribe },\n            // Protected store that should only be set by resizeObserver action.\n            resizeObserved: this.#styleCache.stores.resizeObserved,\n        });\n        /**\n         * Define 'values' getter to retrieve static transform origins.\n         */\n        Object.defineProperty(this.#stores.transformOrigin, 'values', {\n            get: () => _a.transformOrigins\n        });\n        // When resize change from any applied `resizeObserver` action automatically set data for new validation run.\n        // A resizeObserver prop should be set to true for ApplicationShell components or usage of resizeObserver action\n        // to monitor for changes. This should only be used on elements that have 'auto' or `inherit` for width or height.\n        subscribeIgnoreFirst(this.#stores.resizeObserved, (resizeData) => {\n            const parent = this.#parent;\n            const el = A11yHelper.isFocusTarget(parent) ? parent : parent?.elementTarget;\n            // Only invoke set if there is a target element and the resize data has a valid offset width & height.\n            if (A11yHelper.isFocusTarget(el) && Number.isFinite(resizeData?.offsetWidth) &&\n                Number.isFinite(resizeData?.offsetHeight)) {\n                this.set();\n            }\n        });\n        [this.#validators, this.#validatorData] = AdapterValidators.create(() => this.set());\n        if (options?.initial) {\n            const initial = options.initial;\n            if (typeof initial?.getLeft !== 'function' || typeof initial?.getTop !== 'function') {\n                throw new Error(`'options.initial' position helper does not contain 'getLeft' and / or 'getTop' functions.`);\n            }\n            this.#options.initial = initial;\n        }\n        if (options?.validator) {\n            if (isIterable(options?.validator)) {\n                this.validators.add(...options.validator);\n            }\n            else {\n                /**\n                 */\n                const validatorFn = options.validator;\n                this.validators.add(validatorFn);\n            }\n        }\n        Object.seal(this);\n        // Set any remaining position data.\n        if (isObject(options)) {\n            this.set(options);\n        }\n    }\n    /**\n     * Returns the animation API.\n     *\n     * @returns Animation instance API.\n     */\n    get animate() {\n        return this.#animate;\n    }\n    /**\n     * Returns the dimension data for the readable store.\n     *\n     * @returns Dimension data.\n     */\n    get dimension() {\n        return this.#updateElementData.dimensionData;\n    }\n    /**\n     * Returns the enabled state.\n     *\n     * @returns Enabled state.\n     */\n    get enabled() {\n        return this.#enabled;\n    }\n    /**\n     * Returns the current HTMLElement being positioned.\n     *\n     * @returns Current HTMLElement being positioned.\n     */\n    get element() {\n        return this.#styleCache.el;\n    }\n    /**\n     * Returns a promise that is resolved on the next element update with the time of the update.\n     *\n     * @returns Promise resolved on element update.\n     */\n    get elementUpdated() {\n        return this.#updateElementPromise;\n    }\n    /**\n     * Returns the associated {@link TJSPosition.PositionParent} instance.\n     *\n     * @returns The current position parent instance.\n     */\n    get parent() { return this.#parent; }\n    /**\n     * Returns the state API.\n     *\n     * @returns TJSPosition state API.\n     */\n    get state() { return this.#state; }\n    /**\n     * Returns the derived writable stores for individual data variables.\n     *\n     * @returns Derived / writable stores.\n     */\n    get stores() { return this.#stores; }\n    /**\n     * Returns the transform data for the readable store.\n     *\n     * @returns Transform Data.\n     */\n    get transform() {\n        return this.#updateElementData.transformData;\n    }\n    /**\n     * Returns the validators.\n     *\n     * @returns Validators API\n     */\n    get validators() { return this.#validators; }\n    /**\n     * Sets the enabled state.\n     *\n     * @param enabled - New enabled state.\n     */\n    set enabled(enabled) {\n        if (typeof enabled !== 'boolean') {\n            throw new TypeError(`'enabled' is not a boolean.`);\n        }\n        this.#enabled = enabled;\n    }\n    /**\n     * Sets the associated {@link TJSPosition.PositionParent} instance. Resets the style cache and default data.\n     *\n     * @param parent - A PositionParent instance or undefined to disassociate\n     */\n    set parent(parent) {\n        if (parent !== void 0 && !A11yHelper.isFocusTarget(parent) && !isObject(parent)) {\n            throw new TypeError(`'parent' is not an HTMLElement, object, or undefined.`);\n        }\n        this.#parent = parent;\n        // Reset any stored default data & the style cache.\n        this.#state.remove({ name: '#defaultData' });\n        this.#styleCache.reset();\n        // If a parent is defined then invoke set to update any parent element.\n        if (parent) {\n            this.set(this.#data);\n        }\n    }\n    // Data accessors ----------------------------------------------------------------------------------------------------\n    /**\n     * @returns height\n     */\n    get height() { return this.#data.height; }\n    /**\n     * @returns left\n     */\n    get left() { return this.#data.left; }\n    /**\n     * @returns maxHeight\n     */\n    get maxHeight() { return this.#data.maxHeight; }\n    /**\n     * @returns maxWidth\n     */\n    get maxWidth() { return this.#data.maxWidth; }\n    /**\n     * @returns minHeight\n     */\n    get minHeight() { return this.#data.minHeight; }\n    /**\n     * @returns minWidth\n     */\n    get minWidth() { return this.#data.minWidth; }\n    /**\n     * @returns rotateX\n     */\n    get rotateX() { return this.#data.rotateX; }\n    /**\n     * @returns rotateY\n     */\n    get rotateY() { return this.#data.rotateY; }\n    /**\n     * @returns rotateZ\n     */\n    get rotateZ() { return this.#data.rotateZ; }\n    /**\n     * @returns Alias for rotateZ\n     */\n    get rotation() { return this.#data.rotateZ; }\n    /**\n     * @returns scale\n     */\n    get scale() { return this.#data.scale; }\n    /**\n     * @returns top\n     */\n    get top() { return this.#data.top; }\n    /**\n     * @returns transformOrigin\n     */\n    get transformOrigin() { return this.#data.transformOrigin; }\n    /**\n     * @returns translateX\n     */\n    get translateX() { return this.#data.translateX; }\n    /**\n     * @returns translateY\n     */\n    get translateY() { return this.#data.translateY; }\n    /**\n     * @returns translateZ\n     */\n    get translateZ() { return this.#data.translateZ; }\n    /**\n     * @returns width\n     */\n    get width() { return this.#data.width; }\n    /**\n     * @returns z-index\n     */\n    get zIndex() { return this.#data.zIndex; }\n    /**\n     * @param height -\n     */\n    set height(height) {\n        this.#stores.height.set(height);\n    }\n    /**\n     * @param left -\n     */\n    set left(left) {\n        this.#stores.left.set(left);\n    }\n    /**\n     * @param maxHeight -\n     */\n    set maxHeight(maxHeight) {\n        this.#stores.maxHeight.set(maxHeight);\n    }\n    /**\n     * @param maxWidth -\n     */\n    set maxWidth(maxWidth) {\n        this.#stores.maxWidth.set(maxWidth);\n    }\n    /**\n     * @param minHeight -\n     */\n    set minHeight(minHeight) {\n        this.#stores.minHeight.set(minHeight);\n    }\n    /**\n     * @param minWidth -\n     */\n    set minWidth(minWidth) {\n        this.#stores.minWidth.set(minWidth);\n    }\n    /**\n     * @param rotateX -\n     */\n    set rotateX(rotateX) {\n        this.#stores.rotateX.set(rotateX);\n    }\n    /**\n     * @param rotateY -\n     */\n    set rotateY(rotateY) {\n        this.#stores.rotateY.set(rotateY);\n    }\n    /**\n     * @param rotateZ -\n     */\n    set rotateZ(rotateZ) {\n        this.#stores.rotateZ.set(rotateZ);\n    }\n    /**\n     * @param  rotateZ - alias for rotateZ\n     */\n    set rotation(rotateZ) {\n        this.#stores.rotateZ.set(rotateZ);\n    }\n    /**\n     * @param scale -\n     */\n    set scale(scale) {\n        this.#stores.scale.set(scale);\n    }\n    /**\n     * @param top -\n     */\n    set top(top) {\n        this.#stores.top.set(top);\n    }\n    /**\n     * @param transformOrigin -\n     */\n    set transformOrigin(transformOrigin) {\n        if (TJSTransforms.transformOrigins.includes(transformOrigin)) {\n            this.#stores.transformOrigin.set(transformOrigin);\n        }\n    }\n    /**\n     * @param translateX -\n     */\n    set translateX(translateX) {\n        this.#stores.translateX.set(translateX);\n    }\n    /**\n     * @param translateY -\n     */\n    set translateY(translateY) {\n        this.#stores.translateY.set(translateY);\n    }\n    /**\n     * @param translateZ -\n     */\n    set translateZ(translateZ) {\n        this.#stores.translateZ.set(translateZ);\n    }\n    /**\n     * @param width -\n     */\n    set width(width) {\n        this.#stores.width.set(width);\n    }\n    /**\n     * @param zIndex -\n     */\n    set zIndex(zIndex) {\n        this.#stores.zIndex.set(zIndex);\n    }\n    /**\n     * Assigns current position data to given object `data` object. By default, `null` position data is not assigned.\n     * Other options allow configuration of the data assigned including setting default numeric values for any properties\n     * that are null.\n     *\n     * @param [data] - Target to assign current position data.\n     *\n     * @param [options] - Defines options for specific keys and substituting null for numeric default values. By\n     *        default, nullable keys are included.\n     *\n     * @returns Passed in object with current position data.\n     */\n    get(data = {}, options = {}) {\n        const keys = options?.keys;\n        const excludeKeys = options?.exclude;\n        const nullable = options?.nullable ?? true;\n        const numeric = options?.numeric ?? false;\n        if (isIterable(keys)) {\n            for (const key of keys) {\n                // Convert any null values to numeric defaults if `numeric` is true.\n                data[key] = numeric ? TJSPositionDataUtil.getDataOrDefault(this, key) : this[key];\n                // Potentially remove null keys.\n                if (!nullable && data[key] === null) {\n                    delete data[key];\n                }\n            }\n            // Remove any excluded keys.\n            if (isIterable(excludeKeys)) {\n                for (const key of excludeKeys) {\n                    delete data[key];\n                }\n            }\n            return data;\n        }\n        else {\n            data = Object.assign(data, this.#data);\n            // Remove any excluded keys.\n            if (isIterable(excludeKeys)) {\n                for (const key of excludeKeys) {\n                    delete data[key];\n                }\n            }\n            // Potentially set numeric defaults.\n            if (numeric) {\n                TJSPositionDataUtil.setNumericDefaults(data);\n            }\n            if (!nullable) {\n                for (const key in data) {\n                    if (data[key] === null) {\n                        delete data[key];\n                    }\n                }\n            }\n            return data;\n        }\n    }\n    /**\n     * @returns Current position data.\n     */\n    toJSON() {\n        return Object.assign({}, this.#data);\n    }\n    /**\n     * All calculation and updates of position are implemented in {@link TJSPosition}. This allows position to be fully\n     * reactive and in control of updating inline styles for a connected {@link HTMLElement}.\n     *\n     * The initial set call with a target element will always set width / height as this is necessary for correct\n     * calculations.\n     *\n     * When a target element is present updated styles are applied after validation. To modify the behavior of set\n     * implement one or more validator functions and add them via the validator API available from\n     * {@link TJSPosition.validators}.\n     *\n     * Updates to any target element are decoupled from the underlying TJSPosition data. This method returns this\n     * instance that you can then await on the target element inline style update by using\n     * {@link TJSPosition.elementUpdated}.\n     *\n     * Relative updates to any property of {@link TJSPositionData} are possible by specifying properties as strings.\n     * This string should be in the form of '+=', '-=', or '*=' and float / numeric value. IE '+=0.2'.\n     * {@link TJSPosition.set} will apply the `addition`, `subtraction`, or `multiplication` operation specified against\n     * the current value of the given property. Please see {@link Data.TJSPositionDataRelative} for a detailed\n     * description.\n     *\n     * @param [position] - TJSPosition data to set.\n     *\n     * @param [options] - Additional options.\n     *\n     * @returns This TJSPosition instance.\n     */\n    set(position = {}, options = {}) {\n        if (!isObject(position)) {\n            throw new TypeError(`TJSPosition - set error: 'position' is not an object.`);\n        }\n        // TJSPosition.PositionParent\n        const parent = this.#parent;\n        // An early out to prevent `set` from taking effect if not enabled.\n        if (!this.#enabled) {\n            return this;\n        }\n        // An early out to prevent `set` from taking effect if options `positionable` is false.\n        // TODO: THIS IS REFERENCING APPLICATION OPTIONS.\n        if (parent !== void 0 && typeof parent?.options?.positionable === 'boolean' && !parent?.options?.positionable) {\n            return this;\n        }\n        const immediateElementUpdate = options?.immediateElementUpdate ?? false;\n        const data = this.#data;\n        const transforms = this.#transforms;\n        // Find the target HTML element and verify that it is connected storing it in `el`.\n        const targetEl = A11yHelper.isFocusTarget(parent) ? parent : parent?.elementTarget;\n        const el = A11yHelper.isFocusTarget(targetEl) && targetEl.isConnected ? targetEl :\n            void 0;\n        const changeSet = this.#positionChangeSet;\n        const styleCache = this.#styleCache;\n        if (el) {\n            // Cache the computed styles of the element.\n            if (!styleCache.hasData(el)) {\n                styleCache.update(el);\n                // Add will-change property if not already set in inline or computed styles.\n                if (!styleCache.hasWillChange) ;\n                // Update all properties / clear queued state.\n                changeSet.set(true);\n                this.#updateElementData.queued = false;\n            }\n            // Converts any string position data to numeric inputs.\n            ConvertStringData.process(position, this.#data, el);\n            position = this.#updatePosition(position, parent, el, styleCache);\n            // Check if a validator cancelled the update.\n            if (position === null) {\n                return this;\n            }\n        }\n        if (NumberGuard.isFinite(position.left)) {\n            position.left = Math.round(position.left);\n            if (data.left !== position.left) {\n                data.left = position.left;\n                changeSet.left = true;\n            }\n        }\n        if (NumberGuard.isFinite(position.top)) {\n            position.top = Math.round(position.top);\n            if (data.top !== position.top) {\n                data.top = position.top;\n                changeSet.top = true;\n            }\n        }\n        if (NumberGuard.isFiniteOrNull(position.maxHeight)) {\n            position.maxHeight = typeof position.maxHeight === 'number' ? Math.round(position.maxHeight) : null;\n            if (data.maxHeight !== position.maxHeight) {\n                data.maxHeight = position.maxHeight;\n                changeSet.maxHeight = true;\n            }\n        }\n        if (NumberGuard.isFiniteOrNull(position.maxWidth)) {\n            position.maxWidth = typeof position.maxWidth === 'number' ? Math.round(position.maxWidth) : null;\n            if (data.maxWidth !== position.maxWidth) {\n                data.maxWidth = position.maxWidth;\n                changeSet.maxWidth = true;\n            }\n        }\n        if (NumberGuard.isFiniteOrNull(position.minHeight)) {\n            position.minHeight = typeof position.minHeight === 'number' ? Math.round(position.minHeight) : null;\n            if (data.minHeight !== position.minHeight) {\n                data.minHeight = position.minHeight;\n                changeSet.minHeight = true;\n            }\n        }\n        if (NumberGuard.isFiniteOrNull(position.minWidth)) {\n            position.minWidth = typeof position.minWidth === 'number' ? Math.round(position.minWidth) : null;\n            if (data.minWidth !== position.minWidth) {\n                data.minWidth = position.minWidth;\n                changeSet.minWidth = true;\n            }\n        }\n        if (NumberGuard.isFiniteOrNull(position.rotateX)) {\n            if (data.rotateX !== position.rotateX) {\n                data.rotateX = transforms.rotateX = position.rotateX;\n                changeSet.transform = true;\n            }\n        }\n        if (NumberGuard.isFiniteOrNull(position.rotateY)) {\n            if (data.rotateY !== position.rotateY) {\n                data.rotateY = transforms.rotateY = position.rotateY;\n                changeSet.transform = true;\n            }\n        }\n        if (NumberGuard.isFiniteOrNull(position.rotateZ)) {\n            if (data.rotateZ !== position.rotateZ) {\n                data.rotateZ = transforms.rotateZ = position.rotateZ;\n                changeSet.transform = true;\n            }\n        }\n        if (NumberGuard.isFiniteOrNull(position.scale)) {\n            position.scale = typeof position.scale === 'number' ? clamp(position.scale, 0, 1000) : null;\n            if (data.scale !== position.scale) {\n                data.scale = transforms.scale = position.scale;\n                changeSet.transform = true;\n            }\n        }\n        if ((typeof position.transformOrigin === 'string' && TJSTransforms.transformOrigins.includes(position.transformOrigin)) || position.transformOrigin === null) {\n            if (data.transformOrigin !== position.transformOrigin) {\n                data.transformOrigin = position.transformOrigin;\n                changeSet.transformOrigin = true;\n            }\n        }\n        if (NumberGuard.isFiniteOrNull(position.translateX)) {\n            if (data.translateX !== position.translateX) {\n                data.translateX = transforms.translateX = position.translateX;\n                changeSet.transform = true;\n            }\n        }\n        if (NumberGuard.isFiniteOrNull(position.translateY)) {\n            if (data.translateY !== position.translateY) {\n                data.translateY = transforms.translateY = position.translateY;\n                changeSet.transform = true;\n            }\n        }\n        if (NumberGuard.isFiniteOrNull(position.translateZ)) {\n            if (data.translateZ !== position.translateZ) {\n                data.translateZ = transforms.translateZ = position.translateZ;\n                changeSet.transform = true;\n            }\n        }\n        if (NumberGuard.isFinite(position.zIndex)) {\n            position.zIndex = Math.round(position.zIndex);\n            if (data.zIndex !== position.zIndex) {\n                data.zIndex = position.zIndex;\n                changeSet.zIndex = true;\n            }\n        }\n        const widthIsObservable = position.width === 'auto' || position.width === 'inherit';\n        if (NumberGuard.isFiniteOrNull(position.width) || widthIsObservable) {\n            position.width = typeof position.width === 'number' ? Math.round(position.width) : position.width;\n            if (data.width !== position.width) {\n                data.width = position.width;\n                changeSet.width = true;\n            }\n        }\n        const heightIsObservable = position.height === 'auto' || position.height === 'inherit';\n        if (NumberGuard.isFiniteOrNull(position.height) || heightIsObservable) {\n            position.height = typeof position.height === 'number' ? Math.round(position.height) : position.height;\n            if (data.height !== position.height) {\n                data.height = position.height;\n                changeSet.height = true;\n            }\n        }\n        // Potentially update the `resizeObservable` store when the state of `width` or `height` changes between\n        // `auto` / `inherit` to a number or null.\n        const resizeObservable = widthIsObservable || heightIsObservable;\n        if (this.#resizeObservable !== resizeObservable) {\n            this.#resizeObservable = resizeObservable;\n            // Set store on next clock tick.\n            // setTimeout(() => this.#styleCache.stores.resizeObservable.set(resizeObservable), 0);\n            this.#styleCache.stores.resizeObservable.set(resizeObservable);\n        }\n        if (el) {\n            const defaultData = this.#state.getDefault();\n            // Set default data after first set operation that has a target element.\n            if (!isObject(defaultData)) {\n                this.#state.save({ name: '#defaultData', ...Object.assign({}, data) });\n            }\n            // If `immediateElementUpdate` is true then update the element immediately. This is for rAF based library\n            // integrations like GSAP and updates coming from AnimationManager.\n            if (immediateElementUpdate) {\n                UpdateElementManager.immediate(el, this.#updateElementData);\n                this.#updateElementPromise = Promise.resolve(globalThis.performance.now());\n            }\n            // Else if not queued then queue an update for the next rAF callback.\n            else if (!this.#updateElementData.queued) {\n                this.#updateElementPromise = UpdateElementManager.add(el, this.#updateElementData);\n            }\n        }\n        else {\n            // Notify main store subscribers.\n            UpdateElementManager.updateSubscribers(this.#updateElementData);\n        }\n        return this;\n    }\n    /**\n     * @param handler - Callback function that is invoked on update / changes. Receives a readonly copy of the\n     *        TJSPositionData.\n     *\n     * @returns Unsubscribe function.\n     */\n    subscribe(handler) {\n        const currentIdx = this.#subscribers.findIndex((entry) => entry === handler);\n        if (currentIdx === -1) {\n            this.#subscribers.push(handler); // add handler to the array of subscribers\n            handler(Object.assign({}, this.#data)); // call handler with current value\n        }\n        // Return unsubscribe function.\n        return () => {\n            const existingIdx = this.#subscribers.findIndex((entry) => entry === handler);\n            if (existingIdx !== -1) {\n                this.#subscribers.splice(existingIdx, 1);\n            }\n        };\n    }\n    /**\n     * Provides the {@link Writable} store `update` method. Receive and return a {@link TJSPositionData} instance to\n     * update the position state. You may manipulate numeric properties by providing relative adjustments described in\n     * {@link TJSPositionDataRelative}.\n     *\n     * @param updater -\n     */\n    update(updater) {\n        const result = updater(this.get());\n        if (!isObject(result)) {\n            throw new TypeError(`'result' of 'updater' is not an object.`);\n        }\n        this.set(result);\n    }\n    // Internal Implementation ----------------------------------------------------------------------------------------\n    /**\n     * Temporary data storage for `TJSPosition.#updatePosition`.\n     */\n    static #updateDataCopy = Object.seal(new TJSPositionData());\n    /**\n     * Temporary data storage for `TJSPosition.#updatePosition`.\n     */\n    static #validationData = Object.seal({\n        position: void 0,\n        parent: void 0,\n        el: void 0,\n        computed: void 0,\n        transforms: void 0,\n        height: void 0,\n        width: void 0,\n        marginLeft: void 0,\n        marginTop: void 0,\n        maxHeight: void 0,\n        maxWidth: void 0,\n        minHeight: void 0,\n        minWidth: void 0,\n        rest: void 0\n    });\n    /**\n     * @param data -\n     *\n     * @param parent -\n     *\n     * @param el -\n     *\n     * @param styleCache -\n     *\n     * @returns Updated position data or null if validation fails.\n     */\n    #updatePosition({ \n    // Directly supported parameters\n    left, top, maxWidth, maxHeight, minWidth, minHeight, width, height, rotateX, rotateY, rotateZ, scale, transformOrigin, translateX, translateY, translateZ, zIndex, \n    // Aliased parameters\n    rotation, ...rest }, parent, el, styleCache) {\n        let currentPosition = TJSPositionDataUtil.copyData(this.#data, _a.#updateDataCopy);\n        // Update width if an explicit value is passed, or if no width value is set on the element.\n        if (width !== void 0 || el.style.width === '') {\n            const widthValid = width === null || Number.isFinite(width);\n            if (width === 'auto' || (currentPosition.width === 'auto' && !widthValid)) {\n                currentPosition.width = 'auto';\n                width = styleCache.offsetWidth;\n            }\n            else if (width === 'inherit' || (currentPosition.width === 'inherit' && !widthValid)) {\n                currentPosition.width = 'inherit';\n                width = styleCache.offsetWidth;\n            }\n            else {\n                const newWidth = NumberGuard.isFinite(width) ? width :\n                    currentPosition.width;\n                currentPosition.width = width = NumberGuard.isFinite(newWidth) ? Math.round(newWidth) :\n                    styleCache.offsetWidth;\n            }\n        }\n        else {\n            width = Number.isFinite(currentPosition.width) ? currentPosition.width : styleCache.offsetWidth;\n        }\n        // Update height if an explicit value is passed, or if no height value is set on the element.\n        if (height !== void 0 || el.style.height === '') {\n            const heightValid = height === null || Number.isFinite(height);\n            if (height === 'auto' || (currentPosition.height === 'auto' && !heightValid)) {\n                currentPosition.height = 'auto';\n                height = styleCache.offsetHeight;\n            }\n            else if (height === 'inherit' || (currentPosition.height === 'inherit' && !heightValid)) {\n                currentPosition.height = 'inherit';\n                height = styleCache.offsetHeight;\n            }\n            else {\n                const newHeight = NumberGuard.isFinite(height) ? height :\n                    currentPosition.height;\n                currentPosition.height = height = NumberGuard.isFinite(newHeight) ? Math.round(newHeight) :\n                    styleCache.offsetHeight;\n            }\n        }\n        else {\n            height = Number.isFinite(currentPosition.height) ? currentPosition.height : styleCache.offsetHeight;\n        }\n        // Update left\n        if (NumberGuard.isFinite(left)) {\n            currentPosition.left = left;\n        }\n        else if (!Number.isFinite(currentPosition.left)) {\n            // Potentially use any initial position helper if available or set to 0.\n            currentPosition.left = typeof this.#options?.initial?.getLeft === 'function' ?\n                this.#options.initial.getLeft(width) : 0;\n        }\n        // Update top\n        if (Number.isFinite(top)) {\n            currentPosition.top = top;\n        }\n        else if (!Number.isFinite(currentPosition.top)) {\n            // Potentially use any initial position helper if available or set to 0.\n            currentPosition.top = typeof this.#options?.initial?.getTop === 'function' ?\n                this.#options.initial.getTop(height) : 0;\n        }\n        if (NumberGuard.isFiniteOrNull(maxHeight)) {\n            currentPosition.maxHeight = NumberGuard.isFinite(maxHeight) ? Math.round(maxHeight) : null;\n        }\n        if (NumberGuard.isFiniteOrNull(maxWidth)) {\n            currentPosition.maxWidth = NumberGuard.isFinite(maxWidth) ? Math.round(maxWidth) : null;\n        }\n        if (NumberGuard.isFiniteOrNull(minHeight)) {\n            currentPosition.minHeight = NumberGuard.isFinite(minHeight) ? Math.round(minHeight) : null;\n        }\n        if (NumberGuard.isFiniteOrNull(minWidth)) {\n            currentPosition.minWidth = NumberGuard.isFinite(minWidth) ? Math.round(minWidth) : null;\n        }\n        // Update rotate X/Y/Z, scale, z-index\n        if (NumberGuard.isFiniteOrNull(rotateX)) {\n            currentPosition.rotateX = rotateX;\n        }\n        if (NumberGuard.isFiniteOrNull(rotateY)) {\n            currentPosition.rotateY = rotateY;\n        }\n        // Handle alias for rotateZ. First check if `rotateZ` is valid and different from the current value. Next check if\n        // `rotation` is valid and use it for `rotateZ`.\n        if (rotateZ !== currentPosition.rotateZ && (NumberGuard.isFiniteOrNull(rotateZ))) {\n            currentPosition.rotateZ = rotateZ;\n        }\n        else if (rotation !== currentPosition.rotateZ && (NumberGuard.isFiniteOrNull(rotation))) {\n            currentPosition.rotateZ = rotation;\n        }\n        if (NumberGuard.isFiniteOrNull(translateX)) {\n            currentPosition.translateX = translateX;\n        }\n        if (NumberGuard.isFiniteOrNull(translateY)) {\n            currentPosition.translateY = translateY;\n        }\n        if (NumberGuard.isFiniteOrNull(translateZ)) {\n            currentPosition.translateZ = translateZ;\n        }\n        if (NumberGuard.isFiniteOrNull(scale)) {\n            currentPosition.scale = typeof scale === 'number' ? clamp(scale, 0, 1000) : null;\n        }\n        if (typeof transformOrigin === 'string' || transformOrigin === null) {\n            currentPosition.transformOrigin = TJSTransforms.transformOrigins.includes(transformOrigin) ? transformOrigin :\n                null;\n        }\n        if (NumberGuard.isFiniteOrNull(zIndex)) {\n            currentPosition.zIndex = typeof zIndex === 'number' ? Math.round(zIndex) : zIndex;\n        }\n        const validatorData = this.#validatorData;\n        // If there are any validators allow them to potentially modify position data or reject the update.\n        if (this.#validators.enabled && validatorData.length) {\n            const validationData = _a.#validationData;\n            validationData.parent = parent;\n            validationData.el = el;\n            validationData.computed = styleCache.computed;\n            validationData.transforms = this.#transforms;\n            validationData.height = height;\n            validationData.width = width;\n            validationData.marginLeft = styleCache.marginLeft;\n            validationData.marginTop = styleCache.marginTop;\n            validationData.maxHeight = styleCache.maxHeight ?? currentPosition.maxHeight;\n            validationData.maxWidth = styleCache.maxWidth ?? currentPosition.maxWidth;\n            // Given a parent w/ reactive state and is minimized ignore styleCache min-width/height.\n            // TODO: THIS IS REFERENCING APPLICATION OPTIONS.\n            const isMinimized = parent?.reactive?.minimized ?? false;\n            // Note the use of || for accessing the style cache as the left hand is ignored w/ falsy values such as '0'.\n            validationData.minHeight = isMinimized ? currentPosition.minHeight ?? 0 :\n                styleCache.minHeight || (currentPosition.minHeight ?? 0);\n            validationData.minWidth = isMinimized ? currentPosition.minWidth ?? 0 :\n                styleCache.minWidth || (currentPosition.minWidth ?? 0);\n            for (let cntr = 0; cntr < validatorData.length; cntr++) {\n                validationData.position = currentPosition;\n                validationData.rest = rest;\n                currentPosition = validatorData[cntr].validate(validationData);\n                if (currentPosition === null) {\n                    return null;\n                }\n            }\n        }\n        // Return the updated position object.\n        return currentPosition;\n    }\n}\n_a = TJSPosition;\n\nexport { TJSPosition, applyPosition, draggable };\n//# sourceMappingURL=index.js.map\n","import { isObject } from '@typhonjs-fvtt/runtime/util/object';\n\n/**\n * Localize a string including variable formatting for input arguments. Provide a string ID which defines the localized\n * template. Variables can be included in the template enclosed in braces and will be substituted using those named\n * keys.\n *\n * @param {string}   stringId - The string ID to translate.\n *\n * @param {object}   [data] - Provided input data.\n *\n * @returns {string} The translated and formatted string\n */\nfunction localize(stringId, data)\n{\n   const result = !isObject(data) ? globalThis.game.i18n.localize(stringId) :\n    globalThis.game.i18n.format(stringId, data);\n\n   return result !== void 0 ? result : '';\n}\n\nexport { localize };\n//# sourceMappingURL=index.js.map\n","import { isObject, deepMerge, safeAccess, safeSet, hasGetter, klona } from '@typhonjs-fvtt/runtime/util/object';\nimport { writable, derived } from 'svelte/store';\nimport { subscribeIgnoreFirst } from '@typhonjs-fvtt/runtime/svelte/store/util';\nimport { TJSWebStorage, TJSSessionStorage } from '@typhonjs-fvtt/runtime/svelte/store/web-storage';\nimport { propertyStore } from '@typhonjs-fvtt/runtime/svelte/store/writable-derived';\nimport { TJSSvelte } from '@typhonjs-fvtt/runtime/svelte/util';\nimport { CrossWindow } from '@typhonjs-fvtt/runtime/util/browser';\nimport { TJSPosition } from '@typhonjs-fvtt/runtime/svelte/store/position';\nimport { A11yHelper } from '@typhonjs-fvtt/runtime/util/a11y';\nimport { DialogShell } from '@typhonjs-fvtt/runtime/svelte/component/internal';\nimport { ManagedPromise } from '@typhonjs-fvtt/runtime/util/async';\n\n/**\n * Provides the ability the save / restore / serialize application state for positional and UI state such as minimized\n * status.\n */\nclass ApplicationState\n{\n   /** @type {import('../../SvelteApp.js').SvelteApp} */\n   #application;\n\n   /**\n    * Stores the current save state key being restored by animating. When a restore is already being animated with the\n    * same name the subsequent restore animation is ignored.\n    *\n    * @type {string | undefined}\n    */\n   #currentRestoreKey;\n\n   /** @type {Map<string, import('../../types').SvelteApp.API.State.Data>} */\n   #dataSaved = new Map();\n\n   /**\n    * @param {import('../../SvelteApp.js').SvelteApp}   application - The application.\n    */\n   constructor(application)\n   {\n      this.#application = application;\n\n      Object.seal(this);\n   }\n\n   /**\n    * Clears all saved application state.\n    */\n   clear()\n   {\n      this.#dataSaved.clear();\n   }\n\n   /**\n    * Returns current application state along with any extra data passed into method.\n    *\n    * @param {object} [extra] - Extra data to add to application state.\n    *\n    * @returns {import('../../types').SvelteApp.API.State.Data} Passed in object with current application state.\n    */\n   current(extra = {})\n   {\n      return Object.assign(extra, {\n         position: this.#application?.position?.get(),\n         beforeMinimized: this.#application?.position?.state.get({ name: '#beforeMinimized' }),\n         options: this.#application?.reactive?.toJSON(),\n         ui: { minimized: this.#application?.reactive?.minimized }\n      });\n   }\n\n   /**\n    * Gets any saved application state by name.\n    *\n    * @param {object}   options - Options.\n    *\n    * @param {string}   options.name - Saved data set name.\n    *\n    * @returns {import('../../types').SvelteApp.API.State.Data | undefined} Any saved application state.\n    */\n   get({ name })\n   {\n      if (typeof name !== 'string')\n      {\n         throw new TypeError(`[SvelteApp.state.get] error: 'name' is not a string.`);\n      }\n\n      return this.#dataSaved.get(name);\n   }\n\n   /**\n    * @returns {IterableIterator<string>} The saved application state names / keys.\n    */\n   keys()\n   {\n      return this.#dataSaved.keys();\n   }\n\n   /**\n    * Removes and returns any saved application state by name.\n    *\n    * @param {object}   options - Options.\n    *\n    * @param {string}   options.name - Name to remove and retrieve.\n    *\n    * @returns {import('../../types').SvelteApp.API.State.Data | undefined} Any saved application state.\n    */\n   remove({ name })\n   {\n      if (typeof name !== 'string') { throw new TypeError(`[SvelteApp.state.remove] error: 'name' is not a string.`); }\n\n      const data = this.#dataSaved.get(name);\n      this.#dataSaved.delete(name);\n\n      return data;\n   }\n\n   /**\n    * Restores a previously saved application state by `name` returning the data. Several optional parameters are\n    * available to animate / tween to the new state. When `animateTo` is true an animation is scheduled via\n    * {@link #runtime/svelte/store/position!TJSPosition.API.Animation.to} and the duration and easing name or function may be\n    * specified.\n    *\n    * @param {object}            options - Options.\n    *\n    * @param {string}            options.name - Saved data set name.\n    *\n    * @param {boolean}           [options.remove=false] - Remove data set.\n    *\n    * @param {boolean}           [options.animateTo=false] - Animate to restore data.\n    *\n    * @param {number}            [options.duration=0.1] - Duration in seconds.\n    *\n    * @param {import('@typhonjs-fvtt/runtime/svelte/easing').EasingReference} [options.ease='linear'] - Easing function or easing\n    *        function name.\n    *\n    * @returns {import('../../types').SvelteApp.API.State.Data | undefined} Any saved application state.\n    */\n   restore({ name, remove = false, animateTo = false, duration = 0.1, ease = 'linear' })\n   {\n      if (typeof name !== 'string')\n      {\n         throw new TypeError(`[SvelteApp.state.restore] error: 'name' is not a string.`);\n      }\n\n      const dataSaved = this.#dataSaved.get(name);\n\n      if (dataSaved)\n      {\n         if (remove) { this.#dataSaved.delete(name); }\n\n         // Multiple invocations for animated restores are skipped when one is already in progress.\n         if (animateTo && name !== this.#currentRestoreKey)\n         {\n            // Track current restore key name.\n            this.#currentRestoreKey = name;\n\n            this.#setImpl(dataSaved, {\n               animateTo,\n               async: true,\n               duration,\n               ease\n            }).then(() =>\n            {\n               // Reset current restore key name for animation if the same as initial animation initiation.\n               if (name === this.#currentRestoreKey) { this.#currentRestoreKey = void 0; }\n            });\n         }\n      }\n\n      return dataSaved;\n   }\n\n   /**\n    * Saves current application state with the opportunity to add extra data to the saved state.\n    *\n    * @param {object}   options - Options.\n    *\n    * @param {string}   options.name - Name to index this saved state.\n    *\n    * @returns {import('../../types').SvelteApp.API.State.Data} Current saved application state.\n    */\n   save({ name, ...extra })\n   {\n      if (typeof name !== 'string') { throw new TypeError(`[SvelteApp.state.save] error: 'name' is not a string.`); }\n\n      const data = this.current(extra);\n\n      this.#dataSaved.set(name, data);\n\n      return data;\n   }\n\n   /**\n    * Sets application state from the given `SvelteApp.API.State.Data` instance. Several optional parameters are\n    * available to animate / tween to the new state. When `animateTo` is true an animation is scheduled via\n    * {@link #runtime/svelte/store/position!AnimationAPI.to} and the duration and easing name or function may be\n    * specified.\n    *\n    * Note: If serializing application state any minimized apps will use the before minimized state on initial render\n    * of the app as it is currently not possible to render apps with Foundry VTT core API in the minimized state.\n    *\n    * @param {import('../../types').SvelteApp.API.State.Data}   data - Saved data set name.\n    *\n    * @param {object}         [options] - Optional parameters\n    *\n    * @param {boolean}        [options.animateTo=false] - Animate to restore data.\n    *\n    * @param {number}         [options.duration=0.1] - Duration in seconds.\n    *\n    * @param {import('@typhonjs-fvtt/runtime/svelte/easing').EasingReference} [options.ease='linear'] - Easing function or easing\n    *        function name.\n    */\n   set(data, options = {})\n   {\n      this.#setImpl(data, { ...options, async: false });\n   }\n\n   // Internal implementation ----------------------------------------------------------------------------------------\n\n   /**\n    * Sets application state from the given `SvelteApp.API.State.Data` instance. Several optional parameters are\n    * available to animate / tween to the new state. When `animateTo` is true an animation is scheduled via\n    * {@link #runtime/svelte/store/position!AnimationAPI.to} and the duration and easing name or function may be\n    * specified.\n    *\n    * Note: If serializing application state any minimized apps will use the before minimized state on initial render\n    * of the app as it is currently not possible to render apps with Foundry VTT core API in the minimized state.\n    *\n    * @privateRemarks\n    * TODO: THIS METHOD NEEDS TO BE REFACTORED WHEN TRL IS MADE INTO A STANDALONE FRAMEWORK.\n    *\n    * @param {import('../../types').SvelteApp.API.State.Data}   data - Saved data set name.\n    *\n    * @param {object}            [opts] - Optional parameters\n    *\n    * @param {boolean}           [opts.async=false] - If animating return a Promise that resolves with any saved data.\n    *\n    * @param {boolean}           [opts.animateTo=false] - Animate to restore data.\n    *\n    * @param {number}            [opts.duration=0.1] - Duration in seconds.\n    *\n    * @param {import('@typhonjs-fvtt/runtime/svelte/easing').EasingReference} [opts.ease='linear'] - Easing function or easing\n    *        function name.\n    *\n    * @returns {undefined | Promise<void>} When asynchronous the animation Promise.\n    */\n   #setImpl(data, { async = false, animateTo = false, duration = 0.1, ease = 'linear' } = {})\n   {\n      if (!isObject(data))\n      {\n         throw new TypeError(`[SvelteApp.state.set] error: 'data' is not an object.`);\n      }\n\n      const application = this.#application;\n\n      if (!isObject(data?.position))\n      {\n         console.warn(`[SvelteApp.state.set] warning: 'data.position' is not an object.`);\n         return;\n      }\n\n      // TODO: TAKE NOTE THAT WE ARE ACCESSING A FOUNDRY APP v1 GETTER HERE TO DETERMINE IF APPLICATION IS RENDERED.\n      // TODO: THIS NEEDS TO BE REFACTORED WHEN CONVERTING TRL TO A GENERIC FRAMEWORK.\n      const rendered = application.rendered;\n\n      // Update data directly with no store or inline style updates.\n      if (animateTo)  // Animate to saved data.\n      {\n         if (!rendered)\n         {\n            console.warn(`[SvelteApp.state.set] warning: application is not rendered and 'animateTo' is true.`);\n            return;\n         }\n\n         // Provide special handling to potentially change transform origin as this parameter is not animated.\n         if (data.position.transformOrigin !== application.position.transformOrigin)\n         {\n            application.position.transformOrigin = data.position.transformOrigin;\n         }\n\n         if (isObject(data?.ui))\n         {\n            const minimized = typeof data.ui?.minimized === 'boolean' ? data.ui.minimized : false;\n\n            if (application?.reactive?.minimized && !minimized)\n            {\n               application.maximize({ animate: false, duration: 0 });\n            }\n         }\n\n         const promise = application.position.animate.to(data.position, {\n            duration,\n            ease,\n            strategy: 'cancelAll'\n         }).finished.then(({ cancelled }) =>\n         {\n            if (cancelled) { return; }\n\n            // Merge in saved options to application.\n            if (isObject(data?.options))\n            {\n               application?.reactive.mergeOptions(data.options);\n            }\n\n            if (isObject(data?.ui))\n            {\n               const minimized = typeof data.ui?.minimized === 'boolean' ? data.ui.minimized : false;\n\n               // Application is currently minimized and stored state is not, so reset minimized state without\n               // animation.\n               if (!application?.reactive?.minimized && minimized)\n               {\n                  application.minimize({ animate: false, duration: 0 });\n               }\n            }\n\n            if (isObject(data?.beforeMinimized))\n            {\n               application.position.state.set({ name: '#beforeMinimized', ...data.beforeMinimized });\n            }\n         });\n\n         // Return a Promise with the application that resolves after animation ends.\n         if (async) { return promise; }\n      }\n      else\n      {\n         if (rendered)\n         {\n            // Merge in saved options to application.\n            if (isObject(data?.options))\n            {\n               application?.reactive.mergeOptions(data.options);\n            }\n\n            if (isObject(data?.ui))\n            {\n               const minimized = typeof data.ui?.minimized === 'boolean' ? data.ui.minimized : false;\n\n               // Application is currently minimized and stored state is not, so reset minimized state without\n               // animation.\n               if (application?.reactive?.minimized && !minimized)\n               {\n                  application.maximize({ animate: false, duration: 0 });\n               }\n               else if (!application?.reactive?.minimized && minimized)\n               {\n                  application.minimize({ animate: false, duration });\n               }\n            }\n\n            if (isObject(data?.beforeMinimized))\n            {\n               application.position.state.set({ name: '#beforeMinimized', ...data.beforeMinimized });\n            }\n\n            // Default options is to set data for an immediate update.\n            application.position.set(data.position);\n         }\n         else\n         {\n            // When not rendered set position to the 'beforeMinimized' data if it exists otherwise set w/ 'position'.\n            // Currently, w/ Foundry core Application API it is impossible to initially render an app in the minimized\n            // state.\n\n            let positionData = data.position;\n\n            if (isObject(data.beforeMinimized))\n            {\n               // Take before minimized data.\n               positionData = data.beforeMinimized;\n\n               // Apply position left / top to before minimized data. This covers the case when an app is minimized,\n               // but then moved. This allows restoration of the before minimized parameters w/ the last position\n               // location.\n               positionData.left = data.position.left;\n               positionData.top = data.position.top;\n            }\n\n            application.position.set(positionData);\n         }\n      }\n   }\n}\n\n/**\n * Provides a mechanism to retrieve and query all mounted Svelte components including the main application shell.\n *\n * @implements {import('../../types').SvelteApp.API.Svelte}\n */\nclass GetSvelteData\n{\n   /** @type {import('svelte').SvelteComponent[] | null[]} */\n   #applicationShellHolder;\n\n   /** @type {import('./types').SvelteData[]} */\n   #svelteData;\n\n   /**\n    * Keep a direct reference to the SvelteData array in an associated {@link SvelteApp}.\n    *\n    * @param {import('svelte').SvelteComponent[] | null[]}  applicationShellHolder - A reference to the mounted app shell.\n    *\n    * @param {import('./types').SvelteData[]}  svelteData - A reference to the SvelteData array of mounted components.\n    */\n   constructor(applicationShellHolder, svelteData)\n   {\n      this.#applicationShellHolder = applicationShellHolder;\n      this.#svelteData = svelteData;\n   }\n\n   /**\n    * Returns any mounted application shell.\n    *\n    * @returns {import('svelte').SvelteComponent} Any mounted application shell.\n    */\n   get appShell() { return this.#applicationShellHolder[0]; }\n\n   /**\n    * Returns any mounted application shell.\n    *\n    * @deprecated Use {@link GetSvelteData.appShell}; since `0.2.0` removal in `0.5.0`.\n    *\n    * @returns {import('svelte').SvelteComponent} Any mounted application shell.\n    */\n   get applicationShell() { return this.#applicationShellHolder[0]; }\n\n   /**\n    * Returns mounted application shell data / config.\n    *\n    * @internal\n    *\n    * @returns {import('./types').SvelteData} Any mounted application shell data.\n    */\n   get appShellData() { return this.#svelteData[0]; }\n}\n\n/**\n * API docs and description in {@link SvelteApp.API.Reactive}.\n */\nclass SvelteReactive\n{\n   /**\n    * @type {import('../SvelteApp').SvelteApp}\n    */\n   #application;\n\n   /**\n    * @type {boolean}\n    */\n   #initialized = false;\n\n   /** @type {import('@typhonjs-fvtt/runtime/svelte/store/web-storage').WebStorage} */\n   #sessionStorage;\n\n   /**\n    * The Application option store which is injected into mounted Svelte component context under the `external` key.\n    *\n    * @type {import('./types').StoreAppOptions}\n    */\n   #storeAppOptions;\n\n   /**\n    * Stores the update function for `#storeAppOptions`.\n    *\n    * @type {(this: void, updater: import('svelte/store').Updater<object>) => void}\n    */\n   #storeAppOptionsUpdate;\n\n   /**\n    * Stores the UI state data to make it accessible via getters.\n    *\n    * @type {object}\n    */\n   #dataUIState;\n\n   /**\n    * The UI option store which is injected into mounted Svelte component context under the `external` key.\n    *\n    * @type {import('./types').StoreUIOptions}\n    */\n   #storeUIState;\n\n   /**\n    * Stores the update function for `#storeUIState`.\n    *\n    * @type {(this: void, updater: import('svelte/store').Updater<object>) => void}\n    */\n   #storeUIStateUpdate;\n\n   /**\n    * Stores the unsubscribe functions from local store subscriptions.\n    *\n    * @type {import('svelte/store').Unsubscriber[]}\n    */\n   #storeUnsubscribe = [];\n\n   /**\n    * @param {import('../SvelteApp').SvelteApp} application - The host Foundry application.\n    */\n   constructor(application)\n   {\n      this.#application = application;\n      const optionsSessionStorage = application?.options?.sessionStorage;\n\n      if (optionsSessionStorage !== void 0 && !(optionsSessionStorage instanceof TJSWebStorage))\n      {\n         throw new TypeError(`'options.sessionStorage' is not an instance of TJSWebStorage.`);\n      }\n\n      // If no external web storage API instance is available then create a TJSSessionStorage instance.\n      this.#sessionStorage = optionsSessionStorage !== void 0 ? optionsSessionStorage : new TJSSessionStorage();\n   }\n\n   /**\n    * Initializes reactive support. Package private for internal use.\n    *\n    * @returns {import('./types-local').SvelteReactiveStores | undefined} Internal methods to interact with Svelte\n    * stores.\n    *\n    * @package\n    * @internal\n    */\n   initialize()\n   {\n      if (this.#initialized) { return; }\n\n      this.#initialized = true;\n\n      this.#storesInitialize();\n\n      return {\n         appOptionsUpdate: this.#storeAppOptionsUpdate,\n         uiStateUpdate: this.#storeUIStateUpdate,\n         subscribe: this.#storesSubscribe.bind(this),\n         unsubscribe: this.#storesUnsubscribe.bind(this)\n      };\n   }\n\n// Store getters -----------------------------------------------------------------------------------------------------\n\n   /**\n    * @returns {import('@typhonjs-fvtt/runtime/svelte/store/web-storage').WebStorage} Returns WebStorage (session) instance.\n    */\n   get sessionStorage()\n   {\n      return this.#sessionStorage;\n   }\n\n   /**\n    * Returns the store for app options.\n    *\n    * @returns {import('../../types').SvelteApp.API.Reactive.AppOptions} App options store.\n    */\n   get storeAppOptions() { return this.#storeAppOptions; }\n\n   /**\n    * Returns the store for UI options.\n    *\n    * @returns {import('../../types').SvelteApp.API.Reactive.UIState} UI options store.\n    */\n   get storeUIState() { return this.#storeUIState; }\n\n// Only reactive getters ---------------------------------------------------------------------------------------------\n\n   /**\n    * Returns the current active Window / WindowProxy UI state.\n    *\n    * @returns {Window} Active window UI state.\n    */\n   get activeWindow() { return this.#dataUIState.activeWindow ?? globalThis; }\n\n   /**\n    * Returns the current dragging UI state.\n    *\n    * @returns {boolean} Dragging UI state.\n    */\n   get dragging() { return this.#dataUIState.dragging; }\n\n   /**\n    * Returns the current minimized UI state.\n    *\n    * @returns {boolean} Minimized UI state.\n    */\n   get minimized() { return this.#dataUIState.minimized; }\n\n   /**\n    * Returns the current resizing UI state.\n    *\n    * @returns {boolean} Resizing UI state.\n    */\n   get resizing() { return this.#dataUIState.resizing; }\n\n   /**\n    * Sets the current active Window / WindowProxy UI state.\n    *\n    * Note: This is protected usage and used internally.\n    *\n    * @param {Window} activeWindow - Active Window / WindowProxy UI state.\n    *\n    * @hidden\n    */\n   set activeWindow(activeWindow)\n   {\n      // Note: when setting activeWindow to undefined `globalThis` is set. There isn't a great test for Window /\n      // WindowProxy, so check `toString`.\n      if (activeWindow === void 0 || activeWindow === null ||\n       (Object.prototype.toString.call(activeWindow) === '[object Window]'))\n      {\n         this.#storeUIStateUpdate((options) => deepMerge(options, { activeWindow: activeWindow ?? globalThis }));\n      }\n   }\n\n// Reactive getter / setters -----------------------------------------------------------------------------------------\n\n   /**\n    * Returns the draggable app option.\n    *\n    * @returns {boolean} Draggable app option.\n    */\n   get draggable() { return this.#application?.options?.draggable; }\n\n   /**\n    * Returns the focusAuto app option.\n    *\n    * @returns {boolean} When true auto-management of app focus is enabled.\n    */\n   get focusAuto() { return this.#application?.options?.focusAuto; }\n\n   /**\n    * Returns the focusKeep app option.\n    *\n    * @returns {boolean} When `focusAuto` and `focusKeep` is true; keeps internal focus.\n    */\n   get focusKeep() { return this.#application?.options?.focusKeep; }\n\n   /**\n    * Returns the focusTrap app option.\n    *\n    * @returns {boolean} When true focus trapping / wrapping is enabled keeping focus inside app.\n    */\n   get focusTrap() { return this.#application?.options?.focusTrap; }\n\n   /**\n    * Returns the headerButtonNoClose app option.\n    *\n    * @returns {boolean} Remove the close the button in header app option.\n    */\n   get headerButtonNoClose() { return this.#application?.options?.headerButtonNoClose; }\n\n   /**\n    * Returns the headerButtonNoLabel app option.\n    *\n    * @returns {boolean} Remove the labels from buttons in header app option.\n    */\n   get headerButtonNoLabel() { return this.#application?.options?.headerButtonNoLabel; }\n\n   /**\n    * Returns the headerIcon app option.\n    *\n    * @returns {string|void} URL for header app icon.\n    */\n   get headerIcon() { return this.#application?.options?.headerIcon; }\n\n   /**\n    * Returns the headerNoTitleMinimized app option.\n    *\n    * @returns {boolean} When true removes the header title when minimized.\n    */\n   get headerNoTitleMinimized() { return this.#application?.options?.headerNoTitleMinimized; }\n\n   /**\n    * Returns the minimizable app option.\n    *\n    * @returns {boolean} Minimizable app option.\n    */\n   get minimizable() { return this.#application?.options?.minimizable; }\n\n   /**\n    * Returns the Foundry popOut state; {@link Application.popOut}\n    *\n    * @returns {boolean} Positionable app option.\n    */\n   get popOut() { return this.#application.popOut; }\n\n   /**\n    * Returns the positionable app option; {@link SvelteApp.Options.positionable}\n    *\n    * @returns {boolean} Positionable app option.\n    */\n   get positionable() { return this.#application?.options?.positionable; }\n\n   /**\n    * Returns the resizable option.\n    *\n    * @returns {boolean} Resizable app option.\n    */\n   get resizable() { return this.#application?.options?.resizable; }\n\n   /**\n    * Returns the title accessor from the parent Application class; {@link Application.title}\n    *\n    * @privateRemarks\n    * TODO: Application v2; note that super.title localizes `this.options.title`; IMHO it shouldn't.    *\n    *\n    * @returns {string} Title.\n    */\n   get title() { return this.#application.title; }\n\n   /**\n    * Sets `this.options.draggable` which is reactive for application shells.\n    *\n    * @param {boolean}  draggable - Sets the draggable option.\n    */\n   set draggable(draggable)\n   {\n      if (typeof draggable === 'boolean') { this.setOptions('draggable', draggable); }\n   }\n\n   /**\n    * Sets `this.options.focusAuto` which is reactive for application shells.\n    *\n    * @param {boolean}  focusAuto - Sets the focusAuto option.\n    */\n   set focusAuto(focusAuto)\n   {\n      if (typeof focusAuto === 'boolean') { this.setOptions('focusAuto', focusAuto); }\n   }\n\n   /**\n    * Sets `this.options.focusKeep` which is reactive for application shells.\n    *\n    * @param {boolean}  focusKeep - Sets the focusKeep option.\n    */\n   set focusKeep(focusKeep)\n   {\n      if (typeof focusKeep === 'boolean') { this.setOptions('focusKeep', focusKeep); }\n   }\n\n   /**\n    * Sets `this.options.focusTrap` which is reactive for application shells.\n    *\n    * @param {boolean}  focusTrap - Sets the focusTrap option.\n    */\n   set focusTrap(focusTrap)\n   {\n      if (typeof focusTrap === 'boolean') { this.setOptions('focusTrap', focusTrap); }\n   }\n\n   /**\n    * Sets `this.options.headerButtonNoClose` which is reactive for application shells.\n    *\n    * @param {boolean}  headerButtonNoClose - Sets the headerButtonNoClose option.\n    */\n   set headerButtonNoClose(headerButtonNoClose)\n   {\n      if (typeof headerButtonNoClose === 'boolean') { this.setOptions('headerButtonNoClose', headerButtonNoClose); }\n   }\n\n   /**\n    * Sets `this.options.headerButtonNoLabel` which is reactive for application shells.\n    *\n    * @param {boolean}  headerButtonNoLabel - Sets the headerButtonNoLabel option.\n    */\n   set headerButtonNoLabel(headerButtonNoLabel)\n   {\n      if (typeof headerButtonNoLabel === 'boolean') { this.setOptions('headerButtonNoLabel', headerButtonNoLabel); }\n   }\n\n   /**\n    * Sets `this.options.headerIcon` which is reactive for application shells.\n    *\n    * @param {string | undefined}  headerIcon - Sets the headerButtonNoLabel option.\n    */\n   set headerIcon(headerIcon)\n   {\n      if (headerIcon === void 0 || typeof headerIcon === 'string') { this.setOptions('headerIcon', headerIcon); }\n   }\n\n   /**\n    * Sets `this.options.headerNoTitleMinimized` which is reactive for application shells.\n    *\n    * @param {boolean}  headerNoTitleMinimized - Sets the headerNoTitleMinimized option.\n    */\n   set headerNoTitleMinimized(headerNoTitleMinimized)\n   {\n      if (typeof headerNoTitleMinimized === 'boolean')\n      {\n         this.setOptions('headerNoTitleMinimized', headerNoTitleMinimized);\n      }\n   }\n\n   /**\n    * Sets `this.options.minimizable` which is reactive for application shells that are also pop out.\n    *\n    * @param {boolean}  minimizable - Sets the minimizable option.\n    */\n   set minimizable(minimizable)\n   {\n      if (typeof minimizable === 'boolean') { this.setOptions('minimizable', minimizable); }\n   }\n\n   /**\n    * Sets `this.options.popOut` which is reactive for application shells. This will add / remove this application\n    * from `ui.windows`.\n    *\n    * @param {boolean}  popOut - Sets the popOut option.\n    */\n   set popOut(popOut)\n   {\n      if (typeof popOut === 'boolean') { this.setOptions('popOut', popOut); }\n   }\n\n   /**\n    * Sets `this.options.positionable` enabling / disabling {@link SvelteApp.position}.\n    *\n    * @param {boolean}  positionable - Sets the positionable option.\n    */\n   set positionable(positionable)\n   {\n      if (typeof positionable === 'boolean') { this.setOptions('positionable', positionable); }\n   }\n\n   /**\n    * Sets `this.options.resizable` which is reactive for application shells.\n    *\n    * @param {boolean}  resizable - Sets the resizable option.\n    */\n   set resizable(resizable)\n   {\n      if (typeof resizable === 'boolean') { this.setOptions('resizable', resizable); }\n   }\n\n   /**\n    * Sets `this.options.title` which is reactive for application shells.\n    *\n    * Note: Will set empty string if title is undefined or null.\n    *\n    * @param {string | undefined | null}   title - Application title; will be localized, so a translation key is fine.\n    */\n   set title(title)\n   {\n      if (typeof title === 'string')\n      {\n         this.setOptions('title', title);\n      }\n      else if (title === void 0 || title === null)\n      {\n         this.setOptions('title', '');\n      }\n   }\n\n   // Reactive Options API -------------------------------------------------------------------------------------------\n\n   /**\n    * Provides a way to safely get this applications options given an accessor string which describes the\n    * entries to walk. To access deeper entries into the object format the accessor string with `.` between entries\n    * to walk.\n    *\n    * // TODO DOCUMENT the accessor in more detail.\n    *\n    * @param {string}   accessor - The path / key to set. You can set multiple levels.\n    *\n    * @param {*}        [defaultValue] - A default value returned if the accessor is not found.\n    *\n    * @returns {*} Value at the accessor.\n    */\n   getOptions(accessor, defaultValue)\n   {\n      return safeAccess(this.#application.options, accessor, defaultValue);\n   }\n\n   /**\n    * Provides a way to merge `options` into this applications options and update the appOptions store.\n    *\n    * @param {object}   options - The options object to merge with `this.options`.\n    */\n   mergeOptions(options)\n   {\n      this.#storeAppOptionsUpdate((instanceOptions) => deepMerge(instanceOptions, options));\n   }\n\n   /**\n    * Provides a way to safely set this applications options given an accessor string which describes the\n    * entries to walk. To access deeper entries into the object format the accessor string with `.` between entries\n    * to walk.\n    *\n    * Additionally, if an application shell Svelte component is mounted and exports the `appOptions` property then\n    * the application options is set to `appOptions` potentially updating the application shell / Svelte component.\n    *\n    * @param {string}   accessor - The path / key to set. You can set multiple levels.\n    *\n    * @param {any}      value - Value to set.\n    */\n   setOptions(accessor, value)\n   {\n      const success = safeSet(this.#application.options, accessor, value, { createMissing: true });\n\n      // If `this.options` modified then update the app options store.\n      if (success)\n      {\n         this.#storeAppOptionsUpdate(() => this.#application.options);\n      }\n   }\n\n   /**\n    * Serializes the main {@link SvelteApp.Options} for common application state.\n    *\n    * @returns {import('../../types').SvelteApp.API.Reactive.Data} Common application state.\n    */\n   toJSON()\n   {\n      return {\n         draggable: this.#application?.options?.draggable ?? true,\n         focusAuto: this.#application?.options?.focusAuto ?? true,\n         focusKeep: this.#application?.options?.focusKeep ?? false,\n         focusTrap: this.#application?.options?.focusTrap ?? true,\n         headerButtonNoClose: this.#application?.options?.headerButtonNoClose ?? false,\n         headerButtonNoLabel: this.#application?.options?.headerButtonNoLabel ?? false,\n         headerNoTitleMinimized: this.#application?.options?.headerNoTitleMinimized ?? false,\n         minimizable: this.#application?.options?.minimizable ?? true,\n         positionable: this.#application?.options?.positionable ?? true,\n         resizable: this.#application?.options?.resizable ?? true\n      };\n   }\n\n   /**\n    * Updates the UI Options store with the current header buttons. You may dynamically add / remove header buttons\n    * if using an application shell Svelte component. In either overriding `_getHeaderButtons` or responding to the\n    * Hooks fired return a new button array and the uiOptions store is updated and the application shell will render\n    * the new buttons.\n    *\n    * Optionally you can set in the SvelteApp app options {@link SvelteApp.Options.headerButtonNoClose}\n    * to remove the close button from the header buttons.\n    *\n    * @param {object} [opts] - Optional parameters (for internal use)\n    *\n    * @param {boolean} [opts.headerButtonNoClose] - The value for `headerButtonNoClose`.\n    */\n   updateHeaderButtons({ headerButtonNoClose = this.#application.options.headerButtonNoClose } = {})\n   {\n      let buttons = this.#application._getHeaderButtons();\n\n      // Remove close button if this.options.headerButtonNoClose is true;\n      if (typeof headerButtonNoClose === 'boolean' && headerButtonNoClose)\n      {\n         buttons = buttons.filter((button) => button.class !== 'close');\n      }\n\n      // For AppV2 label compatibility for close button: `Close Window` instead of `Close`.\n      const closeButton = buttons.find((button) => button.class === 'close');\n      if (closeButton) { closeButton.label = 'APPLICATION.TOOLS.Close'; }\n\n      this.#storeUIStateUpdate((options) =>\n      {\n         options.headerButtons = buttons;\n         return options;\n      });\n   }\n\n   // Internal implementation ----------------------------------------------------------------------------------------\n\n   /**\n    * Initializes the Svelte stores and derived stores for the application options and UI state.\n    *\n    * While writable stores are created the update method is stored in private variables locally and derived Readable\n    * stores are provided for essential options which are commonly used.\n    *\n    * These stores are injected into all Svelte components mounted under the `external` context: `storeAppOptions` and\n    * `storeUIState`.\n    */\n   #storesInitialize()\n   {\n      const writableAppOptions = writable(this.#application.options);\n\n      // Keep the update function locally, but make the store essentially readable.\n      this.#storeAppOptionsUpdate = writableAppOptions.update;\n\n      /**\n       * Create custom store. The main subscribe method for all app options changes is provided along with derived\n       * writable stores for all reactive options.\n       *\n       * @type {import('./types').StoreAppOptions}\n       */\n      const storeAppOptions = {\n         subscribe: writableAppOptions.subscribe,\n\n         draggable: propertyStore(writableAppOptions, 'draggable'),\n         focusAuto: propertyStore(writableAppOptions, 'focusAuto'),\n         focusKeep: propertyStore(writableAppOptions, 'focusKeep'),\n         focusTrap: propertyStore(writableAppOptions, 'focusTrap'),\n         headerButtonNoClose: propertyStore(writableAppOptions, 'headerButtonNoClose'),\n         headerButtonNoLabel: propertyStore(writableAppOptions, 'headerButtonNoLabel'),\n         headerIcon: propertyStore(writableAppOptions, 'headerIcon'),\n         headerNoTitleMinimized: propertyStore(writableAppOptions, 'headerNoTitleMinimized'),\n         minimizable: propertyStore(writableAppOptions, 'minimizable'),\n         popOut: propertyStore(writableAppOptions, 'popOut'),\n         positionable: propertyStore(writableAppOptions, 'positionable'),\n         resizable: propertyStore(writableAppOptions, 'resizable'),\n         title: propertyStore(writableAppOptions, 'title')\n      };\n\n      Object.freeze(storeAppOptions);\n\n      this.#storeAppOptions = storeAppOptions;\n\n      this.#dataUIState = {\n         activeWindow: globalThis,\n         dragging: false,\n         headerButtons: [],\n         minimized: this.#application._minimized,\n         resizing: false\n      };\n\n      // Create a store for UI state data.\n      const writableUIOptions = writable(this.#dataUIState);\n\n      // Keep the update function locally, but make the store essentially readable.\n      this.#storeUIStateUpdate = writableUIOptions.update;\n\n      /**\n       * @type {import('./types').StoreUIOptions}\n       */\n      const storeUIState = {\n         subscribe: writableUIOptions.subscribe,\n\n         // activeWindow: propertyStore(writableUIOptions, 'activeWindow'),\n         activeWindow: derived(writableUIOptions, ($options, set) => set($options.activeWindow)),\n         dragging: propertyStore(writableUIOptions, 'dragging'),\n         headerButtons: derived(writableUIOptions, ($options, set) => set($options.headerButtons)),\n         minimized: derived(writableUIOptions, ($options, set) => set($options.minimized)),\n         resizing: propertyStore(writableUIOptions, 'resizing')\n      };\n\n      Object.freeze(storeUIState);\n\n      // Initialize the store with options set in the Application constructor.\n      this.#storeUIState = storeUIState;\n   }\n\n   /**\n    * Registers local store subscriptions for app options. `popOut` controls registering this app with `ui.windows`.\n    *\n    * @see SvelteApp._injectHTML\n    */\n   #storesSubscribe()\n   {\n      // Register local subscriptions.\n\n      // Handles updating header buttons to add / remove the close button.\n      this.#storeUnsubscribe.push(subscribeIgnoreFirst(this.#storeAppOptions.headerButtonNoClose, (value) =>\n      {\n         this.updateHeaderButtons({ headerButtonNoClose: value });\n      }));\n\n      // // Handles updating header buttons to add / remove button labels.\n      // this.#storeUnsubscribe.push(subscribeIgnoreFirst(this.#storeAppOptions.headerButtonNoLabel, (value) =>\n      // {\n      //    this.updateHeaderButtons({ headerButtonNoLabel: value });\n      // }));\n\n      // Handles adding / removing this application from `ui.windows` when popOut changes.\n      this.#storeUnsubscribe.push(subscribeIgnoreFirst(this.#storeAppOptions.popOut, (value) =>\n      {\n         if (value && this.#application.rendered)\n         {\n            globalThis.ui.windows[this.#application.appId] = this.#application;\n         }\n         else\n         {\n            delete globalThis.ui.windows[this.#application.appId];\n         }\n      }));\n   }\n\n   /**\n    * Unsubscribes from any locally monitored stores.\n    *\n    * @see SvelteApp.close\n    */\n   #storesUnsubscribe()\n   {\n      this.#storeUnsubscribe.forEach((unsubscribe) => unsubscribe());\n      this.#storeUnsubscribe = [];\n   }\n}\n\n/**\n * Defines the application shell contract. If Svelte components export getter / setters for the following properties\n * then that component is considered an application shell.\n *\n * @type {string[]}\n */\nconst applicationShellContract = ['elementRoot'];\n\nObject.freeze(applicationShellContract);\n\n/**\n * Provides a method to determine if the passed in object / Svelte component follows the application shell contract.\n * This involves ensuring that the accessors defined in `applicationShellContract`.\n *\n * Note: A caveat is that when using Vite in a developer build components are wrapped in a proxy / ProxyComponent that\n * defines instance accessors versus on the prototype, so the check below ensures that all accessors in the contract are\n * either available on the prototype or directly on the instance.\n *\n * @param {*}  component - Object / component to test.\n *\n * @returns {boolean} Whether the component is a ApplicationShell or TJSApplicationShell.\n */\nfunction isApplicationShell(component)\n{\n   if (component === null || component === void 0) { return false; }\n\n   let compHasContract = true;\n   let protoHasContract = true;\n\n   // Check for accessors on the instance.\n   for (const accessor of applicationShellContract)\n   {\n      const descriptor = Object.getOwnPropertyDescriptor(component, accessor);\n      if (descriptor === void 0 || descriptor.get === void 0 || descriptor.set === void 0) { compHasContract = false; }\n   }\n\n   // Get the prototype which is the parent SvelteComponent that has any getter / setters.\n   const prototype = Object.getPrototypeOf(component);\n\n   // Verify the application shell contract. If the accessors (getters / setters) are defined for\n   // `applicationShellContract`.\n   for (const accessor of applicationShellContract)\n   {\n      const descriptor = Object.getOwnPropertyDescriptor(prototype, accessor);\n      if (descriptor === void 0 || descriptor.get === void 0 || descriptor.set === void 0) { protoHasContract = false; }\n   }\n\n   return compHasContract || protoHasContract;\n}\n\n/**\n * Instantiates and attaches a Svelte component to the main inserted HTML.\n *\n * @param {object}            [opts] - Optional parameters.\n *\n * @param {object}            [opts.app] - The target application\n *\n * @param {import('@typhonjs-fvtt/runtime/svelte/util').TJSSvelte.Config.Dynamic}  [opts.config] - Svelte component options\n *\n * @param {Function}          [opts.elementRootUpdate] - A callback to assign to the external context.\n *\n * @returns {import('@typhonjs-fvtt/runtime/svelte/application').SvelteData} The config + instantiated Svelte component.\n */\nfunction loadSvelteConfig({ app, config, elementRootUpdate } = {})\n{\n   let target;\n\n   // A specific HTMLElement to append Svelte component.\n   if (CrossWindow.isHTMLElement(config.target))\n   {\n      target = config.target;\n   }\n   else if (typeof config.target === 'string')\n   {\n      // Attempt to find target from query selector string.\n      const activeWindow = app?.reactive?.activeWindow;\n      target = activeWindow?.document?.querySelector(config.target);\n   }\n\n   if (!CrossWindow.isHTMLElement(target))\n   {\n      console.log(\n       `%c[TRL] loadSvelteConfig error - Could not find target, '${config.target}', for config:\\n`,\n        'background: rgb(57,34,34)', config);\n\n      throw new Error();\n   }\n\n   const NewSvelteComponent = config.class;\n\n   const svelteConfig = TJSSvelte.config.parseConfig({ ...config, target }, { contextExternal: true, thisArg: app });\n\n   const externalContext = svelteConfig.context.get('#external');\n\n   // Inject the Foundry application instance and `elementRootUpdate` to the external context.\n   externalContext.application = app;\n   externalContext.elementRootUpdate = elementRootUpdate;\n   externalContext.sessionStorage = app.reactive.sessionStorage;\n\n   let eventbus;\n\n   // Potentially inject any TyphonJS eventbus and track the proxy in the SvelteData instance.\n   if (isObject(app._eventbus) && typeof app._eventbus.createProxy === 'function')\n   {\n      eventbus = app._eventbus.createProxy();\n      externalContext.eventbus = eventbus;\n   }\n\n   // Seal external context so that it can't be extended.\n   Object.seal(externalContext);\n\n   // Create the Svelte component.\n   /**\n    * @type {import('svelte').SvelteComponent}\n    */\n   const component = new NewSvelteComponent(svelteConfig);\n\n   // Set any eventbus to the config.\n   svelteConfig.eventbus = eventbus;\n\n   /**\n    * @type {HTMLElement}\n    */\n   let element;\n\n   // We can directly get the root element from components which follow the application store contract.\n   if (isApplicationShell(component))\n   {\n      element = component.elementRoot;\n   }\n\n   if (!CrossWindow.isHTMLElement(element))\n   {\n      console.log(\n       `%c[TRL] loadSvelteConfig error - No application shell contract found. Did you bind and export a HTMLElement ` +\n        `as 'elementRoot' and include '<svelte:options accessors={true}/>'?\\n` +\n         `\\nOffending config:\\n`, 'background: rgb(57,34,34)', config);\n\n      throw new Error();\n   }\n\n   return { config: svelteConfig, component, element };\n}\n\n/**\n * Provides an index of all visible rendered {@link SvelteApp} instances in a given Svelte runtime. This allows\n * bulk operations to be performed across all apps.\n */\nclass TJSAppIndex\n{\n   /**\n    * Stores all visible / rendered apps.\n    *\n    * @type {Map<string, import('@typhonjs-fvtt/runtime/svelte/application').SvelteApp>}\n    */\n   static #visibleApps = new Map();\n\n   /**\n    * Adds a SvelteApp to all visible apps tracked.\n    *\n    * @param {import('@typhonjs-fvtt/runtime/svelte/application').SvelteApp} app - A SvelteApp\n    *\n    * @package\n    */\n   static add(app)\n   {\n      this.#visibleApps.set(app.id, app);\n   }\n\n   /**\n    * Removes a SvelteApp from all visible apps tracked.\n    *\n    * @param {import('@typhonjs-fvtt/runtime/svelte/application').SvelteApp} app - A SvelteApp\n    *\n    * @package\n    */\n   static delete(app)\n   {\n      this.#visibleApps.delete(app.id);\n   }\n\n   /**\n    * Gets a particular app by ID.\n    *\n    * @param {string}   key - App ID.\n    *\n    * @returns {import('@typhonjs-fvtt/runtime/svelte/application').SvelteApp} Associated app.\n    */\n   static get(key)\n   {\n      return this.#visibleApps.get(key);\n   }\n\n   /**\n    * Returns whether an associated app by ID is being tracked.\n    *\n    * @param {string}   key - App ID.\n    *\n    * @returns {boolean} The given App ID is visible.\n    */\n   static has(key)\n   {\n      return this.#visibleApps.has(key);\n   }\n\n   /**\n    * @returns {IterableIterator<string>} All visible app IDs.\n    */\n   static keys()\n   {\n      return this.#visibleApps.keys();\n   }\n\n   /**\n    * @returns {IterableIterator<import('@typhonjs-fvtt/runtime/svelte/application').SvelteApp>} All visible apps.\n    */\n   static values()\n   {\n      return this.#visibleApps.values();\n   }\n}\n\nclass FoundryHMRSupport\n{\n   static initialize()\n   {\n      if (import.meta.hot)\n      {\n         Hooks.on('hotReload', (data) =>\n         {\n            // Only handle JSON hot reload presumably specified in package manifest for language translation files.\n            if (data?.extension === 'json')\n            {\n               // Postpone until next macrotask to allow Foundry to update localization first.\n               setTimeout(() =>\n               {\n                  for (const app of TJSAppIndex.values())\n                  {\n                     const appShell = app.svelte.appShell;\n\n                     // Retrieve the original `svelte-hmr` instrumented HMR component / not the proxy.\n                     const hmrComponent = appShell?.$$?.hmr_cmp;\n\n                     if (appShell && typeof hmrComponent?.$replace === 'function')\n                     {\n                        const svelteData = app.svelte.appShellData;\n                        if (svelteData)\n                        {\n                           try\n                           {\n                              // Replace with self; this will invoke `on_hmr` callback in associated SvelteApp.\n                              hmrComponent.$replace(hmrComponent.constructor, {\n                                 target: svelteData.config.target,\n                                 anchor: svelteData.config.anchor,\n                                 preserveLocalState: true,\n                                 conservative: true\n                              });\n                           }\n                           catch (error)\n                           {\n                              const name = hmrComponent?.constructor?.name ?? 'Unknown';\n                              console.error(`TyphonJS Runtime Library error; Could not hot reload component: '${name}'`);\n                              console.error(error);\n                           }\n                        }\n                     }\n                  }\n               }, 0);\n            }\n\n            return true;\n         });\n      }\n   }\n}\n\n/**\n * Provides a Svelte aware extension to the Foundry {@link Application} class to manage the app lifecycle\n * appropriately. You can declaratively load one or more components from `defaultOptions` using a\n * {@link #runtime/svelte/util!TJSSvelte.Config.Dynamic} object in the {@link SvelteApp.Options.svelte} property.\n *\n * @implements {TJSPosition.Positionable}\n */\nclass SvelteApp extends Application\n{\n   static #MIN_WINDOW_HEIGHT = 50;\n   static #MIN_WINDOW_WIDTH = 200;\n\n   /**\n    * Stores the first mounted component which follows the application shell contract.\n    *\n    * @type {import('svelte').SvelteComponent[] | null[]} Application shell.\n    */\n   #applicationShellHolder = [null];\n\n   /**\n    * Stores and manages application state for saving / restoring / serializing.\n    *\n    * @type {import('./types').SvelteApp.API.State}\n    */\n   #applicationState;\n\n   /**\n    * Stores the target element which may not necessarily be the main element.\n    *\n    * @type {HTMLElement}\n    */\n   #elementTarget = null;\n\n   /**\n    * Stores the content element which is set for application shells.\n    *\n    * @type {HTMLElement}\n    */\n   #elementContent = null;\n\n   /**\n    * On initial render gating of `setPosition` invoked by `Application._render` occurs, so that percentage values\n    * can correctly be positioned with initial helper constraints (centered).\n    *\n    * @type {boolean}\n    */\n   #gateSetPosition = false;\n\n   /**\n    * Stores initial z-index from `_renderOuter` to set to target element / Svelte component.\n    *\n    * @type {number}\n    */\n   #initialZIndex = 95;\n\n   /**\n    * Stores on mount state which is checked in _render to trigger onSvelteMount callback.\n    *\n    * @type {boolean}\n    */\n   #onMount = false;\n\n   /**\n    * The position store.\n    *\n    * @type {TJSPosition}\n    */\n   #position;\n\n   /**\n    * Contains the Svelte stores and reactive accessors.\n    *\n    * @type {SvelteReactive}\n    */\n   #reactive;\n\n   /**\n    * Stores SvelteData entries with instantiated Svelte components.\n    *\n    * @type {import('./internal/state-svelte/types').SvelteData[] | null[]}\n    */\n   #svelteData = [null];\n\n   /**\n    * Provides a helper class that combines multiple methods for interacting with the mounted components tracked in\n    * #svelteData.\n    *\n    * @type {import('./types').SvelteApp.API.Svelte<Options>}\n    */\n   #getSvelteData = new GetSvelteData(this.#applicationShellHolder, this.#svelteData);\n\n   /**\n    * Contains methods to interact with the Svelte stores.\n    *\n    * @type {import('./internal/state-reactive/types-local').SvelteReactiveStores}\n    */\n   #stores;\n\n   /**\n    * @param {Partial<import('./types').SvelteApp.Options>} [options] - The options for the application.\n    */\n   constructor(options = {})\n   {\n      super(options);\n\n      if (!isObject(this.options.svelte))\n      {\n         throw new Error(`SvelteApp - constructor - No Svelte configuration object found in 'options'.`);\n      }\n\n      this.#applicationState = new ApplicationState(this);\n\n      // Initialize TJSPosition with the position object set by Application.\n      this.#position = new TJSPosition(this, {\n         ...this.position,\n         ...this.options,\n         initial: this.options.positionInitial,\n         ortho: this.options.positionOrtho,\n         validator: this.options.positionValidator\n      });\n\n      // Remove old position field.\n      delete this.position;\n\n      /**\n       * Define accessors to retrieve TJSPosition by `this.position`.\n       *\n       * @member {TJSPosition} position - Adds accessors to SvelteApp to get / set the position data.\n       *\n       * @memberof SvelteApp#\n       */\n      Object.defineProperty(this, 'position', {\n         get: () => this.#position,\n         set: (position) => { if (isObject(position)) { this.#position.set(position); } }\n      });\n\n      this.#reactive = new SvelteReactive(this);\n\n      this.#stores = this.#reactive.initialize();\n   }\n\n   /**\n    * Specifies the default options that SvelteApp supports.\n    *\n    * @returns {import('./types').SvelteApp.Options} options - Application options.\n    * @see https://foundryvtt.com/api/interfaces/client.ApplicationOptions.html\n    */\n   static get defaultOptions()\n   {\n      return /** @type {import('./types').SvelteApp.Options} */ deepMerge(super.defaultOptions, {\n         defaultCloseAnimation: true,     // If false the default slide close animation is not run.\n         draggable: true,                 // If true then application shells are draggable.\n         focusAuto: true,                 // When true auto-management of app focus is enabled.\n         focusKeep: false,                // When `focusAuto` and `focusKeep` is true; keeps internal focus.\n         focusSource: void 0,             // Stores any A11yFocusSource data that is applied when app is closed.\n         focusTrap: true,                 // When true focus trapping / wrapping is enabled keeping focus inside app.\n         headerButtonNoClose: false,      // If true then the close header button is removed.\n         headerButtonNoLabel: false,      // If true then header button labels are removed for application shells.\n         headerIcon: void 0,              // Sets a header icon given an image URL.\n         headerNoTitleMinimized: false,   // If true then header title is hidden when application is minimized.\n         minHeight: SvelteApp.#MIN_WINDOW_HEIGHT,    // Assigned to position. Number specifying minimum window height.\n         minWidth: SvelteApp.#MIN_WINDOW_WIDTH,      // Assigned to position. Number specifying minimum window width.\n         positionable: true,              // If false then `position.set` does not take effect.\n         positionInitial: TJSPosition.Initial.browserCentered,      // A helper for initial position placement.\n         positionOrtho: true,             // When true TJSPosition is optimized for orthographic use.\n         positionValidator: TJSPosition.Validators.transformWindow, // A function providing the default validator.\n         sessionStorage: void 0,          // An instance of WebStorage (session) to share across SvelteApps.\n         svelte: void 0,                  // A Svelte configuration object.\n         transformOrigin: 'top left'      // By default, 'top / left' respects rotation when minimizing.\n      });\n   }\n\n   /**\n    * Returns the content element if an application shell is mounted.\n    *\n    * @returns {HTMLElement} Content element.\n    */\n   get elementContent() { return this.#elementContent; }\n\n   /**\n    * Returns the target element or main element if no target defined.\n    *\n    * @returns {HTMLElement} Target element.\n    */\n   get elementTarget() { return this.#elementTarget; }\n\n   /**\n    * Returns the reactive accessors & Svelte stores for SvelteApp.\n    *\n    * @returns {import('./types').SvelteApp.API.Reactive} The reactive accessors & Svelte stores.\n    */\n   get reactive() { return this.#reactive; }\n\n   /**\n    * Returns the application state manager.\n    *\n    * @returns {import('./types').SvelteApp.API.State} The application state manager.\n    */\n   get state() { return this.#applicationState; }\n\n   /**\n    * Returns the `Svelte` helper class w/ various methods to access the mounted application shell component.\n    *\n    * @returns {import('./types').SvelteApp.API.Svelte<Options>} `Svelte` / mounted application shell API.\n    */\n   get svelte() { return this.#getSvelteData; }\n\n   /**\n    * In this case of when a template is defined in app options `html` references the inner HTML / template. However,\n    * to activate classic v1 tabs for a Svelte component the element target is passed as an array simulating JQuery as\n    * the element is retrieved immediately and the core listeners use standard DOM queries.\n    *\n    * @protected\n    * @ignore\n    * @internal\n    */\n   _activateCoreListeners(html)\n   {\n      super._activateCoreListeners(typeof this.options.template === 'string' ? html :\n       [this.popOut ? this.#elementTarget?.firstChild : this.#elementTarget]);\n   }\n\n   /**\n    * Provide an override to set this application as the active window regardless of z-index. Changes behaviour from\n    * Foundry core.\n    *\n    * @param {object} [opts] - Optional parameters.\n    *\n    * @param {boolean} [opts.focus=true] - When true and the active element is not contained in the app `elementTarget`\n    *        is focused..\n    *\n    * @param {boolean} [opts.force=false] - Force bring to top; will increment z-index by popOut order.\n    *\n    * @ignore\n    * @internal\n    */\n   bringToTop({ focus = true, force = false } = {})\n   {\n      // Only perform bring to top when the active window is the main Foundry window instance.\n      if (this.reactive.activeWindow !== globalThis) { return; }\n\n      if (force || this.popOut) { super.bringToTop(); }\n\n      const elementTarget = this.elementTarget;\n      const activeElement = document.activeElement;\n\n      // If the activeElement is not contained in this app via elementTarget then blur the current active element\n      // and make elementTarget focused.\n      if (focus && elementTarget && activeElement !== elementTarget && !elementTarget?.contains(activeElement))\n      {\n         // Blur current active element.\n         if (A11yHelper.isFocusTarget(activeElement))\n         {\n            activeElement.blur();\n         }\n\n         elementTarget?.focus();\n      }\n\n      globalThis.ui.activeWindow = this;\n   }\n\n   /**\n    * Note: This method is fully overridden and duplicated as Svelte components need to be destroyed manually and the\n    * best visual result is to destroy them after the default slide up animation occurs, but before the element\n    * is removed from the DOM.\n    *\n    * If you destroy the Svelte components before the slide up animation the Svelte elements are removed immediately\n    * from the DOM. The purpose of overriding ensures the slide up animation is always completed before\n    * the Svelte components are destroyed and then the element is removed from the DOM.\n    *\n    * Close the application and unregisters references to it within UI mappings.\n    * This function returns a Promise which resolves once the window closing animation concludes.\n    *\n    * @param {object}   [options] - Optional parameters.\n    *\n    * @param {boolean}  [options.force] - Force close regardless of render state.\n    *\n    * @returns {Promise<void>}    A Promise which resolves once the application is closed.\n    *\n    * @ignore\n    * @internal\n    */\n   async close(options = {})\n   {\n      const states = Application.RENDER_STATES;\n\n      if (!options.force && ![states.RENDERED, states.ERROR].includes(this._state)) { return; }\n\n      /**\n       * Get the element.\n       *\n       * @type {HTMLElement}\n       */\n      const el = this.#elementTarget;\n      if (!el)\n      {\n         /**\n          * @ignore\n          * @internal\n          */\n         this._state = states.CLOSED;\n\n         return;\n      }\n\n      // Support for PopOut! module; `close` is double invoked; once before the element is rejoined to the main window.\n      // Reject close invocations when the element window is not the main originating window / globalThis.\n      if (CrossWindow.getWindow(el, { throws: false }) !== globalThis) { return; }\n\n      /**\n       * @ignore\n       * @internal\n       */\n      this._state = states.CLOSING;\n\n      // Unsubscribe from any local stores.\n      this.#stores.unsubscribe();\n\n      // Make any window content overflow hidden to avoid any scrollbars appearing in default or Svelte outro\n      // transitions.\n      const content = el.querySelector('.window-content');\n      if (content)\n      {\n         content.style.overflow = 'hidden';\n\n         // Set all children of content to overflow hidden as if there is going to be additional scrolling elements\n         // they are likely one level deep.\n         for (let cntr = content.children.length; --cntr >= 0;)\n         {\n            content.children[cntr].style.overflow = 'hidden';\n         }\n      }\n\n      // Dispatch Hooks for closing the base and subclass applications\n      for (const cls of this.constructor._getInheritanceChain())\n      {\n         /**\n          * A hook event that fires whenever this Application is closed.\n          *\n          * Note: JQuery wrapping as Foundry event arguments uses JQuery.\n          */\n         Hooks.call(`close${cls.name}`, this, $(el));\n      }\n\n      // If options `defaultCloseAnimation` is false then do not execute the standard slide up animation.\n      // This allows Svelte components to provide any out transition. Application shells will automatically set\n      // `defaultCloseAnimation` based on any out transition set or unset.\n      const animate = typeof this.options.defaultCloseAnimation === 'boolean' ? this.options.defaultCloseAnimation :\n       true;\n\n      if (animate)\n      {\n         // Set min height for full slide.\n         el.style.minHeight = '0';\n\n         const { paddingBottom, paddingTop } = globalThis.getComputedStyle(el);\n\n         // Slide-up application.\n         await el.animate([\n            { maxHeight: `${el.clientHeight}px`, paddingTop, paddingBottom },\n            { maxHeight: 0, paddingTop: 0, paddingBottom: 0 }\n         ], { duration: 250, easing: 'ease-in', fill: 'forwards' }).finished;\n      }\n\n      // Stores the Promises returned from running outro transitions and destroying each Svelte component.\n      const svelteDestroyPromises = [];\n\n      // Manually invoke the destroy callbacks for all Svelte components.\n      for (const entry of this.#svelteData)\n      {\n         if (!isObject(entry)) { continue; }\n\n         // Use `outroAndDestroy` to run outro transitions before destroying.\n         svelteDestroyPromises.push(TJSSvelte.util.outroAndDestroy(entry.component));\n\n         // If any proxy eventbus has been added then remove all event registrations from the component.\n         const eventbus = entry.config.eventbus;\n         if (isObject(eventbus) && typeof eventbus.off === 'function')\n         {\n            eventbus.off();\n            entry.config.eventbus = void 0;\n         }\n      }\n\n      // Await all Svelte components to destroy.\n      await Promise.allSettled(svelteDestroyPromises);\n\n      // Remove from all visible apps tracked.\n      TJSAppIndex.delete(this);\n\n      // Reset SvelteData like this to maintain reference to GetSvelteData / `this.svelte`.\n      this.#svelteData[0] = null;\n\n      // Remove element from the DOM. Most SvelteComponents have already removed it.\n      el.remove();\n\n      // Silently restore any width / height state before minimized as applicable.\n      this.position.state.restore({\n         name: '#beforeMinimized',\n         properties: ['width', 'height'],\n         silent: true,\n         remove: true\n      });\n\n      // Clean up data\n      this.#applicationShellHolder[0] = null;\n\n      /**\n       * @ignore\n       * @internal\n       */\n      this._element = null;\n      this.#elementContent = null;\n      this.#elementTarget = null;\n\n      delete globalThis.ui.windows[this.appId];\n\n      /**\n       * @ignore\n       * @internal\n       */\n      this._minimized = false;\n\n      /**\n       * @ignore\n       * @internal\n       */\n      this._scrollPositions = null;\n\n      /**\n       * @ignore\n       * @internal\n       */\n      this._state = states.CLOSED;\n\n      this.#onMount = false;\n\n      // Update the minimized UI store state.\n      this.#stores.uiStateUpdate((storeOptions) => deepMerge(storeOptions, { minimized: this._minimized }));\n\n      // Apply any stored focus options and then remove them from options.\n      A11yHelper.applyFocusSource(this.options.focusSource);\n\n      delete this.options.focusSource;\n   }\n\n   /**\n    * Specify the set of config buttons which should appear in the SvelteApp header. Buttons should be returned as\n    * an Array of objects. The header buttons which are added to the application can be modified by the\n    * `getApplicationHeaderButtons` hook.\n    *\n    * SvelteApp extends the button functionality with full reactivity for state changes during callbacks. Callbacks\n    * receive the button data and can modify it to update the button state.\n    *\n    * @privateRemarks Provide a basic override implementation to extend types with additional SvelteApp functionality.\n    *\n    * @returns {import('./types').SvelteApp.HeaderButton[]} All header buttons.\n    * @protected\n    */\n   _getHeaderButtons()\n   {\n      return super._getHeaderButtons();\n   }\n\n   /**\n    * Inject the Svelte components defined in `this.options.svelte`. The Svelte component can attach to the existing\n    * pop-out of Application or provide no template and render into a document fragment which is then attached to the\n    * DOM.\n    *\n    * @protected\n    * @ignore\n    * @internal\n    */\n   _injectHTML()\n   {\n      // Make sure the store is updated with the latest header buttons. Also allows filtering buttons before display.\n      this.reactive.updateHeaderButtons();\n\n      // Create a function to generate a callback for Svelte components to invoke to update the tracked elements for\n      // application shells in the rare cases that the main element root changes. The update is only triggered on\n      // successive changes of `elementRoot`. Returns a boolean to indicate the element roots are updated.\n      const elementRootUpdate = () =>\n      {\n         let cntr = 0;\n\n         return (elementRoot) =>\n         {\n            if (elementRoot !== null && elementRoot !== void 0 && cntr++ > 0)\n            {\n               this.#updateApplicationShell();\n               return true;\n            }\n\n            return false;\n         };\n      };\n\n      // A sanity check; absence should be detected in constructor.\n      if (!isObject(this.options.svelte))\n      {\n         throw new Error(`SvelteApp - _injectHTML - No Svelte configuration object found in 'options'.`);\n      }\n\n      const svelteData = loadSvelteConfig({\n         app: this,\n         config: this.options.svelte,\n         elementRootUpdate\n      });\n\n      // A sanity check as shouldn't hit this case as only one component is being mounted.\n      if (this.svelte.appShell !== null)\n      {\n         throw new Error(\n          `SvelteApp - _injectHTML - An application shell is already mounted; offending config:\\n` +\n           `${JSON.stringify(this.options.svelte)}`);\n      }\n\n      this.#applicationShellHolder[0] = svelteData.component;\n\n      // If Vite / HMR / svelte_hmr is enabled then add a hook to receive callbacks when the ProxyComponent\n      // refreshes. Update the element root accordingly and force an update to TJSPosition.\n      // See this issue for info about `on_hmr`:\n      // https://github.com/sveltejs/svelte-hmr/issues/57\n      if (TJSSvelte.util.isHMRProxy(svelteData.component) && Array.isArray(svelteData.component?.$$?.on_hmr))\n      {\n         svelteData.component.$$.on_hmr.push(() => () => this.#updateApplicationShell());\n      }\n\n      this.#svelteData[0] = svelteData;\n\n      // Wrap `elementRoot` as a JQuery object and set to AppV1 / Application element.\n      this._element = $(this.svelte.appShell.elementRoot);\n\n      // Detect if the application shell exports an `elementContent` accessor.\n      this.#elementContent = hasGetter(this.svelte.appShell, 'elementContent') ?\n       this.svelte.appShell.elementContent : null;\n\n      // Detect if the application shell exports an `elementTarget` accessor if not set `elementTarget` to\n      // `elementRoot`.\n      this.#elementTarget = hasGetter(this.svelte.appShell, 'elementTarget') ? this.svelte.appShell.elementTarget :\n       this.svelte.appShell.elementRoot;\n\n      // The initial zIndex may be set in application options or for popOut applications is stored by `_renderOuter`\n      // in `this.#initialZIndex`.\n      if (typeof this.options.positionable === 'boolean' && this.options.positionable)\n      {\n         this.#elementTarget.style.zIndex = typeof this.options.zIndex === 'number' ? this.options.zIndex :\n          this.#initialZIndex ?? 95;\n      }\n\n      // Subscribe to local store handling.\n      this.#stores.subscribe();\n   }\n\n   /**\n    * Provides a mechanism to update the UI options store for maximized.\n    *\n    * Note: the sanity check is duplicated from {@link Application.maximize} the store is updated _before_\n    * performing the rest of animations. This allows application shells to remove / show any resize handlers\n    * correctly. Extra constraint data is stored in a saved position state in {@link SvelteApp.minimize}\n    * to animate the content area.\n    *\n    * @param {object}   [opts] - Optional parameters.\n    *\n    * @param {boolean}  [opts.animate=true] - When true perform default maximizing animation.\n    *\n    * @param {number}   [opts.duration=0.1] - Controls content area animation duration in seconds.\n    */\n   async maximize({ animate = true, duration = 0.1 } = {})\n   {\n      if (!this.popOut || [false, null].includes(this._minimized)) { return; }\n\n      this._minimized = null;\n\n      const durationMS = duration * 1000; // For WAAPI.\n\n      // Get content\n      const element = this.elementTarget;\n      const header = element.querySelector('.window-header');\n      const content = element.querySelector('.window-content');\n\n      // Get the complete position before minimized. Used to reset min width & height to initial values later.\n      const positionBefore = this.position.state.get({ name: '#beforeMinimized' });\n\n      // First animate / restore width / async.\n      if (animate)\n      {\n         await this.position.state.restore({\n            name: '#beforeMinimized',\n            async: true,\n            animateTo: true,\n            properties: ['width'],\n            duration: 0.1\n         });\n      }\n\n      element.classList.remove('minimized');\n\n      // Reset display none on all children of header.\n      for (let cntr = header.children.length; --cntr >= 0;) { header.children[cntr].style.display = null; }\n\n      content.style.display = null;\n\n      let constraints;\n\n      if (animate)\n      {\n         // Next animate / restore height synchronously and remove key. Retrieve constraints data for slide up animation\n         // below.\n         ({ constraints } = this.position.state.restore({\n            name: '#beforeMinimized',\n            animateTo: true,\n            properties: ['height'],\n            remove: true,\n            duration\n         }));\n      }\n      else\n      {\n         ({ constraints } = this.position.state.remove({ name: '#beforeMinimized' }));\n      }\n\n      // Slide down content with stored constraints.\n      await content.animate([\n         { maxHeight: 0, paddingTop: 0, paddingBottom: 0, offset: 0 },\n         { ...constraints, offset: 1 },\n         { maxHeight: '100%', offset: 1 },\n      ], { duration: durationMS, fill: 'forwards' }).finished; // WAAPI in ms.\n\n      // Restore previous min width & height from saved data, app options, or default Foundry values.\n      this.position.set({\n         minHeight: positionBefore.minHeight ?? this.options?.minHeight ?? SvelteApp.#MIN_WINDOW_HEIGHT,\n         minWidth: positionBefore.minWidth ?? this.options?.minWidth ?? SvelteApp.#MIN_WINDOW_WIDTH,\n      });\n\n      // Remove inline styles that override any styles assigned to the app.\n      element.style.minWidth = null;\n      element.style.minHeight = null;\n\n      this._minimized = false;\n\n      // Using a 50ms timeout prevents any instantaneous display of scrollbars with the above maximize animation.\n      setTimeout(() =>\n      {\n         content.style.overflow = null;\n\n         // Reset all children of content removing overflow hidden.\n         for (let cntr = content.children.length; --cntr >= 0;)\n         {\n            content.children[cntr].style.overflow = null;\n         }\n      }, 50);\n\n      this.#stores.uiStateUpdate((options) => deepMerge(options, { minimized: false }));\n   }\n\n   /**\n    * Provides a mechanism to update the UI options store for minimized.\n    *\n    * Note: the sanity check is duplicated from {@link Application.minimize} the store is updated _before_\n    * performing the rest of animations. This allows application shells to remove / show any resize handlers\n    * correctly. Extra constraint data is stored in a saved position state in {@link SvelteApp.minimize}\n    * to animate the content area.\n    *\n    * @param {object}   [opts] - Optional parameters.\n    *\n    * @param {boolean}  [opts.animate=true] - When true perform default minimizing animation.\n    *\n    * @param {number}   [opts.duration=0.1] - Controls content area animation duration in seconds.\n    */\n   async minimize({ animate = true, duration = 0.1 } = {})\n   {\n      if (!this.rendered || !this.popOut || [true, null].includes(this._minimized)) { return; }\n\n      this.#stores.uiStateUpdate((options) => deepMerge(options, { minimized: true }));\n\n      this._minimized = null;\n\n      const durationMS = duration * 1000; // For WAAPI.\n\n      const element = this.elementTarget;\n\n      // Get content\n      const header = element.querySelector('.window-header');\n      const content = element.querySelector('.window-content');\n\n      // Save current max / min height & width.\n      const beforeMinWidth = this.position.minWidth;\n      const beforeMinHeight = this.position.minHeight;\n\n      // Set minimized min width & height for header bar.\n      this.position.set({ minWidth: 100, minHeight: 30 });\n\n      // Also set inline styles to override any styles scoped to the app.\n      element.style.minWidth = '100px';\n      element.style.minHeight = '30px';\n\n      if (content)\n      {\n         content.style.overflow = 'hidden';\n\n         // Set all children of content to overflow hidden as if there is going to be additional scrolling elements\n         // they are likely one level deep.\n         for (let cntr = content.children.length; --cntr >= 0;)\n         {\n            content.children[cntr].style.overflow = 'hidden';\n         }\n      }\n\n      const { paddingBottom, paddingTop } = globalThis.getComputedStyle(content);\n\n      // Extra data that is saved with the current position. Used during `maximize`.\n      const constraints = {\n         maxHeight: `${content.clientHeight}px`,\n         paddingTop,\n         paddingBottom\n      };\n\n      // Slide-up content\n      if (animate)\n      {\n         const animation = content.animate([\n            constraints,\n            { maxHeight: 0, paddingTop: 0, paddingBottom: 0 }\n         ], { duration: durationMS, fill: 'forwards' }); // WAAPI in ms.\n\n         // Set display style to none when animation finishes.\n         animation.finished.then(() => content.style.display = 'none');\n      }\n      else\n      {\n         setTimeout(() => content.style.display = 'none', durationMS);\n      }\n\n      // Save current position state and add the constraint data to use in `maximize`.\n      const saved = this.position.state.save({ name: '#beforeMinimized', constraints });\n\n      // Set the initial before min width & height.\n      saved.minWidth = beforeMinWidth;\n      saved.minHeight = beforeMinHeight;\n\n      const headerOffsetHeight = header.offsetHeight;\n\n      // minHeight needs to be adjusted to header height.\n      this.position.minHeight = headerOffsetHeight;\n\n      if (animate)\n      {\n         // First await animation of height upward.\n         await this.position.animate.to({ height: headerOffsetHeight }, { duration }).finished;\n      }\n\n      // Set all header buttons besides close and the window title to display none.\n      for (let cntr = header.children.length; --cntr >= 0;)\n      {\n         const className = header.children[cntr].className;\n\n         if (className.includes('window-title') || className.includes('close')) { continue; }\n\n         // v10+ of Foundry core styles automatically hides anything besides the window title and close button, so\n         // explicitly set display to block.\n         if (className.includes('keep-minimized'))\n         {\n            header.children[cntr].style.display = 'block';\n            continue;\n         }\n\n         header.children[cntr].style.display = 'none';\n      }\n\n      if (animate)\n      {\n         // Await animation of width to the left / minimum width.\n         await this.position.animate.to({ width: SvelteApp.#MIN_WINDOW_WIDTH }, { duration: 0.1 }).finished;\n      }\n\n      element.classList.add('minimized');\n\n      this._minimized = true;\n   }\n\n   /**\n    * Provides a callback after all Svelte components are initialized.\n    */\n   onSvelteMount() {} // eslint-disable-line no-unused-vars\n\n   /**\n    * Provides a callback after the main application shell is remounted. This may occur during HMR / hot module\n    * replacement or directly invoked from the `elementRootUpdate` callback passed to the application shell component\n    * context.\n    */\n   onSvelteRemount() {} // eslint-disable-line no-unused-vars\n\n   /**\n    * Override replacing HTML as Svelte components control the rendering process. Only potentially change the outer\n    * application frame / title for pop-out applications.\n    *\n    * @protected\n    * @ignore\n    * @internal\n    */\n   _replaceHTML(element, html)  // eslint-disable-line no-unused-vars\n   {\n      if (!element.length) { return; }\n\n      this.reactive.updateHeaderButtons();\n   }\n\n   /**\n    * Provides an override verifying that a new Application being rendered for the first time doesn't have a\n    * corresponding DOM element already loaded. This is a check that only occurs when `this._state` is\n    * `Application.RENDER_STATES.NONE`. It is useful in particular when SvelteApp has a static ID\n    * explicitly set in `this.options.id` and long intro / outro transitions are assigned. If a new application\n    * sharing this static ID attempts to open / render for the first time while an existing DOM element sharing\n    * this static ID exists then the initial render is cancelled below rather than crashing later in the render\n    * cycle {@link TJSPosition.set}.\n    *\n    * @protected\n    * @ignore\n    * @internal\n    */\n   async _render(force = false, options = {})\n   {\n      // Store any focusSource instance.\n      if (isObject(options?.focusSource)) { this.options.focusSource = options.focusSource; }\n\n      const activeWindow = this.reactive.activeWindow;\n\n      try\n      {\n         if (this._state === Application.RENDER_STATES.NONE &&\n          A11yHelper.isFocusTarget(activeWindow.document.querySelector(`#${this.id}`)))\n         {\n            console.warn(`SvelteApp - _render: A DOM element already exists for CSS ID '${this.id\n             }'. Cancelling initial render for new application with appId '${this.appId}'.`);\n\n            return;\n         }\n      }\n      catch (err)\n      {\n         console.warn(`SvelteApp - _render: Potentially malformed application ID '${this.id\n          }'. Cancelling initial render for new application with appId '${this.appId}'.`);\n\n         return;\n      }\n\n      // On initial render gating of `setPosition` invoked by `Application._render` occurs, so that percentage values\n      // can correctly be positioned with initial helper constraints (centered).\n      this.#gateSetPosition = true;\n\n      await super._render(force, options);\n\n      this.#gateSetPosition = false;\n\n      // Handle the same render exclusion tests that reject a render in Application.\n\n      // Do not render under certain conditions.\n      if ([Application.RENDER_STATES.CLOSING, Application.RENDER_STATES.RENDERING].includes(this._state)) { return; }\n\n      // Applications which are not currently rendered must be forced.\n      if (!force && (this._state <= Application.RENDER_STATES.NONE)) { return; }\n\n      // It is necessary to directly invoke `position.set` as TJSPosition uses accessors and is not a bare object, so\n      // the merging that occurs in `Application._render` does not take effect. Additionally, any of the main\n      // positional properties that are defined as strings such as percentage values need to be set after the element\n      // is mounted.\n      if (!this._minimized)\n      {\n         this.#position.set({\n            left: typeof this.options?.left === 'string' ? this.options.left : void 0,\n            height: typeof this.options?.height === 'string' ? this.options.height : void 0,\n            maxHeight: typeof this.options?.maxHeight === 'string' ? this.options.maxHeight : void 0,\n            maxWidth: typeof this.options?.maxWidth === 'string' ? this.options.maxWidth : void 0,\n            minHeight: typeof this.options?.minHeight === 'string' ? this.options.minHeight : void 0,\n            minWidth: typeof this.options?.minWidth === 'string' ? this.options.minWidth : void 0,\n            rotateX: typeof this.options?.rotateX === 'string' ? this.options.rotateX : void 0,\n            rotateY: typeof this.options?.rotateY === 'string' ? this.options.rotateY : void 0,\n            rotateZ: typeof this.options?.rotateZ === 'string' ? this.options.rotateZ : void 0,\n            rotation: typeof this.options?.rotation === 'string' ? this.options.rotation : void 0,\n            top: typeof this.options?.top === 'string' ? this.options.top : void 0,\n            width: typeof this.options?.width === 'string' ? this.options.width : void 0,\n\n            ...options\n         });\n      }\n\n      if (!this.#onMount)\n      {\n         // Add to visible apps tracked.\n         TJSAppIndex.add(this);\n\n         this.onSvelteMount();\n\n         this.#onMount = true;\n      }\n   }\n\n   /**\n    * Render the inner application content. Provide an empty JQuery element per the core Foundry API.\n    *\n    * @protected\n    * @ignore\n    * @internal\n    */\n   async _renderInner()\n   {\n      const activeWindow = this.reactive.activeWindow;\n\n      const html = activeWindow.document.createDocumentFragment();\n\n      return $(html);\n   }\n\n   /**\n    * Stores the initial z-index set in `_renderOuter` which is used in `_injectHTML` to set the target element\n    * z-index after the Svelte component is mounted.\n    *\n    * @protected\n    * @ignore\n    * @internal\n    */\n   async _renderOuter()\n   {\n      const html = await super._renderOuter();\n      this.#initialZIndex = html[0].style.zIndex;\n      return html;\n   }\n\n   /**\n    * All calculation and updates of position are implemented in {@link TJSPosition.set}.\n    * This allows position to be fully reactive and in control of updating inline styles for the application.\n    *\n    * This method remains for backward compatibility with Foundry. If you have a custom override quite likely you need\n    * to update to using the {@link TJSPosition.validators} / ValidatorAPI functionality.\n    *\n    * @param {TJSPosition.API.Data.TJSPositionDataRelative}   [position] - TJSPosition data.\n    *\n    * @returns {TJSPosition} The updated position object for the application containing the new values.\n    * @ignore\n    */\n   setPosition(position)\n   {\n      return !this.#gateSetPosition ? this.position.set(position) : this.position;\n   }\n\n   /**\n    * This method is invoked by the `elementRootUpdate` callback that is added to the external context passed to\n    * Svelte components. When invoked it updates the local element roots tracked by SvelteApp.\n    *\n    * This method may also be invoked by HMR / hot module replacement via `svelte-hmr`.\n    */\n   #updateApplicationShell()\n   {\n      const applicationShell = this.svelte.appShell;\n\n      if (applicationShell !== null)\n      {\n         this._element = $(applicationShell.elementRoot);\n\n         // Detect if the application shell exports an `elementContent` accessor.\n         this.#elementContent = hasGetter(applicationShell, 'elementContent') ?\n          applicationShell.elementContent : null;\n\n         // Detect if the application shell exports an `elementTarget` accessor.\n         this.#elementTarget = hasGetter(applicationShell, 'elementTarget') ?\n          applicationShell.elementTarget : null;\n\n         if (this.#elementTarget === null)\n         {\n            this.#elementTarget = typeof this.options.selectorTarget === 'string' ?\n             this._element[0].querySelector(this.options.selectorTarget) : this._element[0];\n         }\n\n         // The initial zIndex may be set in application options or for popOut applications is stored by `_renderOuter`\n         // in `this.#initialZIndex`.\n         if (typeof this.options.positionable === 'boolean' && this.options.positionable)\n         {\n            this.#elementTarget.style.zIndex = typeof this.options.zIndex === 'number' ? this.options.zIndex :\n             this.#initialZIndex ?? 95;\n\n            super.bringToTop();\n\n            // Ensure that new root element has inline position styles set.\n            this.position.set(this.position.get());\n         }\n\n         super._activateCoreListeners([this.popOut ? this.#elementTarget?.firstChild : this.#elementTarget]);\n\n         this.onSvelteRemount();\n      }\n   }\n}\n\n/**\n * Handle `PopOut!` module hooks to allow applications to popout to their own browser window.\n */\nclass PopoutSupport\n{\n   static initialize()\n   {\n      Hooks.on('PopOut:loading', (app, popout) =>\n      {\n         if (app instanceof SvelteApp)\n         {\n            // Disable app position system.\n            app.position.enabled = false;\n\n            // Save current `headerButtonNoClose` state.\n            app.state.save({\n               name: '#beforePopout',\n               headerButtonNoClose: app.reactive.headerButtonNoClose\n            });\n\n            // Set the apps active window to the popout browser window.\n            app.reactive.activeWindow = popout;\n\n            // Disable the close button.\n            app.reactive.headerButtonNoClose = true;\n         }\n      });\n\n      Hooks.on('PopOut:popin', (app) => this.#handleRejoin(app));\n      Hooks.on('PopOut:close', (app) => this.#handleRejoin(app));\n   }\n\n   /**\n    * Handles rejoining the app to main browser window.\n    *\n    * @param {Application} app - The target app.\n    */\n   static #handleRejoin(app)\n   {\n      if (app instanceof SvelteApp)\n      {\n         // Enable the app position system.\n         app.position.enabled = true;\n\n         // Restore the initial header button no close state.\n         const beforeData = app.state.remove({ name: '#beforePopout' });\n         if (beforeData) { app.reactive.headerButtonNoClose = beforeData?.headerButtonNoClose ?? false; }\n\n         // Reset the apps active window to the main `globalThis` reference.\n         app.reactive.activeWindow = void 0;\n      }\n   }\n}\n\n/**\n * Provides reactive observation of the Foundry core theme applied to `document.body`. There are several stores\n * available to receive updates when the theme changes.\n */\nclass ThemeObserver\n{\n   /**\n    * All readable theme stores.\n    *\n    * @type {Readonly<({\n    *    theme: Readonly<import('#svelte/store').Readable<'theme-dark' | 'theme-light'>>,\n    *    themeDark: Readonly<import('#svelte/store').Readable<boolean>>,\n    *    themeLight: Readonly<import('#svelte/store').Readable<boolean>>,\n    * })>}\n    */\n   static #stores;\n\n   /**\n    * Internal setter for theme stores.\n    *\n    * @type {({\n    *    theme: Function,\n    *    themeDark: Function,\n    *    themeLight: Function,\n    * })}\n    */\n   static #storeSet;\n\n   /**\n    * Current theme.\n    *\n    * @type {string}\n    */\n   static #theme = '';\n\n   /**\n    * @returns {Readonly<({\n    *    theme: Readonly<import('#svelte/store').Readable<'theme-dark' | 'theme-light'>>,\n    *    themeDark: Readonly<import('#svelte/store').Readable<boolean>>,\n    *    themeLight: Readonly<import('#svelte/store').Readable<boolean>>,\n    * })>} Current core theme stores.\n    */\n   static get stores() { return this.#stores; }\n\n   /**\n    * @returns {'theme-dark' | 'theme-light'} Current core theme.\n    */\n   static get theme() { return this.#theme; }\n\n   /**\n    * @returns {boolean} Is the core theme `dark`.\n    */\n   static get themeDark() { return this.#theme === 'theme-dark'; }\n\n   /**\n    * @returns {boolean} Is the core theme `light`.\n    */\n   static get themeLight() { return this.#theme === 'theme-light'; }\n\n   /**\n    * Helper to apply current core theme to a given SvelteApp optional classes.\n    *\n    * @param {import('@typhonjs-fvtt/runtime/svelte/application').SvelteApp} application - Svelte application.\n    *\n    * @param {object} [options] - Options.\n    *\n    * @param {boolean} [options.hasThemed] - Verify that the original application default options contains the `themed`\n    *        class otherwise do not add the core theme classes.\n    *\n    * @returns {string} App classes CSS string with current core theme applied.\n    */\n   static appClasses(application, { hasThemed = false } = {})\n   {\n      const classes = new Set([\n         ...Array.isArray(application?.options?.classes) ? application.options.classes : [],\n      ]);\n\n      // In AppV1 `theme-light` is always applied. Remove it.\n      classes.delete('themed');\n      classes.delete('theme-light');\n\n      if (!hasThemed)\n      {\n         // Add core theme classes.\n         classes.add('themed');\n         classes.add(this.#theme);\n      }\n      else\n      {\n         // Verify original app options has `themed` class then add core theme classes.\n         const origOptions = application.constructor.defaultOptions;\n         if (origOptions?.classes?.includes('themed'))\n         {\n            classes.add('themed');\n            classes.add(this.#theme);\n         }\n      }\n\n      return Array.from(classes).join(' ');\n   }\n\n   /**\n    * Initialize `document.body` theme observation.\n    */\n   static initialize()\n   {\n      if (this.#stores !== void 0) { return; }\n\n      const themeStore = writable(this.#theme);\n      const themeDarkStore = writable(false);\n      const themeLightStore = writable(false);\n\n      this.#stores = Object.freeze({\n         theme: Object.freeze({ subscribe: themeStore.subscribe }),\n         themeDark: Object.freeze({ subscribe: themeDarkStore.subscribe }),\n         themeLight: Object.freeze({ subscribe: themeLightStore.subscribe })\n      });\n\n      this.#storeSet = {\n         theme: themeStore.set,\n         themeDark: themeDarkStore.set,\n         themeLight: themeLightStore.set\n      };\n\n      const observer = new MutationObserver(() =>\n      {\n         if (document.body.classList.contains('theme-light'))\n         {\n            this.#theme = 'theme-light';\n\n            this.#storeSet.themeDark(false);\n            this.#storeSet.themeLight(true);\n         }\n         else if (document.body.classList.contains('theme-dark'))\n         {\n            this.#theme = 'theme-dark';\n\n            this.#storeSet.themeDark(true);\n            this.#storeSet.themeLight(false);\n         }\n\n         this.#storeSet.theme(this.#theme);\n      });\n\n      // Only listen for class changes.\n      observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });\n   }\n}\n\n/**\n * Provides storage for all dialog options through individual accessors and `get`, `merge`, `replace` and `set` methods\n * that safely access and update data changed to the mounted DialogShell component reactively.\n */\nclass TJSDialogData\n{\n   /**\n    * @type {import('../../index.js').SvelteApp}\n    */\n   #application;\n\n   /**\n    * Stores the dialog options data.\n    *\n    * @type {import('./types').TJSDialog.OptionsData}\n    */\n   #internal = {};\n\n   /**\n    * @param {import('../../index.js').SvelteApp} application - The host Foundry application.\n    */\n   constructor(application)\n   {\n      this.#application = application;\n\n      Object.seal(this);\n   }\n\n   /**\n    * @returns {{ [key: string]: import('./types').TJSDialogButtonData }} The dialog button configuration.\n    */\n   get buttons()\n   {\n      return this.#internal.buttons;\n   }\n\n   /**\n    * Set the dialog button configuration.\n    *\n    * @param {string} buttons - New dialog button configuration.\n    */\n   set buttons(buttons)\n   {\n      this.#internal.buttons = buttons;\n      this.#updateComponent();\n   }\n\n   /**\n    * @returns {import('@typhonjs-fvtt/runtime/svelte/util').TJSSvelte.Config.Minimal | string} The Svelte configuration object or HTML string\n    *          content.\n    */\n   get content()\n   {\n      return this.#internal.content;\n   }\n\n   /**\n    * Set the Svelte configuration object or HTML string content.\n    *\n    * @param {import('@typhonjs-fvtt/runtime/svelte/util').TJSSvelte.Config.Minimal | string} content - New Svelte configuration object or\n    *        HTML string content.\n    */\n   set content(content)\n   {\n      this.#internal.content = content;\n      this.#updateComponent();\n   }\n\n   /**\n    * @returns {string} The default button ID to focus initially.\n    */\n   get default()\n   {\n      return this.#internal.default;\n   }\n\n   /**\n    * Set the default button ID to focus initially.\n    *\n    * @param {string} newDefault - New default button ID to focus initially.\n    */\n   set default(newDefault)\n   {\n      this.#internal.default = newDefault;\n      this.#updateComponent();\n   }\n\n   /**\n    * @returns {boolean} The dialog draggable state; draggable when true.\n    */\n   get draggable()\n   {\n      return this.#internal.draggable;\n   }\n\n   /**\n    * Set the dialog state; draggable when true.\n    *\n    * @param {boolean} draggable - New dialog draggable state; draggable when true.\n    */\n   set draggable(draggable)\n   {\n      this.#internal.draggable = draggable;\n      this.#updateComponent();\n   }\n\n   /**\n    * @returns {boolean} When true auto-management of app focus is enabled.\n    */\n   get focusAuto()\n   {\n      return this.#internal.focusAuto;\n   }\n\n   /**\n    * Set the dialog auto-management of app focus.\n    *\n    * @param {boolean} focusAuto - New dialog auto-management of app focus.\n    */\n   set focusAuto(focusAuto)\n   {\n      this.#internal.focusAuto = focusAuto;\n      this.#updateComponent();\n   }\n\n   /**\n    * @returns {boolean} When true the first focusable element that isn't a button is focused.\n    */\n   get focusFirst()\n   {\n      return this.#internal.focusFirst;\n   }\n\n   /**\n    * Set the dialog first focusable element state.\n    *\n    * @param {boolean} focusFirst - New dialog first focusable element state.\n    */\n   set focusFirst(focusFirst)\n   {\n      this.#internal.focusFirst = focusFirst;\n      this.#updateComponent();\n   }\n\n   /**\n    * @returns {boolean} When `focusAuto` and `focusKeep` is true; keeps internal focus.\n    */\n   get focusKeep()\n   {\n      return this.#internal.focusKeep;\n   }\n\n   /**\n    * Set the dialog `focusKeep` state. When `focusAuto` and `focusKeep` is true; keeps internal focus.\n    *\n    * @param {boolean} focusKeep - New dialog `focusKeep` state.\n    */\n   set focusKeep(focusKeep)\n   {\n      this.#internal.focusKeep = focusKeep;\n      this.#updateComponent();\n   }\n\n   /**\n    * @returns {boolean} When true the dialog is minimizable.\n    */\n   get minimizable()\n   {\n      return this.#internal.minimizable;\n   }\n\n   /**\n    * Set the dialog `minimizable` state. When true the dialog is minimizable.\n    *\n    * @param {boolean} minimizable - New dialog `minimizable` state.\n    */\n   set minimizable(minimizable)\n   {\n      this.#internal.minimizable = minimizable;\n      this.#updateComponent();\n   }\n\n   /**\n    * @returns {boolean} When true a modal dialog is displayed.\n    */\n   get modal()\n   {\n      return this.#internal.modal;\n   }\n\n   /**\n    * Set the dialog `modal` state. When true a modal dialog is displayed.\n    *\n    * @param {boolean} modal - New dialog `modal` state.\n    */\n   set modal(modal)\n   {\n      this.#internal.modal = modal;\n      this.#updateComponent();\n   }\n\n   /**\n    * @returns {import('./types').TJSDialog.OptionsModal} Additional options for modal dialog display.\n    */\n   get modalOptions()\n   {\n      return this.#internal.modalOptions;\n   }\n\n   /**\n    * Set additional options for modal dialog display.\n    *\n    * @param {import('./types').TJSDialog.OptionsModal} modalOptions - New additional options for modal dialog display.\n    */\n   set modalOptions(modalOptions)\n   {\n      this.#internal.modalOptions = modalOptions;\n      this.#updateComponent();\n   }\n\n   /**\n    * @returns {boolean} When true and an error is raised in dialog callback functions post a UI error notification.\n    */\n   get notifyError()\n   {\n      return this.#internal.notifyError;\n   }\n\n   /**\n    * Set the dialog `notifyError` state. When true and an error is raised in dialog callback functions post a UI error\n    * notification.\n    *\n    * @param {boolean} notifyError - New dialog `notifyError` state.\n    */\n   set notifyError(notifyError)\n   {\n      this.#internal.notifyError = notifyError;\n      this.#updateComponent();\n   }\n\n   /**\n    * @returns {string | ((data?: { application?: import('../../index.js').TJSDialog }) => any)} Callback invoked when\n    *          dialog is closed; no button option selected. When defined as a string any matching function by name\n    *          exported from content Svelte component is invoked.\n    */\n   get onClose()\n   {\n      return this.#internal.onClose;\n   }\n\n   /**\n    * Set callback invoked when dialog is closed; no button option selected. When defined as a string any matching\n    * function by name exported from content Svelte component is invoked..\n    *\n    * @param {string | ((data?: { application?: import('../../index.js').TJSDialog }) => any)} onClose - New dialog\n    *        `onClose` state.\n    */\n   set onClose(onClose)\n   {\n      this.#internal.onClose = onClose;\n      this.#updateComponent();\n   }\n\n   /**\n    * @returns {boolean} Dialog `rejectClose` state. When true and a Promise has been created by {@link TJSDialog.wait}\n    *          and the Promise is not in the process of being resolved or rejected on close of the dialog any `onClose`\n    *          function is invoked and any result that is undefined will cause the Promise to then be rejected..\n    */\n   get rejectClose()\n   {\n      return this.#internal.rejectClose;\n   }\n\n   /**\n    * Set the dialog `rejectClose` state.\n    *\n    * @param {boolean} rejectClose - New dialog `rejectClose` state.\n    */\n   set rejectClose(rejectClose)\n   {\n      this.#internal.rejectClose = rejectClose;\n      this.#updateComponent();\n   }\n\n   /**\n    * @returns {boolean} When true the dialog is resizable.\n    */\n   get resizable()\n   {\n      return this.#internal.resizable;\n   }\n\n   /**\n    * Set the dialog `resizable` state. When true the dialog is resizable.\n    *\n    * @param {boolean} resizable - New dialog `resizable` state.\n    */\n   set resizable(resizable)\n   {\n      this.#internal.resizable = resizable;\n      this.#updateComponent();\n   }\n\n   /**\n    * @returns {boolean} When true and resolving any Promises and there are undefined results from any button callbacks\n    *          the button ID is resolved.\n    */\n   get resolveId()\n   {\n      return this.#internal.resolveId;\n   }\n\n   /**\n    * Set the dialog `resolveId` state. When true and resolving any Promises and there are undefined results from any\n    * button callbacks the button ID is resolved.\n    *\n    * @param {boolean} resolveId - New dialog `resolveId` state.\n    */\n   set resolveId(resolveId)\n   {\n      this.#internal.resolveId = resolveId;\n      this.#updateComponent();\n   }\n\n   /**\n    * @returns {string} The dialog window title.\n    */\n   get title()\n   {\n      return this.#internal.title;\n   }\n\n   /**\n    * Set the dialog window title.\n    *\n    * @param {string} title - New dialog window title.\n    */\n   set title(title)\n   {\n      this.#internal.title = title;\n      this.#updateComponent();\n   }\n\n   /**\n    * @returns {import('./types').TJSDialog.OptionsTransition} Transition options for the dialog.\n    */\n   get transition()\n   {\n      return this.#internal.transition;\n   }\n\n   /**\n    * Set transition options for the dialog.\n    *\n    * @param {import('./types').TJSDialog.OptionsTransition} transition - New transition options for the dialog.\n    */\n   set transition(transition)\n   {\n      this.#internal.transition = transition;\n      this.#updateComponent();\n   }\n\n   /**\n    * @returns {number | null} A specific z-index for the dialog. Pass null for the dialog to act like other\n    *          applications in regard bringing to top when activated.\n    */\n   get zIndex()\n   {\n      return this.#internal.zIndex;\n   }\n\n   /**\n    * Set specific z-index for the dialog.\n    *\n    * @param {number | null} zIndex - New z-index for the dialog.\n    */\n   set zIndex(zIndex)\n   {\n      this.#internal.zIndex = zIndex;\n      this.#updateComponent();\n   }\n\n   /**\n    * Provides a cloned copy of the dialog data.\n    * Note: The content attribute is not cloned as complex / props may be present.\n    *\n    * @returns {import('./types').TJSDialog.OptionsData} A clone of the dialog data.\n    */\n   clone()\n   {\n      // Make a shallow copy of internally stored data.\n      const shallowCopy = { ...this.#internal };\n\n      // Remove the content parameter as it may contain complex props sent to the hosted dialog component.\n      delete shallowCopy.content;\n\n      // Clone the internal data and then set the content directly.\n      const cData = klona(shallowCopy);\n      cData.content = this.#internal.content;\n\n      return cData;\n   }\n\n   /**\n    * Provides a way to safely get this dialogs data given an accessor string which describes the\n    * entries to walk. To access deeper entries into the object format the accessor string with `.` between entries\n    * to walk.\n    *\n    * @param {string}   accessor - The path / key to set. You can set multiple levels.\n    *\n    * @param {any}      [defaultValue] - A default value returned if the accessor is not found.\n    *\n    * @returns {any} Value at the accessor.\n    */\n   get(accessor, defaultValue)\n   {\n      return safeAccess(this.#internal, accessor, defaultValue);\n   }\n\n   /**\n    * @param {import('./types').TJSDialog.OptionsData} data - Merge provided data object into Dialog data.\n    */\n   merge(data)\n   {\n      deepMerge(this.#internal, data);\n      this.#updateComponent();\n   }\n\n   /**\n    * Sets the dialog data; this is reactive.\n    *\n    * @param {import('./types').TJSDialog.OptionsData}   data - Dialog data.\n    */\n   replace(data)\n   {\n      if (!isObject(data)) { throw new TypeError(`TJSDialogData replace error: 'data' is not an object'.`); }\n\n      this.#internal = {};\n\n      // Merge new data and perform a reactive update.\n      this.merge(data);\n   }\n\n   /**\n    * Provides a way to safely set this dialogs data given an accessor string which describes the\n    * entries to walk. To access deeper entries into the object format the accessor string with `.` between entries\n    * to walk.\n    *\n    * Automatically the dialog data will be updated in the associated DialogShell Svelte component.\n    *\n    * @param {string}   accessor - The path / key to set. You can set multiple levels.\n    *\n    * @param {any}      value - Value to set.\n    *\n    * @returns {boolean} True if successful.\n    */\n   set(accessor, value)\n   {\n      const success = safeSet(this.#internal, accessor, value, { createMissing: true });\n\n      // If `this.#internal` modified then update the app options store.\n      if (success) { this.#updateComponent(); }\n\n      return success;\n   }\n\n   /**\n    * Updates the data in the Svelte dialog component.\n    */\n   #updateComponent()\n   {\n      const component = this.#application.svelte.appShell;\n      if (component?.data) { component.data = this.clone(); }\n   }\n}\n\n/**\n * Provides a reactive dialog implementation configured from a unique dialog options object. The dialog features a\n * bottom button bar for user selection.\n *\n * A glasspane / modal option with various styling and transition capabilities is available when setting `modal: true`.\n *\n * Most importantly the `content` attribute of dialog data can be a Svelte component configuration object to render\n * your custom component as the dialog content. When using a Svelte component as the content you can assign a string\n * to the various `on<XXX>` dialog callbacks and an exported function from your component will be invoked to handle the\n * button callback. All dialog button callbacks and `onClose` callback receive a single argument which is the dialog /\n * application instance.\n *\n * When making a form with form validation or other dialog that you don't want to close immediately on button press you\n * can set `autoClose: false`, however you are 100% in control of resolving any Promise callbacks from button presses\n * and also closing the application. Each button can also be configured with `autoClose: false` in the button data.\n *\n * There is a handy Promise management capability to track a single Promise for the lifetime of a dialog available\n * at {@link TJSDialog.managedPromise}. By default when the user closes the dialog / application any managed Promise is\n * resolved with `null`. The managed Promise is available in any Svelte content component by using\n * `const managedPromise = getContext('#managedPromise')`. When handling any custom resolution particularly when\n * setting `autoClose: false` for a given button you are 100% in control of resolving or rejecting asynchronous data to\n * return from the dialog.\n *\n * To create and wait upon a managed promise for asynchronous return results use the static or member variation of\n * {@link TJSDialog.wait}.\n *\n * Please refer to {@link TJSDialog.OptionsData} for the various options used to construct the dialog.\n *\n * There are a couple of static helper methods to quickly create standard dialogs such as a 'yes' / 'no' confirmation\n * dialog with {@link TJSDialog.confirm} and an 'ok' single button dialog with {@link TJSDialog.prompt}.\n */\nclass TJSDialog extends SvelteApp\n{\n   /** @type {TJSDialogData} */\n   #data;\n\n   /** @type {ManagedPromise} */\n   #managedPromise;\n\n   /**\n    * @param {import('./internal/state-dialog/types').TJSDialog.OptionsData} data - Dialog options.\n    *\n    * @param {import('./types').SvelteApp.OptionsCore}   [options] - SvelteApp options.\n    */\n   constructor(data, options = {})\n   {\n      // Note: explicit setting of `popOutModuleDisable` to prevent the PopOut! module from acting on modal dialogs.\n      // @ts-expect-error\n      super({\n         popOutModuleDisable: typeof data?.modal === 'boolean' ? data.modal : false,\n         ...options,\n\n         // Always ensure adding `dialog` class for core styles.\n         classes: Array.isArray(options.classes) ? [...options.classes, 'dialog'] : ['dialog']\n      });\n\n      this.#managedPromise = new ManagedPromise();\n\n      this.#data = new TJSDialogData(this);\n      this.#data.replace(data);\n   }\n\n   /**\n    * Default options for TJSDialog. Provides a default width and setting `height` to `auto` to always display dialog\n    * content even if it changes. The default `DialogShell` / `svelte` options should not be changed and instead mount\n    * the dialog content component by supplying a Svelte configuration object to dialog data `content` field.\n    *\n    * @returns {import('./types').SvelteApp.Options} Default options\n    */\n   static get defaultOptions()\n   {\n      return /** @type {import('./types').SvelteApp.Options} */ deepMerge(super.defaultOptions, {\n         classes: ['dialog', 'tjs-dialog'],\n         width: 400,\n         height: 'auto',\n         svelte: {\n            class: DialogShell,\n            intro: true,\n            target: document.body,\n            /**\n             * `this` is the TJSDialog instance when invoked.\n             *\n             * @this {TJSDialog}\n             *\n             * @returns {{data: import('./types').TJSDialog.OptionsData, managedPromise: ManagedPromise}} Props\n             */\n            props: function()\n            {\n               return {\n                  data: this.#data.clone(),\n                  managedPromise: this.#managedPromise\n               };\n            }\n         }\n      });\n   }\n\n   /**\n    * Returns the dialog data.\n    *\n    * @returns {import('./internal/state-dialog/types').TJSDialog.Data} Dialog data.\n    */\n   get data() { return this.#data; }\n\n   /**\n    * @returns {import('@typhonjs-fvtt/runtime/util/async').ManagedPromise} Returns the managed promise.\n    */\n   get managedPromise() { return this.#managedPromise; }\n\n   /**\n    * Close the dialog and un-register references to it within UI mappings.\n    * This function returns a Promise which resolves once the window closing animation concludes.\n    *\n    * @param {object}   [options] - Optional parameters.\n    *\n    * @param {boolean}  [options.force] - Force close regardless of render state.\n    *\n    * @returns {Promise<void>} A Promise which resolves once the application is closed with the callback value or\n    *                          `true`.\n    */\n   async close(options)\n   {\n      try\n      {\n         // Note: When handling a managed promise if a button selection has already been made the managed promise is\n         // already processing and the resolution below is skipped.\n         if (this.#managedPromise.isActive && !this.#managedPromise.isProcessing)\n         {\n            const result = TJSDialog.#invokeFn(this.#data.onClose, this, null);\n            const rejectClose = typeof this.#data.rejectClose === 'boolean' ? this.#data.rejectClose : false;\n\n            if (rejectClose && result === null)\n            {\n               this.#managedPromise.reject(new Error('TJSDialog was closed without a choice being made.'));\n            }\n            else\n            {\n               this.#managedPromise.resolve(result);\n            }\n         }\n      }\n      catch (err)\n      {\n         const notifyError = typeof this.#data.notifyError === 'boolean' ? this.#data.notifyError : true;\n         if (notifyError)\n         {\n            // TODO: When app eventbus is available send event for UI notification instead of Foundry API usage.\n            globalThis.ui.notifications.error(err, { console: false });\n         }\n\n         // If there is a managed Promise reject it or re-throw error.\n         if (!this.#managedPromise.reject(err)) { throw err; }\n      }\n      finally\n      {\n         await super.close(options);\n      }\n   }\n\n   /**\n    * Brings to top or renders this dialog returning a Promise that is resolved any button pressed or when the dialog\n    * is closed.\n    *\n    * Creates an anonymous data defined TJSDialog returning a Promise that can be awaited upon for the user to make a\n    * choice.\n    *\n    * Note: `null` is returned if the dialog is closed without a user making a choice.\n    *\n    * @template T\n    *\n    * @param {object}   [options] - Options.\n    *\n    * @param {boolean}  [options.reuse=false] - When true if there is an existing managed Promise this allows multiple\n    *        sources to await on the same result.\n    *\n    * @returns {Promise<T>} A promise for dialog resolution.\n    */\n   async wait(options)\n   {\n      // TODO: Direct usage of Foundry core Application API.\n      if (this.rendered)\n      {\n         this.bringToTop();\n      }\n      else\n      {\n         this.render(true, { focus: true });\n      }\n\n      // Return a managed Promise which is automatically resolved on button press via `DialogContent` component or when\n      // the dialog is closed.\n      return this.#managedPromise.create(options);\n   }\n\n   // ---------------------------------------------------------------------------------------------------------------\n\n   /**\n    * A helper factory method to create simple confirmation dialog windows which consist of simple yes / no prompts.\n    * If you require more flexibility, a custom TJSDialog instance is preferred. The default focused button is 'yes'.\n    * You can change the default focused button by setting `default` to `yes` or `no`.\n    *\n    * @template T\n    *\n    * @param {import('./internal/state-dialog/types').TJSDialog.OptionsData & {\n    *    onYes?: string | ((data?: { application?: TJSDialog }) => any),\n    *    onNo?: string | ((data?: { application?: TJSDialog }) => any)\n    * }} [data] - Confirm dialog options.\n    *\n    * @param {string|((data?: { application?: TJSDialog }) => any)} [data.onYes] - Callback function upon `yes`; may be\n    *        an async function. When defined as a string any matching function by name exported from content Svelte\n    *        component is invoked.\n    *\n    * @param {string|((data?: { application?: TJSDialog }) => any)} [data.onNo] - Callback function upon `no`; may be an\n    *        async function. When defined as a string any matching function by name exported from content Svelte\n    *        component is invoked.\n    *\n    * @param {import('./types').SvelteApp.OptionsCore}  [options]  SvelteApp options passed to the\n    *        TJSDialog constructor.\n    *\n    * @returns {Promise<T>} A promise which resolves with result of yes / no callbacks or true / false.\n    *\n    * @example\n    * const result = await TJSDialog.confirm({\n    *  title: 'A Yes or No Question',\n    *  content: '<p>Choose wisely.</p>',\n    *  onYes: () => 'YES Result',\n    *  onNo: () => 'NO Result'\n    * });\n    *\n    * // Logs 'YES result', 'NO Result', or null if the user closed the dialog without making a selection.\n    * console.log(result);\n    */\n   static async confirm({ onYes, onNo, ...data } = {}, options = {})\n   {\n      // Allow overwriting of default icon and labels.\n      const mergedButtons = deepMerge({\n         yes: {\n            icon: 'fas fa-check',\n            label: 'Yes'\n         },\n         no: {\n            icon: 'fas fa-times',\n            label: 'No',\n         }\n      }, data.buttons ?? {});\n\n      return this.wait({\n         ...data,\n         buttons: deepMerge(mergedButtons, {\n            yes: {\n               onPress: ({ application }) => this.#invokeFn(onYes, application, true)\n            },\n            no: {\n               onPress: ({ application }) => this.#invokeFn(onNo, application, false)\n            }\n         }),\n         default: data.default ?? 'yes'\n      }, options);\n   }\n\n   /**\n    * A helper method to invoke a callback function directly or lookup an exported function with the same name from any\n    * content Svelte component to invoke. This is used internally to apply default values for `confirm` and `prompt`.\n    *\n    * @param {string|((data?: { application?: TJSDialog }) => any)} callback - Callback function to invoke; may be an\n    *        async function. When defined as a string any matching function by name exported from content Svelte\n    *        component is invoked.\n    *\n    * @param {TJSDialog} application - TJSDialog instance passed to callback.\n    *\n    * @param {*} [defaultResult] - An optional default result to return; undefined if not specified.\n    *\n    * @returns {*} Result.\n    *\n    * @internal\n    */\n   static #invokeFn(callback, application, defaultResult = void 0)\n   {\n      let result = defaultResult;\n\n      switch (typeof callback)\n      {\n         case 'function':\n            // Pass the dialog instance to the callback.\n            result = callback({ application });\n            break;\n\n         case 'string':\n         {\n            const dialogComponent = application?.svelte?.appShell?.dialogComponent;\n\n            // Attempt lookup by function name in dialog instance component.\n            if (dialogComponent !== void 0 && typeof dialogComponent?.[callback] === 'function')\n            {\n               result = dialogComponent?.[callback]({ application });\n            }\n            else\n            {\n               if (dialogComponent === void 0)\n               {\n                  console.warn(`[TRL] TJSDialog warning: 'onPress' defined as a string with no ` +\n                   `associated content Svelte component.`);\n               }\n               else if (typeof dialogComponent?.[callback] !== 'function')\n               {\n                  console.warn(`[TRL] TJSDialog warning: The content Svelte component does not contain ` +\n                   `an associated function '${callback}'. Did you remember to add ` +\n                   `'<svelte:options accessors={true} />' and export the function?`);\n               }\n            }\n            break;\n         }\n      }\n\n      return result;\n   }\n\n   /**\n    * A helper factory method to display a basic \"prompt\" style TJSDialog with a single button.\n    *\n    * @template T\n    *\n    * @param {import('./internal/state-dialog/types').TJSDialog.OptionsData & {\n    *    onOk?: string | ((data?: { application?: TJSDialog }) => any),\n    *    label?: string,\n    *    icon?: string\n    * }} [data] - Prompt dialog options that includes any TJSDialog options along with the following optional fields:\n    *\n    * @param {string|((data?: { application?: TJSDialog }) => any)} [data.onOk] - Callback function upon `ok`; may be\n    *        an async function. When defined as a string any matching function by name exported from content Svelte\n    *        component is invoked.\n    *\n    * @param {string}   [data.label] - The OK prompt button text.\n    *\n    * @param {string}   [data.icon=\"fas fa-check\"] - Set another icon besides `fas fa-check` for button.\n    *\n    * @param {import('./types').SvelteApp.OptionsCore}  [options]  SvelteApp options passed to the\n    *        TJSDialog constructor.\n    *\n    * @returns {Promise<T>} The returned value from the provided callback function or `true` if the button\n    *          is pressed.\n    *\n    * @example\n    * const result = await TJSDialog.prompt({\n    *  title: 'Are you OK?',\n    *  content: '<p>Are you OK?.</p>',\n    *  label: 'Feeling Fine!',\n    *  onOk: () => 'OK'\n    * });\n    *\n    * // Logs 'OK' or null if the user closed the dialog without making a selection.\n    * console.log(result);\n    */\n   static async prompt({ onOk, label, icon = 'fas fa-check', ...data } = {}, options = {})\n   {\n      return this.wait({\n         ...data,\n         buttons: {\n            ok: {\n               icon,\n               label,\n               onPress: ({ application }) => this.#invokeFn(onOk, application, true)\n            }\n         },\n         default: 'ok'\n      }, options);\n   }\n\n   /**\n    * Creates an anonymous data defined TJSDialog returning a Promise that can be awaited upon for the user to make a\n    * choice.\n    *\n    * Note: By default `null` is returned if the dialog is closed without a user making a choice.\n    *\n    * @template T\n    *\n    * @param {import('./internal/state-dialog/types').TJSDialog.OptionsData}  data - Dialog data passed to the\n    *        TJSDialog constructor.\n    *\n    * @param {import('./types').SvelteApp.OptionsCore}  [options]  SvelteApp options passed to the\n    *        TJSDialog constructor.\n    *\n    * @returns {Promise<T>} A Promise that resolves to the chosen result.\n    */\n   static async wait(data, options = {})\n   {\n      if (!isObject(data)) { throw new TypeError(`TJSDialog.wait error: 'data' is not an object'.`); }\n\n      // Instantiate and render the dialog.\n      return new this({ ...data }, options).wait();\n   }\n}\n\n// Initialize core theme observation / changes.\nThemeObserver.initialize();\n\n// Handle `hotReload` Foundry hook when running the Vite dev server.\nif (import.meta.hot) { FoundryHMRSupport.initialize(); }\n\n// Handle `PopOut!` module hooks to allow applications to popout to their own browser window.\nPopoutSupport.initialize();\n\nexport { SvelteApp, SvelteApp as SvelteApplication, TJSDialog, ThemeObserver };\n//# sourceMappingURL=index.js.map\n","import { linear } from 'svelte/easing';\nimport { lerp } from '@typhonjs-fvtt/runtime/math/interpolate';\nimport { getEasingFunc } from '@typhonjs-fvtt/runtime/svelte/easing';\nimport { fade, slide } from 'svelte/transition';\n\n/**\r\n * Provides a rotate transition. For options `easing` is applied to the rotate transition. The default easing is\r\n * linear.\r\n *\r\n * Note: that when reversing the transition that time goes from `1 - 0`, so if specific options are applied for\r\n * rotating out transition then `end` and `initial` are swapped.\r\n *\r\n * @param {HTMLElement} node - The transition node.\r\n *\r\n * @param {object}      [options] - Optional parameters.\r\n *\r\n * @param {number}      [options.delay] - Delay in ms before start of transition.\r\n *\r\n * @param {number}      [options.duration] - Total transition length in ms.\r\n *\r\n * @param {import('#runtime/svelte/easing').EasingReference}   [options.easing='linear'] - Easing function name or\r\n *        function to apply to the rotate transition.\r\n *\r\n * @param {number}      [options.end=0] - End rotation in degrees.\r\n *\r\n * @param {number}      [options.initial=0] - Initial rotation in degrees.\r\n *\r\n * @returns {import('svelte/transition').TransitionConfig} Transition config.\r\n */\r\nfunction rotate(node, options)\r\n{\r\n   const easingRotate = getEasingFunc(options.easing);\r\n\r\n   const initialDeg = options.initial ?? 0;\r\n   const endDeg = options.end ?? 0;\r\n\r\n   return {\r\n      delay: options.delay ?? 0,\r\n      duration: options.duration ?? 500,\r\n      easing: linear,\r\n      css: (t) =>\r\n      {\r\n         const rotateT = easingRotate(t);\r\n         return `transform: rotate(${lerp(initialDeg, endDeg, rotateT)}deg)`;\r\n      }\r\n   };\r\n}\n\n/**\r\n * Combines rotate & fade transitions into a single transition. For options `easing` this is applied to both\r\n * transitions, however if provided `easingRotate` and / or `easingFade` will take precedence. The default easing is\r\n * linear.\r\n *\r\n * Note: that when reversing the transition that time goes from `1 - 0`, so if specific options are applied for\r\n * rotating out transition then `end` and `initial` are swapped.\r\n *\r\n * @param {HTMLElement} node - The transition node.\r\n *\r\n * @param {object}      [options] - Optional parameters.\r\n *\r\n * @param {number}      [options.delay] - Delay in ms before start of transition.\r\n *\r\n * @param {number}      [options.duration] - Total transition length in ms.\r\n *\r\n * @param {import('#runtime/svelte/easing').EasingReference}   [options.easing='linear'] - Easing function name or\r\n *        function to apply to both slide & fade transitions.\r\n *\r\n * @param {import('#runtime/svelte/easing').EasingReference}   [options.easingFade='linear'] - Easing function name or\r\n *        function to apply to the fade transition.\r\n *\r\n * @param {import('#runtime/svelte/easing').EasingReference}   [options.easingRotate='linear'] - Easing function name or\r\n *        function to apply to the rotate transition.\r\n *\r\n * @param {number}      [options.end=0] - End rotation in degrees.\r\n *\r\n * @param {number}      [options.initial=0] - Initial rotation in degrees.\r\n *\r\n * @returns {import('svelte/transition').TransitionConfig} Transition config.\r\n */\r\nfunction rotateFade(node, options)\r\n{\r\n   const easingFade = getEasingFunc(options.easingFade ?? options.easing);\r\n   const easingRotate = getEasingFunc(options.easingRotate ?? options.easing);\r\n\r\n   const fadeTransition = fade(node);\r\n\r\n   const initialDeg = options.initial ?? 0;\r\n   const endDeg = options.end ?? 0;\r\n\r\n   return {\r\n      delay: options.delay ?? 0,\r\n      duration: options.duration ?? 500,\r\n      easing: linear,\r\n      css: (t) =>\r\n      {\r\n         const fadeT = easingFade(t);\r\n         const rotateT = easingRotate(t);\r\n\r\n         return `transform: rotate(${lerp(initialDeg, endDeg, rotateT)}deg); ${fadeTransition.css(fadeT, 1 - fadeT)}`;\r\n      }\r\n   };\r\n}\n\n/**\r\n * Combines slide & fade transitions into a single transition. For options `easing` this is applied to both transitions,\r\n * however if provided `easingSlide` and / or `easingFade` will take precedence. The default easing is linear.\r\n *\r\n * @param {HTMLElement} node - The transition node.\r\n *\r\n * @param {object}      [options] - Optional parameters.\r\n *\r\n * @param {'x' | 'y'}   [options.axis] - The sliding axis.\r\n *\r\n * @param {number}      [options.delay] - Delay in ms before start of transition.\r\n *\r\n * @param {number}      [options.duration] - Total transition length in ms.\r\n *\r\n * @param {import('#runtime/svelte/easing').EasingReference}   [options.easing=linear] - Easing function name or\r\n *        function to apply to both slide & fade transitions.\r\n *\r\n * @param {import('#runtime/svelte/easing').EasingReference}   [options.easingFade=linear] - Easing function name or\r\n *        function to apply to the fade transition.\r\n *\r\n * @param {import('#runtime/svelte/easing').EasingReference}   [options.easingSlide=linear] - Easing function name or\r\n *        function to apply to the slide transition.\r\n *\r\n * @returns {import('svelte/transition').TransitionConfig} Transition config.\r\n */\r\nfunction slideFade(node, options)\r\n{\r\n   const fadeEasing = getEasingFunc(options.easingFade ?? options.easing);\r\n   const slideEasing = getEasingFunc(options.easingSlide ?? options.easing);\r\n\r\n   const fadeTransition = fade(node);\r\n   const slideTransition = slide(node, { axis: options.axis });\r\n\r\n   return {\r\n      delay: options.delay ?? 0,\r\n      duration: options.duration ?? 500,\r\n      easing: linear,\r\n      css: (t) =>\r\n      {\r\n         const fadeT = fadeEasing(t);\r\n         const slideT = slideEasing(t);\r\n         return `${slideTransition.css(slideT, 1 - slideT)}; ${fadeTransition.css(fadeT, 1 - fadeT)}`;\r\n      }\r\n   };\r\n}\n\n/**\r\n * Converts a Svelte transition to an animation. Both transitions & animations use the same CSS / styles solution and\r\n * resulting data so wrap the transition function with the signature of an animation.\r\n *\r\n * @param {(node: Element, ...rest: any[]) => import('svelte/transition').TransitionConfig} fn -\r\n *        A Svelte transition function.\r\n *\r\n * @returns {(\r\n *    node: Element,\r\n *    data: { from: DOMRect, to: DOMRect },\r\n *    ...rest: any\r\n * ) => import('svelte/animation').AnimationConfig} - Transition function converted to an animation.\r\n */\r\nfunction toAnimation(fn)\r\n{\r\n   return (node, animations, ...rest) => fn(node, ...rest);\r\n}\n\n/**\r\n * Provides static data useful for handling custom props / options to components that allow dynamic configuration of\r\n * transitions. This is used in all application shells and components that have configurable transitions.\r\n *\r\n * @ignore\r\n */\r\nclass TJSDefaultTransition\r\n{\r\n   static #options = {};\r\n\r\n   static #default = () => void 0;\r\n\r\n   /**\r\n    * @returns {() => undefined} Default empty transition.\r\n    */\r\n   static get default() { return this.#default; }\r\n\r\n   /**\r\n    * @returns {{}} Default empty options.\r\n    */\r\n   static get options() { return this.#options; }\r\n}\n\nexport { TJSDefaultTransition, rotate, rotateFade, slideFade, toAnimation };\n//# sourceMappingURL=index.js.map\n","import { writable } from 'svelte/store';\r\n\r\n/**\r\n * Provides the internal context to all application shells.\r\n *\r\n * @implements {import('./types').AppShell.Context.Internal}\r\n *\r\n * @internal\r\n */\r\nexport class AppShellContextInternal\r\n{\r\n   /** @type {import('./types').AppShell.Context.Internal.stores} */\r\n   #stores;\r\n\r\n   constructor()\r\n   {\r\n      this.#stores = {\r\n         elementContent: writable(void 0),\r\n         elementRoot: writable(void 0)\r\n      };\r\n\r\n      Object.freeze(this.#stores);\r\n      Object.seal(this);\r\n   }\r\n\r\n   /**\r\n    * @returns {import('./types').AppShell.Context.Internal.stores} The internal context stores for `elementContent` /\r\n    *          `elementRoot`\r\n    */\r\n   get stores()\r\n   {\r\n      return this.#stores;\r\n   }\r\n}\r\n","<script>\r\n   /**\r\n    * Provides an app header button conforming to the {@link SvelteAppNS.HeaderButton} type.\r\n    * Additionally, a `title` field is supported to give a tool tip for the button. For backward compatibility\r\n    * `onclick` is supported, but for uniformity across TRL defining an `onPress` function is recommended. If defined\r\n    * it is invoked when the button is clicked or `Enter` key pressed and state is updated accordingly.\r\n    *\r\n    * TRL also supports the following extra button data:\r\n    *\r\n    * - {keyCode='Enter'}           keyCode: A string conforming to `KeyboardEvent.code` to activate `onPress` callback.\r\n    *\r\n    * - {keepMinimized=false}       keepMinimized: When true the button is not removed when app minimized.\r\n    *\r\n    * - {Function}                  onContextMenu: Invoked when right mouse button or contextmenu key is pressed.\r\n    *\r\n    * - {Function}                  onPress: Invoked when left mouse button or `keyCode` key is pressed.\r\n    *\r\n    * - {{ [key: string]: string | null }}   styles: Additional inline styles to apply to button.\r\n    *\r\n    * @componentDocumentation\r\n    * @internal\r\n    */\r\n   import { applyStyles }   from '@typhonjs-fvtt/runtime/svelte/action/dom/style';\r\n   import { localize }      from '@typhonjs-fvtt/runtime/util/i18n';\r\n   import { isObject }      from '@typhonjs-fvtt/runtime/util/object';\r\n\r\n   export let button = void 0;\r\n\r\n   export let storeHeaderButtonNoLabel = void 0;\r\n\r\n   $: icon = isObject(button) && typeof button.icon === 'string' ? button.icon : void 0;\r\n\r\n   $: label = isObject(button) && typeof button.label === 'string' ? localize(button.label) : void 0;\r\n\r\n   $: keepMinimized = isObject(button) && typeof button.keepMinimized === 'boolean' ? button.keepMinimized : false;\r\n\r\n   $: keyCode = isObject(button) && typeof button.keyCode === 'string' ? button.keyCode : 'Enter';\r\n\r\n   $: styles = isObject(button) && isObject(button.styles) ? button.styles : void 0;\r\n\r\n   function onClick(event)\r\n   {\r\n      // Accept `onPress or `onclick` as the function / data to invoke. `onclick` is from Foundry defined buttons.\r\n      const invoke = button?.onPress ?? button?.onclick;\r\n\r\n      if (typeof invoke === 'function')\r\n      {\r\n         invoke({ button, event });\r\n         button = button; // This provides a reactive update if button data changes.\r\n      }\r\n   }\r\n\r\n   function onContextMenu(event)\r\n   {\r\n      if (button?.onContextMenu === 'function')\r\n      {\r\n         button.onContextMenu({ button, event });\r\n         button = button; // This provides a reactive update if button data changes.\r\n      }\r\n   }\r\n\r\n   /**\r\n    * Consume / stop propagation of key down when key codes match.\r\n    *\r\n    * @param {KeyboardEvent}    event -\r\n    */\r\n   function onKeydown(event)\r\n   {\r\n      if (event.code === keyCode)\r\n      {\r\n         event.preventDefault();\r\n         event.stopPropagation();\r\n      }\r\n   }\r\n\r\n   /**\r\n    * Handle press event if key codes match.\r\n    *\r\n    * @param {KeyboardEvent}    event -\r\n    */\r\n   function onKeyup(event)\r\n   {\r\n      if (event.code === keyCode)\r\n      {\r\n         // Accept `onPress or `onclick` as the function / data to invoke. `onclick` is from Foundry defined buttons.\r\n         const invoke = button.onPress ?? button.onclick;\r\n\r\n         if (typeof invoke === 'function')\r\n         {\r\n            invoke({ button, event });\r\n            button = button; // This provides a reactive update if button data changes.\r\n         }\r\n\r\n         event.preventDefault();\r\n         event.stopPropagation();\r\n      }\r\n   }\r\n</script>\r\n\r\n<svelte:options accessors={true}/>\r\n\r\n<button type=button\r\n   on:click|preventDefault|stopPropagation={onClick}\r\n   on:contextmenu|preventDefault|stopPropagation={onContextMenu}\r\n   on:keydown={onKeydown}\r\n   on:keyup={onKeyup}\r\n   use:applyStyles={styles}\r\n   class=\"header-control icon {icon} {button.class}\"\r\n   class:keep-minimized={keepMinimized}\r\n   data-action={button.class}\r\n   data-tooltip={$storeHeaderButtonNoLabel ? null : label}\r\n   aria-label={label}>\r\n</button>\r\n","<script>\r\n   /**\r\n    * @privateRemarks\r\n    * TODO: Add description\r\n    *\r\n    * @componentDocumentation\r\n    * @internal\r\n    */\r\n   import { getContext }         from 'svelte';\r\n\r\n   import { TJSSvelte }          from '@typhonjs-fvtt/runtime/svelte/util';\r\n   import { A11yHelper }         from '@typhonjs-fvtt/runtime/util/a11y';\r\n   import { localize }           from '@typhonjs-fvtt/runtime/util/i18n';\r\n   import { isObject }           from '@typhonjs-fvtt/runtime/util/object';\r\n\r\n   import {\r\n      draggable as dragDefault } from '@typhonjs-fvtt/runtime/svelte/store/position';\r\n\r\n   import TJSHeaderButton        from './TJSHeaderButton.svelte';\r\n\r\n   export let draggable = void 0;\r\n   export let draggableOptions = void 0;\r\n\r\n   /**\r\n    * @type {SvelteApp}\r\n    */\r\n   const application = getContext('#external')?.application;\r\n\r\n   // Focus related app options stores.\r\n   const { focusAuto, focusKeep } = application.reactive.storeAppOptions;\r\n\r\n   const { elementRoot } = getContext('#internal').stores;\r\n\r\n   const storeTitle = application.reactive.storeAppOptions.title;\r\n   const storeDraggable = application.reactive.storeAppOptions.draggable;\r\n   const storeDragging = application.reactive.storeUIState.dragging;\r\n   const storeHeaderButtons = application.reactive.storeUIState.headerButtons;\r\n   const storeHeaderButtonNoLabel = application.reactive.storeAppOptions.headerButtonNoLabel;\r\n   const storeHeaderIcon = application.reactive.storeAppOptions.headerIcon;\r\n   const storeHeaderNoTitleMinimized = application.reactive.storeAppOptions.headerNoTitleMinimized;\r\n   const storeMinimizable = application.reactive.storeAppOptions.minimizable;\r\n   const storeMinimized = application.reactive.storeUIState.minimized;\r\n\r\n   // These classes in the window header allow dragging.\r\n   const s_DRAG_TARGET_CLASSLIST = Object.freeze(['tjs-app-icon', 'tjs-window-header-spacer',\r\n    'window-header', 'window-title']);\r\n\r\n   let dragOptions;\r\n\r\n   $: draggable = typeof draggable === 'function' ? draggable : dragDefault;\r\n\r\n   // Combines external options with defaults for TJSApplicationHeader. By default, easing is turned on w/ duration of\r\n   // 0.06 seconds and cubicOut, but can be overridden by any provided `draggableOptions`. `position`, `active`, and\r\n   // `storeDragging` are always overridden by application position / stores.\r\n   $: dragOptions = Object.assign({}, { tween: true, tweenOptions: { duration: 0.06, ease: 'cubicOut' } },\r\n    isObject(draggableOptions) ? draggableOptions : {}, { position: application.position, enabled:\r\n     $storeDraggable, storeDragging, hasTargetClassList: s_DRAG_TARGET_CLASSLIST });\r\n\r\n   // ----------------------------------------------------------------------------------------------------------------\r\n\r\n   let displayHeaderTitle;\r\n\r\n   $: displayHeaderTitle = $storeHeaderNoTitleMinimized && $storeMinimized ? 'none' : null;\r\n\r\n   // ----------------------------------------------------------------------------------------------------------------\r\n\r\n   let buttonsLeft;\r\n   let buttonsRight;\r\n\r\n   $:\r\n   {\r\n      buttonsLeft = [];\r\n      buttonsRight = [];\r\n\r\n      for (const button of $storeHeaderButtons)\r\n      {\r\n         const buttonsList = typeof button?.alignLeft === 'boolean' && button?.alignLeft ? buttonsLeft : buttonsRight;\r\n\r\n         // If the button contains a TJSSvelte.Config.Minimal object in the `svelte` attribute then use it otherwise use\r\n         // `TJSHeaderButton` w/ button as props.\r\n         buttonsList.push(TJSSvelte.config.isConfigEmbed(button?.svelte) ? { ...button.svelte } :\r\n          { class: TJSHeaderButton, props: { button, storeHeaderButtonNoLabel } });\r\n      }\r\n   }\r\n\r\n   // ----------------------------------------------------------------------------------------------------------------\r\n\r\n   let mediaType = void 0;\r\n   const validExt = new Set(['jpg', 'jpeg', 'png', 'webp']);\r\n\r\n   $: if (typeof $storeHeaderIcon === 'string')\r\n   {\r\n      // Detect if header icon is an image otherwise treat as a Font Awesome icon.\r\n      const extensionMatch = $storeHeaderIcon.match(/\\.([a-z]+)$/);\r\n      const extension = extensionMatch ? extensionMatch[1].toLowerCase() : null;\r\n      mediaType = validExt.has(extension) ? 'img' : 'font';\r\n   }\r\n   else\r\n   {\r\n      mediaType = void 0;\r\n   }\r\n\r\n   // ----------------------------------------------------------------------------------------------------------------\r\n\r\n   function minimizable(node, booleanStore)\r\n   {\r\n      const callback = (event) =>\r\n      {\r\n         // Only toggle minimize state if window title or header is the event target. Also allow toggle state if the\r\n         // event target has 'keep-minimized' class.\r\n         if (event.target.classList.contains('window-title') || event.target.classList.contains('window-header') ||\r\n           event.target.classList.contains('keep-minimized'))\r\n         {\r\n            application._onToggleMinimize(event);\r\n         }\r\n      }\r\n\r\n      function activateListeners() { node.addEventListener('dblclick', callback); }\r\n      function removeListeners() { node.removeEventListener('dblclick', callback); }\r\n\r\n      if (booleanStore) { activateListeners(); }\r\n\r\n      return {\r\n         update: (booleanStore) =>  // eslint-disable-line no-shadow\r\n         {\r\n            if (booleanStore) { activateListeners(); }\r\n            else { removeListeners(); }\r\n         },\r\n\r\n         destroy: () => removeListeners()\r\n      };\r\n   }\r\n\r\n   /**\r\n    * Explicitly focus `elementRoot` if pointer event is not consumed by header buttons / components. This allows\r\n    * keyboard tab navigation to select header buttons.\r\n    *\r\n    * Note: if `focusKeep` app option store is set to true `elementRoot` is only focused if the current browser wide\r\n    * active element is not contained inside the app element.\r\n    */\r\n   function onPointerdown(event)\r\n   {\r\n      const rootEl = $elementRoot;\r\n\r\n      // Cancel any app animation in progress when dragging starts.\r\n      application.position.animate.cancel();\r\n\r\n      if ($focusAuto && A11yHelper.isFocusTarget(rootEl) && rootEl?.isConnected)\r\n      {\r\n         if ($focusKeep)\r\n         {\r\n            const activeWindow = application.reactive.activeWindow;\r\n\r\n            const focusOutside = A11yHelper.isFocusTarget(activeWindow.document.activeElement) &&\r\n             !rootEl.contains(activeWindow.document.activeElement);\r\n\r\n            // Only focus the content element if the active element is outside the app; maintaining internal focused\r\n            // element.\r\n            if (focusOutside)\r\n            {\r\n               rootEl.focus();\r\n            }\r\n            else\r\n            {\r\n               event.preventDefault();\r\n            }\r\n         }\r\n         else\r\n         {\r\n            rootEl.focus();\r\n         }\r\n      }\r\n   }\r\n</script>\r\n\r\n{#key draggable}\r\n   <header class=\"window-header flexrow\"\r\n           class:not-draggable={!$storeDraggable}\r\n           on:pointerdown={onPointerdown}\r\n           use:draggable={dragOptions}\r\n           use:minimizable={$storeMinimizable}>\r\n      {#if mediaType === 'img'}\r\n         <img class=\"tjs-app-icon keep-minimized\" src={globalThis.foundry.utils.getRoute($storeHeaderIcon)} alt=icon>\r\n      {:else if mediaType === 'font'}\r\n         <i class=\"window-icon keep-minimized {$storeHeaderIcon}\"></i>\r\n      {/if}\r\n      <h4 class=window-title style:display={displayHeaderTitle}>\r\n         {localize($storeTitle)}\r\n      </h4>\r\n      {#each buttonsLeft as button}\r\n         <svelte:component this={button.class} {...button.props} />\r\n      {/each}\r\n      <span class=\"tjs-window-header-spacer keep-minimized\"></span>\r\n      {#each buttonsRight as button}\r\n         <svelte:component this={button.class} {...button.props} />\r\n      {/each}\r\n   </header>\r\n{/key}\r\n\r\n<style>\r\n   .not-draggable {\r\n      --tjs-app-header-cursor: var(--tjs-app-header-cursor-not-draggable, default);\r\n   }\r\n\r\n   /**\r\n    * Provides a zero space element that expands to the right creating the gap between window title and left aligned\r\n    * buttons and right aligned buttons. Note the use of a negative left margin to remove the gap between elements.\r\n    */\r\n   .tjs-window-header-spacer {\r\n      flex: 0;\r\n      margin-left: calc(-1 * var(--tjs-app-header-gap, 5px));\r\n      margin-right: auto;\r\n   }\r\n\r\n   .window-header {\r\n      background: var(--tjs-app-header-background, var(--color-header-background));\r\n      cursor: var(--tjs-app-header-cursor, var(--cursor-grab));\r\n      flex: var(--tjs-app-header-flex, 0 0 var(--header-height));\r\n      gap: var(--tjs-app-header-gap, 5px);\r\n      padding: var(--tjs-app-header-padding, 0 0.5rem);\r\n      touch-action: none;\r\n   }\r\n\r\n   .window-header .tjs-app-icon {\r\n      align-self: center;\r\n      border-radius: var(--tjs-app-header-icon-border-radius, 4px);\r\n      flex: 0 0 var(--tjs-app-header-icon-width, 24px);\r\n      height: var(--tjs-app-header-icon-height, 24px);\r\n   }\r\n\r\n   .window-title {\r\n      gap: var(--tjs-app-header-gap, 5px);\r\n      max-width: fit-content;\r\n      overflow: hidden;\r\n      text-overflow: ellipsis;\r\n      white-space: nowrap;\r\n   }\r\n</style>\r\n","import { Mat4, Vec3 } from '@typhonjs-fvtt/runtime/math/gl-matrix';\r\n\r\n/**\r\n * Handles the projection of app resizing from screen to local space of the app transform for accurate resizing.\r\n */\r\nexport class ResizeHandleTransform\r\n{\r\n   /**\r\n    * Stores inverted app transform matrix.\r\n    */\r\n   static #invMat = new Mat4();\r\n\r\n   /**\r\n    * Stores converted world delta width & height change.\r\n    */\r\n   static #pDeltaLocal = new Vec3();\r\n\r\n   /**\r\n    * Stores point down in local space.\r\n    */\r\n   static #pLocalDown = new Vec3();\r\n\r\n   /**\r\n    * Stores point drag in local space.\r\n    */\r\n   static #pLocalDrag = new Vec3();\r\n\r\n   /**\r\n    * Stores point down in world space.\r\n    */\r\n   static #pScreenDown = new Vec3();\r\n\r\n   /**\r\n    * Stores point drag in world space.\r\n    */\r\n   static #pScreenDrag = new Vec3();\r\n\r\n   /**\r\n    * Compute the delta width and height in local space given the app transform matrix and initial pointer down and\r\n    * drag screen coordinates.\r\n    *\r\n    * @param {Mat4} transformMat - App transform matrix.\r\n    *\r\n    * @param {number} pScreenDownX - Pointer down X position in screen coords.\r\n    *\r\n    * @param {number} pScreenDownY - Pointer down Y position in screen coords.\r\n    *\r\n    * @param {number} pScreenDragX - Current pointer drag X position in screen coords.\r\n    *\r\n    * @param {number} pScreenDragY - Current pointer drag Y position in screen coords.\r\n    *\r\n    * @returns {Vec3} Output vector for width & height changes (x = deltaWidth, y = deltaHeight).\r\n    */\r\n   static computeDelta(transformMat, pScreenDownX, pScreenDownY, pScreenDragX, pScreenDragY)\r\n   {\r\n      // Invert the transform to go from SCREEN -> LOCAL.\r\n      Mat4.invert(this.#invMat, transformMat);\r\n\r\n      // Store screen down and drag coordinates in temp vectors.\r\n      this.#pScreenDown[0] = pScreenDownX;\r\n      this.#pScreenDown[1] = pScreenDownY;\r\n\r\n      this.#pScreenDrag[0] = pScreenDragX;\r\n      this.#pScreenDrag[1] = pScreenDragY;\r\n\r\n      // Transform both points to local space.\r\n      Vec3.transformMat4(this.#pLocalDown, this.#pScreenDown, this.#invMat);\r\n      Vec3.transformMat4(this.#pLocalDrag, this.#pScreenDrag, this.#invMat);\r\n\r\n      // Compute local delta.\r\n      this.#pDeltaLocal[0] = this.#pLocalDrag[0] - this.#pLocalDown[0];\r\n      this.#pDeltaLocal[1] = this.#pLocalDrag[1] - this.#pLocalDown[1];\r\n\r\n      return this.#pDeltaLocal;\r\n   }\r\n}\r\n","<script>\r\n   /**\r\n    * @privateRemarks\r\n    * TODO: Add description\r\n    *\r\n    * @componentDocumentation\r\n    */\r\n   import { getContext }            from 'svelte';\r\n\r\n   import { ResizeHandleTransform } from './ResizeHandleTransform.js';\r\n\r\n   export let isResizable = false;\r\n\r\n   const application = getContext('#external')?.application;\r\n\r\n   // Allows retrieval of the element root at runtime.\r\n   const storeElementRoot = getContext('#internal').stores.elementRoot;\r\n\r\n   const storeResizable = application.reactive.storeAppOptions.resizable;\r\n\r\n   const storeMinimized = application.reactive.storeUIState.minimized;\r\n   const storeResizing = application.reactive.storeUIState.resizing;\r\n\r\n   let elementResize;\r\n\r\n   $: if (elementResize)\r\n   {\r\n      // Instead of creating a derived store it is easier to use isResizable and the minimized store below.\r\n      elementResize.style.display = isResizable && !$storeMinimized ? 'block' : 'none';\r\n\r\n      // Add / remove `resizable` class from element root.\r\n      const elementRoot = $storeElementRoot;\r\n      if (elementRoot) { elementRoot.classList[isResizable ? 'add' : 'remove']('resizable'); }\r\n   }\r\n\r\n   /**\r\n    * Cancel any app animation in progress when dragging starts.\r\n    */\r\n   function onPointerdown()\r\n   {\r\n      application.position.animate.cancel();\r\n   }\r\n\r\n   /**\r\n    * Provides an action to handle resizing the application shell based on the resizable app option.\r\n    *\r\n    * @param {HTMLElement}       node - The node associated with the action.\r\n    *\r\n    * @param {object}            [opts] - Optional parameters.\r\n    *\r\n    * @param {boolean}           [opts.active=true] - A boolean value; attached to a readable store.\r\n    *\r\n    * @param {Writable<boolean>} [opts.storeResizing] - A writable store that tracks \"resizing\" state.\r\n    *\r\n    * @returns {{update: Function, destroy: Function}} The action lifecycle methods.\r\n    */\r\n   function resizable(node, { active = true, storeResizing = void 0 } = {})\r\n   {\r\n      /**\r\n       * Duplicate the app / Positionable starting position to track differences.\r\n       *\r\n       * @type {object}\r\n       */\r\n      let position = null;\r\n\r\n      /**\r\n       * Stores the current resizing state and gates the move pointer as the resizing store is not\r\n       * set until the first pointer move.\r\n       *\r\n       * @type {boolean}\r\n       */\r\n      let resizing = false;\r\n\r\n      /**\r\n       * Stores initial pointer down X in screen coordinates.\r\n       */\r\n      let pScreenDownX = 0;\r\n\r\n      /**\r\n       * Stores initial pointer down Y in screen coordinates.\r\n       */\r\n      let pScreenDownY = 0;\r\n\r\n      /**\r\n       * Remember event handlers associated with this action so they may be later unregistered.\r\n       *\r\n       * @type {Object}\r\n       */\r\n      const handlers = {\r\n         resizeDown: ['pointerdown', (e) => onResizePointerDown(e), false],\r\n         resizeMove: ['pointermove', (e) => onResizePointerMove(e), false],\r\n         resizeUp: ['pointerup', (e) => onResizePointerUp(e), false]\r\n      };\r\n\r\n      /**\r\n       * Activates listeners.\r\n       */\r\n      function activateListeners()\r\n      {\r\n         // Resize handlers\r\n         node.addEventListener(...handlers.resizeDown);\r\n\r\n         isResizable = true;\r\n\r\n         node.style.display = 'block';\r\n      }\r\n\r\n      /**\r\n       * Removes listeners.\r\n       */\r\n      function removeListeners()\r\n      {\r\n         if (typeof storeResizing?.set === 'function') { storeResizing.set(false); }\r\n\r\n         // Resize handlers\r\n         node.removeEventListener(...handlers.resizeDown);\r\n         node.removeEventListener(...handlers.resizeMove);\r\n         node.removeEventListener(...handlers.resizeUp);\r\n\r\n         node.style.display = 'none';\r\n\r\n         isResizable = false;\r\n      }\r\n\r\n      // On mount if resizable is true then activate listeners otherwise set element display to `none`.\r\n      if (active)\r\n      {\r\n         activateListeners();\r\n      }\r\n      else\r\n      {\r\n         node.style.display = 'none';\r\n      }\r\n\r\n      /**\r\n       * Handle the initial pointer down that activates resizing capture.\r\n       */\r\n      function onResizePointerDown(event)\r\n      {\r\n         event.preventDefault();\r\n\r\n         resizing = false;\r\n\r\n         // Record initial position\r\n         position = application.position.get();\r\n\r\n         if (position.height === 'auto') { position.height = $storeElementRoot.clientHeight; }\r\n         if (position.width === 'auto') { position.width = $storeElementRoot.clientWidth; }\r\n\r\n         pScreenDownX = event.clientX;\r\n         pScreenDownY = event.clientY;\r\n\r\n         // Add temporary handlers\r\n         node.addEventListener(...handlers.resizeMove);\r\n         node.addEventListener(...handlers.resizeUp);\r\n\r\n         node.setPointerCapture(event.pointerId);\r\n      }\r\n\r\n      /**\r\n       * Sets the width / height of the positionable application.\r\n       */\r\n      function onResizePointerMove(event)\r\n      {\r\n         event.preventDefault();\r\n\r\n         if (!resizing && typeof storeResizing?.set === 'function')\r\n         {\r\n            resizing = true;\r\n            storeResizing.set(true);\r\n         }\r\n\r\n         const pDeltaLocal = ResizeHandleTransform.computeDelta(application.position.transform.mat4, pScreenDownX,\r\n          pScreenDownY, event.clientX, event.clientY);\r\n\r\n         application.position.set({\r\n            width: position.width + pDeltaLocal[0],\r\n            height: position.height + pDeltaLocal[1]\r\n         });\r\n      }\r\n\r\n      /**\r\n       * Conclude the dragging behavior when the pointer is released setting the final position and\r\n       * removing listeners.\r\n       */\r\n      function onResizePointerUp(event)\r\n      {\r\n         resizing = false;\r\n         if (typeof storeResizing?.set === 'function') { storeResizing.set(false); }\r\n\r\n         event.preventDefault();\r\n         node.removeEventListener(...handlers.resizeMove);\r\n         node.removeEventListener(...handlers.resizeUp);\r\n\r\n         // TODO: Direct Foundry API access.\r\n         application?._onResize?.(event);\r\n      }\r\n\r\n      return {\r\n         update: ({ active }) =>  // eslint-disable-line no-shadow\r\n         {\r\n            if (active) { activateListeners(); }\r\n            else { removeListeners(); }\r\n         },\r\n\r\n         destroy: () => removeListeners()\r\n      };\r\n   }\r\n\r\n</script>\r\n\r\n<div class=\"window-resize-handle\"\r\n     on:pointerdown={onPointerdown}\r\n     use:resizable={{ active: $storeResizable, storeResizing }}\r\n     bind:this={elementResize}>\r\n</div>\r\n\r\n<style>\r\n   .window-resize-handle {\r\n      display: block;\r\n      position: absolute;\r\n      width: var(--tjs-app-resize-handle-width, 11px);\r\n      height: var(--tjs-app-resize-handle-height, 11px);\r\n\r\n      background: var(--tjs-app-resize-handle-background, var(--tjs-app-resize-handle-background-default));\r\n      cursor: var(--tjs-app-resize-handle-cursor, nwse-resize);\r\n      filter: var(--tjs-app-resize-handle-filter, var(--tjs-app-resize-handle-filter-default, none));\r\n      inset: var(--tjs-app-resize-handle-inset, auto 1px 1px auto);\r\n      padding: var(--tjs-app-resize-handle-padding, 0);\r\n      touch-action: none;\r\n   }\r\n</style>\r\n","<script>\n   /**\n    * Provides a component to wrap focus to the first focusable element in the given `elementRoot` prop. Place this\n    * component as the last child in `elementRoot`.\n    *\n    * @componentDocumentation\n    */\n   import { A11yHelper }    from '@typhonjs-fvtt/runtime/util/a11y';\n\n   /** @type {HTMLElement} */\n   export let elementRoot = void 0;\n\n   /** @type {boolean} */\n   export let enabled = true;\n\n   let ignoreElements, wrapEl;\n\n   $: if (wrapEl) { ignoreElements = new Set([wrapEl]); }\n\n   function onFocus()\n   {\n      // Early out if not enabled.\n      if (!enabled) { return; }\n\n      if (A11yHelper.isFocusTarget(elementRoot))\n      {\n         const firstFocusEl = A11yHelper.getFirstFocusableElement(elementRoot, ignoreElements);\n\n         if (A11yHelper.isFocusTarget(firstFocusEl) && firstFocusEl !== wrapEl)\n         {\n            firstFocusEl.focus();\n         }\n         else\n         {\n            // No focus target found, so focus elementRoot.\n            elementRoot.focus();\n         }\n      }\n   }\n</script>\n\n<!-- svelte-ignore a11y-no-noninteractive-tabindex -->\n<div bind:this={wrapEl} class=tjs-focus-wrap tabindex=0 on:focus={onFocus}></div>\n\n<style>\n    div {\n        width: 0;\n        height: 0;\n        flex: 0;\n    }\n\n    div:focus {\n        outline: none;\n    }\n</style>\n","<script>\r\n   /**\r\n    * Provides an application shell is a main top level slotted component that provides a reactive\r\n    * outer wrapper and header bar for the main content component.\r\n    *\r\n    * @componentDocumentation\r\n    */\r\n\r\n   import {\r\n      getContext,\r\n      onMount,\r\n      setContext }                     from 'svelte';\r\n\r\n   import { resizeObserver }           from '@typhonjs-fvtt/runtime/svelte/action/dom/observer';\r\n   import { applyStyles }              from '@typhonjs-fvtt/runtime/svelte/action/dom/style';\r\n   import { dynamicAction }            from '@typhonjs-fvtt/runtime/svelte/action/util';\r\n   import { ThemeObserver }            from '@typhonjs-fvtt/runtime/svelte/application';\r\n   import { TJSDefaultTransition }     from '@typhonjs-fvtt/runtime/svelte/transition';\r\n   import { A11yHelper }               from '@typhonjs-fvtt/runtime/util/a11y';\r\n   import { isObject }                 from '@typhonjs-fvtt/runtime/util/object';\r\n\r\n   import { AppShellContextInternal }  from './AppShellContextInternal.js';\r\n   import TJSApplicationHeader         from './TJSApplicationHeader.svelte';\r\n   import ResizableHandle              from './ResizableHandle.svelte';\r\n\r\n   import TJSFocusWrap                 from '../internal/dom/TJSFocusWrap.svelte';\r\n\r\n   // Bound to the content and root elements. Can be used by parent components. SvelteApplication will also\r\n   // use 'elementRoot' to set the element of the Application. You can also provide `elementContent` and\r\n   // `elementTarget`. Please see SvelteApplication lifecycle documentation.\r\n   /** @type {HTMLElement} */\r\n   export let elementContent = void 0;\r\n   /** @type {HTMLElement} */\r\n   export let elementRoot = void 0;\r\n\r\n   // Allows custom draggable implementations to be forwarded to TJSApplicationHeader.\r\n   export let draggable = void 0;\r\n   export let draggableOptions = void 0;\r\n\r\n   // The children array can be specified by a parent via prop or is read below from the external context.\r\n   // export let children = void 0;\r\n\r\n   // Explicit style overrides for the main app and content elements. Uses action `applyStyles`.\r\n   export let stylesApp = void 0;\r\n   export let stylesContent = void 0;\r\n\r\n   /**\r\n    * Application reference.\r\n    *\r\n    * @type {SvelteApp}\r\n    */\r\n   const application = getContext('#external')?.application;\r\n\r\n   // Focus related app options stores.\r\n   const { focusAuto, focusKeep, focusTrap } = application.reactive.storeAppOptions;\r\n\r\n   const { minimized } = application.reactive.storeUIState;\r\n\r\n   // Is the backing app TJSPosition instance a candidate for the `resizeObserver` action? IE `width` or `height is\r\n   // `auto` or `inherit`.\r\n   const { resizeObservable } = application.position.stores;\r\n\r\n   // ----------------------------------------------------------------------------------------------------------------\r\n\r\n   // If a parent component binds and sets `appOffsetHeight` or `appOffsetWidth` to a truthy value then the\r\n   // `resizeObserver` action is enabled on the outer application `div`. Additionally, the SvelteApplication position\r\n   // resizeObserved store is updated.\r\n   export let appOffsetHeight = false;\r\n   export let appOffsetWidth = false;\r\n\r\n   // Tracks initial state if either of the above props are truthy otherwise a null operation.\r\n   const initialAppResizeObserver = !!appOffsetHeight || !!appOffsetWidth;\r\n\r\n   /**\r\n    * Reactive statement to control any dynamic action to apply for the app resize observer. It is always enabled when\r\n    * `initialAppResizeObserver` is true or when the position store `resizeObservable` is true when app position `width`\r\n    * or `height` is `auto` or `inherit`.\r\n    *\r\n    * @type {undefined | import('@typhonjs-fvtt/runtime/svelte/action/util').DynamicActionOptions}\r\n    */\r\n   $: appResizeObserver = initialAppResizeObserver || $resizeObservable ?\r\n    { action: resizeObserver, data: resizeObservedApp } : void 0;\r\n\r\n   // ----------------------------------------------------------------------------------------------------------------\r\n\r\n   // If a parent component binds and sets `contentOffsetHeight` or `contentOffsetWidth` to true then a\r\n   // resizeObserver action is enabled on the content `section`.\r\n   export let contentOffsetHeight = false;\r\n   export let contentOffsetWidth = false;\r\n\r\n   // Set to `resizeObserver` if either of the above props are truthy otherwise a null operation.\r\n   const contentResizeObserver = !!contentOffsetHeight || !!contentOffsetWidth ? resizeObserver : () => null;\r\n\r\n   // ----------------------------------------------------------------------------------------------------------------\r\n\r\n   // Provides the internal context for data / stores of the application shell.\r\n   const internal = new AppShellContextInternal();\r\n\r\n   // Provides options to `A11yHelper.getFocusableElements` to ignore TJSFocusWrap by CSS class.\r\n   const s_IGNORE_CLASSES = { ignoreClasses: ['tjs-focus-wrap'] };\r\n\r\n   // Internal context for `elementContent` / `elementRoot` stores.\r\n   setContext('#internal', internal);\r\n\r\n   // Only update the `elementContent` store if the new `elementContent` is not null or undefined.\r\n   $: if (elementContent !== void 0 && elementContent !== null)\r\n   {\r\n      getContext('#internal').stores.elementContent.set(elementContent);\r\n   }\r\n\r\n   // Only update the `elementRoot` store if the new `elementRoot` is not null or undefined.\r\n   $: if (elementRoot !== void 0 && elementRoot !== null)\r\n   {\r\n      getContext('#internal').stores.elementRoot.set(elementRoot);\r\n   }\r\n\r\n   let focusWrapEnabled;\r\n\r\n   // Enable TJSFocusWrap component when focus trapping app option is true and app is not minimized.\r\n   $: focusWrapEnabled = $focusAuto && $focusTrap && !$minimized;\r\n\r\n   // ---------------------------------------------------------------------------------------------------------------\r\n\r\n   // The following block is somewhat complex, but allows transition options to be updated reactively during\r\n   // runtime execution.\r\n\r\n   // Exports properties to set a transition w/ in / out options.\r\n   export let transition = TJSDefaultTransition.default;\r\n   export let inTransition = TJSDefaultTransition.default;\r\n   export let outTransition = TJSDefaultTransition.default;\r\n\r\n   // Exports properties to set options for any transitions.\r\n   export let transitionOptions = void 0;\r\n   export let inTransitionOptions = TJSDefaultTransition.options;\r\n   export let outTransitionOptions = TJSDefaultTransition.options;\r\n\r\n   // Tracks last transition state.\r\n   let oldTransition = TJSDefaultTransition.default;\r\n   let oldTransitionOptions = void 0\r\n\r\n   // Run this reactive block when the last transition state is not equal to the current state.\r\n   $: if (oldTransition !== transition)\r\n   {\r\n      // If transition is defined and not the default transition then set it to both in and out transition otherwise\r\n      // set the default transition to both in & out transitions.\r\n      const newTransition = typeof transition === 'function' ? transition : TJSDefaultTransition.default;\r\n\r\n      inTransition = newTransition;\r\n      outTransition = newTransition;\r\n\r\n      oldTransition = newTransition;\r\n   }\r\n\r\n   // Run this reactive block when the last transition options state is not equal to the current options state.\r\n   $: if (oldTransitionOptions !== transitionOptions)\r\n   {\r\n      const newOptions = transitionOptions !== TJSDefaultTransition.options && isObject(transitionOptions) ?\r\n       transitionOptions : TJSDefaultTransition.options;\r\n\r\n      inTransitionOptions = newOptions;\r\n      outTransitionOptions = newOptions;\r\n\r\n      oldTransitionOptions = newOptions;\r\n   }\r\n\r\n   // Handle cases if inTransition is unset; assign noop default transition function.\r\n   $: if (typeof inTransition !== 'function') { inTransition = TJSDefaultTransition.default; }\r\n\r\n   $:\r\n   {\r\n      // Handle cases if outTransition is unset; assign noop default transition function.\r\n      if (typeof outTransition !== 'function') { outTransition = TJSDefaultTransition.default; }\r\n\r\n      // Set close animation to `false` / not run when an out transition is defined.\r\n      const defaultCloseAnimation = application?.options?.defaultCloseAnimation;\r\n      if (typeof defaultCloseAnimation === 'boolean' && defaultCloseAnimation &&\r\n       outTransition !== TJSDefaultTransition.default)\r\n      {\r\n         application.options.defaultCloseAnimation = false;\r\n      }\r\n   }\r\n\r\n   // Handle cases if inTransitionOptions is unset; assign empty default transition options.\r\n   $: if (!isObject(inTransitionOptions)) { inTransitionOptions = TJSDefaultTransition.options; }\r\n\r\n   // Handle cases if outTransitionOptions is unset; assign empty default transition options.\r\n   $: if (!isObject(outTransitionOptions)) { outTransitionOptions = TJSDefaultTransition.options; }\r\n\r\n   // ---------------------------------------------------------------------------------------------------------------\r\n\r\n   // Reactive observation of core theme.\r\n   const themeStore = ThemeObserver.stores.theme;\r\n\r\n   // Stores current application optional classes with current theme applied.\r\n   let appClasses = '';\r\n\r\n   // Apply current theme to optional app classes.\r\n   $: if ($themeStore) { appClasses = ThemeObserver.appClasses(application); }\r\n\r\n   // ---------------------------------------------------------------------------------------------------------------\r\n\r\n   // Focus `elementRoot` on mount to allow keyboard tab navigation of header buttons.\r\n   onMount(() => elementRoot.focus());\r\n\r\n   // ---------------------------------------------------------------------------------------------------------------\r\n\r\n   /**\r\n    * Provides a handler for the custom `close:popup` event fired by `svelte-standard` components like TJSMenu. The\r\n    * intention is to handle focus management of a component that is no longer connected in the DOM. If a target element\r\n    * that is the source of the close event is attached attempt to resolve internal focus to the application.\r\n    *\r\n    * @param {CustomEvent}  event - A custom event for `close:popup`.\r\n    */\r\n   function onClosePopup(event)\r\n   {\r\n      // Early out as automatic focus management is not enabled.\r\n      if (!$focusAuto) { return; }\r\n\r\n      const targetEl = event?.detail?.target;\r\n\r\n      // Early out if there is no target element.\r\n      if (!A11yHelper.isFocusTarget(targetEl)) { return; }\r\n\r\n      // Early out if the target element is focusable as it will gain focus naturally.\r\n      if (A11yHelper.isFocusable(targetEl)) { return; }\r\n\r\n      const elementRootContains = elementRoot.contains(targetEl);\r\n\r\n      // First check for if the target is elementRoot or elementContent then fallback to contains checks.\r\n      if (targetEl === elementRoot)\r\n      {\r\n         elementRoot.focus();\r\n      }\r\n      else if (targetEl === elementContent)\r\n      {\r\n         elementContent.focus();\r\n      }\r\n      else if (elementRootContains)\r\n      {\r\n         if (elementContent.contains(targetEl))\r\n         {\r\n            elementContent.focus();\r\n         }\r\n         else\r\n         {\r\n            elementRoot.focus();\r\n         }\r\n      }\r\n   }\r\n\r\n   /**\r\n    * Provides focus cycling inside the application capturing `<Shift-Tab>` and if `elementRoot` or `firstFocusEl` is\r\n    * the actively focused element then last focusable element is focused skipping `TJSFocusWrap`.\r\n    *\r\n    * Also, if a popout app all key down events will bring this application to the top such that when focus is trapped\r\n    * the app is top most.\r\n    *\r\n    * @param {KeyboardEvent} event - Keyboard Event.\r\n    */\r\n   function onKeydown(event)\r\n   {\r\n      // TODO: Note this handling is specifically for Foundry v11+ as the platform KeyboardManager uses\r\n      // `document.querySelector(':focus')` to short circuit keyboard handling internally to KeyboardManager.\r\n      // ApplicationShell manages containing focus programmatically and this prevents the Foundry KeyboardManager from\r\n      // activating. We need to check if this key event target is currently the `elementRoot` or `elementContent` and\r\n      // the event matches any KeyboardManager actions and if so blur current focus.\r\n      if ((event.target === elementRoot || event.target === elementContent) &&\r\n       KeyboardManager && KeyboardManager?._getMatchingActions?.(\r\n        KeyboardManager?.getKeyboardEventContext?.(event))?.length)\r\n      {\r\n         event.target?.blur();\r\n         return;\r\n      }\r\n\r\n      if (focusWrapEnabled && event.shiftKey && event.code === 'Tab')\r\n      {\r\n         // Collect all focusable elements from `elementRoot` and ignore TJSFocusWrap.\r\n         const allFocusable = A11yHelper.getFocusableElements(elementRoot, s_IGNORE_CLASSES);\r\n\r\n         // Find first and last focusable elements.\r\n         const firstFocusEl = allFocusable.length > 0 ? allFocusable[0] : void 0;\r\n         const lastFocusEl = allFocusable.length > 0 ? allFocusable[allFocusable.length - 1] : void 0;\r\n\r\n         const activeWindow = application.reactive.activeWindow;\r\n\r\n         // Only cycle focus to the last keyboard focusable app element if `elementRoot` or first focusable element\r\n         // is the active element.\r\n         if (elementRoot === activeWindow.document.activeElement ||\r\n          firstFocusEl === activeWindow.document.activeElement)\r\n         {\r\n            if (A11yHelper.isFocusTarget(lastFocusEl) && firstFocusEl !== lastFocusEl) { lastFocusEl.focus(); }\r\n\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n         }\r\n      }\r\n\r\n      // Make sure this application is top most when it receives keyboard events.\r\n      if (typeof application?.options?.popOut === 'boolean' && application.options.popOut &&\r\n       application !== globalThis.ui?.activeWindow)\r\n      {\r\n         application.bringToTop.call(application);\r\n      }\r\n   }\r\n\r\n   /**\r\n    * If the application is a popOut application then when clicked bring to top if not already the Foundry\r\n    * `activeWindow`.\r\n    *\r\n    * Note: `capture` is used so pointer down is always received. Be mindful as `onPointerdownApp` should only\r\n    * invoke `bringToTop`.\r\n    */\r\n   function onPointerdownApp()\r\n   {\r\n      if (typeof application?.options?.popOut === 'boolean' && application.options.popOut &&\r\n       application !== globalThis.ui?.activeWindow)\r\n      {\r\n         application.bringToTop.call(application);\r\n      }\r\n   }\r\n\r\n   /**\r\n    * Focus `elementContent` if the event target is not focusable and `focusAuto` is enabled.\r\n    *\r\n    * Note: `focusAuto` is an app option store. This check is a bit tricky as `section.window-content` has a tabindex\r\n    * of '-1', so it is focusable manually.\r\n    */\r\n   function onPointerdownContent(event)\r\n   {\r\n      // Note: the event target may not always be the element that will eventually receive focus.\r\n      const focusable = A11yHelper.isFocusable(event.target);\r\n\r\n      if (!focusable && $focusAuto)\r\n      {\r\n         if ($focusKeep)\r\n         {\r\n            const activeWindow = application.reactive.activeWindow;\r\n            const focusOutside = !elementRoot.contains(activeWindow.document.activeElement);\r\n\r\n            // Only focus the content element if the active element is outside the app; maintaining internal focused\r\n            // element.\r\n            if (focusOutside)\r\n            {\r\n               elementContent.focus();\r\n            }\r\n            else\r\n            {\r\n               event.preventDefault();\r\n            }\r\n         }\r\n         else\r\n         {\r\n            elementContent.focus();\r\n         }\r\n      }\r\n   }\r\n\r\n   /**\r\n    * Callback for content resizeObserver action. This is enabled when contentOffsetHeight or contentOffsetWidth is\r\n    * bound.\r\n    *\r\n    * @param {number}   offsetWidth - Observed offsetWidth.\r\n    *\r\n    * @param {number}   offsetHeight - Observed offsetHeight\r\n    */\r\n   function resizeObservedContent(offsetWidth, offsetHeight)\r\n   {\r\n      contentOffsetWidth = offsetWidth;\r\n      contentOffsetHeight = offsetHeight;\r\n   }\r\n\r\n   /**\r\n    * Callback for app resizeObserver action. This is enabled when appOffsetHeight or appOffsetWidth is\r\n    * bound. Additionally, the Application position resizeObserved store is updated.\r\n    *\r\n    * @param {number}   contentWidth - Observed contentWidth.\r\n    * @param {number}   contentHeight - Observed contentHeight\r\n    * @param {number}   offsetWidth - Observed offsetWidth.\r\n    * @param {number}   offsetHeight - Observed offsetHeight\r\n    */\r\n   function resizeObservedApp(offsetWidth, offsetHeight, contentWidth, contentHeight)\r\n   {\r\n      application.position.stores.resizeObserved.update((object) =>\r\n      {\r\n         object.contentWidth = contentWidth;\r\n         object.contentHeight = contentHeight;\r\n         object.offsetWidth = offsetWidth;\r\n         object.offsetHeight = offsetHeight;\r\n\r\n         return object;\r\n      });\r\n\r\n      appOffsetHeight = offsetHeight;\r\n      appOffsetWidth = offsetWidth;\r\n   }\r\n\r\n   /**\r\n    * Transitions can cause side effects. Work around this issue by using an if conditional.\r\n    * Due to timing issues and the onDestroy / outro transitions can cause elementRoot / elementContent to be set to\r\n    * null when swapped dynamically. There is a feature request to allow transition functions to be undefined:\r\n    *\r\n    * @see: https://github.com/sveltejs/svelte/issues/6942\r\n    */\r\n</script>\r\n\r\n<svelte:options accessors={true}/>\r\n\r\n{#if inTransition !== TJSDefaultTransition.default || outTransition !== TJSDefaultTransition.default}\r\n   <!-- svelte-ignore a11y-no-noninteractive-element-interactions -->\r\n   <div id={application.id}\r\n        class=\"application {appClasses}\"\r\n        data-appid={application.appId}\r\n        bind:this={elementRoot}\r\n        in:inTransition|global={inTransitionOptions}\r\n        out:outTransition|global={outTransitionOptions}\r\n        on:close:popup|preventDefault|stopPropagation={onClosePopup}\r\n        on:keydown={onKeydown}\r\n        on:pointerdown|capture={onPointerdownApp}\r\n        use:applyStyles={stylesApp}\r\n        use:dynamicAction={appResizeObserver}\r\n        role=application\r\n        tabindex=-1>\r\n      <TJSApplicationHeader {draggable} {draggableOptions} />\r\n      <section class=window-content\r\n               bind:this={elementContent}\r\n               on:pointerdown={onPointerdownContent}\r\n               use:applyStyles={stylesContent}\r\n               use:contentResizeObserver={resizeObservedContent}\r\n               tabindex=-1>\r\n         <slot />\r\n      </section>\r\n      <ResizableHandle />\r\n      <TJSFocusWrap {elementRoot} />\r\n   </div>\r\n{:else}\r\n   <!-- svelte-ignore a11y-no-noninteractive-element-interactions -->\r\n   <div id={application.id}\r\n        class=\"application {appClasses}\"\r\n        data-appid={application.appId}\r\n        bind:this={elementRoot}\r\n        on:close:popup|preventDefault|stopPropagation={onClosePopup}\r\n        on:keydown={onKeydown}\r\n        on:pointerdown|capture={onPointerdownApp}\r\n        use:applyStyles={stylesApp}\r\n        use:dynamicAction={appResizeObserver}\r\n        role=application\r\n        tabindex=-1>\r\n      <TJSApplicationHeader {draggable} {draggableOptions} />\r\n      <section class=\"window-content\"\r\n               bind:this={elementContent}\r\n               on:pointerdown={onPointerdownContent}\r\n               use:applyStyles={stylesContent}\r\n               use:contentResizeObserver={resizeObservedContent}\r\n               tabindex=-1>\r\n         <slot />\r\n      </section>\r\n      <ResizableHandle />\r\n      <TJSFocusWrap {elementRoot} enabled={focusWrapEnabled} />\r\n   </div>\r\n{/if}\r\n\r\n<style>\r\n   /* Override stock Foundry removing min & max width / height as TJSPosition & `auto` sizing is better without. */\r\n   .application {\r\n      contain: layout style paint;\r\n\r\n      max-width: var(--tjs-app-max-width, unset);\r\n      max-height: var(--tjs-app-max-height, unset);\r\n\r\n      min-width: var(--tjs-app-min-width, unset);\r\n      min-height: var(--tjs-app-min-height, unset);\r\n\r\n      overflow: var(--tjs-app-overflow, hidden);\r\n\r\n      scrollbar-width: var(--tjs-app-scrollbar-width, inherit);\r\n      scrollbar-color: var(--tjs-app-scrollbar-color, inherit);\r\n   }\r\n\r\n   .application:focus-visible {\r\n      outline: var(--tjs-app-content-outline-focus-visible, var(--tjs-default-a11y-outline-focus-visible, 2px solid transparent));\r\n   }\r\n\r\n   .window-content:focus-visible {\r\n      outline: var(--tjs-app-content-outline-focus-visible, var(--tjs-default-a11y-outline-focus-visible, 2px solid transparent));\r\n   }\r\n\r\n   .application:is(.themed.theme-dark) {\r\n      --tjs-app-resize-handle-filter-default: invert(1);\r\n   }\r\n</style>\r\n","<script>\r\n   /**\r\n    * Provides an alternate application shell that is scoped by slightly different CSS classes than\r\n    * {@link ApplicationShell}. An application shell is a main top level slotted component that provides a reactive\r\n    * outer wrapper and header bar for the main content component.\r\n    *\r\n    * ### CSS variables\r\n    *\r\n    * ```\r\n    * '--tjs-app-background': Controls the app background image; set in main `index.js`.\r\n    * ```\r\n    * @componentDocumentation\r\n    */\r\n\r\n   import {\r\n      getContext,\r\n      onMount,\r\n      setContext }                     from 'svelte';\r\n\r\n   import { resizeObserver }           from '@typhonjs-fvtt/runtime/svelte/action/dom/observer';\r\n   import { applyStyles }              from '@typhonjs-fvtt/runtime/svelte/action/dom/style';\r\n   import { dynamicAction }            from '@typhonjs-fvtt/runtime/svelte/action/util';\r\n   import { ThemeObserver }            from '@typhonjs-fvtt/runtime/svelte/application';\r\n   import { TJSDefaultTransition }     from '@typhonjs-fvtt/runtime/svelte/transition';\r\n   import { A11yHelper }               from '@typhonjs-fvtt/runtime/util/a11y';\r\n   import { isObject }                 from '@typhonjs-fvtt/runtime/util/object';\r\n\r\n   import { AppShellContextInternal }  from './AppShellContextInternal.js';\r\n   import TJSApplicationHeader         from './TJSApplicationHeader.svelte';\r\n   import ResizableHandle              from './ResizableHandle.svelte';\r\n\r\n   import TJSFocusWrap                 from '../internal/dom/TJSFocusWrap.svelte';\r\n\r\n   // Bound to the content and root elements. Can be used by parent components. SvelteApplication will also\r\n   // use 'elementRoot' to set the element of the Application. You can also provide `elementContent` and\r\n   // `elementTarget`. Please see SvelteApplication lifecycle documentation.\r\n   /** @type {HTMLElement} */\r\n   export let elementContent = void 0;\r\n   /** @type {HTMLElement} */\r\n   export let elementRoot = void 0;\r\n\r\n   // Allows custom draggable implementations to be forwarded to TJSApplicationHeader.\r\n   export let draggable = void 0;\r\n   export let draggableOptions = void 0;\r\n\r\n   // Explicit style overrides for the main app and content elements. Uses action `applyStyles`.\r\n   export let stylesApp = void 0;\r\n   export let stylesContent = void 0;\r\n\r\n   /**\r\n    * Application reference.\r\n    *\r\n    * @type {SvelteApp}\r\n    */\r\n   const application = getContext('#external')?.application;\r\n\r\n   // Focus related app options stores.\r\n   const { focusAuto, focusKeep, focusTrap } = application.reactive.storeAppOptions;\r\n\r\n   const { minimized } = application.reactive.storeUIState;\r\n\r\n   // Is the backing app TJSPosition instance a candidate for the `resizeObserver` action? IE `width` or `height is\r\n   // `auto` or `inherit`.\r\n   const { resizeObservable } = application.position.stores;\r\n\r\n   // ----------------------------------------------------------------------------------------------------------------\r\n\r\n   // If a parent component binds and sets `appOffsetHeight` or `appOffsetWidth` to a truthy value then the\r\n   // `resizeObserver` action is enabled on the outer application `div`. Additionally, the SvelteApplication position\r\n   // resizeObserved store is updated.\r\n   export let appOffsetHeight = false;\r\n   export let appOffsetWidth = false;\r\n\r\n   // Tracks initial state if either of the above props are truthy otherwise a null operation.\r\n   const initialAppResizeObserver = !!appOffsetHeight || !!appOffsetWidth;\r\n\r\n   /**\r\n    * Reactive statement to control any dynamic action to apply for the app resize observer. It is always enabled when\r\n    * `initialAppResizeObserver` is true or when the position store `resizeObservable` is true when app position `width`\r\n    * or `height` is `auto` or `inherit`.\r\n    *\r\n    * @type {undefined | import('@typhonjs-fvtt/runtime/svelte/action/util').DynamicActionOptions}\r\n    */\r\n   $: appResizeObserver = initialAppResizeObserver || $resizeObservable ?\r\n    { action: resizeObserver, data: resizeObservedApp } : void 0;\r\n\r\n   // ----------------------------------------------------------------------------------------------------------------\r\n\r\n   // If a parent component binds and sets `contentOffsetHeight` or `contentOffsetWidth` to true then a\r\n   // resizeObserver action is enabled on the content `section`.\r\n   export let contentOffsetHeight = false;\r\n   export let contentOffsetWidth = false;\r\n\r\n   // Set to `resizeObserver` if either of the above props are truthy otherwise a null operation.\r\n   const contentResizeObserver = !!contentOffsetHeight || !!contentOffsetWidth ? resizeObserver : () => null;\r\n\r\n   // ----------------------------------------------------------------------------------------------------------------\r\n\r\n   // Provides the internal context for data / stores of the application shell.\r\n   const internal = new AppShellContextInternal();\r\n\r\n   // Provides options to `A11yHelper.getFocusableElements` to ignore TJSFocusWrap by CSS class.\r\n   const s_IGNORE_CLASSES = { ignoreClasses: ['tjs-focus-wrap'] };\r\n\r\n   // Internal context for `elementContent` / `elementRoot` stores.\r\n   setContext('#internal', internal);\r\n\r\n   // Only update the `elementContent` store if the new `elementContent` is not null or undefined.\r\n   $: if (elementContent !== void 0 && elementContent !== null)\r\n   {\r\n      getContext('#internal').stores.elementContent.set(elementContent);\r\n   }\r\n\r\n   // Only update the `elementRoot` store if the new `elementRoot` is not null or undefined.\r\n   $: if (elementRoot !== void 0 && elementRoot !== null)\r\n   {\r\n      getContext('#internal').stores.elementRoot.set(elementRoot);\r\n   }\r\n\r\n   let focusWrapEnabled;\r\n\r\n   // Enable TJSFocusWrap component when focus trapping app option is true and app is not minimized.\r\n   $: focusWrapEnabled = $focusAuto && $focusTrap && !$minimized;\r\n\r\n   // ---------------------------------------------------------------------------------------------------------------\r\n\r\n   // The following block is somewhat complex, but allows transition options to be updated reactively during\r\n   // runtime execution.\r\n\r\n   // Exports properties to set a transition w/ in / out options.\r\n   export let transition = TJSDefaultTransition.default;\r\n   export let inTransition = TJSDefaultTransition.default;\r\n   export let outTransition = TJSDefaultTransition.default;\r\n\r\n   // Exports properties to set options for any transitions.\r\n   export let transitionOptions = void 0;\r\n   export let inTransitionOptions = TJSDefaultTransition.options;\r\n   export let outTransitionOptions = TJSDefaultTransition.options;\r\n\r\n   // Tracks last transition state.\r\n   let oldTransition = TJSDefaultTransition.default;\r\n   let oldTransitionOptions = void 0\r\n\r\n   // Run this reactive block when the last transition state is not equal to the current state.\r\n   $: if (oldTransition !== transition)\r\n   {\r\n      // If transition is defined and not the default transition then set it to both in and out transition otherwise\r\n      // set the default transition to both in & out transitions.\r\n      const newTransition = typeof transition === 'function' ? transition : TJSDefaultTransition.default;\r\n\r\n      inTransition = newTransition;\r\n      outTransition = newTransition;\r\n\r\n      oldTransition = newTransition;\r\n   }\r\n\r\n   // Run this reactive block when the last transition options state is not equal to the current options state.\r\n   $: if (oldTransitionOptions !== transitionOptions)\r\n   {\r\n      const newOptions = transitionOptions !== TJSDefaultTransition.options && isObject(transitionOptions) ?\r\n       transitionOptions : TJSDefaultTransition.options;\r\n\r\n      inTransitionOptions = newOptions;\r\n      outTransitionOptions = newOptions;\r\n\r\n      oldTransitionOptions = newOptions;\r\n   }\r\n\r\n   // Handle cases if inTransition is unset; assign noop default transition function.\r\n   $: if (typeof inTransition !== 'function') { inTransition = TJSDefaultTransition.default; }\r\n\r\n   $:\r\n   {\r\n      // Handle cases if outTransition is unset; assign noop default transition function.\r\n      if (typeof outTransition !== 'function') { outTransition = TJSDefaultTransition.default; }\r\n\r\n      // Set close animation to `false` / not run when an out transition is defined.\r\n      const defaultCloseAnimation = application?.options?.defaultCloseAnimation;\r\n      if (typeof defaultCloseAnimation === 'boolean' && defaultCloseAnimation &&\r\n       outTransition !== TJSDefaultTransition.default)\r\n      {\r\n         application.options.defaultCloseAnimation = false;\r\n      }\r\n   }\r\n\r\n   // Handle cases if inTransitionOptions is unset; assign empty default transition options.\r\n   $: if (!isObject(inTransitionOptions)) { inTransitionOptions = TJSDefaultTransition.options; }\r\n\r\n   // Handle cases if outTransitionOptions is unset; assign empty default transition options.\r\n   $: if (!isObject(outTransitionOptions)) { outTransitionOptions = TJSDefaultTransition.options; }\r\n\r\n   // ---------------------------------------------------------------------------------------------------------------\r\n\r\n   // Reactive observation of core theme.\r\n   const themeStore = ThemeObserver.stores.theme;\r\n\r\n   // Stores current application optional classes with current theme applied.\r\n   let appClasses = '';\r\n\r\n   // Apply current theme to optional app classes.\r\n   $: if ($themeStore) { appClasses = ThemeObserver.appClasses(application, { hasThemed: true }); }\r\n\r\n   // ---------------------------------------------------------------------------------------------------------------\r\n\r\n   // Focus `elementRoot` on mount to allow keyboard tab navigation of header buttons.\r\n   onMount(() =>\r\n   {\r\n      if ($focusAuto) { elementRoot.focus(); }\r\n   });\r\n\r\n   // ---------------------------------------------------------------------------------------------------------------\r\n\r\n   /**\r\n    * Provides a handler for the custom `close:popup` event fired by `svelte-standard` components like TJSMenu. The\r\n    * intention is to handle focus management of a component that is no longer connected in the DOM. If a target element\r\n    * that is the source of the close event is attached attempt to resolve internal focus to the application.\r\n    *\r\n    * @param {CustomEvent}  event - A custom event for `close:popup`.\r\n    */\r\n   function onClosePopup(event)\r\n   {\r\n      // Early out as automatic focus management is not enabled.\r\n      if (!$focusAuto) { return; }\r\n\r\n      const targetEl = event?.detail?.target;\r\n\r\n      // Early out if there is no target element.\r\n      if (!A11yHelper.isFocusTarget(targetEl)) { return; }\r\n\r\n      // Early out if the target element is focusable as it will gain focus naturally.\r\n      if (A11yHelper.isFocusable(targetEl)) { return; }\r\n\r\n      const elementRootContains = elementRoot.contains(targetEl);\r\n\r\n      // First check for if the target is elementRoot or elementContent then fallback to contains checks.\r\n      if (targetEl === elementRoot)\r\n      {\r\n         elementRoot.focus();\r\n      }\r\n      else if (targetEl === elementContent)\r\n      {\r\n         elementContent.focus();\r\n      }\r\n      else if (elementRootContains)\r\n      {\r\n         if (elementContent.contains(targetEl))\r\n         {\r\n            elementContent.focus();\r\n         }\r\n         else\r\n         {\r\n            elementRoot.focus();\r\n         }\r\n      }\r\n   }\r\n\r\n   /**\r\n    * Provides focus cycling inside the application capturing `<Shift-Tab>` and if `elementRoot` or `firstFocusEl` is\r\n    * the actively focused element then the second to last focusable element if applicable is focused.\r\n    *\r\n    * Also, if a popout app all key down events will bring this application to the top such that when focus is trapped\r\n    * the app is top most.\r\n    *\r\n    * @param {KeyboardEvent} event - Keyboard Event.\r\n    */\r\n   function onKeydown(event)\r\n   {\r\n      // TODO: Note this handling is specifically for Foundry v11+ as the platform KeyboardManager uses\r\n      // `document.querySelector(':focus')` to short circuit keyboard handling internally to KeyboardManager.\r\n      // ApplicationShell manages containing focus programmatically and this prevents the Foundry KeyboardManager from\r\n      // activating. We need to check if this key event target is currently the `elementRoot` or `elementContent` and\r\n      // the event matches any KeyboardManager actions and if so blur current focus.\r\n      if ((event.target === elementRoot || event.target === elementContent) &&\r\n       KeyboardManager && KeyboardManager?._getMatchingActions?.(\r\n        KeyboardManager?.getKeyboardEventContext?.(event))?.length)\r\n      {\r\n         event.target?.blur();\r\n         return;\r\n      }\r\n\r\n      if (focusWrapEnabled && event.shiftKey && event.code === 'Tab')\r\n      {\r\n         // Collect all focusable elements from `elementRoot` and ignore TJSFocusWrap.\r\n         const allFocusable = A11yHelper.getFocusableElements(elementRoot, s_IGNORE_CLASSES);\r\n\r\n         // Find first and last focusable elements.\r\n         const firstFocusEl = allFocusable.length > 0 ? allFocusable[0] : void 0;\r\n         const lastFocusEl = allFocusable.length > 0 ? allFocusable[allFocusable.length - 1] : void 0;\r\n\r\n         const activeWindow = application.reactive.activeWindow;\r\n\r\n         // Only cycle focus to the last keyboard focusable app element if `elementRoot` or first focusable element\r\n         // is the active element.\r\n         if (elementRoot === activeWindow.document.activeElement ||\r\n          firstFocusEl === activeWindow.document.activeElement)\r\n         {\r\n            if (A11yHelper.isFocusTarget(lastFocusEl) && firstFocusEl !== lastFocusEl) { lastFocusEl.focus(); }\r\n\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n         }\r\n      }\r\n\r\n      // Make sure this application is top most when it receives keyboard events.\r\n      if (typeof application?.options?.popOut === 'boolean' && application.options.popOut &&\r\n       application !== globalThis.ui?.activeWindow)\r\n      {\r\n         application.bringToTop.call(application);\r\n      }\r\n   }\r\n\r\n   /**\r\n    * If the application is a popOut application then when clicked bring to top if not already the Foundry\r\n    * `activeWindow`.\r\n    *\r\n    * Note: `capture` is used so pointer down is always received. Be mindful as `onPointerdownApp` should only\r\n    * invoke `bringToTop`.\r\n    */\r\n   function onPointerdownApp()\r\n   {\r\n      if (typeof application?.options?.popOut === 'boolean' && application.options.popOut &&\r\n       application !== globalThis.ui?.activeWindow)\r\n      {\r\n         application.bringToTop.call(application);\r\n      }\r\n   }\r\n\r\n   /**\r\n    * Focus `elementContent` if the event target is not focusable and `focusAuto` is enabled.\r\n    *\r\n    * Note: `focusAuto` is an app option store. This check is a bit tricky as `section.window-content` has a tabindex\r\n    * of '-1', so it is focusable manually.\r\n    */\r\n   function onPointerdownContent(event)\r\n   {\r\n      // Note: the event target may not always be the element that will eventually receive focus.\r\n      const focusable = A11yHelper.isFocusable(event.target);\r\n\r\n      if (!focusable && $focusAuto)\r\n      {\r\n         if ($focusKeep)\r\n         {\r\n            const activeWindow = application.reactive.activeWindow;\r\n            const focusOutside = !elementRoot.contains(activeWindow.document.activeElement);\r\n\r\n            // Only focus the content element if the active element is outside the app; maintaining internal focused\r\n            // element.\r\n            if (focusOutside)\r\n            {\r\n               elementContent.focus();\r\n            }\r\n            else\r\n            {\r\n               event.preventDefault();\r\n            }\r\n         }\r\n         else\r\n         {\r\n            elementContent.focus();\r\n         }\r\n      }\r\n   }\r\n\r\n   /**\r\n    * Callback for content resizeObserver action. This is enabled when contentOffsetHeight or contentOffsetWidth is\r\n    * bound.\r\n    *\r\n    * @param {number}   offsetWidth - Observed offsetWidth.\r\n    *\r\n    * @param {number}   offsetHeight - Observed offsetHeight\r\n    */\r\n   function resizeObservedContent(offsetWidth, offsetHeight)\r\n   {\r\n      contentOffsetWidth = offsetWidth;\r\n      contentOffsetHeight = offsetHeight;\r\n   }\r\n\r\n   /**\r\n    * Callback for app resizeObserver action. This is enabled when appOffsetHeight or appOffsetWidth is\r\n    * bound. Additionally, the Application position resizeObserved store is updated.\r\n    *\r\n    * @param {number}   contentWidth - Observed contentWidth.\r\n    * @param {number}   contentHeight - Observed contentHeight\r\n    * @param {number}   offsetWidth - Observed offsetWidth.\r\n    * @param {number}   offsetHeight - Observed offsetHeight\r\n    */\r\n   function resizeObservedApp(offsetWidth, offsetHeight, contentWidth, contentHeight)\r\n   {\r\n      application.position.stores.resizeObserved.update((object) =>\r\n      {\r\n         object.contentWidth = contentWidth;\r\n         object.contentHeight = contentHeight;\r\n         object.offsetWidth = offsetWidth;\r\n         object.offsetHeight = offsetHeight;\r\n\r\n         return object;\r\n      });\r\n\r\n      appOffsetHeight = offsetHeight;\r\n      appOffsetWidth = offsetWidth;\r\n   }\r\n\r\n   /**\r\n    * Transitions can cause side effects. Work around this issue by using an if conditional.\r\n    * Due to timing issues and the onDestroy / outro transitions can cause elementRoot / elementContent to be set to\r\n    * null when swapped dynamically. There is a feature request to allow transition functions to be undefined:\r\n    *\r\n    * @see: https://github.com/sveltejs/svelte/issues/6942\r\n    */\r\n</script>\r\n\r\n<svelte:options accessors={true}/>\r\n\r\n{#if inTransition !== TJSDefaultTransition.default || outTransition !== TJSDefaultTransition.default}\r\n    <!-- svelte-ignore a11y-no-noninteractive-element-interactions -->\r\n    <div id={application.id}\r\n         class=\"tjs-app tjs-window-app {appClasses}\"\r\n         data-appid={application.appId}\r\n         bind:this={elementRoot}\r\n         in:inTransition|global={inTransitionOptions}\r\n         out:outTransition|global={outTransitionOptions}\r\n         on:close:popup|preventDefault|stopPropagation={onClosePopup}\r\n         on:keydown={onKeydown}\r\n         on:pointerdown|capture={onPointerdownApp}\r\n         use:applyStyles={stylesApp}\r\n         use:dynamicAction={appResizeObserver}\r\n         role=application\r\n         tabindex=-1>\r\n        <TJSApplicationHeader {draggable} {draggableOptions} />\r\n        <section class=window-content\r\n                 bind:this={elementContent}\r\n                 on:pointerdown={onPointerdownContent}\r\n                 use:applyStyles={stylesContent}\r\n                 use:contentResizeObserver={resizeObservedContent}\r\n                 tabindex=-1>\r\n            <slot />\r\n        </section>\r\n        <ResizableHandle />\r\n        <TJSFocusWrap {elementRoot} />\r\n    </div>\r\n{:else}\r\n    <!-- svelte-ignore a11y-no-noninteractive-element-interactions -->\r\n    <div id={application.id}\r\n         class=\"tjs-app tjs-window-app {appClasses}\"\r\n         data-appid={application.appId}\r\n         bind:this={elementRoot}\r\n         on:close:popup|preventDefault|stopPropagation={onClosePopup}\r\n         on:keydown={onKeydown}\r\n         on:pointerdown|capture={onPointerdownApp}\r\n         use:applyStyles={stylesApp}\r\n         use:dynamicAction={appResizeObserver}\r\n         role=application\r\n         tabindex=-1>\r\n        <TJSApplicationHeader {draggable} {draggableOptions} />\r\n        <section class=window-content\r\n                 bind:this={elementContent}\r\n                 on:pointerdown={onPointerdownContent}\r\n                 use:applyStyles={stylesContent}\r\n                 use:contentResizeObserver={resizeObservedContent}\r\n                 tabindex=-1>\r\n            <slot />\r\n        </section>\r\n        <ResizableHandle />\r\n        <TJSFocusWrap {elementRoot} enabled={focusWrapEnabled} />\r\n    </div>\r\n{/if}\r\n\r\n<style>\r\n   /**\r\n    * Defines styles that mimic a Foundry popout Application. `:global` is used to preserve the unused CSS in the\r\n    * template above. A primary benefit of a separate application shell implementation is that the styles are not\r\n    * overridden by any given game system / modules that might alter the standard Foundry Application CSS. This allows\r\n    * separate and unique styles to be given to this application regardless of game system / module modifications.\r\n    */\r\n\r\n   .tjs-app {\r\n      contain: layout style paint;\r\n\r\n      background: var(--tjs-app-background, var(--tjs-app-background-default));\r\n      margin: var(--tjs-app-margin);\r\n      padding: var(--tjs-app-padding);\r\n      color: var(--tjs-app-color);\r\n      font-size: var(--tjs-app-font-size, var(--font-size-14));\r\n      font-family: var(--tjs-app-font-family, var(--font-sans)), \"Signika\", \"Palatino Linotype\", sans-serif;\r\n      font-weight: var(--tjs-app-font-weight, inherit);\r\n\r\n      max-width: var(--tjs-app-max-width, unset);\r\n      max-height: var(--tjs-app-max-height, unset);\r\n\r\n      min-width: var(--tjs-app-min-width, unset);\r\n      min-height: var(--tjs-app-min-height, unset);\r\n\r\n      overflow: var(--tjs-app-overflow, hidden);\r\n\r\n      scrollbar-width: var(--tjs-app-scrollbar-width, thin);\r\n      scrollbar-color: var(--tjs-app-scrollbar-color, var(--color-scrollbar) var(--color-scrollbar-track));\r\n   }\r\n\r\n   .tjs-app .window-content {\r\n      background: var(--tjs-app-content-background, none);\r\n      color: var(--tjs-app-content-color, inherit);\r\n      overflow: var(--tjs-app-content-overflow, hidden);\r\n      padding: var(--tjs-app-content-padding, 1rem);\r\n\r\n      flex: var(--tjs-app-content-flex, 1);\r\n      display: var(--tjs-app-content-display, flex);\r\n      flex-direction: var(--tjs-app-content-flex-direction, column);\r\n      flex-wrap: var(--tjs-app-content-flex-wrap, nowrap);\r\n   }\r\n\r\n   .tjs-app:focus-visible {\r\n      outline: var(--tjs-app-content-outline-focus-visible, var(--tjs-default-a11y-outline-focus-visible, 2px solid transparent));\r\n   }\r\n\r\n   .tjs-app .window-content:focus-visible {\r\n      outline: var(--tjs-app-content-outline-focus-visible, var(--tjs-default-a11y-outline-focus-visible, 2px solid transparent));\r\n   }\r\n\r\n   .tjs-window-app {\r\n      --header-height: 36px; /* Set in `.application` */\r\n\r\n      /* Note: this is different than stock Foundry and allows rounded corners from .app core styles */\r\n      overflow: var(--tjs-app-overflow, hidden);\r\n\r\n      display: var(--tjs-app-display, flex);\r\n      flex-direction: var(--tjs-app-flex-direction, column);\r\n      flex-wrap: var(--tjs-app-flex-wrap, nowrap);\r\n      justify-content: var(--tjs-app-justify-content, flex-start);\r\n      position: var(--tjs-app-position, absolute);\r\n      border-radius: var(--tjs-app-border-radius, 6px);\r\n      border: var(--tjs-app-border, 1px solid var(--color-cool-4));\r\n      box-shadow: var(--tjs-app-box-shadow, 0 0 10px #000);\r\n      padding: var(--tjs-app-padding, 0);\r\n   }\r\n\r\n   .tjs-window-app :global(.window-header) {\r\n      --button-size: 24px;\r\n   }\r\n\r\n   .tjs-window-app :global(.window-header .window-title) {\r\n      flex: 1;\r\n      margin: 0;\r\n\r\n      font-family: var(--tjs-app-header-font-family, var(--tjs-app-font-family)), \"Signika\", \"Palatino Linotype\", sans-serif;\r\n      font-size: var(--tjs-app-header-font-size, var(--tjs-app-font-size, var(--font-size-14)));\r\n      font-weight: var(--tjs-app-header-font-weight, inherit);\r\n\r\n      line-height: var(--header-height);\r\n      border: none;\r\n      overflow: hidden;\r\n      text-align: left;\r\n      white-space: nowrap;\r\n      text-overflow: ellipsis;\r\n      color: var(--tjs-app-header-color, var(--color-light-1));\r\n   }\r\n\r\n   .tjs-window-app :global(.window-header button.header-control) {\r\n      --button-text-color: var(--color-light-1);\r\n      --button-background-color: none;\r\n      flex: 0 0 var(--button-size);\r\n      height: var(--button-size);\r\n      padding: 0;\r\n      margin: 0;\r\n      border: none;\r\n   }\r\n\r\n   /* ------------------------------- */\r\n\r\n   /**\r\n    * When the `themed` class is added to the application `classes` option core dark / light theming is enabled adding\r\n    * `themed.theme-dark` and `themed.theme-light` classes to the main app div element. The following selectors provide\r\n    * reasonable defaults for the app color, app header background color and resize handle filter.\r\n    */\r\n\r\n   .tjs-app:not(.themed) {\r\n      /* Explicit not themed color */\r\n      --tjs-app-color: var(--color-light-2);\r\n\r\n      /* Explicit not themed resize handle filter */\r\n      --tjs-app-resize-handle-filter-default: invert(1);\r\n   }\r\n\r\n   /* Themed app color using core dark / light CSS var */\r\n   .tjs-app:is(.themed) {\r\n      --tjs-app-color: var(--color-text-primary);\r\n   }\r\n\r\n   .tjs-app:is(.themed.theme-dark) {\r\n      --color-header-background: rgba(0, 0, 0, 0.5);\r\n      --tjs-app-resize-handle-filter-default: invert(1);\r\n   }\r\n\r\n   .tjs-app:is(.themed.theme-light) {\r\n      --color-header-background: var(--color-dark-3);\r\n      --tjs-app-resize-handle-filter-default: none;\r\n   }\r\n</style>\r\n","import { cssVariables } from './cssVariables.js';\r\n\r\nexport { default as ApplicationShell }       from './ApplicationShell.svelte';\r\nexport { default as EmptyApplicationShell }  from './EmptyApplicationShell.svelte';\r\nexport { default as TJSApplicationShell }    from './TJSApplicationShell.svelte';\r\nexport { default as TJSGlassPane }           from './TJSGlassPane.svelte';\r\n\r\n/**\r\n * Provides default CSS variables for core components.\r\n */\r\ncssVariables.setProperties({\r\n   // TJSApplicationShell app background.\r\n   '--tjs-app-background-default': `url(\"${globalThis.foundry.utils.getRoute('/ui/denim075.png')}\")`,\r\n\r\n   '--tjs-app-resize-handle-background-default': `transparent url(\"${globalThis.foundry.utils.getRoute('/ui/resize-handle.webp')}\") no-repeat center / contain`,\r\n}, false);\r\n","export default function preventDefault(event) {\n  event.preventDefault();\n  return;\n}","/**\r\n * Provides various utilities for generating hash codes for strings and UUIDs.\r\n *\r\n * This class should not be constructed as it only contains static methods.\r\n */\r\nclass Hashing\r\n{\r\n   static #regexUuidv = /^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i;\r\n\r\n   /**\r\n    * @hideconstructor\r\n    */\r\n   constructor()\r\n   {\r\n      throw new Error('Hashing constructor: This is a static class and should not be constructed.');\r\n   }\r\n\r\n   /**\r\n    * Provides a solid string hashing algorithm.\r\n    *\r\n    * Sourced from: https://stackoverflow.com/a/52171480\r\n    *\r\n    * @param {string}   str - String to hash.\r\n    *\r\n    * @param {number}   [seed=0] - A seed value altering the hash.\r\n    *\r\n    * @returns {number} Hash code.\r\n    */\r\n   static hashCode(str, seed = 0)\r\n   {\r\n      if (typeof str !== 'string') { return 0; }\r\n\r\n      let h1 = 0xdeadbeef ^ seed, h2 = 0x41c6ce57 ^ seed;\r\n\r\n      for (let ch, i = 0; i < str.length; i++)\r\n      {\r\n         ch = str.charCodeAt(i);\r\n         h1 = Math.imul(h1 ^ ch, 2654435761);\r\n         h2 = Math.imul(h2 ^ ch, 1597334677);\r\n      }\r\n\r\n      h1 = Math.imul(h1 ^ (h1 >>> 16), 2246822507) ^ Math.imul(h2 ^ (h2 >>> 13), 3266489909);\r\n      h2 = Math.imul(h2 ^ (h2 >>> 16), 2246822507) ^ Math.imul(h1 ^ (h1 >>> 13), 3266489909);\r\n\r\n      return 4294967296 * (2097151 & h2) + (h1 >>> 0);\r\n   }\r\n\r\n   /**\r\n    * Validates that the given string is formatted as a UUIDv4 string.\r\n    *\r\n    * @param {unknown}   uuid - UUID string to test.\r\n    *\r\n    * @returns {uuid is string} Is UUIDv4 string.\r\n    */\r\n   static isUuidv4(uuid)\r\n   {\r\n      return typeof uuid === 'string' && this.#regexUuidv.test(uuid);\r\n   }\r\n\r\n   /**\r\n    * Generates a UUID v4 compliant ID. Please use a complete UUID generation package for guaranteed compliance.\r\n    *\r\n    * This code is an evolution of the following Gist.\r\n    * https://gist.github.com/jed/982883\r\n    *\r\n    * There is a public domain / free copy license attached to it that is not a standard OSS license...\r\n    * https://gist.github.com/jed/982883#file-license-txt\r\n    *\r\n    * @returns {string} UUIDv4\r\n    */\r\n   static uuidv4()\r\n   {\r\n      return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, (c) =>\r\n       (c ^ (globalThis.crypto ?? globalThis.msCrypto).getRandomValues(\r\n        new Uint8Array(1))[0] & 15 >> c / 4).toString(16));\r\n   }\r\n}\n\n/**\r\n * Provides utility functions for strings.\r\n *\r\n * This class should not be constructed as it only contains static methods.\r\n */\r\nclass Strings\r\n{\r\n   /**\r\n    * @hideconstructor\r\n    */\r\n   constructor()\r\n   {\r\n      throw new Error('Strings constructor: This is a static class and should not be constructed.');\r\n   }\r\n\r\n   /**\r\n    * Escape a given input string prefacing special characters with backslashes for use in a regular expression.\r\n    *\r\n    * @param {string}   string - An un-escaped input string.\r\n    *\r\n    * @returns {string} The escaped string suitable for use in a regular expression.\r\n    */\r\n   static escape(string)\r\n   {\r\n      return string.replace(/[-/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\r\n   }\r\n\r\n   /**\r\n    * Normalizes a string.\r\n    *\r\n    * @param {string}   string - A string to normalize for comparisons.\r\n    *\r\n    * @returns {string} Cleaned string.\r\n    *\r\n    * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/normalize\r\n    */\r\n   static normalize(string)\r\n   {\r\n      return string.trim().normalize('NFD').replace(/[\\x00-\\x1F]/gm, ''); // eslint-disable-line no-control-regex\r\n   }\r\n}\n\n/**\r\n * Provides timing related higher-order functions.\r\n *\r\n * This class should not be constructed as it only contains static methods.\r\n */\r\nclass Timing\r\n{\r\n   /**\r\n    * @hideconstructor\r\n    */\r\n   constructor()\r\n   {\r\n      throw new Error('Timing constructor: This is a static class and should not be constructed.');\r\n   }\r\n\r\n   /**\r\n    * Wraps a callback in a debounced timeout. Delay execution of the callback function until the function has not been\r\n    * called for the given delay in milliseconds.\r\n    *\r\n    * @template Args\r\n    *\r\n    * @param {(...args: Args[]) => void} callback - A function to execute once the debounced threshold has been passed.\r\n    *\r\n    * @param {number}   delay - An amount of time in milliseconds to delay.\r\n    *\r\n    * @returns {(...args: Args[]) => void} A wrapped function that can be called to debounce execution.\r\n    *\r\n    * @example\r\n    * /**\r\n    *  * Debounce the update invocation by 500ms.\r\n    *  *\\/\r\n    * const updateDebounced = Timing.debounce(() => doc.update(), 500);\r\n    *\r\n    * // Use the function like:\r\n    * updateDebounced();\r\n    *\r\n    * @example\r\n    * /**\r\n    *  * Debounce the update invocation by 500ms.\r\n    *  *\r\n    *  * \\@param {string} value - A value to update.\r\n    *  *\\/\r\n    * const updateDebounced = Timing.debounce((value) => doc.update(value), 500);\r\n    *\r\n    * // Use the function like:\r\n    * updateDebounced('new value');\r\n    */\r\n   static debounce(callback, delay)\r\n   {\r\n      if (typeof callback !== 'function')\r\n      {\r\n         throw new TypeError(`'callback' must be a function.`);\r\n      }\r\n\r\n      if (!Number.isInteger(delay) || delay < 0)\r\n      {\r\n         throw new TypeError(`'delay' must be a positive integer representing milliseconds.`);\r\n      }\r\n\r\n      let timeoutId;\r\n\r\n      return function(...args)\r\n      {\r\n         globalThis.clearTimeout(timeoutId);\r\n         timeoutId = globalThis.setTimeout(() => { callback.apply(this, args); }, delay);\r\n      };\r\n   }\r\n\r\n   /**\r\n    * Creates a double click event handler that distinguishes between single and double clicks. Calls the `single`\r\n    * callback on a single click and the `double` callback on a double click. The default double click delay to invoke\r\n    * the `double` callback is 400 milliseconds.\r\n    *\r\n    * @param {object}   opts - Optional parameters.\r\n    *\r\n    * @param {(event: Event) => void} [opts.single] - Single click callback.\r\n    *\r\n    * @param {(event: Event) => void} [opts.double] - Double click callback.\r\n    *\r\n    * @param {number}   [opts.delay=400] - Double click delay.\r\n    *\r\n    * @returns {(event: Event) => void} The gated double-click handler.\r\n    *\r\n    * @example\r\n    * // Given a button element.\r\n    * button.addEventListener('click', Timing.doubleClick({\r\n    *    single: (event) => console.log('Single click: ', event),\r\n    *    double: (event) => console.log('Double click: ', event)\r\n    * });\r\n    */\r\n   static doubleClick({ single, double, delay = 400 })\r\n   {\r\n      if (single !== void 0 && typeof single !== 'function') { throw new TypeError(`'single' must be a function.`); }\r\n      if (double !== void 0 && typeof double !== 'function') { throw new TypeError(`'double' must be a function.`); }\r\n\r\n      if (!Number.isInteger(delay) || delay < 0)\r\n      {\r\n         throw new TypeError(`'delay' must be a positive integer representing milliseconds.`);\r\n      }\r\n\r\n      let clicks = 0;\r\n      let timeoutId;\r\n\r\n      return (event) =>\r\n      {\r\n         globalThis.clearTimeout(timeoutId);\r\n         clicks++;\r\n\r\n         if (clicks === 1)\r\n         {\r\n            timeoutId = globalThis.setTimeout(() =>\r\n            {\r\n               if (typeof single === 'function') { single(event); }\r\n               clicks = 0;\r\n            }, delay);\r\n         }\r\n         else\r\n         {\r\n            if (typeof double === 'function') { double(event); }\r\n            clicks = 0;\r\n         }\r\n      };\r\n   }\r\n}\n\nexport { Hashing, Strings, Timing };\n//# sourceMappingURL=index.js.map\n","import { Timing } from '@typhonjs-fvtt/runtime/util';\nimport { isObject } from '@typhonjs-fvtt/runtime/util/object';\nimport { CrossWindow } from '@typhonjs-fvtt/runtime/util/browser';\nimport { A11yHelper } from '@typhonjs-fvtt/runtime/util/a11y';\n\n/**\n * Defines a higher order function returning an action that triggers WAAPI / `Element.animate` animations from\n * provided keyframes and options in response to a given event. The default event is the `click` event. You may change\n * that to any\n *\n * @param {import('./types').ComposableActionOptions.AnimateWAAPI} [options] - Optional parameters.\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/animate\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Web_Animations_API/Keyframe_Formats\n *\n * @returns {(import('svelte/action').Action<\n *    HTMLElement,\n *    import('svelte/action').ActionReturn<import('./types').ComposableActionOptions.AnimateWAAPI>\n * >)} Actual `animateWAAPI` Action.\n */\nfunction animateWAAPI({ debounce, enabled = true, duration = 600, event = 'click', keyframes = [],\n keyframeOptions, strategy = 'cancel' } = {})\n{\n   return (element, initialOptions) =>\n   {\n      /** @type {Animation} */\n      let animation;\n\n      /**\n       * Defines the animation finished / canceled operation clearing the existing animation reference.\n       */\n      function animationFinished()\n      {\n         if (animation)\n         {\n            animation.effect = void 0;\n            animation = void 0;\n         }\n      }\n\n      /**\n       * Creates WAAPI animation.\n       */\n      function createAnimation()\n      {\n         if (!enabled) { return; }\n\n         if (animation !== void 0)\n         {\n            switch (strategy)\n            {\n               default:\n               case 'cancel':\n                  if (animation?.playState !== 'finished')\n                  {\n                     animation.cancel();\n                     animationFinished();\n                  }\n                  break;\n\n               case 'exclusive':\n                  // Exclusive animations simply return immediately as an animation is already in progress.\n                  return;\n            }\n         }\n\n         animation = element.animate(keyframes, isObject(keyframeOptions) ? keyframeOptions : duration);\n         animation.onfinish = animationFinished;\n      }\n\n      /**\n       * Updates options.\n       *\n       * @param {import('./types').ComposableActionOptions.AnimateWAAPI} newOptions - Options to update.\n       */\n      function updateOptions(newOptions)\n      {\n         if (typeof newOptions?.debounce === 'number' && debounce !== newOptions.debounce)\n         {\n            element.removeEventListener(event, eventFn);\n\n            eventFn = Number.isInteger(debounce) && debounce > 0 ? Timing.debounce(createAnimation, debounce) :\n               createAnimation;\n\n            element.addEventListener(event, eventFn);\n         }\n\n         if (typeof newOptions?.enabled === 'boolean') { enabled = newOptions.enabled; }\n\n         if (typeof newOptions?.duration === 'number') { duration = newOptions.duration; }\n\n         if (typeof newOptions?.event === 'string' && event !== newOptions.event)\n         {\n            element.removeEventListener(event, eventFn);\n\n            event = newOptions.event;\n\n            element.addEventListener(event, eventFn);\n         }\n\n         if (Array.isArray(newOptions?.keyframes) || isObject(newOptions?.keyframes))\n         {\n            keyframes = newOptions.keyframes;\n         }\n\n         if (isObject(newOptions?.keyframeOptions)) { keyframeOptions = newOptions.keyframeOptions; }\n\n         if (typeof newOptions?.strategy === 'string' && strategy !== newOptions.strategy)\n         {\n            strategy = newOptions.strategy;\n         }\n      }\n\n      let eventFn = Number.isInteger(debounce) && debounce > 0 ? Timing.debounce(createAnimation, debounce) :\n       createAnimation;\n\n      element.addEventListener(event, eventFn);\n\n      // Update options with any action assigned initial options.\n      if (isObject(initialOptions)) { updateOptions(initialOptions); }\n\n      return {\n         update: updateOptions,\n         destroy: () => element.removeEventListener(event, eventFn)\n      };\n   };\n}\n\n/**\n * Combines multiple composable actions.\n *\n * Note: The update function passes the same variable to all update functions of each action.\n *\n * @privateRemarks\n * TODO: This is a naive implementation and will be further refined in the near future.\n *\n * @param {...import('svelte/action').Action} actions - One or more composable action functions to combine.\n *\n * @returns {import('svelte/action').Action<HTMLElement, any>} Composed action.\n */\nfunction composable(...actions)\n{\n   return (element, options) =>\n   {\n      let lifecycle = actions.map((action) => action(element, options));\n\n      return {\n         destroy: () =>\n         {\n            for (const action of lifecycle)\n            {\n               if (typeof action.destroy === 'function') { action.destroy(); }\n            }\n\n            lifecycle = void 0;\n         },\n         update: (parameters) =>\n         {\n            for (const action of lifecycle)\n            {\n               if (typeof action.update === 'function') { action.update(parameters); }\n            }\n         }\n      };\n   };\n}\n\n/**\n * Defines the classic Material Design ripple effect as an action. `ripple` is a wrapper around the returned action.\n * This allows it to be easily used as a prop.\n *\n * Note: A negative one translateZ transform is applied to the added spans allowing other content to be layered on top\n * with a positive translateZ.\n *\n * Note: The ripple effect requires the `efx` element to have overflow hidden. This is set inline when the effect is\n * applied.\n *\n * Note: A CustomEvent `efx-trigger` is handled in cases when explicit triggering is necessary. This event should\n * have the actual source event as a property of `detail`.\n *\n * Styling: There is a single CSS variable `--tjs-action-ripple-background` that can be set to control the background.\n *\n * @param {object}   [opts] - Optional parameters.\n *\n * @param {string}   [opts.background='rgba(255, 255, 255, 0.7)'] - A valid CSS background attribute.\n *\n * @param {number}   [opts.duration=600] - Duration in milliseconds.\n *\n * @param {boolean}  [opts.enabled=true] - Enabled state.\n *\n * @param {Iterable<string>}  [opts.events=['click', 'keyup']] - DOM event to bind element to respond with the ripple\n *                                                                  effect.\n *\n * @param {string}   [opts.keyCode='Enter'] - Key code to trigger for any applicable key events.\n *\n * @param {boolean}  [opts.contextmenu=false] - Add triggering for context menu key and click.\n *\n * @param {number}   [opts.debounce=undefined] - Add a debounce to incoming events in milliseconds.\n *\n * @returns {(import('svelte/action').Action<\n *    HTMLElement,\n *    import('svelte/action').ActionReturn<import('./types').ComposableActionOptions.Ripple>\n * >)} Actual `ripple` Action.\n */\nfunction ripple({ background = 'rgba(255, 255, 255, 0.7)', contextmenu = false, debounce, duration = 600,\n enabled = true, events = ['click', 'keyup'], keyCode = 'Enter' } = {})\n{\n   return (element, initialOptions) =>\n   {\n      // Ripple requires the efx element to have the overflow hidden due to rendering content outside the boundary.\n      element.style.overflow = 'hidden';\n\n      /**\n       * Creates the ripple effect.\n       *\n       * @param {MouseEvent|KeyboardEvent}   e -\n       */\n      function createRipple(e)\n      {\n         if (!enabled) { return; }\n\n         const elementRect = element.getBoundingClientRect();\n\n         const diameter = Math.max(elementRect.width, elementRect.height);\n         const radius = diameter / 2;\n\n         let left, top;\n\n         // Firefox currently (11/24) does not correctly determine the location of a keyboard originated\n         // context menu location, so default to 0 instead of using `clientX` / `clientY`.\n         if (e?.button !== 2 && e.type === 'contextmenu')\n         {\n            left = '0';\n            top = '0';\n         }\n         else\n         {\n            // Find the adjusted click location relative to center or if no `clientX/Y` parameters choose center.\n            left = e.clientX ? `${e.clientX - (elementRect.left + radius)}px` : '0';\n            top = e.clientY ? `${e.clientY - (elementRect.top + radius)}px` : '0';\n         }\n\n         const span = document.createElement('span');\n\n         span.style.position = 'absolute';\n         span.style.width = `${diameter}px`;\n         span.style.height = `${diameter}px`;\n         span.style.left = left;\n         span.style.top = top;\n\n         span.style.background = `var(--tjs-action-ripple-background, ${background})`;\n         span.style.borderRadius = '50%';\n         span.style.pointerEvents = 'none';\n         span.style.transform = 'translateZ(-1px)';\n\n         element.prepend(span);\n\n         const animation = span.animate([\n            {  // from\n               transform: 'scale(.7)',\n               opacity: 0.5,\n               filter: 'blur(2px)'\n            },\n            {  // to\n               transform: 'scale(4)',\n               opacity: 0,\n               filter: 'blur(5px)'\n            }\n         ],\n         duration);\n\n         animation.onfinish = () =>\n         {\n            if (span && span.isConnected) { span.remove(); }\n         };\n      }\n\n      /**\n       * Handles a custom event trigger `efx-trigger`. The `CustomEvent` should have an `event` object accessible from\n       * `detail`.\n       *\n       * @param {CustomEvent} event - CustomEvent.\n       */\n      function customHandler(event)\n      {\n         const actual = event?.detail?.event;\n\n         if (CrossWindow.isUserInputEvent(actual)) { createRipple(actual); }\n\n         event.preventDefault();\n         event.stopPropagation();\n      }\n\n      /**\n       * Handles any key event and only triggers the ripple effect if key code matches.\n       *\n       * @param {KeyboardEvent}  event -\n       */\n      function keyHandler(event)\n      {\n         if (!enabled) { return; }\n\n         if (event?.code === keyCode) { createRipple(event); }\n      }\n\n      /**\n       * Updates options.\n       *\n       * @param {import('./types').ComposableActionOptions.Ripple} newOptions - Options to update.\n       */\n      function updateOptions(newOptions)\n      {\n         if (typeof newOptions?.enabled === 'boolean') { enabled = newOptions.enabled; }\n      }\n\n      const eventFn = Number.isInteger(debounce) && debounce > 0 ? Timing.debounce(createRipple, debounce) :\n       createRipple;\n\n      const customEventFn = Number.isInteger(debounce) && debounce > 0 ? Timing.debounce(customHandler, debounce) :\n       customHandler;\n\n      const keyEventFn = Number.isInteger(debounce) && debounce > 0 ? Timing.debounce(keyHandler, debounce) :\n       keyHandler;\n\n      for (const event of events)\n      {\n         if (['keydown', 'keyup'].includes(event))\n         {\n            element.addEventListener(event, keyEventFn);\n         }\n         else\n         {\n            element.addEventListener(event, eventFn);\n         }\n      }\n\n      element.addEventListener('efx-trigger', customEventFn);\n\n      if (contextmenu) { element.addEventListener('contextmenu', eventFn); }\n\n      // Update options with any action assigned initial options.\n      if (isObject(initialOptions)) { updateOptions(initialOptions); }\n\n      return {\n         update: updateOptions,\n         destroy: () =>\n         {\n            for (const event of events)\n            {\n               if (['keydown', 'keyup'].includes(event))\n               {\n                  element.removeEventListener(event, keyEventFn);\n               }\n               else\n               {\n                  element.removeEventListener(event, eventFn);\n               }\n            }\n\n            element.removeEventListener('efx-trigger', customEventFn);\n\n            if (contextmenu) { element.removeEventListener('contextmenu', eventFn); }\n         }\n      };\n   };\n}\n\n/**\n * Defines the classic Material Design ripple effect as an action that is attached to an elements focus and blur events.\n * `rippleFocus` is a wrapper around the returned action. This allows it to be easily used as a prop.\n *\n * Note: A negative one translateZ transform is applied to the added spans allowing other content to be layered on top\n * with a positive translateZ.\n *\n * Note: The ripple effect requires the `efx` element to have overflow hidden. This is set inline when the effect is\n * applied.\n *\n * If providing the `selector` option a target child element will be registered for the focus events otherwise the\n * first child is targeted with a final fallback of the element assigned to this action.\n *\n * Styling: There is a single CSS variable `--tjs-action-ripple-background-focus` that can be set to control the\n * background with a fallback to `--tjs-action-ripple-background`.\n *\n * @param {object}   [opts] - Optional parameters.\n *\n * @param {number}   [opts.duration=300] - Duration in milliseconds.\n *\n * @param {boolean}  [opts.enabled=true] - Enabled state.\n *\n * @param {string}   [opts.background='rgba(255, 255, 255, 0.7)'] - A valid CSS background attribute.\n *\n * @param {string}   [opts.selector] - A valid CSS selector string.\n *\n * @returns {(import('svelte/action').Action<\n *    HTMLElement,\n *    import('svelte/action').ActionReturn<import('./types').ComposableActionOptions.RippleFocus>\n * >)} Actual `rippleFocus` Action.\n */\nfunction rippleFocus({ background = 'rgba(255, 255, 255, 0.7)', duration = 300, enabled = true, selector } = {})\n{\n   return (element, initialOptions) =>\n   {\n      // Ripple requires the efx element to have the overflow hidden due to rendering content outside the boundary.\n      element.style.overflow = 'hidden';\n\n      const targetEl = typeof selector === 'string' ? element.querySelector(selector) :\n       A11yHelper.isFocusTarget(element.firstChild) ? element.firstChild : element;\n\n      let clientX = -1;\n      let clientY = -1;\n\n      /** @type {HTMLSpanElement[]} */\n      const activeSpans = [];\n\n      /**\n       * WAAPI ripple animation on blur.\n       */\n      function blurRipple()\n      {\n         if (!enabled) { return; }\n\n         // When clicking outside the browser window or to another tab `document.activeElement` remains\n         // the same despite blur being invoked; IE the target element.\n         if (activeSpans.length === 0 || targetEl === CrossWindow.getActiveElement(targetEl)) { return; }\n\n         for (const span of activeSpans)\n         {\n            const animation = span.animate(\n             [\n                {  // from\n                   transform: 'scale(3)',\n                   opacity: 0.3,\n                },\n                {  // to\n                   transform: 'scale(.7)',\n                   opacity: 0.0,\n                }\n             ],\n             {\n                duration,\n                fill: 'forwards'\n             });\n\n            animation.onfinish = () =>\n            {\n               if (span.isConnected) { span.remove(); }\n            };\n         }\n\n         // Remove all active spans as they are now animating out.\n         activeSpans.length = 0;\n      }\n\n      /**\n       * WAAPI ripple animation on focus.\n       */\n      function focusRipple()\n      {\n         if (!enabled) { return; }\n\n         // If already focused and the span exists do not create another ripple effect.\n         if (activeSpans.length > 0) { return; }\n\n         const elementRect = element.getBoundingClientRect();\n\n         // The order of events don't always occur with a pointer event first. In this case use the center of the\n         // element as the click point. Mostly this is seen when the focused target element has a followup event off\n         // the app / screen. If the next pointer down occurs on the target element the focus callback occurs before\n         // pointer down in Chrome and Firefox.\n         const actualX = clientX >= 0 ? clientX : elementRect.left + (elementRect.width / 2);\n         const actualY = clientY >= 0 ? clientY : elementRect.top + (elementRect.height / 2);\n\n         const diameter = Math.max(elementRect.width, elementRect.height);\n         const radius = diameter / 2;\n         const left = `${actualX - (elementRect.left + radius)}px`;\n         const top = `${actualY - (elementRect.top + radius)}px`;\n\n         const span = document.createElement('span');\n\n         span.style.position = 'absolute';\n         span.style.width = `${diameter}px`;\n         span.style.height = `${diameter}px`;\n         span.style.left = left;\n         span.style.top = top;\n\n         span.style.background =\n          `var(--tjs-action-ripple-background-focus, var(--tjs-action-ripple-background, ${background}))`;\n\n         span.style.borderRadius = '50%';\n         span.style.pointerEvents = 'none';\n         span.style.transform = 'translateZ(-1px)';\n\n         element.prepend(span);\n\n         activeSpans.push(span);\n\n         span.animate([\n            {  // from\n               transform: 'scale(.7)',\n               opacity: 0.5,\n            },\n            {  // to\n               transform: 'scale(3)',\n               opacity: 0.3,\n            }\n         ],\n         {\n            duration,\n            fill: 'forwards'\n         });\n\n         // Reset stored pointer position.\n         clientX = clientY = -1;\n      }\n\n      /**\n       * Store the pointer down location for the origination of the ripple.\n       *\n       * @param {PointerEvent} e - A PointerEvent.\n       */\n      function onPointerDown(e)\n      {\n         if (!enabled) { return; }\n\n         clientX = e.clientX;\n         clientY = e.clientY;\n      }\n\n      /**\n       * Updates options.\n       *\n       * @param {import('./types').ComposableActionOptions.RippleFocus} newOptions - Options to update.\n       */\n      function updateOptions(newOptions)\n      {\n         if (typeof newOptions?.enabled === 'boolean' && enabled !== newOptions?.enabled)\n         {\n            enabled = newOptions.enabled;\n            if (!enabled) { blurRipple(); }\n         }\n      }\n\n      targetEl.addEventListener('pointerdown', onPointerDown);\n      targetEl.addEventListener('blur', blurRipple);\n      targetEl.addEventListener('focus', focusRipple);\n\n      // Update options with any action assigned initial options.\n      if (isObject(initialOptions)) { updateOptions(initialOptions); }\n\n      return {\n         update: updateOptions,\n         destroy: () =>\n         {\n            targetEl.removeEventListener('pointerdown', onPointerDown);\n            targetEl.removeEventListener('blur', blurRipple);\n            targetEl.removeEventListener('focus', focusRipple);\n         }\n      };\n   };\n}\n\nexport { animateWAAPI, composable, ripple, rippleFocus };\n//# sourceMappingURL=index.js.map\n","<script>\n  import preventDefault from \"~/src/helpers/svelte-actions/PreventDefault.js\";\n  import { ripple } from \"@typhonjs-fvtt/standard/action/animate/composable\";\n  import { getContext, onDestroy, onMount, tick } from \"svelte\";\n  import { dropItemRegistry } from \"~/src/stores/index\";\n\n  export let tabs = [];\n  export let sheet;\n  export let activeTab = void 0;\n  export let efx = ripple();\n\n  let initialTabs = [];\n\n  $: tabComponents = {}\n\n  // if the tabs change, load the new components\n  $: if(initialTabs !== tabs) {\n    initialTabs = tabs;\n    for (const tab of tabs) {\n      import(`~/src/components/organisms/dnd5e/Tabs/${tab.component}.svelte`).then(module => {\n        tabComponents[tab.component] = module.default;\n      });\n    }\n  }\n\n  onMount(async () => {\n    initialTabs = tabs;\n    for (const tab of tabs) {\n      const module = await import(`~/src/components/organisms/dnd5e/Tabs/${tab.component}.svelte`);\n      tabComponents[tab.component] = module.default;\n    }\n  });\n  \n  // Subscribe to the currentProcess to know when advancements are active\n  $: isAdvancementTab = activeTab === 'advancements';\n</script>\n\n<!--List of tabs-->\n<div class=\"tabs {$$restProps.class}\">\n  <!--Tab List-->\n  <div class=\"tabs-list\">\n    <!--For each tab-->\n    {#each tabs as tab, idx}\n      <button\n        class=\"{activeTab === tab.id ? 'active ' : ''}\"\n        on:click={() => {\n          activeTab = tab.id;\n        }}\n        on:mousedown={preventDefault}\n        use:efx\n      >\n        {tab.label}\n      </button>\n    {/each}\n  </div>\n\n  <!--Tab Content-->\n  <div class=\"tab-content\">\n    {#each tabs as tab}\n      {#if tab.id === activeTab && tabComponents[tab.component]}\n        <svelte:component this={tabComponents[tab.component]} {sheet} />\n      {/if}\n    {/each}\n  </div>\n</div>\n\n<style lang=\"scss\">\n  @import \"../../../styles/Mixins.sass\";\n\n  .tabs {\n    @include flex-column;\n    @include flex-group-top;\n    @include border;\n    height: 100%;\n    width: 100%;\n\n    .tabs-list {\n      @include flex-row;\n      @include flex-space-evenly;\n      @include border-bottom;\n      @include panel-1;\n      list-style: none;\n      width: 100%;\n      margin: 0;\n      padding: 0.25rem;\n      height: 100%;\n      flex: 0;\n\n      button {\n        --button-border-radius: 5px;\n        --button-line-height: var(--tab-line-height);\n        --button-font-size: var(--tab-font-size);\n        @include button;\n        position: relative;\n        overflow: hidden;\n        width: 100%;\n        height: 200%;\n        margin: -10px 2px;\n        font-weight: normal;\n        font-size: larger;\n        margin-bottom: -10px;\n        padding: 10px 0;\n        align-items: end;\n\n        &:not(:first-child) {\n          border-left: none;\n        }\n\n        &:not(.active) {\n          &:before {\n            content: \"\";\n            border-top: 5px solid var(--color-border-highlight);\n            position: absolute;\n            width: 100%;\n            bottom: 5px;\n          } \n          &:not(:hover) {\n            &:before {\n              border-top: 5px solid brown;\n            }\n          }\n        }\n\n        &.active {\n          &:hover {\n            background: #f9f9f9;\n            box-shadow: none;\n          }\n          font-weight: bold;\n          background: #f9f9f9;\n          color: var(--dnd5e-color-gold)\n        }\n      }\n    }\n  }\n\n\n  .tab-content {\n    @include flex-column;\n    flex: 2;\n    width: 100%;\n    position: relative;\n  }\n\n  .readonly-overlay {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.4);\n    z-index: 100;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .overlay-message {\n    background: #fff;\n    padding: 1rem;\n    border-radius: 5px;\n    box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);\n  }\n\n  button.readonly {\n    opacity: 0.7;\n    cursor: not-allowed;\n\n    &:hover {\n      box-shadow: none;\n      background: inherit;\n    }\n  }\n</style>\n","import { derived, get, writable } from 'svelte/store';\nimport {\n  race,\n  characterClass,\n  characterSubClass,\n  background,\n  abilityGenerationMethod,\n  pointBuyScoreTotal, \n  pointBuyLimit,\n  abilityRolls,\n  isStandardArrayValues,\n  subClassesForClass,\n  activeTab,\n} from './index';\nimport { goldRoll } from './storeDefinitions';\nimport { equipmentSelections } from './equipmentSelections';\nimport { areGoldChoicesComplete } from './goldChoices';\nimport { spellProgress } from './spellSelection';\nimport { getDnd5eVersion, getSubclassLevel } from '~/src/helpers/Utility';\nimport { MODULE_ID } from '~/src/helpers/constants';\n\n\n// Convert to derived store\nconst isAbilityGenerationMethodReady = derived(\n  [abilityGenerationMethod, abilityRolls, pointBuyScoreTotal, pointBuyLimit, isStandardArrayValues],\n  ([$abilityGenerationMethod, $abilityRolls, $pointBuyScoreTotal, $pointBuyLimit, $isStandardArrayValues]) => {\n    // window.GAS.log.d('[PROGRESS] isAbilityGenerationMethodReady called', {\n    //   method: $abilityGenerationMethod,\n    //   rolls: $abilityRolls,\n    //   scoreTotal: $pointBuyScoreTotal,\n    //   pointBuyLimit: $pointBuyLimit,\n    //   standardArray: $isStandardArrayValues\n    // });\n\n    if (!$abilityGenerationMethod) {\n      return false;\n    }\n\n    const result = (() => {\n      switch ($abilityGenerationMethod) {\n        case 2: // Point Buy\n          const isComplete = Number($pointBuyScoreTotal) === Number($pointBuyLimit);\n          \n          return isComplete;\n        case 3:\n          // Check if all abilities are assigned\n          return Object.keys($abilityRolls).length === 6;\n        case 4:\n          // Check if all rolls are assigned\n          return $isStandardArrayValues;\n        case 1: default: // Manual Entry is always complete\n          return true;\n      }\n    })();\n\n    // window.GAS.log.d('[PROGRESS] isAbilityGenerationMethodReady result', result);\n    return result;\n  }\n);\n\n/**\n * @why: some classes don't have subclasses until later levels\n * @param characterClass\n * @param characterSubClass\n */\nfunction isSubclassForThisCharacterLevel(characterClass) {\n  if (!characterClass) return false;\n\n  const subClassLevel = getSubclassLevel(characterClass, MODULE_ID);\n  // window.GAS.log.d('[PROGRESS] subClassLevel determined to be: ', subClassLevel);\n\n  if (!subClassLevel) return false;\n\n  const newActorLevel = game.actor?.system?.details?.level\n    ? game.actor.system.details.level + 1\n    : 1;\n  // window.GAS.log.d(\"[PROGRESS] subClassLevel\", subClassLevel);\n  // window.GAS.log.d(\"[PROGRESS] level\", newActorLevel);\n  // window.GAS.log.d(\n  //   \"[PROGRESS] subClassLevel === level\",\n  //   subClassLevel === newActorLevel,\n  // );\n  return subClassLevel && parseInt(newActorLevel) === parseInt(subClassLevel);\n}\n\n// Define progress calculation functions for different modes\nconst progressCalculators = {\n  characterCreation: ({ \n    race, \n    background, \n    characterClass, \n    characterSubClass, \n    abilityGenerationMethod, \n    totalSteps,\n    pointBuyScoreTotal,\n    pointBuyLimit,\n    abilityRolls,\n    isStandardArrayValues\n  }) => {\n    // window.GAS.log.d('[PROGRESS] characterCreation calculator called', {\n    //   race,\n    //   background,\n    //   characterClass,\n    //   characterSubClass,\n    //   abilityGenerationMethod,\n    //   totalSteps,\n    //   pointBuyScoreTotal,\n    //   pointBuyLimit\n    // });\n\n    const completed = [race, background, characterClass, characterSubClass, abilityGenerationMethod]\n      .filter((value, index) => {\n        if (index === 4) {\n          // Check ability generation method completion directly\n          let result = false;\n          \n          if (!abilityGenerationMethod) {\n            result = false;\n          } else {\n            switch (abilityGenerationMethod) {\n              case 2: // Point Buy\n                result = Number(pointBuyScoreTotal) === Number(pointBuyLimit);\n                break;\n              case 3: // Ability Rolls\n                result = Object.keys(abilityRolls).length === 6;\n                break;\n              case 4: // Standard Array\n                result = isStandardArrayValues;\n                break;\n              case 1: default: // Manual Entry is always complete\n                result = true;\n                break;\n            }\n          }\n          \n          // window.GAS.log.d('[PROGRESS] abilityGenerationMethod check result', result);\n          return result;\n        }\n        return !!value;\n      }).length;\n\n    const progress = (completed / totalSteps) * 100;\n    // window.GAS.log.d('[PROGRESS] characterCreation progress calculated', {\n    //   completed,\n    //   totalSteps,\n    //   progress\n    // });\n    return progress;\n  },\n\n  equipment: ({ equipmentSelections, goldRoll, areGoldChoicesComplete }) => {\n    const groups = Object.values(equipmentSelections);\n    window.GAS.log.d(\"[PROGRESS] goldRoll\", goldRoll);\n    window.GAS.log.d(\"[PROGRESS] equipmentSelections\", equipmentSelections);\n    \n    // Handle v4 gold choices\n    if (window.GAS.dnd5eVersion >= 4  && window.GAS.dnd5eRules === \"2024\") {\n      if (!areGoldChoicesComplete) return 0; // Choices not made\n      if (groups.length === 0) return 100; // No equipment to select, but choices made\n      \n      // Equipment is complete when all groups are complete AND choices are made\n      const completedGroups = groups.filter(group => group.completed).length;\n      // Force 100% if all groups are completed\n      if (completedGroups === groups.length) return 100;\n      return Math.round((completedGroups / groups.length) * 100);\n    }\n    \n    // Handle v3 gold roll\n    if (!goldRoll) return 0; // Nothing selected and no gold rolled\n    if (groups.length === 0) return 100; // No equipment to select, but gold is rolled\n    \n    // Equipment is complete when all groups are complete AND gold is rolled\n    let completedGroups = groups.filter(group => group.completed).length;\n    if(goldRoll > 0) {\n      completedGroups += 1;\n    }\n    const equipmentProgress = Math.round((completedGroups / (groups.length + 1)) * 100);\n    \n    // Only return 100 if both equipment and gold are done\n    // Force 100% if all groups are completed and gold is rolled\n    if (goldRoll > 0 && completedGroups === groups.length + 1) return 100;\n    return goldRoll > 0 ? equipmentProgress : Math.min(equipmentProgress, 99);\n  },\n\n  spells: ({ spellProgress }) => {\n    if (!spellProgress) return 0;\n    \n    // If no spells are required, only show 100% if spell selection shouldn't be shown at all\n    if (spellProgress.totalRequired === 0) {\n      // For non-spellcasting classes, spell selection should be disabled/hidden\n      // Don't show 100% if the user is looking at a spell selection UI that shouldn't exist\n      return 0;\n    }\n    \n    // Return the calculated percentage from spellProgress\n    return Math.min(100, spellProgress.progressPercentage);\n  }\n};\n\nconst stores = [\n  race,\n  characterClass,\n  characterSubClass,\n  background,\n  abilityGenerationMethod,\n  pointBuyScoreTotal,\n  pointBuyLimit,\n  abilityRolls,\n  isStandardArrayValues,\n];\n\n// Create a derived store for the total length\nexport const totalSteps = derived(\n  [characterClass, characterSubClass, subClassesForClass],\n  ([$characterClass, $characterSubClass, $subClassesForClass]) => {\n    let length = 5;\n    if (\n      //- @why: if there are no subclasses for this class, or the subclass is not available for this level, reduce the total steps\n      !$subClassesForClass.length > 0 ||\n      !isSubclassForThisCharacterLevel($characterClass, $characterSubClass)\n    ) {\n      length = length - 1;\n    }\n    // window.GAS.log.d(\"[PROGRESS] totalSteps\", length);\n    return length;\n  }\n);\n\n// Derive the progress value based on the current tab/mode\nexport const progress = derived(\n  [\n    race,\n    characterClass,\n    characterSubClass,\n    background,\n    abilityGenerationMethod,\n    totalSteps,\n    activeTab,\n    equipmentSelections,\n    goldRoll,\n    areGoldChoicesComplete,\n    abilityRolls,\n    pointBuyScoreTotal,\n    pointBuyLimit,\n    isStandardArrayValues,\n    spellProgress\n  ],\n  ([\n    $race,\n    $characterClass,\n    $characterSubClass,\n    $background,\n    $abilityGenerationMethod,\n    $totalSteps,\n    $activeTab,\n    $equipmentSelections,\n    $goldRoll,\n    $areGoldChoicesComplete,\n    $abilityRolls,\n    $pointBuyScoreTotal,\n    $pointBuyLimit,\n    $isStandardArrayValues,\n    $spellProgress\n  ]) => {\n    // window.GAS.log.d('[PROGRESS] progress store update triggered', {\n    //   activeTab: $activeTab,\n    //   abilityGenerationMethod: $abilityGenerationMethod,\n    //   abilityRolls: $abilityRolls,\n    //   pointBuyScoreTotal: $pointBuyScoreTotal,\n    //   pointBuyLimit: $pointBuyLimit\n    // });\n\n    // Select the appropriate calculator based on the active tab\n    let calculator;\n    if ($activeTab === 'equipment') {\n      calculator = progressCalculators.equipment;\n    } else if ($activeTab === 'spells') {\n      calculator = progressCalculators.spells;\n    } else {\n      calculator = progressCalculators.characterCreation;\n    }\n\n    // Pass relevant data to the calculator\n    const result = calculator({\n      race: $race,\n      background: $background,\n      characterClass: $characterClass,\n      characterSubClass: $characterSubClass,\n      abilityGenerationMethod: $abilityGenerationMethod,\n      totalSteps: $totalSteps,\n      equipmentSelections: $equipmentSelections,\n      goldRoll: $goldRoll,\n      areGoldChoicesComplete: $areGoldChoicesComplete,\n      pointBuyScoreTotal: $pointBuyScoreTotal,\n      pointBuyLimit: $pointBuyLimit,\n      abilityRolls: $abilityRolls,\n      isStandardArrayValues: $isStandardArrayValues,\n      spellProgress: $spellProgress\n    });\n\n    // window.GAS.log.d('[PROGRESS] progress store result', result);\n    return result;\n  }\n);\n","import { writable, derived, get } from 'svelte/store';\nimport { MODULE_ID } from '~/src/helpers/constants';\n// Import extractItemsFromPacksAsync instead of Sync\nimport { getPacksFromSettings, extractItemsFromPacksAsync } from '../helpers/Utility.js';\nimport { goldRoll } from '~/src/stores/storeDefinitions';\nimport { totalGoldFromChoices } from '~/src/stores/goldChoices';\nimport { readOnlyTabs } from './index.js';\nimport { handleContainerContents } from '../lib/workflow.js';\n\n// Import fromUuid for container handling - compatibility check for v12 vs v13+\nconst fromUuid = foundry.utils?.fromUuid || globalThis.fromUuid;\n\n// Store for managing the state of the equipment shop\n\n// List of items available in the shop, fetched from selected compendiums\nexport const shopItems = writable([]);\n\n// Items currently selected/added to the virtual cart (Map<itemId, { quantity, itemData }>)\nexport const shopCart = writable(new Map());\n\n// Available gold - use appropriate store based on D&D rules version (in copper)\nexport const availableGold = derived(\n  [totalGoldFromChoices, goldRoll],\n  ([$totalGoldFromChoices, $goldRoll]) => {\n    // Check both version AND rules - only use new system for D&D 2024 rules\n    if (window.GAS?.dnd5eVersion >= 4 && window.GAS?.dnd5eRules === \"2024\") {\n      return ($totalGoldFromChoices || 0) * 100;\n    } else {\n      return ($goldRoll || 0) * 100;\n    }\n  }\n);\n\n// Total cost of items in the cart (in copper)\nexport const cartTotalCost = writable(0);\n\n// Remaining gold after purchase (in copper)\nexport const remainingGold = derived(\n  [availableGold, cartTotalCost],\n  ([$availableGold, $cartTotalCost]) => {\n    return $availableGold - $cartTotalCost;\n  }\n);\n\n// Initialize gold amount based on character's gold choices or roll\nexport function initializeGold() {\n  if (window.GAS.dnd5eVersion < 4) {\n    // For 5e v3, use goldRoll (legacy)\n    const goldValue = get(goldRoll);\n    return goldValue * 100;\n  }\n  // For v4+, availableGold is derived from totalGoldFromChoices and always up to date\n  return get(availableGold);\n}\n\n// Make the store globally available for other components to access\n// Always ensure window.GAS exists and stores are attached\nif (typeof window !== 'undefined') {\n  window.GAS = window.GAS || {};\n  window.GAS.availableGold = availableGold;\n  window.GAS.shopItems = shopItems;\n  window.GAS.shopCart = shopCart;\n  window.GAS.cartTotalCost = cartTotalCost;\n  window.GAS.remainingGold = remainingGold;\n  window.GAS.initializeShopGold = initializeGold;\n}\n\n// Function to fetch items from compendiums\nexport async function loadShopItems() {\n  try {\n    // Get equipment compendium sources from settings\n    const packs = getPacksFromSettings(\"equipment\");\n    \n    if (!packs || packs.length === 0) {\n      shopItems.set([]);\n      console.warn(\"No equipment compendiums configured\");\n      return;\n    }\n\n    // Define the basic keys available in the default index\n    const indexKeys = [\n      \"_id\",\n      \"name\",\n      \"img\",\n      \"type\",\n      \"uuid\" // Keep uuid to fetch full item later\n    ];\n    \n    // Define keys that are likely NOT in the index and need async loading\n    const nonIndexKeys = [\n      \"system.price.value\",\n      \"system.price.denomination\",\n      \"system.quantity\"\n    ];\n\n    // Extract item data using extractItemsFromPacksAsync\n    // This will fetch nonIndexKeys if they aren't in the default index\n    let lightweightItems = await extractItemsFromPacksAsync(packs, indexKeys, nonIndexKeys);\n    \n    // Filter for items with a price (any item type is allowed if it has a price)\n    lightweightItems = lightweightItems.filter(item => \n      item.system?.price?.value // Only require that the item has a price\n    );\n\n    // Handle duplicates - keep only the first instance of each item name\n    const seenItems = new Map();\n    const uniqueLightweightItems = [];\n    for (const item of lightweightItems) {\n      // Use item name for deduplication to avoid duplicate items in the shop UI\n      const uniqueKey = item.name.toLowerCase();\n      if (!seenItems.has(uniqueKey)) {\n        uniqueLightweightItems.push(item);\n        seenItems.set(uniqueKey, true);\n      } else {\n         window.GAS.log.d(`[SHOP] Skipping duplicate item: ${item.name} (uuid: ${item.uuid})`);\n      }\n    }\n\n    // Sort items by name\n    uniqueLightweightItems.sort((a, b) => a.name.localeCompare(b.name));\n    \n    // Add enrichedName property for Foundry enrichers\n    for (const item of uniqueLightweightItems) {\n      if (item.uuid && item.name) {\n        item.enrichedName = `@UUID[${item.uuid}]{${item.name}}`;\n      } else {\n        item.enrichedName = item.name;\n      }\n    }\n\n    // Update the store with lightweight items\n    shopItems.set(uniqueLightweightItems);\n    window.GAS.log.d('[SHOP] Loaded lightweight items:', uniqueLightweightItems.length);\n    \n  } catch (error) {\n    console.error(\"Error loading shop items:\", error);\n    shopItems.set([]);\n  }\n}\n\n// Calculate the total cost in copper for an item\n// This function now expects the full item data, which will be retrieved when adding to cart\nfunction getItemCostInCopper(itemData, quantity) {\n  if (!itemData?.system?.price) return 0;\n  \n  const value = itemData.system.price.value || 0;\n  const denomination = itemData.system.price.denomination || 'cp';\n  \n  // Convert to copper based on denomination\n  let multiplier = 1;\n  switch (denomination) {\n    case 'gp': multiplier = 100; break;\n    case 'sp': multiplier = 10; break;\n    case 'pp': multiplier = 1000; break;\n    case 'ep': multiplier = 50; break;\n    default: multiplier = 1; // cp\n  }\n  \n  // Get the base quantity of the item (if it comes in a pack/bundle)\n  const baseQuantity = itemData.system.quantity || 1;\n  \n  // Calculate price per unit: If an item comes in a pack (like 20 arrows),\n  // we need to divide the total price by the pack quantity to get price per unit\n  const pricePerUnit = (value * multiplier) / baseQuantity;\n  \n  // Calculate total cost: Price per unit * desired quantity\n  return pricePerUnit * quantity;\n}\n\n// Function to update cart and totals\n// Now accepts fullItemData to store in the cart map\nexport function updateCart(itemId, quantity, fullItemData, uuid = null) {\n  shopCart.update(cart => {\n    const newCart = new Map(cart);\n    \n    if (quantity <= 0) {\n      newCart.delete(itemId);\n    } else {\n      // Store quantity, the full item data, and UUID for container handling\n      newCart.set(itemId, { quantity: quantity, itemData: fullItemData, uuid: uuid }); \n    }\n    \n    return newCart;\n  });\n  \n  // Recalculate cart total\n  updateTotals();\n}\n\n// Update cart total and remaining gold\nfunction updateTotals() {\n  // Get current values to avoid subscription leaks\n  // No longer need shopItems here, get itemData from cart\n  const cart = get(shopCart);\n  \n  let total = 0;\n  \n  // Calculate cart total using itemData stored in the cart\n  cart.forEach(({ quantity, itemData }, itemId) => {\n    if (itemData) {\n      total += getItemCostInCopper(itemData, quantity);\n    }\n  });\n  \n  // Update cart total - this will automatically update the derived remainingGold store\n  cartTotalCost.set(total);\n}\n\n// Function to finalize the purchase and add items to the actor\nexport async function finalizePurchase(actor) {\n  window.GAS.log.d('[SHOP] finalizePurchase called with actor:', actor?.name);\n  \n  if (!actor) {\n    ui.notifications.error(\"No active character\");\n    return false;\n  }\n  \n  try {\n    // Get the current cart and items\n    const currentCart = get(shopCart);\n    const currentTotal = get(cartTotalCost);\n    const currentAvailable = get(availableGold);\n    \n    // Check if enough gold\n    if (currentTotal > currentAvailable) {\n      ui.notifications.error(\"Not enough gold for purchase\");\n      return false;\n    }\n    \n    // Calculate remaining gold\n    const remainingGoldValue = currentAvailable - currentTotal;\n    \n    // Add remaining gold to character (instead of deducting spent gold)\n    const gpValue = Math.floor(remainingGoldValue / 100);\n    const spValue = Math.floor((remainingGoldValue % 100) / 10);\n    const cpValue = remainingGoldValue % 10;\n    \n    // Update actor currency first\n    await actor.update({\n      \"system.currency.gp\": (actor.system.currency.gp || 0) + gpValue,\n      \"system.currency.sp\": (actor.system.currency.sp || 0) + spValue,\n      \"system.currency.cp\": (actor.system.currency.cp || 0) + cpValue\n    });\n    \n    // Create a batch of items to add to character\n    const itemsToCreate = [];\n    const itemsToUpdate = []; // Track updates separately\n    const newItemsInfo = []; // Track info about new items for container handling\n\n    window.GAS.log.d('[SHOP] Processing cart with', currentCart.size, 'items');\n\n    // Add items to character using itemData from the cart\n    for (const [itemId, { quantity, itemData, uuid }] of currentCart.entries()) {\n      if (itemData) {\n        window.GAS.log.d('[SHOP] Processing cart item:', itemData.name, 'Type:', itemData.type, 'Quantity:', quantity, 'UUID:', uuid);\n        \n        // Check if actor already has this item by name\n        const existingItem = actor.items.find(i => i.name === itemData.name); \n        \n        if (existingItem) {\n          window.GAS.log.d('[SHOP] Found existing item, will update quantity');\n          // Prepare update for existing item\n          itemsToUpdate.push({\n            _id: existingItem._id,\n            \"system.quantity\": (existingItem.system.quantity || 0) + quantity\n          });\n        } else {\n          window.GAS.log.d('[SHOP] New item, will create');\n          // Prepare to create new item from the full itemData\n          const newItemObject = typeof itemData.toObject === 'function' \n              ? itemData.toObject() \n              : foundry.utils.deepClone(itemData);\n\n          // Ensure the quantity is set correctly for the purchased amount\n          newItemObject.system.quantity = quantity; \n          \n          itemsToCreate.push(newItemObject);\n          \n          // Track info for container handling\n          newItemsInfo.push({\n            itemData: itemData,\n            uuid: uuid,\n            cartItemId: itemId\n          });\n        }\n      }\n    }\n    \n    window.GAS.log.d('[SHOP] Items to create:', itemsToCreate.length, 'Items to update:', itemsToUpdate.length);\n    \n    // Update existing items in a single batch\n    if (itemsToUpdate.length > 0) {\n       await actor.updateEmbeddedDocuments(\"Item\", itemsToUpdate);\n    }\n\n    // Create all new items in a single batch for better performance\n    if (itemsToCreate.length > 0) {\n      window.GAS.log.d('[SHOP] Creating', itemsToCreate.length, 'new items');\n      const createdItems = await actor.createEmbeddedDocuments(\"Item\", itemsToCreate);\n      window.GAS.log.d('[SHOP] Created items:', createdItems.length);\n      \n      // Handle container contents for each newly created item\n      for (let i = 0; i < createdItems.length; i++) {\n        const createdItem = createdItems[i];\n        const newItemInfo = newItemsInfo[i];\n        \n        if (newItemInfo) {\n          window.GAS.log.d('[SHOP] Processing item for container contents:', newItemInfo.itemData.name, 'Type:', newItemInfo.itemData.type, 'UUID:', newItemInfo.uuid);\n          \n          // Use the stored UUID to fetch the source item for container handling\n          if (newItemInfo.uuid) {\n            try {\n              const sourceItem = await fromUuid(newItemInfo.uuid);\n              if (sourceItem) {\n                await handleContainerContents(sourceItem, createdItem, actor);\n              } else {\n                window.GAS.log.d('[SHOP] Could not fetch source item from UUID:', newItemInfo.uuid);\n              }\n            } catch (error) {\n              console.error('Error handling container contents for shop item:', newItemInfo.itemData.name, error);\n            }\n          } else {\n            window.GAS.log.d('[SHOP] No UUID stored for item, skipping container handling');\n          }\n        }\n      }\n    }\n    \n    // Clear the cart\n    shopCart.set(new Map());\n    updateTotals(); // Recalculate totals (should be 0)\n\n    // Make the shop tab readonly\n    readOnlyTabs.update(tabs => [...tabs, 'shop']);\n    \n    return true;\n  } catch (error) {\n    console.error(\"Error finalizing purchase:\", error);\n    ui.notifications.error(\"Failed to complete purchase: \" + error.message);\n    return false;\n  }\n}\n","<script>\n  import { onMount } from \"svelte\";\n\n  export let progress;\n  \n  // Handle both store and plain values for progress\n  let progressValue = 0;\n  \n  $: {\n    if (typeof progress === 'object' && progress?.subscribe) {\n      // It's a store - subscribe to get the value\n      progress.subscribe(value => {\n        progressValue = value;\n      });\n    } else {\n      // It's a plain value - use directly\n      progressValue = progress;\n    }\n  }\n  \n  $: cssClass = progressValue == 0 ? \"center\" : \"\";\n  \n</script>\n<div class=\"progress\">\n  <div class=\"back\">{progressValue}% Complete</div>\n  <div class=\"front\" style=\"clip-path: inset(0 0 0 {progressValue}%); -webkit-clip-path: inset(0 0 0 {progressValue}%);\">{progressValue}% Complete</div>\n</div>\n<style lang=\"sass\">\n  @import '../../../styles/Mixins.sass'\n\n  .progress\n    position: relative\n    display: flex\n    border-radius: 5px\n    background-color: #e0e0e0\n    overflow: hidden\n\n  .back\n    display: flex\n    justify-content: center\n    align-items: center\n    width: 100%\n    background-color: rgba(10, 144, 50, 0.5)\n    color: white\n\n  .front\n    position: absolute\n    display: flex\n    justify-content: center\n    align-items: center\n    left: 0\n    right: 0\n    top: 0\n    bottom: 0\n    background: white\n    color: black\n    transition: clip-path 1s linear\n\n\n  \n</style>","import { isObject, klona } from '@typhonjs-fvtt/runtime/util/object';\n\n/**\n * Provides a helper class to determine the version of the Foundry platform starting a version `9`.\n *\n * Note: You must use any of these utility methods after the Foundry `init` hook.\n */\nclass FVTTVersion\n{\n   static #regexMajorVersion = /(\\d+)\\./;\n\n   /**\n    * Returns true when Foundry is at least the specific major version number provided.\n    *\n    * Note: `game` must be initialized for correct comparison; use after Foundry `init` hook.\n    *\n    * @param {number}   version - Major version to check against.\n    *\n    * @returns {boolean} Foundry version is at least the major version specified.\n    */\n   static isAtLeast(version)\n   {\n      if (globalThis.game?.version === void 0)\n      {\n         throw new Error(`FVTTVersion.isAtLeast error: Foundry VTT global 'game' object is not initialized.`);\n      }\n\n      if (!Number.isInteger(version) && version < 9)\n      {\n         throw new TypeError(`'version' is not a positive integer greater than or equals '9'.`);\n      }\n\n      return !globalThis.foundry.utils.isNewerVersion(version, globalThis.game.version);\n   }\n\n   /**\n    * Returns true when Foundry is inclusively between the min / max major version numbers provided.\n    *\n    * @param {number}   min - Major minimum version to check against.\n    *\n    * @param {number}   max - Major maximum version to check against.\n    *\n    * @returns {boolean} Foundry version is at least the major version specified.\n    */\n   static isBetween(min, max)\n   {\n      if (globalThis.game?.version === void 0)\n      {\n         throw new Error(`FVTTVersion.isBetween error: Foundry VTT global 'game' object is not initialized.`);\n      }\n\n      if (!Number.isInteger(min) && min < 9)\n      {\n         throw new TypeError(\n          `FVTTVersion.isBetween error: 'min' is not a positive integer greater than or equals '9'.`);\n      }\n\n      if (!Number.isInteger(max) && max < 9)\n      {\n         throw new TypeError(\n          `FVTTVersion.isBetween error: 'max' is not a positive integer greater than or equals '9'.`);\n      }\n\n      if (min > max)\n      {\n         throw new TypeError(`FVTTVersion.isBetween error: 'min' is greater than 'max'.`);\n      }\n\n      const match = this.#regexMajorVersion.exec(globalThis.game.version);\n      if (!match)\n      {\n         throw new Error(`FVTTVersion.isBetween error: Could not parse 'globalThis.game.version'.`);\n      }\n\n      const version = parseInt(match[1], 10);\n\n      return version >= min && version <= max;\n   }\n}\n\n/**\n * Loads FVTT core fonts supporting `FontConfig` on Foundry v10+.\n *\n * Note: This class contains code modified from Foundry VTT core client code. There are only so many ways to process\n * core Foundry data structures correctly.\n */\nclass FontManager\n{\n   /**\n    * Collect all the font definitions and combine them.\n    *\n    * @returns { {[key: string]: fvtt.FontFamilyDefinition}[] } Core font definitions.\n    */\n   static getCoreDefinitions()\n   {\n      /** @type { {[key: string]: fvtt.FontFamilyDefinition}[] } */\n      const fonts = [];\n\n      if (FVTTVersion.isAtLeast(11))\n      {\n         if (isObject(globalThis.CONFIG?.fontDefinitions))\n         {\n            fonts.push(klona(globalThis.CONFIG.fontDefinitions));\n         }\n\n         const coreFonts = globalThis.game?.settings.get('core', 'fonts');\n\n         if (Array.isArray(coreFonts))\n         {\n            fonts.push(klona(coreFonts));\n         }\n      }\n\n      FontManager.removeDuplicateDefinitions(fonts);\n\n      return fonts;\n   }\n\n   /**\n    * Load a font definition.\n    *\n    * @param {string}               fontSpecification - The font specification.\n    *\n    * @param {string}               family - The font family name (case-sensitive).\n    *\n    * @param {fvtt.FontFamilyDefinition} definition - The font family definition.\n    *\n    * @param {Document}             document - Target Document to load font into.\n    *\n    * @returns {Promise<boolean>} Returns true if the font was successfully loaded.\n    */\n   static async #loadFont(fontSpecification, family, definition, document)\n   {\n      try\n      {\n         for (const fontEntry of definition.fonts)\n         {\n            // Collect URLs from FontDefinition.\n            const urls = fontEntry.urls.map((url) => `url(\"${url}\")`).join(', ');\n\n            // Note: 'font' contains 'FontFaceDescriptors' data.\n            const fontFace = new FontFace(family, urls, fontEntry);\n            await fontFace.load();\n\n            document.fonts.add(fontFace);\n         }\n\n         await document.fonts.load(fontSpecification);\n      }\n      catch (err)\n      {\n         console.warn(`Font family \"${family}\" failed to load: `, err);\n         return false;\n      }\n\n      if (!document.fonts.check(fontSpecification))\n      {\n         console.warn(`Font family \"${family}\" failed to load.`);\n         return false;\n      }\n\n      return true;\n   }\n\n   /**\n    * Ensure that fonts have loaded and are ready for use.\n    * Enforce a maximum timeout in milliseconds.\n    * Proceed after that point even if fonts are not yet available.\n    *\n    * @param {object} [opts] - Optional parameters.\n    *\n    * @param {number} [opts.ms=4500] - The maximum time to spend loading fonts before proceeding.\n    *\n    * @param {Document} [opts.document] - The target document to load the fonts into.\n    *\n    * @param {boolean} [opts.editor=true] - When true verifies the `editor` field of {@link FontFamilyDefinition}.\n    *\n    * @param {(\n    *    {[key: string]: fvtt.FontFamilyDefinition}[] |\n    *    {[key: string]: fvtt.FontFamilyDefinition}\n    * )} [opts.fonts] - A custom set of font family definitions to load. If not defined the core font family definitions\n    *    are loaded.\n    *\n    * @returns {Promise<void>}\n    */\n   static async loadFonts({ ms = 4500, document = globalThis.document, editor = true, fonts } = {})\n   {\n      // TODO sanity checks\n\n      const allFonts = fonts ? Array.isArray(fonts) ? fonts : [fonts] : this.getCoreDefinitions();\n\n      const promises = [];\n\n      for (const definitions of allFonts)\n      {\n         if (isObject(definitions))\n         {\n            for (const [family, definition] of Object.entries(definitions))\n            {\n               // Don't load a font that is not marked to be used in the editor.\n               if (editor && (typeof definition.editor !== 'boolean' || !definition.editor)) { continue; }\n\n               const fontSpecification = `1rem \"${family}\"`;\n\n               // TODO: If there is a better / reliable way to check if a font is already loaded then implement below.\n               // `document.fonts.check` doesn't quite work for the intended purpose.\n               // Early out if the font is already loaded.\n               // if (document.fonts.check(fontSpecification)) { continue; }\n\n               promises.push(this.#loadFont(fontSpecification, family, definition, document));\n            }\n         }\n      }\n\n      const timeout = new Promise((resolve) => setTimeout(resolve, ms));\n      const ready = Promise.allSettled(promises).then(() => document.fonts.ready);\n\n      return Promise.race([ready, timeout]);\n   }\n\n   /**\n    * Removes duplicate font definitions.\n    *\n    * @param { {[key: string]: fvtt.FontFamilyDefinition}[] }  fonts - An array of FontFamilyDefinition objects\n    *        to process.\n    *\n    * @returns { {[key: string]: fvtt.FontFamilyDefinition}[] } Filtered font definitions.\n    */\n   static removeDuplicateDefinitions(fonts)\n   {\n      if (!Array.isArray(fonts))\n      {\n         throw new TypeError(`FontManager.removeDuplicateDefinitions error: 'fonts' is not an array.`);\n      }\n\n      const familySet = new Set();\n\n      for (const definitions of fonts)\n      {\n         if (!isObject(definitions))\n         {\n            throw new TypeError(`FontManager.removeDuplicateDefinitions error: 'definitions' is not an object.`);\n         }\n\n         for (const family of Object.keys(definitions))\n         {\n            // Remove duplicate from current definitions set.\n            if (familySet.has(family))\n            {\n               delete definitions[family];\n            }\n            else\n            {\n               familySet.add(family);\n            }\n         }\n      }\n\n      return fonts;\n   }\n}\n\n/**\n * Parses the core Foundry style sheet creating an indexed object of properties by selector.\n */\nclass FoundryStyles\n{\n   static #sheet = void 0;\n\n   /** @type {Map<string, {[key: string]: string}>} */\n   static #sheetMap = new Map();\n\n   static #initialized = false;\n\n   /**\n    * Called once on initialization / first usage. Parses the core foundry style sheet.\n    */\n   static #initialize()\n   {\n      this.#initialized = true;\n\n      const styleSheets = Array.from(document.styleSheets).filter((entry) => entry.href !== null);\n\n      let sheet;\n\n      const foundryStyleSheet = globalThis.foundry.utils.getRoute('/css/style.css');\n\n      // Find the core Foundry stylesheet.\n      for (const styleSheet of styleSheets)\n      {\n         let url;\n\n         try\n         {\n            url = new URL(styleSheet.href);\n         }\n         catch (err) { continue; }\n\n         if (typeof url.pathname === 'string' && url.pathname === foundryStyleSheet)\n         {\n            this.#sheet = sheet = styleSheet;\n            break;\n         }\n      }\n\n      // Quit now if the Foundry style sheet was not found.\n      if (!sheet) { return; }\n\n      // Parse each CSSStyleRule and build the map of selectors to parsed properties.\n      for (const rule of sheet.cssRules)\n      {\n         if (!(rule instanceof CSSStyleRule)) { continue; }\n\n         const obj = {};\n\n         // Parse `cssText` into an object of properties & values.\n         for (const entry of rule.style.cssText.split(';'))\n         {\n            const parts = entry.split(':');\n\n            // Sanity check.\n            if (parts.length < 2) { continue; }\n\n            obj[parts[0].trim()] = parts[1].trim();\n         }\n\n         this.#sheetMap.set(rule.selectorText, obj);\n      }\n   }\n\n   /**\n    * Gets the properties object associated with the selector. Try and use a direct match otherwise all keys\n    * are iterated to find a selector string that includes the `selector`.\n    *\n    * @param {string}   selector - Selector to find.\n    *\n    * @returns { {[key: string]: string} } Properties object.\n    */\n   static getProperties(selector)\n   {\n      if (!this.#initialized) { this.#initialize(); }\n\n      // If there is a direct selector match then return a value immediately.\n      if (this.#sheetMap.has(selector))\n      {\n         return this.#sheetMap.get(selector);\n      }\n\n      for (const key of this.#sheetMap.keys())\n      {\n         if (key.includes(selector)) { return this.#sheetMap.get(key); }\n      }\n\n      return void 0;\n   }\n\n   /**\n    * Gets a specific property value from the given `selector` and `property` key. Try and use a direct selector\n    * match otherwise all keys are iterated to find a selector string that includes `selector`.\n    *\n    * @param {string}   selector - Selector to find.\n    *\n    * @param {string}   property - Specific property to locate.\n    *\n    * @returns {string|undefined} Property value.\n    */\n   static getProperty(selector, property)\n   {\n      if (!this.#initialized) { this.#initialize(); }\n\n      // If there is a direct selector match then return a value immediately.\n      if (this.#sheetMap.has(selector))\n      {\n         const data = this.#sheetMap.get(selector);\n         return isObject(data) && property in data ? data[property] : void 0;\n      }\n\n      for (const key of this.#sheetMap.keys())\n      {\n         if (key.includes(selector))\n         {\n            const data = this.#sheetMap.get(key);\n            if (isObject(data) && property in data) { return data[property]; }\n         }\n      }\n\n      return void 0;\n   }\n}\n\nexport { FVTTVersion, FontManager, FoundryStyles };\n//# sourceMappingURL=index.js.map\n","import { SvelteApp }  from '@typhonjs-fvtt/runtime/svelte/application';\nimport { TJSStyleManager }    from '@typhonjs-fvtt/runtime/util/dom/style';\nimport { isObject }           from '@typhonjs-fvtt/runtime/util/object';\n\nimport { FoundryStyles }      from '@typhonjs-fvtt/standard/fvtt';\n\n/**\n * Provides global CSS variable configuration based on Foundry styles loaded.\n */\nclass FVTTConfigure\n{\n   static #initialized = false;\n\n   static initialize()\n   {\n      if (this.#initialized) { return; }\n\n      const cssVariables = new TJSStyleManager({ docKey: '#__tjs-root-styles', version: 1.1 });\n\n      this.#initialized = true;\n\n      // -------------------------------------------------------------------------------------------------------------\n\n      /**\n       * Assign all TyphonJS thematic CSS variables.\n       */\n\n      cssVariables.setProperties({\n         // For components w/ transparent background checkered pattern.\n         '--tjs-checkerboard-background-dark': 'rgb(205, 205, 205)',\n         '--tjs-checkerboard-background-10': `url('data:image/svg+xml;utf8,<svg preserveAspectRatio=\"none\"  viewBox=\"0 0 10 10\" xmlns=\"http://www.w3.org/2000/svg\"><rect x=\"0\" y=\"0\" width=\"5\" height=\"5\" fill=\"transparent\" /><rect x=\"5\" y=\"5\" width=\"5\" height=\"5\" fill=\"transparent\" /><rect x=\"5\" y=\"0\" width=\"5\" height=\"5\" fill=\"white\" /><rect x=\"0\" y=\"5\" width=\"5\" height=\"5\" fill=\"white\" /></svg>') 0 0 / 10px 10px, var(--tjs-checkerboard-background-dark, rgb(205, 205, 205))`\n      }, false);\n\n      // -------------------------------------------------------------------------------------------------------------\n\n      /**\n       * Assign all TyphonJS CSS variables to Foundry defaults.\n       */\n\n      cssVariables.setProperties({\n         '--tjs-action-ripple-background': 'rgba(0, 0, 0, 0.35)'\n      }, false);\n\n      // -------------------------------------------------------------------------------------------------------------\n\n      cssVariables.setProperties({\n         '--tjs-icon-button-background-hover': 'rgba(0, 0, 0, 0.10)',\n         '--tjs-icon-button-background-selected': 'rgba(0, 0, 0, 0.20)',\n      }, false);\n\n      {\n         /**\n          * All input related components including: TJSSelect,\n          */\n         const props = FoundryStyles.getProperties('input[type=\"text\"], input[type=\"number\"]');\n\n         if (isObject(props))\n         {\n            cssVariables.setProperties({\n               '--tjs-input-background': 'background' in props ? props.background : 'rgba(0, 0, 0, 0.05)',\n               '--tjs-input-border': 'border' in props ? props.border : '1px solid var(--color-border-light-tertiary)',\n               '--tjs-input-border-radius': 'border-radius' in props ? props['border-radius'] : '3px',\n               '--tjs-input-height': 'height' in props ? props.height : 'var(--form-field-height)',\n               '--tjs-input-min-width': 'min-width' in props ? props['min-width'] : '20px',\n               '--tjs-input-padding': 'padding' in props ? props['padding'] : '1px 3px',\n               '--tjs-input-width': 'width' in props ? props.width : 'calc(100% - 2px)',\n\n               // Set default values that are only to be referenced and not set.\n               '--_tjs-default-input-height': 'height' in props ? props.height : 'var(--form-field-height)',\n\n               // Set directly / no lookup:\n               '--tjs-input-border-color': 'var(--color-border-light-tertiary)',\n            }, false);\n         }\n      }\n\n      {\n         /**\n          * Input range specific variables for track and thumb,\n          */\n         const propsTrack = FoundryStyles.getProperties('input[type=\"range\"]::-webkit-slider-runnable-track');\n         const propsTrackFocus = FoundryStyles.getProperties('input[type=\"range\"]:focus::-webkit-slider-runnable-track');\n\n         const propsThumb = FoundryStyles.getProperties('input[type=\"range\"]::-webkit-slider-thumb');\n         const propsThumbFocus = FoundryStyles.getProperties('input[type=\"range\"]:focus::-webkit-slider-thumb');\n\n         if (isObject(propsTrack))\n         {\n            cssVariables.setProperties({\n               '--tjs-input-range-slider-track-box-shadow': 'box-shadow' in propsTrack ? propsTrack['box-shadow'] : '1px 1px 1px #000000, 0px 0px 1px #0d0d0d'\n            }, false);\n         }\n\n         if (isObject(propsTrackFocus))\n         {\n            cssVariables.setProperties({\n               '--tjs-input-range-slider-track-box-shadow-focus': 'box-shadow' in propsTrackFocus ? propsTrackFocus['box-shadow'] : '1px 1px 1px #000000, 0px 0px 1px #0d0d0d'\n            }, false);\n         }\n\n         if (isObject(propsThumb))\n         {\n            cssVariables.setProperties({\n               '--tjs-input-range-slider-thumb-box-shadow': 'box-shadow' in propsThumb ? propsThumb['box-shadow'] : '0 0 5px var(--color-shadow-primary)'\n            }, false);\n         }\n\n         if (isObject(propsThumbFocus))\n         {\n            cssVariables.setProperties({\n               '--tjs-input-range-slider-thumb-box-shadow-focus': 'box-shadow' in propsThumbFocus ? propsThumbFocus['box-shadow'] : '0 0 5px var(--color-shadow-primary)'\n            }, false);\n         }\n      }\n\n      cssVariables.setProperties({\n         // `popup` is for components that are slightly elevated, but connected to an application;\n         // see: TJSMenu / TJSContextMenu / TJSColordPicker\n         '--tjs-default-popup-background': 'var(--color-text-dark-header, #23221d)',\n         '--tjs-default-popup-border': '1px solid var(--color-border-dark, #000)',\n         '--tjs-default-popup-box-shadow': '0 0 2px var(--color-shadow-dark, #000)',\n         '--tjs-default-popup-primary-color': 'var(--color-text-light-primary, #b5b3a4)',\n         '--tjs-default-popup-highlight-color': 'var(--color-text-light-highlight, #f0f0e0)',\n\n         // `popover` is for components that are elevated and independent; see: TJSContextMenu\n         '--tjs-default-popover-border': '1px solid var(--color-border-dark, #000)',\n         '--tjs-default-popover-box-shadow': '0 0 10px var(--color-shadow-dark, #000)',\n      }, false);\n\n      // Handle `PopOut!` module hooks to allow applications to popout to their own browser window -------------------\n\n      Hooks.on('PopOut:loading', (app, popout) =>\n      {\n         if (app instanceof SvelteApp)\n         {\n            // Clone and load `svelte-standard` CSS variables into new window document.\n            popout.document.addEventListener('DOMContentLoaded', () => cssVariables.clone(popout.document));\n         }\n      });\n   }\n}\n\nFVTTConfigure.initialize();\n","<script>\n  import { getContext, onDestroy, onMount, tick } from \"svelte\";\n  import { get } from \"svelte/store\";\n  import { MODULE_ID } from \"~/src/helpers/constants\";\n  import {\n    race,\n    abilities,\n    characterClass,\n    characterSubClass,\n    background,\n    spells,\n    subRace,\n    isActorCreated,\n    isLevelUp,\n    activeTab,\n    dropItemRegistry,\n    actorInGame,\n    isNewMultiClass,\n    abilityRolls,\n    isStandardArrayValues,\n    subClassesForClass,\n    preAdvancementSelections,\n    hasCharacterCreationChanges,\n    changedCharacterCreationItems,\n    level,\n    tabs,\n    classUuidForLevelUp,\n    subClassUuidForLevelUp,\n    levelUpClassObject,\n    levelUpSubClassObject,\n    levelUpClassGetsSubclassThisLevel,\n    isNewMultiClassSelected,\n    readOnlyTabs\n  } from \"~/src/stores/index\";\n  import { progress } from \"~/src/stores/progress\";\n  import { flattenedSelections } from \"~/src/stores/equipmentSelections\";\n  import { flattenedStartingEquipment } from \"~/src/stores/startingEquipment\";\n  import { goldChoices, totalGoldFromChoices, areGoldChoicesComplete } from \"~/src/stores/goldChoices\";\n  import { shopCart, cartTotalCost, remainingGold, finalizePurchase } from '~/src/stores/equipmentShop';\n  import { spellProgress, spellLimits, currentSpellCounts } from '~/src/stores/spellSelection';\n  import { getLevelUpFSM, LEVELUP_EVENTS } from \"~/src/helpers/LevelUpStateMachine\";\n  import { getWorkflowFSM, WORKFLOW_EVENTS } from \"~/src/helpers/WorkflowStateMachine\";\n  \n  import {\n    getLevelByDropType,\n    itemHasAdvancementChoices,\n    isAdvancementsForLevelInItem,\n    dropItemOnCharacter\n  } from \"~/src/helpers/Utility\";\n  import ProgressBar from \"~/src/components/molecules/ProgressBar.svelte\";\n  import { abilityGenerationMethod } from \"~/src/stores/index\";\n  import { derived, writable } from \"svelte/store\";\n  import { localize as t } from \"~/src/helpers/Utility\";\n  import { TJSSelect } from \"@typhonjs-fvtt/standard/component/form\";\n  import { equipmentSelections } from \"~/src/stores/equipmentSelections\";\n  import { goldRoll } from \"~/src/stores/storeDefinitions\";\n  \n\n  // Import workflow functions\n  import {\n    createActorInGameAndEmbedItems as createActorWorkflow,\n    updateActorAndEmbedItems as updateActorWorkflow,\n    updateActorLevelUpWorkflow,\n    handleAddEquipment as addEquipmentWorkflow,\n    handleFinalizePurchase as finalizePurchaseWorkflow,\n    handleFinalizeSpells as finalizeSpellsWorkflow,\n    checkActorInventory as checkInventory,\n    handleCharacterUpdate as characterUpdateWorkflow,\n    handleSkipSpellsLevelUp\n  } from \"~/src/lib/workflow\";\n\n  // Add a flag to track if equipment has been added during this session\n  let hasAddedEquipmentThisSession = false;\n  \n  // Debug logging for button visibility\n  // $: {\n  //   if ($activeTab === 'equipment') {\n  //     window.GAS.log.d('[FOOTER] Equipment button visibility check:', {\n  //       isEquipmentComplete,\n  //       equipmentReadonly: $readOnlyTabs.includes('equipment'),\n  //       shouldShowButton: isEquipmentComplete && !$readOnlyTabs.includes('equipment')\n  //     });\n  //   }\n  // }\n\n  // Add state for processing purchase\n  const isProcessingPurchase = writable(false);\n\n  // Add state for processing spells\n  const isProcessingSpells = writable(false);\n\n  // Add state for processing feat spells\n  const isProcessingFeatSpells = writable(false);\n\n  // Store references for workflow functions\n  const storeRefs = {\n    race,\n    subRace,\n    background,\n    characterClass,\n    characterSubClass,\n    isLevelUp,\n    isNewMultiClass,\n    preAdvancementSelections,\n    actorInGame,\n    classUuidForLevelUp,\n    subClassUuidForLevelUp,\n    levelUpClassObject,\n    levelUpSubClassObject,\n    flattenedSelections,\n    tabs,\n    activeTab,\n    readOnlyTabs,\n    totalGoldFromChoices,\n    goldRoll,\n    cartTotalCost,\n    remainingGold,\n    finalizePurchase,\n    hasCharacterCreationChanges,\n    changedCharacterCreationItems\n  };\n\n  // Derived store for level-up progress\n  const levelUpProgress = derived(\n    [classUuidForLevelUp, levelUpClassGetsSubclassThisLevel, subClassUuidForLevelUp],\n    ([$classUuidForLevelUp, $levelUpClassGetsSubclassThisLevel, $subClassUuidForLevelUp]) => {\n\n      window.GAS.log.d('levelUpProgress', $classUuidForLevelUp, $levelUpClassGetsSubclassThisLevel, $subClassUuidForLevelUp);\n      // If a new multiclass is selected, show 100% progress\n      if ($classUuidForLevelUp && $levelUpClassGetsSubclassThisLevel && !$subClassUuidForLevelUp) return 50;\n      if ($classUuidForLevelUp && $levelUpClassGetsSubclassThisLevel && $subClassUuidForLevelUp) return 100;\n      if ($classUuidForLevelUp && !$levelUpClassGetsSubclassThisLevel) return 100;\n      \n      return 0\n    }\n  );\n\n  export let value = null;\n\n  const actor = getContext(\"#doc\");\n  const app = getContext(\"#external\").application;\n  let actorName = $actor?.name || \"\";\n\n  // Derived store to check if actor has items in inventory\n  const hasInventoryItems = derived(actorInGame, ($actorInGame) => {\n    if (!$actorInGame) return false;\n    \n    // Check if the actor has any items\n    // In Foundry VTT, items is a Collection that has methods like filter and size\n    const inventoryTypes = [\"weapon\", \"equipment\", \"consumable\", \"tool\", \"backpack\", \"loot\"];\n    \n    // First check if items collection exists and has any items\n    if (!$actorInGame.items || $actorInGame.items.size === 0) {\n      // window.GAS.log.d('[FOOTER] No items found on actor');\n      return false;\n    }\n    \n    // Use the Foundry Collection's filter method\n    const inventoryItems = $actorInGame.items.filter(item => inventoryTypes.includes(item.type));\n    const hasItems = inventoryItems.size > 0;\n    \n    // window.GAS.log.d('[FOOTER] hasInventoryItems check:', {\n    //   actorId: $actorInGame.id,\n    //   totalItems: $actorInGame.items.size,\n    //   inventoryItems: inventoryItems,\n    //   inventoryItemCount: inventoryItems.size,\n    //   hasItems: hasItems\n    // });\n    \n    return hasItems;\n  });\n\n  const handleNameInput = (e) => {\n    if ($isLevelUp) {\n      //- @why: for existing actors, we need to update the actor object in the database\n      actorName = e.target.value;\n    } else {\n      //- @why: for new actors, we need to update the actor source object in memory,\n      $actor.updateSource({ name: e.target.value });\n    }\n  };\n  const handleTokenNameInput = (e) => {\n    if (!$actor.flags[MODULE_ID]) $actor.flags[MODULE_ID] = {};\n    $actor.flags[MODULE_ID].tokenName = e.target.value;\n  };\n  //- Create Actor\n  const clickCreateHandler = async () => {\n    await createActorWorkflow({\n      actor,\n      stores: storeRefs,\n      dropItemRegistry\n    });\n    $isActorCreated = true;\n  };\n\n  const clickUpdateLevelUpHandler = async () => {\n    window.GAS.log.d('[FOOTER] clickUpdateLevelUpHandler', $classUuidForLevelUp);\n    \n    await updateActorLevelUpWorkflow({\n      actor,\n      actorName,\n      stores: storeRefs,\n      dropItemRegistry\n    });\n  };\n\n  const clickUpdateHandler = async () => {\n    await characterUpdateWorkflow({\n      stores: storeRefs,\n      dropItemRegistry\n    });\n  };\n\n  $: value = $actor?.name || \"\";\n  $: tokenValue = $actor?.flags?.[MODULE_ID]?.tokenName || value;\n\n  // Define valid tabs for footer visibility\n  const FOOTER_TABS = ['race', 'class', 'background', 'abilities', 'equipment', 'level-up', 'shop', 'spells'];\n  const CHARACTER_CREATION_TABS = ['race', 'class', 'background', 'abilities'];\n\n  // Handle adding equipment to the actor\n  const handleAddEquipment = async () => {\n    await addEquipmentWorkflow({\n      stores: storeRefs,\n      actorInGame,\n      onEquipmentAdded: () => {\n        hasAddedEquipmentThisSession = true;\n        window.GAS.log.d('[FOOTER] Equipment added to actor');\n      }\n    });\n  };\n\n  // Derive whether equipment section is complete\n  $: isEquipmentComplete = window.GAS.dnd5eVersion >= 4 \n    ? ($progress === 100 && $areGoldChoicesComplete) \n    : ($progress === 100 && $goldRoll > 0);\n  \n  // Debug log for button visibility condition\n  $: {\n    if ($activeTab === 'equipment') {\n      // window.GAS.log.d('[FOOTER] Button visibility check:', {\n      //   isEquipmentComplete,\n      //   hasInventoryItems: $hasInventoryItems,\n      //   equipmentCompleted: $completedTabs.equipment,\n      //   shouldShowButton: isEquipmentComplete && !$completedTabs.equipment\n      // });\n    }\n  }\n\n  // Check actor inventory when actorInGame changes and set completion state\n  $: if ($actorInGame) {\n    // If equipment has already been added this session, don't change the flag\n    if (!hasAddedEquipmentThisSession) {\n              if (checkInventory($actorInGame)) {\n          // Actor already has inventory items\n          window.GAS.log.d('[FOOTER] Actor already has inventory items');\n        }\n    }\n  }\n\n  // Handle finalizing purchases in the shop\n  async function handleFinalizePurchase() {\n    // Prevent multiple clicks\n    if (get(isProcessingPurchase)) return;\n    \n    await finalizePurchaseWorkflow({\n      stores: storeRefs,\n      setProcessing: (value) => isProcessingPurchase.set(value)\n    });\n  }\n\n  // Handle finalizing spell selection\n  async function handleFinalizeSpells() {\n    // Prevent multiple clicks\n    if (get(isProcessingSpells)) return;\n    \n    await finalizeSpellsWorkflow({\n      stores: storeRefs,\n      setProcessing: (value) => isProcessingSpells.set(value)\n    });\n  }\n\n  // Handle skipping spells in level-up mode\n  async function handleSkipSpells() {\n    await handleSkipSpellsLevelUp({\n      stores: storeRefs\n    });\n  }\n\n  // Handle feat spell completion\n  async function handleCompleteFeatSpells() {\n    isProcessingFeatSpells.set(true);\n    try {\n      const actor = get(actorInGame);\n      const isLevelUpWorkflow = get(isLevelUp);\n      \n      if (isLevelUpWorkflow) {\n        const levelUpFSM = getLevelUpFSM();\n        levelUpFSM.handle(LEVELUP_EVENTS.FEAT_SPELLS_COMPLETE);\n      } else {\n        const workflowFSM = getWorkflowFSM();\n        workflowFSM.handle(WORKFLOW_EVENTS.FEAT_SPELLS_COMPLETE);\n      }\n    } catch (err) {\n      window.GAS.log.e('[FOOTER] Error completing feat spell selection:', err);\n      ui.notifications?.error(err.message);\n    } finally {\n      isProcessingFeatSpells.set(false);\n    }\n  }\n\n  // Handle skipping feat spells\n  async function handleSkipFeatSpells() {\n    const isLevelUpWorkflow = get(isLevelUp);\n    \n    if (isLevelUpWorkflow) {\n      const levelUpFSM = getLevelUpFSM();\n      levelUpFSM.handle(LEVELUP_EVENTS.SKIP_FEAT_SPELLS);\n    } else {\n      const workflowFSM = getWorkflowFSM();\n      workflowFSM.handle(WORKFLOW_EVENTS.SKIP_FEAT_SPELLS);\n    }\n  }\n\n  // Function to generate a random color\n  function getRandomColor() {\n    const letters = '0123456789ABCDEF';\n    let color = '#';\n    for (let i = 0; i < 6; i++) {\n      color += letters[Math.floor(Math.random() * 16)];\n    }\n    return color;\n  }\n\n  // Array of font families\n  const fontFamilies = [\n    'Gruppo',\n    'Bad Script',\n    'Kumar One Outline',\n    'League Script',\n    'Monoton',\n    'Sriracha',\n    'Yellowtail'\n  ];\n\n  let selectedFontFamily;\n  let inputClass;\n\n  // Check if experimental styling is enabled\n  $: experimentalStylingEnabled = game.settings.get(MODULE_ID, 'experimentalCharacterNameStyling');\n  \n  // Clean up experimental styles when disabled\n  $: if (!experimentalStylingEnabled) {\n    // Reset CSS custom properties\n    document.documentElement.style.removeProperty('--random-font-family');\n    document.documentElement.style.removeProperty('--background-color1');\n    document.documentElement.style.removeProperty('--background-color2');\n    document.documentElement.style.removeProperty('--sign-color1');\n    document.documentElement.style.removeProperty('--sign-color2');\n    inputClass = '';\n  }\n\n  // Function to randomize font and colors (only if experimental styling is enabled)\n  function randomize() {\n    if (!experimentalStylingEnabled) return;\n    \n    // Randomly select a font family\n    selectedFontFamily = fontFamilies[Math.floor(Math.random() * fontFamilies.length)];\n    document.documentElement.style.setProperty('--random-font-family', selectedFontFamily);\n\n    // Get random colors for the background and sign\n    const backgroundColor1 = getRandomColor();\n    const backgroundColor2 = getRandomColor();\n    const signColor1 = getRandomColor();\n    const signColor2 = getRandomColor();\n\n    // Set the colors in the style\n    document.documentElement.style.setProperty('--background-color1', backgroundColor1);\n    document.documentElement.style.setProperty('--background-color2', backgroundColor2);\n    document.documentElement.style.setProperty('--sign-color1', signColor1);\n    document.documentElement.style.setProperty('--sign-color2', signColor2);\n\n    // Set the input padding based on the selected font family\n    inputClass = (selectedFontFamily === 'Kumar One Outline' || selectedFontFamily === 'League Script') \n      ? 'lowered' \n      : '';\n  }\n\n  onMount(() => {\n    // Only apply experimental animations if enabled\n    if (experimentalStylingEnabled) {\n      const signs = document.querySelectorAll('.x-sign')\n      const backgrounds = document.querySelectorAll('.x-background')\n      const randomIn = (min, max) => (\n        Math.floor(Math.random() * (max - min + 1) + min)\n      )\n\n      const mixupInterval = (el, val1, val2) => {\n        const ms = randomIn(val1, val2)\n        el.style.setProperty('--interval', `${ms}ms`)\n      }\n\n      // Store handler references for cleanup\n      const signHandlers = [];\n      signs.forEach(el => {\n        mixupInterval(el, 2000, 3000)\n        const handler = () => {\n          mixupInterval(el, 2000, 3000)\n        };\n        el.addEventListener('webkitAnimationIteration', handler);\n        signHandlers.push({ el, handler });\n      })\n      // backgrounds.forEach(el => {\n      //   mixupInterval(el, 10000, 10001)\n      //   el.addEventListener('webkitAnimationIteration', () => {\n      //     mixupInterval(el, 10000, 10001)\n      //   })\n      // })\n\n      randomize(); // Call randomize on mount\n\n      // Cleanup listeners on destroy\n      onDestroy(() => {\n        signHandlers.forEach(({ el, handler }) => {\n          el.removeEventListener('webkitAnimationIteration', handler);\n        });\n      });\n    }\n  });\n</script>\n\n<template lang=\"pug\">\n.footer-container\n  +if(\"FOOTER_TABS.includes($activeTab)\")\n    .flexrow.gap-10.pr-md.mt-sm\n      //- Character name section (not available in level-up tab)\n      +if(\"CHARACTER_CREATION_TABS.includes($activeTab) && $activeTab !== 'level-up'\")\n        .flex2\n          .flexcol\n            .flexrow.gap-10\n              .flex0.right.mt-xs.no-wrap.ml-md\n                label.character-name-label(\n                  on:click=\"{randomize}\" \n                  class:experimental-label=\"{experimentalStylingEnabled}\"\n                ) {t('Footer.CharacterName')}\n              .flex2\n                .character-name-input-container(\n                  class:x-background=\"{experimentalStylingEnabled}\"\n                  class=\"{inputClass}\"\n                )\n                  input.left.character-name-input(\n                    class:x-sign=\"{experimentalStylingEnabled}\"\n                    type=\"text\" \n                    value=\"{value}\" \n                    on:input=\"{handleNameInput}\"\n                    disabled=\"{$isActorCreated}\"\n                  )\n      \n      //- Progress and buttons section\n      .flex1\n        +if(\"$isLevelUp && $activeTab === 'level-up'\")\n          .progress-container\n            ProgressBar(progress=\"{levelUpProgress}\")\n            +if(\"$levelUpProgress === 100 && !$readOnlyTabs.includes('level-up')\")\n              .button-container.mt-xs\n                button(\n                  disabled=\"{!$classUuidForLevelUp}\"\n                  type=\"button\"\n                  role=\"button\"\n                  on:mousedown=\"{clickUpdateLevelUpHandler}\"\n                  data-tooltip=\"{$classUuidForLevelUp ? '' : 'First select a class to level up, or a multi-class to add'}\"\n                )\n                  span {t('Footer.AddLevel')}\n                  i.right.ml-md(class=\"fas fa-chevron-right\")\n        \n        +if(\"$activeTab === 'equipment'\")\n          .progress-container\n            +if(\"$readOnlyTabs.includes('equipment')\")\n              ProgressBar(progress=\"{100}\")\n              +else()\n                ProgressBar(progress=\"{progress}\")\n                +if(\"isEquipmentComplete\")\n                  .button-container\n                    button.mt-xs(\n                      type=\"button\"\n                      role=\"button\"\n                      on:mousedown=\"{handleAddEquipment}\"\n                    )\n                      span {t('Footer.AddEquipment')}\n                      i.right.ml-md(class=\"fas fa-chevron-right\")\n\n        +if(\"$activeTab === 'shop'\")\n          .progress-container\n            +if(\"$readOnlyTabs.includes('shop')\")\n              ProgressBar(progress=\"{100}\")\n              +else()\n                .button-container\n                  button.mt-xs(\n                    type=\"button\"\n                    role=\"button\"\n                    on:mousedown=\"{handleFinalizePurchase}\"\n                    disabled=\"{$isProcessingPurchase}\" \n                  )\n                    span {t('Footer.FinalizePurchase')}\n                    i.right.ml-md(class=\"fas fa-chevron-right\")\n\n        +if(\"$activeTab === 'spells'\")\n          .progress-container\n            +if(\"$readOnlyTabs.includes('spells')\")\n              ProgressBar(progress=\"{100}\")\n              +else()\n                ProgressBar(progress=\"{$spellProgress.progressPercentage}\")\n                +if(\"$spellProgress.progressPercentage === 100\")\n                  .button-container\n                    button.mt-xs(\n                      type=\"button\"\n                      role=\"button\"\n                      on:mousedown=\"{handleFinalizeSpells}\"\n                      disabled=\"{$isProcessingSpells}\" \n                    )\n                      span {t('Footer.FinalizeSpells')}\n                      i.right.ml-md(class=\"fas fa-chevron-right\")\n                  +elseif(\"$isLevelUp\")\n                    // Show skip button when spells are not complete in level-up mode\n                    .button-container\n                      button.mt-xs.secondary(\n                        type=\"button\"\n                        role=\"button\"\n                        on:mousedown=\"{handleSkipSpells}\"\n                        data-tooltip=\"{t('Footer.SkipSpells')}\"\n                      )\n                        span {t('Footer.SkipSpells')}\n                        i.right.ml-md(class=\"fas fa-chevron-right\")\n\n        +if(\"$activeTab === 'feat-spells'\")\n          .progress-container\n            .button-container\n              button.mt-xs(\n                type=\"button\"\n                role=\"button\"\n                on:mousedown=\"{handleCompleteFeatSpells}\"\n                disabled=\"{$isProcessingFeatSpells}\"\n              )\n                span {t('Complete')}\n                i.right.ml-md(class=\"fas fa-chevron-right\")\n              +if(\"$isLevelUp\")\n                button.mt-xs.secondary(\n                  type=\"button\"\n                  role=\"button\"\n                  on:mousedown=\"{handleSkipFeatSpells}\"\n                  data-tooltip=\"{t('Skip')}\"\n                )\n                  span {t('Skip')}\n                  i.right.ml-md(class=\"fas fa-chevron-right\")\n              \n        +if(\"CHARACTER_CREATION_TABS.includes($activeTab)\")\n          .progress-container\n            +if(\"$readOnlyTabs.includes($activeTab)\")\n              ProgressBar(progress=\"{100}\")\n              +else()\n                ProgressBar(progress=\"{progress}\")\n                +if(\"$progress === 100\")\n                  .button-container\n                    +if(\"!$isActorCreated\")\n                      button.mt-xs.wide(\n                        type=\"button\"\n                        role=\"button\"\n                        on:mousedown=\"{clickCreateHandler}\"\n                      )\n                        span {t('Footer.CreateCharacter')}\n                        i.right.ml-md(class=\"fas fa-chevron-right\")\n                      +elseif(\"$hasCharacterCreationChanges\")\n                        button(\n                          type=\"button\"\n                          role=\"button\"\n                          on:mousedown=\"{clickUpdateHandler}\"\n                        )\n                          span {t('Footer.UpdateCharacter')}\n                          i.right.ml-md(class=\"fas fa-chevron-right\")\n\n</template>\n\n<style lang=\"sass\">\n.button-container\n  button\n    white-space: nowrap\n    width: 100%\n.gap-10\n  gap: 10px\n  justify-content: space-between\n  align-items: center\nlabel\n  margin: 10px 0 0 0\nbutton[disabled]\n  cursor: not-allowed\n  background-color: #ccc\n  color: #666\n  border: 1px solid #ccc\n  &:hover\n    background-color: #ccc\n    color: #666\n.hint\n  font-size: 0.8em\n  color: var(--color-text-dark-secondary)\n  text-align: center\n  margin-top: 0.5rem\n.character-name-input-container\n  height: 51px\n  padding: 1rem 1rem 1rem 1rem\n  font-size: xx-large\n  font-family: var(--dnd5e-font-modesto)\n  border: 1px solid #ccc\n  border-radius: 5px\n  display: flex\n  align-items: center\n  justify-content: flex-start\n  \n  // Default non-experimental styling\n  background: rgba(1, 1, 1, 0.1)\n  box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2)\n\n.footer-container .character-name-input-container input[type=\"text\"].character-name-input\n  border: none !important\n  background: none !important\n  height: auto !important\n  line-height: normal !important\n  padding: 0 !important\n  margin: 0 !important\n  color: inherit !important\n  font-family: inherit !important\n  font-size: 2rem\n  \n  &:focus\n    outline: none\n    box-shadow: none\n  \n  &:disabled\n    color: var(--color-text-dark-secondary)\n    cursor: not-allowed\n    opacity: 0.6\n  \n  // Experimental styling (when x-sign class is applied)\n  &.x-sign\n    text-shadow: 0 0 10px var(--sign-color1), 0 0 20px var(--sign-color2)\n    will-change: filter, color\n    filter: saturate(30%)\n    animation: flicker steps(100) var(--interval) 1s infinite\n    color: white\n    font-family: var(--random-font-family)\n.character-name-label\n  cursor: pointer\n  font-size: 1.2rem\n  font-weight: 600\n  color: var(--color-text-dark-secondary)\n  vertical-align: top\n  line-height: 0.6rem\n  white-space: break-spaces\n  \n  &.experimental-label\n    color: var(--color-highlight)\n\n.x-background\n  --interval: 13s\n  background: linear-gradient(to right, var(--background-color1), var(--background-color2)) !important\n\n.x-sign\n  --interval: 1s\n  display: block\n\n.lowered\n  padding: 1.5rem 1rem 1rem 1rem\n\n\n@keyframes flicker\n  50%\n    color: white\n    filter: saturate(200%) hue-rotate(20deg)\n</style>\n","<script>\n  import { ApplicationShell }   from '@typhonjs-fvtt/runtime/svelte/component/application';\n  import { setContext, getContext, onMount, onDestroy } from \"svelte\";\n  import { characterClass, characterSubClass, resetStores, tabs, isLevelUp, levelUpTabs, activeTab, actorInGame, readOnlyTabs } from \"~/src/stores/index\"\n  import Tabs from \"~/src/components/molecules/Tabs.svelte\";\n  import Footer from \"~/src/components/molecules/Footer.svelte\";\n  import dnd5e from \"~/config/systems/dnd5e.json\"\n  import Spells from \"~/src/components/organisms/dnd5e/Tabs/Spells.svelte\";\n  import Equipment from \"~/src/components/organisms/dnd5e/Tabs/Equipment.svelte\";\n  import { log } from '~/src/helpers/Utility';\n  import { MODULE_ID } from \"~/src/helpers/constants\";\n  import { getWorkflowFSM, workflowFSMContext, WORKFLOW_EVENTS } from '~/src/helpers/WorkflowStateMachine';\n  import { getLevelUpFSM, levelUpFSMContext, LEVELUP_EVENTS } from '~/src/helpers/LevelUpStateMachine';\n\n  export let elementRoot; //- passed in by SvelteApplication\n  export let documentStore; //- passed in by DocumentSheet.js where it attaches DocumentShell to the DOM body\n  export let document; //- passed in by DocumentSheet.js where it attaches DocumentShell to the DOM body\n  export let levelUp = false;\n\n  //- register hooks\n  // console.log('[PCAPP] Registering gas.close hook (once)');\n  Hooks.once(\"gas.close\", gasClose);\n  // console.log('[PCAPP] Registering gas.equipmentSelection hook (persistent)');\n  Hooks.on(\"gas.equipmentSelection\", handleEquipmentSelection);\n  \n\n  setContext(\"#doc\", documentStore);\n\n  const application = getContext('#external').application;\n  \n  // set initial active tab\n  $activeTab = levelUp ? $levelUpTabs[0].id : $tabs[0].id\n\n  $: {\n    // console.log('[PCAPP] Reactive filteredTabs changed:', filteredTabs);\n    // console.log('[PCAPP] Current activeTab:', $activeTab);\n    // console.log('[PCAPP] Tab with id \"equipment\" exists:', filteredTabs.find(t => t.id === 'equipment'));\n  }\n\n  $: filteredTabs = levelUp ? $levelUpTabs : $tabs\n\n  // Get illumination settings\n  const illuminatedHeight = Number(game.settings.get(MODULE_ID, 'illuminatedHeight').replace(/[a-zA-Z]/g, '')) + 'px';\n  const illuminatedWidth = Number(game.settings.get(MODULE_ID, 'illuminatedWidth').replace(/[a-zA-Z]/g, '')) + 'px';\n\n  $: stylesApp = {\n    '--tjs-app-overflow': 'visible',\n    '--illuminated-initial-height': illuminatedHeight,\n    '--illuminated-initial-width': illuminatedWidth\n  };\n\n  onMount(async () => {\n    if(levelUp) {\n      // Initialize LevelUp workflow\n      $actorInGame = $documentStore\n      levelUpFSMContext.actor = $documentStore;\n      \n      // Initialize characterClass from the actor's class data if in level-up mode\n      if ($actorInGame) {\n        // Find the first class item in the actor's items\n        const classItem = $actorInGame.items.find(item => item.type === \"class\");\n        if (classItem) {\n          // Set the characterClass store with the class item\n          characterClass.set(classItem);\n        }\n      }\n      \n      // Start the LevelUp state machine\n      const levelUpFSM = getLevelUpFSM();\n      \n      // Check current state and reset if needed\n      const currentState = levelUpFSM.getCurrentState();\n      window.GAS.log.d('[PCAPP] Current FSM state before starting level-up:', currentState);\n      \n      // Reset FSM to idle if it's in any state other than 'idle'\n      if (currentState !== 'idle') {\n        // window.GAS.log.d('[PCAPP] Resetting FSM from state:', currentState, 'to idle');\n        levelUpFSM.handle(LEVELUP_EVENTS.RESET);\n      }\n      \n      // Now start the level-up workflow\n      levelUpFSM.handle(LEVELUP_EVENTS.START_LEVEL_UP);\n      // window.GAS.log.d('[PCAPP] Started LevelUp workflow');\n    } else {\n      // Character creation workflow\n      getWorkflowFSM()\n    }\n    \n    isLevelUp.set(levelUp);\n\n    window.GAS.log.d(stylesApp)\n\n    // window.GAS.log.d($isLevelUp)\n  });\n\n  onDestroy(() => {\n    // console.log('[PCAPP] onDestroy called - cleaning up');\n    // Don't reset stores here - let gasClose handle it\n    // console.log('[PCAPP] Unregistering gas.close hook');\n    Hooks.off(\"gas.close\", gasClose);\n    // console.log('[PCAPP] Unregistering gas.equipmentSelection hook');\n    Hooks.off(\"gas.equipmentSelection\", handleEquipmentSelection);\n    // console.log('[PCAPP] onDestroy complete');\n  });\n\n  /**\n   * Handle workflow state changes and update tabs accordingly\n   */\n  function handleWorkflowStateChange(state) {\n    // console.log('[PCAPP] ====== handleWorkflowStateChange CALLED ======');\n    // console.log('[PCAPP] New workflow state:', state);\n    // console.log('[PCAPP] Current tabs:', $tabs);\n    // console.log('[PCAPP] Current active tab:', $activeTab);\n\n    // Remove Advancements tab when workflow moves past processing_advancements\n    if (state !== 'processing_advancements' && state !== 'creating_character') {\n      const hasAdvancementsTab = $tabs.find(x => x.id === \"advancements\");\n      \n      if (hasAdvancementsTab) {\n        // console.log('[PCAPP] Removing advancements tab - workflow has moved past processing_advancements');\n        tabs.update(t => {\n          const filteredTabs = t.filter(x => x.id !== \"advancements\");\n          console.log('[PCAPP] Tabs after removing advancements:', filteredTabs);\n          return filteredTabs;\n        });\n\n        // If the active tab was advancements, switch to the first available tab\n        if ($activeTab === \"advancements\") {\n          const remainingTabs = $tabs.filter(x => x.id !== \"advancements\");\n          if (remainingTabs.length > 0) {\n            // console.log('[PCAPP] Setting active tab to:', remainingTabs[0].id);\n            activeTab.set(remainingTabs[0].id);\n          }\n        }\n      }\n    }\n\n    // Don't add tabs here - let the workflow state machine handle it\n    // The workflow state machine has its own logic for adding spells/equipment/shop tabs\n    // We only handle the removal of advancements tab here\n\n    console.log('[PCAPP] ====== handleWorkflowStateChange COMPLETE ======');\n  }\n\n  function gasClose() {\n    // console.log('[PCAPP] ====== gasClose CALLED ======');\n    window.GAS.log.d('gas.close')\n    window.GAS.log.d($actorInGame);\n    \n    // Only try to access actor sheet if actor exists\n    if ($actorInGame) {\n      window.GAS.log.d($actorInGame.sheet);\n      window.GAS.log.d($isLevelUp);\n      if(!$isLevelUp) {\n        $actorInGame.sheet.render(true);\n      }\n    } else {\n      console.log('[PCAPP] No actor in game - skipping sheet render');\n    }\n    \n    // console.log('[PCAPP] Resetting stores and workflow state machine');\n    resetStores();\n    \n    // Reset workflow state machine to idle, with error handling\n    try {\n      const currentState = getWorkflowFSM().getCurrentState();\n      // console.log('[PCAPP] Current workflow state before reset:', currentState);\n      \n      // Only send reset if not in a state that can't handle it\n      if (currentState !== 'processing_advancements') {\n        getWorkflowFSM().handle(WORKFLOW_EVENTS.RESET);\n        // console.log('[PCAPP] Workflow state after reset:', getWorkflowFSM().getCurrentState());\n      } else {\n        // For processing_advancements, we'll let it complete naturally or force stop\n        // console.log('[PCAPP] Skipping reset for processing_advancements state - will be handled naturally');\n        // Force the processing flag to false to allow cleanup\n        if (workflowFSMContext?.isProcessing) {\n          workflowFSMContext.isProcessing.set(false);\n        }\n      }\n    } catch (error) {\n      console.warn('[PCAPP] Error during workflow reset:', error);\n      // Force cleanup even if reset fails\n      if (workflowFSMContext?.isProcessing) {\n        workflowFSMContext.isProcessing.set(false);\n      }\n    }\n    \n    // Set flag to indicate we're closing from the gas hook\n    if (application && typeof application.setClosingFromGasHook === 'function') {\n      application.setClosingFromGasHook(true);\n      // console.log('[PCAPP] setClosingFromGasHook called on application instance');\n    } else {\n      // console.warn('[PCAPP] application.setClosingFromGasHook is not a function or application is undefined:', application);\n      // Fallback: try to close directly if possible\n      if (application && typeof application.close === 'function') {\n        application.close();\n      }\n    }\n    application.close();\n    // console.log('[PCAPP] ====== gasClose COMPLETE ======');\n  }\n\n  /**\n   * NB: this is called after advancements because some equipment selection\n   * is dependent on the proficiencies selected\n   * @todo: logic for those proficiency dependencies are not yet implemented\n   */\n  function handleEquipmentSelection() {\n    // console.log('[PCAPP] ====== handleEquipmentSelection CALLED ======');\n    // window.GAS.log.d('[PCAPP] handleEquipmentSelection called');\n    // window.GAS.log.d('[PCAPP] Current tabs before update:', $tabs);\n    \n    // Add Equipment tab\n    if(!$tabs.find(x => x.id === \"equipment\")) {\n      // console.log('[PCAPP] Adding equipment tab - tab does not exist');\n      // window.GAS.log.d('[PCAPP] adding equipment tab')\n      tabs.update(t => {\n        const newTabs = [...t, { label: \"Equipment\", id: \"equipment\", component: \"Equipment\" }];\n        // console.log('[PCAPP] New tabs after adding equipment:', newTabs);\n        return newTabs;\n      });\n    } else {\n      // console.log('[PCAPP] Equipment tab already exists');\n    }\n\n    // Note: Advancements tab removal is handled by handleWorkflowStateChange\n    // Don't remove it here to avoid conflicts\n\n    // Set active tab to equipment\n    // console.log('[PCAPP] Setting active tab to equipment');\n    activeTab.set(\"equipment\");\n    // console.log('[PCAPP] Active tab set to:', $activeTab);\n\n    // Set read-only state for other tabs\n    // console.log('[PCAPP] Setting read-only tabs');\n    readOnlyTabs.set([\"race\", \"background\", \"abilities\", \"class\"]);\n    // console.log('[PCAPP] Read-only tabs set to:', $readOnlyTabs);\n    \n    // console.log('[PCAPP] ====== handleEquipmentSelection COMPLETE ======');\n  }\n\n</script>\n\n<!-- This is necessary for Svelte to generate accessors TRL can access for `elementRoot` -->\n<svelte:options accessors={true}/>\n\n<!-- ApplicationShell provides the popOut / application shell frame, header bar, content areas -->\n<!-- ApplicationShell exports `elementRoot` which is the outer application shell element -->\n\n<template lang=\"pug\">\n  ApplicationShell(bind:elementRoot bind:stylesApp)\n    main\n      section.a\n        Tabs.gas-tabs( tabs=\"{filteredTabs}\" bind:activeTab=\"{$activeTab}\" sheet=\"PC\")\n\n      section.b\n        Footer\n\n</template>\n\n\n\n<style lang=\"sass\">\nmain \n  text-align: center\n  display: flex\n  flex-direction: column\n  height: 100%\n\nsection \n  padding: 0.5rem 0.2rem\n\n.a\n  flex: 1\n  overflow-y: scroll\n    min-width: 200px\n\n  .b \n    height: 65px\n\n\n  .flex-grow\n    flex: 1 // Make this section grow to fill available space\n    overflow-y: scroll\n    height: 90%\n\n  .section-bottom\n    // Add any additional styling for the bottom section\n\n  \n</style>","import { writable, get } from 'svelte/store';\nimport { isMinimalWritableStore } from '@typhonjs-fvtt/runtime/svelte/store/util';\nimport { Strings } from '@typhonjs-fvtt/runtime/util';\nimport { isIterable, safeAccess } from '@typhonjs-fvtt/runtime/util/object';\n\nclass DynReducerUtils {\n    /**\n     * Checks for array equality between two arrays of numbers.\n     *\n     * @param a - Array A\n     *\n     * @param b - Array B\n     *\n     * @returns Arrays are equal.\n     */\n    static arrayEquals(a, b) {\n        if (a === b) {\n            return true;\n        }\n        /* c8 ignore next */\n        if (a === null || b === null) {\n            return false;\n        }\n        /* c8 ignore next */\n        if (a.length !== b.length) {\n            return false;\n        }\n        for (let cntr = a.length; --cntr >= 0;) {\n            /* c8 ignore next */\n            if (a[cntr] !== b[cntr]) {\n                return false;\n            }\n        }\n        return true;\n    }\n    /**\n     * Provides a solid string hashing algorithm.\n     *\n     * Sourced from: https://stackoverflow.com/a/52171480\n     *\n     * @param str - String to hash.\n     *\n     * @param seed - A seed value altering the hash.\n     *\n     * @returns Hash code.\n     */\n    static hashString(str, seed = 0) {\n        /* c8 ignore next */\n        if (str === void 0 || str === null) {\n            return 0;\n        }\n        let h1 = 0xdeadbeef ^ seed, h2 = 0x41c6ce57 ^ seed;\n        for (let ch, i = 0; i < str.length; i++) {\n            ch = str.charCodeAt(i);\n            h1 = Math.imul(h1 ^ ch, 2654435761);\n            h2 = Math.imul(h2 ^ ch, 1597334677);\n        }\n        h1 = Math.imul(h1 ^ (h1 >>> 16), 2246822507) ^ Math.imul(h2 ^ (h2 >>> 13), 3266489909);\n        h2 = Math.imul(h2 ^ (h2 >>> 16), 2246822507) ^ Math.imul(h1 ^ (h1 >>> 13), 3266489909);\n        return 4294967296 * (2097151 & h2) + (h1 >>> 0);\n    }\n    /**\n     * Converts an unknown value for hashing purposes in {@link AdapterIndexer.calcHashUpdate}.\n     *\n     * Currently, objects / Map w/ object keys is not supported. Potentially can include `object-hash` to handle this\n     * case, but it is not common to use objects as keys in Maps.\n     *\n     * @param value - An unknown value to convert to a number.\n     */\n    static hashUnknown(value) {\n        if (value === null || value === void 0) {\n            return 0;\n        }\n        let result = 0;\n        switch (typeof value) {\n            case 'boolean':\n                result = value ? 1 : 0;\n                break;\n            case 'bigint':\n                result = Number(BigInt.asIntN(64, value));\n                break;\n            case 'function':\n                result = this.hashString(value.name);\n                break;\n            case 'number':\n                result = Number.isFinite(value) ? value : 0;\n                break;\n            case 'object':\n                // TODO: consider hashing an object IE `object-hash` and convert to number.\n                break;\n            case 'string':\n                result = this.hashString(value);\n                break;\n            case 'symbol':\n                result = this.hashString(Symbol.keyFor(value));\n                break;\n        }\n        return result;\n    }\n    /**\n     * @param target -\n     *\n     * @param Prototype -\n     *\n     * @returns target constructor function has Prototype.\n     */\n    static hasPrototype(target, Prototype) {\n        /* c8 ignore next */\n        if (typeof target !== 'function') {\n            return false;\n        }\n        if (target === Prototype) {\n            return true;\n        }\n        // Walk parent prototype chain. Check for descriptor at each prototype level.\n        for (let proto = Object.getPrototypeOf(target); proto; proto = Object.getPrototypeOf(proto)) {\n            if (proto === Prototype) {\n                return true;\n            }\n        }\n        return false;\n    }\n    /**\n     * Provides a utility method to determine if the given data is iterable / implements iterator protocol.\n     *\n     * @param data - Data to verify as iterable.\n     *\n     * @returns Is data iterable.\n     */\n    static isIterable(data) {\n        return data !== null && data !== void 0 && typeof data === 'object' &&\n            typeof data[Symbol.iterator] === 'function';\n    }\n}\n\n/**\n * Provides the `derived` API for all dynamic reducers.\n */\nclass AdapterDerived {\n    #hostData;\n    #DerivedReducerCtor;\n    #parentIndex;\n    #derived = new Map();\n    #destroyed = false;\n    /**\n     * @param hostData - Hosted data structure.\n     *\n     * @param parentIndex - Any associated parent index API.\n     *\n     * @param DerivedReducerCtor - The default derived reducer constructor function.\n     */\n    constructor(hostData, parentIndex, DerivedReducerCtor) {\n        this.#hostData = hostData;\n        this.#parentIndex = parentIndex;\n        this.#DerivedReducerCtor = DerivedReducerCtor;\n        Object.freeze(this);\n    }\n    /**\n     * Creates a new derived reducer.\n     *\n     * @param options - Options defining the new derived reducer.\n     *\n     * @returns Newly created derived reducer.\n     */\n    create(options) {\n        if (this.#destroyed || this.#hostData === null) {\n            throw Error(`AdapterDerived.create error: this instance has been destroyed.`);\n        }\n        let name;\n        let rest = {};\n        let ctor;\n        const DerivedReducerCtor = this.#DerivedReducerCtor;\n        if (typeof options === 'string') {\n            name = options;\n            ctor = DerivedReducerCtor;\n        }\n        else if (typeof options === 'function' && DynReducerUtils.hasPrototype(options, DerivedReducerCtor)) {\n            ctor = options;\n        }\n        else if (typeof options === 'object' && options !== null) {\n            ({ name, ctor = DerivedReducerCtor, ...rest } = options);\n        }\n        else {\n            throw new TypeError(`AdapterDerived.create error: 'options' does not conform to allowed parameters.`);\n        }\n        if (!DynReducerUtils.hasPrototype(ctor, DerivedReducerCtor)) {\n            throw new TypeError(`AdapterDerived.create error: 'ctor' is not a '${DerivedReducerCtor?.name}'.`);\n        }\n        name = name ?? ctor?.name;\n        if (typeof name !== 'string') {\n            throw new TypeError(`AdapterDerived.create error: 'name' is not a string.`);\n        }\n        const derivedReducer = new ctor(this.#hostData, this.#parentIndex, rest);\n        this.#derived.set(name, derivedReducer);\n        // If the instantiated derived reducer has an `initialize` method then invoke it.\n        if (this.#hasInitialize(derivedReducer)) {\n            const { filters, sort, ...optionsRest } = rest;\n            derivedReducer.initialize(optionsRest);\n        }\n        return derivedReducer;\n    }\n    /**\n     * Removes all derived reducers and associated subscriptions.\n     */\n    clear() {\n        if (this.#destroyed) {\n            return;\n        }\n        for (const reducer of this.#derived.values()) {\n            reducer.destroy();\n        }\n        this.#derived.clear();\n    }\n    /**\n     * Deletes and destroys a derived reducer by name.\n     *\n     * @param name - Name of the derived reducer.\n     *\n     * @returns true if an element in the Map existed and has been removed, or false if the element does not exist.\n     */\n    delete(name) {\n        if (this.#destroyed) {\n            throw Error(`AdapterDerived.delete error: this instance has been destroyed.`);\n        }\n        const reducer = this.#derived.get(name);\n        if (reducer) {\n            reducer.destroy();\n        }\n        return this.#derived.delete(name);\n    }\n    /**\n     * Removes all derived reducers, subscriptions, and cleans up all resources.\n     */\n    destroy() {\n        if (this.#destroyed) {\n            return;\n        }\n        this.clear();\n        this.#hostData = null;\n        this.#parentIndex = null;\n        this.#destroyed = true;\n    }\n    /**\n     * Returns an existing derived reducer.\n     *\n     * @param name - Name of derived reducer.\n     *\n     * @returns Any associated derived reducer.\n     */\n    get(name) {\n        if (this.#destroyed) {\n            throw Error(`AdapterDerived.get error: this instance has been destroyed.`);\n        }\n        return this.#derived.get(name);\n    }\n    /**\n     * Type guard to check for presence of `initialize` method.\n     *\n     * @param instance - Instance to check.\n     */\n    #hasInitialize(instance) {\n        return typeof instance?.initialize === 'function';\n    }\n    /**\n     * Updates all managed derived reducer indexes.\n     *\n     * @param [force=false] - Force an update to subscribers.\n     */\n    update(force = false) {\n        if (this.#destroyed) {\n            return;\n        }\n        for (const reducer of this.#derived.values()) {\n            reducer.index.update(force);\n        }\n    }\n}\n\nclass AdapterFilters {\n    #filtersData;\n    #indexUpdate;\n    #mapUnsubscribe = new Map();\n    constructor(indexUpdate, filtersAdapter) {\n        this.#indexUpdate = indexUpdate;\n        this.#filtersData = filtersAdapter;\n        Object.freeze(this);\n    }\n    get length() { return this.#filtersData.filters.length; }\n    *[Symbol.iterator]() {\n        if (this.#filtersData.filters.length === 0) {\n            return;\n        }\n        for (const entry of this.#filtersData.filters) {\n            yield { ...entry };\n        }\n    }\n    add(...filters) {\n        /**\n         * Tracks the number of filters added that have subscriber functionality.\n         */\n        let subscribeCount = 0;\n        for (const filter of filters) {\n            const filterType = typeof filter;\n            if (filterType !== 'function' && (filterType !== 'object' || filter === null)) {\n                throw new TypeError(`AdapterFilters error: 'filter' is not a function or object.`);\n            }\n            let data;\n            let subscribeFn;\n            if (filterType === 'function') {\n                data = {\n                    id: void 0,\n                    filter: filter,\n                    weight: 1\n                };\n                subscribeFn = filter.subscribe;\n            }\n            else if (filterType === 'object') {\n                if ('filter' in filter) {\n                    if (typeof filter.filter !== 'function') {\n                        throw new TypeError(`AdapterFilters error: 'filter' attribute is not a function.`);\n                    }\n                    if (filter.weight !== void 0 && (typeof filter.weight !== 'number' ||\n                        filter.weight < 0 || filter.weight > 1)) {\n                        throw new TypeError(`AdapterFilters error: 'weight' attribute is not a number between '0 - 1' inclusive.`);\n                    }\n                    data = {\n                        id: filter.id !== void 0 ? filter.id : void 0,\n                        filter: filter.filter,\n                        weight: filter.weight || 1\n                    };\n                    subscribeFn = filter.filter.subscribe ?? filter.subscribe;\n                }\n                else {\n                    throw new TypeError(`AdapterFilters error: 'filter' attribute is not a function.`);\n                }\n                /* c8 ignore next 5 */ // TS type guard for `else` conditional.\n            }\n            else {\n                throw new TypeError(`AdapterFilters error: 'filter' is not defined.`);\n            }\n            // Find the index to insert where data.weight is less than existing values weight.\n            const index = this.#filtersData.filters.findIndex((value) => {\n                return data.weight < value.weight;\n            });\n            // If an index was found insert at that location.\n            if (index >= 0) {\n                this.#filtersData.filters.splice(index, 0, data);\n            }\n            else // push to end of filters.\n             {\n                this.#filtersData.filters.push(data);\n            }\n            if (typeof subscribeFn === 'function') {\n                const unsubscribe = subscribeFn(this.#indexUpdate);\n                // Ensure that unsubscribe is a function.\n                if (typeof unsubscribe !== 'function') {\n                    throw new TypeError('AdapterFilters error: Filter has subscribe function, but no unsubscribe function is returned.');\n                }\n                // Ensure that the same filter is not subscribed to multiple times.\n                if (this.#mapUnsubscribe.has(data.filter)) {\n                    throw new Error('AdapterFilters error: Filter added already has an unsubscribe function registered.');\n                }\n                this.#mapUnsubscribe.set(data.filter, unsubscribe);\n                subscribeCount++;\n            }\n        }\n        // Filters with subscriber functionality are assumed to immediately invoke the `subscribe` callback. If the\n        // subscriber count is less than the amount of filters added then automatically trigger an index update manually.\n        if (subscribeCount < filters.length) {\n            this.#indexUpdate(true);\n        }\n    }\n    clear() {\n        this.#filtersData.filters.length = 0;\n        // Unsubscribe from all filters with subscription support.\n        for (const unsubscribe of this.#mapUnsubscribe.values()) {\n            unsubscribe();\n        }\n        this.#mapUnsubscribe.clear();\n        this.#indexUpdate();\n    }\n    remove(...filters) {\n        const length = this.#filtersData.filters.length;\n        if (length === 0) {\n            return;\n        }\n        for (const data of filters) {\n            // Handle the case that the filter may either be a function or a filter entry / object.\n            const actualFilter = typeof data === 'function' ? data : data !== null && typeof data === 'object' ?\n                data.filter : void 0;\n            if (!actualFilter) {\n                continue;\n            }\n            for (let cntr = this.#filtersData.filters.length; --cntr >= 0;) {\n                if (this.#filtersData.filters[cntr].filter === actualFilter) {\n                    this.#filtersData.filters.splice(cntr, 1);\n                    // Invoke any unsubscribe function for given filter then remove from tracking.\n                    let unsubscribe;\n                    if (typeof (unsubscribe = this.#mapUnsubscribe.get(actualFilter)) === 'function') {\n                        unsubscribe();\n                        this.#mapUnsubscribe.delete(actualFilter);\n                    }\n                }\n            }\n        }\n        // Update the index a filter was removed.\n        if (length !== this.#filtersData.filters.length) {\n            this.#indexUpdate(true);\n        }\n    }\n    removeBy(callback) {\n        const length = this.#filtersData.filters.length;\n        if (length === 0) {\n            return;\n        }\n        if (typeof callback !== 'function') {\n            throw new TypeError(`AdapterFilters error: 'callback' is not a function.`);\n        }\n        this.#filtersData.filters = this.#filtersData.filters.filter((data) => {\n            const remove = callback.call(callback, { ...data });\n            if (remove) {\n                let unsubscribe;\n                if (typeof (unsubscribe = this.#mapUnsubscribe.get(data.filter)) === 'function') {\n                    unsubscribe();\n                    this.#mapUnsubscribe.delete(data.filter);\n                }\n            }\n            // Reverse remove boolean to properly filter / remove this filter.\n            return !remove;\n        });\n        if (length !== this.#filtersData.filters.length) {\n            this.#indexUpdate(true);\n        }\n    }\n    removeById(...ids) {\n        const length = this.#filtersData.filters.length;\n        if (length === 0) {\n            return;\n        }\n        this.#filtersData.filters = this.#filtersData.filters.filter((data) => {\n            let remove = 0;\n            for (const id of ids) {\n                remove |= (data.id === id ? 1 : 0);\n            }\n            // If not keeping invoke any unsubscribe function for given filter then remove from tracking.\n            if (!!remove) {\n                let unsubscribe;\n                if (typeof (unsubscribe = this.#mapUnsubscribe.get(data.filter)) === 'function') {\n                    unsubscribe();\n                    this.#mapUnsubscribe.delete(data.filter);\n                }\n            }\n            return !remove; // Swap here to actually remove the item via array filter method.\n        });\n        if (length !== this.#filtersData.filters.length) {\n            this.#indexUpdate(true);\n        }\n    }\n}\n\n/**\n * Provides construction and management of indexed data when there are parent indexes or filter / sort functions\n * applied.\n */\nclass AdapterIndexer {\n    derivedAdapter;\n    filtersData;\n    hostData;\n    hostUpdate;\n    indexData;\n    sortData;\n    sortFn;\n    destroyed = false;\n    /**\n     * @param hostData - Hosted data structure.\n     *\n     * @param hostUpdate - Host update function invoked on index updates.\n     *\n     * @param [parentIndexer] - Any associated parent index API.\n     *\n     * @returns Indexer adapter instance.\n     */\n    constructor(hostData, hostUpdate, parentIndexer) {\n        this.hostData = hostData;\n        this.hostUpdate = hostUpdate;\n        this.indexData = { index: null, hash: null, reversed: false, parent: parentIndexer };\n    }\n    /**\n     * @returns Returns whether the index is active.\n     */\n    get active() {\n        return this.filtersData.filters.length > 0 || this.sortData.compareFn !== null ||\n            this.indexData.parent?.active === true;\n    }\n    /**\n     * @returns Returns length of reduced index.\n     */\n    get length() {\n        return this.indexData.index ? this.indexData.index.length : 0;\n    }\n    // -------------------------------------------------------------------------------------------------------------------\n    /**\n     * Calculates a new hash value for the new index array if any. If the new index array is null then the hash value\n     * is set to null. Set calculated new hash value to the index adapter hash value.\n     *\n     * After hash generation compare old and new hash values and perform an update if they are different. If they are\n     * equal check for array equality between the old and new index array and perform an update if they are not equal.\n     *\n     * @param oldIndex - Old index array.\n     *\n     * @param oldHash - Old index hash value.\n     *\n     * @param [force=false] - When true forces an update to subscribers.\n     */\n    calcHashUpdate(oldIndex, oldHash, force = false) {\n        // Use force if a boolean otherwise default to false.\n        const actualForce = typeof force === 'boolean' ? force : /* c8 ignore next */ false;\n        let newHash = null;\n        const newIndex = this.indexData.index;\n        if (newIndex) {\n            for (let cntr = newIndex.length; --cntr >= 0;) {\n                newHash ^= DynReducerUtils.hashUnknown(newIndex[cntr]) + 0x9e3779b9 + (newHash << 6) + (newHash >> 2);\n            }\n        }\n        this.indexData.hash = newHash;\n        if (actualForce || (oldHash === newHash ? !DynReducerUtils.arrayEquals(oldIndex, newIndex) : true)) {\n            this.hostUpdate();\n        }\n    }\n    /**\n     * Destroys all resources.\n     */\n    destroy() {\n        if (this.destroyed) {\n            return;\n        }\n        this.hostData = null;\n        this.indexData.index = null;\n        this.indexData.hash = null;\n        this.indexData.reversed = false;\n        this.indexData.parent = null;\n        this.destroyed = true;\n    }\n    /**\n     * Store associated filter and sort data that are constructed after the indexer.\n     *\n     * @param filtersData - Associated AdapterFilters instance.\n     *\n     * @param sortData - Associated AdapterSort instance.\n     *\n     * @param derivedAdapter - Associated AdapterDerived instance.\n     */\n    initAdapters(filtersData, sortData, derivedAdapter) {\n        this.filtersData = filtersData;\n        this.sortData = sortData;\n        this.derivedAdapter = derivedAdapter;\n        this.sortFn = this.createSortFn();\n    }\n}\n\nclass AdapterSort {\n    #sortData;\n    #indexUpdate;\n    #unsubscribe;\n    constructor(indexUpdate, sortData) {\n        this.#indexUpdate = indexUpdate;\n        this.#sortData = sortData;\n        Object.freeze(this);\n    }\n    clear() {\n        const oldCompareFn = this.#sortData.compareFn;\n        this.#sortData.compareFn = null;\n        if (typeof this.#unsubscribe === 'function') {\n            this.#unsubscribe();\n            this.#unsubscribe = void 0;\n        }\n        // Only update index if an old compare function is set.\n        if (typeof oldCompareFn === 'function') {\n            this.#indexUpdate(true);\n        }\n    }\n    set(sort) {\n        if (typeof this.#unsubscribe === 'function') {\n            this.#unsubscribe();\n            this.#unsubscribe = void 0;\n        }\n        let compareFn;\n        let subscribeFn;\n        switch (typeof sort) {\n            case 'function':\n                compareFn = sort;\n                subscribeFn = sort.subscribe;\n                break;\n            case 'object':\n                // Early out if sort is null / noop.\n                if (sort === null) {\n                    break;\n                }\n                if (typeof sort.compare !== 'function') {\n                    throw new TypeError(`AdapterSort error: 'compare' attribute is not a function.`);\n                }\n                compareFn = sort.compare;\n                subscribeFn = sort.compare.subscribe ?? sort.subscribe;\n                break;\n        }\n        if (typeof compareFn === 'function') {\n            this.#sortData.compareFn = compareFn;\n        }\n        else {\n            const oldCompareFn = this.#sortData.compareFn;\n            this.#sortData.compareFn = null;\n            // Update index if the old compare function exists.\n            if (typeof oldCompareFn === 'function') {\n                this.#indexUpdate();\n            }\n            return;\n        }\n        if (typeof subscribeFn === 'function') {\n            this.#unsubscribe = subscribeFn(this.#indexUpdate);\n            // Ensure that unsubscribe is a function.\n            if (typeof this.#unsubscribe !== 'function') {\n                throw new Error(`AdapterSort error: sort has 'subscribe' function, but no 'unsubscribe' function is returned.`);\n            }\n        }\n        else {\n            // A sort function with subscriber functionality are assumed to immediately invoke the `subscribe` callback.\n            // Only manually update the index if there is no subscriber functionality.\n            this.#indexUpdate(true);\n        }\n    }\n}\n\nclass IndexerAPI {\n    #indexData;\n    /**\n     * Provides a getter to determine if the index is active.\n     */\n    active;\n    /**\n     * Provides length of reduced / indexed elements.\n     */\n    length;\n    /**\n     * Manually invoke an update of the index.\n     *\n     * @param force - Force update to any subscribers.\n     */\n    update;\n    constructor(adapterIndexer) {\n        this.#indexData = adapterIndexer.indexData;\n        this.update = adapterIndexer.update.bind(adapterIndexer);\n        // Defines getters on the public API to get the index hash, active state, and index length.\n        Object.defineProperties(this, {\n            active: { get: () => adapterIndexer.active },\n            length: { get: () => adapterIndexer.length }\n        });\n        Object.freeze(this);\n    }\n    get hash() {\n        return this.#indexData.hash;\n    }\n    *[Symbol.iterator]() {\n        const indexData = this.#indexData;\n        if (!indexData.index) {\n            return;\n        }\n        const reversed = indexData.reversed;\n        const length = indexData.index.length;\n        if (reversed) {\n            for (let cntr = length; --cntr >= 0;) {\n                yield indexData.index[cntr];\n            }\n        }\n        else {\n            for (let cntr = 0; cntr < length; cntr++) {\n                yield indexData.index[cntr];\n            }\n        }\n    }\n}\n\n/**\n */\nclass ArrayIndexer extends AdapterIndexer {\n    /**\n     * @inheritDoc\n     */\n    createSortFn() {\n        return (a, b) => {\n            const data = this.hostData?.[0];\n            const dataA = data?.[a];\n            const dataB = data?.[b];\n            /* c8 ignore next */\n            return dataA && dataB ? this.sortData.compareFn(dataA, dataB) : 0;\n        };\n    }\n    /**\n     * Provides the custom filter / reduce step that is ~25-40% faster than implementing with `Array.reduce`.\n     *\n     * Note: Other loop unrolling techniques like Duff's Device gave a slight faster lower bound on large data sets,\n     * but the maintenance factor is not worth the extra complication.\n     *\n     * @returns New filtered index array.\n     */\n    reduceImpl() {\n        const data = [];\n        const array = this.hostData?.[0];\n        if (!array) {\n            return data;\n        }\n        const filters = this.filtersData.filters;\n        let include = true;\n        const parentIndex = this.indexData.parent;\n        // Source index data is coming from an active parent index.\n        if (DynReducerUtils.isIterable(parentIndex) && parentIndex.active) {\n            for (const adjustedIndex of parentIndex) {\n                const value = array[adjustedIndex];\n                include = true;\n                for (let filCntr = 0, filLength = filters.length; filCntr < filLength; filCntr++) {\n                    if (!filters[filCntr].filter(value)) {\n                        include = false;\n                        break;\n                    }\n                }\n                if (include) {\n                    data.push(adjustedIndex);\n                }\n            }\n        }\n        else {\n            for (let cntr = 0, length = array.length; cntr < length; cntr++) {\n                include = true;\n                for (let filCntr = 0, filLength = filters.length; filCntr < filLength; filCntr++) {\n                    if (!filters[filCntr].filter(array[cntr])) {\n                        include = false;\n                        break;\n                    }\n                }\n                if (include) {\n                    data.push(cntr);\n                }\n            }\n        }\n        return data;\n    }\n    /**\n     * Update the reducer indexes. If there are changes subscribers are notified. If data order is changed externally\n     * pass in true to force an update to subscribers.\n     *\n     * @param [force=false] - When true forces an update to subscribers.\n     */\n    update(force = false) {\n        if (this.destroyed) {\n            return;\n        }\n        const oldIndex = this.indexData.index;\n        const oldHash = this.indexData.hash;\n        const array = this.hostData?.[0];\n        const parentIndex = this.indexData.parent;\n        // Clear index if there are no filters and no sort function or the index length doesn't match the item length.\n        if ((this.filtersData.filters.length === 0 && !this.sortData.compareFn) ||\n            (this.indexData.index && array?.length !== this.indexData.index.length)) {\n            this.indexData.index = null;\n        }\n        // If there are filters build new index.\n        if (this.filtersData.filters.length > 0) {\n            this.indexData.index = this.reduceImpl();\n        }\n        // If the index isn't built yet and there is an active parent index then create it from the parent.\n        if (!this.indexData.index && parentIndex?.active) {\n            this.indexData.index = [...parentIndex];\n        }\n        if (this.sortData.compareFn && Array.isArray(array)) {\n            // If there is no index then create one with keys matching host item length.\n            if (!this.indexData.index) {\n                this.indexData.index = [...Array(array.length).keys()];\n            }\n            this.indexData.index.sort(this.sortFn);\n        }\n        this.calcHashUpdate(oldIndex, oldHash, force);\n        // Update all derived reducers.\n        this.derivedAdapter?.update(force);\n    }\n}\n\n/**\n * Provides a public API for managing derived reducers.\n */\nclass DerivedListAPI {\n    clear;\n    create;\n    delete;\n    destroy;\n    get;\n    constructor(adapterDerived) {\n        this.clear = adapterDerived.clear.bind(adapterDerived);\n        this.create = adapterDerived.create.bind(adapterDerived);\n        this.delete = adapterDerived.delete.bind(adapterDerived);\n        this.destroy = adapterDerived.destroy.bind(adapterDerived);\n        this.get = adapterDerived.get.bind(adapterDerived);\n        Object.freeze(this);\n    }\n}\n\n/**\n * Provides the base implementation derived reducer for arrays / DynArrayReducer.\n *\n * Note: That you should never directly create an instance of a derived reducer, but instead use the\n * {@link DynArrayReducerDerived.initialize} function to set up any initial state in a custom derived reducer.\n *\n * @typeParam T `unknown` - Type of data. Defaults to `unknown` to enforce type safety when no type is specified.\n */\nclass DynArrayReducerDerived {\n    #array;\n    #derived;\n    #derivedPublicAPI;\n    #filters;\n    #filtersData = { filters: [] };\n    #index;\n    #indexPublicAPI;\n    #sort;\n    #sortData = { compareFn: null };\n    #subscribers = [];\n    #destroyed = false;\n    /**\n     * @param array - Data host array.\n     *\n     * @param parentIndex - Parent indexer.\n     *\n     * @param options - Any filters and sort functions to apply.\n     *\n     * @typeParam T `unknown` - Type of data.\n     *\n     * @private\n     */\n    constructor(array, parentIndex, options) {\n        this.#array = array;\n        this.#index = new ArrayIndexer(this.#array, this.#updateSubscribers.bind(this), parentIndex);\n        this.#indexPublicAPI = new IndexerAPI(this.#index);\n        this.#filters = new AdapterFilters(this.#indexPublicAPI.update, this.#filtersData);\n        this.#sort = new AdapterSort(this.#indexPublicAPI.update, this.#sortData);\n        this.#derived = new AdapterDerived(this.#array, this.#indexPublicAPI, DynArrayReducerDerived);\n        this.#derivedPublicAPI = new DerivedListAPI(this.#derived);\n        this.#index.initAdapters(this.#filtersData, this.#sortData, this.#derived);\n        const { filters, sort } = options;\n        if (filters !== void 0) {\n            if (!DynReducerUtils.isIterable(filters)) {\n                throw new TypeError(`DerivedArrayReducer error (DataDerivedOptions): 'filters' attribute is not iterable.`);\n            }\n            this.filters.add(...filters);\n        }\n        if (sort !== void 0) {\n            if (typeof sort !== 'function' && (typeof sort !== 'object' || sort === null)) {\n                throw new TypeError(`DerivedArrayReducer error (DataDerivedOptions): 'sort' attribute is not a function or object.`);\n            }\n            this.sort.set(sort);\n        }\n    }\n    /**\n     * @returns Derived public API.\n     */\n    get derived() { return this.#derivedPublicAPI; }\n    /**\n     * @returns The filters adapter.\n     */\n    get filters() { return this.#filters; }\n    /**\n     * @returns Returns the Indexer public API; is also iterable.\n     */\n    get index() { return this.#indexPublicAPI; }\n    /**\n     * @returns Returns whether this derived reducer is destroyed.\n     */\n    get destroyed() { return this.#destroyed; }\n    /**\n     * @returns Returns the main data items or indexed items length.\n     */\n    get length() {\n        const array = this.#array?.[0];\n        return this.#index.active ? this.index.length :\n            array ? array.length : 0;\n    }\n    /**\n     * @returns Returns current reversed state.\n     */\n    get reversed() { return this.#index.indexData.reversed; }\n    /**\n     * @returns The sort adapter.\n     */\n    get sort() { return this.#sort; }\n    /**\n     * Sets reversed state and notifies subscribers.\n     *\n     * @param reversed - New reversed state.\n     */\n    set reversed(reversed) {\n        if (typeof reversed !== 'boolean') {\n            throw new TypeError(`DerivedArrayReducer.reversed error: 'reversed' is not a boolean.`);\n        }\n        this.#index.indexData.reversed = reversed;\n        // Recalculate index and force an update to any subscribers.\n        this.index.update(true);\n    }\n    /**\n     * Removes all derived reducers, subscriptions, and cleans up all resources.\n     */\n    destroy() {\n        this.#destroyed = true;\n        // Remove any external data reference and perform a final update.\n        this.#array = null;\n        this.index.update(true);\n        // Remove all subscriptions.\n        this.#subscribers.length = 0;\n        this.#derived.destroy();\n        this.#index.destroy();\n        this.#filters.clear();\n        this.#sort.clear();\n    }\n    /**\n     * Provides a callback for custom derived reducers to initialize any data / custom configuration. This allows\n     * child classes to avoid implementing the constructor.\n     *\n     * @param [optionsRest] - Any additional custom options passed beyond {@link DynReducer.Options.Common}.\n     *\n     * @protected\n     */\n    initialize(optionsRest) { }\n    /**\n     * Provides an iterator for data stored in DynArrayReducerDerived.\n     *\n     * @returns Iterator for data stored in DynArrayReducerDerived.\n     */\n    *[Symbol.iterator]() {\n        const array = this.#array?.[0] ?? null;\n        if (this.#destroyed || array === null || array?.length === 0) {\n            return;\n        }\n        if (this.#index.active) {\n            for (const entry of this.index) {\n                yield array[entry];\n            }\n        }\n        else {\n            if (this.reversed) {\n                for (let cntr = array.length; --cntr >= 0;) {\n                    yield array[cntr];\n                }\n            }\n            else {\n                for (let cntr = 0; cntr < array.length; cntr++) {\n                    yield array[cntr];\n                }\n            }\n        }\n    }\n    // -------------------------------------------------------------------------------------------------------------------\n    /**\n     * Subscribe to this DerivedArrayReducer.\n     *\n     * @param handler - Callback function that is invoked on update / changes. Receives `this` reference.\n     *\n     * @returns Unsubscribe function.\n     */\n    subscribe(handler) {\n        const currentIdx = this.#subscribers.findIndex((entry) => entry === handler);\n        if (currentIdx === -1) {\n            this.#subscribers.push(handler);\n            handler(this); // call handler with current value\n        }\n        // Return unsubscribe function.\n        return () => {\n            const existingIdx = this.#subscribers.findIndex((entry) => entry === handler);\n            if (existingIdx !== -1) {\n                this.#subscribers.splice(existingIdx, 1);\n            }\n        };\n    }\n    /**\n     * Updates subscribers on changes.\n     */\n    #updateSubscribers() {\n        for (let cntr = 0; cntr < this.#subscribers.length; cntr++) {\n            this.#subscribers[cntr](this);\n        }\n    }\n}\n\n/**\n * Provides a managed array with non-destructive reducing / filtering / sorting capabilities with subscription /\n * Svelte store support.\n *\n * _Note:_ In constructing a DynArrayReducer instance that arrays are treated as a special case. When an array is passed\n * in as `data` in the constructor it will be used as the host array and not copied. All non-array iterables otherwise\n * create a new array / copy.\n *\n * _Note:_\n * - The default type `unknown` ensures stricter type checking, preventing unintended operations on the data.\n * - If the type of data is known, explicitly specify the generic type to improve clarity and maintainability:\n *\n * @example\n * ```ts\n * // Using external array data as reducer host data.\n * const data = ['a', 'b', 'c'];\n * const reducer = new DynArrayReducer<string>(data);\n *\n * // Add new data externally.\n * data.push('d');\n *\n * // Update the index.\n * reducer.index.update();\n * ```\n *\n * @example\n * ```ts\n * // Explicit type specification.\n * const reducer = new DynArrayReducer<string>(['a', 'b', 'c']);\n * ```\n *\n * @example\n * ```ts\n * // Using the default type.\n * const reducer = new DynArrayReducer(); // Defaults to DynArrayReducer<unknown>\n * ```\n *\n * @typeParam T `unknown` - Type of data. Defaults to `unknown` to enforce type safety when no type is specified.\n */\nclass DynArrayReducer {\n    #array = [null];\n    #derived;\n    #derivedPublicAPI;\n    #filters;\n    #filtersData = { filters: [] };\n    #index;\n    #indexPublicAPI;\n    #sort;\n    #sortData = { compareFn: null };\n    #subscribers = [];\n    #destroyed = false;\n    /**\n     * Initializes DynArrayReducer. Any iterable is supported for initial data. Take note that if `data` is an array it\n     * will be used as the host array and not copied. All non-array iterables otherwise create a new array / copy.\n     *\n     * @param [data] - Data iterable to store if array or copy otherwise.\n     *\n     * @typeParam T `unknown` - Type of data.\n     */\n    constructor(data) {\n        let dataIterable;\n        let filters;\n        let sort;\n        if (data === null) {\n            throw new TypeError(`DynArrayReducer error: 'data' is not iterable.`);\n        }\n        if (data !== void 0 && typeof data !== 'object' && !DynReducerUtils.isIterable(data)) {\n            throw new TypeError(`DynArrayReducer error: 'data' is not iterable.`);\n        }\n        if (data !== void 0 && Symbol.iterator in data) {\n            dataIterable = data;\n        }\n        else if (data !== void 0 && ('data' in data || 'filters' in data || 'sort' in data)) {\n            if (data.data !== void 0 && !DynReducerUtils.isIterable(data.data)) {\n                throw new TypeError(`DynArrayReducer error (DataDynArray): 'data' attribute is not iterable.`);\n            }\n            dataIterable = data.data;\n            if (data.filters !== void 0) {\n                if (DynReducerUtils.isIterable(data.filters)) {\n                    filters = data.filters;\n                }\n                else {\n                    throw new TypeError(`DynArrayReducer error (DataDynArray): 'filters' attribute is not iterable.`);\n                }\n            }\n            if (data.sort !== void 0) {\n                if (typeof data.sort === 'function') {\n                    sort = data.sort;\n                }\n                else if (typeof data.sort === 'object' && data.sort !== null) {\n                    sort = data.sort;\n                }\n                else {\n                    throw new TypeError(`DynArrayReducer error (DataDynArray): 'sort' attribute is not a function or object.`);\n                }\n            }\n        }\n        // In the case of the main data being an array directly use the array otherwise create a copy.\n        if (dataIterable) {\n            this.#array[0] = Array.isArray(dataIterable) ? dataIterable : [...dataIterable];\n        }\n        this.#index = new ArrayIndexer(this.#array, this.#updateSubscribers.bind(this));\n        this.#indexPublicAPI = new IndexerAPI(this.#index);\n        this.#filters = new AdapterFilters(this.#indexPublicAPI.update, this.#filtersData);\n        this.#sort = new AdapterSort(this.#indexPublicAPI.update, this.#sortData);\n        this.#derived = new AdapterDerived(this.#array, this.#indexPublicAPI, DynArrayReducerDerived);\n        this.#derivedPublicAPI = new DerivedListAPI(this.#derived);\n        this.#index.initAdapters(this.#filtersData, this.#sortData, this.#derived);\n        // Add any filters and sort function defined by DataDynArray.\n        if (filters) {\n            this.filters.add(...filters);\n        }\n        if (sort) {\n            this.sort.set(sort);\n        }\n    }\n    /**\n     * Returns the internal data of this instance. Be careful!\n     *\n     * Note: if an array is set as initial data then that array is used as the internal data. If any changes are\n     * performed to the data externally do invoke `update` via {@link DynArrayReducer.index} with `true` to recalculate\n     * the index and notify all subscribers.\n     *\n     * @returns The internal data.\n     */\n    get data() { return this.#array[0]; }\n    /**\n     * @returns Derived public API.\n     */\n    get derived() { return this.#derivedPublicAPI; }\n    /**\n     * @returns The filters adapter.\n     */\n    get filters() { return this.#filters; }\n    /**\n     * @returns Returns the Indexer public API; is also iterable.\n     */\n    get index() { return this.#indexPublicAPI; }\n    /**\n     * @returns Returns whether this instance is destroyed.\n     */\n    get destroyed() { return this.#destroyed; }\n    /**\n     * @returns Returns the main data items or indexed items length.\n     */\n    get length() {\n        const array = this.#array[0];\n        return this.#index.active ? this.#indexPublicAPI.length :\n            array ? array.length : 0;\n    }\n    /**\n     * @returns Returns current reversed state.\n     */\n    get reversed() { return this.#index.indexData.reversed; }\n    /**\n     * @returns The sort adapter.\n     */\n    get sort() { return this.#sort; }\n    /**\n     * Sets reversed state and notifies subscribers.\n     *\n     * @param reversed - New reversed state.\n     */\n    set reversed(reversed) {\n        if (typeof reversed !== 'boolean') {\n            throw new TypeError(`DynArrayReducer.reversed error: 'reversed' is not a boolean.`);\n        }\n        this.#index.indexData.reversed = reversed;\n        // Recalculate index and force an update to any subscribers.\n        this.index.update(true);\n    }\n    /**\n     * Removes all derived reducers, subscriptions, and cleans up all resources.\n     */\n    destroy() {\n        if (this.#destroyed) {\n            return;\n        }\n        this.#destroyed = true;\n        this.#derived.destroy();\n        // Set the backing data to null and provide a final update.\n        this.#array = [null];\n        this.index.update(true);\n        // Remove all subscriptions.\n        this.#subscribers.length = 0;\n        this.#filters.clear();\n        this.#sort.clear();\n        this.#index.destroy();\n    }\n    /**\n     * Provides a callback for custom reducers to initialize any data / custom configuration. Depending on the consumer\n     * of `dynamic-reducer` this may be utilized allowing child classes to avoid implementing the constructor.\n     *\n     * @param [optionsRest] - Any additional custom options passed beyond {@link DynReducer.Options.Common}.\n     *\n     * @protected\n     */\n    /* c8 ignore next */\n    initialize(optionsRest) { }\n    /**\n     * Removes internal data and pushes new data. This does not destroy any initial array set to internal data unless\n     * `replace` is set to true.\n     *\n     * @param data - New data to set to internal data.\n     *\n     * @param [replace=false] - New data to set to internal data.\n     */\n    setData(data, replace = false) {\n        if (data !== null && !DynReducerUtils.isIterable(data)) {\n            throw new TypeError(`DynArrayReducer.setData error: 'data' is not iterable.`);\n        }\n        if (typeof replace !== 'boolean') {\n            throw new TypeError(`DynArrayReducer.setData error: 'replace' is not a boolean.`);\n        }\n        const array = this.#array[0];\n        // If the array isn't defined or 'replace' is true then replace internal data with new array or create an array\n        // from an iterable.\n        if (!Array.isArray(array) || replace) {\n            if (data) {\n                this.#array[0] = Array.isArray(data) ? data : [...data];\n            }\n        }\n        else {\n            if (data) {\n                // Remove all entries in internal data. This will not replace any initially set array.\n                array.length = 0;\n                // Add all new data.\n                array.push(...data);\n            }\n            else {\n                this.#array[0] = null;\n            }\n        }\n        // Force clear the index and always rebuild.\n        this.#index.indexData.index = null;\n        // Recalculate index and force an update to any subscribers.\n        this.index.update(true);\n    }\n    /**\n     * Add a subscriber to this DynArrayReducer instance.\n     *\n     * @param handler - Callback function that is invoked on update / changes. Receives `this` reference.\n     *\n     * @returns Unsubscribe function.\n     */\n    subscribe(handler) {\n        const currentIdx = this.#subscribers.findIndex((entry) => entry === handler);\n        if (currentIdx === -1) {\n            this.#subscribers.push(handler);\n            handler(this); // call handler with current value\n        }\n        // Return unsubscribe function.\n        return () => {\n            const existingIdx = this.#subscribers.findIndex((entry) => entry === handler);\n            if (existingIdx !== -1) {\n                this.#subscribers.splice(existingIdx, 1);\n            }\n        };\n    }\n    /**\n     * Updates subscribers on changes.\n     */\n    #updateSubscribers() {\n        for (let cntr = 0; cntr < this.#subscribers.length; cntr++) {\n            this.#subscribers[cntr](this);\n        }\n    }\n    /**\n     * Provides an iterator for data stored in DynArrayReducer.\n     *\n     * @returns Iterator for data stored in DynArrayReducer.\n     */\n    *[Symbol.iterator]() {\n        const array = this.#array[0];\n        if (this.#destroyed || array === null || array?.length === 0) {\n            return;\n        }\n        if (this.#index.active) {\n            for (const entry of this.index) {\n                yield array[entry];\n            }\n        }\n        else {\n            if (this.reversed) {\n                for (let cntr = array.length; --cntr >= 0;) {\n                    yield array[cntr];\n                }\n            }\n            else {\n                for (let cntr = 0; cntr < array.length; cntr++) {\n                    yield array[cntr];\n                }\n            }\n        }\n    }\n}\n\n/**\n */\nclass MapIndexer extends AdapterIndexer {\n    /**\n     * @inheritDoc\n     */\n    createSortFn() {\n        return (a, b) => {\n            const data = this.hostData?.[0];\n            const dataA = data?.get(a);\n            const dataB = data?.get(b);\n            /* c8 ignore next */\n            return dataA && dataB ? this.sortData.compareFn(dataA, dataB) : 0;\n        };\n    }\n    /**\n     * Provides the custom filter / reduce step that is ~25-40% faster than implementing with `Array.reduce`.\n     *\n     * Note: Other loop unrolling techniques like Duff's Device gave a slight faster lower bound on large data sets,\n     * but the maintenance factor is not worth the extra complication.\n     *\n     * @returns New filtered index array.\n     */\n    reduceImpl() {\n        const data = [];\n        const map = this.hostData?.[0];\n        if (!map) {\n            return data;\n        }\n        const filters = this.filtersData.filters;\n        let include = true;\n        const parentIndex = this.indexData.parent;\n        // Source index data is coming from an active parent index.\n        if (DynReducerUtils.isIterable(parentIndex) && parentIndex.active) {\n            for (const key of parentIndex) {\n                const value = map.get(key);\n                include = true;\n                /* c8 ignore next */\n                if (value === undefined) {\n                    continue;\n                }\n                for (let filCntr = 0, filLength = filters.length; filCntr < filLength; filCntr++) {\n                    if (!filters[filCntr].filter(value)) {\n                        include = false;\n                        break;\n                    }\n                }\n                if (include) {\n                    data.push(key);\n                }\n            }\n        }\n        else {\n            for (const key of map.keys()) {\n                include = true;\n                const value = map.get(key);\n                /* c8 ignore next */\n                if (value === void 0) {\n                    continue;\n                }\n                for (let filCntr = 0, filLength = filters.length; filCntr < filLength; filCntr++) {\n                    if (!filters[filCntr].filter(value)) {\n                        include = false;\n                        break;\n                    }\n                }\n                if (include) {\n                    data.push(key);\n                }\n            }\n        }\n        return data;\n    }\n    /**\n     * Update the reducer indexes. If there are changes subscribers are notified. If data order is changed externally\n     * pass in true to force an update to subscribers.\n     *\n     * @param [force=false] - When true forces an update to subscribers.\n     */\n    update(force = false) {\n        if (this.destroyed) {\n            return;\n        }\n        const oldIndex = this.indexData.index;\n        const oldHash = this.indexData.hash;\n        const map = this.hostData?.[0];\n        const parentIndex = this.indexData.parent;\n        // Clear index if there are no filters and no sort function or the index length doesn't match the item length.\n        if ((this.filtersData.filters.length === 0 && !this.sortData.compareFn) ||\n            (this.indexData.index && map?.size !== this.indexData.index.length)) {\n            this.indexData.index = null;\n        }\n        // If there are filters build new index.\n        if (this.filtersData.filters.length > 0) {\n            this.indexData.index = this.reduceImpl();\n        }\n        // If the index isn't built yet and there is an active parent index then create it from the parent.\n        if (!this.indexData.index && parentIndex?.active) {\n            this.indexData.index = [...parentIndex];\n        }\n        if (this.sortData.compareFn && map instanceof Map) {\n            // If there is no index then create one with keys matching host item length.\n            if (!this.indexData.index) {\n                this.indexData.index = [...map.keys()];\n            }\n            this.indexData.index.sort(this.sortFn);\n        }\n        this.calcHashUpdate(oldIndex, oldHash, force);\n        // Update all derived reducers.\n        this.derivedAdapter?.update(force);\n    }\n}\n\n/**\n * Provides a public API for managing derived reducers.\n */\nclass DerivedMapAPI {\n    clear;\n    create;\n    delete;\n    destroy;\n    get;\n    constructor(adapterDerived) {\n        this.clear = adapterDerived.clear.bind(adapterDerived);\n        this.create = adapterDerived.create.bind(adapterDerived);\n        this.delete = adapterDerived.delete.bind(adapterDerived);\n        this.destroy = adapterDerived.destroy.bind(adapterDerived);\n        this.get = adapterDerived.get.bind(adapterDerived);\n        Object.freeze(this);\n    }\n}\n\n/**\n * Provides the base implementation derived reducer for Maps / DynMapReducer.\n *\n * Note: That you should never directly create an instance of a derived reducer, but instead use the\n * {@link DynMapReducerDerived.initialize} function to set up any initial state in a custom derived reducer.\n *\n * @typeParam K `unknown` - Key type. Defaults to `unknown` to enforce type safety when no type is specified.\n *\n * @typeParam T `unknown` - Type of data. Defaults to `unknown` to enforce type safety when no type is specified.\n */\nclass DynMapReducerDerived {\n    #map;\n    #derived;\n    #derivedPublicAPI;\n    #filters;\n    #filtersData = { filters: [] };\n    #index;\n    #indexPublicAPI;\n    #sort;\n    #sortData = { compareFn: null };\n    #subscribers = [];\n    #destroyed = false;\n    /**\n     * @param map - Data host Map.\n     *\n     * @param parentIndex - Parent indexer.\n     *\n     * @param options - Any filters and sort functions to apply.\n     *\n     * @typeParam K `unknown` - Key type.\n     *\n     * @typeParam T `unknown` - Type of data.\n     *\n     * @private\n     */\n    constructor(map, parentIndex, options) {\n        this.#map = map;\n        this.#index = new MapIndexer(this.#map, this.#updateSubscribers.bind(this), parentIndex);\n        this.#indexPublicAPI = new IndexerAPI(this.#index);\n        this.#filters = new AdapterFilters(this.#indexPublicAPI.update, this.#filtersData);\n        this.#sort = new AdapterSort(this.#indexPublicAPI.update, this.#sortData);\n        this.#derived = new AdapterDerived(this.#map, this.#indexPublicAPI, DynMapReducerDerived);\n        this.#derivedPublicAPI = new DerivedMapAPI(this.#derived);\n        this.#index.initAdapters(this.#filtersData, this.#sortData, this.#derived);\n        const { filters, sort } = options;\n        if (filters !== void 0) {\n            if (!DynReducerUtils.isIterable(filters)) {\n                throw new TypeError(`DerivedMapReducer error (DataDerivedOptions): 'filters' attribute is not iterable.`);\n            }\n            this.filters.add(...filters);\n        }\n        if (sort !== void 0) {\n            if (typeof sort !== 'function' && (typeof sort !== 'object' || sort === null)) {\n                throw new TypeError(`DerivedMapReducer error (DataDerivedOptions): 'sort' attribute is not a function or object.`);\n            }\n            this.sort.set(sort);\n        }\n    }\n    /**\n     * @returns Derived public API.\n     */\n    get derived() { return this.#derivedPublicAPI; }\n    /**\n     * @returns The filters adapter.\n     */\n    get filters() { return this.#filters; }\n    /**\n     * @returns Returns the Indexer public API; is also iterable.\n     */\n    get index() { return this.#indexPublicAPI; }\n    /**\n     * @returns Returns whether this derived reducer is destroyed.\n     */\n    get destroyed() { return this.#destroyed; }\n    /**\n     * @returns Returns the main data items or indexed items length.\n     */\n    get length() {\n        const map = this.#map?.[0];\n        return this.#index.active ? this.index.length :\n            map ? map.size : 0;\n    }\n    /**\n     * @returns Returns current reversed state.\n     */\n    get reversed() { return this.#index.indexData.reversed; }\n    /**\n     * @returns Returns the sort adapter.\n     */\n    get sort() { return this.#sort; }\n    /**\n     * Sets reversed state and notifies subscribers.\n     *\n     * @param reversed - New reversed state.\n     */\n    set reversed(reversed) {\n        if (typeof reversed !== 'boolean') {\n            throw new TypeError(`DerivedMapReducer.reversed error: 'reversed' is not a boolean.`);\n        }\n        this.#index.indexData.reversed = reversed;\n        // Recalculate index and force an update to any subscribers.\n        this.index.update(true);\n    }\n    /**\n     * Removes all derived reducers, subscriptions, and cleans up all resources.\n     */\n    destroy() {\n        this.#destroyed = true;\n        // Remove any external data reference and perform a final update.\n        this.#map = [null];\n        this.#index.update(true);\n        // Remove all subscriptions.\n        this.#subscribers.length = 0;\n        this.#derived.destroy();\n        this.#index.destroy();\n        this.#filters.clear();\n        this.#sort.clear();\n    }\n    /**\n     * Provides a callback for custom derived reducers to initialize any data / custom configuration. This allows\n     * child classes to avoid implementing the constructor.\n     *\n     * @param [optionsRest] - Any additional custom options passed beyond {@link DynDataOptions}.\n     *\n     * @protected\n     */\n    initialize(optionsRest) { }\n    /**\n     * Provides an iterator for data stored in DynMapReducerDerived.\n     *\n     * @returns Iterator for data stored in DynMapReducerDerived.\n     */\n    *[Symbol.iterator]() {\n        const map = this.#map?.[0] ?? null;\n        if (this.#destroyed || map === null || map?.size === 0) {\n            return;\n        }\n        if (this.#index.active) {\n            for (const key of this.index) {\n                yield map.get(key);\n            }\n        }\n        else {\n            if (this.reversed) {\n                // TODO: Not efficient due to creating temporary values array.\n                const values = [...map.values()];\n                for (let cntr = values.length; --cntr >= 0;) {\n                    yield values[cntr];\n                }\n            }\n            else {\n                for (const value of map.values()) {\n                    yield value;\n                }\n            }\n        }\n    }\n    // -------------------------------------------------------------------------------------------------------------------\n    /**\n     * Subscribe to this DerivedMapReducer.\n     *\n     * @param handler - Callback function that is invoked on update / changes. Receives `this` reference.\n     *\n     * @returns Unsubscribe function.\n     */\n    subscribe(handler) {\n        const currentIdx = this.#subscribers.findIndex((entry) => entry === handler);\n        if (currentIdx === -1) {\n            this.#subscribers.push(handler);\n            handler(this); // call handler with current value\n        }\n        // Return unsubscribe function.\n        return () => {\n            const existingIdx = this.#subscribers.findIndex((entry) => entry === handler);\n            if (existingIdx !== -1) {\n                this.#subscribers.splice(existingIdx, 1);\n            }\n        };\n    }\n    /**\n     * Updates subscribers on changes.\n     */\n    #updateSubscribers() {\n        for (let cntr = 0; cntr < this.#subscribers.length; cntr++) {\n            this.#subscribers[cntr](this);\n        }\n    }\n}\n\n/**\n * Provides a managed {@link Map} with non-destructive reducing / filtering / sorting capabilities with subscription /\n * Svelte store support allowing for a {@link Map} to be treated like an iterable list.\n *\n * _Note:_\n * - The default type `unknown` ensures stricter type checking, preventing unintended operations on the data.\n * - If the type of data is known, explicitly specify the generic type to improve clarity and maintainability:\n *\n * @example\n * ```ts\n * const mapReducer = new DynMapReducer<number, string>(\n *     new Map([\n *         [1, 'banana'],\n *         [2, 'apple'],\n *         [3, 'cherry'],\n *     ])\n * );\n *\n * console.log([...mapReducer]); // Output: ['banana', 'apple', 'cherry']\n *\n * // Sort values alphabetically.\n * mapReducer.sort.set((a, b) => a.localeCompare(b));\n *\n * console.log([...mapReducer]); // Output: ['apple', 'banana', 'cherry']\n * ```\n *\n * @typeParam K `unknown` - Key type. Defaults to `unknown` to enforce type safety when no type is specified.\n *\n * @typeParam T `unknown` - Type of data. Defaults to `unknown` to enforce type safety when no type is specified.\n */\nclass DynMapReducer {\n    #map = [null];\n    #derived;\n    #derivedPublicAPI;\n    #filters;\n    #filtersData = { filters: [] };\n    #index;\n    #indexPublicAPI;\n    #sort;\n    #sortData = { compareFn: null };\n    #subscribers = [];\n    #destroyed = false;\n    /**\n     * Initializes DynMapReducer. Any iterable is supported for initial data. Take note that if `data` is an array it\n     * will be used as the host array and not copied. All non-array iterables otherwise create a new array / copy.\n     *\n     * @param [data] - Data iterable to store if array or copy otherwise.\n     *\n     * @typeParam K `unknown` - Key type.\n     *\n     * @typeParam T `unknown` - Type of data.\n     */\n    constructor(data) {\n        let dataMap;\n        let filters;\n        let sort;\n        if (data === null) {\n            throw new TypeError(`DynMapReducer error: 'data' is not an object or Map.`);\n        }\n        if (data !== void 0 && typeof data !== 'object' && !(data instanceof Map)) {\n            throw new TypeError(`DynMapReducer error: 'data' is not an object or Map.`);\n        }\n        if (data !== void 0 && data instanceof Map) {\n            dataMap = data;\n        }\n        else if (data !== void 0 && ('data' in data || 'filters' in data || 'sort' in data)) {\n            if (data.data !== void 0 && !(data.data instanceof Map)) {\n                throw new TypeError(`DynMapReducer error (DataDynMap): 'data' attribute is not a Map.`);\n            }\n            if (data.data instanceof Map) {\n                dataMap = data.data;\n            }\n            if (data.filters !== void 0) {\n                if (DynReducerUtils.isIterable(data.filters)) {\n                    filters = data.filters;\n                }\n                else {\n                    throw new TypeError(`DynMapReducer error (DataDynMap): 'filters' attribute is not iterable.`);\n                }\n            }\n            if (data.sort !== void 0) {\n                if (typeof data.sort === 'function') {\n                    sort = data.sort;\n                }\n                else if (typeof data.sort === 'object' && data.sort !== null) {\n                    sort = data.sort;\n                }\n                else {\n                    throw new TypeError(`DynMapReducer error (DataDynMap): 'sort' attribute is not a function or object.`);\n                }\n            }\n        }\n        // In the case of the main data being an array directly use the array otherwise create a copy.\n        if (dataMap) {\n            this.#map[0] = dataMap;\n        }\n        this.#index = new MapIndexer(this.#map, this.#updateSubscribers.bind(this));\n        this.#indexPublicAPI = new IndexerAPI(this.#index);\n        this.#filters = new AdapterFilters(this.#indexPublicAPI.update, this.#filtersData);\n        this.#sort = new AdapterSort(this.#indexPublicAPI.update, this.#sortData);\n        this.#derived = new AdapterDerived(this.#map, this.#indexPublicAPI, DynMapReducerDerived);\n        this.#derivedPublicAPI = new DerivedMapAPI(this.#derived);\n        this.#index.initAdapters(this.#filtersData, this.#sortData, this.#derived);\n        // Add any filters and sort function defined by DataDynMap.\n        if (filters) {\n            this.filters.add(...filters);\n        }\n        if (sort) {\n            this.sort.set(sort);\n        }\n    }\n    /**\n     * Returns the internal data of this instance. Be careful!\n     *\n     * Note: When a map is set as data then that map is used as the internal data. If any changes are performed to the\n     * data externally do invoke `update` via {@link DynMapReducer.index} with `true` to recalculate the  index and\n     * notify all subscribers.\n     *\n     * @returns The internal data.\n     */\n    get data() { return this.#map[0]; }\n    /**\n     * @returns Derived public API.\n     */\n    get derived() { return this.#derivedPublicAPI; }\n    /**\n     * @returns The filters adapter.\n     */\n    get filters() { return this.#filters; }\n    /**\n     * @returns Returns the Indexer public API; is also iterable.\n     */\n    get index() { return this.#indexPublicAPI; }\n    /**\n     * @returns Returns whether this instance is destroyed.\n     */\n    get destroyed() { return this.#destroyed; }\n    /**\n     * @returns Returns the main data items or indexed items length.\n     */\n    get length() {\n        const map = this.#map[0];\n        return this.#index.active ? this.#indexPublicAPI.length :\n            map ? map.size : 0;\n    }\n    /**\n     * @returns Returns current reversed state.\n     */\n    get reversed() { return this.#index.indexData.reversed; }\n    /**\n     * @returns The sort adapter.\n     */\n    get sort() { return this.#sort; }\n    /**\n     * Sets reversed state and notifies subscribers.\n     *\n     * @param reversed - New reversed state.\n     */\n    set reversed(reversed) {\n        if (typeof reversed !== 'boolean') {\n            throw new TypeError(`DynMapReducer.reversed error: 'reversed' is not a boolean.`);\n        }\n        this.#index.indexData.reversed = reversed;\n        // Recalculate index and force an update to any subscribers.\n        this.index.update(true);\n    }\n    /**\n     * Removes all derived reducers, subscriptions, and cleans up all resources.\n     */\n    destroy() {\n        if (this.#destroyed) {\n            return;\n        }\n        this.#destroyed = true;\n        this.#derived.destroy();\n        // Set the backing data to null and provide a final update.\n        this.#map = [null];\n        this.index.update(true);\n        // Remove all subscriptions.\n        this.#subscribers.length = 0;\n        this.#filters.clear();\n        this.#sort.clear();\n        this.#index.destroy();\n    }\n    /**\n     * Provides a callback for custom reducers to initialize any data / custom configuration. Depending on the consumer\n     * of `dynamic-reducer` this may be utilized allowing child classes to avoid implementing the constructor.\n     *\n     * @param [optionsRest] - Any additional custom options passed beyond {@link DynReducer.Options.Common}.\n     *\n     * @protected\n     */\n    /* c8 ignore next */\n    initialize(optionsRest) { }\n    /**\n     * Removes internal data and pushes new data. This does not destroy any initial array set to internal data unless\n     * `replace` is set to true.\n     *\n     * @param data - New data to set to internal data.\n     *\n     * @param [replace=false] - New data to set to internal data.\n     */\n    setData(data, replace = false) {\n        if (data !== null && !(data instanceof Map)) {\n            throw new TypeError(`DynMapReducer.setData error: 'data' is not iterable.`);\n        }\n        if (typeof replace !== 'boolean') {\n            throw new TypeError(`DynMapReducer.setData error: 'replace' is not a boolean.`);\n        }\n        const map = this.#map[0];\n        // If the array isn't defined or 'replace' is true then replace internal data with new array or create an array\n        // from an iterable.\n        if (!(map instanceof Map) || replace) {\n            this.#map[0] = data instanceof Map ? data : null;\n        }\n        else if (data instanceof Map && map instanceof Map) {\n            // Create a set of all current entry IDs.\n            const removeKeySet = new Set(map.keys());\n            for (const key of data.keys()) {\n                map.set(key, data.get(key));\n                if (removeKeySet.has(key)) {\n                    removeKeySet.delete(key);\n                }\n            }\n            // Remove entries that are no longer in data.\n            for (const key of removeKeySet) {\n                map.delete(key);\n            }\n        }\n        else if (data === null) {\n            this.#map[0] = null;\n        }\n        // Force clear the index and always rebuild.\n        this.#index.indexData.index = null;\n        // Recalculate index and force an update to any subscribers.\n        this.index.update(true);\n    }\n    /**\n     * Add a subscriber to this DynMapReducer instance.\n     *\n     * @param handler - Callback function that is invoked on update / changes. Receives `this` reference.\n     *\n     * @returns Unsubscribe function.\n     */\n    subscribe(handler) {\n        const currentIdx = this.#subscribers.findIndex((entry) => entry === handler);\n        if (currentIdx === -1) {\n            this.#subscribers.push(handler);\n            handler(this); // call handler with current value\n        }\n        // Return unsubscribe function.\n        return () => {\n            const existingIdx = this.#subscribers.findIndex((entry) => entry === handler);\n            if (existingIdx !== -1) {\n                this.#subscribers.splice(existingIdx, 1);\n            }\n        };\n    }\n    /**\n     * Updates subscribers on changes.\n     */\n    #updateSubscribers() {\n        for (let cntr = 0; cntr < this.#subscribers.length; cntr++) {\n            this.#subscribers[cntr](this);\n        }\n    }\n    /**\n     * Provides an iterator for data stored in DynMapReducer.\n     *\n     * @returns Iterator for data stored in DynMapReducer.\n     */\n    *[Symbol.iterator]() {\n        const map = this.#map[0];\n        if (this.#destroyed || map === null || map?.size === 0) {\n            return;\n        }\n        if (this.#index.active) {\n            for (const key of this.index) {\n                yield map.get(key);\n            }\n        }\n        else {\n            if (this.reversed) {\n                // TODO: Not efficient due to creating temporary values array.\n                const values = [...map.values()];\n                for (let cntr = values.length; --cntr >= 0;) {\n                    yield values[cntr];\n                }\n            }\n            else {\n                for (const value of map.values()) {\n                    yield value;\n                }\n            }\n        }\n    }\n}\n\n/**\n * Creates a filter function to compare objects by a given accessor key against a regex test. The returned function\n * is also a writable Svelte store that builds a regex from the stores value.\n *\n * This filter function can be used w/ a dynamic reducer and bound as a store to input elements.\n *\n * @param accessors - Property key / accessors to lookup key to compare. To access deeper\n *        entries into the object format the accessor string with `.` between entries to walk.\n *\n * @param [opts] - Optional parameters.\n *\n * @param [opts.accessWarn=false] - When true warnings will be posted if accessor not retrieved.\n *\n * @param [opts.caseSensitive=false] - When true regex test is case-sensitive.\n *\n * @param [opts.store] - Use the provided minimal writable store to instead of creating a default `writable` store.\n *\n * @returns The query string filter.\n */\nfunction regexObjectQuery(accessors, { accessWarn = false, caseSensitive = false, store } = {}) {\n    let keyword = '';\n    let regex;\n    if (store !== void 0 && !isMinimalWritableStore(store)) {\n        throw new TypeError(`regexObjectQuery error: 'store' is not a minimal writable store.`);\n    }\n    const storeKeyword = store ? store : writable(keyword);\n    // If an existing store is provided then set initial values.\n    if (store) {\n        const current = get(store);\n        if (typeof current === 'string') {\n            keyword = Strings.normalize(current);\n            regex = new RegExp(Strings.escape(keyword), caseSensitive ? '' : 'i');\n        }\n        else {\n            store.set(keyword);\n        }\n    }\n    const filterQuery = Object.assign(\n    /**\n     * If there is no filter keyword / regex then do not filter otherwise filter based on the regex\n     * created from the search input element.\n     *\n     * @param data - Data object to test against regex.\n     *\n     * @returns Store filter state.\n     */\n    (data) => {\n        if (keyword === '' || !regex) {\n            return true;\n        }\n        if (isIterable(accessors)) {\n            for (const accessor of accessors) {\n                const value = safeAccess(data, accessor);\n                if (typeof value !== 'string') {\n                    if (accessWarn) {\n                        console.warn(`regexObjectQuery warning: could not access string data from '${accessor}'.`);\n                    }\n                    continue;\n                }\n                if (regex.test(Strings.normalize(value))) {\n                    return true;\n                }\n            }\n            return false;\n        }\n        else {\n            const value = safeAccess(data, accessors);\n            if (typeof value !== 'string') {\n                if (accessWarn) {\n                    console.warn(`regexObjectQuery warning: could not access string data from '${accessors}'.`);\n                }\n                return false;\n            }\n            return regex.test(Strings.normalize(value));\n        }\n    }, {\n        /**\n         * Create a custom store that changes when the search keyword changes.\n         *\n         * @param handler - A callback function that accepts strings.\n         *\n         * @returns Store unsubscribe function.\n         */\n        subscribe(handler) {\n            return storeKeyword.subscribe(handler);\n        },\n        /**\n         * @param value - A new value for the keyword / regex test.\n         */\n        set(value) {\n            if (typeof value === 'string') {\n                keyword = Strings.normalize(value);\n                regex = new RegExp(Strings.escape(keyword), caseSensitive ? '' : 'i');\n                storeKeyword.set(keyword);\n            }\n        }\n    });\n    /**\n     * Create a custom store that changes when the search keyword changes.\n     *\n     * @param handler - A callback function that accepts strings.\n     *\n     * @returns Store unsubscribe function.\n     */\n    filterQuery.subscribe = (handler) => {\n        return storeKeyword.subscribe(handler);\n    };\n    /**\n     * @param value - A new value for the keyword / regex test.\n     */\n    filterQuery.set = (value) => {\n        if (typeof value === 'string') {\n            keyword = Strings.normalize(value);\n            regex = new RegExp(Strings.escape(keyword), caseSensitive ? '' : 'i');\n            storeKeyword.set(keyword);\n        }\n    };\n    //\n    // /**\n    //  * If there is no filter keyword / regex then do not filter otherwise filter based on the regex\n    //  * created from the search input element.\n    //  *\n    //  * @param data - Data object to test against regex.\n    //  *\n    //  * @returns Store filter state.\n    //  */\n    // const filterQuery: ReturnType<DynReducerHelper.filters['regexObjectQuery']> = function(data: { [key: string]: any }): boolean\n    // {\n    //    if (keyword === '' || !regex) { return true; }\n    //\n    //    if (isIterable(accessors))\n    //    {\n    //       for (const accessor of accessors)\n    //       {\n    //          const value: any = safeAccess(data, accessor);\n    //          if (typeof value !== 'string')\n    //          {\n    //             if (accessWarn)\n    //             {\n    //                console.warn(`regexObjectQuery warning: could not access string data from '${accessor}'.`);\n    //             }\n    //\n    //             continue;\n    //          }\n    //\n    //          if (regex.test(Strings.normalize(value))) { return true; }\n    //       }\n    //\n    //       return false;\n    //    }\n    //    else\n    //    {\n    //       const value: any = safeAccess(data, accessors);\n    //       if (typeof value !== 'string')\n    //       {\n    //          if (accessWarn)\n    //          {\n    //             console.warn(`regexObjectQuery warning: could not access string data from '${accessors}'.`);\n    //          }\n    //\n    //          return false;\n    //       }\n    //\n    //       return regex.test(Strings.normalize(value));\n    //    }\n    // }\n    //\n    // /**\n    //  * Create a custom store that changes when the search keyword changes.\n    //  *\n    //  * @param handler - A callback function that accepts strings.\n    //  *\n    //  * @returns Store unsubscribe function.\n    //  */\n    // filterQuery.subscribe = (handler: Subscriber<string>): Unsubscriber =>\n    // {\n    //    return storeKeyword.subscribe(handler);\n    // };\n    //\n    // /**\n    //  * @param value - A new value for the keyword / regex test.\n    //  */\n    // filterQuery.set = (value: string): void =>\n    // {\n    //    if (typeof value === 'string')\n    //    {\n    //       keyword = Strings.normalize(value);\n    //       regex = new RegExp(Strings.escape(keyword), caseSensitive ? '' : 'i');\n    //       storeKeyword.set(keyword);\n    //    }\n    // };\n    return filterQuery;\n}\n\nconst filters = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    regexObjectQuery: regexObjectQuery\n});\n\n/**\n * Provides helper functions to create dynamic store driven filters and sort functions for dynamic reducers. The\n * returned functions are also Svelte stores and can be added to a reducer as well as used as a store.\n */\nclass DynReducerHelper {\n    constructor() { }\n    /**\n     * Returns the following filter functions:\n     * - regexObjectQuery(accessors, options); suitable for object reducers matching one or more property keys /\n     *   accessors against the store value as a regex. To access deeper entries into the object format the accessor\n     *   string with `.` between entries to walk. Optional parameters include logging access warnings, case sensitivity,\n     *   and passing in an existing store.\n     *\n     * @returns All available filters.\n     */\n    static get filters() { return filters; }\n}\n\nexport { DynArrayReducer, DynArrayReducerDerived, DynMapReducer, DynMapReducerDerived, DynReducerHelper };\n//# sourceMappingURL=index.js.map\n","import { tick } from 'svelte';\nimport { Hashing } from '@typhonjs-fvtt/runtime/util';\nimport { isPlainObject, isObject, hasPrototype } from '@typhonjs-fvtt/runtime/util/object';\nimport { DynMapReducer } from '@typhonjs-fvtt/runtime/svelte/store/reducer';\n\nfunction isDocument(doc) {\n    return doc !== void 0 && doc !== null && doc instanceof foundry.abstract.Document;\n}\nfunction isDocumentCollection(collection) {\n    return collection !== void 0 && collection !== null && collection instanceof DocumentCollection;\n}\n\n/**\n * Provides management of reactive embedded collections.\n *\n * @privateRemarks\n * TODO: Consider subscribing to TJSDocument rather than exposing {@link EmbeddedStoreManager.handleDocChange} and\n * {@link EmbeddedStoreManager.handleUpdate}\n */\nclass EmbeddedStoreManager {\n    /**\n     * RegExp for detecting CRUD updates for the associated document.\n     */\n    static #updateActionRegex = /(?<action>create|delete|update)(?<sep>\\.?)(?<name>\\w+)/;\n    /**\n     */\n    #name = new Map();\n    /**\n     * Source document.\n     */\n    #document;\n    /**\n     * Reverse lookup for older Foundry versions.\n     */\n    #collectionToDocName = new Map();\n    /**\n     * Valid embedded collection actions.\n     */\n    #embeddedNames = new Set();\n    /**\n     * @param document - The associated document holder.\n     */\n    constructor(document) {\n        this.#document = document;\n        this.handleDocChange();\n        Object.seal(this);\n    }\n    /**\n     * Create a reactive embedded collection store. When no options are provided the name of the embedded collection\n     * matches the document name.\n     *\n     * @param FoundryDoc - A Foundry document.\n     *\n     * @param [options] - Dynamic reducer create options.\n     *\n     * @typeParam D `Foundry Document`.\n     *\n     * @typeParam O `CreateOptions` - Embedded API create options.\n     */\n    create(FoundryDoc, options) {\n        const docName = FoundryDoc?.documentName;\n        if (typeof docName !== 'string') {\n            throw new TypeError(`EmbeddedStoreManager.create error: 'FoundryDoc' does not have a valid 'documentName' property.`);\n        }\n        const doc = this.#document[0];\n        let collection = null;\n        if (doc) {\n            try {\n                collection = doc.getEmbeddedCollection(docName);\n            }\n            catch (err) {\n                console.warn(`EmbeddedStoreManager.create error: No valid embedded collection for: ${docName}`);\n            }\n        }\n        let embeddedData = this.#name.get(docName);\n        if (!embeddedData) {\n            embeddedData = {\n                collection,\n                stores: new Map()\n            };\n            this.#name.set(docName, embeddedData);\n        }\n        /**\n         * Reducer name\n         */\n        let name;\n        /**\n         * Rest of common reducer options.\n         */\n        let rest = {};\n        /**\n         * Reducer constructor function.\n         */\n        let ctor;\n        if (typeof options === 'string') {\n            name = options;\n            ctor = DynMapReducer;\n        }\n        else if (typeof options === 'function' && hasPrototype(options, DynMapReducer)) {\n            ctor = options;\n        }\n        else if (isObject(options)) {\n            ({ name, ctor = DynMapReducer, ...rest } = options);\n        }\n        else {\n            name = docName;\n            ctor = DynMapReducer;\n        }\n        if (!hasPrototype(ctor, DynMapReducer)) {\n            throw new TypeError(`EmbeddedStoreManager.create error: 'ctor' is not a 'DynMapReducer'.`);\n        }\n        name = name ?? ctor?.name;\n        if (typeof name !== 'string') {\n            throw new TypeError(`EmbeddedStoreManager.create error: 'name' is not a string.`);\n        }\n        if (embeddedData.stores.has(name)) {\n            return embeddedData.stores.get(name);\n        }\n        else {\n            const reducerOptions = collection ? { data: collection, ...rest } : { ...rest };\n            const instance = new ctor(reducerOptions);\n            embeddedData.stores.set(name, instance);\n            // Invoke protected initialize method.\n            if (typeof instance?.initialize === 'function') {\n                instance.initialize(rest);\n            }\n            return instance;\n        }\n    }\n    /**\n     * Destroys one or more embedded collection reducers. When no `reducerName` is provided all reactive embedded\n     * collections are destroyed for the given document type.\n     *\n     * @param FoundryDoc - A Foundry document class constructor.\n     *\n     * @param [reducerName] - Optional name of a specific reducer to destroy.\n     *\n     * @typeParam D `Foundry Document`.\n     */\n    destroy(FoundryDoc, reducerName) {\n        let count = 0;\n        // Destroy all embedded stores\n        if (FoundryDoc === void 0) {\n            for (const embeddedData of this.#name.values()) {\n                embeddedData.collection = null;\n                for (const store of embeddedData.stores.values()) {\n                    store.destroy();\n                    count++;\n                }\n            }\n            this.#name.clear();\n        }\n        else {\n            const docName = FoundryDoc?.documentName;\n            if (typeof docName !== 'string') {\n                throw new TypeError(`EmbeddedStoreManager.delete error: 'FoundryDoc' does not have a valid 'documentName' property.`);\n            }\n            if (reducerName === void 0) {\n                const embeddedData = this.#name.get(docName);\n                if (embeddedData) {\n                    embeddedData.collection = null;\n                    for (const store of embeddedData.stores.values()) {\n                        store.destroy();\n                        count++;\n                    }\n                }\n                this.#name.delete(docName);\n            }\n            else if (reducerName === 'string') {\n                const embeddedData = this.#name.get(docName);\n                if (embeddedData) {\n                    const store = embeddedData.stores.get(reducerName);\n                    if (store) {\n                        store.destroy();\n                        count++;\n                    }\n                }\n            }\n        }\n        return count > 0;\n    }\n    /**\n     * Returns a specific existing embedded collection store. When no `reducerName` is provided the document name\n     * is used instead.\n     *\n     * @param FoundryDoc - A Foundry document class constructor.\n     *\n     * @param [reducerName] - Optional name of a specific reducer to get.\n     *\n     * @typeParam D `Foundry Document`.\n     *\n     * @returns The associated reactive embedded collection / reducer.\n     */\n    get(FoundryDoc, reducerName) {\n        const docName = FoundryDoc?.documentName;\n        if (typeof docName !== 'string') {\n            throw new TypeError(`EmbeddedStoreManager.get error: 'FoundryDoc' does not have a valid 'documentName' property.`);\n        }\n        const embeddedData = this.#name.get(docName);\n        if (embeddedData) {\n            return embeddedData.stores.get(reducerName ?? docName);\n        }\n    }\n    /**\n     * Updates all existing embedded collection stores with the associated embedded collection\n     */\n    handleDocChange() {\n        const doc = this.#document[0];\n        if (isDocument(doc)) {\n            const existingEmbeddedNames = new Set(this.#name.keys());\n            /**\n             * All embedded names from associated document.\n             */\n            const embeddedNames = Object.entries(doc.constructor?.metadata?.embedded ?? []);\n            this.#collectionToDocName.clear();\n            // Remove all previously stored embedded name CRUD keys.\n            this.#embeddedNames.clear();\n            for (const [docName, collectionName] of embeddedNames) {\n                // Remove processed embedded doc name from existingEmbeddedNames set.\n                existingEmbeddedNames.delete(docName);\n                // Update CRUD keys for v10.\n                this.#embeddedNames.add(`create${docName}`);\n                this.#embeddedNames.add(`delete${docName}`);\n                this.#embeddedNames.add(`update${docName}`);\n                // Update CRUD keys for v11.\n                this.#embeddedNames.add(`create.${collectionName}`);\n                this.#embeddedNames.add(`delete.${collectionName}`);\n                this.#embeddedNames.add(`update.${collectionName}`);\n                // Update CRUD keys for v12.\n                this.#embeddedNames.add(`create${collectionName}`);\n                this.#embeddedNames.add(`delete${collectionName}`);\n                this.#embeddedNames.add(`update${collectionName}`);\n                // v10 collection to doc name lookup.\n                this.#collectionToDocName.set(docName, docName);\n                this.#collectionToDocName.set(collectionName, docName);\n                let collection = null;\n                try {\n                    // Update any existing stores with the actual collection.\n                    collection = doc.getEmbeddedCollection(docName);\n                }\n                catch (err) {\n                    console.warn(`EmbeddedStoreManager.handleDocUpdate error: No valid embedded collection for: ${docName}`);\n                }\n                // Update EmbeddedData for new collection.\n                const embeddedData = this.#name.get(docName);\n                if (embeddedData) {\n                    // A bit funky here, but Foundry collections modify the Map type.\n                    embeddedData.collection = collection;\n                    // Update all existing stores.\n                    for (const store of embeddedData.stores.values()) {\n                        store.setData(embeddedData.collection, true);\n                    }\n                }\n            }\n            // Update all existing embedded collections with null data that aren't processed above.\n            for (const embeddedName of existingEmbeddedNames) {\n                const embeddedData = this.#name.get(embeddedName);\n                if (embeddedData) {\n                    embeddedData.collection = null;\n                    for (const store of embeddedData.stores.values()) {\n                        store.setData(null, true);\n                    }\n                }\n            }\n        }\n        else // Reset all embedded reducer stores to null data.\n         {\n            this.#collectionToDocName.clear();\n            this.#embeddedNames.clear();\n            for (const embeddedData of this.#name.values()) {\n                embeddedData.collection = null;\n                for (const store of embeddedData.stores.values()) {\n                    store.setData(null, true);\n                }\n            }\n        }\n    }\n    /**\n     * Handles updates to embedded stores parsing the document update action for valid embedded store types.\n     *\n     * On create, delete, update parse the type being modified then force index updates for the embedded type.\n     *\n     * @param action - Update action from document.\n     */\n    handleUpdate(action) {\n        if (!this.#embeddedNames.has(action)) {\n            return;\n        }\n        const match = EmbeddedStoreManager.#updateActionRegex.exec(action);\n        if (match && match.groups) {\n            const docOrCollectionName = match.groups.name;\n            const embeddedName = this.#collectionToDocName.get(docOrCollectionName);\n            const embeddedData = this.#name.get(embeddedName);\n            if (embeddedData) {\n                for (const store of embeddedData.stores.values()) {\n                    store.index.update(true);\n                }\n            }\n        }\n    }\n}\n\n/**\n * Provides a wrapper implementing the Svelte store / subscriber protocol around any Document / ClientMixinDocument.\n * This makes documents reactive in a Svelte component, but otherwise provides subscriber functionality external to\n * Svelte.\n *\n * @typeParam D `Foundry Document`.\n */\nclass TJSDocument {\n    /**\n     * Fake Application API that ClientDocumentMixin uses for document model callbacks.\n     */\n    #callbackAPI;\n    /**\n     * Wrapped document.\n     */\n    #document = [void 0];\n    /**\n     *\n     */\n    #embeddedStoreManager;\n    /**\n     *\n     */\n    #embeddedAPI;\n    /**\n     * UUIDv4 assigned to this instance.\n     */\n    #uuidv4;\n    /**\n     *\n     */\n    #options = {};\n    /**\n     * All current subscribers.\n     */\n    #subscribers = [];\n    /**\n     * Latest update options processed.\n     */\n    #updateOptions;\n    /**\n     * @param [document] - Document to wrap or TJSDocumentOptions.\n     *\n     * @param [options] - TJSDocument options.\n     */\n    constructor(document, options = {}) {\n        this.#uuidv4 = `tjs-document-${Hashing.uuidv4()}`;\n        this.#callbackAPI = {\n            close: this.#deleted.bind(this),\n            render: this.#updateSubscribers.bind(this)\n        };\n        if (isPlainObject(document)) // Handle case when only options are passed into ctor.\n         {\n            this.setOptions(document);\n        }\n        else {\n            this.setOptions(options);\n            this.set(document);\n        }\n    }\n    /**\n     * @returns {import('./types').EmbeddedAPI} Embedded store manager.\n     */\n    get embedded() {\n        if (!this.#embeddedAPI) {\n            this.#embeddedStoreManager = new EmbeddedStoreManager(this.#document);\n            this.#embeddedAPI = {\n                create: (doc, options) => this.#embeddedStoreManager.create(doc, options),\n                destroy: (doc, storeName) => this.#embeddedStoreManager.destroy(doc, storeName),\n                get: (doc, storeName) => this.#embeddedStoreManager.get(doc, storeName)\n            };\n        }\n        return this.#embeddedAPI;\n    }\n    /**\n     * @returns Returns the options passed on last update.\n     */\n    get updateOptions() {\n        return this.#updateOptions ?? { action: 'unknown', data: [] };\n    }\n    /**\n     * @returns Returns the UUIDv4 assigned to this store.\n     */\n    get uuidv4() { return this.#uuidv4; }\n    /**\n     * Register the callback API with the underlying Foundry document.\n     */\n    #callbackRegister() {\n        const doc = this.#document[0];\n        if (isDocument(doc) && isObject(doc?.apps) && !doc.apps[this.#uuidv4]) {\n            doc.apps[this.#uuidv4] = this.#callbackAPI;\n        }\n    }\n    /**\n     * Unregister the callback API with the underlying Foundry document.\n     */\n    #callbackUnregister() {\n        const doc = this.#document[0];\n        if (isDocument(doc)) {\n            delete doc?.apps?.[this.#uuidv4];\n        }\n    }\n    /**\n     * Handles cleanup when the document is deleted. Invoking any optional delete function set in the constructor.\n     *\n     * @returns Promise when completed.\n     */\n    async #deleted() {\n        const doc = this.#document[0];\n        // Check to see if the document is still in the associated collection to determine if actually deleted.\n        if (isDocument(doc) && !doc?.collection?.has(doc.id)) {\n            this.#setDocument(void 0);\n            if (typeof this.#options.preDelete === 'function') {\n                await this.#options.preDelete(doc);\n            }\n            this.#updateSubscribers(false, { action: 'delete' });\n            if (typeof this.#options.delete === 'function') {\n                await this.#options.delete(doc);\n            }\n            // Allow subscribers to be able to query `updateOptions` involving any reactive statements.\n            await tick();\n            this.#updateOptions = void 0;\n        }\n    }\n    /**\n     * Completely removes all internal subscribers, any optional delete callback, and unregisters from the\n     * ClientDocumentMixin `apps` tracking object.\n     */\n    destroy() {\n        if (this.#embeddedStoreManager) {\n            this.#embeddedStoreManager.destroy();\n            this.#embeddedStoreManager = void 0;\n            this.#embeddedAPI = void 0;\n        }\n        this.#setDocument(void 0);\n        this.#options.delete = void 0;\n        this.#options.preDelete = void 0;\n        this.#subscribers.length = 0;\n    }\n    /**\n     * @returns Current document\n     */\n    get() { return this.#document[0]; }\n    /**\n     * Attempts to create a Foundry UUID from standard drop data. This may not work for all systems.\n     *\n     * @param data - Drop transfer data.\n     *\n     * @param [opts] - Optional parameters.\n     *\n     * @param [opts.compendium=true] - Accept compendium documents.\n     *\n     * @param [opts.world=true] - Accept world documents.\n     *\n     * @param [opts.types] - Require the `data.type` to match entry in `types`.\n     *\n     * @returns Foundry UUID for drop data.\n     */\n    static getUUIDFromDataTransfer(data, { compendium = true, world = true, types = void 0 } = {}) {\n        if (!isObject(data)) {\n            return void 0;\n        }\n        if (Array.isArray(types) && !types.includes(data.type)) {\n            return void 0;\n        }\n        let uuid = void 0;\n        if (typeof data.uuid === 'string') // v10 and above provides a full UUID.\n         {\n            const isCompendium = data.uuid.startsWith('Compendium');\n            if (isCompendium && compendium) {\n                uuid = data.uuid;\n            }\n            else if (world) {\n                uuid = data.uuid;\n            }\n        }\n        return uuid;\n    }\n    /**\n     * Sets a new document target to be monitored. To unset use `undefined` or `null`.\n     *\n     * @param doc - New document to set.\n     *\n     * @param [options] - New document update options to set.\n     */\n    set(doc, options = {}) {\n        if (doc !== void 0 && doc !== null && !isDocument(doc)) {\n            throw new TypeError(`TJSDocument set error: 'document' is not a valid Document or undefined / null.`);\n        }\n        if (!isObject(options)) {\n            throw new TypeError(`TJSDocument set error: 'options' is not an object.`);\n        }\n        // Only post an update if the document has changed.\n        if (this.#setDocument(doc)) {\n            // Only add registration if there are current subscribers.\n            if (isDocument(doc) && this.#subscribers.length) {\n                this.#callbackRegister();\n            }\n            this.#updateSubscribers(false, {\n                ...options,\n                action: `tjs-set-${doc === void 0 || doc === null ? 'undefined' : 'new'}`\n            });\n        }\n    }\n    /**\n     * Internally sets the new document being tracked.\n     *\n     * @param doc -\n     *\n     * @returns {boolean} Whether the document changed.\n     */\n    #setDocument(doc) {\n        const changed = doc !== this.#document[0];\n        // Unregister before setting new document state.\n        if (changed) {\n            this.#callbackUnregister();\n        }\n        this.#document[0] = doc === void 0 || doc === null ? void 0 : doc;\n        if (changed && this.#embeddedStoreManager) {\n            this.#embeddedStoreManager.handleDocChange();\n        }\n        return changed;\n    }\n    /**\n     * Potentially sets new document from data transfer object.\n     *\n     * @param data - Document transfer data.\n     *\n     * @param [options] - Optional parameters for {@link TJSDocument.getUUIDFromDataTransfer}.\n     *\n     * @returns Returns true if new document set from data transfer blob.\n     */\n    async setFromDataTransfer(data, options) {\n        return this.setFromUUID(TJSDocument.getUUIDFromDataTransfer(data, options));\n    }\n    /**\n     * Sets the document by Foundry UUID performing a lookup and setting the document if found.\n     *\n     * @param {string}   uuid - A Foundry UUID to lookup.\n     *\n     * @param {import('./types').TJSDocumentUpdateOptions}   [options] - New document update options to set.\n     *\n     * @returns {Promise<boolean>} True if successfully set document from UUID.\n     */\n    async setFromUUID(uuid, options) {\n        if (typeof uuid !== 'string' || uuid.length === 0) {\n            return false;\n        }\n        try {\n            const doc = await globalThis.fromUuid(uuid);\n            if (doc) {\n                this.set(doc, options);\n                return true;\n            }\n        }\n        catch (err) { /**/ }\n        return false;\n    }\n    /**\n     * Sets options for this document wrapper / store.\n     *\n     * @param options - Options for TJSDocument.\n     */\n    setOptions(options) {\n        if (!isObject(options)) {\n            throw new TypeError(`TJSDocument error: 'options' is not a plain object.`);\n        }\n        // Verify valid values -------------\n        if (options.delete !== void 0 && options.delete !== null && typeof options.delete !== 'function') {\n            throw new TypeError(`TJSDocument error: 'delete' attribute in options is not a function or null.`);\n        }\n        if (options.preDelete !== void 0 && options.preDelete !== null && typeof options.preDelete !== 'function') {\n            throw new TypeError(`TJSDocument error: 'preDelete' attribute in options is not a function or null.`);\n        }\n        // Set any valid values -------------\n        if (options.delete !== void 0) {\n            this.#options.delete = options.delete ?? void 0;\n        }\n        if (options.preDelete !== void 0) {\n            this.#options.preDelete = options.preDelete ?? void 0;\n        }\n    }\n    /**\n     * @param handler - Callback function that is invoked on update / changes.\n     *\n     * @returns Unsubscribe function.\n     */\n    subscribe(handler) {\n        let addedSubscriber = false;\n        const currentIdx = this.#subscribers.findIndex((entry) => entry === handler);\n        if (currentIdx === -1) {\n            this.#subscribers.push(handler);\n            addedSubscriber = true;\n        }\n        if (addedSubscriber) {\n            // Register callback with first subscriber.\n            if (this.#subscribers.length === 1) {\n                this.#callbackRegister();\n            }\n            const updateOptions = { action: 'tjs-subscribe', data: [] };\n            handler(this.#document[0], updateOptions); // Call handler with current value and update options.\n        }\n        // Return unsubscribe function.\n        return () => {\n            const index = this.#subscribers.findIndex((sub) => sub === handler);\n            if (index !== -1) {\n                this.#subscribers.splice(index, 1);\n            }\n            // Unsubscribe from document callback if there are no subscribers.\n            if (this.#subscribers.length === 0) {\n                this.#callbackUnregister();\n            }\n        };\n    }\n    /**\n     * @param [force] - unused - signature from Foundry render function.\n     *\n     * @param [options] - Options from render call; will have document update context.\n     */\n    #updateSubscribers(force, options = {}) {\n        // Shallow copy w/ remapped keys.\n        const optionsRemap = {\n            action: (options.action ?? options.renderContext ?? 'tjs-unknown'),\n            data: (options.data ?? options.renderData ?? [])\n        };\n        // Coerce `data` as necessary into an array to standardize receiving processing.\n        if (!Array.isArray(optionsRemap.data)) {\n            optionsRemap.data = [optionsRemap.data];\n        }\n        this.#updateOptions = optionsRemap;\n        const subscribers = this.#subscribers;\n        const doc = this.#document[0];\n        for (let cntr = 0; cntr < subscribers.length; cntr++) {\n            subscribers[cntr](doc, optionsRemap);\n        }\n        if (this.#embeddedStoreManager) {\n            this.#embeddedStoreManager.handleUpdate(optionsRemap.action);\n        }\n    }\n}\n\n/**\n * Provides a wrapper implementing the Svelte store / subscriber protocol around any DocumentCollection. This makes\n * document collections reactive in a Svelte component, but otherwise provides subscriber functionality external to\n * Svelte.\n *\n * @typeParam C `Foundry Collection`.\n */\nclass TJSDocumentCollection {\n    /**\n     * Fake Application API that DocumentCollection uses for document model callbacks.\n     */\n    #callbackAPI;\n    /**\n     * Collection being wrapped.\n     */\n    #collection = void 0;\n    /**\n     * UUIDv4 to associate as key with wrapped collection.\n     */\n    #uuidv4;\n    /**\n     * Configuration options.\n     */\n    #options = {};\n    /**\n     * All current subscribers.\n     */\n    #subscribers = [];\n    /**\n     * Latest update options processed.\n     */\n    #updateOptions;\n    /**\n     * @param [collection] - Collection to wrap or TJSDocumentCollectionOptions.\n     *\n     * @param [options] - TJSDocumentCollection options.\n     */\n    constructor(collection, options = {}) {\n        this.#uuidv4 = `tjs-collection-${Hashing.uuidv4()}`;\n        this.#callbackAPI = {\n            uuid: this.#uuidv4,\n            close: this.#deleted.bind(this),\n            render: this.#updateSubscribers.bind(this)\n        };\n        if (isPlainObject(collection)) // Handle case when only options are passed into ctor.\n         {\n            this.setOptions(collection);\n        }\n        else {\n            this.setOptions(options);\n            this.set(collection);\n        }\n    }\n    /**\n     * Returns the options passed on last update.\n     *\n     * @returns Last update options.\n     */\n    get updateOptions() {\n        return this.#updateOptions ?? { action: 'unknown', data: [] };\n    }\n    /**\n     * Returns the UUIDv4 assigned to this store.\n     *\n     * @returns UUIDv4\n     */\n    get uuid() { return this.#uuidv4; }\n    /**\n     * Register the callback API with the underlying Foundry collection.\n     */\n    #callbackRegister() {\n        const collection = this.#collection;\n        if (isDocumentCollection(collection) && Array.isArray(collection?.apps)) {\n            const index = collection.apps.findIndex((sub) => sub === this.#callbackAPI);\n            if (index === -1) {\n                collection.apps.push(this.#callbackAPI);\n            }\n        }\n    }\n    /**\n     * Unregister the callback API with the underlying Foundry collection.\n     */\n    #callbackUnregister() {\n        const collection = this.#collection;\n        if (isDocumentCollection(this.#collection) && Array.isArray(collection?.apps)) {\n            const index = collection.apps.findIndex((sub) => sub === this.#callbackAPI);\n            if (index >= 0) {\n                collection.apps.splice(index, 1);\n            }\n        }\n    }\n    /**\n     * Handles cleanup when the collection is deleted. Invoking any optional delete function set in the constructor.\n     *\n     * @returns {Promise<void>}\n     */\n    async #deleted() {\n        const collection = this.#collection;\n        this.#callbackUnregister();\n        this.#collection = void 0;\n        // Only invoke handlers and subscribers if the collection was defined.\n        if (collection) {\n            if (typeof this.#options.preDelete === 'function') {\n                await this.#options.preDelete(collection);\n            }\n            this.#updateSubscribers(false, { action: 'delete' });\n            if (typeof this.#options.delete === 'function') {\n                await this.#options.delete(collection);\n            }\n        }\n        // Allow subscribers to be able to query `updateOptions` involving any reactive statements.\n        await tick();\n        this.#updateOptions = void 0;\n    }\n    /**\n     * Completely removes all internal subscribers, any optional delete callback, and unregisters from the\n     * DocumentCollection `apps` tracking array.\n     */\n    destroy() {\n        this.#callbackUnregister();\n        this.#collection = void 0;\n        this.#options.delete = void 0;\n        this.#options.preDelete = void 0;\n        this.#subscribers.length = 0;\n    }\n    /**\n     * @returns Current collection if any.\n     */\n    get() { return this.#collection; }\n    /**\n     * Sets a new document collection target to be monitored. To unset use `undefined` or `null`.\n     *\n     * @param collection - New collection to set.\n     *\n     * @param [options] - New collection update options to set.\n     */\n    set(collection, options = {}) {\n        if (collection !== void 0 && collection !== null && !isDocumentCollection(collection)) {\n            throw new TypeError(`TJSDocumentCollection set error: 'collection' is not a valid DocumentCollection or undefined.`);\n        }\n        if (!isObject(options)) {\n            throw new TypeError(`TJSDocument set error: 'options' is not an object.`);\n        }\n        const changed = this.#collection !== collection;\n        if (changed) {\n            this.#callbackUnregister();\n        }\n        this.#collection = collection === void 0 || collection === null ? void 0 : collection;\n        if (changed) {\n            if (isDocumentCollection(collection) && this.#subscribers.length) {\n                this.#callbackRegister();\n            }\n            this.#updateSubscribers(false, {\n                data: [],\n                ...options,\n                action: `tjs-set-${collection === void 0 || collection === null ? 'undefined' : 'new'}`\n            });\n        }\n    }\n    /**\n     * Sets options for this collection wrapper / store.\n     *\n     * @param options - Options for TJSDocumentCollection.\n     */\n    setOptions(options) {\n        if (!isObject(options)) {\n            throw new TypeError(`TJSDocumentCollection error: 'options' is not an object.`);\n        }\n        // Verify valid values -------------\n        if (options.delete !== void 0 && options.delete !== null && typeof options.delete !== 'function') {\n            throw new TypeError(`TJSDocumentCollection error: 'delete' attribute in options is not a function or null.`);\n        }\n        if (options.preDelete !== void 0 && options.preDelete !== null && typeof options.preDelete !== 'function') {\n            throw new TypeError(`TJSDocumentCollection error: 'preDelete' attribute in options is not a function or null.`);\n        }\n        // Set any valid values -------------\n        if (options.delete !== void 0) {\n            this.#options.delete = options.delete ?? void 0;\n        }\n        if (options.preDelete !== void 0) {\n            this.#options.preDelete = options.delete ?? void 0;\n        }\n    }\n    /**\n     * @param handler - Callback function that is invoked on update / changes.\n     *\n     * @returns Unsubscribe function.\n     */\n    subscribe(handler) {\n        let addedSubscriber = false;\n        const currentIdx = this.#subscribers.findIndex((entry) => entry === handler);\n        if (currentIdx === -1) {\n            this.#subscribers.push(handler);\n            addedSubscriber = true;\n        }\n        if (addedSubscriber) {\n            // Register callback with first subscriber.\n            if (this.#subscribers.length === 1) {\n                this.#callbackRegister();\n            }\n            const collection = this.#collection;\n            const updateOptions = { action: 'tjs-subscribe', data: [] };\n            handler(collection, updateOptions); // Call handler with current value and update options.\n        }\n        // Return unsubscribe function.\n        return () => {\n            const index = this.#subscribers.findIndex((sub) => sub === handler);\n            if (index !== -1) {\n                this.#subscribers.splice(index, 1);\n            }\n            // Unsubscribe from collection if there are no subscribers.\n            if (this.#subscribers.length === 0) {\n                this.#callbackUnregister();\n            }\n        };\n    }\n    /**\n     * @param force - unused - signature from Foundry render function.\n     *\n     * @param [options] - Options from render call; will have collection update context.\n     */\n    #updateSubscribers(force, options = {}) {\n        // Shallow copy w/ remapped keys.\n        const optionsRemap = {\n            action: (options.action ?? options.renderContext ?? 'tjs-unknown'),\n            data: (options.data ?? options.renderData ?? [])\n        };\n        // Coerce `data` as necessary into an array to standardize receiving processing.\n        if (!Array.isArray(optionsRemap.data)) {\n            optionsRemap.data = [optionsRemap.data];\n        }\n        this.#updateOptions = optionsRemap;\n        const subscribers = this.#subscribers;\n        const collection = this.#collection;\n        for (let cntr = 0; cntr < subscribers.length; cntr++) {\n            subscribers[cntr](collection, optionsRemap);\n        }\n    }\n}\n\nexport { TJSDocument, TJSDocumentCollection };\n//# sourceMappingURL=index.js.map\n","import PCAppShell from './PCAppShell.svelte';\nimport { SvelteApplication } from \"@typhonjs-fvtt/runtime/svelte/application\";\nimport { TJSDocument } from \"@typhonjs-fvtt/runtime/svelte/store/fvtt/document\";\nimport { MODULE_ID, MODULE_CODE } from \"~/src/helpers/constants\"\nimport { activeTab, actorInGame, isAdvancementInProgress } from \"~/src/stores/index\";\nimport { get } from 'svelte/store';\nimport { version } from \"../../module.json\";\n\nexport default class PCApplication extends SvelteApplication {\n  /**\n   * Document store that monitors updates to any assigned document.\n   *\n   * @type {TJSDocument<foundry.abstract.Document>}\n   */\n  #documentStore = new TJSDocument(void 0, { delete: this.close.bind(this) });\n\n  /**\n   * Holds the document unsubscription function.\n   *\n   * @type {Function}\n   */\n  #storeUnsubscribe;\n\n  constructor(object, levelUp = false) {\n    super(object);\n\n    // Define document store property\n    Object.defineProperty(this.reactive, \"document\", {\n      get: () => this.#documentStore.get(),\n      set: (document) => {\n        this.#documentStore.set(document);\n      },\n    });\n    this.reactive.document = object;\n    this.levelUp = levelUp\n  }\n\n\n\n  /**\n   * Default Application options\n   *\n   * @returns {object} options - Application options.\n   * @see https://foundryvtt.com/api/Application.html#options\n   */\n  static get defaultOptions() {\n    const title = this.title;\n    // Get dnd5e version, foundry version, and dnd5e rule set from window.GAS (set in init.js)\n    const dnd5eVersion = window.GAS?.dnd5eVersion || '';\n    const foundryVersion = game.version || '';\n    const dnd5eRules = window.GAS?.dnd5eRules || '';\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      id: 'foundryvtt-actor-studio-pc-sheet',\n      title: `${game.i18n.localize('GAS.ActorStudio')} v${version} | Foundry: ${foundryVersion} | dnd5e: ${dnd5eVersion} | Rules: ${dnd5eRules}`,\n      classes: [MODULE_CODE],\n      width: game.settings.get(MODULE_ID, 'windowX') || 700,\n      height: game.settings.get(MODULE_ID, 'windowX') || 800,\n      headerIcon: 'modules/foundryvtt-actor-studio/assets/actor-studio-logo-dragon-blue.png',\n      minWidth: 500,\n      padding: 0,\n      resizable: true,\n      focusAuto: false,\n      minimizable: true,\n      svelte: {\n        class: PCAppShell,\n        target: document.body,\n        props: function () {\n          return { documentStore: this.#documentStore, document: this.reactive.document, levelUp: this.levelUp  };\n        },\n      },\n    });\n  }\n\n    /**\n   * Gets the header buttons configuration for the sheet\n   * @return {Array<object>} Returns an array of button configurations for the sheet header\n   */\n  _getHeaderButtons() {\n    const buttons = super._getHeaderButtons();\n    \n    // Find the close button\n    const closeIndex = buttons.findIndex(button => button.class === 'close');\n    if (closeIndex === -1) return buttons;\n    \n    // Modify the close button's onClick handler\n    buttons[closeIndex].onclick = async (ev) => {\n      const currentTab = get(activeTab);\n      const actor = get(actorInGame);\n      \n      // Only show confirmation if advancements tab is active\n      if (get(isAdvancementInProgress)) {\n        const confirmed = await Dialog.confirm({\n          title: 'Close',\n          content: 'Are you sure you want to close? If you have incomplete advancements, they will be lost.',\n          yes: () => true,\n          no: () => false,\n          defaultYes: false\n        });\n        \n        if (confirmed) {\n          this.close();\n        }\n      } else {\n        // If not on advancements tab, just close normally\n        this.close();\n      }\n    };\n\n    return buttons;\n  }\n\n  /**\n   * Drag&Drop handling\n   */\n  _canDragStart(selector) {\n    return true;\n  }\n  _canDragDrop(selector) {\n    return this.reactive.document.isOwner || game.user.isGM;\n  }\n  _onDragOver(event) { }\n\n  _onDragStart(event) {\n\n  }\n\n  async _onDrop(event) {\n\n  }\n\n  #isClosingFromGasHook = false;\n  \n  setClosingFromGasHook(value) {\n    this.#isClosingFromGasHook = value;\n  }\n\n  async close(options = {}) {\n    // Only trigger gas.close hook if we're not already being closed by the gas.close hook\n    if (!this.#isClosingFromGasHook) {\n      console.log('[PCApplication] User closed Actor Studio - triggering gas.close hook for cleanup');\n      Hooks.call(\"gas.close\");\n      return; // gasClose will call this.close() again with the flag set\n    }\n    \n    console.log('[PCApplication] Closing application (called from gasClose)');\n    await super.close(options);\n\n    if (this.#storeUnsubscribe) {\n      this.#storeUnsubscribe();\n      this.#storeUnsubscribe = void 0;\n    }\n    \n    // Reset the flag for next time\n    this.#isClosingFromGasHook = false;\n  }\n\n  /**\n   * Handles any changes to document.\n   *\n   * @param {foundry.abstract.Document}  doc -\n   *\n   * @param {object}                     options -\n   */\n  async #handleDocUpdate(doc, options) {\n    const { action, data, documentType } = options;\n    if ((action === void 0 || action === \"update\" || action === \"subscribe\") && doc) {\n      const isDebug = game.settings.get(MODULE_ID, 'debug');\n      const moduleVersion = game.modules.get(MODULE_ID)?.version;\n      const tokenText = doc.flags?.[MODULE_ID]?.tokenName ? ` (${doc.flags[MODULE_ID].tokenName})` : \"\";\n      this.reactive.title = `${game.i18n.localize('GAS.ActorStudio')} - ${isDebug ? moduleVersion : ''} [${window.GAS.dnd5eRules}] - ${game.i18n.localize('GAS.PCTitle')} - ${doc.name} ${tokenText}`;\n    }\n  }\n\n  render(force = false, options = {}) {\n    if (!this.#storeUnsubscribe) {\n      this.#storeUnsubscribe = this.#documentStore.subscribe(this.#handleDocUpdate.bind(this));\n    }\n    super.render(force, options);\n    return this;\n  }\n\n}","import { get } from 'svelte/store';\nimport { MODULE_ID } from '~/src/helpers/constants';\nimport { levelUpSubClassObject } from '~/src/stores/storeDefinitions';\nimport PCApplication from '~/src/app/PCApplication.js';\n\nconst pulseKeyframes = `\n@keyframes pulse {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.5;\n  }\n}\n`;\n\nexport function dnd5eSheet2UI(app, html, data) {\n  const actor = data.actor;\n  window.GAS.log.d('[GAS] dnd5eSheet2UI: dnd5eVersion', window.GAS.dnd5eVersion);\n  window.GAS.log.d('[GAS] dnd5eSheet2UI: actor', actor);\n  window.GAS.log.d('[GAS] dnd5eSheet2UI: html', html);\n\n  const sheetheader = html.find('.sheet-header');\n  window.GAS.log.d('[GAS] dnd5eSheet2UI: sheetheader', sheetheader.length);\n  const buttons = sheetheader.find('.sheet-header-buttons');\n  window.GAS.log.d('[GAS] dnd5eSheet2UI: buttons', buttons.length);\n\n  let classes;\n  if (window.GAS.dnd5eVersion >= 4) {\n    classes = actor.classes;\n  } else if (actor.system && actor.system.classes && Object.keys(actor.system.classes).length) {\n    classes = actor.system.classes;\n  } else if (actor._classes && Object.keys(actor._classes).length) {\n    classes = actor._classes;\n  } else {\n    classes = undefined;\n  }\n  window.GAS.log.d('[GAS] dnd5eSheet2UI: classes', classes);\n\n  let hasClasses = false;\n  if (classes) {\n    if (Array.isArray(classes)) {\n      hasClasses = classes.length > 0;\n    } else if (Array.isArray(classes.items)) {\n      hasClasses = classes.items.length > 0;\n    } else {\n      hasClasses = Object.keys(classes).length > 0;\n    }\n  }\n\n  if (!hasClasses || (!game.settings.get(MODULE_ID, 'milestoneLeveling') && (actor.system.details.xp.max - actor.system.details.xp.value > 0))) {\n    window.GAS.log.d('[GAS] dnd5eSheet2UI: No classes or not eligible for level up.');\n    return;\n  }\n\n  buttons.css('gap', '0.35rem');\n  const levelUpButton = $(\n    `<button type=\"button\" class=\"config-button gold-button level-up\" data-action=\"flags\" data-tooltip=\"GAS.LevelUp.Button\" aria-label=\"GAS.LevelUp.Button\" style=\"\n      animation: pulse 2s infinite;\n    \">\n      <img src=\"modules/foundryvtt-actor-studio/assets/actor-studio-logo-dragon-blue.png\" alt=\"Level Up Button Actor Studio Logo\" style=\"width: 100%; height: 100%; object-fit: contain; max-width: 24px; max-height: 24px;\"></img>\n    </button>\n  `);\n\n  levelUpButton.on('click', async (event) => {\n    //- check if Actor Studio is already open\n    if (document.querySelector('#foundryvtt-actor-studio-pc-sheet')) {\n      ui.notifications.error('Actor Studio is already open and busy with another task. Please close the existing Actor Studio window before attempting to opening a new one.');\n      return;\n    }\n    //- render the level up UI\n    new PCApplication(app.actor, true).render(true, { focus: true });\n  })\n\n  $('<style>')\n    .prop('type', 'text/css')\n    .html(pulseKeyframes)\n    .appendTo('head');\n\n  buttons.append(levelUpButton);\n}\n\nexport function tidy5eSheetUI(app, element, data) {\n  // Defensive logging for debugging\n  console.log(app, element, data);\n  if (game.settings.get(MODULE_ID, 'enableLevelUp') === false) return;\n\n  // Safer tidy5e module/api detection to support older tidy5e versions\n  const tidyModule = game.modules.get(\"tidy5e-sheet\") || game.modules.get(\"tidy5e\");\n  const tidy5eApi = tidyModule?.api;\n  window.GAS.log.g('tidy5eapi', tidy5eApi);\n\n  // Prefer the tidy5e API check when available; fall back to a constructor/name heuristic\n  let isTidy = false;\n  try {\n    if (tidy5eApi && typeof tidy5eApi.isTidy5eCharacterSheet === 'function') {\n      isTidy = tidy5eApi.isTidy5eCharacterSheet(app);\n    } else {\n      // Older versions might not expose an API; detect by class/name as a last resort\n      isTidy = /tidy5e/i.test(app?.constructor?.name || '') || /tidy5e/i.test(app?.form?.id || '') || /tidy5e/i.test(String(app?.name || ''));\n    }\n  } catch (err) {\n    window.GAS.log.w('[GAS] tidy5eSheetUI: tidy5e detection threw', err);\n    isTidy = false;\n  }\n\n  if (!isTidy) {\n    return;\n  }\n\n  const actor = data.actor;\n  window.GAS.log.g('actor', actor);\n  window.GAS.log.g(1)\n\n  // Determine classes across dnd5e versions (v3 vs v4)\n  let classes;\n  if (window.GAS?.dnd5eVersion >= 4) {\n    classes = actor?.classes;\n  } else if (actor?.system?.classes && Object.keys(actor.system.classes).length) {\n    classes = actor.system.classes;\n  } else if (actor?._classes && Object.keys(actor._classes).length) {\n    classes = actor._classes;\n  } else {\n    classes = undefined;\n  }\n\n  let actorHasClasses = false;\n  if (classes) {\n    if (Array.isArray(classes)) {\n      actorHasClasses = classes.length > 0;\n    } else if (Array.isArray(classes.items)) {\n      actorHasClasses = classes.items.length > 0;\n    } else {\n      actorHasClasses = Object.keys(classes).length > 0;\n    }\n  }\n\n  window.GAS.log.g('actorHasClasses', actorHasClasses)\n  const isMilestoneLeveling = game.settings.get(MODULE_ID, 'milestoneLeveling')\n  window.GAS.log.g('isMilestoneLeveling', isMilestoneLeveling)\n  const actorHasLevellingXP = (actor.system.details.xp.max - actor.system.details.xp.value > 0)\n  window.GAS.log.g('actorHasLevellingXP', actorHasLevellingXP)\n\n  if (!actorHasClasses || (!isMilestoneLeveling && actorHasLevellingXP)) return;\n  // Find the new Tidy5e header actions container\n  // Primary selector for modern tidy5e\n  let actionsContainer = $(element).find('[data-tidy-sheet-part=\"sheet-header-actions-container\"]');\n  // Backwards-compatible fallbacks for older tidy5e markups\n  if (!actionsContainer || actionsContainer.length === 0) {\n    actionsContainer = $(element).find('.sheet-header-actions');\n  }\n  if (!actionsContainer || actionsContainer.length === 0) {\n    // Older tidy5e or other sheet shapes used .sheet-header-buttons\n    actionsContainer = $(element).find('.sheet-header-buttons');\n  }\n  if (!actionsContainer || actionsContainer.length === 0) {\n    actionsContainer = $(element).find('.sheet-header .sheet-header-buttons');\n  }\n  if (!actionsContainer || actionsContainer.length === 0) {\n    window.GAS?.log?.w?.('[GAS] tidy5eSheetUI: header actions container not found; skipping button injection.');\n    return;\n  }\n\n  // Prevent duplicate injections\n  if (actionsContainer.find('#gas-levelup-btn').length > 0) {\n    window.GAS?.log?.d?.('[GAS] tidy5eSheetUI: level up button already present.');\n    return;\n  }\n\n  const levelUpButton = $(`\n    <button\n      id=\"gas-levelup-btn\"\n      type=\"button\"\n      class=\"button button-icon-only button-gold gas-levelup\"\n      data-action=\"gasLevelUp\"\n      data-tooltip=\"GAS.LevelUp.Button\"\n      aria-label=\"GAS.LevelUp.Button\"\n      style=\"animation: pulse 2s infinite;\"\n    >\n      <img src=\"modules/foundryvtt-actor-studio/assets/actor-studio-logo-dragon-blue.png\" alt=\"Level Up Button Actor Studio Logo\" style=\"width: 100%; height: 100%; object-fit: contain; max-width: 20px; max-height: 20px;\">\n    </button>\n  `);\n  window.GAS.log.g(2)\n\n  levelUpButton.on(\"click\", async (event) => {\n    //- check if Actor Studio is already open\n    if (document.querySelector('#foundryvtt-actor-studio-pc-sheet')) {\n      ui.notifications.error('Actor Studio is already open and busy with another task. Please close the existing Actor Studio window before attempting to opening a new one.');\n      return;\n    }\n    //- render the level up UI\n    new PCApplication(app.actor, true).render(true, { focus: true });\n  });\n  window.GAS.log.g(3)\n\n  // Inject pulse keyframes only once\n  if (!document.getElementById('gas-levelup-pulse-style')) {\n    $('<style id=\"gas-levelup-pulse-style\">')\n      .prop('type', 'text/css')\n      .html(pulseKeyframes)\n      .appendTo('head');\n  }\n\n  // Append our button inside the container (not after)\n  actionsContainer.append(levelUpButton);\n  window.GAS.log.g(3)\n\n}\n\nexport function initLevelup() {\n\n  Hooks.on(\"renderActorSheetV2\", (app, html, data) => {\n   \n    window.GAS.log.d(app.constructor.name)\n    window.GAS.log.d(data)\n    if(game.settings.get(MODULE_ID, 'enableLevelUp') === false) return;\n\n    if(app.constructor.name === \"CharacterActorSheet\") {\n      dnd5eSheet2UI(app, $(app.element), data)\n    }\n\n  });\n\n  Hooks.on(\"renderActorSheet5e\", (app, html, data) => {\n    // window.GAS.log.d(app.constructor.name)\n    if(game.settings.get(MODULE_ID, 'enableLevelUp') === false) return;\n\n    if(app.constructor.name === \"ActorSheet5eCharacter\") {\n      log.e(\"Level Up not implemented for old dnd5e character sheet\")\n    }\n    if(app.constructor.name === \"ActorSheet5eCharacter2\") {\n      dnd5eSheet2UI(app, html, data)\n    }\n\n  })\n\n  Hooks.on(\"renderTidy5eCharacterSheetQuadrone\", (app, element, data) => {\n    tidy5eSheetUI(app, element, data);\n  });\n\n  //- potentially hook into the subclass flow\n  Hooks.on(\"renderSubclassFlow\", (SubClassFlow, html, app) => {\n    \n    html.find('.pill-lg').text(get(levelUpSubClassObject)?.name)\n    //- remove drop listener\n    html.find('.pill-lg').off('drop');\n    html.find('.pill-lg').off('dragover');\n    html.find('.pill-lg').off('dragleave');\n    html.find('.pill-lg').off('dragenter');\n    html.find('.pill-lg').off('dragend');\n    html.find('.pill-lg').off('dragstart');\n    //- remove the click listener\n    html.find('div.pill-lg.roboto-upper.empty').off('click');\n    \n    // Remove the handler via the element's onclick property\n    const pillElement = html.find('.pill-lg')[0];\n    if (pillElement) {\n      pillElement.onclick = null;\n      // If data-action attribute is triggering the event, remove it too\n      pillElement.removeAttribute('data-action');\n    }\n  });\n\n\n}\n\n","import { DEFAULT_SOURCES, LOG_PREFIX, MODULE_ID } from '../helpers/constants';\n\nexport default class CompendiumSourcesSubmenu extends FormApplication {\n  constructor() {\n    super({});\n    this.baseCompendiumList = game.packs.filter((p) => p.documentName === 'Item');\n    this.filterPackSourcesAppropriatelyByName = game.settings.get(MODULE_ID, 'filterPackSourcesAppropriatelyByName');\n  }\n\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: ['form'],\n      popOut: true,\n      width: 420,\n      height: 600,\n\n      template: `/modules/foundryvtt-actor-studio/templates/sources-submenu.html`,\n      id: 'gas-settings-submenu',\n      title: 'Actor Studio - Sources',\n      resizable: false,\n    });\n  }\n\n  activateListeners(html) {\n    super.activateListeners(html);\n  }\n\n  getData() {\n    let selected = game.settings.get(MODULE_ID, 'compendiumSources');\n    if (foundry.utils.isEmpty(selected)) {\n      selected = DEFAULT_SOURCES;\n    }\n    const data = this.buildTemplateData({\n      compendiaList: this.baseCompendiumList,\n      selectedCompendia: selected,\n    });\n    return data;\n  }\n\n  _updateObject(event, formData) {\n    console.info(`${LOG_PREFIX} | Saving compendia sources:`);\n    console.info(formData);\n    return game.settings.set(MODULE_ID, 'compendiumSources', formData);\n  }\n\n  _getSubmitData(updateData) {\n    if (!this.form) throw new Error('The FormApplication subclass has no registered form element');\n    const fd = new FormDataExtended(this.form, { editors: this.editors });\n    const data = fd.object;\n    Object.keys(data).forEach((k) => data[k] = []);\n    this.form.querySelectorAll('[type=\"checkbox\"]:checked').forEach((el) => {\n      if (!Array.isArray(data[el.name]) || typeof data[el.name][0] === 'boolean') data[el.name] = [];\n      data[el.name].push(el.value);\n    });\n    return data;\n  }\n\n  buildTemplateData({ compendiaList, selectedCompendia }) {\n    return {\n      source: {\n        races: {\n          label: game.i18n.localize('GAS.Setting.Sources.RaceCompendia'),\n          compendia: this.buildCompendiaList(compendiaList, selectedCompendia, 'races',['race'])\n        },\n        classes: {\n          label: game.i18n.localize('GAS.Setting.Sources.ClassCompendia'),\n          compendia: this.buildCompendiaList(compendiaList, selectedCompendia, 'classes', ['class'], ['subclass'])\n        },\n        subclasses: {\n          label: game.i18n.localize('GAS.Setting.Sources.SubclassCompendia'),\n          compendia: this.buildCompendiaList(compendiaList, selectedCompendia, 'subclasses', ['subclass'])\n        },\n        backgrounds: {\n          label: game.i18n.localize('GAS.Setting.Sources.BackgroundCompendia'),\n          compendia: this.buildCompendiaList(compendiaList, selectedCompendia, 'backgrounds', ['background'])\n        },\n        equipment: {\n          label: game.i18n.localize('GAS.Setting.Sources.EquipmentCompendia'),\n          compendia: this.buildCompendiaList(compendiaList, selectedCompendia, 'equipment', ['item', 'equipment'])\n        },\n        spells: {\n          label: game.i18n.localize('GAS.Setting.Sources.SpellCompendia'),\n          compendia: this.buildCompendiaList(compendiaList, selectedCompendia, 'spells', ['spell'])\n        },\n        feats: {\n          label: game.i18n.localize('GAS.Setting.Sources.FeatCompendia'),\n          compendia: this.buildCompendiaList(compendiaList, selectedCompendia, 'feats', ['feat'])\n        }\n      }\n    };\n  }\n\n  /**\n   * Builds a list of compendia based on the inclusions and storage key.\n   * @param {Array} compendiaList - The list of compendia to filter.\n   * @param {string} defaultCollection - The default collection to filter by.\n   * @param {string} storageKey - The storage key to use for the filtered list.\n   * @param {Array} inclusions - The list of terms to include when filtering.\n   * @param {Array} exclusions - The list of exclusions to filter by.\n   * @returns {Array} The filtered list of compendia.\n   */\n  buildCompendiaList(compendiaList, defaultCollection, storageKey, inclusions = [], exclusions = []) {\n    window.GAS.log.d('buildCompendiaList input:', {\n      compendiaListLength: compendiaList.length,\n      defaultCollection,\n      inclusions,\n      storageKey,\n      exclusions,\n      filterEnabled: this.filterPackSourcesAppropriatelyByName\n    });\n\n    let filter = (pack) => {\n      const hasMatch = inclusions.some(inclusion =>\n        pack.metadata.id.toLowerCase().includes(inclusion.toLowerCase()) ||\n        pack.metadata.name.toLowerCase().includes(inclusion.toLowerCase()) ||\n        pack.metadata.path.toLowerCase().includes(inclusion.toLowerCase()) ||\n        pack.metadata.label.toLowerCase().includes(inclusion.toLowerCase())\n      );\n\n      const hasExclusion = exclusions.some(exclusion => \n        pack.metadata.id.toLowerCase().includes(exclusion.toLowerCase()) ||\n        pack.metadata.name.toLowerCase().includes(exclusion.toLowerCase()) ||\n        pack.metadata.path.toLowerCase().includes(exclusion.toLowerCase()) ||\n        pack.metadata.label.toLowerCase().includes(exclusion.toLowerCase())\n      );\n\n      window.GAS.log.d('Filtering pack:', {\n        id: pack.metadata.id,\n        name: pack.metadata.name,\n        path: pack.metadata.path,\n        label: pack.metadata.label,\n        inclusions,\n        hasMatch,\n        hasExclusion,\n        exclusions\n      });\n\n      return hasMatch && !hasExclusion;\n    };\n\n    const filteredCompendia = this.filterPackSourcesAppropriatelyByName ? compendiaList.filter(filter) : compendiaList;\n    \n    window.GAS.log.d('After filtering:', {\n      originalLength: compendiaList.length,\n      filteredLength: filteredCompendia.length,\n      filtered: filteredCompendia.map(p => ({\n        id: p.metadata.id,\n        name: p.metadata.name\n      }))\n    });\n\n    return filteredCompendia\n      .map((p) => ({\n        collection: p.collection,\n        label: `${p.metadata.label} [${p.metadata.packageName}]`,\n        checked: defaultCollection[storageKey]?.includes(p.collection),\n      }));\n  }\n}\n","<svelte:options accessors={true} />\n\n<script>\n   import { getContext }            from 'svelte';\n   import { TJSApplicationShell }   from '@typhonjs-fvtt/runtime/svelte/component/application';\n   import { Timing }                from '#runtime/util';\n   import SettingsFooter            from './SettingsFooter.svelte';\n   import { sessionConstants }      from '~/src/helpers/constants';\n   import { MODULE_ID }             from '~/src/helpers/constants';\n   import { camelCaseToTitleCase }  from '~/src/helpers/Utility';\n\n   export let elementRoot;\n\n   const { application } = getContext('#external');\n\n   // Get a store that is synchronized with session storage.\n   const stateStore = application.reactive.sessionStorage.getStore(sessionConstants.appState);\n\n   // Application position store reference. Stores need to be a top level variable to be accessible for reactivity.\n   const position = application.position;\n\n   // A debounced callback that serializes application state after 500-millisecond delay.\n   const storePosition = Timing.debounce(() => $stateStore = application.state.get(), 500);\n\n   // Reactive statement to invoke debounce callback on Position changes.\n   $: storePosition($position);\n\n   // Settings state\n   let enableDonationTracker = game.settings.get(MODULE_ID, 'enable-donation-tracker');\n   let enableUnregisteredAccess = game.settings.get(MODULE_ID, 'enable-donation-tracker-unregistered-access');\n   let membershipRanks = game.membership?.RANKS || {};\n   let rankSettings = {};\n\n   // Initialize rank settings\n   $: {\n      rankSettings = {};\n      if (Object.keys(membershipRanks).length > 0) {\n         for (const [rank, value] of Object.entries(membershipRanks)) {\n            if (value === -1) continue;\n            const key = `donation-tracker-rank-${rank}`;\n            rankSettings[rank] = game.settings.get(MODULE_ID, key);\n         }\n      }\n   }\n\n   // Update functions\n   function updateEnableDonationTracker() {\n      game.settings.set(MODULE_ID, 'enable-donation-tracker', enableDonationTracker);\n   }\n\n   function updateEnableUnregisteredAccess() {\n      game.settings.set(MODULE_ID, 'enable-donation-tracker-unregistered-access', enableUnregisteredAccess);\n   }\n\n   function updateRankSetting(rank) {\n      const key = `donation-tracker-rank-${rank}`;\n      game.settings.set(MODULE_ID, key, rankSettings[rank]);\n   }\n</script>\n\n<TJSApplicationShell bind:elementRoot>\n   <main class=\"donation-tracker-settings\">\n      <div class=\"settings-section\">\n         <h3>Donation Tracker Settings</h3>\n         \n         <div class=\"setting-item\">\n            <label class=\"setting-label\">\n               <input \n                  type=\"checkbox\" \n                  bind:checked={enableDonationTracker}\n                  on:change={updateEnableDonationTracker}\n               />\n               {game.i18n.localize('GAS.Setting.DonationTrackerEnabled.Name')}\n            </label>\n            <p class=\"setting-hint\">{game.i18n.localize('GAS.Setting.DonationTrackerEnabled.Hint')}</p>\n         </div>\n\n         <div class=\"setting-item\">\n            <label class=\"setting-label\">\n               <input \n                  type=\"checkbox\" \n                  bind:checked={enableUnregisteredAccess}\n                  on:change={updateEnableUnregisteredAccess}\n               />\n               {game.i18n.localize('GAS.Setting.DonationTracker_UnregisteredAccess.Name')}\n            </label>\n            <p class=\"setting-hint\">{game.i18n.localize('GAS.Setting.DonationTracker_UnregisteredAccess.Hint')}</p>\n         </div>\n      </div>\n\n      {#if Object.keys(membershipRanks).length > 0}\n         <div class=\"settings-section\">\n            <h3>Membership Ranks</h3>\n            {#each Object.entries(membershipRanks) as [rank, value]}\n               {#if value !== -1}\n                  <div class=\"setting-item\">\n                     <label class=\"setting-label\">\n                        {camelCaseToTitleCase(rank)}:\n                        <input \n                           type=\"text\" \n                           bind:value={rankSettings[rank]}\n                           on:change={() => updateRankSetting(rank)}\n                           placeholder={camelCaseToTitleCase(rank)}\n                        />\n                     </label>\n                     <p class=\"setting-hint\">\n                        {game.i18n.localize('GAS.Setting.DonationTrackerRank.Hint')}: {camelCaseToTitleCase(rank)}\n                     </p>\n                  </div>\n               {/if}\n            {/each}\n         </div>\n      {/if}\n\n      <SettingsFooter slot=settings-footer />\n   </main>\n</TJSApplicationShell>\n\n<style lang=\"sass\">\n   :root\n      --tjs-settings-edit-background-color: rgba(0,0,0,0.9)\n      --tjs-settings-edit-color: white\n      --tjs-settings-entry-hint-color: #999\n      --tjs-settings-entry-label-color: white\n\n   :global(#gas-donation-tracker-settings)\n      background-color: rgba(0,0,0,0.9)\n      color: white\n\n   :global(#gas-donation-tracker-settings .tjs-input)\n      color: white\n\n   .donation-tracker-settings\n      padding: 1rem\n      color: white\n      background-color: rgba(0,0,0,0.9)\n\n   .settings-section\n      margin-bottom: 2rem\n\n   .settings-section h3\n      color: white\n      border-bottom: 1px solid #666\n      padding-bottom: 0.5rem\n      margin-bottom: 1rem\n\n   .setting-item\n      margin-bottom: 1.5rem\n\n   .setting-label\n      display: flex\n      align-items: center\n      gap: 0.5rem\n      color: white\n      font-weight: bold\n      margin-bottom: 0.25rem\n\n   .setting-label input[type=\"checkbox\"]\n      margin: 0\n\n   .setting-label input[type=\"text\"]\n      margin-left: 0.5rem\n      padding: 0.25rem 0.5rem\n      background-color: #333\n      border: 1px solid #666\n      color: white\n      border-radius: 3px\n\n   .setting-hint\n      color: #999\n      font-size: 0.9em\n      margin: 0.25rem 0 0 1.5rem\n</style>","import { SvelteApplication }  from '#runtime/svelte/application';\n\nimport DonationTrackerSettingsAppShell  from './DonationTrackerSettingsAppShell.svelte';\n\n\nexport default class DonationTrackerSettingsApp extends SvelteApplication\n{\n   /** @inheritDoc */\n   constructor(options)\n   {\n      super(options);\n   }\n\n   /**\n    *\n    */\n   static get defaultOptions()\n   {\n      return foundry.utils.mergeObject(super.defaultOptions, {\n         title: 'GAS.Setting.DonationTracker.Name',\n         id: 'gas-donation-tracker-settings',\n         resizable: true,\n         minimizable: true,\n         width: 600,\n         height: 550,\n         minWidth: 550,\n         headerIcon: 'modules/foundryvtt-actor-studio/assets/actor-studio-logo-dragon-white.png',\n\n         svelte: {\n            class: DonationTrackerSettingsAppShell,\n            target: document.body\n         }\n      });\n   }\n}","import DonationTrackerSettingsApp   from './DonationTrackerSettingsApp.js';\n\nexport default class DonationTrackerSettingsButton extends FormApplication\n{\n   static #dtSettingsApp;\n\n   static showSettings()\n   {\n      this.#dtSettingsApp = this.#dtSettingsApp ? this.#dtSettingsApp : new DonationTrackerSettingsApp();\n      this.#dtSettingsApp.render(true, { focus: true });\n\n      return this.#dtSettingsApp;\n   }\n\n   /**\n    * @inheritDoc\n    */\n   constructor(options = {})\n   {\n      super({}, options);\n      DonationTrackerSettingsButton.showSettings();\n   }\n\n   async _updateObject(event, formData) {}\n   render() { this.close(); }\n}","import CompendiumSourcesSubmenu from './compendiumSourcesSubmenu';\nimport DonationTrackerSettingsButton from './DonationTrackerSettingsButton';\nimport { MODULE_ID, LOG_PREFIX, DEFAULT_SOURCES } from '../helpers/constants';\n\n// settings not shown on the Module Settings - not modifiable by users\nexport const enum PrivateSettingKeys {\n  LAST_MIGRATION = 'lastMigration',\n  LEVEL_UP_IN_PROGRESS = 'levelUpInProgress',\n}\n\nexport function registerSettings(app: Game): void {\n  window.GAS.log.d(\"Building module settings\");\n\n  Handlebars.registerHelper('checkedIf', function (condition) {\n    return condition ? 'checked' : '';\n  });\n\n  /**  Disabled settings */\n  // showRollsAsChatMessages();\n  // individualPanelScrolls();\n  // tokenDisplayNameMode();\n  // tokenDisplayBarsMode();\n  // equipmentBlacklist();\n  // subraceNameBlacklist();\n  // buttonOnDialogInsteadOfActorsDirectory();\n  // trimSubclasses();\n  // custom packs\n  // integrations\n  // useTokenizerIfAvailable();\n  // private settings\n  lastMigration();\n  levelUpInProgress();\n  // abilityScoreMethods();\n  \n  \n  /** World Settings */\n  sourcesConfiguration();\n  donationTracker();\n  defaultStartingGoldDice();\n  allowManualInput();\n  allowStandardArray();\n  allowPointBuy();\n  pointBuyLimit();\n  allowRolling(app);\n  abilityRollFormula();\n  allowAbilityRollScoresToBeMoved();\n  showButtonInSideBar(app);\n  disableOtherActorCreationOptionsForPlayers();\n  nonGmsCanOnlyCreatePCs();\n  filterPackSourcesAppropriatelyByName();\n  showPackLabelInSelect();\n  illuminatedDescription();\n  illuminatedWidth();\n  illuminatedHeight();\n  enableEquipmentSelection();\n  enableEquipmentPurchase();\n  enableSpellSelection();\n  windowX();\n  windowY();\n  experimentalCharacterNameStyling();\n  enableLevelUp();\n  milestoneLeveling();\n  forceDnd5eLevelUpAutomation();\n  debugSetting();\n  debugHooksSetting();\n  disableAdvancementCapture();\n  advancementCaptureTimerThreshold();\n  enableCustomFeatSelector();\n  usageTracking();\n  /** User settings */\n  dontShowWelcome();\n}\n\nfunction illuminatedHeight() {\n  game.settings.register(MODULE_ID, 'illuminatedHeight', {\n    name: game.i18n.localize('GAS.Setting.illuminatedHeight.Name'),\n    hint: game.i18n.localize('GAS.Setting.illuminatedHeight.Hint'),\n    scope: 'world',\n    config: true,\n    default: '100',\n    type: String,\n  });\n}\nfunction illuminatedWidth() {\n  game.settings.register(MODULE_ID, 'illuminatedWidth', {\n    name: game.i18n.localize('GAS.Setting.illuminatedWidth.Name'),\n    hint: game.i18n.localize('GAS.Setting.illuminatedWidth.Hint'),\n    scope: 'world',\n    config: true,\n    default: '100',\n    type: String,\n  });\n}\n\nexport function filterPackSourcesAppropriatelyByName() {\n  game.settings.register(MODULE_ID, 'filterPackSourcesAppropriatelyByName', {\n    name: game.i18n.localize('GAS.Setting.FilterPackSourcesAppropriatelyByName.Name'),\n    hint: game.i18n.localize('GAS.Setting.FilterPackSourcesAppropriatelyByName.Hint'),\n    scope: 'world',\n    config: true,\n    default: false,\n    type: Boolean,\n  });\n}\n\nexport function illuminatedDescription() {\n  game.settings.register(MODULE_ID, 'illuminatedDescription', {\n    name: game.i18n.localize('GAS.Setting.illuminatedDescription.Name'),\n    hint: game.i18n.localize('GAS.Setting.illuminatedDescription.Hint'),\n    scope: 'world',\n    config: true,\n    default: true,\n    type: Boolean,\n  });\n}\n\nfunction allowAbilityRollScoresToBeMoved() {\n  game.settings.register(MODULE_ID, 'allowAbilityRollScoresToBeMoved', {\n    name: game.i18n.localize('GAS.Setting.AllowAbilityRollScoresToBeMoved.Name'),\n    hint: game.i18n.localize('GAS.Setting.AllowAbilityRollScoresToBeMoved.Hint'),\n    scope: 'world',\n    config: true,\n    default: true,\n    type: Boolean,\n  });\n}\n\nfunction enableLevelUp() {\n  game.settings.register(MODULE_ID, 'enableLevelUp', {\n    name: game.i18n.localize('GAS.Setting.EnableLevelUp.Name'),\n    hint: game.i18n.localize('GAS.Setting.EnableLevelUp.Hint'),\n    scope: 'world',\n    config: true,\n    default: true,\n    type: Boolean,\n    onChange: () => {\n      Dialog.confirm({\n        title: game.i18n.localize('GAS.Dialog.ReloadRequiredTitle'),\n        content: `<p>${game.i18n.localize('GAS.Dialog.ReloadRequiredContent')}</p>`,\n        yes: () => window.location.reload(),\n        no: () => {},\n        defaultYes: true\n      });\n    }\n  });\n}\n\nfunction milestoneLeveling() {\n  game.settings.register(MODULE_ID, 'milestoneLeveling', {\n    name: game.i18n.localize('GAS.Setting.milestoneLeveling.Name'),\n    hint: game.i18n.localize('GAS.Setting.milestoneLeveling.Hint'),\n    scope: 'world',\n    config: true,\n    default: false,\n    type: Boolean,\n    onChange: () => {\n      Dialog.confirm({\n        title: game.i18n.localize('GAS.Dialog.ReloadRequiredTitle'),\n        content: `<p>${game.i18n.localize('GAS.Dialog.ReloadRequiredContent')}</p>`,\n        yes: () => window.location.reload(),\n        no: () => {},\n        defaultYes: true\n      });\n    }\n  });\n}\n\nfunction showPackLabelInSelect() {\n  game.settings.register(MODULE_ID, 'showPackLabelInSelect', {\n    name: game.i18n.localize('GAS.Setting.ShowPackLabelInSelect.Name'),\n    hint: game.i18n.localize('GAS.Setting.ShowPackLabelInSelect.Hint'),\n    scope: 'world',\n    config: true,\n    default: true,\n    type: Boolean,\n  });\n}\n\n\nfunction nonGmsCanOnlyCreatePCs() {\n  game.settings.register(MODULE_ID, 'nonGmsCanOnlyCreatePCs', {\n    name: game.i18n.localize('GAS.Setting.NonGmsCanOnlyCreatePCs.Name'),\n    hint: game.i18n.localize('GAS.Setting.NonGmsCanOnlyCreatePCs.Hint'),\n    scope: 'world',\n    config: true,\n    type: Boolean,\n    default: true\n  });\n}\nfunction disableOtherActorCreationOptionsForPlayers() {\n  game.settings.register(MODULE_ID, 'disableOtherActorCreationOptionsForPlayers', {\n    name: game.i18n.localize('GAS.Setting.DisableOtherActorCreationOptionsForPlayers.Name'),\n    hint: game.i18n.localize('GAS.Setting.DisableOtherActorCreationOptionsForPlayers.Hint'),\n    scope: 'world',\n    config: true,\n    type: Boolean,\n    default: false\n  });\n}\n\nfunction disableAdvancementCapture() {\n  game.settings.register(MODULE_ID, 'disableAdvancementCapture', {\n    name: game.i18n.localize('GAS.Setting.disableAdvancementCapture.Name'),\n    hint: game.i18n.localize('GAS.Setting.disableAdvancementCapture.Hint'),\n    scope: 'world',\n    config: true,\n    type: Boolean,\n    default: false\n  });\n}\n\nfunction enableCustomFeatSelector() {\n  game.settings.register(MODULE_ID, 'enableCustomFeatSelector', {\n    name: 'Enable Custom Feat Selector',\n    hint: 'Replace the default dnd5e compendium browser with a custom feat selector modal for ItemChoice feat advancements.',\n    scope: 'world',\n    config: true,\n    type: Boolean,\n    default: false\n  });\n}\n\n\nfunction advancementCaptureTimerThreshold() {\n  game.settings.register(MODULE_ID, 'advancementCaptureTimerThreshold', {\n    name: game.i18n.localize('GAS.Setting.AdvancementCaptureTimerThreshold.Name'),\n    hint: game.i18n.localize('GAS.Setting.AdvancementCaptureTimerThreshold.Hint'),\n    scope: 'world',\n    config: true,\n    default: 300,\n    type: Number,\n  });\n}\n\nfunction sourcesConfiguration() {\n  game.settings.register(MODULE_ID, 'compendiumSources', {\n    scope: 'world',\n    config: false,\n    type: Object,\n    default: DEFAULT_SOURCES,\n    onChange: () => {\n      Dialog.confirm({\n        title: game.i18n.localize('GAS.Dialog.ReloadRequiredTitle'),\n        content: `<p>${game.i18n.localize('GAS.Dialog.ReloadRequiredContent')}</p>`,\n        yes: () => window.location.reload(),\n        no: () => {},\n        defaultYes: true\n      });\n    }\n  });\n  // Define a settings submenu which handles advanced configuration needs\n  game.settings.registerMenu(MODULE_ID, 'compendiumSources', {\n    name: game.i18n.localize('GAS.Setting.Sources.Name'),\n    hint: game.i18n.localize('GAS.Setting.Sources.Hint'),\n    label: game.i18n.localize('GAS.Setting.Sources.Label'),\n    icon: 'fas fa-atlas',\n    type: CompendiumSourcesSubmenu,\n    restricted: true,\n  });\n}\n\nfunction equipmentBlacklist() {\n  game.settings.register(MODULE_ID, 'equipmentsBlackList', {\n    name: game.i18n.localize('GAS.Setting.EquipmentBlacklist.Name'),\n    hint: game.i18n.localize('GAS.Setting.EquipmentBlacklist.Hint'),\n    scope: 'world',\n    config: true,\n    default:\n      'Potion of Climbing; Potion of Healing; Spell Scroll 1st Level; Spell Scroll Cantrip Level; Unarmed Strike',\n    type: String,\n  });\n}\n\nfunction subraceNameBlacklist() {\n  game.settings.register(MODULE_ID, 'subracesBlacklist', {\n    name: game.i18n.localize('GAS.Setting.SubraceNameBlacklist.Name'),\n    hint: game.i18n.localize('GAS.Setting.SubraceNameBlacklist.Hint'),\n    scope: 'world',\n    config: true,\n    default: 'Gnome Cunning; Halfling Nimbleness',\n    type: String,\n  });\n}\n\nfunction trimSubclasses() {\n  game.settings.register(MODULE_ID, 'trimSubclasses', {\n    name: game.i18n.localize('GAS.Setting.TrimSubclasses.Name'),\n    hint: game.i18n.localize('GAS.Setting.TrimSubclasses.Hint'),\n    scope: 'world',\n    config: true,\n    default: true,\n    type: Boolean,\n  });\n}\n\nfunction forceDnd5eLevelUpAutomation() {\n  game.settings.register(MODULE_ID, 'forceDnd5eLevelUpAutomation', {\n    name: game.i18n.localize('GAS.Setting.forceDnd5eLevelUpAutomation.Name'),\n    hint: game.i18n.localize('GAS.Setting.forceDnd5eLevelUpAutomation.Hint'),\n    scope: 'world',\n    config: true,\n    default: true,\n    type: Boolean,\n  });\n}\n\nfunction dontShowWelcome() {\n  game.settings.register(MODULE_ID, 'dontShowWelcome', {\n    name: game.i18n.localize('GAS.Setting.DontShowWelcome.Name'),\n    hint: game.i18n.localize('GAS.Setting.DontShowWelcome.Hint'),\n    scope: 'user',\n    config: true,\n    default: false,\n    type: Boolean,\n  });\n}\n\nfunction defaultStartingGoldDice() {\n  game.settings.register(MODULE_ID, 'defaultGoldDice', {\n    name: game.i18n.localize('GAS.Setting.defaultGoldDice.Name'),\n    hint: game.i18n.localize('GAS.Setting.defaultGoldDice.Hint'),\n    scope: 'world',\n    config: true,\n    default: '5d4 * 10',\n    type: String,\n  });\n}\n\nfunction useTokenizerIfAvailable() {\n  game.settings.register(MODULE_ID, 'useTokenizer', {\n    name: game.i18n.localize('GAS.Setting.UseTokenizer.Name'),\n    hint: game.i18n.localize('GAS.Setting.UseTokenizer.Hint'),\n    scope: 'world',\n    config: true,\n    type: Boolean,\n    default: false,\n  });\n}\n\nfunction buttonOnDialogInsteadOfActorsDirectory() {\n  game.settings.register(MODULE_ID, 'buttonOnDialog', {\n    name: game.i18n.localize('GAS.Setting.ButtonOnDialogInsteadOfActorsDirectory.Name'),\n    hint: game.i18n.localize('GAS.Setting.ButtonOnDialogInsteadOfActorsDirectory.Hint'),\n    scope: 'world',\n    config: true,\n    type: Boolean,\n    default: false,\n  });\n}\n\nfunction tokenDisplayBarsMode() {\n  game.settings.register(MODULE_ID, 'displayBarsMode', {\n    name: game.i18n.localize('GAS.Setting.TokenBarMode.Name'),\n    scope: 'world',\n    config: true,\n    type: Number,\n    choices: {\n      0: 'Never Displayed',\n      10: 'When Controlled',\n      20: 'Hover by Owner',\n      30: 'Hover by Anyone',\n      40: 'Always for Owner',\n      50: 'Always for Anyone',\n    },\n    default: 20,\n  });\n}\n\nfunction tokenDisplayNameMode() {\n  game.settings.register(MODULE_ID, 'displayNameMode', {\n    name: game.i18n.localize('GAS.Setting.TokenNameMode.Name'),\n    scope: 'world',\n    config: true,\n    type: Number,\n    choices: {\n      0: 'Never Displayed',\n      10: 'When Controlled',\n      20: 'Hover by Owner',\n      30: 'Hover by Anyone',\n      40: 'Always for Owner',\n      50: 'Always for Anyone',\n    },\n    default: 20,\n  });\n}\n\nfunction showRollsAsChatMessages() {\n  game.settings.register(MODULE_ID, 'showRolls', {\n    name: game.i18n.localize('GAS.Setting.ShowRolls.Name'),\n    hint: game.i18n.localize('GAS.Setting.ShowRolls.Hint'),\n    scope: 'world',\n    config: true,\n    type: Boolean,\n    default: true,\n  });\n}\n\nfunction individualPanelScrolls() {\n  game.settings.register(MODULE_ID, 'individualScrolls', {\n    name: game.i18n.localize('GAS.Setting.IndividualPanelScroll.Name'),\n    hint: game.i18n.localize('GAS.Setting.IndividualPanelScroll.Hint'),\n    scope: 'client',\n    config: true,\n    type: Boolean,\n    default: false,\n  });\n}\n\n\nfunction pointBuyLimit() {\n  game.settings.register(MODULE_ID, 'pointBuyLimit', {\n    name: game.i18n.localize('GAS.Setting.AbilityEntry.PointBuyLimit.Name'),\n    hint: game.i18n.localize('GAS.Setting.AbilityEntry.PointBuyLimit.Hint'),\n    scope: 'world',\n    config: true,\n    default: 27,\n    type: Number,\n  });\n}\nfunction windowX() {\n  game.settings.register(MODULE_ID, 'windowX', {\n    name: game.i18n.localize('GAS.Setting.WindowX.Name'),\n    hint: game.i18n.localize('GAS.Setting.WindowX.Hint'),\n    scope: 'world',\n    config: true,\n    default: 720,\n    type: Number,\n  });\n}\nfunction windowY() {\n  game.settings.register(MODULE_ID, 'windowY', {\n    name: game.i18n.localize('GAS.Setting.WindowY.Name'),\n    hint: game.i18n.localize('GAS.Setting.WindowY.Hint'),\n    scope: 'world',\n    config: true,\n    default: 800,\n    type: Number,\n  });\n}\n\nfunction abilityRollFormula() {\n  game.settings.register(MODULE_ID, 'abiiltyRollFormula', {\n    name: game.i18n.localize('GAS.Setting.AbilityEntry.AbilityRollFormula.Name'),\n    hint: game.i18n.localize('GAS.Setting.AbilityEntry.AbilityRollFormula.Hint'),\n    scope: 'world',\n    config: true,\n    default: '4d6kh3',\n    type: String,\n    onChange: () => { console.log('allowPointBuy') },\n    updateSetting: () => { console.log('updateSetting'); },\n  });\n}\n\n\nfunction allowManualInput() {\n  game.settings.register(MODULE_ID, 'allowManualInput', {\n    name: game.i18n.localize('GAS.Setting.AbilityEntry.AllowManualInput.Name'),\n    hint: game.i18n.localize('GAS.Setting.AbilityEntry.AllowManualInput.Hint'),\n    scope: 'world',\n    config: true,\n    type: Boolean,\n    default: true,\n  });\n}\n\nfunction allowStandardArray() {\n  game.settings.register(MODULE_ID, 'allowStandardArray', {\n    name: game.i18n.localize('GAS.Setting.AbilityEntry.AllowStandardArray.Name'),\n    hint: game.i18n.localize('GAS.Setting.AbilityEntry.AllowStandardArray.Hint'),\n    scope: 'world',\n    config: true,\n    default: false,\n    type: Boolean,\n  });\n}\n\nfunction allowPointBuy() {\n  game.settings.register(MODULE_ID, 'allowPointBuy', {\n    name: game.i18n.localize('GAS.Setting.AbilityEntry.AllowPointBuy.Name'),\n    hint: game.i18n.localize('GAS.Setting.AbilityEntry.AllowPointBuy.Hint'),\n    scope: 'world',\n    config: true,\n    default: false,\n    onChange: () => { console.log('allowPointBuy') },\n    updateSetting: () => { console.log('updateSetting'); },\n    type: Boolean,\n  });\n}\n\nfunction allowRolling(app) {\n  game.settings.register(MODULE_ID, 'allowRolling', {\n    name: game.i18n.localize('GAS.Setting.AbilityEntry.AllowRolling.Name'),\n    hint: game.i18n.localize('GAS.Setting.AbilityEntry.AllowRolling.Hint'),\n    scope: 'world',\n    config: true,\n    default: false,\n    onChange: () => { console.log('allowPointBuy') },\n    updateSetting: () => { console.log('updateSetting'); },\n    type: Boolean,\n  });\n}\n\nfunction showButtonInSideBar(app) {\n  game.settings.register(MODULE_ID, 'showButtonInSideBar', {\n    name: game.i18n.localize('GAS.Setting.showButtonInSideBar.Name'),\n    hint: game.i18n.localize('GAS.Setting.showButtonInSideBar.Hint'),\n    scope: 'world',\n    config: true,\n    default: false,\n    type: Boolean,\n  });\n}\nfunction debugSetting() {\n  game.settings.register(MODULE_ID, 'debug', {\n    name: game.i18n.localize('GAS.Setting.debug.Name'),\n    hint: game.i18n.localize('GAS.Setting.debug.Hint'),\n    scope: 'world',\n    config: true,\n    default: false,\n    type: Boolean,\n    onChange: () => {\n      Dialog.confirm({\n        title: game.i18n.localize('GAS.Dialog.ReloadRequiredTitle'),\n        content: `<p>${game.i18n.localize('GAS.Dialog.ReloadRequiredContent')}</p>`,\n        yes: () => window.location.reload(),\n        no: () => {},\n        defaultYes: true\n      });\n    }\n  });\n}\nfunction debugHooksSetting() {\n  game.settings.register(MODULE_ID, 'debug.hooks', {\n    name: game.i18n.localize('GAS.Setting.debugHooks.Name'),\n    hint: game.i18n.localize('GAS.Setting.debugHooks.Hint'),\n    scope: 'world',\n    config: true,\n    default: false,\n    type: Boolean,\n    onChange: () => {\n      Dialog.confirm({\n        title: game.i18n.localize('GAS.Dialog.ReloadRequiredTitle'),\n        content: `<p>${game.i18n.localize('GAS.Dialog.ReloadRequiredContent')}</p>`,\n        yes: () => window.location.reload(),\n        no: () => {},\n        defaultYes: true\n      });\n    }\n  });\n}\n\nfunction donationTracker() {\n  if (!game.modules.get('donation-tracker')?.active) return;\n\n  Hooks.on('actor-studio-donation-tracker:settings', () => {\n    if (game.user.isGM) { DonationTrackerSettingsButton.showSettings(); }\n  });\n\n  game.settings.registerMenu(MODULE_ID, 'DonationTracker', {\n    name: game.i18n.localize('GAS.Setting.DonationTracker.Name'),\n    hint: game.i18n.localize('GAS.Setting.DonationTracker.Hint'),\n    label: game.i18n.localize('GAS.Setting.DonationTracker.Label'),\n    icon: 'fas fa-coins',\n    type: DonationTrackerSettingsButton,\n    restricted: true,\n    onChange: () => {\n      Hooks.call('actor-studio-donation-tracker:settings');\n    }\n  });\n\n}\n\n// PRIVATE SETTINGS\n\nfunction lastMigration() {\n  game.settings.register(MODULE_ID, PrivateSettingKeys.LAST_MIGRATION, {\n    scope: 'world',\n    config: false,\n    default: 0,\n    type: Number,\n  });\n}\n\nfunction levelUpInProgress() {\n  game.settings.register(MODULE_ID, PrivateSettingKeys.LEVEL_UP_IN_PROGRESS, {\n    scope: 'world',\n    config: false,\n    default: false,\n    type: Boolean,\n  });\n}\n\nfunction enableEquipmentSelection() {\n  game.settings.register(MODULE_ID, 'enableEquipmentSelection', {\n    name: game.i18n.localize('GAS.Setting.EnableEquipmentSelection.Name'),\n    hint: game.i18n.localize('GAS.Setting.EnableEquipmentSelection.Hint'),\n    scope: 'world',\n    config: true,\n    default: false,\n    type: Boolean,\n    onChange: () => {\n      Dialog.confirm({\n        title: game.i18n.localize('GAS.Dialog.ReloadRequiredTitle'),\n        content: `<p>${game.i18n.localize('GAS.Dialog.ReloadRequiredContent')}</p>`,\n        yes: () => window.location.reload(),\n        no: () => {},\n        defaultYes: true\n      });\n    }\n  });\n}\n\nfunction enableEquipmentPurchase() {\n  game.settings.register(MODULE_ID, 'enableEquipmentPurchase', {\n    name: game.i18n.localize('GAS.Setting.EnableEquipmentPurchase.Name'),\n    hint: game.i18n.localize('GAS.Setting.EnableEquipmentPurchase.Hint'),\n    scope: 'world',\n    config: true,\n    default: false,\n    type: Boolean,\n    onChange: () => {\n      Dialog.confirm({\n        title: game.i18n.localize('GAS.Dialog.ReloadRequiredTitle'),\n        content: `<p>${game.i18n.localize('GAS.Dialog.ReloadRequiredContent')}</p>`,\n        yes: () => window.location.reload(),\n        no: () => {},\n        defaultYes: true\n      });\n    }\n  });\n}\n\nfunction enableSpellSelection() {\n  game.settings.register(MODULE_ID, 'enableSpellSelection', {\n    name: game.i18n.localize('GAS.Setting.EnableSpellSelection.Name'),\n    hint: game.i18n.localize('GAS.Setting.EnableSpellSelection.Hint'),\n    scope: 'world',\n    config: true,\n    default: false,\n    type: Boolean,\n    onChange: () => {\n      Dialog.confirm({\n        title: game.i18n.localize('GAS.Dialog.ReloadRequiredTitle'),\n        content: `<p>${game.i18n.localize('GAS.Dialog.ReloadRequiredContent')}</p>`,\n        yes: () => window.location.reload(),\n        no: () => {},\n        defaultYes: true\n      });\n    }\n  });\n}\n\nfunction experimentalCharacterNameStyling() {\n  game.settings.register(MODULE_ID, 'experimentalCharacterNameStyling', {\n    name: game.i18n.localize('GAS.Setting.ExperimentalCharacterNameStyling.Name'),\n    hint: game.i18n.localize('GAS.Setting.ExperimentalCharacterNameStyling.Hint'),\n    scope: 'world',\n    config: true,\n    default: false,\n    type: Boolean,\n  });\n}\n\nfunction usageTracking() {\n  game.settings.register(MODULE_ID, 'usage-tracking', {\n    name: 'Usage Tracking',\n    hint: 'Allow Actor Studio to collect anonymous usage data to help improve the module. No personal information is collected.',\n    scope: 'user',\n    config: true,\n    type: Boolean,\n    default: true,\n    onChange: (value) => {\n      if (!value) {\n        Dialog.confirm({\n          title: 'Disable Usage Tracking?',\n          content: `<p>Disabling usage tracking means we wont know which languages or features are most important to our users. This anonymous data helps us improve Actor Studio for everyone. Are you sure you want to disable it?</p>`,\n          yes: () => {\n            if (window.GASUsageTracker) window.GASUsageTracker.consentGranted = false;\n          },\n          no: () => {\n            // Re-enable the setting if user cancels\n            game.settings.set(MODULE_ID, 'usage-tracking', true);\n          },\n          defaultYes: false\n        });\n      } else {\n        if (window.GASUsageTracker) {\n          window.GASUsageTracker.consentGranted = true;\n          if (window.GASUsageTracker.offlineEvents.length > 0) {\n            window.GASUsageTracker.syncOfflineEvents();\n          }\n        }\n      }\n    }\n  });\n}\n","// Initialize the Equipment Purchase feature\nimport { MODULE_ID } from '~/src/helpers/constants';\n\n// Import and initialize the equipment shop stores early\nimport '~/src/stores/equipmentShop.js';\n\nexport const initEquipmentPurchase = () => {\n  // Register the equipmentPurchase feature in the global window.GAS object\n  if (!window.GAS) window.GAS = {};\n  \n  // Create helper function for adding Shop tab\n  window.GAS.registerShopTab = (tabs, activeTab) => {\n    // Only add if not already present\n    if (!tabs.find(x => x.id === \"shop\")) {\n      window.GAS.log.d('[EQUIPMENT-PURCHASE] Adding shop tab');\n      // Use component name only - the tab system will look for it in ~/src/components/organisms/dnd5e/Tabs/\n      tabs.update(t => [...t, { label: \"Shop\", id: \"shop\", component: \"ShopTab\" }]);\n      activeTab.set(\"shop\");\n    }\n  };\n  \n  // Initialize equipment shop main store\n  window.GAS.initShopGold = (totalGold) => {\n    if (window.GAS.availableGold) {\n      window.GAS.availableGold.set(totalGold * 100); // Convert to copper\n      window.GAS.log.d('[EQUIPMENT-PURCHASE] Initialized shop with gold:', totalGold);\n    } else {\n      window.GAS.log.e('[EQUIPMENT-PURCHASE] Failed to initialize shop gold - store not found');\n    }\n  };\n};\n","import { MODULE_ID } from '../../helpers/constants';\n\nexport default class SubclassLevelPlugin {\n  static ID = 'subclass-level';\n\n  /**\n   * Initialize the plugin\n   */\n  static init() {\n    \n    if (window.GAS.dnd5eVersion > 3) {\n      window.GAS.log.i('Subclass Level Plugin is not supported for DND5E version 3 and above, as it is now handled by the DND5E system.');\n      return false;\n    }\n\n    this.registerHooks();\n  }\n\n  /**\n   * Register necessary hooks\n   */\n  static registerHooks() {\n    // Hook into advancement selection rendering\n    Hooks.on('renderAdvancementSelection', this._onRenderAdvancementSelection.bind(this));\n    Hooks.on('renderItemSheet5e', this._onRenderItemSheet5e.bind(this));\n\n  }\n\n  /**\n   * Handle rendering the advancement selection interface\n   */\n  static async _onRenderAdvancementSelection(app, html, data) {\n\n    // Only proceed if this is a class item\n    const item = app.item;\n    if (!item || item.type !== 'class') return;\n\n    // Add our subclass option to the types list\n    window.GAS.log.d('html', html);\n    window.GAS.log.d('$(html)', $(html));\n    const typeList = html.find('.items-list');\n    html.addClass('gas dnd5e v3x')\n    window.GAS.log.d('Type List: ', typeList);\n    const subclassOption = `\n      <li class=\"item flexrow\">\n        <div class=\"item-name flexrow\">\n          <div class=\"item-image\" style=\"background-image: url('modules/${MODULE_ID}/assets/dnd5e/3.x/subclass.svg')\"></div>\n          <h3>Subclass</h3>\n        </div>\n        <div class=\"item-controls flexrow\">\n          <input name=\"type\" type=\"radio\" value=\"Subclass\">\n        </div>\n        <div class=\"item-hint notes\">\n          Specify what level this class receives its subclass.\n        </div>\n      </li>\n    `;\n    typeList.append(subclassOption);\n    const button = html.find('[data-button=\"submit\"]');\n    window.GAS.log.d('Button: ', button);\n    \n    // Store the original click handler\n    const originalClickHandler = $._data(button[0], 'events')?.click?.[0]?.handler;\n    \n    button.off('click').on('click', async function(event) {\n      const selectedType = html.find('input[name=\"type\"]:checked').val();\n      if (selectedType === 'Subclass') {\n        await SubclassLevelPlugin._showLevelDialog(item);\n        app.close();\n      } else if (originalClickHandler) {\n        // Call the original handler for non-Subclass selections\n        originalClickHandler.call(this, event);\n      }\n    });\n  }\n\n  /**\n   * Show dialog for setting subclass level\n   */\n  static async _showLevelDialog(item) {\n    const currentLevel = this.getSubclassLevel(item);\n    const content = `\n      <form>\n        <div class=\"form-group\">\n          <label>Select Level</label>\n          <select name=\"level\">\n            ${Array.from({ length: 20 }, (_, i) => i + 1).map(level =>\n      `<option value=\"${level}\" ${currentLevel === level ? 'selected' : ''}>${level}</option>`\n    ).join('')}\n          </select>\n        </div>\n      </form>\n    `;\n\n    const dialog = new Dialog({\n      title: `Set Subclass Level for ${item.name}`,\n      content,\n      buttons: {\n        submit: {\n          label: \"Save\",\n          callback: async (html) => {\n            const level = Number(html.find('[name=\"level\"]').val());\n            await this.setSubclassLevel(item, level);\n          }\n        },\n        cancel: {\n          label: \"Cancel\"\n        }\n      },\n      default: \"submit\"\n    });\n\n    dialog.render(true);\n  }\n\n  static _onRenderItemSheet5e(app, html, data) {\n    window.GAS.log.d('_onRenderItemSheet5e called');\n    // Only proceed if this is a class item\n    const item = app.item;\n    window.GAS.log.d('item.type', item.type);\n    if (!item || item.type !== 'class') return;\n\n    // Add click listener to advancement tab\n    html.find('a.item[data-tab=\"advancement\"]').on('click', () => {\n      // Small delay to ensure tab is active when we re-render\n      setTimeout(() => app.render(false), 0);\n    });\n\n    // Only proceed with subclass rendering if advancement tab is active\n    if (!html.find('.tab.advancement.active').length) return;\n\n    window.GAS.log.d('html', html);\n\n    const subclassLevel = this.getSubclassLevel(item);\n    window.GAS.log.d('subclassLevel', subclassLevel);\n    if (!subclassLevel) return;\n\n    // Find the level group where we should insert the subclass\n    const levelHeader = html.find(`[data-level=\"${subclassLevel}\"]`);\n    window.GAS.log.d('levelHeader', levelHeader);\n    if (!levelHeader.length) return;\n\n    // Find the items-list that's a sibling of the level header\n    const itemsList = html.find(`[data-level=\"${subclassLevel}\"] + .item-list`);\n    // const itemsList = levelHeader.siblings('.item-list');\n    window.GAS.log.d('itemsList', itemsList);\n    if (!itemsList.length) return;\n\n    // Create the subclass advancement entry\n    const subclassEntry = `\n      <li class=\"advancement-item item flexrow\" data-advancement-type=\"subclass\">\n        <div class=\"item-name flexrow\">\n          <div class=\"item-image\" style=\"background-image: url('systems/dnd5e/icons/svg/items/subclass.svg')\"></div>\n          <h4>Subclass</h4>\n        </div>\n        <div class=\"item-controls flexrow\">\n          <a class=\"item-control item-edit\" title=\"Edit Subclass Level\"><i class=\"fas fa-edit\"></i></a>\n          <a class=\"item-control item-delete\" title=\"Delete Subclass Level\"><i class=\"fas fa-trash\"></i></a>\n        </div>\n      </li>\n    `;\n    itemsList.append(subclassEntry);\n\n    // Add edit handler\n    html.find('[data-advancement-type=\"subclass\"] .item-edit').on('click', async () => {\n      await this._showLevelDialog(item);\n    });\n\n    // Add delete handler\n    html.find('[data-advancement-type=\"subclass\"] .item-delete').on('click', async () => {\n      const confirmed = await Dialog.confirm({\n        title: \"Delete Subclass Level\",\n        content: `<p>Are you sure you want to remove the subclass level from ${item.name}?</p>`,\n        defaultYes: false\n      });\n      \n      if (confirmed) {\n        await item.unsetFlag(MODULE_ID, 'subclassLevel');\n        app.render();\n      }\n    });\n  }\n\n  /**\n   * Get the stored subclass level\n   * @param {Item} item - The class item\n   * @returns {number|null} The stored level or null\n   */\n  static getSubclassLevel(item) {\n    return item.getFlag(MODULE_ID, 'subclassLevel') || null;\n  }\n\n  /**\n   * Set the subclass level\n   * @param {Item} item - The class item\n   * @param {number} level - The level to set\n   */\n  static async setSubclassLevel(item, level) {\n    await item.setFlag(MODULE_ID, 'subclassLevel', level);\n  }\n} ","import { MODULE_ID } from '../../helpers/constants';\n\n/**\n * Plugin to add \"Spell Lists\" advancement for custom classes/subclasses\n * This allows GMs to specify which spell lists a custom class has access to\n * \n * Standard D&D classes (Wizard, Cleric, etc.) do NOT need this - they work via existing logic\n * This is ONLY for custom/homebrew classes that need spell list configuration\n */\nexport default class SpellListsPlugin {\n  static ID = 'spell-lists';\n  static currentItem = null; // Track the current item being edited\n\n  /**\n   * Initialize the plugin\n   * Unlike SubclassLevelPlugin, this works for ALL D&D versions (v3 and v4+)\n   */\n  static init() {\n    window.GAS.log.i('[SPELL LISTS PLUGIN] Initializing Spell Lists Plugin for custom classes');\n    window.GAS.log.i('[SPELL LISTS PLUGIN] D&D 5e version:', window.GAS.dnd5eVersion);\n    this.registerHooks();\n  }\n\n  /**\n   * Register necessary hooks\n   */\n  static registerHooks() {\n    window.GAS.log.i('[SPELL LISTS PLUGIN] Registering hooks');\n    // Hook into advancement selection rendering\n    // v3: Uses renderAdvancementSelection\n    // v4+: Uses renderDialog (generic dialog system)\n    Hooks.on('renderAdvancementSelection', this._onRenderAdvancementSelection.bind(this));\n    Hooks.on('renderDialog', this._onRenderDialog.bind(this));\n    Hooks.on('renderItemSheet5e', this._onRenderItemSheet5e.bind(this));\n    \n    // Track which item sheet is currently open\n    Hooks.on('renderItemSheet5e', (app) => {\n      if (app.item && (app.item.type === 'class' || app.item.type === 'subclass')) {\n        SpellListsPlugin.currentItem = app.item;\n        window.GAS.log.d('[SPELL LISTS PLUGIN] Tracking item:', app.item.name);\n      }\n    });\n    \n    window.GAS.log.i('[SPELL LISTS PLUGIN] Hooks registered successfully');\n  }\n\n  /**\n   * Handle rendering the advancement selection interface\n   * Adds \"Spell Lists\" option to the advancement type selection dialog\n   */\n  static async _onRenderAdvancementSelection(app, html, data) {\n    // Foundry v12 vs v13+ compatibility: In v12 html is already jQuery, in v13+ it's a raw element\n    html = html instanceof jQuery ? html : $(html);\n    \n    window.GAS.log.d('[SPELL LISTS PLUGIN] Hook fired - renderAdvancementSelection');\n    window.GAS.log.d('[SPELL LISTS PLUGIN] App:', app);\n    window.GAS.log.d('[SPELL LISTS PLUGIN] Item:', app.item);\n    \n    // Only proceed if this is a class or subclass item\n    const item = app.item;\n    if (!item || (item.type !== 'class' && item.type !== 'subclass')) {\n      window.GAS.log.d('[SPELL LISTS PLUGIN] Skipping - item type is', item?.type);\n      return;\n    }\n\n    window.GAS.log.d('[SPELL LISTS PLUGIN] Adding Spell Lists option to advancement selection');\n\n    // Add our spell lists option to the types list\n    const typeList = html.find('.items-list');\n    html.addClass('gas dnd5e spell-lists-plugin');\n    \n    const spellListsOption = `\n      <li class=\"item flexrow\">\n        <div class=\"item-name flexrow\">\n          <div class=\"item-image\" style=\"background-image: url('systems/dnd5e/icons/svg/items/spell.svg')\"></div>\n          <h3>Spell Lists</h3>\n        </div>\n        <div class=\"item-controls flexrow\">\n          <input name=\"type\" type=\"radio\" value=\"SpellLists\">\n        </div>\n        <div class=\"item-hint notes\">\n          Configure which spell lists this custom class/subclass has access to.\n        </div>\n      </li>\n    `;\n    \n    typeList.append(spellListsOption);\n\n    // Store the original click handler\n    const button = html.find('[data-button=\"submit\"]');\n    const originalClickHandler = $._data(button[0], 'events')?.click?.[0]?.handler;\n    \n    button.off('click').on('click', async function(event) {\n      const selectedType = html.find('input[name=\"type\"]:checked').val();\n      if (selectedType === 'SpellLists') {\n        await SpellListsPlugin._showSpellListsDialog(item);\n        app.close();\n      } else if (originalClickHandler) {\n        // Call the original handler for non-SpellLists selections\n        originalClickHandler.call(this, event);\n      }\n    });\n  }\n\n  /**\n   * Handle rendering generic Dialog (for D&D 5e v4+)\n   * In v4+, advancement type selection uses a generic Dialog instead of AdvancementSelection\n   */\n  static async _onRenderDialog(app, html, data) {\n    // Foundry v12 vs v13+ compatibility: In v12 html is already jQuery, in v13+ it's a raw element\n    html = html instanceof jQuery ? html : $(html);\n    \n    window.GAS.log.i('[SPELL LISTS PLUGIN] Hook fired - renderDialog');\n    window.GAS.log.i('[SPELL LISTS PLUGIN] Dialog title:', app.title);\n    window.GAS.log.i('[SPELL LISTS PLUGIN] Dialog data:', data);\n    \n    // Check if this is the advancement type selection dialog\n    // Look for \"Name\" as title and radio buttons for advancement types\n    const hasRadioButtons = html.find('input[name=\"type\"][type=\"radio\"]').length > 0;\n    \n    window.GAS.log.i('[SPELL LISTS PLUGIN] Has radio buttons:', hasRadioButtons);\n    window.GAS.log.i('[SPELL LISTS PLUGIN] Radio button count:', html.find('input[name=\"type\"]').length);\n    \n    if (!hasRadioButtons) {\n      window.GAS.log.d('[SPELL LISTS PLUGIN] Not an advancement type selection dialog, skipping');\n      return;\n    }\n    \n    window.GAS.log.i('[SPELL LISTS PLUGIN] Detected advancement type selection dialog!');\n    \n    // Get the item from our tracked reference\n    const item = SpellListsPlugin.currentItem;\n    if (!item) {\n      window.GAS.log.w('[SPELL LISTS PLUGIN] No item is currently tracked');\n      return;\n    }\n    \n    if (item.type !== 'class' && item.type !== 'subclass') {\n      window.GAS.log.d('[SPELL LISTS PLUGIN] Item is not a class or subclass:', item.type);\n      return;\n    }\n\n    window.GAS.log.i('[SPELL LISTS PLUGIN] Adding Spell Lists option to dialog for item:', item.name);\n\n    // Find the list of advancement types (it's an <ol> or <ul> with radio buttons)\n    const list = html.find('ol, ul').first();\n    window.GAS.log.i('[SPELL LISTS PLUGIN] Found list element:', list.length);\n    \n    if (!list.length) {\n      window.GAS.log.w('[SPELL LISTS PLUGIN] Could not find list element in dialog');\n      return;\n    }\n    \n    // Add our spell lists option as a list item matching the D&D 5e style\n    // Match the exact structure of other items: use dnd5e-icon custom element\n    const spellListsOption = `\n      <li data-tooltip=\"Configure which spell lists this custom class/subclass has access to.\">\n        <label>\n          <dnd5e-icon src=\"systems/dnd5e/icons/svg/items/spell.svg\"></dnd5e-icon>\n          <span>Spell Lists</span>\n          <input type=\"radio\" name=\"type\" value=\"SpellLists\" required=\"\">\n        </label>\n      </li>\n    `;\n    \n    list.append(spellListsOption);\n    \n    window.GAS.log.i('[SPELL LISTS PLUGIN] Spell Lists option added successfully');\n\n    // Intercept the dialog submit to handle our custom type\n    const originalSubmit = app.data.buttons.ok.callback;\n    app.data.buttons.ok.callback = async function(htmlArg) {\n      // Store the original html argument (might be jQuery or raw DOM)\n      const originalHtml = htmlArg;\n      \n      // Wrap in jQuery for our use\n      const html = htmlArg instanceof jQuery ? htmlArg : $(htmlArg);\n      \n      const selectedType = html.find('input[name=\"type\"]:checked').val();\n      window.GAS.log.i('[SPELL LISTS PLUGIN] Selected type:', selectedType);\n      \n      if (selectedType === 'SpellLists') {\n        window.GAS.log.i('[SPELL LISTS PLUGIN] Opening spell lists dialog for item:', item.name);\n        await SpellListsPlugin._showSpellListsDialog(item);\n        return null; // Prevent default behavior\n      } else if (originalSubmit) {\n        // Pass the original html argument to the D&D 5e callback (don't pass jQuery-wrapped version)\n        return originalSubmit.call(this, originalHtml);\n      }\n    };\n  }\n\n  /**\n   * Show dialog for configuring spell lists\n   * @param {Item} item - The class or subclass item\n   */\n  static async _showSpellListsDialog(item) {\n    // Core D&D 5e spell list classes\n    const spellListClasses = [\n      'Artificer',\n      'Bard',\n      'Cleric',\n      'Druid',\n      'Paladin',\n      'Ranger',\n      'Sorcerer',\n      'Warlock',\n      'Wizard'\n    ];\n\n    const currentLists = this.getSpellListsData(item);\n    const currentLevel = currentLists?.level || 1;\n    const selectedLists = currentLists?.lists || [];\n    \n    window.GAS.log.d('[SPELL LISTS PLUGIN] Current spell lists for', item.name, ':', selectedLists, 'at level', currentLevel);\n\n    const content = `\n      <form class=\"gas-spell-lists-form\">\n        <div class=\"form-group\">\n          <label>Level</label>\n          <select name=\"level\">\n            ${Array.from({ length: 20 }, (_, i) => i + 1).map(level =>\n              `<option value=\"${level}\" ${currentLevel === level ? 'selected' : ''}>${level}</option>`\n            ).join('')}\n          </select>\n        </div>\n        <div class=\"form-group\">\n          <label><strong>Select Spell Lists</strong></label>\n          <p class=\"notes\" style=\"font-size: 0.9em; margin-bottom: 1em;\">\n            Check all spell lists this ${item.type} should have access to. \n            This is only needed for custom/homebrew classes.\n          </p>\n          <div class=\"spell-list-checkboxes\" style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 0.5em;\">\n            ${spellListClasses.map(className => `\n              <div style=\"display: flex; align-items: center;\">\n                <input type=\"checkbox\" \n                       name=\"spell-list\" \n                       value=\"${className}\" \n                       id=\"spell-list-${className}\"\n                       ${selectedLists.includes(className) ? 'checked' : ''}\n                       style=\"margin-right: 0.5em;\">\n                <label for=\"spell-list-${className}\" style=\"margin: 0;\">${className}</label>\n              </div>\n            `).join('')}\n          </div>\n        </div>\n      </form>\n    `;\n\n    return new Dialog({\n      title: `Configure Spell Lists for ${item.name}`,\n      content,\n      buttons: {\n        submit: {\n          icon: '<i class=\"fas fa-check\"></i>',\n          label: \"Save\",\n          callback: async (html) => {\n            const level = Number(html.find('[name=\"level\"]').val());\n            const selectedLists = [];\n            html.find('input[name=\"spell-list\"]:checked').each((i, el) => {\n              selectedLists.push($(el).val());\n            });\n            \n            window.GAS.log.d('[SPELL LISTS PLUGIN] Saving spell lists for', item.name, ':', selectedLists, 'at level', level);\n            await this.setSpellListsData(item, { level, lists: selectedLists });\n            \n            ui.notifications.info(`Spell lists configured for ${item.name} at level ${level}: ${selectedLists.join(', ') || 'None'}`);\n            \n            // Re-render the item sheet to show the indicator\n            const sheet = item.sheet;\n            if (sheet && sheet.rendered) {\n              window.GAS.log.d('[SPELL LISTS PLUGIN] Re-rendering item sheet');\n              sheet.render(false);\n            }\n          }\n        },\n        cancel: {\n          icon: '<i class=\"fas fa-times\"></i>',\n          label: \"Cancel\"\n        }\n      },\n      default: \"submit\",\n      close: () => {\n        window.GAS.log.d('[SPELL LISTS PLUGIN] Dialog closed');\n      }\n    }).render(true);\n  }\n\n  /**\n   * Handle rendering the item sheet\n   * Shows the configured spell lists in the advancement tab at the configured level\n   */\n  static _onRenderItemSheet5e(app, html, data) {\n    window.GAS.log.i('[SPELL LISTS PLUGIN] _onRenderItemSheet5e called');\n    \n    // Foundry v12 vs v13+ compatibility: In v12 html is already jQuery, in v13+ it's a raw element\n    html = html instanceof jQuery ? html : $(html);\n    \n    window.GAS.log.i('[SPELL LISTS PLUGIN] Item:', app.item?.name, 'Type:', app.item?.type);\n    \n    // Only proceed if this is a class or subclass item\n    const item = app.item;\n    if (!item || (item.type !== 'class' && item.type !== 'subclass')) {\n      window.GAS.log.d('[SPELL LISTS PLUGIN] Skipping - not a class or subclass');\n      return;\n    }\n\n    // Add click listener to advancement tab\n    html.find('a.item[data-tab=\"advancement\"]').on('click', () => {\n      window.GAS.log.d('[SPELL LISTS PLUGIN] Advancement tab clicked, re-rendering');\n      // Small delay to ensure tab is active when we re-render\n      setTimeout(() => app.render(false), 0);\n    });\n\n    // Only proceed with rendering if advancement tab is active\n    const advancementTabActive = html.find('.tab.advancement.active').length > 0;\n    window.GAS.log.i('[SPELL LISTS PLUGIN] Advancement tab active:', advancementTabActive);\n    \n    if (!advancementTabActive) return;\n\n    const spellListsData = this.getSpellListsData(item);\n    window.GAS.log.i('[SPELL LISTS PLUGIN] Spell lists data:', spellListsData);\n    \n    if (!spellListsData || !spellListsData.lists || spellListsData.lists.length === 0) {\n      window.GAS.log.d('[SPELL LISTS PLUGIN] No spell lists configured');\n      return;\n    }\n\n    window.GAS.log.i('[SPELL LISTS PLUGIN] Rendering spell lists indicator for', item.name, 'at level', spellListsData.level);\n\n    // Find the level section (v5 uses div.items-section with data-level)\n    let levelSection = html.find(`div.items-section[data-level=\"${spellListsData.level}\"]`);\n    \n    if (!levelSection.length) {\n      window.GAS.log.w('[SPELL LISTS PLUGIN] Level section for level', spellListsData.level, 'does not exist, creating it');\n      \n      // Find the advancement tab content area\n      const advancementTab = html.find('.tab.advancement');\n      if (!advancementTab.length) {\n        window.GAS.log.e('[SPELL LISTS PLUGIN] Could not find advancement tab');\n        return;\n      }\n      \n      window.GAS.log.d('[SPELL LISTS PLUGIN] Found advancement tab, looking for container');\n      \n      // Try different selectors for the container\n      let advancementContainer = advancementTab.find('.advancement-list');\n      if (!advancementContainer.length) {\n        advancementContainer = advancementTab.find('.items-header').parent();\n      }\n      if (!advancementContainer.length) {\n        advancementContainer = advancementTab;\n      }\n      \n      window.GAS.log.d('[SPELL LISTS PLUGIN] Using container:', advancementContainer);\n      \n      // Create the level section\n      const levelSectionHtml = `\n        <div class=\"items-section card\" data-level=\"${spellListsData.level}\">\n          <div class=\"items-header header\">\n            <h3 class=\"item-name\">Level ${spellListsData.level}</h3>\n            <div class=\"item-header advancement-value\">Value</div>\n            <div class=\"item-header item-controls\"></div>\n          </div>\n          <ol class=\"item-list unlist\"></ol>\n        </div>\n      `;\n      \n      // Find the right place to insert it (sorted by level)\n      const allLevelSections = html.find('.advancement .items-section[data-level]');\n      let inserted = false;\n      \n      allLevelSections.each((i, section) => {\n        const sectionLevel = parseInt($(section).attr('data-level'));\n        if (sectionLevel > spellListsData.level) {\n          $(section).before(levelSectionHtml);\n          inserted = true;\n          return false; // break\n        }\n      });\n      \n      if (!inserted) {\n        // Append at the end if it's the highest level\n        advancementContainer.append(levelSectionHtml);\n      }\n      \n      // Re-query the level section we just created\n      levelSection = html.find(`div.items-section[data-level=\"${spellListsData.level}\"]`);\n      window.GAS.log.i('[SPELL LISTS PLUGIN] Created level section for level', spellListsData.level);\n    }\n\n    // Find the ol.item-list inside the level section\n    const itemsList = levelSection.find('ol.item-list');\n    if (!itemsList.length) {\n      window.GAS.log.w('[SPELL LISTS PLUGIN] Could not find item list in level section');\n      return;\n    }\n\n    window.GAS.log.d('[SPELL LISTS PLUGIN] Found item list, appending spell lists entry');\n\n    // Create the spell lists advancement entry matching v5 structure\n    const spellListsEntry = `\n      <li class=\"advancement-item item\" data-advancement-type=\"spell-lists\">\n        <div class=\"item-row\">\n          <div class=\"item-name\">\n            <img class=\"item-image gold-icon\" src=\"systems/dnd5e/icons/svg/items/spell.svg\">\n            <div class=\"name\">\n              <div class=\"title\">Spell Lists</div>\n            </div>\n            <div class=\"tags\">\n              <span class=\"tag\">${spellListsData.lists.join(', ')}</span>\n            </div>\n          </div>\n          \n          <div class=\"item-detail advancement-value empty\">\n          </div>\n          \n          <div class=\"item-detail item-controls\">\n            <button type=\"button\" class=\"unbutton control-button item-control item-action spell-lists-edit\" data-tooltip=\"\" aria-label=\"Edit Spell Lists\">\n              <i class=\"fas fa-pen-to-square\" inert=\"\"></i>\n            </button>\n            \n            <button type=\"button\" class=\"unbutton control-button item-control item-action spell-lists-delete\" data-tooltip=\"\" aria-label=\"Delete Spell Lists\">\n              <i class=\"fas fa-trash\" inert=\"\"></i>\n            </button>\n          </div>\n        </div>\n      </li>\n    `;\n    \n    itemsList.append(spellListsEntry);\n\n    // Add edit handler\n    html.find('[data-advancement-type=\"spell-lists\"] .spell-lists-edit').on('click', async (event) => {\n      event.preventDefault();\n      await this._showSpellListsDialog(item);\n    });\n\n    // Add delete handler\n    html.find('[data-advancement-type=\"spell-lists\"] .spell-lists-delete').on('click', async (event) => {\n      event.preventDefault();\n      const confirmed = await Dialog.confirm({\n        title: \"Delete Spell Lists\",\n        content: `<p>Are you sure you want to remove the spell lists configuration from ${item.name}?</p>`,\n        defaultYes: false\n      });\n      \n      if (confirmed) {\n        await item.unsetFlag(MODULE_ID, 'spellLists');\n        ui.notifications.info(`Spell lists removed from ${item.name}`);\n        app.render(false);\n      }\n    });\n  }\n\n  /**\n   * Get the configured spell lists data for an item\n   * @param {Item} item - The class or subclass item\n   * @returns {{level: number, lists: string[]}|null} - Spell lists data or null\n   */\n  static getSpellListsData(item) {\n    return item.getFlag(MODULE_ID, 'spellLists');\n  }\n\n  /**\n   * Set the spell lists data for an item\n   * @param {Item} item - The class or subclass item\n   * @param {{level: number, lists: string[]}} data - Spell lists data\n   */\n  static async setSpellListsData(item, data) {\n    if (!data || !data.lists || data.lists.length === 0) {\n      // Remove the flag if no lists are selected\n      await item.unsetFlag(MODULE_ID, 'spellLists');\n    } else {\n      await item.setFlag(MODULE_ID, 'spellLists', data);\n    }\n  }\n  \n  /**\n   * Get the configured spell lists for an item (backward compatibility)\n   * @param {Item} item - The class or subclass item\n   * @returns {string[]|null} - Array of spell list class names, or null if not configured\n   */\n  static getSpellLists(item) {\n    const data = this.getSpellListsData(item);\n    return data?.lists || null;\n  }\n}\n","<svelte:options accessors={true} />\n\n<script>\n  import { onMount, getContext } from \"svelte\";\n  import { fade, scale } from \"svelte/transition\";\n  import { ApplicationShell } from \"@typhonjs-fvtt/runtime/svelte/component/application\";\n  import { localize as t } from \"~/src/helpers/Utility\";\n  import { MODULE_ID } from \"~/src/helpers/constants\";\n\n  export let elementRoot = void 0;\n  export let version = void 0;\n\n  const application = getContext(\"#external\").application;\n\n  const handleChange = (event) => {\n    game.settings.set(MODULE_ID, \"dontShowWelcome\", event.target.checked);\n  };\n\n  let draggable = application.reactive.draggable;\n  draggable = true;\n\n  $: application.reactive.draggable = draggable;\n  $: dontShowWelcome = game.settings.get(MODULE_ID, \"dontShowWelcome\");\n\n  onMount(async () => {\n    // Module initialization complete\n  });\n</script>\n\n<template lang=\"pug\">\n  ApplicationShell(bind:elementRoot)\n    main\n      .inset.bg-dark\n        .flexrow.justify-flexrow-vertical\n          .flex2\n            img(src=\"modules/foundryvtt-actor-studio/assets/actor-studio-blue.png\" alt=\"Actor Studio\" style=\"height: 100%; max-height: 50px; border: none; width: auto;\")\n          .flex3\n            p.thanks.right.mr-md {t('Welcome.Thanks')}\n        hr\n        p {t(\"Welcome.Introduction\")}\n        a(href=\"https://github.com/geoidesic/foundryvtt-actor-studio?tab=readme-ov-file#usage-instructions\") {t(\"Welcome.UsageTitle\")}\n        p.lighter\n          i.fa-solid.fa-bug.mr-sm\n          | {t('Welcome.Issues')} <a href=\"https://github.com/geoidesic/foundryvtt-actor-studio/issues\"> {t('Welcome.IssuesLinkText')} </a>\n        p \n          i.fa-solid.fa-heart.mr-sm(style=\"color: #660000;\")\n          | {t('Welcome.Support')} <a href='https://github.com/sponsors/geoidesic'> {t('Welcome.SponsorLinkText')} </a> or <a href='https://https://paypal.me/geoidesic'>PayPal</a>\n        \n        p\n          i.fa-solid.fa-star.mr-sm(style=\"color: #996600;\")\n          | {t('Welcome.JoinDiscord')} <a href='https://discord.gg/sQgVnSGRUj'> {t('Welcome.DiscordLinkText')} </a>\n        hr\n        p.usage-tracking-info\n          i.fa-solid.fa-shield-halved.mr-sm(style=\"color: #416dbe;\")\n          | Actor Studio collects only the date, country, and module version when the module is loaded. No personal or identifying information is collected. This helps us improve the module and prioritize language support. (Can be disabled in the module settings.)\n        .flexrow.justify-flexrow-vertical(data-tooltip=\"{t('Setting.DontShowWelcome.Hint')}\")\n          .flex0 \n            input(type=\"checkbox\" on:change=\"{handleChange}\" label=\"{t('Setting.DontShowWelcome.Name')}\" bind:checked=\"{dontShowWelcome}\") \n          .flex.dont-show\n            span {t('Setting.DontShowWelcome.Name') }\n    footer\n      div.logo\n        a(href=\"https://www.aardvark.games\") \n          img.white(src=\"/modules/foundryvtt-actor-studio/assets/aardvark-logo.webp\" alt=\"Aardvark Game Studios Logo\" height=\"50\" width=\"50\" style=\"fill: white; border: none; width: auto;\")\n      div.left\n        div {t(\"Title\")} {t(\"Welcome.CreatedBy\")} \n        //- a(href=\"https://www.round-table.games\") Round Table Games\n        a(href=\"https://www.aardvark.games\") Aardvark Game Studios\n    \n\n</template>\n\n<style lang=\"sass\">\n  @import \"../styles/Mixins.sass\"\n  .theme-dark\n    .bg-dark\n      background-color: rgba(0, 0, 0, 0.1)\n      padding: 1rem 1rem 0.5rem 1rem\n\n  main\n    overflow-y: auto\n    i\n      margin-right: 0.5em\n    .inset\n      @include inset\n    .bg-dark\n      background-color: rgba(0, 0, 0, 0.1)\n      padding: 1rem 1rem 0.5rem 1rem\n    h1\n      margin-top: 0\n    h4\n      font-family: var(--dnd5e-font-modesto);\n  .dont-show\n    font-size: smaller\n\n  p.thanks\n    font-size: 1.2em\n    font-weight: bold\n    color: #416dbe\n\n  footer\n    border-top: 8px ridge var(--border-shadow)\n    display: grid\n    grid-template-columns: 2fr 4fr\n    position: fixed\n    bottom: 0\n    align-items: center\n    gap: 1em\n    line-height: 2em\n    left: 0\n    right: 0\n    background-color: #333\n    color: white\n    padding: 1em\n    font-size: 0.8em\n    z-index: 3\n    div.logo\n      a\n        display: flex\n        align-items: center\n        justify-content: end\n        gap: 0.5em\n    a\n      color: white\n      text-decoration: underline\n      &:hover\n        color: #ccc\n\n\n</style>\n","\n\nimport WelcomeAppShell from './WelcomeAppShell.svelte';\nimport { SvelteApplication } from \"@typhonjs-fvtt/runtime/svelte/application\";\nimport { TJSDocument } from \"@typhonjs-fvtt/runtime/svelte/store/fvtt/document\";\nimport { MODULE_ID, MODULE_CODE } from \"~/src/helpers/constants\"\nimport { version } from \"../../module.json\";\n\nexport default class WelcomeApplication extends SvelteApplication\n{\n   /**\n    * Default Application options\n    *\n    * @returns {object} options - Application options.\n    * @see https://foundryvtt.com/api/interfaces/client.ApplicationOptions.html\n    */\n   static get defaultOptions()\n   {\n      return foundry.utils.mergeObject(super.defaultOptions, {\n        id: 'foundryvtt-actor-studio-welcome',\n        classes: [MODULE_CODE],\n         resizable: true,\n         minimizable: true,\n         width: 500,\n         height: 555,\n         headerIcon: 'modules/foundryvtt-actor-studio/assets/actor-studio-logo-dragon-blue.png',\n         title: game.i18n.localize('GAS.ActorStudio')+' v'+version,\n         svelte: {\n            class: WelcomeAppShell,\n            target: document.body,\n            intro: true,\n            props: {\n               version  // A prop passed to HelloFoundryAppShell for the initial message displayed.\n            }\n         }\n      });\n   }\n}","import { MODULE_ID } from '~/src/helpers/constants';\nimport { initLevelup } from '~/src/plugins/level-up';\nimport { registerSettings } from '~/src/settings';\nimport { initEquipmentPurchase } from '~/src/plugins/equipment-purchase'; \nimport { log, getDnd5eVersion, getDndRulesVersion } from '~/src/helpers/Utility'\nimport SubclassLevelPlugin from '~/src//plugins/subclass-level';\nimport SpellListsPlugin from '~/src/plugins/spell-lists';\nimport WelcomeApplication from '~/src/app/WelcomeApplication.js';\nimport { getWorkflowFSM } from '~/src/helpers/WorkflowStateMachine.js';\nimport packageJson from '../../package.json';\nimport manifestJson from '../../module.json';\n\n\nwindow.GAS = window.GAS || {};\n\nexport const init = (app, html, data) => {\n\n  window.GAS.log = log;\n  window.GAS.log.level = log.VERBOSE;\n  \n  \n  window.GAS.dnd5eVersion = getDnd5eVersion();\n  window.GAS.dnd5eRules = getDndRulesVersion();\n\n  if(game.version > 13) {\n    // V12 -> 13 SHIM\n    window.MIN_WINDOW_WIDTH = 200;\n    window.MIN_WINDOW_HEIGHT = 50;\n  }\n\n  //- these settings are for debugging / testing purposes only\n  if(packageJson.debug) {\n    window.GAS.debug = true;\n    window.GAS.race = \"Compendium.dnd-players-handbook.origins.Item.phbspOrc00000000\"\n    window.GAS.background = \"Compendium.dnd-players-handbook.origins.Item.phbbgArtisan0000\"\n    // window.GAS.characterClass = \"Compendium.dnd-players-handbook.classes.Item.phbbrbBarbarian0\"\n    // window.GAS.characterClass = \"Compendium.dnd-players-handbook.classes.Item.phbbrdBard000000\"\n    // window.GAS.characterClass = \"Compendium.dnd-players-handbook.classes.Item.phbftrFighter000\"\n    // window.GAS.characterClass = \"Compendium.dnd-players-handbook.classes.Item.phbwzdWizard0000\"\n    window.GAS.characterClass = \"Compendium.dnd-players-handbook.classes.Item.phbrgrRanger0000\"\n    // window.GAS.background = \"Compendium.dnd-players-handbook.origins.Item.phbbgFarmer00000\"\n    // window.GAS.characterClass = \"Compendium.dnd-players-handbook.classes.Item.phbwlkWarlock000\"\n    // window.GAS.characterClass = \"Compendium.dnd-players-handbook.classes.Item.phbclcCleric0000\"\n\n\n    // window.GAS.characterSubClass = \"Compendium.dnd-players-handbook.classes.Item.phbwlkCelestialP\"\n  }\n  \n  window.GAS.log.i(`Starting System ${MODULE_ID}`);\n  window.GAS.log.i('Initialising for foundry version:', game.version);\n  window.GAS.log.i('Initialising module manifest version:', manifestJson.version);\n  window.GAS.log.i('Initialising module package version:', packageJson.version);\n  window.GAS.log.i('Initialising game module version:', game.modules.get(MODULE_ID).version);\n\n  initLevelup();\n  registerSettings(app);\n  initEquipmentPurchase(); // Initialize the new feature\n  \n  // Initialize workflow FSM to ensure it's available on window.GAS for debugging\n  try {\n    window.GAS.workflowFSM = getWorkflowFSM();\n    window.GAS.log.d('Workflow FSM initialized and available on window.GAS');\n  } catch (error) {\n    window.GAS.log.w('Failed to initialize workflow FSM:', error);\n  }\n \n \n  if(game.settings.get(MODULE_ID, 'debug')) {\n    log.level = log.VERBOSE;\n  } else {\n    log.level = log.INFO;\n  }\n\n  if(game.settings.get(MODULE_ID, 'debug.hooks')) {\n    CONFIG.debug.hooks = true;\n  }\n\n  window.GAS.log.d('Debug mode is', game.settings.get(MODULE_ID, 'debug') ? 'enabled' : 'disabled');\n  window.GAS.log.d('Debug extended mode is', game.settings.get(MODULE_ID, 'debug.hooks') ? 'enabled' : 'disabled');\n  window.GAS.log.d('Log level: ',log.level)\n\n  Hooks.call(\"gas.initIsComplete\");\n\n}\n\nexport const ready = (app, html, data) => {\n  // Check if the setting exists before trying to access it\n  if (game.settings.settings.has(`${MODULE_ID}.dontShowWelcome`)) {\n    if (!game.settings.get(MODULE_ID, 'dontShowWelcome')) {\n      new WelcomeApplication().render(true, { focus: true });\n    }\n  } else {\n    // Setting not registered yet, show welcome by default\n    new WelcomeApplication().render(true, { focus: true });\n  }\n\n  if (game.settings.settings.has(`${MODULE_ID}.forceDnd5eLevelUpAutomation`)) {\n    if (game.settings.get(MODULE_ID, 'forceDnd5eLevelUpAutomation')) {\n      game.settings.set(\"dnd5e\", \"disableAdvancements\", false);\n    }\n  }\n\n  Hooks.call(\"gas.readyIsComplete\");\n\n  // Initialize plugins\n  SubclassLevelPlugin.init();\n  SpellListsPlugin.init();\n}\n\nexport default {\n  init,\n  ready\n}","<script>\n  import { onMount } from \"svelte\";\n  import { getFilteredFeats, enrichHTML } from \"~/src/helpers/Utility.js\";\n  import { localize as t } from \"~/src/helpers/Utility\";\n\n  export let actor = null;\n  export let characterLevel = 1;\n  export let onSelect = () => {};\n  export let onClose = () => {};\n\n  let feats = [];\n  let filteredFeats = [];\n  let searchTerm = \"\";\n  let loading = true;\n  let selectedFeat = null;\n  let showIneligible = false;\n  let enrichedFeatLinks = {};\n\n  const isFeatSelected = (feat) => selectedFeat?._id === feat?._id;\n\n  // Check if the character meets the level requirement\n  const meetsLevelRequirement = (feat) => {\n    const requiredLevel = feat?.system?.prerequisites?.level;\n    if (requiredLevel == null) return true;\n    return characterLevel >= requiredLevel;\n  };\n\n  // Check if the character has the required features\n  const meetsFeatureRequirements = (feat) => {\n    const requiredFeatures = feat?.system?.prerequisites?.features;\n    if (!requiredFeatures || requiredFeatures.length === 0) return true;\n    if (!actor) return true; // If no actor provided, can't check, so allow\n    \n    const actorItems = actor.items || [];\n    \n    // Check if all required features are present\n    return requiredFeatures.every(requiredFeature => {\n      // requiredFeature might be a string (feature name) or object with uuid/name\n      const featureName = typeof requiredFeature === 'string' \n        ? requiredFeature \n        : (requiredFeature.name || requiredFeature.identifier);\n      \n      if (!featureName) return false;\n      \n      // Check if the actor has this feature (case-insensitive)\n      return actorItems.some(item => \n        item.name?.toLowerCase() === featureName.toLowerCase()\n      );\n    });\n  };\n\n  // Check if the character has the required ability scores\n  const meetsAbilityRequirements = (feat) => {\n    const requiredAbilities = feat?.system?.prerequisites?.abilities;\n    if (!requiredAbilities || requiredAbilities.length === 0) return true;\n    if (!actor) return true; // If no actor provided, can't check, so allow\n    \n    const actorAbilities = actor.system?.abilities || {};\n    \n    // Check if all required ability scores are met\n    return requiredAbilities.every(abilityReq => {\n      const abilityKey = abilityReq.ability || abilityReq.key;\n      const requiredValue = abilityReq.value || abilityReq.minimum || 13; // Default to 13 if not specified\n      \n      if (!abilityKey) return false;\n      \n      const actorAbility = actorAbilities[abilityKey];\n      const actorValue = actorAbility?.value ?? 0;\n      \n      return actorValue >= requiredValue;\n    });\n  };\n\n  // Check if the character meets all prerequisites\n  const meetsAllPrerequisites = (feat) => {\n    return meetsLevelRequirement(feat) \n      && meetsFeatureRequirements(feat)\n      && meetsAbilityRequirements(feat);\n  };\n\n  // Get a human-readable reason why the feat is ineligible\n  const getIneligibilityReason = (feat) => {\n    const reasons = [];\n    \n    if (!meetsLevelRequirement(feat)) {\n      const required = feat?.system?.prerequisites?.level;\n      reasons.push(`Requires level ${required} (you are level ${characterLevel})`);\n    }\n    \n    if (!meetsFeatureRequirements(feat)) {\n      const required = feat?.system?.prerequisites?.features || [];\n      const missing = required.filter(requiredFeature => {\n        const featureName = typeof requiredFeature === 'string' \n          ? requiredFeature \n          : (requiredFeature.name || requiredFeature.identifier);\n        \n        return !actor?.items?.some(item => \n          item.name?.toLowerCase() === featureName?.toLowerCase()\n        );\n      });\n      \n      if (missing.length > 0) {\n        const names = missing.map(f => typeof f === 'string' ? f : (f.name || f.identifier)).join(', ');\n        reasons.push(`Requires feature(s): ${names}`);\n      }\n    }\n    \n    if (!meetsAbilityRequirements(feat)) {\n      const required = feat?.system?.prerequisites?.abilities || [];\n      const unmet = required.filter(abilityReq => {\n        const abilityKey = abilityReq.ability || abilityReq.key;\n        const requiredValue = abilityReq.value || abilityReq.minimum || 13;\n        const actorValue = actor?.system?.abilities?.[abilityKey]?.value ?? 0;\n        return actorValue < requiredValue;\n      });\n      \n      if (unmet.length > 0) {\n        const details = unmet.map(a => {\n          const key = (a.ability || a.key).toUpperCase();\n          const val = a.value || a.minimum || 13;\n          return `${key} ${val}`;\n        }).join(', ');\n        reasons.push(`Requires: ${details}`);\n      }\n    }\n    \n    return reasons.join('; ');\n  };\n\n  onMount(async () => {\n    try {\n      feats = await getFilteredFeats();\n      filteredFeats = feats;\n      \n      // Pre-enrich all feat links for tooltips\n      for (const feat of feats) {\n        if (feat.uuid) {\n          const link = `@UUID[${feat.uuid}]{${feat.name}}`;\n          enrichedFeatLinks[feat._id] = await enrichHTML(link, { async: true });\n        }\n      }\n    } catch (error) {\n      window.GAS.log.e('[FeatSelector] Error loading feats:', error);\n    } finally {\n      loading = false;\n    }\n  });\n\n  $: {\n    let filtered = feats;\n    \n    // Apply search filter\n    if (searchTerm) {\n      filtered = filtered.filter(feat =>\n        feat.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        feat.system?.description?.value?.toLowerCase().includes(searchTerm.toLowerCase())\n      );\n    }\n    \n    // Apply prerequisite filter unless showIneligible is true\n    if (!showIneligible && actor) {\n      filtered = filtered.filter(feat => meetsAllPrerequisites(feat));\n    }\n    \n    filteredFeats = filtered;\n  }\n\n  function handleFeatSelect(feat) {\n    selectedFeat = feat;\n  }\n\n  function handleConfirm() {\n    if (selectedFeat) {\n      onSelect(selectedFeat);\n      onClose();\n    }\n  }\n\n  function handleCancel() {\n    onClose();\n  }\n</script>\n\n<template lang=\"pug\">\n.feat-selector-overlay\n  .feat-selector-modal\n    .feat-selector-header\n      h2 {t('FeatSelector.Title', 'Select a Feat')}\n      button.close-button(type=\"button\" on:click=\"{handleCancel}\")\n        i.fa-solid.fa-times\n\n    .feat-selector-content\n      +if(\"loading\")\n        .loading-state\n          i.fa-solid.fa-spinner.fa-spin\n          p {t('FeatSelector.Loading', 'Loading feats...')}\n\n        +else\n          +if(\"feats.length === 0\")\n            .empty-state\n              i.fa-solid.fa-exclamation-triangle\n              p {t('FeatSelector.NoFeats', 'No feats available. Check your compendium sources in settings.')}\n\n            +else\n              .search-section\n                input.search-input(\n                  type=\"text\"\n                  placeholder=\"{t('FeatSelector.Search', 'Search feats...')}\"\n                  bind:value=\"{searchTerm}\"\n                )\n                +if(\"actor\")\n                  label.show-ineligible-toggle\n                    input(type=\"checkbox\" bind:checked=\"{showIneligible}\")\n                    span {t('FeatSelector.ShowIneligible', 'Show ineligible feats')}\n\n              .feats-list\n                +each(\"filteredFeats as feat\")\n                  .feat-item(\n                    class:selected!=\"{isFeatSelected(feat)}\"\n                    class:ineligible!=\"{!meetsAllPrerequisites(feat)}\"\n                    on:click!=\"{() => handleFeatSelect(feat)}\"\n                  )\n                    .feat-icon\n                      img(src!=\"{feat.img || '/icons/svg/mystery-man.svg'}\" alt!=\"{feat.name}\")\n                    +if(\"enrichedFeatLinks[feat._id]\")\n                      .feat-link {@html enrichedFeatLinks[feat._id]}\n                      +else()\n                        .feat-link {feat.name}\n                    +if(\"!meetsAllPrerequisites(feat)\")\n                      .feat-ineligibility-reason\n                        i.fa-solid.fa-exclamation-triangle\n                        span {@html getIneligibilityReason(feat)}\n\n              .feat-selector-footer\n                +if(\"selectedFeat\")\n                  .selected-feat-info\n                    h4 Selected: {selectedFeat.name}\n                    button.confirm-button(type=\"button\" on:click=\"{handleConfirm}\") {t('FeatSelector.Select', 'Select Feat')}\n                button.cancel-button(type=\"button\" on:click=\"{handleCancel}\") {t('FeatSelector.Cancel', 'Cancel')}\n</template>\n\n<style lang=\"sass\">\n@import \"../../../../../styles/Mixins.sass\"\n\n.feat-selector-overlay\n  position: fixed\n  top: 0\n  left: 0\n  width: 100%\n  height: 100%\n  background: rgba(0, 0, 0, 0.8)\n  display: flex\n  align-items: center\n  justify-content: center\n  z-index: 10000\n\n.feat-selector-modal\n  background: var(--tabs-content-background)\n  border: 1px solid #000\n  border-radius: 12px\n  box-shadow: 0 0 20px rgba(0, 0, 0, 0.8)\n  width: 90%\n  max-width: 600px\n  max-height: 80vh\n  display: flex\n  flex-direction: column\n  box-shadow: 0 0px 20px 2px var(--color-shadow-primary)\n\n.feat-selector-header\n  display: flex\n  justify-content: space-between\n  align-items: center\n  padding: 0.5rem 1rem\n  background: rgba(0, 0, 0, 0.2)\n  border-bottom: 1px solid rgba(0, 0, 0, 0.5)\n\n  h2\n    margin: 0\n    color: var(--color-highlight)\n    font-size: 2rem\n    font-weight: normal\n    font-family: \"Modesto Condensed\"\n\n  .close-button\n    background: transparent\n    border: none\n    color: var(--gas-color-text, #f0f0e0)\n    font-size: 1.2rem\n    cursor: pointer\n    padding: 0\n    width: 24px\n    height: 24px\n    display: flex\n    align-items: center\n    justify-content: center\n\n    &:hover\n      color: var(--dnd5e-color-gold, #c9c9c9)\n\n.feat-selector-content\n  flex: 1\n  overflow-y: auto\n  padding: 0.5rem\n\n.search-section\n  margin-bottom: 0.5rem\n  display: flex\n  flex-direction: column\n  gap: 0.35rem\n\n  .search-input\n    width: 100%\n    padding: 0.35rem 0.5rem\n    border: 1px solid #7a7971\n    border-radius: 3px\n    background: rgba(0, 0, 0, 0.25)\n    color: var(--gas-color-text, #f0f0e0)\n    font-size: 0.9rem\n    font-family: \"Signika\", sans-serif\n\n    &:focus\n      outline: none\n      border-color: var(--dnd5e-color-gold, #c9c9c9)\n      box-shadow: 0 0 5px rgba(255, 255, 255, 0.1)\n\n    &::placeholder\n      color: rgba(240, 240, 224, 0.5)\n\n  .show-ineligible-toggle\n    display: flex\n    align-items: center\n    gap: 0.5rem\n    font-size: 0.85rem\n    color: var(--gas-color-text, #f0f0e0)\n    cursor: pointer\n    font-family: \"Signika\", sans-serif\n\n    input[type=\"checkbox\"]\n      cursor: pointer\n\n    span\n      user-select: none\n\n.feats-list\n  @include inset(#7a7971, 0.35rem)\n  max-height: 400px\n  overflow-y: auto\n  background: rgba(0, 0, 0, 0.2)\n\n.feat-item\n  display: flex\n  align-items: center\n  gap: 0.5rem\n  padding: 0.25rem 0.5rem\n  margin-bottom: 2px\n  cursor: pointer\n  background: rgba(255, 255, 255, 0.05)\n  border: 1px solid transparent\n  transition: all 0.15s ease\n\n  &:hover\n    background: rgba(255, 255, 255, 0.1)\n    border-color: rgba(255, 255, 255, 0.2)\n\n  &.selected\n    background: var(--select-option-highlight-color, #5e5437)\n    border-color: var(--dnd5e-color-gold, #c9c9c9)\n\n  &.ineligible\n    opacity: 0.5\n    cursor: not-allowed\n\n    &:hover\n      background: rgba(139, 48, 48, 0.2)\n      border-color: rgba(139, 48, 48, 0.4)\n\n  .feat-icon\n    width: 24px\n    height: 24px\n    border-radius: 2px\n    overflow: hidden\n    flex-shrink: 0\n    border: 1px solid rgba(0, 0, 0, 0.3)\n\n    img\n      width: 100%\n      height: 100%\n      object-fit: cover\n\n  .feat-link\n    flex: 1\n    font-size: 0.9rem\n    color: var(--gas-color-text, #f0f0e0)\n    font-family: \"Signika\", sans-serif\n\n    :global(a.content-link)\n      color: var(--gas-color-text, #f0f0e0)\n      text-decoration: none\n\n      &:hover\n        color: var(--dnd5e-color-gold, #c9c9c9)\n        text-shadow: 0 0 4px rgba(255, 255, 255, 0.3)\n\n  .feat-ineligibility-reason\n    font-size: 0.75rem\n    color: #ff6b6b\n    margin-left: 0.5rem\n    display: flex\n    align-items: center\n    gap: 0.25rem\n    white-space: nowrap\n    font-family: \"Signika\", sans-serif\n\n    i\n      font-size: 0.7rem\n\n.feat-selector-footer\n  display: flex\n  justify-content: flex-end\n  align-items: center\n  gap: 0.5rem\n  padding: 0.5rem 1rem\n  background: rgba(0, 0, 0, 0.2)\n  border-top: 1px solid rgba(0, 0, 0, 0.5)\n\n  .selected-feat-info\n    flex: 1\n    display: flex\n    align-items: center\n\n    h4\n      margin: 0\n      color: var(--gas-color-text, #f0f0e0)\n      font-size: 0.9rem\n      font-weight: normal\n      font-family: \"Signika\", sans-serif\n\n  .confirm-button, .cancel-button\n    padding: 0.35rem 0.75rem\n    margin-left: 1rem\n    border-radius: 3px\n    cursor: pointer\n    font-weight: normal\n    font-size: 0.9rem\n    font-family: \"Signika\", sans-serif\n    transition: all 0.15s ease\n\n  .confirm-button\n    background: linear-gradient(180deg, #5e5437 0%, #4a4229 100%)\n    color: #f0f0e0\n    border: 1px solid #7a7971\n    box-shadow: 0 0 6px rgba(0, 0, 0, 0.5)\n\n    &:hover\n      background: linear-gradient(180deg, #6e6447 0%, #5a5239 100%)\n      box-shadow: 0 0 8px rgba(255, 255, 255, 0.2)\n\n  .cancel-button\n    background: transparent\n    color: var(--gas-color-text, #f0f0e0)\n    border: 1px solid #7a7971\n\n    &:hover\n      background: rgba(255, 255, 255, 0.1)\n      border-color: #c9c9c9\n\n.loading-state, .empty-state\n  text-align: center\n  padding: 2rem\n  color: var(--gas-color-text, #f0f0e0)\n  font-family: \"Signika\", sans-serif\n\n  i\n    font-size: 2rem\n    margin-bottom: 1rem\n    display: block\n    color: var(--dnd5e-color-gold, #c9c9c9)\n\n  p\n    margin: 0\n    font-size: 1rem\n</style>","import { get } from 'svelte/store';\nimport { MODULE_ID } from '~/src/helpers/constants';\nimport {  dropItemRegistry, preAdvancementSelections, race, background, characterClass, characterSubClass } from '~/src/stores/index.js';\nimport FeatSelector from '~/src/components/molecules/dnd5e/Feats/FeatSelector.svelte';\n\nconst BROWSE_TARGET_SELECTOR = [\n  '[data-action=\"browse\"]',\n  'button[data-action=\"choice-browse\"]',\n  'button[data-action=\"browse-compendium\"]',\n  'button[data-action=\"compendium\"]',\n  'button.item-choice-browse',\n  'a[data-action=\"browse\"]'\n].join(', ');\n\nconst isAppElementAppended = (appId) => {\n  const panelElement = $('#foundryvtt-actor-studio-pc-sheet .window-content main section.a .tab-content .content');\n  return panelElement.find(`[data-appid=\"${appId}\"]`).length > 0;\n};\n\n// Helper to get advancement element based on version\nconst getAdvancementElement = (currentProcess) => {\n  const version = window.GAS.dnd5eVersion;\n  const rawElement = currentProcess.app?.element;\n  \n  if (version >= 4) {\n    // v4 passes raw DOM element\n    return $(rawElement);\n  }\n  // v3 already provides jQuery element\n  return rawElement;\n};\n\nconst containsFeat = (value, depth = 0) => {\n  if (!value || depth > 4) return false;\n  if (typeof value === 'string') {\n    return value.toLowerCase().includes('feat');\n  }\n  if (Array.isArray(value)) {\n    return value.some((entry) => containsFeat(entry, depth + 1));\n  }\n  if (typeof value === 'object') {\n    return Object.values(value).some((entry) => containsFeat(entry, depth + 1));\n  }\n  return false;\n};\n\nconst readPath = (source, path) => {\n  let current = source;\n  for (const key of path) {\n    if (current == null) return undefined;\n    current = current[key];\n  }\n  return current;\n};\n\nconst findAdvancementFlow = (currentProcess, advancementId) => {\n  if (!advancementId) return null;\n  const flows = currentProcess?.app?.flows;\n  if (!flows) return null;\n\n  if (typeof flows.get === 'function') {\n    const direct = flows.get(advancementId);\n    if (direct) return direct;\n  }\n\n  if (typeof flows.values === 'function') {\n    for (const flow of flows.values()) {\n      if (flow?.advancement?.id === advancementId) {\n        return flow;\n      }\n    }\n  }\n\n  return null;\n};\n\nconst isFeatAdvancementFlow = (flow) => {\n  if (!flow) return false;\n\n  const advancement = flow.advancement ?? {};\n  \n  // Primary check: AbilityScoreImprovement is the main feat advancement type\n  if (advancement.type === 'AbilityScoreImprovement') {\n    window.GAS.log.d('[isFeatAdvancementFlow] Detected AbilityScoreImprovement (ASI/Feat choice)');\n    return true;\n  }\n  \n  // Secondary check: ItemChoice that is SPECIFICALLY restricted to feats only\n  // This is different from ItemChoice for Fighting Styles, Spells, etc.\n  if (advancement.type === 'ItemChoice') {\n    // Check if the restriction explicitly specifies feat type\n    const restrictionType = advancement.configuration?.restriction?.type \n                         || advancement.restriction?.type;\n    \n    const isFeatRestriction = restrictionType === 'feat';\n    \n    window.GAS.log.d('[isFeatAdvancementFlow] ItemChoice advancement:', {\n      restrictionType,\n      isFeatRestriction,\n      title: advancement.title,\n      hint: advancement.hint\n    });\n    \n    return isFeatRestriction;\n  }\n  \n  // For backwards compatibility, check if \"feat\" appears in specific paths\n  // but only for non-ItemChoice types to avoid false positives\n  if (advancement.type !== 'ItemChoice' && advancement.type !== 'ItemGrant') {\n    const ADVANCEMENT_FEAT_PATHS = [\n      ['type'],\n      ['slug'],\n      ['identifier']\n    ];\n    \n    const hasFeaInPath = ADVANCEMENT_FEAT_PATHS.some((path) => containsFeat(readPath(advancement, path)));\n    \n    if (hasFeaInPath) {\n      window.GAS.log.d('[isFeatAdvancementFlow] Detected feat in advancement path (legacy check)');\n    }\n    \n    return hasFeaInPath;\n  }\n  \n  return false;\n};\n\nconst isFeatChoiceForm = (formElement, currentProcess) => {\n  if (!formElement) return false;\n\n  const datasetType = formElement.dataset?.advancementType ?? formElement.dataset?.type;\n  if (containsFeat(datasetType)) {\n    return true;\n  }\n\n  const browseLabel = formElement.querySelector?.('[data-action=\"browse\"]')?.textContent;\n  if (containsFeat(browseLabel)) {\n    return true;\n  }\n\n  const advancementId = formElement.dataset?.id ?? formElement.getAttribute?.('data-id');\n  if (!advancementId) {\n    return false;\n  }\n\n  const flow = findAdvancementFlow(currentProcess, advancementId);\n  return isFeatAdvancementFlow(flow);\n};\n\n// Intercept browse buttons for feat selections in captured advancement forms\nexport const interceptFeatBrowseButtons = (element, currentProcess) => {\n  try {\n    if (!element?.length) {\n      return;\n    }\n\n    // Check if custom feat selector is enabled\n    const customFeatSelectorEnabled = game.settings.get('foundryvtt-actor-studio', 'enableCustomFeatSelector');\n    window.GAS.log.d('[interceptFeatBrowseButtons] Setting enabled:', customFeatSelectorEnabled);\n    \n    if (!customFeatSelectorEnabled) {\n      return;\n    }\n\n    // Remove any existing handler\n    if (element[0].gasFeatInterceptHandler) {\n      element[0].removeEventListener('click', element[0].gasFeatInterceptHandler, true);\n    }\n\n    // Add new handler in capture phase\n    element[0].gasFeatInterceptHandler = (event) => {\n    const target = $(event.target).closest(BROWSE_TARGET_SELECTOR);\n    if (!target.length) {\n      return;\n    }\n\n    const formElement = target.closest('form')[0];\n    if (!formElement) {\n      return;\n    }\n\n    const isFeat = isFeatChoiceForm(formElement, currentProcess);\n    window.GAS.log.d('[interceptFeatBrowseButtons] Browse button clicked, isFeat:', isFeat, 'formElement:', formElement);\n    \n    if (!isFeat) {\n      return;\n    }\n\n    if (typeof event.preventDefault === 'function') event.preventDefault();\n    if (typeof event.stopImmediatePropagation === 'function') event.stopImmediatePropagation();\n    if (typeof event.stopPropagation === 'function') event.stopPropagation();\n\n    window.GAS.log.d('[interceptFeatBrowseButtons] Intercepted feat browse action, opening selector');\n\n    const $form = $(formElement);\n    showFeatSelector($form, currentProcess);\n\n    return false;\n  };\n\n  element[0].addEventListener('click', element[0].gasFeatInterceptHandler, true);\n  } catch (error) {\n    window.GAS.log.e('[interceptFeatBrowseButtons] Error setting up feat interception:', error);\n  }\n};\n\n// Show the custom feat selector overlay\nexport const showFeatSelector = async (formElement, currentProcess) => {\n  try {\n    window.GAS.log.d('[showFeatSelector] Starting feat selector...');\n\n    // Get the advancement flow instance from the form\n    const advancementId = formElement.attr('data-advancement-id') || formElement.attr('data-id');\n    const level = parseInt(formElement.attr('data-level')) || 1;\n\n    // Try to get the flow to check current selections (optional validation)\n    const flow = findAdvancementFlow(currentProcess, advancementId);\n    \n    if (flow) {\n      // Only validate if we successfully found the flow\n      const advancement = flow.advancement;\n      const choices = advancement?.configuration?.choices;\n      window.GAS.log.d('[showFeatSelector] Advancement choices config:', choices);\n\n      // Get the maximum number of selections allowed\n      let maxSelections = 1; // Default to 1\n      if (choices && Array.isArray(choices) && choices.length > 0) {\n        const firstChoice = choices[0];\n        maxSelections = typeof firstChoice === 'object' ? (firstChoice.count || 1) : firstChoice;\n      }\n\n      // Count current selections\n      const currentSelections = flow.selected?.size || 0;\n      \n      window.GAS.log.d('[showFeatSelector] Selection validation:', {\n        maxSelections,\n        currentSelections,\n        canSelect: currentSelections < maxSelections\n      });\n\n      // Validate that we can add more selections\n      if (currentSelections >= maxSelections) {\n        ui.notifications.warn('No additional items can be selected, uncheck items before selecting more.');\n        window.GAS.log.w('[showFeatSelector] Maximum selections reached', {\n          max: maxSelections,\n          current: currentSelections\n        });\n        return;\n      }\n    } else {\n      // If we can't find the flow, log a warning but continue anyway\n      window.GAS.log.w('[showFeatSelector] Could not find advancement flow for validation, proceeding without validation');\n    }\n\n    // Create a temporary container for the Svelte component\n    const container = document.createElement('div');\n    container.id = 'gas-feat-selector-container';\n    document.body.appendChild(container);\n\n    // Get the actor from the advancement manager\n    const actor = currentProcess?.app?.actor;\n    const currentActorLevel = actor?.system?.details?.level ?? 1;\n    \n    // During level-up, the character is advancing TO the next level\n    // so they should be able to select feats for that target level\n    const targetLevel = currentActorLevel + 1;\n\n    // Create the feat selector instance\n    const featSelector = new FeatSelector({\n      target: container,\n      props: {\n        actor: actor,\n        characterLevel: targetLevel,\n        onSelect: (selectedFeat) => {\n          handleFeatSelection(selectedFeat, currentProcess);\n        },\n        onClose: () => {\n          featSelector.$destroy();\n          document.body.removeChild(container);\n        }\n      }\n    });\n\n  } catch (error) {\n    window.GAS.log.e('[showFeatSelector] Error showing feat selector:', error);\n    // Fallback: show error notification\n    ui.notifications.error('Failed to load feat selector. Please check your compendium sources.');\n  }\n};\n\n// Handle feat selection from our custom selector\nexport const handleFeatSelection = async (selectedFeat, currentProcess) => {\n  try {\n    window.GAS.log.d('[handleFeatSelection] Selected feat:', selectedFeat.name, 'UUID:', selectedFeat.uuid);\n    window.GAS.log.d('[handleFeatSelection] currentProcess:', currentProcess);\n\n    if (!currentProcess?.app) {\n      window.GAS.log.w('[handleFeatSelection] No advancement manager available');\n      ui.notifications.warn('Failed to find advancement manager. Please try again.');\n      return;\n    }\n\n    const advancementManager = currentProcess.app;\n    const flow = advancementManager.step?.flow;\n    if (!flow) {\n      window.GAS.log.w('[handleFeatSelection] No current flow available on advancement manager');\n      ui.notifications.warn('Failed to find current advancement flow. Please try again.');\n      return;\n    }\n\n    const item = await fromUuid(selectedFeat.uuid);\n    \n    // Check if this is an AbilityScoreImprovement flow (uses `feat` property)\n    // or an ItemChoice flow (uses `selected` Set)\n    if (flow.advancement?.type === 'AbilityScoreImprovement') {\n      // ASI flow - set the feat property directly\n      flow.feat = item;\n      window.GAS.log.d('[handleFeatSelection] Set feat property for ASI advancement');\n    } else {\n      // ItemChoice flow - add to selected set\n      flow.selected ??= new Set();\n      flow.selected.add(selectedFeat.uuid);\n      window.GAS.log.d('[handleFeatSelection] Added feat to selected set:', Array.from(flow.selected));\n\n      // If the item is not in the pool, add it to dropped (only if pool exists)\n      if (flow.pool && !flow.pool.find(i => i.uuid === selectedFeat.uuid)) {\n        flow.dropped ??= [];\n        flow.dropped.push(item);\n        item.dropped = true;\n        window.GAS.log.d('[handleFeatSelection] Added feat to dropped items');\n      }\n    }\n\n    // Re-render the advancement form to show the selected feat\n    await advancementManager.render();\n    window.GAS.log.d('[handleFeatSelection] Re-rendered advancement manager to show selection');\n\n  } catch (error) {\n    window.GAS.log.e('[handleFeatSelection] Error handling feat selection:', error);\n    ui.notifications.error('Failed to select feat. Please try again.');\n  }\n};\n\nexport const captureAdvancement = (initial = false) => {\n  window.GAS.log.d('[gas.captureAdvancement] initial', initial)\n  const skipDomMove = game.settings.get(MODULE_ID, 'disableAdvancementCapture');\n  if (skipDomMove) {\n    window.GAS.log.d('[gas.captureAdvancement] Dev setting: Skipping advancement DOM movement');\n    return;\n  }\n\n\n  const currentProcess = get(dropItemRegistry.currentProcess);\n  window.GAS.log.d('[gas.captureAdvancement] currentProcess in gas.captureAdvancement:', {\n    id: currentProcess?.id,\n    app: currentProcess?.app,\n    element: currentProcess?.app?.element\n  });\n\n  // Cache initial state if this is the first capture\n  if (initial) {\n    preAdvancementSelections.set({\n      race: get(race),\n      background: get(background),\n      class: get(characterClass),\n      subclass: get(characterSubClass)\n    });\n    window.GAS.log.d('[gas.captureAdvancement] Caching initial advancement state', get(preAdvancementSelections));\n  }\n\n  if (currentProcess) {\n    const panelElement = $('#foundryvtt-actor-studio-pc-sheet .window-content main section.a .tab-content .content');\n    if (!isAppElementAppended(currentProcess.id)) {\n      window.GAS.log.d(currentProcess);\n      const element = getAdvancementElement(currentProcess);\n      if(element) {\n        window.GAS.log.d('[gas.captureAdvancement] Got element, appending to panel');\n        element.removeClass(); // Remove all classes from the root element itself\n        element.addClass('gas-advancements')\n        element.attr('gas-appid', currentProcess.id);\n        element.appendTo(panelElement);\n        window.GAS.log.d('[gas.captureAdvancement] Element appended successfully');\n\n        // Intercept browse buttons for feat selections\n        interceptFeatBrowseButtons(element, currentProcess);\n        window.GAS.log.d('[gas.captureAdvancement] interceptFeatBrowseButtons completed');\n      } else {\n        window.GAS.log.w('[gas.captureAdvancement] No element found from getAdvancementElement');\n      }\n    } else {\n      window.GAS.log.d('[gas.captureAdvancement] Element already appended for', currentProcess.id);\n    }\n  } else {\n    window.GAS.log.w('[gas.captureAdvancement] No currentProcess available');\n  }\n}\n\nexport default {\n  captureAdvancement,\n  interceptFeatBrowseButtons,\n  showFeatSelector,\n  handleFeatSelection\n};","import { get } from 'svelte/store';\nimport { MODULE_ID } from '~/src/helpers/constants';\nimport { tabs, activeTab, dropItemRegistry, isLevelUp, levelUpTabs } from '~/src/stores/index.js';\n\n// Helper to check if we're on first step based on version\nconst isFirstAdvancementStep = (app) => {\n  const version = window.GAS.dnd5eVersion;\n  if (version >= 4) {\n    return app.steps?.[0] === app.step;\n  }\n  return app._stepIndex === 0;\n};\n\n\nexport const renderAdvancementManager = async (app, html, data) => {\n\n  // Check if the Actor Studio application is currently open by looking for its specific DOM element\n  const currentProcess = get(dropItemRegistry.currentProcess)\n  \n  if (currentProcess.id && isFirstAdvancementStep(app)) {\n    const appElement = $('#foundryvtt-actor-studio-pc-sheet');\n    if (appElement.length) {\n      const disableAdvancementCapture = game.settings.get(MODULE_ID, 'disableAdvancementCapture') || false;\n      if(disableAdvancementCapture) {\n        return;\n      }\n      dropItemRegistry.updateCurrentProcess({ app, html, data })\n      \n      // Set the global advancement manager for feat selection\n      // Try to get flows from various possible locations\n      let flows = app.flows || app._flows || app.advancementFlows;\n      window.GAS.advancementManager = { app, flows };\n      window.GAS.log.d('[renderAdvancementManager] Set global advancementManager with flows:', flows);\n      \n      const advancementsTab = get(isLevelUp) ? get(levelUpTabs).find(x => x.id === \"advancements\") : get(tabs).find(x => x.id === \"advancements\");\n      // console.log('advancementsTab', advancementsTab)\n      if (advancementsTab) {\n        Hooks.call(\"gas.captureAdvancement\");\n      } else {\n        window.GAS.log.i('Advancements tab not found, adding it to the tabs')\n        // @why,- add the advancements tab to the store, which will trigger it's component to render, which will in turn call gas.captureAdvancement\n        if(get(isLevelUp)) {\n          await levelUpTabs.update(t => [...t, { label: \"Advancements\", id: \"advancements\", component: \"Advancements\" }]);\n        } else {\n          await tabs.update(t => [...t, { label: \"Advancements\", id: \"advancements\", component: \"Advancements\" }]);\n        }\n        activeTab.set('advancements');\n      }\n    }\n  }\n}\n\n\n  export default {\n    renderAdvancementManager\n  }","\nimport { getAllPackIdsFromAllSettings } from '~/src/helpers/Utility'\nimport { MODULE_ID } from '~/src/helpers/constants';\n\nexport const renderCompendium = (app, html, data) => {\n  // window.GAS.log.d('renderCompendium', app, html, data)\n    if (game.modules.get('donation-tracker')?.active && game.settings.get(MODULE_ID, 'enable-donation-tracker')) {\n  \n      const pack = app.collection\n      if (pack.locked) return\n      if (pack.metadata.path.includes('systems/')) return\n      const allPacks = getAllPackIdsFromAllSettings();\n      const actionButtons = html.find('.action-buttons')\n      const DTaction = actionButtons.find('button.gas-add-dt-folders');\n  \n      // don't render the button if it already exists\n      if (DTaction.length) {\n        window.GAS.log.i('Donation Tracker button already exists, skipping')\n        return;\n      }\n  \n      // if the metadata.id of the pack matches any of the packs that are mapped to Actor Studio Sources, then render the DT folders button\n      if (!allPacks.includes(pack.metadata.id)) {\n        // @why commented out? Apparently these were annoying\n        // window.GAS.log.i('Pack is not mapped to Actor Studio Sources, skipping')\n        // ui.notifications.warn(`Pack ${pack.metadata.label} is not mapped to Actor Studio Sources. Please map it to enable the Donation Tracker feature.`)\n        return;\n      }\n  \n      // if the DTfolders already exist, don't render the button\n      const membershipRanks = game.membership.RANKS\n      for (const [rank, value] of Object.entries(membershipRanks)) {\n        if (value === -1) continue;\n        const folder = pack.folders.find(f => f.name === game.settings.get(MODULE_ID, `donation-tracker-rank-${rank}`))\n        if (folder) {\n          window.GAS.log.i('Donation Tracker folders already exist, skipping')\n          return;\n        }\n      }\n  \n      async function addDonationTrackerFolders() {\n        const membershipRanks = game.membership.RANKS\n        for (const [rank, value] of Object.entries(membershipRanks)) {\n          if (value === -1) continue;\n          const folder = pack.folders.find(f => f.name === game.settings.get(MODULE_ID, `donation-tracker-rank-${rank}`))\n          if (!folder) {\n            // pack.folders.createDocument({ name: game.settings.get(MODULE_ID, `donation-tracker-rank-${rank}`), type: \"JournalEntry\" });\n            const folderCls = getDocumentClass(\"Folder\");\n            // const myFolder = await folderCls.create({ name: game.settings.get(MODULE_ID, `donation-tracker-rank-${rank}`), type: \"JournalEntry\" });\n            await folderCls.create({ name: game.settings.get(MODULE_ID, `donation-tracker-rank-${rank}`), type: \"Item\" }, { pack: pack.metadata.id });\n          }\n        }\n      }\n  \n      const button = $(`<button role=\"button\" class=\"gas-add-dt-folders\" datatitle=\"${game.i18n.localize('GAS.Setting.DonationTrackerAction.Name')}\" data-tooltip=\"${game.i18n.localize('GAS.Setting.DonationTrackerAction.Hint')}\"><i class=\"fas fa-folder\"></i> ${game.i18n.localize('GAS.Setting.DonationTrackerAction.Name')}</button>`);\n      button.on('click', addDonationTrackerFolders)\n      actionButtons.append(button)\n  \n    }\n\n  }\n\n  export default {\n    renderCompendium\n  }","import PCApplication from '~/src//app/PCApplication.js';\nimport dnd5e from \"~/config/systems/dnd5e.json\";\nimport { userHasRightPermissions } from '~/src/helpers/Utility'\nimport { MODULE_ID } from '~/src/helpers/constants';\n\n// Store references to event handlers for cleanup\nconst eventHandlers = new Map();\n\nconst handleActorStudioStartButtonClick = function (e, app, html) {\n  // window.GAS.log.d('handleActorStudioStartButtonClick', e, app, html)\n  if (e.type === 'mousedown' || e.type === 'keydown' && (e.key === 'Enter' || e.key === ' ')) {\n    \n        let actorName = '';\n        let folderName = '';\n        let actorType = 'character';\n        if (html) {\n          actorName = $('input', html).val();\n          // window.GAS.log.d('renderASButtonInCreateActorApplication actorName', actorName)\n          folderName = $('select[name=\"folder\"]', html).val();\n          // window.GAS.log.d('renderASButtonInCreateActorApplication folderName', folderName)\n          const select = $('select', html);\n          actorType = select.val();\n        }\n        // window.GAS.log.d('handleActorStudioStartButtonClick actorName', actorName)\n        // window.GAS.log.d('handleActorStudioStartButtonClick folderName', folderName)\n        // window.GAS.log.d('handleActorStudioStartButtonClick actorType', actorType)\n\n        Hooks.call('gas.openActorStudio', actorName, folderName, actorType);\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n        \n  }\n}\n\n// Clean up event handlers for a specific element\nexport function cleanupEventHandlers(elementId) {\n  const handlers = eventHandlers.get(elementId);\n  if (handlers) {\n    handlers.forEach(handler => {\n      if (handler.element && handler.element.length) {\n        handler.element.off(handler.event, handler.handler);\n      }\n    });\n    eventHandlers.delete(elementId);\n  }\n}\n\n// Store event handler for later cleanup\nfunction storeEventHandler(elementId, element, event, handler) {\n  if (!eventHandlers.has(elementId)) {\n    eventHandlers.set(elementId, []);\n  }\n  eventHandlers.get(elementId).push({ element, event, handler });\n}\n\nexport function openActorStudio(actorName, folderName = '', actorType = 'character') {\n  if (userHasRightPermissions()) {\n    if (document.querySelector('#foundryvtt-actor-studio-pc-sheet')) {\n      ui.notifications.error('Actor Studio is already open and busy with another task. Please close the existing Actor Studio window before attempting to opening a new one.');\n      return;\n    }\n    try {\n        new PCApplication(new Actor.implementation({ name: actorName, folder: folderName, type: actorType })).render(true, { focus: true });\n    } catch (error) {\n        ui.notifications.error(error.message);\n    }\n  }\n}\n\nfunction isActorTypeValid(actorTypes, type) {\n  // Check if the type exists as a key in the object and its value is true\n  return actorTypes.hasOwnProperty(type) && actorTypes[type] === true;\n}\n\nfunction getActorStudioButton(buttonId, text = false) {\n  const gasButton = document.createElement('button');\n  gasButton.id = buttonId;\n  gasButton.type = 'button';\n  gasButton.className = 'dialog-button default bright';\n  gasButton.setAttribute('data-gas_start', '');\n  gasButton.setAttribute('tabindex', '0');\n  gasButton.onclick = () => console.log('GAS native onclick');\n\n  const img = document.createElement('img');\n  img.src = `modules/${MODULE_ID}/assets/actor-studio-blue.png`;\n  img.alt = 'Actor Studio';\n  img.style.height = '100%';\n  img.style.maxHeight = '30px';\n  img.style.border = 'none';\n  img.style.width = 'auto';\n  gasButton.appendChild(img);\n\n  if (text) {\n    const span = document.createElement('span');\n    span.textContent = text;\n    gasButton.appendChild(span);\n  }\n\n  setTimeout(() => {\n    const btn = document.getElementById(buttonId);\n    if (btn) {\n      // console.log('GAS: computed style', window.getComputedStyle(btn));\n      console.log('GAS: button parent', btn.parentElement);\n    }\n  }, 500);\n  return gasButton;\n}\n\n// Unified function to render sidebar button for both V12 and V13\nexport const renderActorStudioSidebarButton = (app) => {\n  if (!game.modules.get(MODULE_ID)?.active) return;\n  if (!game.settings.get(MODULE_ID, 'showButtonInSideBar')) return;\n  if (app.constructor.name !== \"ActorDirectory\") return;\n\n  const element = game.version >= 13 ? app.element : app._element;\n  console.log('GAS: element', element);\n  if (!element) return;\n\n  const elementId = `sidebar-${app.id || 'default'}`;\n  cleanupEventHandlers(elementId);\n\n  // Handle both V12 (jQuery) and V13 (DOM element) cases\n  const hasButton = game.version >= 13 \n    ? element.querySelector('#gas-sidebar-button')\n    : element.find('#gas-sidebar-button').length > 0;\n  \n  if (hasButton) return;\n\n  const gasButton = getActorStudioButton('gas-sidebar-button');\n  if (game.version >= 13) {\n    gasButton.classList.add('v13');\n    const headerActions = element.querySelector('header.directory-header .header-actions');\n    // console.log('GAS: headerActions found:', headerActions ? 1 : 0);\n    if (headerActions && headerActions.parentNode) {\n      headerActions.parentNode.insertBefore(gasButton, headerActions.nextSibling);\n    }\n  } else {\n    const header = element.find('header.directory-header')[0];\n    // console.log('GAS: header found:', header ? 1 : 0);\n    if (header) header.appendChild(gasButton);\n  }\n  \n  // Check if button was added successfully\n  const buttonAdded = game.version >= 13 \n    ? element.querySelector('#gas-sidebar-button')\n    : element.find('#gas-sidebar-button').length > 0;\n  console.log('GAS: sidebar button added?', buttonAdded ? 1 : 0);\n\n  const mousedownHandler = (e) => {\n    console.log('GAS sidebar button mousedown', e);\n    Hooks.call('gas.openActorStudio', game.user.name, '', 'character');\n  };\n  const keydownHandler = (e) => {\n    console.log('GAS sidebar button keydown', e);\n    Hooks.call('gas.openActorStudio', game.user.name, '', 'character');\n  };\n  gasButton.addEventListener('mousedown', mousedownHandler);\n  gasButton.addEventListener('keydown', keydownHandler);\n  storeEventHandler(elementId, gasButton, 'mousedown', mousedownHandler);\n  storeEventHandler(elementId, gasButton, 'keydown', keydownHandler);\n}\n\nexport const renderASButtonInCreateActorApplication = (app, html) => {\n  const createNewActorLocalized = game.i18n.format('DOCUMENT.Create', { type: game.i18n.localize('DOCUMENT.Actor') });\n  if (app.title === createNewActorLocalized) {\n    const select = $('select', html);\n    const systemActorDocumentTypes = dnd5e.actorTypes;\n    \n    // Clean up existing event handlers for this dialog\n    const dialogId = `dialog-${app.id || 'create-actor'}`;\n    cleanupEventHandlers(dialogId);\n    \n    function updateButton() {\n      const actorType = select.val();\n      // window.GAS.log.d('actorType', actorType)\n      if (isActorTypeValid(systemActorDocumentTypes, actorType)) {\n        // disable the button if the setting is enabled\n        const hideOtherButtons =  !game.user.isGM && game.settings.get(MODULE_ID, 'disableOtherActorCreationOptionsForPlayers');\n        const nonGmsCanOnlyCreatePCs = !game.user.isGM && game.settings.get(MODULE_ID, 'nonGmsCanOnlyCreatePCs');\n        if ( hideOtherButtons) {\n          $('button:not(#gas-dialog-button)', html).hide();\n        }\n        if (!game.user.isGM && nonGmsCanOnlyCreatePCs) {\n          $('#document-create .form-fields select', html).prop('disabled', true);\n        }\n        if (!$('#gas-dialog-button', html).length) {\n          const gasButton = getActorStudioButton('gas-dialog-button');\n          if(game.version < 13) {\n            $(gasButton).css('line-height', 'unset')\n          }\n          const $gasButton = $(gasButton);\n          // window.GAS.log.d('html', html)\n          $('button', html).last().after($gasButton); // Ensure button is added after the Create New Actor confirm button\n\n          // Create event handlers\n          const mousedownHandler = (e) => handleActorStudioStartButtonClick(e, app, html);\n          const keydownHandler = (e) => handleActorStudioStartButtonClick(e, app, html);\n\n          $gasButton.on('mousedown', mousedownHandler);\n          $gasButton.on('keydown', keydownHandler);\n          \n          // Store handlers for cleanup\n          storeEventHandler(dialogId, gasButton, 'mousedown', mousedownHandler);\n          storeEventHandler(dialogId, gasButton, 'keydown', keydownHandler);\n        }\n        \n      } else {\n        $('#gas-dialog-button', html).remove(); // Remove button if actorType is not \"character\"\n      }\n    }\n\n    // Initial check\n    updateButton();\n\n    // Update button when the select value changes\n    const changeHandler = updateButton;\n    select.on('change', changeHandler);\n    storeEventHandler(dialogId, select, 'change', changeHandler);\n  }\n}\n\n// Cleanup function to be called when the module is disabled or when dialogs are closed\nexport const cleanupAllEventHandlers = () => {\n  for (const [elementId] of eventHandlers) {\n    cleanupEventHandlers(elementId);\n  }\n}\n\nexport default {\n  renderASButtonInCreateActorApplication,\n  renderActorStudioSidebarButton,\n  openActorStudio,\n  cleanupAllEventHandlers\n}\n\nexport { getActorStudioButton };","import '../styles/Variables.sass'; // Import any styles as this includes them in the build.\nimport '../styles/init.sass'; // Import any styles as this includes them in the build.\n\nimport { MODULE_ID } from '~/src/helpers/constants';\n\nimport DonationTrackerGameSettings from '~/src/settings/DonationTrackerGameSettings.js';\n\n// Import usage tracking\nimport UsageTracker from '~/src/usage-tracking.js';\n\n\n//- import hooks\nimport { init, ready } from './hooks/init.js';\nimport { captureAdvancement } from './hooks/captureAdvancement.js';\nimport { renderAdvancementManager } from './hooks/advancementManager.js';\nimport { renderCompendium } from './hooks/renderCompendium.js';\nimport { renderASButtonInCreateActorApplication, renderActorStudioSidebarButton, cleanupAllEventHandlers, cleanupEventHandlers } from './hooks/actorStudioStartButtons.js';\nimport { openActorStudio } from './hooks/actorStudioStartButtons.js';\n\nHooks.once(\"init\", (app, html, data) => {\n  init(app, html, data);\n});\n\nHooks.once(\"ready\", (app, html, data) => {\n  ready(app, html, data);\n  \n  // Only send the first usage tracking event (module_loaded or session_start)\n  if (window.GASUsageTracker && !window.GASUsageTracker._hasTrackedFirstEvent) {\n    window.GASUsageTracker.initialize(); // This will send module_loaded\n    window.GASUsageTracker._hasTrackedFirstEvent = true;\n    // Do NOT call trackSessionStart here, as initialize() already tracks module_loaded\n  }\n});\n\n// Clean up event handlers when module is disabled\nHooks.once(\"disableModule\", (module) => {\n  if (module.id === MODULE_ID) {\n    cleanupAllEventHandlers();\n  }\n});\n\n// Clean up event handlers when module is unloaded\nHooks.once(\"unloadModule\", (module) => {\n  if (module.id === MODULE_ID) {\n    cleanupAllEventHandlers();\n    \n    // Track session end\n    if (window.GASUsageTracker) {\n      window.GASUsageTracker.trackSessionEnd();\n    }\n  }\n});\n\nHooks.on('gas.captureAdvancement', (initial = false) => {\n  captureAdvancement(initial);\n  \n  // Track advancement capture\n  if (window.GASUsageTracker) {\n    window.GASUsageTracker.trackAdvancementCapture(initial);\n  }\n});\n\n//- donation-tracker integration\nHooks.once(\"membershipReady\", (app, html, data) => {\n  const dtExists = game.modules.get('donation-tracker')?.active\n  window.GAS.log.i('Checking for Donation Tracker module: ', dtExists ? 'Found' : 'Not Found');\n  if (dtExists) {\n    DonationTrackerGameSettings.init();\n  }\n});\n\n\nHooks.on('renderAdvancementManager', async (app, html, data) => {\n  renderAdvancementManager(app, html, data);\n});\n\nHooks.on('renderCompendium', (pack, html, data ) => {\n  window.GAS.log.d('renderCompendium', pack);\n})\nHooks.on(\"renderFolderConfig\", (app, html, folder) => {\n  window.GAS.log.d(\"folder\", folder);\n})\nHooks.on(\"renderActorSheet\", (app, html, actor) => {\n  window.GAS.log.d(\"actor\", actor);\n})\nHooks.on(\"renderItemSheet5e\", (app, html, item) => {\n  window.GAS.log.d(\"item\", item);\n})\n\nHooks.on(\"dropActorSheetData\", (actor, type, info) => {\n  // window.GAS.log.d(\"dropActorSheetData\", actor, type, info);\n})\n\n\nHooks.on('dnd5e.preAdvancementManagerComplete', (...args) => {\n  // window.GAS.log.d(args)\n})\n\nHooks.on('renderSettingsConfig', (app, html, context) => {\n  if (game.user.isGM) {\n    $(`section[data-tab=\"${MODULE_ID}\"] h2`, html).after(`<h3>${game.i18n.localize('GAS.Setting.World')}</h3>`)\n  }\n  $(`[data-setting-id=\"${MODULE_ID}.allowManualInput\"]`, html).before(`<h4 class=\"gas-settings-h4\">${game.i18n.localize('GAS.Setting.AbilityScoreEntryOptions')}</h4>`)\n  $(`[data-setting-id=\"${MODULE_ID}.enableLevelUp\"]`, html).before(`<h4 class=\"gas-settings-h4\">${game.i18n.localize('GAS.Setting.LevelingOptions')}</h4>`)\n  $(`[data-setting-id=\"${MODULE_ID}.showButtonInSideBar\"]`, html).before(`<h4 class=\"gas-settings-h4\">${game.i18n.localize('GAS.Setting.DisplayOptions')}</h4>`)\n  $(`[data-setting-id=\"${MODULE_ID}.debug\"]`, html).before(`<h4 class=\"gas-settings-h4\">${game.i18n.localize('GAS.Setting.DebugOptions')}</h4>`)\n  $(`[data-setting-id=\"${MODULE_ID}.dontShowWelcome\"]`, html).before(`<h3>${game.i18n.localize('GAS.Setting.User')}</h3>`)\n})\n\nHooks.on('renderCompendium', async (app, html, data) => {\n  renderCompendium(app, html, data);\n})\n\n\n/** \n * Handle rendering the Actor Studio button in the Create New Actor dialog\n */\n//- game.version < 13\nHooks.on('renderApplication', (app, html, data) => {\n  renderASButtonInCreateActorApplication(app, html, data);\n});\n\n//- game.version >= 13\nHooks.on('renderApplicationV2', (app, html, data) => {\n  renderASButtonInCreateActorApplication(app, html, data);\n});\n\n// Clean up event handlers when dialogs are closed\nHooks.on('closeApplication', (app) => {\n  if (app.title === game.i18n.format('DOCUMENT.Create', { type: game.i18n.localize('DOCUMENT.Actor') })) {\n    const dialogId = `dialog-${app.id || 'create-actor'}`;\n    cleanupEventHandlers(dialogId);\n  }\n});\n\n/** \n * Handle rendering the Actor Studio button in the Sidebar Actor Directory\n */\n//- Add Actor Studio button to the Actor Directory in game.version >= 13\nHooks.on('activateActorDirectory', async (app) => {\n  renderActorStudioSidebarButton(app);\n})\n//- Add Actor Studio button to the Actor Directory in game.version < 13\nHooks.on('renderActorDirectory', async (app, html) => {\n  renderActorStudioSidebarButton(app, html);\n})\n\nHooks.on('gas.openActorStudio', (actorName, folderName, actorType) => {\n  openActorStudio(actorName, folderName, actorType);\n  \n  // Track actor studio opened\n  if (window.GASUsageTracker) {\n    window.GASUsageTracker.trackActorStudioOpened(actorName, folderName, actorType);\n  }\n});\n"],"names":["noop","now","element","text","hash","delay","detach","linear","tick","create_each_block","insert","levels","update","init","instance","create_fragment","ready","start","subscribe","run","target","_a","store","pointBuyLimit","mapValues_1","BaseConfigurator_1","_typeof","require$$0","_interopRequireDefault","_classCallCheck","BaseConfigurator","mapper","GlobalConfigurator_1","_BaseConfigurator2","_BaseConfigurator3","_possibleConstructorReturn","_inherits","GlobalConfigurator","TransitionConfigurator_1","TransitionConfigurator","TriggerConfigurator_1","_TransitionConfigurator","require$$1","_TransitionConfigurator2","TriggerConfigurator","_TriggerConfigurator2","_TriggerConfigurator","TrimerConfigurator","AsyncActionConfigurator_1","AsyncActionConfigurator","StateConfigurator_1","require$$2","_AsyncActionConfigurator","require$$3","_AsyncActionConfigurator2","StateConfigurator","invokeEach_1","merge_1","StateMachine_1","StateMachine","TaskScheduler_1","TaskScheduler","HierarchicalStateMachine_1","HierarchicalStateMachine","createContext","StateMachineConfigurator_1","_GlobalConfigurator","_GlobalConfigurator2","_StateConfigurator","_StateConfigurator2","_HierarchicalStateMachine","_HierarchicalStateMachine2","StateMachineConfigurator","delegateToAncestor_1","require$$4","require$$5","require$$6","Finity_1","Finity","merge","fromUuidSync","subclassItems","enableSpellSelection","get","isSpellcaster","initializeSpellSelection","loadAvailableSpells","levelUpFSM","level","spells","className","fromUuid","tabs","handleSpellsCompleteLevelUp","maxSpellLevel","isLevelUp","dropItemRegistry","race","subRace","background","characterClass","characterSubClass","preAdvancementSelections","actorInGame","classUuidForLevelUp","levelUpClassObject","subClassUuidForLevelUp","levelUpSubClassObject","isNewMultiClass","flattenedSelections","totalGoldFromChoices","goldRoll","enableEquipmentPurchase","getEquipmentCompletionEvent","cartTotalCost","remainingGold","finalizePurchase","hasCharacterCreationChanges","changedCharacterCreationItems","progress","success","enableEquipmentSelection","disableAdvancementCapture","fsm","newState","childSelections","existingGroup","storeDefinitions.tabs","storeDefinitions.levelUpTabs","storeDefinitions.pointBuyLimit","storeDefinitions.race","storeDefinitions.subRace","storeDefinitions.characterClass","storeDefinitions.characterSubClass","storeDefinitions.background","storeDefinitions.abilities","storeDefinitions.spells","storeDefinitions.isLevelUp","storeDefinitions.pointBuyScoreTotal","storeDefinitions.abilityRolls","storeDefinitions.isStandardArrayValues","storeDefinitions.newLevelValueForExistingClass","storeDefinitions.classUuidForLevelUp","storeDefinitions.level","storeDefinitions.activeTab","storeDefinitions.selectedMultiClassUUID","storeDefinitions.isActorCreated","storeDefinitions.actorInGame","storeDefinitions.abilityGenerationMethod","storeDefinitions.subClassesForClass","storeDefinitions.levelUpClassObject","storeDefinitions.activeRowClassKey","storeDefinitions.levelUpSubClassObject","storeDefinitions.levelUpCombinedHtml","levelUpPreAdvancementSelections","storeDefinitions.goldRoll","storeDefinitions.readOnlyTabs","storeDefinitions.levelUpRichHTML","storeDefinitions.levelUpRichSubClassHTML","selectedSpells","illuminatedDescription","log","localize","adv","MODULE_ID","document","version","writable","result","active","duration","ease","options","promise","draggable","ctx","create_if_block","create_if_block_1","booleanStore","dragDefault","storeResizing","activeTab","initialTabs","abilityGenerationMethod","totalSteps","pointBuyScoreTotal","abilityRolls","isStandardArrayValues","equipmentSelections","areGoldChoicesComplete","completedGroups","spellProgress","cssVariables","t","create_if_block_3","create_if_block_4","create_if_block_5","$classUuidForLevelUp","$actorInGame","createActorWorkflow","characterUpdateWorkflow","handleAddEquipment","addEquipmentWorkflow","handleFinalizePurchase","finalizePurchaseWorkflow","value","handleFinalizeSpells","finalizeSpellsWorkflow","actor","workflowFSM","checkInventory","illuminatedHeight","illuminatedWidth","SvelteApplication","html","selectedLists","dontShowWelcome","membershipRanks","actorTypes","nonGmsCanOnlyCreatePCs","DonationTrackerGameSettings"],"mappings":"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","x_google_ignoreList":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,83,84,89,90,93,94]}