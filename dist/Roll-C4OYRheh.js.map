{"version":3,"file":"Roll-C4OYRheh.js","sources":["../src/components/molecules/dnd5e/AbilityEntry/Roll.svelte"],"sourcesContent":["<script>\n  import { Timing } from \"@typhonjs-fvtt/runtime/util\";\n  import { createEventDispatcher, getContext, onDestroy, onMount, tick  } from \"svelte\";\n  import { abilities, race, abilityRolls } from \"~/src/stores/index\"\n  import { MODULE_ID } from \"~/src/helpers/constants\"\n  import { dnd5eModCalc } from \"~/src/helpers/Utility\"\n  \n  export let document = false;\n  \n  const dispatch = createEventDispatcher();\n  const doc = document || getContext(\"#doc\");\n  const updateDebounce = Timing.debounce(updateValue, 100);\n  let formula, allowMove;\n\n  function updateValue(attr, event) {\n    if(event.target.value < 8) return false;\n    if(event.target.value > 15) return false;\n    const options = {system: {abilities: { [attr]: {value: Number(event.target.value)}}}};\n    $doc.updateSource(options)\n    $doc = $doc\n  }\n\n  async function swapAbilities(attr, direction) {\n    const abilities = Object.keys($doc.system.abilities);\n    const index = abilities.indexOf(attr);\n    \n    if (direction === 1 && index > 0) {\n      // Move up\n      const prevAbility = abilities[index - 1];\n      const options = {\n        system: {\n          abilities: {\n            [attr]: { value: $doc.system.abilities[prevAbility].value },\n            [prevAbility]: { value: $doc.system.abilities[attr].value },\n          },\n        },\n      };\n      await $doc.updateSource(options);\n      $doc = $doc;\n    } else if (direction === -1 && index < abilities.length - 1) {\n      // Move down\n      const nextAbility = abilities[index + 1];\n      const options = {\n        system: {\n          abilities: {\n            [attr]: { value: $doc.system.abilities[nextAbility].value },\n            [nextAbility]: { value: $doc.system.abilities[attr].value },\n          },\n        },\n      };\n      await $doc.updateSource(options);\n      $doc = $doc;\n    }\n  }\n\n  async function roll(attr) {\n    const roll = await new Roll(formula).evaluate();\n    await roll.toMessage();\n\n    $abilityRolls = !$abilityRolls ? {} : $abilityRolls\n    $abilityRolls[attr] = roll.total\n\n    // set the value of the ability to the result of the roll\n    const options = {system: {abilities: { [attr]: {value: Number(roll.total)}}}};\n    $doc.updateSource(options)\n    $doc = $doc\n  }\n  \n\n  $: systemAbilities = game.system.config.abilities\n  $: systemAbilitiesArray = Object.entries(systemAbilities);\n  $: raceFeatScore = 0;\n  $: abilityAdvancements = $race?.advancement?.byType?.AbilityScoreImprovement?.[0].configuration?.fixed\n  $: allRolled = systemAbilitiesArray.every(ability => $abilityRolls[ability[0]] !== undefined);\n  $: scoreClass = allowMove && allRolled ? 'left' : 'center';\n  \n  onMount(async () => {\n    formula = game.settings.get(MODULE_ID, \"abiiltyRollFormula\")\n    allowMove = game.settings.get(MODULE_ID, \"allowAbilityRollScoresToBeMoved\")\n  });\n</script>\n\n<template lang=\"pug\">\n.attribute-entry.mt-sm\n  table\n    thead\n      tr\n        th.ability Ability\n        th.center Race / Feat\n        th.center Base Score\n        th.center Score\n        th.center Mod\n        th.center.roll-col\n    tbody\n      +each(\"systemAbilitiesArray as ability, index\")\n        tr\n          td.ability {ability[1].label}\n          td.center\n            +if(\"abilityAdvancements?.[ability[0]] > 0\")\n              span +\n            span {abilityAdvancements?.[ability[0]] || 0}\n          td.center.relative\n            input.small.mainscore(class=\"{scoreClass}\" disabled type=\"number\" value=\"{$doc.system.abilities[ability[0]]?.value}\"  name=\"{ability[0]}\" id=\"{ability[0]}\")\n            +if(\"allowMove && allRolled\")\n              .controls\n                .up.chevron\n                  +if(\"index != 0\")\n                    i.fas.fa-chevron-up(alt=\"Move Up\" on:click!=\"{swapAbilities(ability[0], 1)}\")\n                .down.chevron\n                  +if(\"index != systemAbilitiesArray.length - 1\")\n                    i.fas.fa-chevron-down(alt=\"Move Down\" on:click!=\"{swapAbilities(ability[0], -1)}\")\n          td.center\n            span {(Number(abilityAdvancements?.[ability[0]]) || 0) + Number($doc.system.abilities[ability[0]]?.value || 0)}\n          td.center\n            +if(\"dnd5eModCalc(Number($doc.system.abilities[ability[0]]?.value) + (Number(abilityAdvancements?.[ability[0]]) || 0)) > 0\")\n              span +\n            span {dnd5eModCalc(Number($doc.system.abilities[ability[0]]?.value) + (Number(abilityAdvancements?.[ability[0]]) || 0))}\n          td.center\n            .buttons(class=\"{$abilityRolls[ability[0]] ? '' : 'active'}\" alt=\"Roll\" on:click!=\"{roll(ability[0])}\")\n              i.fas.fa-dice\n\n</template>\n\n<style lang=\"sass\">\n  table\n    width: 100%\n    border-collapse: separate\n    border-spacing: 0 0.5rem\n   \n  th\n    padding: 0.1rem 0.5rem\n    text-align: left\n    font-family: var(--dnd5e-font-modesto)\n    &.center\n      text-align: center\n    &.roll-col\n      width: 2rem\n   \n  td\n    text-align: left\n    &.center\n      text-align: center\n    &.ability\n      width: 25%\n \n  .green\n    color: green\n  .red\n    color: red\n  .relative\n    position: relative\n    background-color: rgba(0, 0, 0, 0.05)\n    border-radius: 3px\n    input\n      background: none\n      width: 3em\n      &:disabled\n        color: var(--color-text-dark-primary)\n      text-decoration: none\n      border: none\n      outline: none\n      box-shadow: none\n      -webkit-appearance: none\n      -moz-appearance: none\n      appearance: none\n  .mainscore\n    min-width: 40px\n  .controls\n    .chevron\n      position: absolute\n      font-size: 0.75rem\n      right: 0\n      cursor: pointer\n      background-color: rgba(0, 0, 0, 0.1)\n      &.up\n        padding: 1px 3px 0px 3px\n        top: 0\n        &:hover\n          background-color: rgba(140, 90, 0, 0.2)\n      &.down\n        padding: 1px 3px 0px 3px\n        bottom: 0\n        &:hover\n          background-color: rgba(140, 90, 0, 0.2)\n  .buttons\n    cursor: pointer\n    min-width: 24px\n    font-size: 1rem\n    background-color: rgba(0, 0, 0, 0.1)\n    padding: 2px 1px 0px 0px\n    border: 1px solid var(--color-positive)\n    border-radius: 4px\n    color: var(--color-positive)\n    &:hover\n      cursor: pointer\n      background-color: rgba(140, 90, 0, 0.2)\n    &.active\n      border: 1px solid var(--color-negative)\n      color: var(--color-negative)\n      animation: pulse 1s infinite\n</style>"],"names":["ctx","attr","roll"],"mappings":"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"}