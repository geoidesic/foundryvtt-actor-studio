{"version":3,"file":"ShopTab-DSFTdcXH.js","sources":["../src/components/molecules/GoldDisplay.svelte","../src/plugins/equipment-purchase/handlers/PurchaseHandler.js","../src/components/organisms/dnd5e/Tabs/ShopTab.svelte"],"sourcesContent":["<script>\n  // Props to receive currency values\n  export let gp = 0;\n  export let sp = 0;\n  export let cp = 0;\n</script>\n\n<div class=\"currency-display\">\n  {#if gp !== 0}\n    <span class=\"gold\">{gp} <i class=\"fas fa-coins gold-coin\"></i></span>\n  {/if}\n  {#if sp !== 0 || gp !== 0}\n    <span class=\"silver\">{sp} <i class=\"fas fa-coins silver-coin\"></i></span>\n  {/if}\n  <span class=\"copper\">{cp} <i class=\"fas fa-coins copper-coin\"></i></span>\n</div>\n<style lang=\"sass\">\n  .currency-display\n    display: flex\n    gap: 0.5rem\n    align-items: center\n    padding: 0.5rem\n    background: rgba(255, 255, 255, 0.1)\n    border: 1px solid var(--color-border-light-primary)\n    border-radius: 4px\n    font-size: 1.2rem\n\n    .gold\n      color: var(--dnd5e-color-gold, #b59e54)\n\n    .silver\n      color: #c0c0c0\n\n    .copper\n      color: #b87333\n\n    .gold-coin\n      filter: sepia(100%) saturate(300%) brightness(70%) hue-rotate(5deg)\n\n    .silver-coin\n      filter: sepia(100%) saturate(0%) brightness(70%) hue-rotate(5deg)\n\n    .copper-coin\n      filter: sepia(50%) saturate(200%) brightness(70%) hue-rotate(350deg)\n</style>\n","// Handles currency conversion and item cost calculations for the shop\nexport class PurchaseHandler {\n  constructor() {\n    // Default setup\n  }\n\n  // Format a copper value to display GP, SP, CP\n  static formatCurrency(totalCopper) {\n    // Handle negative values\n    const isNegative = totalCopper < 0;\n    const absCopper = Math.abs(totalCopper);\n    let gp = Math.floor(absCopper / 100);\n    let sp = Math.floor((absCopper % 100) / 10);\n    let cp = absCopper % 10;\n\n    // Apply the sign to the largest nonzero denomination\n    if (isNegative) {\n      if (gp > 0) {\n        gp = -gp;\n      } else if (sp > 0) {\n        sp = -sp;\n      } else {\n        cp = -cp;\n      }\n    }\n    return { gp, sp, cp };\n  }\n\n  // Calculate the total cost of items in cart\n  static calculateTotalCost(items, cart) {\n    let totalCopper = 0;\n    \n    cart.forEach((quantity, itemId) => {\n      const item = items.find(i => i.id === itemId);\n      if (item && item.system?.price) {\n        const value = item.system.price.value || 0;\n        const denomination = item.system.price.denomination || 'cp';\n        \n        // Convert to copper based on denomination\n        let multiplier = 1;\n        switch (denomination) {\n          case 'gp': multiplier = 100; break;\n          case 'sp': multiplier = 10; break;\n          case 'pp': multiplier = 1000; break;\n          case 'ep': multiplier = 50; break;\n          default: multiplier = 1; // cp\n        }\n        \n        totalCopper += value * multiplier * quantity;\n      }\n    });\n    \n    return totalCopper;\n  }\n\n  // Format price for display\n  static formatPrice(value, denomination) {\n    if (!value) return \"0 cp\";\n    \n    // If no denomination provided, default to copper\n    denomination = denomination || \"cp\";\n    \n    return `${value} ${denomination}`;\n  }\n}\n","<script>\n  import { shopItems, shopCart, availableGold, cartTotalCost, remainingGold, updateCart, loadShopItems, finalizePurchase, initializeGold } from '../../../../stores/equipmentShop';\n  import { actorInGame, readOnlyTabs } from '../../../../stores/index';\n  import GoldDisplay from '../../../molecules/GoldDisplay.svelte';\n  import { PurchaseHandler } from '../../../../plugins/equipment-purchase/handlers/PurchaseHandler';\n  import { onMount, onDestroy, tick } from 'svelte';\n  import { localize } from \"~/src/helpers/Utility\";\n  import { get } from 'svelte/store';\n\n  let availableCurrency = { gp: 0, sp: 0, cp: 0 };\n  let cartCurrency = { gp: 0, sp: 0, cp: 0 };\n  let remainingCurrency = { gp: 0, sp: 0, cp: 0 };\n  let loading = true;\n  let cartItems = [];\n  let keywordFilter = ''; // Add variable for keyword filter\n  let expandedCategories = {}; // Track which categories are expanded\n\n  $: isDisabled = $readOnlyTabs.includes('shop');\n\n  // Reactive updates for currency display\n  $: availableCurrency = PurchaseHandler.formatCurrency($availableGold);\n  $: cartCurrency = PurchaseHandler.formatCurrency($cartTotalCost);\n  $: remainingCurrency = PurchaseHandler.formatCurrency($remainingGold);\n\n  // Update cart items whenever shopCart changes (shopItems no longer needed here)\n  $: {\n    if ($shopCart) {\n      cartItems = Array.from($shopCart.entries()).map(([itemId, { quantity, itemData }]) => {\n        if (itemData) {\n          return {\n            id: itemId,\n            item: itemData,\n            quantity,\n            price: {\n              value: itemData.system?.price?.value || 0,\n              denomination: itemData.system?.price?.denomination || 'cp'\n            }\n          };\n        }\n        return null;\n      }).filter(item => item !== null);\n    }\n  }\n\n  // Helper function to get item display name with quantity\n  function getItemDisplayName(item) {\n    return item.name;\n  }\n\n  // Add item to cart\n  async function addToCart(item) {\n    try {\n      const itemId = item.id || item._id;\n      \n      if (!itemId) {\n        console.error(\"Item has no id:\", item);\n        ui.notifications?.warn(localize('GAS.Shop.ErrorItemNoId'));\n        return;\n      }\n\n      const fullItemData = await fromUuid(item.uuid);\n      if (!fullItemData) {\n        console.error(\"Could not load full item data for UUID:\", item.uuid);\n        ui.notifications?.warn(localize('GAS.Shop.ErrorLoadingItem'));\n        return;\n      }\n      \n      const cart = get(shopCart);\n      const currentQuantity = cart.has(itemId) ? cart.get(itemId).quantity : 0;\n      const bundleQuantity = fullItemData.system?.quantity || 1;\n      const newQuantity = currentQuantity + bundleQuantity;\n      \n      // Store the UUID separately for container handling\n      updateCart(itemId, newQuantity, fullItemData, item.uuid);\n      \n    } catch(error) {\n      console.error(\"Error adding item to cart:\", error);\n      ui.notifications?.warn(localize('GAS.Shop.ErrorAddToCart'));\n    }\n  }\n  \n  // Update item quantity in cart\n  function updateItemQuantity(itemId, newQuantity) {\n    try {\n      const cart = get(shopCart);\n      if (!cart.has(itemId)) return;\n\n      const { itemData } = cart.get(itemId);\n      const quantity = Math.max(0, newQuantity);\n      \n      updateCart(itemId, quantity, itemData);\n    } catch(error) {\n      console.error(\"Error updating item quantity:\", error);\n      ui.notifications?.warn(localize('GAS.Shop.ErrorUpdateQuantity'));\n    }\n  }\n  \n  // Remove item from cart completely\n  function removeFromCart(itemId) {\n    try {\n      updateCart(itemId, 0, null);\n    } catch(error) {\n      console.error(\"Error removing item from cart:\", error);\n      ui.notifications?.warn(localize('GAS.Shop.ErrorRemoveFromCart'));\n    }\n  }\n\n  // Filter and group items by category, applying keyword filter first\n  $: filteredItems = $shopItems.filter(item => \n    item.name.toLowerCase().includes(keywordFilter.toLowerCase())\n  );\n\n  $: categoryGroups = filteredItems.reduce((acc, item) => {\n    const category = item.type.charAt(0).toUpperCase() + item.type.slice(1) + 's';\n    if (!acc[category]) {\n      acc[category] = [];\n    }\n    acc[category].push(item);\n    return acc;\n  }, {});\n\n  // Sort categories for consistent display order\n  $: categories = Object.keys(categoryGroups).sort();\n\n  // Toggle category expansion\n  function toggleCategory(category) {\n    expandedCategories[category] = !expandedCategories[category];\n    expandedCategories = { ...expandedCategories }; // Trigger reactivity\n  }\n\n  let scrolled = false;\n  let shopContainer;\n  let cleanup;\n\n  onMount(async () => {\n    loading = true;\n    \n    // Initialize gold first to make sure it's available\n    initializeGold();\n    \n    // Then load shop items\n    await loadShopItems();\n    \n    loading = false;\n\n    // Find the actual scrolling container (section.a from PCAppShell)\n    const scrollingContainer = document.querySelector('#foundryvtt-actor-studio-pc-sheet section.a');\n    if (scrollingContainer) {\n      const handleScroll = () => {\n        scrolled = scrollingContainer.scrollTop > 0;\n      };\n      scrollingContainer.addEventListener('scroll', handleScroll);\n      \n      // Cleanup on destroy\n      cleanup = () => {\n        scrollingContainer.removeEventListener('scroll', handleScroll);\n      };\n    }\n  });\n \n  onDestroy(() => {\n    if (cleanup) {\n      cleanup();\n    }\n  });\n</script>\n\n<div class=\"shop-tab-container\" class:disabled={isDisabled}>\n  <!-- Sticky currency header -->\n  <div class=\"sticky-header\" class:hidden={!scrolled}>\n    <GoldDisplay {...remainingCurrency} />\n  </div>\n\n  <div class=\"shop-tab\">\n    <div class=\"left-panel\" bind:this={shopContainer}>\n      <!-- Original header -->\n      <div class=\"panel-header\" class:hidden={scrolled}>\n        <h3 class=\"left no-margin\">{localize('GAS.Shop.AvailableGold')}</h3>\n        <div class:negative={$remainingGold < 0} class=\"remaining-currency\">\n          <GoldDisplay {...remainingCurrency} />\n        </div>\n        <h3 class=\"left no-margin\">{localize('GAS.Shop.SpentGold')}</h3>\n        <GoldDisplay {...cartCurrency} />\n      </div>\n \n      <h3>{localize('GAS.Shop.CartItems')}</h3>\n      <div class=\"cart-items\">\n        {#if cartItems.length === 0}\n          <div class=\"empty-cart\">\n            <p>{localize('GAS.Shop.CartEmpty')}</p>\n          </div>\n        {:else}\n          {#each cartItems as cartItem}\n            <div class=\"cart-item\">\n              <div class=\"cart-item-col1\">\n                <img src={cartItem.item.img} alt={cartItem.item.name} class=\"item-icon\" />\n              </div>\n              <div class=\"cart-item-col2 left\">\n                <div class=\"cart-item-name\">{getItemDisplayName(cartItem.item)}</div>\n                <div class=\"cart-item-subdetails\">\n                  <span class=\"cart-item-price\">{cartItem.price.value} {cartItem.price.denomination}</span>\n                  <span class=\"quantity-display\">×{cartItem.quantity}</span>\n                </div>\n              </div>\n              <div class=\"cart-item-col3\">\n                <button class=\"remove-btn\" on:click={() => removeFromCart(cartItem.id)} disabled={isDisabled}>\n                  <i class=\"fas fa-trash\"></i>\n                </button>\n              </div>\n            </div>\n          {/each}\n        {/if}\n      </div>\n    </div>\n\n    <!-- Right Panel: Available Equipment -->\n    <div class=\"right-panel item-list\">\n      <h3>{localize('GAS.Shop.AvailableEquipment')}</h3>\n      \n      <!-- Add Keyword Filter Input -->\n      <div class=\"filter-container mb-sm\">\n        <input \n          type=\"text\" \n          bind:value={keywordFilter} \n          placeholder={localize('GAS.Shop.FilterPlaceholder')} \n          class=\"keyword-filter\"\n          disabled={isDisabled}\n        />\n      </div>\n\n      {#if loading}\n        <div class=\"loading\">{localize('GAS.Shop.Loading')}</div>\n      {:else if filteredItems.length === 0} <!-- Check filteredItems length -->\n        <div class=\"empty-state\">\n          <p>{keywordFilter ? localize('GAS.Shop.NoMatchingEquipment') : localize('GAS.Shop.NoEquipment')}</p> <!-- Adjust message based on filter -->\n        </div>\n      {:else}\n        {#each categories as category}\n          <div class=\"category\">\n            <h4 class=\"left mt-sm flexrow category-header pointer\" on:click={() => toggleCategory(category)}>\n              <div class=\"flex0 mr-xs\">\n                {#if expandedCategories[category]}\n                  <span>[-]</span>\n                {:else}\n                  <span>[+]</span>\n                {/if}\n              </div>\n              <div class=\"flex\">{category}</div>\n            </h4>\n            {#if expandedCategories[category]}\n              <!-- Use categoryGroups which is derived from filteredItems -->\n              {#each categoryGroups[category] as item (item.uuid || item._id)} \n                <div class=\"item-row\">\n                  <div class=\"item-details\">\n                    <img src={item.img} alt={item.name} class=\"item-icon\" />\n                    <span class=\"item-name\">{getItemDisplayName(item)}</span>\n                  </div>\n                  <div class=\"item-actions\">\n                    <span class=\"item-price\">\n                      {item.system?.price?.value || 0} {item.system?.price?.denomination || 'cp'}\n                    </span>\n                    <button class=\"add-btn\" on:click|preventDefault={() => addToCart(item)} disabled={isDisabled}>\n                      <i class=\"fas fa-plus\"></i>\n                    </button>\n                  </div>\n                </div>\n              {/each}\n            {/if}\n          </div>\n        {/each}\n      {/if}\n    </div>\n  </div>\n{#if isDisabled}\n    <div class=\"overlay\"></div>\n  {/if}\n</div>\n\n<style lang=\"sass\">\n  @import \"../../../../../styles/features/equipment-purchase.sass\"\n\n  :global(.GAS.theme-dark .cart-item .cart-item-price)\n    color: silver\n\n  :global(.GAS.theme-dark .item-row .item-actions .item-price)\n    color: silver\n  :global(.GAS.theme-dark .cart-item .quantity-display)\n    background: rgba(255, 255, 255, 0.1) !important\n    color: silver !important \n\n  .shop-tab-container \n    position: relative\n    height: 100%\n    width: 100%\n    display: flex\n    flex-direction: column\n\n    &.disabled \n      pointer-events: none\n    \n  .overlay\n    position: absolute\n    top: 0\n    left: 0\n    right: 0\n    bottom: 0\n    background-color: rgba(200, 200, 200, 0.3)\n    pointer-events: all\n    cursor: not-allowed\n    z-index: 100\n    transition: background-color 0.2s ease\n    &:hover\n      background-color: rgba(200, 200, 200, 0.4)\n\n  .sticky-header\n    position: sticky\n    top: 15px\n    left: 1rem\n    z-index: 5\n    background: black\n    padding: 0\n    margin: 0\n    max-width: 150px\n    &.hidden\n      display: none\n\n  .panel-header.hidden\n    display: none\n\n  .shop-tab\n    display: flex\n    height: 100%\n    overflow: visible\n\n  .left-panel\n    flex: 1\n    display: flex\n    flex-direction: column\n    height: 100%\n    overflow-y: auto\n    padding: 0.5rem\n    border-right: 1px solid var(--color-border-light-tertiary)\n\n  .right-panel\n    flex: 2\n    display: flex\n    flex-direction: column\n    height: 100%\n    overflow-y: auto\n    padding: 0.5rem\n\n  h3\n    margin-bottom: 0.5rem\n    border-bottom: 1px solid var(--color-border-light-highlight)\n    padding-bottom: 0.25rem\n\n  .loading, .empty-state, .empty-cart\n    padding: 1rem\n    text-align: center\n    color: var(--color-text-dark-secondary)\n\n  .remaining-currency\n    &.negative\n      :global(.currency-display)\n        background-color: rgba(255, 0, 0, 0.1)\n        border-color: rgba(255, 0, 0, 0.5)\n\n  .cart-items\n    flex: 1\n    overflow-y: auto\n    margin-bottom: 1rem\n    display: flex\n    flex-direction: column\n    gap: 0.5rem\n\n\n  .cart-item\n    display: flex\n    padding-right: 0.5rem\n    background: rgba(0, 0, 0, 0.05)\n    border: 1px solid var(--color-border-light-tertiary)\n    border-radius: 3px\n    align-items: stretch\n    gap: 0.75rem\n\n    .cart-item-col1\n      width: 100%\n      height: 100%\n      max-width: 50px\n    .item-icon\n      height: 100%\n      object-fit: contain\n      border: none\n      display: block\n\n    .cart-item-col2\n      flex: 1\n      display: flex\n      flex-direction: column\n      gap: 0.1rem\n      min-width: 0\n      padding-top: 0.5rem\n      padding-bottom: 0.5rem\n      justify-content: center\n\n    .cart-item-name\n      font-weight: bold\n      white-space: nowrap\n      overflow: hidden\n      text-overflow: ellipsis\n      line-height: 1.2\n\n    .cart-item-subdetails\n      display: flex\n      align-items: center\n      gap: 0.5rem\n      font-size: 0.9em\n      color: var(--color-text-dark-secondary)\n      line-height: 1.1\n\n    .cart-item-price\n      white-space: nowrap\n\n    .quantity-display\n      background: rgba(0, 0, 0, 0.1)\n      padding: 0.1rem 0.3rem\n      border-radius: 3px\n      font-weight: bold\n      min-width: 1.8rem\n      text-align: center\n      white-space: nowrap\n      font-size: 0.9em\n      color: var(--color-text-dark-primary)\n\n    .cart-item-col3\n      flex-shrink: 0\n      display: flex\n      align-items: center\n      padding-top: 0.5rem\n      padding-bottom: 0.5rem\n\n    .remove-btn\n      background: none\n      border: none\n      cursor: pointer\n      padding: 0.25rem 0 0.25rem 0.25rem\n      border-radius: 3px\n      line-height: 1\n      \n      &:hover\n        background: rgba(153, 0, 0, 0.1)\n\n      &:disabled\n        opacity: 0.5\n        cursor: not-allowed\n        &:hover\n          background: none\n\n  .category\n    h4\n      color: var(--color-highlight)\n      font-size: 1rem\n      margin-bottom: 0.2rem\n      padding-bottom: 0.1rem\n      border-bottom: 1px solid var(--color-border-light-highlight)\n      cursor: pointer\n\n  .item-row\n    display: flex\n    justify-content: space-between\n    padding: 0.25rem\n    align-items: center\n    border-bottom: 1px solid rgba(0, 0, 0, 0.05)\n\n    &:hover\n      background: rgba(0, 0, 0, 0.05)\n\n  .item-details\n    display: flex\n    align-items: center\n    gap: 0.5rem\n    flex: 1\n\n    .item-icon\n      width: 24px\n      height: 24px\n      border: none\n\n  .item-actions\n    display: flex\n    align-items: center\n    gap: 0.5rem\n    min-width: 80px\n    justify-content: flex-end\n\n    .item-price\n      color: var(--color-text-dark-secondary)\n      font-size: 0.9rem\n\n    .add-btn\n      background: var(--dnd5e-color-gold, #b59e54)\n      border: none\n      width: 24px\n      height: 24px\n      border-radius: 3px\n      color: black\n      display: flex\n      align-items: center\n      justify-content: center\n      cursor: pointer\n\n      i.fas.fa-plus\n        margin-right: 0\n        margin-left: 0\n\n      &:hover\n        background: darken(#b59e54, 10%)\n\n      &:disabled\n        opacity: 0.5\n        cursor: not-allowed\n        &:hover\n          background: var(--dnd5e-color-gold, #b59e54)\n          \n  .filter-container\n    padding: 0 0.25rem // Match item-row padding\n    margin-bottom: 0.5rem // Add margin like h4\n\n  .keyword-filter\n    width: 100%\n    padding: 0.3rem 0.5rem\n    border: 1px solid var(--color-border-light-tertiary)\n    border-radius: 3px\n    background: rgba(0, 0, 0, 0.05)\n    color: var(--color-text-dark-primary)\n\n    &:focus\n      outline: none\n      border-color: var(--color-border-light-highlight)\n      background: rgba(0, 0, 0, 0.08)\n\n    &:disabled\n      opacity: 0.7\n      cursor: not-allowed\n      background: rgba(0, 0, 0, 0.02)\n\n  .toggle-icon\n    margin-left: 0.5rem\n    font-size: 0.8rem\n    color: var(--color-text-dark-secondary)\n\n  .gold-header\n    position: sticky\n    top: 0          // Stick to top inside tab-content area\n    z-index: 5\n    background: var(--color-bg-primary)\n    padding: 0.5rem\n    border-bottom: 1px solid var(--color-border-light-tertiary)\n</style>"],"names":["ctx","create_if_block_1","create_if_block","get"],"mappings":"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"}