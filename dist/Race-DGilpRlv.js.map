{"version":3,"file":"Race-DGilpRlv.js","sources":["../src/components/organisms/dnd5e/Tabs/Race.svelte"],"sourcesContent":["<script>\n  import SvelteSelect from \"svelte-select\";\n  import IconSelect from \"~/src/components/atoms/select/IconSelect.svelte\";\n  import {\n    getFoldersFromMultiplePacks,\n    extractItemsFromPacks,\n    addItemToCharacter,\n    getPacksFromSettings,\n    log,\n  } from \"~/src/helpers/Utility.js\";\n  import { getContext, onDestroy, onMount, tick } from \"svelte\";\n  import { localize } from \"#runtime/svelte/helper\";\n  import { race } from \"~/src/helpers/store\";\n\n  let active = null,\n    value = null,\n    placeHolder = \"Races\",\n    richHTML = \"\";\n  let packs = getPacksFromSettings(\"races\");\n  let folders = getFoldersFromMultiplePacks(packs, 1);\n  let folderIds = folders.map((x) => x._id);\n  let allRaceItems = extractItemsFromPacks(packs, [\n    \"name->label\",\n    \"img\",\n    \"type\",\n    \"folder\",\n    \"uuid->value\",\n    \"_id\",\n  ]);\n  let raceDefinitions = allRaceItems\n    .filter((x) => folderIds.includes(x.folder))\n    .sort((a, b) => a.label.localeCompare(b.label));\n\n  const actor = getContext(\"#doc\");\n\n  const importAdvancements = async () => {\n    log.d('advancementArray',advancementArray)\n    for (const advancement of advancementArray) {\n      try {\n        const module = await import(`~/src/components/molecules/dnd5e/Advancements/${advancement.type}.svelte`);\n        advancementComponents[advancement.type] = module.default;\n      } catch (error) {\n        log.e(`Failed to load component for ${advancement.type}:`, error);\n      }\n    }\n  };\n\n  const selectHandler = async (option) => {\n    $race = await fromUuid(option);\n    active = option;\n    await tick();\n    // must be after tick to avoid reactiverace conditions\n    await importAdvancements();\n    richHTML = await TextEditor.enrichHTML(html);\n\n  };\n\n  const importPath = \"components/molecules/dnd5e/Advancements/\";\n\n  /**\n   * So the only viable strategy is to keep the race additions in storage\n   * and then only add them after the Actor is added to the game.\n   * I haven't found a way to add them to the Actor before it is persisted.\n   */\n  const createActorInGameAndEmbedItems = async () => {\n    const itemData = race.toObject();\n    const actorInGame = await Actor.create(actorObject);\n    const result = await addItemToCharacter(actorInGame, itemData);\n  };\n\n\n  $: actorObject = $actor.toObject();\n  $: options = raceDefinitions;\n  $: html = $race?.system?.description?.value || \"\";\n  $: movement = $race?.system?.movement;\n  $: senses = $race?.system?.senses;\n  $: advancementComponents = {};\n\n  $: filteredMovement = movement\n    ? Object.keys(movement)\n        .filter((key) => key !== \"units\" && movement[key])\n        .map((key) => ({ label: key, value: movement[key] }))\n    : [];\n\n  $: filteredSenses = senses\n    ? Object.keys(senses)\n        .filter((key) => key !== \"units\" && senses[key])\n        .map((key) => ({ label: key, value: senses[key] }))\n    : [];\n\n  $: units = $race?.system?.movement?.units || \"\";\n  $: type = $race?.system?.type || \"\";\n  $: source = $race?.system?.source || \"\";\n  $: book = source?.book || \"\";\n  $: page = source?.page ? \", p. \" + source.page : \"\";\n  $: advancementArray = $race?.advancement?.byId\n    ? Object.entries($race.advancement.byId)\n        .map(([id, value]) => ({ ...value, id }))\n        .filter(\n          (value) =>\n            !(value.type == \"Trait\" && value.title == \"Dwarven Resilience\"),\n        )\n    : // .filter(value => (value.type == 'Trait' && value.title == \"Tinker\"))\n      [];\n\n\n  onMount(async () => {\n    if ($race) {\n      value = $race.uuid;\n    }\n    await tick();\n    await importAdvancements();\n    richHTML = await TextEditor.enrichHTML(html);\n  });\n\n</script>\n\n<template lang=\"pug\">\ndiv.content\n  .flexrow\n    .flex2.pr-sm.col-a\n      IconSelect.mb-md.icon-select({options} {active} {placeHolder} handler=\"{selectHandler}\" id=\"race-select\" bind:value )\n      +if(\"value\")\n        +if(\"source\")\n          //- h3.left {localize('GAS.Source')}\n          ol.properties-list\n            li {book} {page} {type.value ? ', ' + type.value : ''} \n\n        +if(\"filteredMovement\")\n          h3.left {localize('GAS.Tabs.Races.Movement')}\n          ol.properties-list\n            +each(\"filteredMovement as movement\")\n              li.left {movement.label} : {movement.value} {units}\n        +if(\"filteredSenses\")\n          h3.left {localize('GAS.Tabs.Races.Senses')}\n          ol.properties-list\n            +each(\"filteredSenses as senses\")\n              li.left {senses.label} : {senses.value} {units}\n        +if(\"advancementArray\")\n          h3.left {localize('GAS.Advancements')}\n          ul.icon-list\n            +each(\"advancementArray as advancement\")\n              //- @todo: this should be broken out into components for each advancement.type\n              li.left\n                .flexrow(data-tooltip=\"{advancement.configuration?.hint || null}\" data-tooltip-class=\"gas-tooltip dnd5e2 dnd5e-tooltip item-tooltip\")\n                  .flex0.relative.image\n                    img.icon(src=\"{advancement.icon}\" alt=\"{advancement.title}\")\n                  .flex2 {advancement.title}\n                .flexrow\n                  svelte:component(this=\"{advancementComponents[advancement.type]}\" advancement=\"{advancement}\")\n                    \n                  \n                \n    .flex0.border-right.right-border-gradient-mask \n    .flex3.left.pl-md.scroll.col-b {@html richHTML}\n\n</template>\n\n<style lang=\"sass\">\n  @import \"../../../../../styles/Mixins.scss\"\n  .content \n    @include staticOptions\n\n  :global(.icon-select)\n    position: relative\n\n\n\n</style>\n"],"names":["ctx","value"],"mappings":"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"}