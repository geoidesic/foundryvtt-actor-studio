{"version":3,"file":"StandardArray-W0Dt9z9G.js","sources":["../src/components/molecules/dnd5e/AbilityEntry/StandardArray.svelte"],"sourcesContent":["<script>\n  import { Timing } from \"@typhonjs-fvtt/runtime/util\";\n  import {\n    createEventDispatcher,\n    getContext,\n    onDestroy,\n    onMount,\n    tick,\n  } from \"svelte\";\n  import { abilities, race, isStandardArrayValues, abilityRolls } from \"~/src/stores/index\";\n  import { MODULE_ID, STANDARD_ARRAY } from \"~/src/helpers/constants\";\n  import { dnd5eModCalc } from \"~/src/helpers/Utility\";\n\n  export let document = false;\n\n  const dispatch = createEventDispatcher();\n  const doc = document || getContext(\"#doc\");\n  const updateDebounce = Timing.debounce(updateValue, 100);\n\n  async function updateValue(attr, value) {\n    // move the value to the next ability according to the direction of the arrow\n    const abilities = Object.keys(STANDARD_ARRAY);\n    // get index of attr from abilities\n    const index = abilities.indexOf(attr);\n    // window.GAS.log.d('abilities', abilities)\n    // window.GAS.log.d('index', index)\n    // window.GAS.log.d('value', value)\n    // window.GAS.log.d('attr', attr)\n    \n    switch (value) {\n      case -1:\n        // move the value to the next ability according to the direction of the arrow\n        if (index < abilities.length - 1) {\n          const nextAbility = abilities[index + 1];\n          // window.GAS.log.d('nextAbility', nextAbility)\n          const options = {\n            system: {\n              abilities: {\n                [attr]: { value: $doc.system.abilities[nextAbility].value },\n                [nextAbility]: { value: $doc.system.abilities[attr].value },\n              },\n            },\n          };\n          // window.GAS.log.d('options', options)\n          await $doc.updateSource(options);\n          $doc = $doc;\n        }\n        break;\n\n      default:\n        // move the value to the next ability according to the direction of the arrow\n        if (index > 0) {\n          const nextAbility = abilities[index - 1];\n          // window.GAS.log.d('nextAbility', nextAbility)\n          const options = {\n            system: {\n              abilities: {\n                [attr]: { value: $doc.system.abilities[nextAbility].value },\n                [nextAbility]: { value: $doc.system.abilities[attr].value },\n              },\n            },\n          };\n          // window.GAS.log.d('options', options)\n          await $doc.updateSource(options);\n          $doc = $doc;\n        }\n        break;\n    }\n\n    // window.GAS.log.d(abilities)\n    // const options = {system: {abilities: { [attr]: {value: Number(event.target.value)}}}};\n    // $doc.updateSource(options)\n    // $doc = $doc\n  }\n\n  function reset() {\n    $abilityRolls = {};\n\n    const options = { system: { abilities: {} } };\n    systemAbilitiesArray.forEach((ability) => {\n      options.system.abilities[ability[0]] = {\n        value: STANDARD_ARRAY[ability[0]],\n      };\n    });\n    $doc.updateSource(options);\n    $doc = $doc;\n  }\n\n  function arraysMatch(array1, array2) {\n    if (array1.length !== array2.length) return false;\n\n    const sortedArray1 = array1.slice().sort((a, b) => a - b);\n    const sortedArray2 = array2.slice().sort((a, b) => a - b);\n\n    return sortedArray1.every((value, index) => value === sortedArray2[index]);\n  }\n\n  $: systemAbilities = game.system.config.abilities;\n  $: systemAbilitiesArray = Object.entries(systemAbilities);\n  $: raceFeatScore = 0;\n  $: abilityAdvancements =\n    $race?.advancement?.byType?.AbilityScoreImprovement?.[0].configuration\n      ?.fixed;\n  // $: isStandardArrayValues = arraysMatch(\n  //   Object.values(STANDARD_ARRAY),\n  //   systemAbilitiesArray.map(\n  //     (ability) => $doc.system.abilities[ability[0]].value,\n  //   ),\n  // );\n  $: $isStandardArrayValues = arraysMatch(\n    Object.values(STANDARD_ARRAY),\n    systemAbilitiesArray.map(\n      (ability) => $doc.system.abilities[ability[0]]?.value,\n    ),\n  );\n  // $: {\n  //   const currentAbilities = systemAbilitiesArray.map(\n  //     (ability) => {\n  //       window.GAS.log.d(ability) \n  //       return $doc.system.abilities[ability[0]].value\n  //     }\n  //   );\n  //   const match = arraysMatch(STANDARD_ARRAY, currentAbilities);\n  //   isStandardArrayValues.set(match);\n  // }\n  onMount(async () => {\n    // window.GAS.log.d($doc.system.abilities)\n    // window.GAS.log.d(Object.keys($doc.system.abilities))\n    // window.GAS.log.d(isStandardArrayValues)\n    // if all the abilities are 10, set them to the standard array\n    if (\n      systemAbilitiesArray.every(\n        (ability) =>\n          $doc.system.abilities[ability[0]]?.value === 10,\n      )\n    ) {\n      reset();\n    }\n  });\n</script>\n\n<template lang=\"pug\">\n.attribute-entry.mt-sm\n  table\n    thead\n      tr\n        th.ability Ability\n        th.center Race / Feat\n        th.center Base Score\n        th.center Score\n        th.center Modifier\n    tbody\n      +each(\"systemAbilitiesArray as ability, index\")\n        tr\n          td.ability {ability[1].label}\n          td.center\n            +if(\"abilityAdvancements?.[ability[0]] > 0\")\n              span +\n            span {abilityAdvancements?.[ability[0]] || 0}\n          td.center.relative\n            input.left.small.mainscore(disabled type=\"number\" value=\"{$doc.system.abilities[ability[0]]?.value}\")\n            .controls\n              .up.chevron\n                +if(\"index != 0\")\n                  i.fas.fa-chevron-up(alt=\"Decrease\" on:click!=\"{updateDebounce(ability[0], 1)}\")\n              .down.chevron\n                +if(\"index != 5\")\n                  i.fas.fa-chevron-down(alt=\"Increase\" on:click!=\"{updateDebounce(ability[0], -1)}\")\n          td.center {(Number(abilityAdvancements?.[ability[0]]) || 0) + Number($doc.system.abilities[ability[0]]?.value || 0)}\n          td.center\n            +if(\"dnd5eModCalc(Number($doc.system.abilities[ability[0]]?.value) + (Number(abilityAdvancements?.[ability[0]]) || 0)) > 0\")\n              span +\n            span {dnd5eModCalc(Number($doc.system.abilities[ability[0]]?.value) + (Number(abilityAdvancements?.[ability[0]]) || 0))}\n          \n      +if(\"!$isStandardArrayValues\")\n        tr\n          td(colspan=\"5\")\n            hr\n            button.btn.btn-primary(on:click=\"{reset}\") Reset to Standard Array\n\n</template>\n\n<style lang=\"sass\">\n  table\n    width: 100%\n    border-collapse: separate\n    border-spacing: 0 0.5rem\n   \n  th\n    padding: 0.1rem 0.5rem\n    text-align: left\n    font-family: var(--dnd5e-font-modesto)\n    &.center\n      text-align: center\n    &.ability\n      width: 25%\n   \n  td\n    text-align: left\n    &.center\n      text-align: center\n    &.ability\n      width: 25%\n \n  .green\n    color: green\n  .red\n    color: red\n  .mainscore\n    min-width: 40px\n  .controls\n    .chevron\n      position: absolute\n      font-size: 0.75rem\n      right: 0\n      cursor: pointer\n      background-color: rgba(0, 0, 0, 0.1)\n      &.up\n        padding: 1px 3px 0px 3px\n        top: 0\n        &:hover\n          background-color: rgba(140, 90, 0, 0.2)\n      &.down\n        padding: 1px 3px 0px 3px\n        bottom: 0\n        &:hover\n          background-color: rgba(140, 90, 0, 0.2)\n\n</style>\n"],"names":["ctx","attr"],"mappings":"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"}