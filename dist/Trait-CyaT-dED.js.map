{"version":3,"file":"Trait-CyaT-dED.js","sources":["../src/components/molecules/dnd5e/Advancements/Trait.svelte"],"sourcesContent":["<script>\n  import { getContext, onDestroy, onMount, tick } from \"svelte\";\n  import { ucfirst } from \"~/src/helpers/Utility\";\n  import { writable, derived } from \"svelte/store\";\n  import { log } from \"~/src/helpers/Utility\";\n\n  export let advancement = null;\n\n  let grants = [];\n\n  function getBaseItemUUID(identifier) {\n    if (!identifier) {\n      console.trace();\n      return null;\n    }\n    log.d(\"identifier\", identifier);\n    let pack = CONFIG.DND5E.sourcePacks.ITEMS;\n    let [scope, collection, id] = identifier.split(\".\");\n    if (scope && collection) pack = `${scope}.${collection}`;\n    if (!id) id = identifier;\n    return `Compendium.${pack}.Item.${id}`;\n  }\n\n  const morphPool = (p) => {\n    const arr = Array.from(p);\n    const nuarr = arr.map((x) => {\n      const split = x.split(\":\");\n      if (split[2]) {\n        return { all: false, label: split[2], value: split[1] };\n      }\n      return { all: true, label: split[0], value: split[1] };\n    });\n    return nuarr;\n  };\n\n  const fromAll = (p) => {\n    return p.some((x) => {\n      return x.all;\n    });\n  };\n\n  let choices = advancement.configuration.choices.map((c) => {\n    return {\n      count: c.count,\n      pool: morphPool(c.pool),\n    };\n  });\n\n  const item = writable(null);\n\n  const fetchAndSetItem = async (uuid) => {\n    const itemObj = await fromUuid(uuid);\n    log.d('Item', itemObj);\n    item.set(itemObj);\n  };\n\n  const processGrant = async (grant) => {\n    const split = grant.split(\":\");\n    log.d('Trait split', split);\n    log.d('switch', split[0]);\n    switch (split[0]) {\n      case \"languages\":\n        return { label: ucfirst(split[1]), value: split[2] };\n      case \"tool\":\n        const uuid = getBaseItemUUID(CONFIG.DND5E.toolIds[split[1]]);\n        await fetchAndSetItem(uuid);\n        let fetchedItem;\n        item.subscribe(value => {\n          fetchedItem = value;\n        })();\n        return { label: fetchedItem?.name, value: split[1] };\n      case \"saves\":\n        return { label: game.system.config.abilities[split[1]].label, value: null };\n      case \"armor\":\n        return { label: game.system.config.armorProficiencies[split[1]], value: null };\n      case \"weapon\":\n        return { label: ucfirst(split[2]), value: game.system.config.weaponProficiencies[split[1]] };\n      case 'dr':\n        return { label: game.system.config.damageTypes[split[1]].label, value: split[1] };\n      default:\n        return {\n          label: game.system.config[split[0]][split[1]].label,\n          value: \"\",\n        };\n    }\n  };\n\n  const initializeGrants = async () => {\n    log.d(advancement.configuration.grants)\n    const grantPromises = Array.from(advancement.configuration.grants).map(processGrant);\n    grants = await Promise.all(grantPromises);\n    log.d('Grants', grants);\n  };\n\n  onMount(async () => {\n    log.d(\"Advancement\", advancement);\n    if (advancement.configuration.grants.size > 0) {\n      await initializeGrants();\n    }\n  });\n</script>\n\n\n<template lang=\"pug\">\n  .advancement.mt-sm(data-type=\"{advancement.type}\")\n    +if(\"grants.length > 0\")\n      +each(\"grants as grant\")\n        .flexrow\n          .flex.left {grant.label}\n          +if(\"grant.value\")\n            .flex0.right.badge.inset {grant.value}\n  \n    +if(\"choices.length > 0\")\n      +each(\"choices as choice\")\n        +if(\"!fromAll(choice.pool)\")\n          .flexrow\n            h3.flex\n              span Choose&nbsp;\n              span &nbsp;{choice.count}&nbsp; \n              span of the following:\n          +each(\"choice.pool as pool\")\n            .flexrow\n              .flex.left {pool.label}\n              +if(\"pool.value\")\n                .flex0.right.badge.inset {pool.value}\n          +else()\n            .flexrow\n              .flex \n                span Choose&nbsp;\n                span {choice.count} \n              .flex0.badge.inset.right any\n  \n  </template>\n  \n  <style lang=\"sass\">\n  @import \"../../../../../styles/Mixins.scss\"\n  .advancement\n    @include inset\n\n    .badge.inset\n      @include badge()\n      @include inset\n\n</style>"],"names":["ctx"],"mappings":"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"}