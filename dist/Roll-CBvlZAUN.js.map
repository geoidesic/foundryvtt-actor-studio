{"version":3,"file":"Roll-CBvlZAUN.js","sources":["../src/components/molecules/dnd5e/AbilityEntry/Roll.svelte"],"sourcesContent":["<script>\n  import { log } from \"~/src/helpers/Utility\";\n  import { Timing } from \"@typhonjs-fvtt/runtime/util\";\n  import { createEventDispatcher, getContext, onDestroy, onMount, tick  } from \"svelte\";\n  import { abilities, race, abilityRolls } from \"~/src/helpers/store\"\n  import { MODULE_ID } from \"~/src/helpers/constants\"\n  \n  export let document = false;\n  \n  const dispatch = createEventDispatcher();\n  const doc = document || getContext(\"#doc\");\n  const updateDebounce = Timing.debounce(updateValue, 100);\n  let formula;\n\n  function updateValue(attr, event) {\n    if(event.target.value < 8) return false;\n    if(event.target.value > 15) return false;\n    const options = {system: {abilities: { [attr]: {value: Number(event.target.value)}}}};\n    $doc.updateSource(options)\n    $doc = $doc\n  }\n\n\n  async function roll(attr) {\n    const roll = await new Roll(formula).evaluate();\n    await roll.toMessage();\n\n    $abilityRolls = !$abilityRolls ? {} : $abilityRolls\n    $abilityRolls[attr] = roll.total\n\n    // set the value of the ability to the result of the roll\n    const options = {system: {abilities: { [attr]: {value: Number(roll.total)}}}};\n    $doc.updateSource(options)\n    $doc = $doc\n  }\n  \n\n  $: systemAbilities = game.system.config.abilities\n  $: systemAbilitiesArray = Object.entries(systemAbilities);\n  $: raceFeatScore = 0;\n  $: abilityAdvancements = $race?.advancement?.byType?.AbilityScoreImprovement?.[0].configuration?.fixed\n\n  onMount(async () => {\n    formula = game.settings.get(MODULE_ID, \"abiiltyRollFormula\")\n  });\n</script>\n\n<template lang=\"pug\">\n.attribute-entry.mt-sm\n  +each(\"Object.keys($abilityRolls) as roll, ability\")\n    pre abilityRolls {ability}: {roll}\n  h5.flexrow.mb-sm\n    .flex2.left Ability\n    .flex1.center Race / Feat\n    .flex1.center Base Score\n    .flex1.center Score\n    .flex1.center Modifier\n  .indent\n    +each(\"systemAbilitiesArray as ability, index\")\n      .flexrow.mb-sm\n        .flex2.left {ability[1].label}\n        .flex1.center.align-text-with-input\n          +if(\"abilityAdvancements?.[ability[1].abbreviation] > 0\")\n            span +\n          span {abilityAdvancements?.[ability[1].abbreviation] || 0}\n        .flex1.center.relative\n          input.center.small(disabled type=\"number\" value=\"{$doc.system.abilities[ability[1].abbreviation].value}\"  name=\"{ability[1].abbreviation}\" id=\"{ability[1].abbreviation}\")\n        .flex1.center.align-text-with-input {(Number(abilityAdvancements?.[ability[1].abbreviation]) || 0) + Number($doc.system.abilities[ability[1].abbreviation].value)}\n        .flex1.center.align-text-with-input \n          +if(\"$doc.system.abilities[ability[1].abbreviation].mod > 0\")\n            span +\n          span {$doc.system.abilities[ability[1].abbreviation].mod}\n        .flex0.center.justify-flexrow-vertical.controls(class=\"{$abilityRolls[ability[1].abbreviation] ? '' : 'active'}\" alt=\"Roll\" on:click!=\"{roll(ability[1].abbreviation)}\")\n          i.fas.fa-dice\n\n</template>\n\n<style lang=\"sass\">\n  .align-text-with-input\n    margin-top: 0.3rem\n  .green\n    color: green\n  .red\n    color: red\n  .controls\n    cursor: pointer\n    min-width: 24px\n    font-size: 1rem\n    background-color: rgba(0, 0, 0, 0.1)\n    padding: 2px 1px 0px 0px\n    border: 1px solid var(--color-positive)\n    border-radius: 4px\n    color: var(--color-positive)\n    &:hover\n      cursor: pointer\n      background-color: rgba(140, 90, 0, 0.2)\n    &.active\n      border: 1px solid var(--color-negative)\n      color: var(--color-negative)\n      animation: pulse 1s infinite\n    \n</style>"],"names":["ctx","attr","roll"],"mappings":"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"}