{"version":3,"file":"StandardArray-DIYzeSO2.js","sources":["../src/components/molecules/dnd5e/AbilityEntry/StandardArray.svelte"],"sourcesContent":["<script>\n  import { log } from \"~/src/helpers/Utility\";\n  import { Timing } from \"@typhonjs-fvtt/runtime/util\";\n  import { createEventDispatcher, getContext, onDestroy, onMount, tick  } from \"svelte\";\n  import { abilities, race, } from \"~/src/helpers/store\"\n  import { MODULE_ID, STANDARD_ARRAY } from \"~/src/helpers/constants\"\n  \n  export let document = false;\n  \n  const dispatch = createEventDispatcher();\n  const doc = document || getContext(\"#doc\");\n  const updateDebounce = Timing.debounce(updateValue, 100);\n\n  async function updateValue (attr, value) {\n    // move the value to the next ability according to the direction of the arrow\n    const abilities = Object.keys(STANDARD_ARRAY);\n    // get index of attr from abilities\n    const index = abilities.indexOf(attr);\n    log.d('abilities', abilities)\n    log.d('index', index)\n    log.d('value', value)\n    log.d('attr', attr)\n    switch (value) {\n      case -1:\n        // move the value to the next ability according to the direction of the arrow\n        if(index < abilities.length - 1) {\n          const nextAbility = abilities[index + 1];\n          log.d('nextAbility', nextAbility)\n          const options = {system: {abilities: {[attr]: {value: $doc.system.abilities[nextAbility].value}, [nextAbility]: {value: $doc.system.abilities[attr].value}}}};\n          log.d('options', options)\n          await $doc.updateSource(options)\n          $doc = $doc\n\n        }\n        break;\n    \n      default:\n        // move the value to the next ability according to the direction of the arrow\n        if(index > 0) {\n          const nextAbility = abilities[index - 1];\n          log.d('nextAbility', nextAbility)\n          const options = {system: {abilities: {[attr]: {value: $doc.system.abilities[nextAbility].value}, [nextAbility]: {value: $doc.system.abilities[attr].value}}}};\n          log.d('options', options)\n          await $doc.updateSource(options)\n          $doc = $doc\n        }\n        break;\n    }\n\n    log.d(abilities)\n    // const options = {system: {abilities: { [attr]: {value: Number(event.target.value)}}}};\n    // $doc.updateSource(options)\n    // $doc = $doc\n  }\n\n  function reset() {\n    const options = {system: {abilities: {}}};\n    systemAbilitiesArray.forEach(ability => {\n      options.system.abilities[ability[1].abbreviation] = {value: STANDARD_ARRAY[ability[1].abbreviation]};\n    });\n    $doc.updateSource(options);\n    $doc = $doc;\n  }\n\n  function arraysMatch(array1, array2) {\n    if (array1.length !== array2.length) return false;\n\n    const sortedArray1 = array1.slice().sort((a, b) => a - b);\n    const sortedArray2 = array2.slice().sort((a, b) => a - b);\n\n    return sortedArray1.every((value, index) => value === sortedArray2[index]);\n  }\n\n  $: systemAbilities = game.system.config.abilities\n  $: systemAbilitiesArray = Object.entries(systemAbilities);\n  $: raceFeatScore = 0;\n  $: abilityAdvancements = $race?.advancement?.byType?.AbilityScoreImprovement?.[0].configuration?.fixed\n  $: isStandardArrayValues = arraysMatch(Object.values(STANDARD_ARRAY), systemAbilitiesArray.map(ability => $doc.system.abilities[ability[1].abbreviation].value))\n\n  onMount(async () => {\n    log.d($doc.system.abilities)\n    log.d(Object.keys($doc.system.abilities))\n    log.d(isStandardArrayValues)\n    // if all the abilities are 10, set them to the standard array\n    if(systemAbilitiesArray.every(ability => $doc.system.abilities[ability[1].abbreviation].value === 10)) {\n      reset();\n    }\n  });\n</script>\n\n<template lang=\"pug\">\n.attribute-entry.mt-sm\n  h5.flexrow.mb-sm\n    .flex2.left Ability\n    .flex1.center Race / Feat\n    .flex1.center Base Score\n    .flex1.center Score\n    .flex1.center Modifier\n  .indent\n    +each(\"systemAbilitiesArray as ability, index\")\n      .flexrow.mb-sm\n        .flex2.left {ability[1].label}\n        .flex1.center.align-text-with-input\n          +if(\"abilityAdvancements?.[ability[1].abbreviation] > 0\")\n            span +\n          span {abilityAdvancements?.[ability[1].abbreviation] || 0}\n        .flex1.center.relative\n          input.left.small.mainscore(disabled type=\"number\" value=\"{$doc.system.abilities[ability[1].abbreviation].value}\")\n          .controls\n            .up.chevron\n              +if(\"index != 0\")\n                i.fas.fa-chevron-up(alt=\"Decrease\" on:click!=\"{updateDebounce(ability[1].abbreviation, 1)}\")\n            .down.chevron\n              +if(\"index != 5\")\n                i.fas.fa-chevron-down(alt=\"Increase\" on:click!=\"{updateDebounce(ability[1].abbreviation, -1)}\")\n        .flex1.center.align-text-with-input {(Number(abilityAdvancements?.[ability[1].abbreviation]) || 0) + Number($doc.system.abilities[ability[1].abbreviation].value)}\n        .flex1.center.align-text-with-input \n          +if(\"$doc.system.abilities[ability[1].abbreviation].mod > 0\")\n            span +\n          span {$doc.system.abilities[ability[1].abbreviation].mod}\n    +if(\"!isStandardArrayValues\")\n      hr\n      button.btn.btn-primary(on:click=\"{reset}\") Reset to Standard Array\n\n</template>\n\n<style lang=\"sass\">\n  .align-text-with-input\n    margin-top: 0.3rem\n  .green\n    color: green\n  .red\n    color: red\n  .mainscore\n    min-width: 40px\n  .controls\n    .chevron\n      position: absolute\n      font-size: 0.75rem\n      right: 0\n      cursor: pointer\n      background-color: rgba(0, 0, 0, 0.1)\n      &.up\n        padding: 1px 3px 0px 3px\n        top: 0\n        &:hover\n          background-color: rgba(140, 90, 0, 0.2)\n      &.down\n        padding: 1px 3px 0px 3px\n        bottom: 0\n        &:hover\n          background-color: rgba(140, 90, 0, 0.2)\n    \n</style>"],"names":["ctx","attr"],"mappings":"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"}