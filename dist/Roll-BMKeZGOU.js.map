{"version":3,"file":"Roll-BMKeZGOU.js","sources":["../src/components/molecules/dnd5e/AbilityEntry/Roll.svelte"],"sourcesContent":["<script>\n  import { Timing } from \"@typhonjs-fvtt/runtime/util\";\n  import { createEventDispatcher, getContext, onDestroy, onMount, tick  } from \"svelte\";\n  import { abilities, race, abilityRolls } from \"~/src/stores/index\"\n  import { MODULE_ID } from \"~/src/helpers/constants\"\n  \n  export let document = false;\n  \n  const dispatch = createEventDispatcher();\n  const doc = document || getContext(\"#doc\");\n  const updateDebounce = Timing.debounce(updateValue, 100);\n  let formula, allowMove;\n\n  function updateValue(attr, event) {\n    if(event.target.value < 8) return false;\n    if(event.target.value > 15) return false;\n    const options = {system: {abilities: { [attr]: {value: Number(event.target.value)}}}};\n    $doc.updateSource(options)\n    $doc = $doc\n  }\n\n  async function swapAbilities(attr, direction) {\n    const abilities = Object.keys($doc.system.abilities);\n    const index = abilities.indexOf(attr);\n    \n    if (direction === 1 && index > 0) {\n      // Move up\n      const prevAbility = abilities[index - 1];\n      const options = {\n        system: {\n          abilities: {\n            [attr]: { value: $doc.system.abilities[prevAbility].value },\n            [prevAbility]: { value: $doc.system.abilities[attr].value },\n          },\n        },\n      };\n      await $doc.updateSource(options);\n      $doc = $doc;\n    } else if (direction === -1 && index < abilities.length - 1) {\n      // Move down\n      const nextAbility = abilities[index + 1];\n      const options = {\n        system: {\n          abilities: {\n            [attr]: { value: $doc.system.abilities[nextAbility].value },\n            [nextAbility]: { value: $doc.system.abilities[attr].value },\n          },\n        },\n      };\n      await $doc.updateSource(options);\n      $doc = $doc;\n    }\n  }\n\n  async function roll(attr) {\n    const roll = await new Roll(formula).evaluate();\n    await roll.toMessage();\n\n    $abilityRolls = !$abilityRolls ? {} : $abilityRolls\n    $abilityRolls[attr] = roll.total\n\n    // set the value of the ability to the result of the roll\n    const options = {system: {abilities: { [attr]: {value: Number(roll.total)}}}};\n    $doc.updateSource(options)\n    $doc = $doc\n  }\n  \n\n  $: systemAbilities = game.system.config.abilities\n  $: systemAbilitiesArray = Object.entries(systemAbilities);\n  $: raceFeatScore = 0;\n  $: abilityAdvancements = $race?.advancement?.byType?.AbilityScoreImprovement?.[0].configuration?.fixed\n  $: allRolled = systemAbilitiesArray.every(ability => $abilityRolls[ability[1].abbreviation] !== undefined);\n  $: scoreClass = allowMove && allRolled ? 'left' : 'center';\n  \n  onMount(async () => {\n    formula = game.settings.get(MODULE_ID, \"abiiltyRollFormula\")\n    allowMove = game.settings.get(MODULE_ID, \"allowAbilityRollScoresToBeMoved\")\n  });\n</script>\n\n<template lang=\"pug\">\n.attribute-entry.mt-sm\n  table\n    thead\n      tr\n        th.ability Ability\n        th.center Race / Feat\n        th.center Base Score\n        th.center Score\n        th.center Mod\n        th.center.roll-col\n    tbody\n      +each(\"systemAbilitiesArray as ability, index\")\n        tr\n          td.ability {ability[1].label}\n          td.center\n            +if(\"abilityAdvancements?.[ability[1].abbreviation] > 0\")\n              span +\n            span {abilityAdvancements?.[ability[1].abbreviation] || 0}\n          td.center.relative\n            input.small.mainscore(class=\"{scoreClass}\" disabled type=\"number\" value=\"{$doc.system.abilities[ability[1].abbreviation]?.value}\"  name=\"{ability[1].abbreviation}\" id=\"{ability[1].abbreviation}\")\n            +if(\"allowMove && allRolled\")\n              .controls\n                .up.chevron\n                  +if(\"index != 0\")\n                    i.fas.fa-chevron-up(alt=\"Move Up\" on:click!=\"{swapAbilities(ability[1].abbreviation, 1)}\")\n                .down.chevron\n                  +if(\"index != systemAbilitiesArray.length - 1\")\n                    i.fas.fa-chevron-down(alt=\"Move Down\" on:click!=\"{swapAbilities(ability[1].abbreviation, -1)}\")\n          td.center\n            span {(Number(abilityAdvancements?.[ability[1].abbreviation]) || 0) + Number($doc.system.abilities[ability[1].abbreviation]?.value || 0)}\n          td.center\n            +if(\"$doc.system.abilities[ability[1].abbreviation]?.mod > 0\")\n              span +\n            span {Number($doc.system.abilities[ability[1].abbreviation]?.mod) + (Number(abilityAdvancements?.[ability[1].abbreviation]) || 0)}\n          td.center\n            .buttons(class=\"{$abilityRolls[ability[1].abbreviation] ? '' : 'active'}\" alt=\"Roll\" on:click!=\"{roll(ability[1].abbreviation)}\")\n              i.fas.fa-dice\n\n</template>\n\n<style lang=\"sass\">\n  table\n    width: 100%\n    border-collapse: separate\n    border-spacing: 0 0.5rem\n   \n  th\n    padding: 0.1rem 0.5rem\n    text-align: left\n    font-family: var(--dnd5e-font-modesto)\n    &.center\n      text-align: center\n    &.roll-col\n      width: 2rem\n   \n  td\n    text-align: left\n    &.center\n      text-align: center\n    &.ability\n      width: 25%\n \n  .green\n    color: green\n  .red\n    color: red\n  .relative\n    position: relative\n    background-color: rgba(0, 0, 0, 0.05)\n    border-radius: 3px\n    input\n      background: none\n      width: 3em\n      &:disabled\n        color: var(--color-text-dark-primary)\n      text-decoration: none\n      border: none\n      outline: none\n      box-shadow: none\n      -webkit-appearance: none\n      -moz-appearance: none\n      appearance: none\n  .mainscore\n    min-width: 40px\n  .controls\n    .chevron\n      position: absolute\n      font-size: 0.75rem\n      right: 0\n      cursor: pointer\n      background-color: rgba(0, 0, 0, 0.1)\n      &.up\n        padding: 1px 3px 0px 3px\n        top: 0\n        &:hover\n          background-color: rgba(140, 90, 0, 0.2)\n      &.down\n        padding: 1px 3px 0px 3px\n        bottom: 0\n        &:hover\n          background-color: rgba(140, 90, 0, 0.2)\n  .buttons\n    cursor: pointer\n    min-width: 24px\n    font-size: 1rem\n    background-color: rgba(0, 0, 0, 0.1)\n    padding: 2px 1px 0px 0px\n    border: 1px solid var(--color-positive)\n    border-radius: 4px\n    color: var(--color-positive)\n    &:hover\n      cursor: pointer\n      background-color: rgba(140, 90, 0, 0.2)\n    &.active\n      border: 1px solid var(--color-negative)\n      color: var(--color-negative)\n      animation: pulse 1s infinite\n</style>"],"names":["ctx","attr","roll"],"mappings":"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"}