{"version":3,"file":"PointBuy-BKLhRQi-.js","sources":["../src/components/molecules/dnd5e/AbilityEntry/PointBuy.svelte"],"sourcesContent":["<script>\n  import { Timing } from \"@typhonjs-fvtt/runtime/util\";\n  import {\n    createEventDispatcher,\n    getContext,\n    setContext,\n    onDestroy,\n    onMount,\n    tick,\n  } from \"svelte\";\n  import {\n    abilities,\n    race,\n    pointBuyScoreTotal,\n    pointBuyLimit,\n    abilityRolls,\n  } from \"~/src/stores/index\";\n  import { POINT_BUY_COSTS, MODULE_ID } from \"~/src/helpers/constants\";\n  import { dnd5eModCalc } from \"~/src/helpers/Utility\";\n  import { localize as t } from \"~/src/helpers/Utility\";\n\n  export let document = false;\n\n  const dispatch = createEventDispatcher();\n  const doc = document || getContext(\"#doc\");\n  const updateDebounce = Timing.debounce(updateValue, 100);\n\n  async function updateValue(attr, event) {\n    if (event.target.value < 8) return false;\n    if (event.target.value > 15) return false;\n    const options = {\n      system: { abilities: { [attr]: { value: Number(event.target.value) } } },\n    };\n    await $doc.updateSource(options);\n    if ($doc.render) {\n      $doc.render();\n    }\n    // Explicitly recalculate the pointBuyScoreTotal to ensure reactivity\n    $pointBuyScoreTotal =\n      systemAbilitiesArray?.reduce(\n        (acc, ability) =>\n          acc +\n          POINT_BUY_COSTS[Number($doc.system.abilities[ability[0]]?.value)],\n        0,\n      ) || 12;\n  }\n\n  // Function to calculate pointBuyLimit\n  function calculatePointBuyLimit() {\n    return game.settings.get(MODULE_ID, \"pointBuyLimit\");\n  }\n\n  async function reset() {\n    $abilityRolls = {};\n    const options = { system: { abilities: {} } };\n    systemAbilitiesArray.forEach((ability) => {\n      options.system.abilities[ability[0]] = { value: 10 };\n    });\n    await $doc.updateSource(options);\n    if ($doc.render) {\n      $doc.render();\n    }\n    // Explicitly recalculate the pointBuyScoreTotal to ensure reactivity\n    $pointBuyScoreTotal =\n      systemAbilitiesArray?.reduce(\n        (acc, ability) =>\n          acc +\n          POINT_BUY_COSTS[Number($doc.system.abilities[ability[0]]?.value)],\n        0,\n      ) || 12;\n  }\n\n  $: systemAbilities = game.system.config.abilities;\n  $: systemAbilitiesArray = Object.entries(systemAbilities);\n  $: raceFeatScore = 0;\n  $: abilityAdvancements =\n    $race?.advancement?.byType?.AbilityScoreImprovement?.[0].configuration\n      ?.fixed;\n  $: $pointBuyScoreTotal =\n    systemAbilitiesArray?.reduce(\n      (acc, ability) =>\n        acc + POINT_BUY_COSTS[Number($doc.system.abilities[ability[0]]?.value)],\n      0,\n    ) || 12;\n  $: activeCSSClass = $pointBuyScoreTotal !== $pointBuyLimit ? \" active\" : \"\";\n  $: pointBuyClass =\n    $pointBuyScoreTotal > $pointBuyLimit\n      ? \"red\" + activeCSSClass\n      : \"green\" + activeCSSClass;\n\n  onMount(async () => {});\n</script>\n\n<template lang=\"pug\">\n.attribute-entry.mt-sm\n  table\n    thead\n      tr\n        th.ability Ability\n        th.center Base\n        +if(\"window.GAS.dnd5eRules == '2014'\")\n          th.center Origin\n        th.center Score\n        th.center Modifier\n    tbody\n      +each(\"systemAbilitiesArray as ability, index\")\n        tr\n          td.ability {ability[1].label}\n          td.center.relative\n            input.left.small.mainscore(disabled type=\"number\" value=\"{$doc.system.abilities[ability[0]]?.value}\" name=\"{ability[0]}\" id=\"{ability[0]}\" )\n            .controls\n              .up.chevron(on:click!=\"{updateDebounce(ability[0], {target: {value: Number($doc.system.abilities[ability[0]]?.value) + 1}})}\")\n                i.fas.fa-chevron-up(alt=\"{t('AltText.Increase')}\")\n              .down.chevron( on:click!=\"{updateDebounce(ability[0], {target: {value: Number($doc.system.abilities[ability[0]]?.value) - 1}})}\")\n                i.fas.fa-chevron-down(alt=\"{t('AltText.Decrease')}\")\n          \n          +if(\"window.GAS.dnd5eRules == '2014'\")\n            td.center\n              +if(\"abilityAdvancements?.[ability[0]] > 0\")\n                span +\n              span {abilityAdvancements?.[ability[0]] || 0}\n          td.center {(Number(abilityAdvancements?.[ability[0]]) || 0) + Number($doc.system.abilities[ability[0]]?.value || 0)}\n          td.center\n            +if(\"dnd5eModCalc(Number($doc.system.abilities[ability[0]]?.value) + (Number(abilityAdvancements?.[ability[0]]) || 0)) > 0\")\n              span +\n            span {dnd5eModCalc(Number($doc.system.abilities[ability[0]]?.value) + (Number(abilityAdvancements?.[ability[0]]) || 0))}\n      tr\n        td(colspan=\"5\")\n          hr\n          .flexrow.justify-flexrow-vertical\n            .flex1 Points total: \n            .flex\n              +if(\"isNaN($pointBuyScoreTotal)\")\n                span.red(data-tooltip=\"{t('Setting.AbilityEntry.AllowPointBuy.InvalidTotal')}\") N/A\n                +else()\n                  input.score.center.small( disabled class=\"{pointBuyClass}\"  type=\"number\" value=\"{$pointBuyScoreTotal}\") \n            .flex0 / \n            .flex1 \n              input.center.small(disabled  type=\"number\" value=\"{$pointBuyLimit}\") \n      \n      +if(\"isNaN($pointBuyScoreTotal)\")\n        tr\n          td(colspan=\"5\")\n            hr\n            button.btn.btn-primary(on:click=\"{reset}\") Reset scores\n\n</template>\n\n<style lang=\"sass\">\n  table\n    width: 100%\n    border-collapse: separate\n    \n   \n  th\n    padding: 0.1rem 0.5rem\n    text-align: left\n    font-family: var(--dnd5e-font-modesto)\n    &.center\n      text-align: center\n    &.ability\n      width: 25%\n   \n  td\n    text-align: left\n    &.center\n      text-align: center\n    &.ability\n      width: 25%\n \n  .green\n    color: green\n  .red\n    color: red\n  .mainscore\n    min-width: 33px\n    max-width: 33px\n  .score\n    &.active\n      animation: pulse 0.5s infinite\n  .controls\n    .chevron\n      position: absolute\n      font-size: 0.75rem\n      right: 0\n      cursor: pointer\n      background-color: rgba(0, 0, 0, 0.1)\n      &.up\n        padding: 1px 3px 0px 3px\n        top: 8px\n        &:hover\n          background-color: rgba(140, 90, 0, 0.2)\n      &.down\n        padding: 1px 3px 0px 3px\n        bottom: 8px\n        &:hover\n          background-color: rgba(140, 90, 0, 0.2)\n\n</style>\n"],"names":["ctx","t","attr"],"mappings":";;;;;;;;;;;;;;;;;AA6FsJ,aAA8B,QAAA,IAAA,MAAA;AAAA;;;;;;;;;;;AAAi6B,MAAA;AAAA;AAAA,KAAA,IAAmB,CAAA;AAAA;AAAA,MAAG,IAAO,EAAA,EAAC,CAAC;AAAA,SAAM,KAAC;AAAA;;AAAtG,MAAA;AAAA;AAAA,IAAA,IAAmB,CAAA;AAAA;AAAA,MAAG,IAAO,EAAA,EAAC,CAAC;AAAA,QAAK,KAAC,kBAAA;AAAA;;;;;;;;;;AAA7D,aAA2I,QAAA,IAAA,MAAA;;AAA1D,aAAqD,IAAA,IAAA;;;;AAA9G;AAAA;AAAA,QAAAA,KAAmB,CAAA;AAAA;AAAA,UAAGA,KAAO,EAAA,EAAC,CAAC;AAAA,YAAK;AAAA,QAAC;;;;;;;;;;;AAA2B,UAAA;AAAA,MAAA,MAAA,eAAA;AAAA,OAAAA,KAAmB,CAAA;AAAA;AAAA,QAAGA,KAAO,EAAA,EAAC,CAAC;AAAA,WAAM,KAAC,IAAA,UAAA,KAAA,SAAA;AAAA;;;;;;;;;;;;;;;;;AAAhE,aAAc,QAAA,MAAA,MAAA;AAAA;;;;;;;;;;;;;;;;AAAoV,aAAc,QAAA,MAAA,MAAA;AAAA;;;;;;;;;;;;;IAA1lC,IAAO,EAAA,EAAC,CAAC,EAAE,QAAK;AAAA;;;;;;;;;;;kBAAi0B;AAAA;AAAA,IAAO,IAAmB,CAAA;AAAA;AAAA,MAAG,QAAQ,CAAC;AAAA,IAAA;AAAA,EAAA,KAAO,KAAK;AAAA;AAAA,IAAO,IAAI,CAAA,EAAC,OAAO;AAAA;AAAA,MAAU,QAAQ,CAAC;AAAA,IAAA,GAAI,SAAS;AAAA,EAAC,IAAA;;;gBAA+B,aAAa;AAAA;AAAA,IAAO,IAAI,CAAA,EAAC,OAAO;AAAA;AAAA,MAAU,IAAO,EAAA,EAAC,CAAC;AAAA,OAAI;AAAA,EAAK,KAAK;AAAA;AAAA,IAAO,IAAmB,CAAA;AAAA;AAAA,MAAG,IAAO,EAAA,EAAC,CAAC;AAAA,IAAA;AAAA,EAAA,KAAO,EAAC,IAAK;;iBAA4B,aAAa;AAAA;AAAA,IAAO,OAAK,OAAO;AAAA;AAAA,MAAU,IAAO,EAAA,EAAC,CAAC;AAAA,IAAA,GAAI;AAAA,EAAK,KAAK;AAAA;AAAA,IAAO;;MAAsB,IAAO,EAAA,EAAC,CAAC;AAAA,IAAA;AAAA,EAAA,KAAO,EAAC,IAAA;;;;AAAzkB,MAAA,YAAA,OAAO,IAAI,cAAc,UAAM,kBAAA,GAAA;;;;;;;;;;;AAAnS,WAAA,YAAA,qCAAAC,SAAE,kBAAkB,CAAA;;AAA8L,WAAA,YAAA,uCAAAA,SAAE,kBAAkB,CAAA;;;;;;;;;;;;;MAAzf,IAAI,CAAA,EAAC,OAAO;AAAA;AAAA,QAAU,IAAO,EAAA,EAAC,CAAC;AAAA,MAAA,GAAI;AAAe,WAAA,OAAA,QAAA;AAAA,MAAA,QAAQ,CAAC,CAAA;AAAS,WAAA,OAAA,MAAA;AAAA,MAAA,QAAQ,CAAC,CAAA;;;;;;;;;AAA3N,aAAkwC,QAAA,IAAA,MAAA;AAA9vC,aAA2C,IAAA,GAAA;;AAAA,aAAinB,IAAA,GAAA;AAArlB,aAAoJ,KAAA,KAAA;AAAA,aAA4b,KAAA,IAAA;AAAta,aAA8M,MAAA,IAAA;AAAA,aAAkN,MAAA,IAAA;;AAAgM,aAAkI,IAAA,GAAA;;AAAA,aAAsS,IAAA,GAAA;;AAArI,aAAgI,KAAA,IAAA;;;;;;;cAAh+B,IAAc,CAAA;AAAA;AAAA,gBAAC,IAAO,EAAA,EAAC,CAAC;AAAA,gBAAA;AAAA,kBAAI,QAAM;AAAA,oBAAG,OAAO;AAAA;AAAA,sBAAO,OAAK,OAAO;AAAA;AAAA,wBAAU,IAAO,EAAA,EAAC,CAAC;AAAA,sBAAA,GAAI;AAAA,oBAAK,IAAI;AAAA;;;cAA/F,KAAc,CAAA;AAAA;AAAA,cAAC,IAAO,EAAA,EAAC,CAAC;AAAA,cAAA;AAAA,gBAAI,QAAM;AAAA,kBAAG,OAAO;AAAA;AAAA,oBAAO,OAAK,OAAO;AAAA;AAAA,sBAAU,IAAO,EAAA,EAAC,CAAC;AAAA,oBAAA,GAAI;AAAA,kBAAK,IAAI;AAAA;;;;;;;cAAiH,IAAc,CAAA;AAAA;AAAA,gBAAC,IAAO,EAAA,EAAC,CAAC;AAAA,gBAAA;AAAA,kBAAI,QAAM;AAAA,oBAAG,OAAO;AAAA;AAAA,sBAAO,OAAK,OAAO;AAAA;AAAA,wBAAU,IAAO,EAAA,EAAC,CAAC;AAAA,sBAAA,GAAI;AAAA,oBAAK,IAAI;AAAA;;;cAA/F,KAAc,CAAA;AAAA;AAAA,cAAC,IAAO,EAAA,EAAC,CAAC;AAAA,cAAA;AAAA,gBAAI,QAAM;AAAA,kBAAG,OAAO;AAAA;AAAA,oBAAO,OAAK,OAAO;AAAA;AAAA,sBAAU,IAAO,EAAA,EAAC,CAAC;AAAA,oBAAA,GAAI;AAAA,kBAAK,IAAI;AAAA;;;;;;;;;;;;MAA9iB,IAAO,EAAA,EAAC,CAAC,EAAE,QAAK,IAAA,UAAA,IAAA,QAAA;;;MAAqG,IAAI,CAAA,EAAC,OAAO;AAAA;AAAA,QAAU,IAAO,EAAA,EAAC,CAAC;AAAA,MAAA,GAAI,UAAK,MAAA,UAAA,mBAAA;;;AAAU,UAAA;AAAA,MAAA,KAAA,sBAAA;AAAA,MAAA,QAAQ,CAAC,IAAA;;;AAAS,UAAA;AAAA,MAAA,KAAA,oBAAA;AAAA,MAAA,QAAQ,CAAC,IAAA;;;AAA0c,UAAA,OAAO,IAAI,cAAc,OAAM,WAAA,EAAA,KAAA,KAAA;;sCAAsK;AAAA;AAAA,QAAO,IAAmB,CAAA;AAAA;AAAA,UAAG,QAAQ,CAAC;AAAA,QAAA;AAAA,MAAA,KAAO,KAAK;AAAA;AAAA,QAAO,IAAI,CAAA,EAAC,OAAO;AAAA;AAAA,UAAU,QAAQ,CAAC;AAAA,QAAA,GAAI,SAAS;AAAA,MAAC,IAAA,IAAA,UAAA,IAAA,QAAA;;oBAA+B,aAAa;AAAA;AAAA,QAAO,IAAI,CAAA,EAAC,OAAO;AAAA;AAAA,UAAU,IAAO,EAAA,EAAC,CAAC;AAAA,WAAI;AAAA,MAAK,KAAK;AAAA;AAAA,QAAO,IAAmB,CAAA;AAAA;AAAA,UAAG,IAAO,EAAA,EAAC,CAAC;AAAA,QAAA;AAAA,MAAA,KAAO,EAAC,IAAK;;;;;;;;;;;;;qCAA4B,aAAa;AAAA;AAAA,QAAO,OAAK,OAAO;AAAA;AAAA,UAAU,IAAO,EAAA,EAAC,CAAC;AAAA,QAAA,GAAI;AAAA,MAAK,KAAK;AAAA;AAAA,QAAO;;UAAsB,IAAO,EAAA,EAAC,CAAC;AAAA,QAAA;AAAA,MAAA,KAAO,EAAC,IAAA,IAAA,UAAA,IAAA,QAAA;AAAA;;;;;;;;;;;;;;;;;;;MAAqU,IAAa,CAAA,IAAA,qBAAA;;;;MAAkC,IAAmB,CAAA;AAAA;;AAApG,aAAuG,QAAA,OAAA,MAAA;AAAA;;;;MAArED,KAAa,CAAA,IAAA,wBAAA;;;;;MAAkCA,KAAmB,CAAA,GAAA;;QAAnBA,KAAmB,CAAA;AAAA;;;;;;;;;;;;;;;;AAA5K,WAAA,MAAA,gBAAAC,SAAE,iDAAiD,CAAA;AAAA;;AAApF,aAAkG,QAAA,MAAA,MAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAA0S,aAA0G,QAAA,IAAA,MAAA;AAAtG,aAAiG,IAAA,EAAA;AAAjF,aAAI,IAAA,EAAA;AAAA,aAAwE,IAAA,MAAA;;;;;;UAA7B,IAAK,CAAA;AAAA,QAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAnG,MAAA,UAAA;AAAA;AAAA,IAAM,IAAmB,CAAA;AAAA,EAAA;AAAp/D,MAAA,YAAA,OAAO,IAAI,cAAc,UAAM,kBAAA;;;IAA4H,IAAoB,CAAA;AAAA,EAAA;;iCAAzB,QAAI,KAAA,GAAA;;;;;;AAAq7C,QAAA,aAAA,KAAA,aAAA,CAAA,CAAA;AAAA;AAAA,MAAMD,KAAmB,CAAA;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAAuU,IAAc,CAAA;;;;;;;;;AAAnjE,aAAgvE,QAAA,MAAA,MAAA;AAA7sE,aAAwsE,MAAA,KAAA;AAAjsE,aAAyN,OAAA,KAAA;AAAlN,aAA0M,OAAA,GAAA;AAAtM,aAAgC,KAAA,GAAA;AAAA,aAA4B,KAAA,GAAA;;AAAwE,aAA6B,KAAA,GAAA;AAAA,aAAgC,KAAA,GAAA;AAAa,aAAg+D,OAAA,KAAA;;;;;;AAAlqB,aAA2gB,OAAA,GAAA;AAAvgB,aAAkgB,KAAA,EAAA;AAAlf,aAAI,IAAA,EAAA;AAAA,aAAye,IAAA,IAAA;AAA3b,aAAuC,MAAA,IAAA;AAAA,aAA6Q,MAAA,IAAA;;AAAA,aAA2B,MAAA,IAAA;AAAA,aAAsG,MAAA,IAAA;AAAlF,aAA4E,MAAA,KAAA;;;;;;;;UAAryDA,KAAoB,CAAA;AAAA,QAAA;;mCAAzB,QAAI,KAAA,GAAA;;;;;;;;;;;;;wCAAJ;AAAA;;;;;;;;;;;;;MAAyxDA,KAAc,CAAA,GAAA;;QAAdA,KAAc,CAAA;AAAA;AAA8B,UAAA;AAAA,MAAA,EAAA,WAAA;AAAA;AAAA,QAAMA,KAAmB,CAAA;AAAA,MAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAxE7lE,MAAA,EAAA,WAAW,MAAK,IAAA;AAEV,wBAAqB;AAChC,QAAA,MAAM,YAAY,WAAW,MAAM;;AACnC,QAAA,iBAAiB,OAAO,SAAS,aAAa,GAAG;iBAExC,YAAYE,OAAM,OAAK;AAChC,QAAA,MAAM,OAAO,QAAQ,UAAU;AAC/B,QAAA,MAAM,OAAO,QAAQ,WAAW;UAC9B,UAAO;AAAA,MACX,QAAM;AAAA,QAAI,WAAS;AAAA,WAAKA,KAAI,GAAA,EAAK,OAAO,OAAO,MAAM,OAAO,KAAK,EAAA;AAAA;;;UAE7D,KAAK,aAAa,OAAO;AAC3B,QAAA,KAAK,QAAM;AACb,WAAK,OAAM;AAAA;AAGb,oBAAA,oBAAA,sBACE,sBAAsB,OAAM,CACzB,KAAK,YACJ,MACA,gBAAgB,OAAO,KAAK,OAAO,UAAU,QAAQ,CAAC,CAAA,GAAI,KAAK,CAAA,GACjE,CAAC,KACE,IAAE,mBAAA;AAAA;iBAQI,QAAK;kCAClB,gBAAa,CAAA,GAAA,aAAA;UACP,UAAO,EAAK,QAAM,EAAI,WAAS,CAAA,EAAA,EAAA;AACrC,yBAAqB,QAAS,aAAO;AACnC,cAAQ,OAAO,UAAU,QAAQ,CAAC,CAAA,IAAA,EAAO,OAAO,GAAE;AAAA;UAE9C,KAAK,aAAa,OAAO;AAC3B,QAAA,KAAK,QAAM;AACb,WAAK,OAAM;AAAA;AAGb,oBAAA,oBAAA,sBACE,sBAAsB,OAAM,CACzB,KAAK,YACJ,MACA,gBAAgB,OAAO,KAAK,OAAO,UAAU,QAAQ,CAAC,CAAA,GAAI,KAAK,CAAA,GACjE,CAAC,KACE,IAAE,mBAAA;AAAA;AAqBX,UAAO,YAAA;AAAA;;;;;;;sBAjBJ,uBAAuB,OAAO,QAAQ,eAAe,CAAA;AAAA;;;AAEvD,mBAAA,GAAE,sBACD,OAAO,aAAa,QAAQ,0BAA0B,CAAC,EAAE,eACrD,KAAK;AAAA;;;AACV,sBAAA,oBAAE,sBACD,sBAAsB,OAAM,CACzB,KAAK,YACJ,MAAM,gBAAgB,OAAO,KAAK,OAAO,UAAU,QAAQ,CAAC,CAAA,GAAI,KAAK,CAAA,GACvE,CAAC,KACE,IAAE,mBAAA;AAAA;;;AACR,mBAAA,IAAE,iBAAiB,wBAAwB,iBAAiB,YAAY,EAAE;AAAA;;;AAC1E,mBAAA,GAAE,gBACD,sBAAsB,iBAClB,QAAQ,iBACR,UAAU,cAAc;AAAA;;AAhB7B,eAAA,IAAE,kBAAkB,KAAK,OAAO,OAAO,SAAS;;;;;;;;;;;;;;;;;;;;;;;"}