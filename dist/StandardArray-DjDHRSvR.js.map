{"version":3,"file":"StandardArray-DjDHRSvR.js","sources":["../src/components/molecules/dnd5e/AbilityEntry/StandardArray.svelte"],"sourcesContent":["<script>\n  import { Timing } from \"@typhonjs-fvtt/runtime/util\";\n  import {\n    createEventDispatcher,\n    getContext,\n    onDestroy,\n    onMount,\n    tick,\n  } from \"svelte\";\n  import { abilities, race, isStandardArrayValues, abilityRolls } from \"~/src/stores/index\";\n  import { MODULE_ID, STANDARD_ARRAY } from \"~/src/helpers/constants\";\n\n  export let document = false;\n\n  const dispatch = createEventDispatcher();\n  const doc = document || getContext(\"#doc\");\n  const updateDebounce = Timing.debounce(updateValue, 100);\n\n  async function updateValue(attr, value) {\n    // move the value to the next ability according to the direction of the arrow\n    const abilities = Object.keys(STANDARD_ARRAY);\n    // get index of attr from abilities\n    const index = abilities.indexOf(attr);\n    // window.GAS.log.d('abilities', abilities)\n    // window.GAS.log.d('index', index)\n    // window.GAS.log.d('value', value)\n    // window.GAS.log.d('attr', attr)\n    \n    switch (value) {\n      case -1:\n        // move the value to the next ability according to the direction of the arrow\n        if (index < abilities.length - 1) {\n          const nextAbility = abilities[index + 1];\n          // window.GAS.log.d('nextAbility', nextAbility)\n          const options = {\n            system: {\n              abilities: {\n                [attr]: { value: $doc.system.abilities[nextAbility].value },\n                [nextAbility]: { value: $doc.system.abilities[attr].value },\n              },\n            },\n          };\n          // window.GAS.log.d('options', options)\n          await $doc.updateSource(options);\n          $doc = $doc;\n        }\n        break;\n\n      default:\n        // move the value to the next ability according to the direction of the arrow\n        if (index > 0) {\n          const nextAbility = abilities[index - 1];\n          // window.GAS.log.d('nextAbility', nextAbility)\n          const options = {\n            system: {\n              abilities: {\n                [attr]: { value: $doc.system.abilities[nextAbility].value },\n                [nextAbility]: { value: $doc.system.abilities[attr].value },\n              },\n            },\n          };\n          // window.GAS.log.d('options', options)\n          await $doc.updateSource(options);\n          $doc = $doc;\n        }\n        break;\n    }\n\n    // window.GAS.log.d(abilities)\n    // const options = {system: {abilities: { [attr]: {value: Number(event.target.value)}}}};\n    // $doc.updateSource(options)\n    // $doc = $doc\n  }\n\n  function reset() {\n    $abilityRolls = {};\n\n    const options = { system: { abilities: {} } };\n    systemAbilitiesArray.forEach((ability) => {\n      options.system.abilities[ability[1].abbreviation] = {\n        value: STANDARD_ARRAY[ability[1].abbreviation],\n      };\n    });\n    $doc.updateSource(options);\n    $doc = $doc;\n  }\n\n  function arraysMatch(array1, array2) {\n    if (array1.length !== array2.length) return false;\n\n    const sortedArray1 = array1.slice().sort((a, b) => a - b);\n    const sortedArray2 = array2.slice().sort((a, b) => a - b);\n\n    return sortedArray1.every((value, index) => value === sortedArray2[index]);\n  }\n\n  $: systemAbilities = game.system.config.abilities;\n  $: systemAbilitiesArray = Object.entries(systemAbilities);\n  $: raceFeatScore = 0;\n  $: abilityAdvancements =\n    $race?.advancement?.byType?.AbilityScoreImprovement?.[0].configuration\n      ?.fixed;\n  // $: isStandardArrayValues = arraysMatch(\n  //   Object.values(STANDARD_ARRAY),\n  //   systemAbilitiesArray.map(\n  //     (ability) => $doc.system.abilities[ability[1].abbreviation].value,\n  //   ),\n  // );\n  $: $isStandardArrayValues = arraysMatch(\n    Object.values(STANDARD_ARRAY),\n    systemAbilitiesArray.map(\n      (ability) => $doc.system.abilities[ability[1].abbreviation]?.value,\n    ),\n  );\n  // $: {\n  //   const currentAbilities = systemAbilitiesArray.map(\n  //     (ability) => {\n  //       window.GAS.log.d(ability) \n  //       return $doc.system.abilities[ability[1].abbreviation].value\n  //     }\n  //   );\n  //   const match = arraysMatch(STANDARD_ARRAY, currentAbilities);\n  //   isStandardArrayValues.set(match);\n  // }\n  onMount(async () => {\n    // window.GAS.log.d($doc.system.abilities)\n    // window.GAS.log.d(Object.keys($doc.system.abilities))\n    // window.GAS.log.d(isStandardArrayValues)\n    // if all the abilities are 10, set them to the standard array\n    if (\n      systemAbilitiesArray.every(\n        (ability) =>\n          $doc.system.abilities[ability[1].abbreviation]?.value === 10,\n      )\n    ) {\n      reset();\n    }\n  });\n</script>\n\n<template lang=\"pug\">\n.attribute-entry.mt-sm\n  table\n    thead\n      tr\n        th.ability Ability\n        th.center Race / Feat\n        th.center Base Score\n        th.center Score\n        th.center Modifier\n    tbody\n      +each(\"systemAbilitiesArray as ability, index\")\n        tr\n          td.ability {ability[1].label}\n          td.center\n            +if(\"abilityAdvancements?.[ability[1].abbreviation] > 0\")\n              span +\n            span {abilityAdvancements?.[ability[1].abbreviation] || 0}\n          td.center.relative\n            input.left.small.mainscore(disabled type=\"number\" value=\"{$doc.system.abilities[ability[1].abbreviation]?.value}\")\n            .controls\n              .up.chevron\n                +if(\"index != 0\")\n                  i.fas.fa-chevron-up(alt=\"Decrease\" on:click!=\"{updateDebounce(ability[1].abbreviation, 1)}\")\n              .down.chevron\n                +if(\"index != 5\")\n                  i.fas.fa-chevron-down(alt=\"Increase\" on:click!=\"{updateDebounce(ability[1].abbreviation, -1)}\")\n          td.center {(Number(abilityAdvancements?.[ability[1].abbreviation]) || 0) + Number($doc.system.abilities[ability[1].abbreviation]?.value || 0)}\n          td.center\n            +if(\"$doc.system.abilities[ability[1].abbreviation]?.mod > 0\")\n              span +\n            span {$doc.system.abilities[ability[1].abbreviation]?.mod}\n      +if(\"!$isStandardArrayValues\")\n        tr\n          td(colspan=\"5\")\n            hr\n            button.btn.btn-primary(on:click=\"{reset}\") Reset to Standard Array\n\n</template>\n\n<style lang=\"sass\">\n  table\n    width: 100%\n    border-collapse: separate\n    border-spacing: 0 0.5rem\n   \n  th\n    padding: 0.1rem 0.5rem\n    text-align: left\n    font-family: var(--dnd5e-font-modesto)\n    &.center\n      text-align: center\n    &.ability\n      width: 25%\n   \n  td\n    text-align: left\n    &.center\n      text-align: center\n    &.ability\n      width: 25%\n \n  .green\n    color: green\n  .red\n    color: red\n  .mainscore\n    min-width: 40px\n  .controls\n    .chevron\n      position: absolute\n      font-size: 0.75rem\n      right: 0\n      cursor: pointer\n      background-color: rgba(0, 0, 0, 0.1)\n      &.up\n        padding: 1px 3px 0px 3px\n        top: 0\n        &:hover\n          background-color: rgba(140, 90, 0, 0.2)\n      &.down\n        padding: 1px 3px 0px 3px\n        bottom: 0\n        &:hover\n          background-color: rgba(140, 90, 0, 0.2)\n\n</style>\n"],"names":["ctx","attr"],"mappings":"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"}